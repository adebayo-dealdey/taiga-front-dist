{"version":3,"sources":["app.js"],"names":["configure","i18nInit","init","module","modules","pluginsWithModule","taiga","this","taigaContribPlugins","window","generateHash","components","_","map","x","JSON","stringify","hex_sha1","join","generateUniqueSessionIdentifier","date","randomNumber","Date","getTime","Math","floor","random","sessionId","$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","authHttpIntercept","decorators","defaultHeaders","loaderIntercept","originalWhen","preferedLangCode","userInfo","versionCheckHttpIntercept","classNameFilter","when","path","route","resolve","angular","extend","languageLoad","$q","$translate","deferred","defer","then","promise","call","templateUrl","access","requiresLogin","loader","title","description","joyride","controller","controllerAs","section","reloadOnSearch","redirectTo","params","pslug","disableHeader","mobileViewport","otherwise","html5Mode","enabled","requireBase","Content-Type","Accept-Language","taigaConfig","defaultLanguage","X-Session-Id","defaults","headers","patch","post","put","get","useApplyAsync","setSessionId","$location","$navUrls","$lightboxService","httpResponseError","response","nextUrl","status","config","cancelable","closeAll","replace","url","indexOf","encodeURIComponent","search","reject","responseError","factory","interceptors","push","loaderService","request","logRequest","requestError","rejection","logResponse","$injector","data","version","element","injector","invoke","_this","$confirm","versionErrorMsg","instant","notify","checksley","updateValidators","linewidth","val","width","lines","valid","nl2br","split","every","line","length","debugInfoEnabled","debugInfo","localStorage","parse","lang","addPart","useLoader","urlTemplate","_version","useSanitizeValueStrategy","addInterpolation","preferredLanguage","fallbackLanguage","getDecorators","each","decorator","provider","messages","moment","locale","defaultMessage","type","email","urlstrict","number","digits","dateIso","alphanum","phone","notnull","notblank","required","regexp","min","max","range","minlength","maxlength","rangelength","mincheck","maxcheck","rangecheck","equalto","updateMessages","$log","$rootscope","$auth","$events","$analytics","appMetaService","projectService","navigationBarService","un","user","debug","contribPlugins","adminPlugins","where","$on","e","ctx","language","Promise","setScheduler","cb","$evalAsync","setupConnection","isAuthenticated","getUser","initialize","event","next","start","setSection","setProjectBySlug","cleanProject","setAll","addMobileViewport","removeMobileViewport","enableHeader","filter","plugin","value","concat","run","TaigaBase","TaigaController","TaigaService","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","bind","fn","me","apply","arguments","superClass","onInitialDataError","xhr","location","navUrls","q","Base","Service","Controller","bindMethods","bindOnce","cancelTimeout","debounce","debounceLeading","defineImmutableProperty","groupBy","joinStr","mixOf","replaceTags","scopeDefer","sizeFormat","slugify","startswith","stripTags","timeout","toString","toggleText","trim","truncate","unslugify","item","i","l","slice","str","breakTag","object","dependencies","methods","keys","forIn","bindAll","scope","attr","continuation","delBind","$eval","$watch","Mixed","base","method","mixin","mixins","name","ref","char","capitalize","texts","nextTextPosition","text","coll","pred","len","result","wait","setTimeout","timeoutVar","clearTimeout","func","$apply","isNumber","isString","isPlainObject","isUndefined","leading","trailing","str1","str2","startsWith","maxLength","suffix","out","String","substring","lastIndexOf","input","precision","size","units","isNaN","parseFloat","isFinite","log","pow","toFixed","exception","pattern","RegExp","tags","obj","Object","defineProperty","fn_result","isFunction","isObject","removeKeys","chain","flatten","reduce","FiltersMixin","PageMixin","fillUsersAndRoles","users","roles","activeUsers","computableRoles","is_active","sortBy","activeUsersById","id","usersById","project","members","uniq","contains","loadUsersAndRoles","all","rs","projects","usersList","projectId","rolesList","results","selectFilter","load","existing","compact","isInCurrentRouteParams","noreload","replaceFilter","replaceAllFilters","filters","unselectFilter","newValues","parsedValues","isEmpty","AuthService","CancelAccountDirective","ChangeEmailDirective","ChangePasswordFromRecoveryDirective","ForgotPasswordDirective","InvitationDirective","LoginDirective","PublicRegisterMessageDirective","RegisterDirective","rootscope","storage","model","http","urls","translate","currentUserService","themeService","userModel","_currentTheme","_getUserTheme","setUserdata","$inject","userData","Immutable","fromJS","getAttrs","setUser","theme","_setTheme","newTheme","use","_setLocales","make_model","auth","set","clear","remove","setToken","token","getToken","removeToken","login","clone","auth_token","logout","removeUser","register","getInvitation","invitations","acceptInvitiationWithNewUser","acceptInvitiationWithExistingUser","forgotPassword","changePasswordFromRecovery","changeEmail","cancelAccount","service","$config","templates","template","templateFn","publicRegisterEnabled","restrict","directive","$routeParams","link","$scope","$el","$attrs","form","onError","onSuccess","submit","Form","find","decodeURIComponent","loginFormType","preventDefault","validate","username","password","on","prerenderReady","off","onErrorSubmit","onSuccessSubmit","onlyOneErrorElement","trackEvent","_error_message","error","setErrors","success","$params","tokenInParams","loginForm","onErrorSubmitLogin","onErrorSubmitRegister","onSuccessSubmitLogin","onSuccessSubmitRegister","registerForm","submitLogin","submitRegister","invitation","dataLogin","project_slug","project_name","dataRegister","escape","$repo","$model","email_token","queryOne","cancel_token","TaigaMainDirective","$window","onresize","$broadcast","home","not-found","permission-denied","forgot-password","change-password","change-email","cancel-account","create-project","profile","user-profile","project-backlog","project-taskboard","project-kanban","project-issues","project-search","project-userstories-detail","project-tasks-detail","project-issues-detail","project-wiki","project-wiki-page","project-team","project-admin-home","project-admin-project-profile-details","project-admin-project-profile-default-values","project-admin-project-profile-modules","project-admin-project-profile-export","project-admin-project-profile-reports","project-admin-project-values-status","project-admin-project-values-points","project-admin-project-values-priorities","project-admin-project-values-severities","project-admin-project-values-triggers","project-admin-project-values-types","project-admin-project-values-custom-fields","project-admin-memberships","project-admin-roles","project-admin-third-parties-webhooks","project-admin-third-parties-github","project-admin-third-parties-gitlab","project-admin-third-parties-bitbucket","project-admin-contrib","user-settings-user-profile","user-settings-user-change-password","user-settings-user-avatar","user-settings-mail-notifications","$navurls","update","AnimationFrame","Capslock","CheckPermissionDirective","ClassPermissionDirective","DataPickerConfig","LimitLineLengthDirective","ProjectUrl","Qqueue","SelectedText","Template","ToggleCommentDirective","i18n","previousMonth","nextMonth","months","weekdays","weekdaysShort","isRTL","firstDay","parseInt","format","$document","getSelection","selection","createRange","render","permission","my_permissions","removeClass","addClass","tgCheckPermission","checkPermissions","tgClassPermissionWatchAction","unbindWatcher","className","negation","classes","add","animationFrame","performAnimation","tail","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","time","shift","slug","is_backlog_activated","is_kanban_activated","is_wiki_activated","is_issues_activated","maxColsPerLine","code","keyCode","index","lastPromise","qqueue","bindAdd","args","$templateCache","lodash","tmp","hideIcon","open","showIcon","warningIcon","$","fadeOut","currentTarget","append","fadeIn","toLowerCase","EventsProvider","EventsService","win","liveAnnouncementService1","rootScope","liveAnnouncementService","processMessage","subscriptions","connected","pendingMessages","missedHeartbeats","heartbeatInterval","WebSocket","info","loc","scheme","stopExistingConnection","protocol","ltrim","host","ws","addEventListener","onOpen","onMessage","onClose","removeEventListener","stopHeartBeatMessages","close","notifications","subscribe","show","desc","$digest","startHeartBeatMessages","heartbeatIntervalTime","maxMissedHeartbeats","setInterval","error1","Error","sendMessage","cmd","message","clearInterval","processHeartBeatPongMessage","serialize","msg","send","routingKey","subscription","routing_key","callback","unsubscribe","$get","$win","$conf","$rootScope","FeedbackDirective","$loading","feedbackService","openLightbox","submitButton","currentLoading","target","create","feedback","finish","focus","RelatedTaskAssignedToInlineEditionDirective","RelatedTaskCreateButtonDirective","RelatedTaskCreateFormDirective","RelatedTaskRowDirective","RelatedTasksDirective","$compile","$template","templateEdit","templateView","renderEdit","renderView","saveTask","task","subject","save","html","$modelValue","perms","modify_task","delete_task","select","askOnDelete","askResponse","$emit","ngModel","require","$tgmodel","newTask","assigned_to","createTask","default_task_status","newRelatedTaskFormOpen","us","$rs","loadTasks","tasks","list","usId","popoverService","$ctrl","autoSave","notAutoSave","updateRelatedTask","member","imgurl","photo","full_name_display","tgRelatedTaskAssignedToInlineEdition","unbind","userId","updatedRelatedTask","ResourcesService","initResources","initUrls","auth-register","by_username","users-password-recovery","users-change-password-from-recovery","users-change-password","users-change-email","users-cancel-account","user-stats","user-liked","user-voted","user-watched","user-contacts","permissions","notify-policies","user-storage","memberships","bulk-create-memberships","resolver","project-templates","project-modules","bulk-update-projects-order","project-like","project-unlike","project-watch","project-unwatch","userstory-statuses","points","task-statuses","issue-statuses","issue-types","priorities","severities","triggers","milestones","userstories","bulk-create-us","bulk-update-us-backlog-order","bulk-update-us-sprint-order","bulk-update-us-kanban-order","userstories-filters","userstory-upvote","userstory-downvote","userstory-watch","userstory-unwatch","bulk-create-tasks","bulk-update-task-taskboard-order","task-upvote","task-downvote","task-watch","task-unwatch","issues","bulk-create-issues","issues-filters","issue-upvote","issue-downvote","issue-watch","issue-unwatch","wiki","wiki-restore","wiki-links","history/us","history/issue","history/task","history/wiki","attachments/us","attachments/issue","attachments/task","attachments/wiki_page","custom-attributes/userstory","custom-attributes/issue","custom-attributes/task","custom-attributes-values/userstory","custom-attributes-values/issue","custom-attributes-values/task","webhooks","webhooks-test","webhooklogs","webhooklogs-resend","userstories-csv","tasks-csv","issues-csv","timeline-profile","timeline-user","timeline-project","exporter","importer","locales","applications","application-tokens","$urls","providers","toArray","SearchBoxDirective","SearchController","SearchDirective","scope1","repo","loadSearchData","sectionName","loadInitialData","projectName","projectDescription","searchTerm","t","searchResults","term","loadFilters","defered","loadProject","getBySlug","issueStatusById","issue_statuses","taskStatusById","task_statuses","severityById","triggerById","priorityById","usStatusById","us_statuses","loading","_loadSearchData","_promise","abort","$route","reload","$templatecache","$routeparams","linkTable","activeSectionName","applyAutoTab","getActiveSection","lastSearchResults","markSectionTabActive","renderFilterTabs","renderTableContent","tabsDom","maxVal","selectedSection","wikipages","oldElements","oldScope","children","$destroy","$new","parseHTML","activeSection","sectionData","searchText","AnalyticsService","doc","conf","initialized","accountId","pageEvent","trackRoutes","ignoreFirstPageLoad","injectAnalytics","ga","getUrl","trackPage","s","o","g","r","a","m","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","page","category","action","label","AttachmentDirective","AttachmentsController","AttachmentsDirective","confirm","objectId","uploadingAttachments","attachments","attachmentsCount","deprecatedAttachmentsCount","showDeprecated","loadAttachments","urlname","updateCounters","is_deprecated","_createAttachment","attachment","urlName","isCreatedRightNow","splice","fileName","errorMessage","createAttachments","promises","addUploadingAttachments","union","reorderAttachment","newIndex","oldIndex","order","updateAttachment","saveAttachments","saveAll","j","revert","removeAttachment","filterAttachments","$templates","$ctrls","showSizeInfo","tdom","sortable","items","handle","containment","dropOnEmpty","scroll","tolerance","placeholder","ui","attach","files","maxFileSize","maxFileSizeMsg","saveAttachment","edit","modifyPermission","created_date","isDeprecated","prop","match","tgAttachment","BindScope","jQuery","CompileHtmlDirective","attrs","tgCompileHtml","newValue","oldValue","contents","AssignedToDirective","BlockButtonDirective","CreatedByDisplayDirective","DateRangeDirective","DateSelectorDirective","DeleteButtonDirective","EditableDescriptionDirective","EditableSubjectDirective","ListItemAssignedtoDirective","ListItemIssueStatusDirective","ListItemPriorityDirective","ListItemSeverityDirective","ListItemTaskStatusDirective","ListItemTriggerDirective","ListItemTypeDirective","ListItemUsStatusDirective","SprintProgressBarDirective","TgMainTitleDirective","TgProgressBarDirective","WatchersDirective","renderRange","first","second","endDate","initDate","prettyDate","tgDateRange","valFirst","valSecond","datePickerConfigService","selectedDate","datePickerConfig","merge","field","onSelect","picker","setDate","Pikaday","renderProgress","percentage","visual_percentage","hasClass","css","tgSprintProgressbar","sprint","closedPoints","totalPoints","closed_points","total_points","round","owner","owner_extra_info","$qqueue","deleteWatcher","isEditable","renderWatchers","ref1","requiredPerm","watchers","$setViewValue","watcherId","watcherIds","pull","renderAssignedTo","issue","assignedTo","assignedToId","ask","instance","is_blocked","hide","onDeleteGoToUrl","onDeleteTitle","subtitle","click","$selectedText","noDescriptionMegEditMode","noDescriptionMegReadMode","is","href","scrollTop","offset","top","noDescriptionMsg","tgListitemUsStatus","tgListitemTaskStatus","tgListitemAssignedto","tgListitemIssueStatus","issueTypeById","domNode","color","tgListitemType","priority","tgListitemPriority","severity","tgListitemSeverity","tgListitemTrigger","trigger","el","tgProgressBar","$observe","i18nSectionName","ConfirmService","NOTIFICATION_MSG","light-error","lightboxService","lightboxSelector","ok","askChoice","choices","replacement","warning","choicesField","selected","stop","percent","body","selector","tsem","CustomAttributeValueDirective","CustomAttributesValuesController","CustomAttributesValuesDirective","DATE_TYPE","MULTILINE_TYPE","SELECT_TYPE","TEXT_TYPE","TYPE_CHOICES","customAttributes","customAttributesValues","loadCustomAttributesValues","getAttributeValue","attribute","attributeValue","attributes_values","updateAttributeValue","attributesValues","$storage","collapsedHash","collapsed","hash","requiredEditionPerm","setFocusAndSelectOnInputField","editable","isValid","tgCustomAttributeValue","EstimationsService","LbUsEstimationDirective","UsEstimationDirective","$tgEstimationsService","estimationProcess","onSelectedPointForRole","roleId","pointId","mainTemplate","calculateTotalPoints","calculateRoles","EstimationProcess","pointsTemplate","$el1","us1","project1","bindClickEvents","pointsById","notNullValues","values","v","k","acc","num","role","pointObj","stopPropagation","renderPointsSelector","siblings","popover","horizontalList","maxPointLength","pop","point","some","horizontal","closest","height","clientHeight","defaultFilter","momentFormat","momentFromNow","yesNoFilter","defaultValue","without_suffix","fromNow","HistoryController","HistoryDirective","IGNORED_FIELDS","userstories.userstory","tasks.task","issues.issue","loadHistory","history","changeModel","historyEntry","historyResult","len1","values_diff","description_diff","description_html","blocked_note_diff","blocked_note","blocked_note_html","comments","comment","deleteComment","activityId","undeleteComment","templateActivity","templateBase","templateBaseEntries","templateChangeAttachment","templateChangeDiff","templateChangeGeneric","templateChangeList","templateChangePoints","templateDeletedComment","countChanges","formatChange","getHumanizedFieldName","getPrettyDateFormat","renderActivity","renderAttachmentEntry","renderChange","renderChangeEntries","renderChangeEntry","renderChangesHelperText","renderComment","renderComments","renderCustomAttributesEntry","renderHistory","showAllActivity","showAllComments","humanizedFieldNames","content","is_closed","finish_date","milestone","user_story","client_requirement","team_requirement","is_iocaine","backlog_order","sprint_order","kanban_order","taskboard_order","us_order","change","isArray","changes","diff","filename","from","to","outerHTML","customAttrsChanges","added","removed","difference","ref2","delete_comment_date","delete_comment_user","deleteCommentDate","deleteCommentUser","comment_html","canRestoreComment","pk","avatar","userFullName","userProfileUrl","creationDate","created_at","changesText","mode","canDeleteComment","entries","totalEntries","showMore","totalComments","last","totalChanges","parents","toggleClass","ngmodel","ImportProjectButtonDirective","file","errorMsg","error_message","AssignedToLightboxDirective","AttachmentPreviewLightboxDirective","BlockLightboxDirective","BlockingMessageInputDirective","CreateBulkUserstoriesDirective","CreateEditUserstoryDirective","LightboxDirective","LightboxKeyboardNavigationService","LightboxService","WatchersLightboxDirective","docEl","lightboxContent","not","one","which","removeAttr","lightboxEl","dispatch","activeElement","prev","$tgrepo","block","unblock","finishCallback","watch","isNew","statusList","usStatusList","is_archived","broadcastEvent","keydown","statusId","bulk","bulkCreate","lightboxKeyboardNavigationService","closeLightbox","filterUsers","normalizeString","selectedItem","selectedUser","usersTemplate","string","normalizedString","toUpperCase","partial","searchingText","usersSearch","getFilteredUsers","_filterUsers","Loader","LoaderDirective","tgLoader","onStart","onEnd","autoClose","lastResponseDate","pageLoaded","requestCount","startLoadTime","minTime","force","endTime","timeoutValue","intervalAuto","auto","LoadingDirective","TgLoadingService","spinner","settings","removeClasses","classess","timeoutId","tgLoading","showLoading","RelatedTaskStatusDirective","UsStatusDirective","usStatusDom","usStatusDomParent","tgUsStatus","onUpdate","statuses","selectionTemplate","updateTaskStatus","taskStatusDom","taskStatusDomParent","tgRelatedTaskStatus","closePopover","isVisible","docViewBottom","docViewLeft","docViewRight","docViewTop","docViewWidth","elemBottom","elemLeft","elemRight","elemTop","elemWidth","display","visibility","left","ExceptionHandlerFactory","ravenConfig","Raven","install","cause","captureException","ColorizeTagsDirective","LbTagLineDirective","TagLineDirective","TagsDirective","formatter","parser","$formatters","$parsers","backlog","kanban","taskboard","srcTags","tgColorizeTagsType","sort","tag","tags_colors","tgColorizeTags","COMMA_KEY","ENTER_KEY","templateTags","addValue","deleteValue","hideSaveButton","removeInputLastCharacter","renderTags","resetInput","saveInputTag","showSaveButton","tagsColors","style","autocomplete","inputValue","positioningFunction","position","elements","menu","source","my","using","ESC_KEY","hideAddTagButton","hideAddTagButtonText","hideInput","renderInReadModeOnly","showAddTagButton","showAddTagButtonText","showInput","blur","MarkitupDirective","previewTemplate","addLine","cancelablePromise","closePreviewMode","markdownTitle","prepareUrlFormatting","preview","previewDomNode","renderMarkItUp","setCaretPosition","urlFormatting","class","markItUpDomNode","markdownDomNode","mdrender","markdown","textarea","caretPosition","scrollRelation","totalLines","createTextRange","move","selectionStart","setSelectionRange","scrollHeight","nline","cursorPosition","markItUp","indices","regex","exec","donotparse","endIndex","startIndex","heading","n","placeHolder","markdownSettings","nameSpace","onShiftEnter","keepDefault","openWith","onEnter","replaceWith","afterInsert","cursorLine","emptyListItem","lastLine","markdownCaretPositon","newLineContent","markupSet","closeWith","separator","beforeInsert","markItUpRemove","textcomplete","cache","searchProps","searchTypes","res","count","BacklogFiltersDirective","templateSelected","currentFiltersType","getFiltersType","initializeSelectedFilters","reloadUserstories","renderFilters","renderSelectedFilters","selectQFilter","selectedFilters","showCategories","showFilters","toggleFilterSelection","f","loadUserstories","generateFilters","currentFilters","CreateEditSprint","createSprint","getLastSprint","hasErrors","resetSprint","estimated_start","estimated_finish","newSprint","copy","setAttr","sprintsCounter","__all__","milestonesCounter","openSprints","sortedSprints","sprints","closed","estimatedFinish","estimatedStart","lastSprint","lastSprintNameDom","reset","editSprint","BacklogController","BacklogDirective","BurndownBacklogGraphDirective","TgBacklogProgressBarDirective","ToggleBurndownVisibility","UsPointsDirective","UsRolePointsSelectorDirective","params1","events","analytics","showTags","activeFilters","showGraphPlaceholder","initializeEventHandlers","getShowTags","loadProjectStats","loadSprints","loadClosedSprints","moveUs","unloadClosedSprints","initializeSubscription","routingKey1","routingKey2","toggleShowTags","storeShowTags","toggleActiveFilters","stats","defined_points","completedPercentage","total_milestones","closedSprints","totalClosedMilestones","user_stories","closedSprintsById","totalMilestones","totalOpenMilestones","reverse","sprintsById","restoreFilters","selectedStatuses","selectedTags","oldSelectedTags","oldSelectedStatuses","filtersQ","filtersQOld","filterGrp","resetFilters","httpParams","getUrlFilters","storeQueryParams","listUnassigned","setSearchDataFilters","loadBacklog","closedMilestones","total_closed_milestones","prepareBulkUpdateData","uses","us_id","resortUserStories","isModified","usList","newUsIndex","newSprintId","len2","movedFromClosedSprint","movedToClosedSprint","oldSprintId","Array","bulkUpdateBacklogOrder","bulkUpdateSprintOrder","console","len3","isFilterSelected","searchdata","urlfilters","results1","pick","filtersData","choicesFiltersFormat","tagsFilterFormat","byIdObject","markSelectedFilters","isSelected","omit","updateUserStoryStatus","editUserStory","$event","getByRef","deleteUserStory","without","addNewUs","default_us_status","addNewSprint","doomLineTemplate","linkDoomLine","linkFilters","linkToolbar","showHideFilter","showHideTags","addDoomLineDom","getUsItems","reloadDoomLine","removeDoomlineDom","current_sum","domElement","assigned_points","before","rowElements","checkSelected","lastChecked","moveToCurrentSprint","shiftPressed","selectedUss","extraPoints","totalExtraPoints","ussCurrent","moveToCurrentSprintDom","selectedUsDom","shiftKey","current","nextAll","prevAll","nextUntil","prevUntil","elm","ussDom","ussToMove","itemScope","hideText","showText","sidebar","filtersSearch","disableSelection","numberOfRoles","roleName","rolScope","$tgTemplate","rolesTemplate","bindClickElements","filteringRoleId","renderRolesSelector","selectedRoleId","updatingSelectedRoleId","tgBacklogUsPoints","popRolesDom","firstLoad","toggleGraph","isBurndownGraphCollapsed","redrawChart","dataToDraw","client_increment_line","colors","evolution_line","milestonesRange","optimal_line","options","team_increment_line","zero_line","ml","zip","fillColor","optimal","evolution","grid","borderWidth","right","bottom","borderColor","hoverable","xaxis","ticks","axisLabel","axisLabelUseCanvas","axisLabelFontSizePixels","axisLabelFontFamily","axisLabelPadding","tickFormatter","axis","yaxis","series","shadowSize","fill","radius","lineWidth","tooltip","tooltipOpts","xval","yval","flotItem","seriesIndex","sprintName","abs","empty","plot","adjustPercentaje","projectPointsPercentaje","closedPointsPercentaje","adjusted","tgBacklogProgressBar","definedPoints","BacklogEmptySortableDirective","BacklogSortableDirective","SprintSortableDirective","deleteElement","$tgConfirm","getUsIndex","filterError","cancel","connectWith","disableHorizontalScroll","itemIndex","itemUs","forcePlaceholderSize","BacklogSprintDirective","BacklogSprintHeaderDirective","ToggleExcludeClosedSprintsVisualization","slideOptions","sprintTableMinHeight","toggleSprint","duration","easing","sprintArrow","sprintTable","tgBacklogSprint","slideToggle","compiledTemplate","estimatedDateRange","taskboardUrl","templateScope","assign","excludeClosedSprints","loadingElm","after","SprintGraphDirective","days","day","unshift","d","optimal_points","open_points","tickSize","daysNames","formattedDate","roundedValue","CreateBulkTasksDirective","CreateEditTaskDirective","sprintId","TaskboardController","TaskboardDirective","TaskboardSquishColumnDirective","TaskboardTaskDirective","TaskboardUserDirective","rs1","_setMeta","startDate","completedPoints","completedPointsSum","totalPointsSum","openTasks","totalTasks","total_tasks","loadTaskboard","taskMove","refreshTagsColors","loadSprintStats","loadSprint","pointsList","roleById","taskStatusList","remainingPointsSum","remainingTasks","completed_points","completed_tasks","usTasks","isPlaceholder","sslug","refreshTasksOrder","resortTasks","bulkUpdateTaskTaskboardOrder","task_id","addNewTask","editTaskAssignedTo","tableBodyDom","tableHeaderDom","scrollLeft","editingTask","avatarWidth","maxColumnWidth","getCeilWidth","recalculateStatusColumnWidth","recalculateTaskboardWidth","refreshTaskboardTableWidth","setStatusColumnWidth","statusesFolded","getStatusColumnModes","usFolded","getUsRowModes","foldStatus","storeStatusColumnModes","foldUs","storeUsRowModes","tasksMatrixSize","sqrt","column","columnWidths","columns","totalWidth","outerWidth","total","statusFoldedWidth","forEach","clickable","username_label","TaskboardSortableDirective","itemEl","newParentScope","oldParentScope","itemTask","newStatusId","newUsId","oldStatusId","oldUsId","parentEl","st","KanbanArchivedStatusHeaderDirective","KanbanArchivedStatusIntroDirective","KanbanController","KanbanDirective","KanbanSquishColumnDirective","KanbanUserDirective","KanbanUserstoryDirective","KanbanWipLimitDirective","defaultViewMode","viewModes","statusViewModes","onAssignedToChanged","loadUserStoriesForStatus","hideUserStoriesForStatus","changeUsAssignedTo","userid","status__is_archived","listAll","usByStatus","us_archived","loadKanban","generateStatusViewModes","storedStatusViewModes","getStatusViewModes","storeStatusViewModes","updateStatusViewMode","newViewMode","isMaximized","isMinimized","itemsToSave","bulkUpdateKanbanOrder","hideArchivedText","showArchivedText","hidden","tgKanbanArchivedStatusHeader","userStories","hiddenUserStoriexText","updateIntroText","tgKanbanArchivedStatusIntro","isArchived","userStoriesLoaded","editingUserStory","getTemplateUrl","updateTableWidth","folds","redrawWipLimit","tgKanbanWipLimit","wip_limit","wtid","tgKanbanUserAvatar","KanbanSortableDirective","IssueDetailController","IssuePriorityButtonDirective","IssueSeverityButtonDirective","IssueStatusButtonDirective","IssueStatusDisplayDirective","IssueTriggerButtonDirective","IssueTypeButtonDirective","PromoteIssueToUsButtonDirective","issueRef","issueref","initializeOnDeleteGoToUrl","ref3","ref4","issueSubject","issueStatus","statusById","issueType","typeById","issueSeverity","issueTrigger","issuePriority","issueDescription","loadIssue","issue_types","typeList","severityList","triggerList","priorityList","issueId","commentModel","neighbors","previous","previousUrl","onUpvote","upvote","onDownvote","downvote","onWatch","onUnwatch","unwatch","typees","severityes","triggeres","priorityes","generated_from_issue","CreateBulkIssuesDirective","CreateIssueDirective","default_issue_status","default_issue_type","default_priority","default_severity","default_trigger","IssueAssignedToInlineEditionDirective","IssueStatusInlineEditionDirective","IssueTriggerInlineEditionDirective","IssuesController","IssuesDirective","IssuesFiltersDirective","loadIssues","getFilters","storeFilters","issueStatusList","issueTypes","getUrlFilter","loadMyFilters","getMyFilters","removeNotExistingFiltersFromUrl","currentSearch","existingValues","filterName","filterValue","splittedValues","intersection","myFilters","types","createdBy","usersFiltersFormat","unknownOption","reformatedUsers","unknownItem","full_name","u","owners","loadIssuesRequests","urlFilters","models","paginatedBy","saveCurrentFiltersTo","newFilter","storeMyFilters","deleteMyFilter","addNewIssue","addIssuesInBulk","linkOrdering","linkPagination","$pagEl","afterCurrent","atBegin","atEnd","beforeCurrent","getNumPages","renderPagination","numPages","cpage","pages","showPrevious","showNext","pagenum","colHeadElement","currentOrder","icon","finalOrder","newOrder","reloadIssues","unwatchIssues","filterId","customFilterName","loadPromise","currentfilterstype","updateIssueStatus","issueStatusDom","issueStatusDomParent","tgIssueStatusInlineEdition","updateIssueTrigger","issueTriggerDom","issueTriggerDomParent","tgIssueTriggerInlineEdition","updateIssue","tgIssueAssignedToInlineEdition","updatedIssue","UsClientRequirementButtonDirective","UsStatusButtonDirective","UsStatusDisplayDirective","UsTasksProgressDisplayDirective","UsTeamRequirementButtonDirective","UserStoryDetailController","usRef","usref","closedTasks","progressPercentage","userStoryRef","userStorySubject","userStoryStatus","userStoryPoints","userStoryDescription","userStoryClosedTasks","userStoryTotalTasks","userStoryProgressPercentage","loadUs","kanbanStaus","noMilestone","order_by","progress","totalClosedTasks","canEdit","isRequired","TaskDetailController","TaskIsIocaineButtonDirective","TaskStatusButtonDirective","TaskStatusDisplayDirective","taskRef","taskref","taskSubject","taskStatus","taskDescription","loadTask","taskId","loadUserStory","isIocaine","LeaveProjectDirective","TeamController","TeamFiltersDirective","TeamMemberCurrentUserDirective","TeamMemberStatsDirective","TeamMembersDirective","membersFilter","setRole","filtersRole","loadMembers","totals","currentUser","issuesEnabled","tasksEnabled","wikiEnabled","loadMemberStats","memberStats","vals","statsKey","sum","_processStats","_processStat","stat","singleStat","leave","confirm_leave_project_text","leave_project_text","projectid","EditableWikiContentDirective","WikiDetailController","WikiSummaryDirective","projectSlug","wikiSlug","wikiTitle","wikiPageName","wikiPageContent","totalEditions","editions","lastModifiedDate","modified_date","loadWiki","wikiId","loadWikiLinks","listLinks","wikiLinks","selectedWikiLink","last_modifier","imgUrl","wikiPage","cancelEdition","disableEdition","getSelectedText","switchToEditMode","switchToReadMode","button","WikiNavDirective","addWikiLinkPermission","deleteWikiLinkPermission","linkId","linkSlug","newLink","CreateMembersDirective","MAX_MEMBERSHIP_FIELDSETS","extraTextTemplate","createFieldSet","resetForm","roleList","fieldSet","prepend","lastActionButton","newFieldSet","invitation_extra_text","memberWrappers","destroy","mw","memberWrapper","role_id","bulkCreateMemberships","MembershipsController","MembershipsDirective","MembershipsRowActionsDirective","MembershipsRowAdminCheckboxDirective","MembershipsRowAvatarDirective","MembershipsRowRoleSelectorDirective","i_am_owner","httpFilters","membership","is_user_active","addNewMembers","pending","user_email","tgMembershipsRowAvatar","inputId","tgMembershipsRowAdminCheckbox","is_owner","selectedRole","tgMembershipsRowRoleSelector","newRole","activedTemplate","pendingTemplate","tgMembershipsRowActions","resendInvitation","defaultMsg","AdminNavigationDirective","tgAdminNavigation","CsvExporterController","CsvExporterIssuesController","CsvExporterTasksController","CsvExporterUserstoriesController","CsvIssueDirective","CsvTaskDirective","CsvUsDirective","ProjectDefaultValuesDirective","ProjectExportDirective","ProjectModulesDirective","ProjectProfileController","ProjectProfileDirective","prioritiesList","severitiesList","triggersList","issueTypesList","openDeleteLightbox","newUrl","fetchProject","loadProjects","isVideoconferenceActivated","videoconferences","videoconferences_extra_data","asyn_message","buttonsEl","dump_ready_text","hideButtons","hideResult","hideSpinner","loading_msg","loading_title","resultEl","resultMessageEl","resultTitleEl","setAsyncMessage","setAsyncTitle","setLoadingMessage","setLoadingTitle","setSyncMessage","setSyncTitle","showButtons","showErrorMode","showExportResultAsyncMode","showExportResultSyncMode","showLoadingMode","showResult","showSpinner","spinnerEl","syn_message","dumpUrl","_generateUuid","setCsvUuid","csvUrl","resolveAbsolute","csvUuid","uuid","regenerateUuid","sectionTitle","ColorSelectionDirective","ProjectCustomAttributesController","ProjectCustomAttributesDirective","ProjectValuesController","ProjectValuesDirective","ProjectValuesSectionController","moveValue","loadValues","resource","listValues","maxValueOrder","itemValue","linkDragAndDrop","linkValue","goToBottomList","initializeNewValue","initializeTextTranslations","objName","saveNewValue","saveValue","valueType","objname","addNewElementText","table","formEl","row","editionRow","option","onSucces","moveTo","moveCustomAttributes","deleteCustomAttribute","saveCustomAttribute","createCustomAttribute","loadCustomAttributes","maxOrder","attrValues","attrModel","idx","cancelCreate","cancelUpdate","hideAddButton","hideCancelButton","hideCreateForm","hideEditForm","resetNewAttr","revertChangesInCustomAttribute","showAddButton","showCancelButton","showCreateForm","showEditForm","sortableEl","itemAttr","newAttr","EditRoleDirective","NewRoleDirective","RolePermissionsDirective","RolesController","RolesDirective","_disableComputable","_enableComputable","anyComputableRole","computable","loadRoles","public_permission","external_user","public_permissions","askOnError","askOnSuccess","toggleComputable","toggleView","toggle","DEFAULT_PERMISSIONS","insertPosition","baseTemplate","categoryTemplate","resumeTemplate","generateCategoriesFromRole","renderCategory","renderPermissions","renderResume","categories","isPermissionEditable","issuePermissions","milestonePermissions","setActivePermissions","setActivePermissionsPerCategory","taskPermissions","userStoryPermissions","wikiPermissions","active","is_private","cat","activePermissions","getActivePermissions","categoryId","anon_permissions","BitbucketController","BitbucketWebhooksDirective","GithubController","GithubWebhooksDirective","GitlabController","GitlabWebhooksDirective","NewWebhookDirective","SelectInputText","ValidOriginIpsDirective","WebhookDirective","WebhooksController","loadWebhooks","openHistory","showEditMode","showVisualizationMode","updateLogs","updateShowHideHistoryText","webhook","tgWebhook","validStatus","prettySentHeaders","pairs","request_headers","arg","header","prettySentData","request_data","created","logs_counter","logs","historyElement","textElement","test","resend","addWebhookDOMNode","formDOMNode","loadModules","github","gitlab","bitbucket","saveAttribute","$ngModel","CreateProject","DeleteProjectDirective","$projectUrl","$cacheFactory","removeAll","error_field","error_step","selectors","creation_template","head","step","fields","projectToDelete","BindHtmlDirective","BindOnceAltDirective","BindOnceBindDirective","BindOnceHrefDirective","BindOnceHtmlDirective","BindOnceRefDirective","BindOnceSrcDirective","BindOnceTitleDirective","BindTitleDirective","tgBoBind","tgBoHtml","tgBoRef","tgBoSrc","tgBoHref","tgBoAlt","tgBoTitle","tgTitleHtml","tgBindHtml","ConfigurationService","has","ContribController","currentPlugin","FiltersStorageService","HttpService","cacheFactory","locationFactory","lastRoute","Model","ModelService","dataTypes","_attrs","_name","_dataTypes","setAttrs","_modifiedAttrs","_isModified","applyCasts","attrName","castMethod","castName","casts","getIdAttrName","getName","getter","self","setter","substr","enumerable","configurable","isAttributeModified","markSaved","desSerialize","sdata","ddata","$http","$gmUrls","$gmStorage","cls","int","float","NavigationUrlsDirective","NavigationUrlsService","formatUrl","replacer","bindOnceP","parseNav","param","tgNav","fullUrl","getURLParams","getURLParamsStr","tgNavGetParams","metaKey","ctrlKey","RepositoryService","model1","resolveUrlForModel","idAttrName","resolveUrlForAttributeModel","extraParams","_data","_status","refresh","queryMany","httpOptions","enablePagination","queryOneAttribute","queryOneRaw","queryPaginated","queryOnePaginatedRaw","wikipage","StorageService","_default","serializedValue","getItem","setItem","removeItem","UrlsService","fmt","mainUrl","rtrim","resourceProvider","object_id","uploadComplete","uploadFailed","uploadProgress","evt","progressMessage","loaded","progressPercent","responseText","FormData","XMLHttpRequest","upload","setRequestHeader","_get","userstory","_list","filtersHashSuffix","hashSuffix","myFiltersHashSuffix","getQueryParams","listInAllProjects","project_id","bulk_issues","ns","innerPromise","hashSuffixStatusColumnModes","hashSuffixStatusViewModes","listByUser","bulk_memberships","notifyPolicies","listByMember","memberId","bulkUpdateOrder","bulkData","regenerate_userstories_csv_uuid","regenerate_issues_csv_uuid","regenerate_tasks_csv_uuid","statusUpdater","complete","failed","fileSize","uploadedSize","totalSize","deferredAbort","get_all","noop","hashSuffixUsRowModes","userStoryId","sprint_id","bulk_tasks","changeAvatar","transformRequest","identity","removeAvatar","changePassword","currentPassword","newPassword","current_password","userSettings","contacts","status_id","bulk_stories","webhookId","webhooklogId","UserChangePasswordController","UserChangePasswordDirective","ctrl","newPassword1","newPassword2","DeleteUserDirective","TaigaAvatarModelDirective","UserAvatarDirective","UserProfileDirective","UserSettingsController","getLan","getTheme","availableThemes","avatarAttachment","$parse","modelSetter","tgAvatarModel","UserSettingsNavigationDirective","tgUserSettingsNavigation","UserNotificationsController","UserNotificationsDirective","UserNotificationsListDirective","policy","policyIndex","prev_level","notify_level","JoyRideDirective","joyRideService","initJoyrRide","intro","unsuscribe","introJs","oncomplete","onexit","disableJoyRide","setOptions","exitOnEsc","exitOnOverlayClick","showStepNumbers","nextLabel","prevLabel","skipLabel","doneLabel","disableInteraction","setOption","loadJoyRideConfig","exit","JoyRideService","checkPermissionsService","getConfig","dashboard","steps","check","joyRide","joyRides","LiveAnnouncementDirective","defineProperties","LiveAnnouncementService","ProjectMenuController","lightboxFactory","Map","_getActiveSection","_setVideoConference","_setMenuPermissions","videoconferenceUrl","_videoConferenceUrl","indexBacklog","indexKanban","oldSectionName","sectionsBreadcrumb","baseUrl","ProjectMenuDirective","projectChange","TermsOfServiceAndPrivacyPolicyNoticeDirective","privacyPolicyUrl","termsOfServiceUrl","VoteButtonController","isMouseOver","showTextWhenMouseIsOver","showTextWhenMouseIsLeave","toggleVote","is_voter","_downvote","_upvote","VoteButtonDirective","bindToController","WatchButtonController","toggleWatch","is_watcher","_unwatch","_watch","WatchButtonDirective","ExternalAppController","routeParams","externalAppsService","xhrError","loginUrl","createApplicationToken","_getApplicationToken","_redirect","_applicationId","application","_state","state","_user","_application","loginWithAnotherUserUrl","applicationToken","getApplicationToken","back","authorizeApplicationToken","ExternalAppsService","applicationId","externalapps","FeedbackService","sendFeedback","DutyDirective","navurls","vm","duty","getDutyType","HomeService","projectsService","_attachProjectInfoToWorkInProgress","workInProgress","projectsById","_attachProjectInfoToDuty","_duties","watching","objType","getWorkInProgress","assignedIssuesPromise","assignedTasksPromise","assignedUserStoriesPromise","params_us","projectsPromise","watchingIssuesPromise","watchingTasksPromise","watchingUserStoriesPromise","getProjectsByUserId","toJS","p","status__is_closed","HomeProjectListDirective","newProject","WorkingOnController","homeService","_setAssignedTo","elem","_setWatching","WorkingOnDirective","DropdownProjectListDirective","DropdownUserDirective","authService","configService","locationService","navUrlsService","isFeedbackEnabled","NavigationBarDirective","isEnabledHeader","NavigationBarService","enabledHeader","ProfileBarController","userService","loadStats","getStats","ProfileBarDirective","isCurrentUser","ProfileContactsController","loadContacts","getContacts","ProfileContactsDirective","FavItemDirective","itemType","FavsBaseController","ProfileLikedController","ProfileVotedController","ProfileWatchedController","_init","enableFilterByAll","enableFilterByProjects","enableFilterByUserStories","enableFilterByTasks","enableFilterByIssues","enableFilterByTextQuery","_resetList","List","scrollDisabled","_page","_enableLoadingSpinner","isLoading","_disableLoadingSpinner","_enableScroll","_disableScroll","_checkIfHasMorePages","hasNext","_checkIfHasNoResults","hasNoResults","loadItems","_getItems","filterByTextQuery","showAll","showProjectsOnly","showUserStoriesOnly","showTasksOnly","showIssuesOnly","getLiked","getVoted","getWatched","ProfileLikedDirective","ProfileVotedDirective","ProfileWatchedDirective","ProfileHints","hintKey","HINTS","hint","linkText","ProfileProjectsController","attachUserContactsToProjects","ProfileProjectsDirective","ProfileTabDirective","transclude","tab","tabIcon","tabActive","tabDisabled","addTab","ProfileTabsController","tabs","toggleTab","ProfileTabsDirective","ProfileController","getUserByUserName","notFound","userUsername","LikeProjectButtonController","likeButtonService","toggleLike","_unlike","_like","like","unlike","LikeProjectButtonDirective","LikeProjectButtonService","_getProjectIndex","findIndex","_updateProjects","isFan","projectIndex","totalFans","is_fan","total_fans","setProjects","_updateCurrentProject","setProject","likeProject","unlikeProject","SortProjectsDirective","opacity","sortData","sorted_project_ids","bulkUpdateProjectsOrder","WatchProjectButtonController","watchButtonService","showWatchOptions","toggleWatcherOptions","closeWatcherOptions","notifyLevel","WatchProjectButtonDirective","WatchProjectButtonService","isWatcher","totalWatchers","total_watchers","watchProject","unwatchProject","ProjectsListingController","ProjectController","activeMembers","setfn","metas","ProjectsService","projectUrl","getProjectBySlug","_decorate","getProjectStats","paginate","colorized_tags","Resource","urlsService","x-disable-pagination","pagination","paginateResponseService","getTimeline","only_relevant","x-lazy-pagination","Resources","services","serviceFn","serviceName","serviceProperty","warm","getUserStorage","setUserStorage","createUserStorage","getUserByUsername","getProfileTimeline","getUserTimeline","AppMetaService","_set","meta","setTitle","setDescription","setTwitterMetas","origin","setOpenGraphMetas","listener","_listener","$watchCollection","ChekcPermissionsService","CurrentUserService","storageService","_projects","_projectsById","_joyride","_loadUserInfo","LightboxFactory","compile","PaginateResponse","paginateResponse","ProjectService","_project","_section","_sectionsBreadcrumb","_activeMembers","ScopeEvent","scopes","_searchDuplicatedScopes","$id","_create","duplicatedScopeName","_tgEmitter","EventEmitter2","removeAllListeners","emitter","ThemeService","themeName","stylesheetEl","UserService","pageNumber","objectType","textQuery","contactsFiltered","contact","contactId","permissionDenied","UserTimelineAttachmentDirective","isImage","validFileExtensions","extension","is_image","templateHtml","UserTimelineItemTitle","sce","_fieldTranslationKey","_params","timeline","title_attr","getIn","_getLink","_getUsernameSpan","field_name","new_value","sprint_name","us_name","event_us","_getTimelineObj","_getDetailObjUrl","obj_name","role_name","keySeq","_translateTitleParams","parent_userstory","_getParams","timeline_type","translate_params","getTitle","paramsKeys","translation","UserTimelineType","timelineType","hasIn","getType","UserTimelineItemDirective","UserTimelinePaginationSequence","generate","getContent","minItems","fetch","UserTimelineController","userTimelineService","timelineList","getProjectTimeline","loadTimeline","UserTimelineDirective","UserTimelineService","userTimelinePaginationSequenceService","userTimelineItemType","userTimelineItemTitle","_valid_fields","_invalid","fieldKey","value_diff","_isInValidTimeline","invalid","_parseEventType","event_type","_getTimelineObject","_attachExtraInfoToTimelineEntry","_parseTimeline","newdata","newItem","blocked","moveInBacklog","setIn","deleteIn","_addEntyAttributes","filterNot"],"mappings":"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","file":"app.js","sourceRoot":"/source/","sourcesContent":["\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app.coffee\n */\n\n(function() {\n  var configure, i18nInit, init, module, modules, pluginsWithModule, taiga;\n\n  this.taiga = taiga = {};\n\n  this.taigaContribPlugins = this.taigaContribPlugins || window.taigaContribPlugins || [];\n\n  taiga.generateHash = function(components) {\n    if (components == null) {\n      components = [];\n    }\n    components = _.map(components, function(x) {\n      return JSON.stringify(x);\n    });\n    return hex_sha1(components.join(\":\"));\n  };\n\n  taiga.generateUniqueSessionIdentifier = function() {\n    var date, randomNumber;\n    date = (new Date()).getTime();\n    randomNumber = Math.floor(Math.random() * 0x9000000);\n    return taiga.generateHash([date, randomNumber]);\n  };\n\n  taiga.sessionId = taiga.generateUniqueSessionIdentifier();\n\n  configure = function($routeProvider, $locationProvider, $httpProvider, $provide, $tgEventsProvider, $compileProvider, $translateProvider, $translatePartialLoaderProvider, $animateProvider) {\n    var authHttpIntercept, decorators, defaultHeaders, loaderIntercept, originalWhen, preferedLangCode, userInfo, versionCheckHttpIntercept;\n    $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);\n    originalWhen = $routeProvider.when;\n    $routeProvider.when = function(path, route) {\n      route.resolve || (route.resolve = {});\n      angular.extend(route.resolve, {\n        languageLoad: [\n          \"$q\", \"$translate\", function($q, $translate) {\n            var deferred;\n            deferred = $q.defer();\n            $translate().then(function() {\n              return deferred.resolve();\n            });\n            return deferred.promise;\n          }\n        ]\n      });\n      return originalWhen.call($routeProvider, path, route);\n    };\n    $routeProvider.when(\"/\", {\n      templateUrl: \"home/home.html\",\n      access: {\n        requiresLogin: true\n      },\n      loader: true,\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/projects/\", {\n      templateUrl: \"projects/listing/projects-listing.html\",\n      access: {\n        requiresLogin: true\n      },\n      title: \"PROJECTS.PAGE_TITLE\",\n      description: \"PROJECTS.PAGE_DESCRIPTION\",\n      loader: true,\n      controller: \"ProjectsListing\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/\", {\n      templateUrl: \"projects/project/project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\",\n      section: \"project-timeline\"\n    });\n    $routeProvider.when(\"/project/:pslug/search\", {\n      templateUrl: \"search/search.html\",\n      reloadOnSearch: false,\n      section: \"search\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/backlog\", {\n      templateUrl: \"backlog/backlog.html\",\n      loader: true,\n      section: \"backlog\",\n      joyride: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/kanban\", {\n      templateUrl: \"kanban/kanban.html\",\n      loader: true,\n      section: \"kanban\",\n      joyride: \"kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/taskboard/:sslug\", {\n      templateUrl: \"taskboard/taskboard.html\",\n      loader: true,\n      section: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/us/:usref\", {\n      templateUrl: \"us/us-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/task/:taskref\", {\n      templateUrl: \"task/task-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki\", {\n      redirectTo: function(params) {\n        return \"/project/\" + params.pslug + \"/wiki/home\";\n      }\n    });\n    $routeProvider.when(\"/project/:pslug/wiki/:slug\", {\n      templateUrl: \"wiki/wiki.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/team\", {\n      templateUrl: \"team/team.html\",\n      loader: true,\n      section: \"team\"\n    });\n    $routeProvider.when(\"/project/:pslug/issues\", {\n      templateUrl: \"issue/issues.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/issue/:issueref\", {\n      templateUrl: \"issue/issues-detail.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/details\", {\n      templateUrl: \"admin/admin-project-profile.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/default-values\", {\n      templateUrl: \"admin/admin-project-default-values.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/modules\", {\n      templateUrl: \"admin/admin-project-modules.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/export\", {\n      templateUrl: \"admin/admin-project-export.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/reports\", {\n      templateUrl: \"admin/admin-project-reports.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/status\", {\n      templateUrl: \"admin/admin-project-values-status.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/points\", {\n      templateUrl: \"admin/admin-project-values-points.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/priorities\", {\n      templateUrl: \"admin/admin-project-values-priorities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/severities\", {\n      templateUrl: \"admin/admin-project-values-severities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/triggers\", {\n      templateUrl: \"admin/admin-project-values-triggers.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/types\", {\n      templateUrl: \"admin/admin-project-values-types.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/custom-fields\", {\n      templateUrl: \"admin/admin-project-values-custom-fields.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/memberships\", {\n      templateUrl: \"admin/admin-memberships.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/roles\", {\n      templateUrl: \"admin/admin-roles.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/webhooks\", {\n      templateUrl: \"admin/admin-third-parties-webhooks.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/github\", {\n      templateUrl: \"admin/admin-third-parties-github.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gitlab\", {\n      templateUrl: \"admin/admin-third-parties-gitlab.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/bitbucket\", {\n      templateUrl: \"admin/admin-third-parties-bitbucket.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/contrib/:plugin\", {\n      templateUrl: \"contrib/main.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-profile\", {\n      templateUrl: \"user/user-profile.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-change-password\", {\n      templateUrl: \"user/user-change-password.html\"\n    });\n    $routeProvider.when(\"/user-settings/mail-notifications\", {\n      templateUrl: \"user/mail-notifications.html\"\n    });\n    $routeProvider.when(\"/change-email/:email_token\", {\n      templateUrl: \"user/change-email.html\"\n    });\n    $routeProvider.when(\"/cancel-account/:cancel_token\", {\n      templateUrl: \"user/cancel-account.html\"\n    });\n    $routeProvider.when(\"/profile\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      access: {\n        requiresLogin: true\n      },\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/profile/:slug\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/login\", {\n      templateUrl: \"auth/login.html\",\n      title: \"LOGIN.PAGE_TITLE\",\n      description: \"LOGIN.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/register\", {\n      templateUrl: \"auth/register.html\",\n      title: \"REGISTER.PAGE_TITLE\",\n      description: \"REGISTER.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/forgot-password\", {\n      templateUrl: \"auth/forgot-password.html\",\n      title: \"FORGOT_PASSWORD.PAGE_TITLE\",\n      description: \"FORGOT_PASSWORD.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/change-password/:token\", {\n      templateUrl: \"auth/change-password-from-recovery.html\",\n      title: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      description: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/invitation/:token\", {\n      templateUrl: \"auth/invitation.html\",\n      title: \"INVITATION.PAGE_TITLE\",\n      description: \"INVITATION.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/external-apps\", {\n      templateUrl: \"external-apps/external-app.html\",\n      title: \"EXTERNAL_APP.PAGE_TITLE\",\n      description: \"EXTERNAL_APP.PAGE_DESCRIPTION\",\n      controller: \"ExternalApp\",\n      controllerAs: \"vm\",\n      disableHeader: true,\n      mobileViewport: true\n    });\n    $routeProvider.when(\"/error\", {\n      templateUrl: \"error/error.html\"\n    });\n    $routeProvider.when(\"/not-found\", {\n      templateUrl: \"error/not-found.html\"\n    });\n    $routeProvider.when(\"/permission-denied\", {\n      templateUrl: \"error/permission-denied.html\"\n    });\n    $routeProvider.otherwise({\n      redirectTo: \"/not-found\"\n    });\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n    defaultHeaders = {\n      \"Content-Type\": \"application/json\",\n      \"Accept-Language\": window.taigaConfig.defaultLanguage || \"en\",\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.defaults.headers[\"delete\"] = defaultHeaders;\n    $httpProvider.defaults.headers.patch = defaultHeaders;\n    $httpProvider.defaults.headers.post = defaultHeaders;\n    $httpProvider.defaults.headers.put = defaultHeaders;\n    $httpProvider.defaults.headers.get = {\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.useApplyAsync(true);\n    $tgEventsProvider.setSessionId(taiga.sessionId);\n    authHttpIntercept = function($q, $location, $navUrls, $lightboxService) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var nextUrl;\n        if (response.status === 0 || (response.status === -1 && !response.config.cancelable)) {\n          $lightboxService.closeAll();\n          $location.path($navUrls.resolve(\"error\"));\n          $location.replace();\n        } else if (response.status === 401 && $location.url().indexOf('/login') === -1) {\n          nextUrl = encodeURIComponent($location.url());\n          $location.url($navUrls.resolve(\"login\")).search(\"next=\" + nextUrl);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"authHttpIntercept\", [\"$q\", \"$location\", \"$tgNavUrls\", \"lightboxService\", authHttpIntercept]);\n    $httpProvider.interceptors.push(\"authHttpIntercept\");\n    loaderIntercept = function($q, loaderService) {\n      return {\n        request: function(config) {\n          loaderService.logRequest();\n          return config;\n        },\n        requestError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        responseError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        response: function(response) {\n          loaderService.logResponse();\n          return response;\n        }\n      };\n    };\n    $provide.factory(\"loaderIntercept\", [\"$q\", \"tgLoader\", loaderIntercept]);\n    $httpProvider.interceptors.push(\"loaderIntercept\");\n    versionCheckHttpIntercept = function($q) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var $injector;\n        if (response.status === 400 && response.data.version) {\n          $injector = angular.element(\"body\").injector();\n          $injector.invoke([\n            \"$tgConfirm\", \"$translate\", (function(_this) {\n              return function($confirm, $translate) {\n                var versionErrorMsg;\n                versionErrorMsg = $translate.instant(\"ERROR.VERSION_ERROR\");\n                return $confirm.notify(\"error\", versionErrorMsg, null, 10000);\n              };\n            })(this)\n          ]);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"versionCheckHttpIntercept\", [\"$q\", versionCheckHttpIntercept]);\n    $httpProvider.interceptors.push(\"versionCheckHttpIntercept\");\n    window.checksley.updateValidators({\n      linewidth: function(val, width) {\n        var lines, valid;\n        lines = taiga.nl2br(val).split(\"<br />\");\n        valid = _.every(lines, function(line) {\n          return line.length < width;\n        });\n        return valid;\n      }\n    });\n    $compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo || false);\n    if (localStorage.userInfo) {\n      userInfo = JSON.parse(localStorage.userInfo);\n    }\n    preferedLangCode = (userInfo != null ? userInfo.lang : void 0) || window.taigaConfig.defaultLanguage || \"en\";\n    $translatePartialLoaderProvider.addPart('taiga');\n    $translateProvider.useLoader('$translatePartialLoader', {\n      urlTemplate: '/' + window._version + '/locales/{part}/locale-{lang}.json'\n    }).useSanitizeValueStrategy('escapeParameters').addInterpolation('$translateMessageFormatInterpolation').preferredLanguage(preferedLangCode);\n    $translateProvider.fallbackLanguage(preferedLangCode);\n    decorators = window.getDecorators();\n    return _.each(decorators, function(decorator) {\n      return $provide.decorator(decorator.provider, decorator.decorator);\n    });\n  };\n\n  i18nInit = function(lang, $translate) {\n    var messages;\n    moment.locale(lang);\n    messages = {\n      defaultMessage: $translate.instant(\"COMMON.FORM_ERRORS.DEFAULT_MESSAGE\"),\n      type: {\n        email: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_EMAIL\"),\n        url: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URL\"),\n        urlstrict: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URLSTRICT\"),\n        number: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_NUMBER\"),\n        digits: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DIGITS\"),\n        dateIso: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DATEISO\"),\n        alphanum: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_ALPHANUM\"),\n        phone: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_PHONE\")\n      },\n      notnull: $translate.instant(\"COMMON.FORM_ERRORS.NOTNULL\"),\n      notblank: $translate.instant(\"COMMON.FORM_ERRORS.NOT_BLANK\"),\n      required: $translate.instant(\"COMMON.FORM_ERRORS.REQUIRED\"),\n      regexp: $translate.instant(\"COMMON.FORM_ERRORS.REGEXP\"),\n      min: $translate.instant(\"COMMON.FORM_ERRORS.MIN\"),\n      max: $translate.instant(\"COMMON.FORM_ERRORS.MAX\"),\n      range: $translate.instant(\"COMMON.FORM_ERRORS.RANGE\"),\n      minlength: $translate.instant(\"COMMON.FORM_ERRORS.MIN_LENGTH\"),\n      maxlength: $translate.instant(\"COMMON.FORM_ERRORS.MAX_LENGTH\"),\n      rangelength: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_LENGTH\"),\n      mincheck: $translate.instant(\"COMMON.FORM_ERRORS.MIN_CHECK\"),\n      maxcheck: $translate.instant(\"COMMON.FORM_ERRORS.MAX_CHECK\"),\n      rangecheck: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_CHECK\"),\n      equalto: $translate.instant(\"COMMON.FORM_ERRORS.EQUAL_TO\")\n    };\n    return checksley.updateMessages('default', messages);\n  };\n\n  init = function($log, $rootscope, $auth, $events, $analytics, $translate, $location, $navUrls, appMetaService, projectService, loaderService, navigationBarService) {\n    var un, user;\n    $log.debug(\"Initialize application\");\n    $rootscope.contribPlugins = this.taigaContribPlugins;\n    $rootscope.adminPlugins = _.where(this.taigaContribPlugins, {\n      \"type\": \"admin\"\n    });\n    $rootscope.$on(\"$translateChangeEnd\", function(e, ctx) {\n      var lang;\n      lang = ctx.language;\n      return i18nInit(lang, $translate);\n    });\n    Promise.setScheduler(function(cb) {\n      return $rootscope.$evalAsync(cb);\n    });\n    $events.setupConnection();\n    if ($auth.isAuthenticated()) {\n      user = $auth.getUser();\n    }\n    $analytics.initialize();\n    un = $rootscope.$on('$routeChangeStart', function(event, next) {\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      return un();\n    });\n    return $rootscope.$on('$routeChangeSuccess', function(event, next) {\n      var description, title;\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      if (next.access && next.access.requiresLogin) {\n        if (!$auth.isAuthenticated()) {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n      }\n      projectService.setSection(next.section);\n      if (next.params.pslug) {\n        projectService.setProjectBySlug(next.params.pslug);\n      } else {\n        projectService.cleanProject();\n      }\n      if (next.title || next.description) {\n        title = $translate.instant(next.title || \"\");\n        description = $translate.instant(next.description || \"\");\n        appMetaService.setAll(title, description);\n      }\n      if (next.mobileViewport) {\n        appMetaService.addMobileViewport();\n      } else {\n        appMetaService.removeMobileViewport();\n      }\n      if (next.disableHeader) {\n        return navigationBarService.disableHeader();\n      } else {\n        return navigationBarService.enableHeader();\n      }\n    });\n  };\n\n  pluginsWithModule = _.filter(this.taigaContribPlugins, function(plugin) {\n    return plugin.module;\n  });\n\n  angular.module('infinite-scroll').value('THROTTLE_MILLISECONDS', 500);\n\n  modules = [\"taigaBase\", \"taigaCommon\", \"taigaResources\", \"taigaResources2\", \"taigaAuth\", \"taigaEvents\", \"taigaHome\", \"taigaNavigationBar\", \"taigaProjects\", \"taigaRelatedTasks\", \"taigaBacklog\", \"taigaTaskboard\", \"taigaKanban\", \"taigaIssues\", \"taigaUserStories\", \"taigaTasks\", \"taigaTeam\", \"taigaWiki\", \"taigaSearch\", \"taigaAdmin\", \"taigaProject\", \"taigaUserSettings\", \"taigaFeedback\", \"taigaPlugins\", \"taigaIntegrations\", \"taigaComponents\", \"taigaProfile\", \"taigaHome\", \"taigaUserTimeline\", \"taigaExternalApps\", \"templates\", \"ngSanitize\", \"ngRoute\", \"ngAnimate\", \"ngAria\", \"pascalprecht.translate\", \"infinite-scroll\", \"tgRepeat\"].concat(_.map(pluginsWithModule, function(plugin) {\n    return plugin.module;\n  }));\n\n  module = angular.module(\"taiga\", modules);\n\n  module.config([\"$routeProvider\", \"$locationProvider\", \"$httpProvider\", \"$provide\", \"$tgEventsProvider\", \"$compileProvider\", \"$translateProvider\", \"$translatePartialLoaderProvider\", \"$animateProvider\", configure]);\n\n  module.run([\"$log\", \"$rootScope\", \"$tgAuth\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"tgProjectService\", \"tgLoader\", \"tgNavigationBarService\", \"$route\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: classes.coffee\n */\n\n(function() {\n  var TaigaBase, TaigaController, TaigaService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  TaigaBase = (function() {\n    function TaigaBase() {}\n\n    return TaigaBase;\n\n  })();\n\n  TaigaService = (function(superClass) {\n    extend(TaigaService, superClass);\n\n    function TaigaService() {\n      return TaigaService.__super__.constructor.apply(this, arguments);\n    }\n\n    return TaigaService;\n\n  })(TaigaBase);\n\n  TaigaController = (function(superClass) {\n    extend(TaigaController, superClass);\n\n    function TaigaController() {\n      this.onInitialDataError = bind(this.onInitialDataError, this);\n      return TaigaController.__super__.constructor.apply(this, arguments);\n    }\n\n    TaigaController.prototype.onInitialDataError = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.location.path(this.navUrls.resolve(\"not-found\"));\n          this.location.replace();\n        } else if (xhr.status === 403) {\n          this.location.path(this.navUrls.resolve(\"permission-denied\"));\n          this.location.replace();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return TaigaController;\n\n  })(TaigaBase);\n\n  this.taiga.Base = TaigaBase;\n\n  this.taiga.Service = TaigaService;\n\n  this.taiga.Controller = TaigaController;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.coffee\n */\n\n(function() {\n  var bindMethods, bindOnce, cancelTimeout, debounce, debounceLeading, defineImmutableProperty, groupBy, joinStr, mixOf, nl2br, replaceTags, scopeDefer, sizeFormat, slugify, startswith, stripTags, taiga, timeout, toString, toggleText, trim, truncate, unslugify,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  nl2br = (function(_this) {\n    return function(str) {\n      var breakTag;\n      breakTag = '<br />';\n      return (str + '').replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + breakTag + '$2');\n    };\n  })(this);\n\n  bindMethods = (function(_this) {\n    return function(object) {\n      var dependencies, methods;\n      dependencies = _.keys(object);\n      methods = [];\n      _.forIn(object, function(value, key) {\n        if (indexOf.call(dependencies, key) < 0) {\n          return methods.push(key);\n        }\n      });\n      return _.bindAll(object, methods);\n    };\n  })(this);\n\n  bindOnce = (function(_this) {\n    return function(scope, attr, continuation) {\n      var delBind, val;\n      val = scope.$eval(attr);\n      if (val !== void 0) {\n        return continuation(val);\n      }\n      delBind = null;\n      return delBind = scope.$watch(attr, function(val) {\n        if (val === void 0) {\n          return;\n        }\n        continuation(val);\n        if (delBind) {\n          return delBind();\n        }\n      });\n    };\n  })(this);\n\n  mixOf = function() {\n    var Mixed, base, i, method, mixin, mixins, name, ref;\n    base = arguments[0], mixins = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    Mixed = (function(superClass) {\n      extend(Mixed, superClass);\n\n      function Mixed() {\n        return Mixed.__super__.constructor.apply(this, arguments);\n      }\n\n      return Mixed;\n\n    })(base);\n    for (i = mixins.length - 1; i >= 0; i += -1) {\n      mixin = mixins[i];\n      ref = mixin.prototype;\n      for (name in ref) {\n        method = ref[name];\n        Mixed.prototype[name] = method;\n      }\n    }\n    return Mixed;\n  };\n\n  trim = function(data, char) {\n    return _.str.trim(data, char);\n  };\n\n  slugify = function(data) {\n    return _.str.slugify(data);\n  };\n\n  unslugify = function(data) {\n    if (data) {\n      return _.str.capitalize(data.replace(/-/g, ' '));\n    }\n    return data;\n  };\n\n  toggleText = function(element, texts) {\n    var nextTextPosition, text;\n    nextTextPosition = element.data('nextTextPosition');\n    if ((nextTextPosition == null) || nextTextPosition >= texts.length) {\n      nextTextPosition = 0;\n    }\n    text = texts[nextTextPosition];\n    element.data('nextTextPosition', nextTextPosition + 1);\n    return element.text(text);\n  };\n\n  groupBy = function(coll, pred) {\n    var i, item, len, result;\n    result = {};\n    for (i = 0, len = coll.length; i < len; i++) {\n      item = coll[i];\n      result[pred(item)] = item;\n    }\n    return result;\n  };\n\n  timeout = function(wait, continuation) {\n    return window.setTimeout(continuation, wait);\n  };\n\n  cancelTimeout = function(timeoutVar) {\n    return window.clearTimeout(timeoutVar);\n  };\n\n  scopeDefer = function(scope, func) {\n    return _.defer((function(_this) {\n      return function() {\n        return scope.$apply(func);\n      };\n    })(this));\n  };\n\n  toString = function(value) {\n    if (_.isNumber(value)) {\n      return value + \"\";\n    } else if (_.isString(value)) {\n      return value;\n    } else if (_.isPlainObject(value)) {\n      return JSON.stringify(value);\n    } else if (_.isUndefined(value)) {\n      return \"\";\n    }\n    return value.toString();\n  };\n\n  joinStr = function(str, coll) {\n    return _.str.join(str, coll);\n  };\n\n  debounce = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: true,\n      trailing: false\n    });\n  };\n\n  debounceLeading = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: false,\n      trailing: true\n    });\n  };\n\n  startswith = function(str1, str2) {\n    return _.str.startsWith(str1, str2);\n  };\n\n  truncate = function(str, maxLength, suffix) {\n    var out;\n    if (suffix == null) {\n      suffix = \"...\";\n    }\n    if ((typeof str !== \"string\") && !(str instanceof String)) {\n      return str;\n    }\n    out = str.slice(0);\n    if (out.length > maxLength) {\n      out = out.substring(0, maxLength + 1);\n      out = out.substring(0, Math.min(out.length, out.lastIndexOf(\" \")));\n      out = out + suffix;\n    }\n    return out;\n  };\n\n  sizeFormat = function(input, precision) {\n    var number, size, units;\n    if (precision == null) {\n      precision = 1;\n    }\n    if (isNaN(parseFloat(input)) || !isFinite(input)) {\n      return \"-\";\n    }\n    if (input === 0) {\n      return \"0 bytes\";\n    }\n    units = [\"bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n    number = Math.floor(Math.log(input) / Math.log(1024));\n    if (number > 5) {\n      number = 5;\n    }\n    size = (input / Math.pow(1024, number)).toFixed(precision);\n    return size + \" \" + units[number];\n  };\n\n  stripTags = function(str, exception) {\n    var pattern;\n    if (exception) {\n      pattern = new RegExp('<(?!' + exception + '\\s*\\/?)[^>]+>', 'gi');\n      return String(str).replace(pattern, '');\n    } else {\n      return String(str).replace(/<\\/?[^>]+>/g, '');\n    }\n  };\n\n  replaceTags = function(str, tags, replace) {\n    var pattern;\n    pattern = new RegExp('<(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '<' + replace + '>');\n    pattern = new RegExp('<\\/(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '</' + replace + '>');\n    return str;\n  };\n\n  defineImmutableProperty = (function(_this) {\n    return function(obj, name, fn) {\n      return Object.defineProperty(obj, name, {\n        get: function() {\n          var fn_result;\n          if (!_.isFunction(fn)) {\n            throw \"defineImmutableProperty third param must be a function\";\n          }\n          fn_result = fn();\n          if (fn_result && _.isObject(fn_result)) {\n            if (fn_result.size === void 0) {\n              throw \"defineImmutableProperty must return immutable data\";\n            }\n          }\n          return fn_result;\n        }\n      });\n    };\n  })(this);\n\n  _.mixin({\n    removeKeys: function(obj, keys) {\n      return _.chain([keys]).flatten().reduce(function(obj, key) {\n        delete obj[key];\n        return obj;\n      }, obj).value();\n    }\n  });\n\n  taiga = this.taiga;\n\n  taiga.nl2br = nl2br;\n\n  taiga.bindMethods = bindMethods;\n\n  taiga.bindOnce = bindOnce;\n\n  taiga.mixOf = mixOf;\n\n  taiga.trim = trim;\n\n  taiga.slugify = slugify;\n\n  taiga.unslugify = unslugify;\n\n  taiga.toggleText = toggleText;\n\n  taiga.groupBy = groupBy;\n\n  taiga.timeout = timeout;\n\n  taiga.cancelTimeout = cancelTimeout;\n\n  taiga.scopeDefer = scopeDefer;\n\n  taiga.toString = toString;\n\n  taiga.joinStr = joinStr;\n\n  taiga.truncate = truncate;\n\n  taiga.debounce = debounce;\n\n  taiga.debounceLeading = debounceLeading;\n\n  taiga.startswith = startswith;\n\n  taiga.sizeFormat = sizeFormat;\n\n  taiga.stripTags = stripTags;\n\n  taiga.replaceTags = replaceTags;\n\n  taiga.defineImmutableProperty = defineImmutableProperty;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/controllerMixins.coffee\n */\n\n(function() {\n  var FiltersMixin, PageMixin, groupBy, joinStr, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  joinStr = this.taiga.joinStr;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  PageMixin = (function() {\n    function PageMixin() {}\n\n    PageMixin.prototype.fillUsersAndRoles = function(users, roles) {\n      var activeUsers, computableRoles;\n      activeUsers = _.filter(users, (function(_this) {\n        return function(user) {\n          return user.is_active;\n        };\n      })(this));\n      this.scope.activeUsers = _.sortBy(activeUsers, \"full_name_display\");\n      this.scope.activeUsersById = groupBy(this.scope.activeUsers, function(e) {\n        return e.id;\n      });\n      this.scope.users = _.sortBy(users, \"full_name_display\");\n      this.scope.usersById = groupBy(this.scope.users, function(e) {\n        return e.id;\n      });\n      this.scope.roles = _.sortBy(roles, \"order\");\n      computableRoles = _(this.scope.project.members).map(\"role\").uniq().value();\n      return this.scope.computableRoles = _(roles).filter(\"computable\").filter(function(x) {\n        return _.contains(computableRoles, x.id);\n      }).value();\n    };\n\n    PageMixin.prototype.loadUsersAndRoles = function() {\n      var promise;\n      promise = this.q.all([this.rs.projects.usersList(this.scope.projectId), this.rs.projects.rolesList(this.scope.projectId)]);\n      return promise.then((function(_this) {\n        return function(results) {\n          var roles, users;\n          users = results[0], roles = results[1];\n          _this.fillUsersAndRoles(users, roles);\n          return results;\n        };\n      })(this));\n    };\n\n    return PageMixin;\n\n  })();\n\n  taiga.PageMixin = PageMixin;\n\n  FiltersMixin = (function() {\n    function FiltersMixin() {}\n\n    FiltersMixin.prototype.selectFilter = function(name, value, load) {\n      var existing, location, params;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] !== void 0 && name !== \"page\") {\n        existing = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n          return trim(x);\n        });\n        existing.push(taiga.toString(value));\n        existing = _.compact(existing);\n        value = joinStr(\",\", _.uniq(existing));\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceFilter = function(name, value, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceAllFilters = function(filters, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(filters);\n    };\n\n    FiltersMixin.prototype.unselectFilter = function(name, value, load) {\n      var location, newValues, params, parsedValues;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] === void 0) {\n        return;\n      }\n      if (value === void 0 || value === null) {\n        delete params[name];\n      }\n      parsedValues = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n        return trim(x);\n      });\n      newValues = _.reject(parsedValues, function(x) {\n        return x === taiga.toString(value);\n      });\n      newValues = _.compact(newValues);\n      if (_.isEmpty(newValues)) {\n        value = null;\n      } else {\n        value = joinStr(\",\", _.uniq(newValues));\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(name, value);\n    };\n\n    return FiltersMixin;\n\n  })();\n\n  taiga.FiltersMixin = FiltersMixin;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaAdmin\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/auth.coffee\n */\n\n(function() {\n  var AuthService, CancelAccountDirective, ChangeEmailDirective, ChangePasswordFromRecoveryDirective, ForgotPasswordDirective, InvitationDirective, LoginDirective, PublicRegisterMessageDirective, RegisterDirective, debounce, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAuth\", [\"taigaResources\"]);\n\n  AuthService = (function(superClass) {\n    extend(AuthService, superClass);\n\n    AuthService.$inject = [\"$rootScope\", \"$tgStorage\", \"$tgModel\", \"$tgResources\", \"$tgHttp\", \"$tgUrls\", \"$tgConfig\", \"$translate\", \"tgCurrentUserService\", \"tgThemeService\"];\n\n    function AuthService(rootscope, storage, model, rs, http, urls, config, translate, currentUserService, themeService) {\n      var userModel;\n      this.rootscope = rootscope;\n      this.storage = storage;\n      this.model = model;\n      this.rs = rs;\n      this.http = http;\n      this.urls = urls;\n      this.config = config;\n      this.translate = translate;\n      this.currentUserService = currentUserService;\n      this.themeService = themeService;\n      AuthService.__super__.constructor.call(this);\n      userModel = this.getUser();\n      this._currentTheme = this._getUserTheme();\n      this.setUserdata(userModel);\n    }\n\n    AuthService.prototype.setUserdata = function(userModel) {\n      if (userModel) {\n        this.userData = Immutable.fromJS(userModel.getAttrs());\n        return this.currentUserService.setUser(this.userData);\n      } else {\n        return this.userData = null;\n      }\n    };\n\n    AuthService.prototype._getUserTheme = function() {\n      var ref;\n      return ((ref = this.rootscope.user) != null ? ref.theme : void 0) || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    AuthService.prototype._setTheme = function() {\n      var newTheme;\n      newTheme = this._getUserTheme();\n      if (this._currentTheme !== newTheme) {\n        this._currentTheme = newTheme;\n        return this.themeService.use(this._currentTheme);\n      }\n    };\n\n    AuthService.prototype._setLocales = function() {\n      var lang, ref;\n      lang = ((ref = this.rootscope.user) != null ? ref.lang : void 0) || this.config.get(\"defaultLanguage\") || \"en\";\n      this.translate.preferredLanguage(lang);\n      return this.translate.use(lang);\n    };\n\n    AuthService.prototype.getUser = function() {\n      var user, userData;\n      if (this.rootscope.user) {\n        return this.rootscope.user;\n      }\n      userData = this.storage.get(\"userInfo\");\n      if (userData) {\n        user = this.model.make_model(\"users\", userData);\n        this.rootscope.user = user;\n        this._setLocales();\n        this._setTheme();\n        return user;\n      } else {\n        this._setTheme();\n      }\n      return null;\n    };\n\n    AuthService.prototype.setUser = function(user) {\n      this.rootscope.auth = user;\n      this.storage.set(\"userInfo\", user.getAttrs());\n      this.rootscope.user = user;\n      this.setUserdata(user);\n      this._setLocales();\n      return this._setTheme();\n    };\n\n    AuthService.prototype.clear = function() {\n      this.rootscope.auth = null;\n      this.rootscope.user = null;\n      return this.storage.remove(\"userInfo\");\n    };\n\n    AuthService.prototype.setToken = function(token) {\n      return this.storage.set(\"token\", token);\n    };\n\n    AuthService.prototype.getToken = function() {\n      return this.storage.get(\"token\");\n    };\n\n    AuthService.prototype.removeToken = function() {\n      return this.storage.remove(\"token\");\n    };\n\n    AuthService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    AuthService.prototype.login = function(data, type) {\n      var url;\n      url = this.urls.resolve(\"auth\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"normal\";\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = _this.model.make_model(\"users\", data.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.logout = function() {\n      this.removeToken();\n      this.clear();\n      this.currentUserService.removeUser();\n      this._setTheme();\n      return this._setLocales();\n    };\n\n    AuthService.prototype.register = function(data, type, existing) {\n      var url;\n      url = this.urls.resolve(\"auth-register\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"public\";\n      if (type === \"private\") {\n        data.existing = existing ? existing : false;\n      }\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(response) {\n          var user;\n          user = _this.model.make_model(\"users\", response.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.getInvitation = function(token) {\n      return this.rs.invitations.get(token);\n    };\n\n    AuthService.prototype.acceptInvitiationWithNewUser = function(data) {\n      return this.register(data, \"private\", false);\n    };\n\n    AuthService.prototype.acceptInvitiationWithExistingUser = function(data) {\n      return this.register(data, \"private\", true);\n    };\n\n    AuthService.prototype.forgotPassword = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-password-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changePasswordFromRecovery = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-password-from-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changeEmail = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-email\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.cancelAccount = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-cancel-account\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    return AuthService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAuth\", AuthService);\n\n  PublicRegisterMessageDirective = function($config, $navUrls, templates) {\n    var template, templateFn;\n    template = templates.get(\"auth/login-text.html\", true);\n    templateFn = function() {\n      var publicRegisterEnabled;\n      publicRegisterEnabled = $config.get(\"publicRegisterEnabled\");\n      if (!publicRegisterEnabled) {\n        return \"\";\n      }\n      return template({\n        url: $navUrls.resolve(\"register\")\n      });\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgPublicRegisterMessage\", [\"$tgConfig\", \"$tgNavUrls\", \"$tgTemplate\", PublicRegisterMessageDirective]);\n\n  LoginDirective = function($auth, $confirm, $location, $config, $routeParams, $navUrls, $events, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onError, onSuccess, submit;\n      form = new checksley.Form($el.find(\"form.login-form\"));\n      onSuccess = function(response) {\n        var nextUrl;\n        if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n          nextUrl = decodeURIComponent($routeParams['next']);\n        } else {\n          nextUrl = $navUrls.resolve(\"home\");\n        }\n        $events.setupConnection();\n        return $location.url(nextUrl);\n      };\n      onError = function(response) {\n        return $confirm.notify(\"light-error\", $translate.instant(\"LOGIN_FORM.ERROR_AUTH_INCORRECT\"));\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          data = {\n            \"username\": $el.find(\"form.login-form input[name=username]\").val(),\n            \"password\": $el.find(\"form.login-form input[name=password]\").val()\n          };\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          promise = $auth.login(data, loginFormType);\n          return promise.then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      window.prerenderReady = true;\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLogin\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgEvents\", \"$translate\", LoginDirective]);\n\n  RegisterDirective = function($auth, $confirm, $location, $navUrls, $config, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      if (!$config.get(\"publicRegisterEnabled\")) {\n        $location.path($navUrls.resolve(\"not-found\"));\n        $location.replace();\n      }\n      $scope.data = {};\n      form = $el.find(\"form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmit = function(response) {\n        $analytics.trackEvent(\"auth\", \"register\", \"user registration\", 1);\n        $confirm.notify(\"success\", $translate.instant(\"LOGIN_FORM.SUCCESS\"));\n        return $location.path($navUrls.resolve(\"home\"));\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return form.setErrors(response.data);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.register($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRegister\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\", \"$tgAnalytics\", \"$translate\", RegisterDirective]);\n\n  ForgotPasswordDirective = function($auth, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.forgotPassword($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgForgotPassword\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$translate\", ForgotPasswordDirective]);\n\n  ChangePasswordFromRecoveryDirective = function($auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit, text;\n      $scope.data = {};\n      if ($params.token != null) {\n        $scope.tokenInParams = true;\n        $scope.data.token = $params.token;\n      } else {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        $confirm.notify(\"light-error\", text);\n      }\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.changePasswordFromRecovery($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangePasswordFromRecovery\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangePasswordFromRecoveryDirective]);\n\n  InvitationDirective = function($auth, $confirm, $location, $params, $navUrls, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loginForm, onErrorSubmitLogin, onErrorSubmitRegister, onSuccessSubmitLogin, onSuccessSubmitRegister, promise, registerForm, submitLogin, submitRegister, token;\n      token = $params.token;\n      promise = $auth.getInvitation(token);\n      promise.then(function(invitation) {\n        return $scope.invitation = invitation;\n      });\n      promise.then(null, function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.NOT_FOUND\");\n        return $confirm.notify(\"light-error\", text);\n      });\n      $scope.dataLogin = {\n        token: token\n      };\n      loginForm = $el.find(\"form.login-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitLogin = function(response) {\n        var text;\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with existing user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.SUCCESS\", {\n          \"project_name\": $scope.invitation.project_name\n        });\n        return $confirm.notify(\"success\", text);\n      };\n      onErrorSubmitLogin = function(response) {\n        var text;\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submitLogin = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!loginForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithExistingUser($scope.dataLogin);\n          return promise.then(onSuccessSubmitLogin, onErrorSubmitLogin);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.login-form\", submitLogin);\n      $el.on(\"click\", \".button-login\", submitLogin);\n      $scope.dataRegister = {\n        token: token\n      };\n      registerForm = $el.find(\"form.register-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitRegister = function(response) {\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with new user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        return $confirm.notify(\"success\", \"You've successfully joined this project\", \"Welcome to \" + (_.escape($scope.invitation.project_name)));\n      };\n      onErrorSubmitRegister = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return registerForm.setErrors(response.data);\n      };\n      submitRegister = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!registerForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithNewUser($scope.dataRegister);\n          return promise.then(onSuccessSubmitRegister, onErrorSubmitRegister);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.register-form\", submitRegister);\n      $el.on(\"click\", \".button-register\", submitRegister);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgInvitation\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", InvitationDirective]);\n\n  ChangeEmailDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.email_token = $params.email_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        if ($auth.isAuthenticated()) {\n          $repo.queryOne(\"users\", $auth.getUser().id).then((function(_this) {\n            return function(data) {\n              $auth.setUser(data);\n              return $location.path($navUrls.resolve(\"home\"));\n            };\n          })(this));\n        } else {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n        text = $translate.instant(\"CHANGE_EMAIL_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = function() {\n        var promise;\n        if (!form.validate()) {\n          return;\n        }\n        promise = $auth.changeEmail($scope.data);\n        return promise.then(onSuccessSubmit, onErrorSubmit);\n      };\n      $el.on(\"submit\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \"a.button-change-email\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangeEmail\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangeEmailDirective]);\n\n  CancelAccountDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.cancel_token = $params.cancel_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $auth.logout();\n        $location.path($navUrls.resolve(\"home\"));\n        text = $translate.instant(\"CANCEL_ACCOUNT.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.cancelAccount($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCancelAccount\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", CancelAccountDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaBacklog\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base.coffee\n */\n\n(function() {\n  var TaigaMainDirective, bindOnce, groupBy, init, module, taiga, urls;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\", []);\n\n  TaigaMainDirective = function($rootscope, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $window.onresize = function() {\n        return $rootscope.$broadcast(\"resize\");\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMain\", [\"$rootScope\", \"$window\", TaigaMainDirective]);\n\n  urls = {\n    \"home\": \"/\",\n    \"projects\": \"/projects\",\n    \"error\": \"/error\",\n    \"not-found\": \"/not-found\",\n    \"permission-denied\": \"/permission-denied\",\n    \"login\": \"/login\",\n    \"forgot-password\": \"/forgot-password\",\n    \"change-password\": \"/change-password/:token\",\n    \"change-email\": \"/change-email/:token\",\n    \"cancel-account\": \"/cancel-account/:token\",\n    \"register\": \"/register\",\n    \"invitation\": \"/invitation/:token\",\n    \"create-project\": \"/create-project\",\n    \"profile\": \"/profile\",\n    \"user-profile\": \"/profile/:username\",\n    \"project\": \"/project/:project\",\n    \"project-backlog\": \"/project/:project/backlog\",\n    \"project-taskboard\": \"/project/:project/taskboard/:sprint\",\n    \"project-kanban\": \"/project/:project/kanban\",\n    \"project-issues\": \"/project/:project/issues\",\n    \"project-search\": \"/project/:project/search\",\n    \"project-userstories-detail\": \"/project/:project/us/:ref\",\n    \"project-tasks-detail\": \"/project/:project/task/:ref\",\n    \"project-issues-detail\": \"/project/:project/issue/:ref\",\n    \"project-wiki\": \"/project/:project/wiki\",\n    \"project-wiki-page\": \"/project/:project/wiki/:slug\",\n    \"project-team\": \"/project/:project/team\",\n    \"project-admin-home\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-details\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-default-values\": \"/project/:project/admin/project-profile/default-values\",\n    \"project-admin-project-profile-modules\": \"/project/:project/admin/project-profile/modules\",\n    \"project-admin-project-profile-export\": \"/project/:project/admin/project-profile/export\",\n    \"project-admin-project-profile-reports\": \"/project/:project/admin/project-profile/reports\",\n    \"project-admin-project-values-status\": \"/project/:project/admin/project-values/status\",\n    \"project-admin-project-values-points\": \"/project/:project/admin/project-values/points\",\n    \"project-admin-project-values-priorities\": \"/project/:project/admin/project-values/priorities\",\n    \"project-admin-project-values-severities\": \"/project/:project/admin/project-values/severities\",\n    \"project-admin-project-values-triggers\": \"/project/:project/admin/project-values/triggers\",\n    \"project-admin-project-values-types\": \"/project/:project/admin/project-values/types\",\n    \"project-admin-project-values-custom-fields\": \"/project/:project/admin/project-values/custom-fields\",\n    \"project-admin-memberships\": \"/project/:project/admin/memberships\",\n    \"project-admin-roles\": \"/project/:project/admin/roles\",\n    \"project-admin-third-parties-webhooks\": \"/project/:project/admin/third-parties/webhooks\",\n    \"project-admin-third-parties-github\": \"/project/:project/admin/third-parties/github\",\n    \"project-admin-third-parties-gitlab\": \"/project/:project/admin/third-parties/gitlab\",\n    \"project-admin-third-parties-bitbucket\": \"/project/:project/admin/third-parties/bitbucket\",\n    \"project-admin-contrib\": \"/project/:project/admin/contrib/:plugin\",\n    \"user-settings-user-profile\": \"/user-settings/user-profile\",\n    \"user-settings-user-change-password\": \"/user-settings/user-change-password\",\n    \"user-settings-user-avatar\": \"/user-settings/user-avatar\",\n    \"user-settings-mail-notifications\": \"/user-settings/mail-notifications\"\n  };\n\n  init = function($log, $navurls) {\n    $log.debug(\"Initialize navigation urls\");\n    return $navurls.update(urls);\n  };\n\n  module.run([\"$log\", \"$tgNavUrls\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common.coffee\n */\n\n(function() {\n  var AnimationFrame, Capslock, CheckPermissionDirective, ClassPermissionDirective, DataPickerConfig, LimitLineLengthDirective, ProjectUrl, Qqueue, SelectedText, Template, ToggleCommentDirective, module, taiga,\n    slice = [].slice;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\", []);\n\n  DataPickerConfig = function($translate) {\n    return {\n      get: function() {\n        return {\n          i18n: {\n            previousMonth: $translate.instant(\"COMMON.PICKERDATE.PREV_MONTH\"),\n            nextMonth: $translate.instant(\"COMMON.PICKERDATE.NEXT_MONTH\"),\n            months: [$translate.instant(\"COMMON.PICKERDATE.MONTHS.JAN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.FEB\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.APR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAY\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUL\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.AUG\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.SEP\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.OCT\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.NOV\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.DEC\")],\n            weekdays: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SAT\")],\n            weekdaysShort: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT\")]\n          },\n          isRTL: $translate.instant(\"COMMON.PICKERDATE.IS_RTL\") === \"true\",\n          firstDay: parseInt($translate.instant(\"COMMON.PICKERDATE.FIRST_DAY_OF_WEEK\"), 10),\n          format: $translate.instant(\"COMMON.PICKERDATE.FORMAT\")\n        };\n      }\n    };\n  };\n\n  module.factory(\"tgDatePickerConfigService\", [\"$translate\", DataPickerConfig]);\n\n  SelectedText = function($window, $document) {\n    var get;\n    get = function() {\n      if ($window.getSelection) {\n        return $window.getSelection().toString();\n      } else if ($document.selection) {\n        return $document.selection.createRange().text;\n      }\n      return \"\";\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$selectedText\", [\"$window\", \"$document\", SelectedText]);\n\n  CheckPermissionDirective = function() {\n    var link, render;\n    render = function($el, project, permission) {\n      if (project.my_permissions.indexOf(permission) > -1) {\n        return $el.removeClass('hidden');\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var permission;\n      $el.addClass('hidden');\n      permission = $attrs.tgCheckPermission;\n      $scope.$watch(\"project\", function(project) {\n        if (project != null) {\n          return render($el, project, permission);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCheckPermission\", CheckPermissionDirective);\n\n  ClassPermissionDirective = function() {\n    var link, name;\n    name = \"tgClassPermission\";\n    link = function($scope, $el, $attrs) {\n      var checkPermissions, tgClassPermissionWatchAction, unbindWatcher;\n      checkPermissions = function(project, className, permission) {\n        var negation;\n        negation = permission[0] === \"!\";\n        if (negation) {\n          permission = permission.slice(1);\n        }\n        if (negation && project.my_permissions.indexOf(permission) === -1) {\n          return $el.addClass(className);\n        } else if (!negation && project.my_permissions.indexOf(permission) !== -1) {\n          return $el.addClass(className);\n        } else {\n          return $el.removeClass(className);\n        }\n      };\n      tgClassPermissionWatchAction = function(project) {\n        var className, classes, permission, results;\n        if (project) {\n          unbindWatcher();\n          classes = $scope.$eval($attrs[name]);\n          results = [];\n          for (className in classes) {\n            permission = classes[className];\n            results.push(checkPermissions(project, className, permission));\n          }\n          return results;\n        }\n      };\n      return unbindWatcher = $scope.$watch(\"project\", tgClassPermissionWatchAction);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgClassPermission\", ClassPermissionDirective);\n\n  AnimationFrame = function() {\n    var add, animationFrame, performAnimation, tail;\n    animationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;\n    performAnimation = (function(_this) {\n      return function(time) {\n        var fn;\n        fn = tail.shift();\n        fn();\n        if (tail.length) {\n          return animationFrame(performAnimation);\n        }\n      };\n    })(this);\n    tail = [];\n    add = function() {\n      var fn, i, len, results;\n      results = [];\n      for (i = 0, len = arguments.length; i < len; i++) {\n        fn = arguments[i];\n        tail.push(fn);\n        if (tail.length === 1) {\n          results.push(animationFrame(performAnimation));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    return {\n      add: add\n    };\n  };\n\n  module.factory(\"animationFrame\", AnimationFrame);\n\n  ToggleCommentDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.find(\"textarea\").on(\"focus\", function() {\n        return $el.addClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleComment\", ToggleCommentDirective);\n\n  ProjectUrl = function($navurls) {\n    var get;\n    get = function(project) {\n      var ctx;\n      ctx = {\n        project: project.slug\n      };\n      if (project.is_backlog_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-backlog\", ctx);\n      }\n      if (project.is_kanban_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-kanban\", ctx);\n      }\n      if (project.is_wiki_activated && project.my_permissions.indexOf(\"view_wiki_pages\") > -1) {\n        return $navurls.resolve(\"project-wiki\", ctx);\n      }\n      if (project.is_issues_activated && project.my_permissions.indexOf(\"view_issues\") > -1) {\n        return $navurls.resolve(\"project-issues\", ctx);\n      }\n      return $navurls.resolve(\"project\", ctx);\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$projectUrl\", [\"$tgNavUrls\", ProjectUrl]);\n\n  LimitLineLengthDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var maxColsPerLine;\n      maxColsPerLine = parseInt($el.attr(\"cols\"));\n      return $el.on(\"keyup\", function(event) {\n        var code, lines;\n        code = event.keyCode;\n        lines = $el.val().split(\"\\n\");\n        _.each(lines, function(line, index) {\n          return lines[index] = line.substring(0, maxColsPerLine - 2);\n        });\n        return $el.val(lines.join(\"\\n\"));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLimitLineLength\", LimitLineLengthDirective);\n\n  Qqueue = function($q) {\n    var deferred, lastPromise, qqueue;\n    deferred = $q.defer();\n    deferred.resolve();\n    lastPromise = deferred.promise;\n    qqueue = {\n      bindAdd: (function(_this) {\n        return function(fn) {\n          return function() {\n            var args;\n            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n            return lastPromise = lastPromise.then(function() {\n              return fn.apply(_this, args);\n            });\n          };\n          return qqueue;\n        };\n      })(this),\n      add: (function(_this) {\n        return function(fn) {\n          if (!lastPromise) {\n            lastPromise = fn();\n          } else {\n            lastPromise = lastPromise.then(fn);\n          }\n          return qqueue;\n        };\n      })(this)\n    };\n    return qqueue;\n  };\n\n  module.factory(\"$tgQqueue\", [\"$q\", Qqueue]);\n\n  Template = function($templateCache) {\n    return {\n      get: (function(_this) {\n        return function(name, lodash) {\n          var tmp;\n          if (lodash == null) {\n            lodash = false;\n          }\n          tmp = $templateCache.get(name);\n          if (lodash) {\n            tmp = _.template(tmp);\n          }\n          return tmp;\n        };\n      })(this)\n    };\n  };\n\n  module.factory(\"$tgTemplate\", [\"$templateCache\", Template]);\n\n  Capslock = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var hideIcon, open, showIcon, warningIcon;\n      open = false;\n      warningIcon = $('<div>').addClass('icon').addClass('icon-capslock').attr('title', $translate.instant('COMMON.CAPSLOCK_WARNING'));\n      hideIcon = function() {\n        return warningIcon.fadeOut(function() {\n          open = false;\n          return $(this).remove();\n        });\n      };\n      showIcon = function(e) {\n        var element;\n        if (open) {\n          return;\n        }\n        element = e.currentTarget;\n        $(element).parent().append(warningIcon);\n        $('.icon-capslock').fadeIn();\n        return open = true;\n      };\n      $el.on('blur', function(e) {\n        return hideIcon();\n      });\n      $el.on('keyup.capslock, focus', function(e) {\n        if ($el.val() === $el.val().toLowerCase()) {\n          return hideIcon(e);\n        } else {\n          return showIcon(e);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off('.capslock');\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCapslock\", [\"$translate\", Capslock]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/events.coffee\n */\n\n(function() {\n  var EventsProvider, EventsService, bindMethods, module, startswith, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEvents\", []);\n\n  EventsService = (function() {\n    function EventsService(win, log, config, auth, liveAnnouncementService1, rootScope) {\n      this.win = win;\n      this.log = log;\n      this.config = config;\n      this.auth = auth;\n      this.liveAnnouncementService = liveAnnouncementService1;\n      this.rootScope = rootScope;\n      this.processMessage = bind(this.processMessage, this);\n      bindMethods(this);\n    }\n\n    EventsService.prototype.initialize = function(sessionId) {\n      this.sessionId = sessionId;\n      this.subscriptions = {};\n      this.connected = false;\n      this.error = false;\n      this.pendingMessages = [];\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = null;\n      if (this.win.WebSocket === void 0) {\n        return this.log.info(\"WebSockets not supported on your browser\");\n      }\n    };\n\n    EventsService.prototype.setupConnection = function() {\n      var loc, path, scheme, url;\n      this.stopExistingConnection();\n      url = this.config.get(\"eventsUrl\");\n      if (!url) {\n        return;\n      }\n      if (!startswith(url, \"ws:\") && !startswith(url, \"wss:\")) {\n        loc = this.win.location;\n        scheme = loc.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        path = _.str.ltrim(url, \"/\");\n        url = scheme + \"//\" + loc.host + \"/\" + path;\n      }\n      this.ws = new this.win.WebSocket(url);\n      this.ws.addEventListener(\"open\", this.onOpen);\n      this.ws.addEventListener(\"message\", this.onMessage);\n      this.ws.addEventListener(\"error\", this.onError);\n      return this.ws.addEventListener(\"close\", this.onClose);\n    };\n\n    EventsService.prototype.stopExistingConnection = function() {\n      if (this.ws === void 0) {\n        return;\n      }\n      this.ws.removeEventListener(\"open\", this.onOpen);\n      this.ws.removeEventListener(\"close\", this.onClose);\n      this.ws.removeEventListener(\"error\", this.onError);\n      this.ws.removeEventListener(\"message\", this.onMessage);\n      this.stopHeartBeatMessages();\n      this.ws.close();\n      return delete this.ws;\n    };\n\n    EventsService.prototype.notifications = function() {\n      return this.subscribe(null, 'notifications', (function(_this) {\n        return function(data) {\n          _this.liveAnnouncementService.show(data.title, data.desc);\n          return _this.rootScope.$digest();\n        };\n      })(this));\n    };\n\n    EventsService.prototype.startHeartBeatMessages = function() {\n      var heartbeatIntervalTime, maxMissedHeartbeats;\n      if (this.heartbeatInterval) {\n        return;\n      }\n      maxMissedHeartbeats = this.config.get(\"eventsMaxMissedHeartbeats\", 5);\n      heartbeatIntervalTime = this.config.get(\"eventsHeartbeatIntervalTime\", 60000);\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = setInterval((function(_this) {\n        return function() {\n          var e, error1;\n          try {\n            if (_this.missedHeartbeats >= maxMissedHeartbeats) {\n              throw new Error(\"Too many missed heartbeats PINGs.\");\n            }\n            _this.missedHeartbeats++;\n            _this.sendMessage({\n              cmd: \"ping\"\n            });\n            return _this.log.debug(\"HeartBeat send PING\");\n          } catch (error1) {\n            e = error1;\n            _this.log.error(\"HeartBeat error: \" + e.message);\n            return _this.stopHeartBeatMessages();\n          }\n        };\n      })(this), heartbeatIntervalTime);\n      return this.log.debug(\"HeartBeat enabled\");\n    };\n\n    EventsService.prototype.stopHeartBeatMessages = function() {\n      if (!this.heartbeatInterval) {\n        return;\n      }\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n      return this.log.debug(\"HeartBeat disabled\");\n    };\n\n    EventsService.prototype.processHeartBeatPongMessage = function(data) {\n      this.missedHeartbeats = 0;\n      return this.log.debug(\"HeartBeat recived PONG\");\n    };\n\n    EventsService.prototype.serialize = function(message) {\n      if (_.isObject(message)) {\n        return JSON.stringify(message);\n      }\n      return message;\n    };\n\n    EventsService.prototype.sendMessage = function(message) {\n      var i, len, messages, msg, results;\n      this.pendingMessages.push(message);\n      if (!this.connected) {\n        return;\n      }\n      messages = _.map(this.pendingMessages, this.serialize);\n      this.pendingMessages = [];\n      results = [];\n      for (i = 0, len = messages.length; i < len; i++) {\n        msg = messages[i];\n        results.push(this.ws.send(msg));\n      }\n      return results;\n    };\n\n    EventsService.prototype.processMessage = function(data) {\n      var routingKey, subscription;\n      routingKey = data.routing_key;\n      if (this.subscriptions[routingKey] == null) {\n        return;\n      }\n      subscription = this.subscriptions[routingKey];\n      if (subscription.scope) {\n        return subscription.scope.$apply(function() {\n          return subscription.callback(data.data);\n        });\n      } else {\n        return subscription.callback(data.data);\n      }\n    };\n\n    EventsService.prototype.subscribe = function(scope, routingKey, callback) {\n      var message, subscription;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Subscribe to: \" + routingKey);\n      subscription = {\n        scope: scope,\n        routingKey: routingKey,\n        callback: _.debounce(callback, 500, {\n          \"leading\": true,\n          \"trailing\": false\n        })\n      };\n      message = {\n        \"cmd\": \"subscribe\",\n        \"routing_key\": routingKey\n      };\n      this.subscriptions[routingKey] = subscription;\n      this.sendMessage(message);\n      if (scope) {\n        return scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            return _this.unsubscribe(routingKey);\n          };\n        })(this));\n      }\n    };\n\n    EventsService.prototype.unsubscribe = function(routingKey) {\n      var message;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Unsubscribe from: \" + routingKey);\n      message = {\n        \"cmd\": \"unsubscribe\",\n        \"routing_key\": routingKey\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onOpen = function() {\n      var message, token;\n      this.connected = true;\n      this.startHeartBeatMessages();\n      this.notifications();\n      this.log.debug(\"WebSocket connection opened\");\n      token = this.auth.getToken();\n      message = {\n        cmd: \"auth\",\n        data: {\n          token: token,\n          sessionId: this.sessionId\n        }\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onMessage = function(event) {\n      var data;\n      this.log.debug(\"WebSocket message received: \" + event.data);\n      data = JSON.parse(event.data);\n      if (data.cmd === \"pong\") {\n        return this.processHeartBeatPongMessage(data);\n      } else {\n        return this.processMessage(data);\n      }\n    };\n\n    EventsService.prototype.onError = function(error) {\n      this.log.error(\"WebSocket error: \" + error);\n      return this.error = true;\n    };\n\n    EventsService.prototype.onClose = function() {\n      this.log.debug(\"WebSocket closed.\");\n      this.connected = false;\n      return this.stopHeartBeatMessages();\n    };\n\n    return EventsService;\n\n  })();\n\n  EventsProvider = (function() {\n    function EventsProvider() {}\n\n    EventsProvider.prototype.setSessionId = function(sessionId) {\n      return this.sessionId = sessionId;\n    };\n\n    EventsProvider.prototype.$get = function($win, $log, $conf, $auth, liveAnnouncementService, $rootScope) {\n      var service;\n      service = new EventsService($win, $log, $conf, $auth, liveAnnouncementService, $rootScope);\n      service.initialize(this.sessionId);\n      return service;\n    };\n\n    EventsProvider.prototype.$get.$inject = [\"$window\", \"$log\", \"$tgConfig\", \"$tgAuth\", \"tgLiveAnnouncementService\", \"$rootScope\"];\n\n    return EventsProvider;\n\n  })();\n\n  module.provider(\"$tgEvents\", EventsProvider);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/feedback.coffee\n */\n\n(function() {\n  var FeedbackDirective, bindOnce, debounce, groupBy, mixOf, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaFeedback\", []);\n\n  FeedbackDirective = function($lightboxService, $repo, $confirm, $loading, feedbackService) {\n    var directive, link;\n    link = function($scope, $el, $attrs) {\n      var form, openLightbox, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"feedback\", $scope.feedback);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $lightboxService.close($el);\n            return $confirm.notify(\"success\", \"\\\\o/ we'll be happy to read your\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      openLightbox = function() {\n        $scope.feedback = {};\n        $lightboxService.open($el);\n        return $el.find(\"textarea\").focus();\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"common/lightbox-feedback.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbFeedback\", [\"lightboxService\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgFeedbackService\", FeedbackDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/integrations.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIntegrations\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIssues\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaKanban\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaPlugins\", [\"ngRoute\"]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/projects.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProject\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/related-tasks.coffee\n */\n\n(function() {\n  var RelatedTaskAssignedToInlineEditionDirective, RelatedTaskCreateButtonDirective, RelatedTaskCreateFormDirective, RelatedTaskRowDirective, RelatedTasksDirective, debounce, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaRelatedTasks\", []);\n\n  RelatedTaskRowDirective = function($repo, $compile, $confirm, $rootscope, $loading, $template, $translate) {\n    var link, templateEdit, templateView;\n    templateView = $template.get(\"task/related-task-row.html\", true);\n    templateEdit = $template.get(\"task/related-task-row-edit.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var renderEdit, renderView, saveTask;\n      saveTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.save(task);\n        promise.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $rootscope.$broadcast(\"related-tasks:update\");\n          };\n        })(this));\n        promise.then(null, (function(_this) {\n          return function() {\n            currentLoading.finish();\n            $el.find('input').val(task.subject);\n            return $confirm.notify(\"error\");\n          };\n        })(this));\n        return promise;\n      });\n      renderEdit = function(task) {\n        $el.html($compile(templateEdit({\n          task: task\n        }))($scope));\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return saveTask($model.$modelValue).then(function() {\n              return renderView($model.$modelValue);\n            });\n          } else if (event.keyCode === 27) {\n            return renderView($model.$modelValue);\n          }\n        });\n        $el.on(\"click\", \".icon-floppy\", function(event) {\n          return saveTask($model.$modelValue).then(function() {\n            return renderView($model.$modelValue);\n          });\n        });\n        return $el.on(\"click\", \".cancel-edit\", function(event) {\n          return renderView($model.$modelValue);\n        });\n      };\n      renderView = function(task) {\n        var perms;\n        $el.off();\n        perms = {\n          modify_task: $scope.project.my_permissions.indexOf(\"modify_task\") !== -1,\n          delete_task: $scope.project.my_permissions.indexOf(\"delete_task\") !== -1\n        };\n        $el.html($compile(templateView({\n          task: task,\n          perms: perms\n        }))($scope));\n        $el.on(\"click\", \".icon-edit\", function() {\n          renderEdit($model.$modelValue);\n          return $el.find('input').focus().select();\n        });\n        return $el.on(\"click\", \".delete-task\", function(event) {\n          var message, title;\n          title = $translate.instant(\"TASK.TITLE_DELETE_ACTION\");\n          task = $model.$modelValue;\n          message = task.subject;\n          return $confirm.askOnDelete(title, message).then(function(askResponse) {\n            var promise;\n            promise = $repo.remove(task);\n            promise.then(function() {\n              askResponse.finish();\n              $confirm.notify(\"success\");\n              return $scope.$emit(\"related-tasks:delete\");\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          });\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(val) {\n        if (!val) {\n          return;\n        }\n        return renderView(val);\n      });\n      $scope.$on(\"related-tasks:assigned-to-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      $scope.$on(\"related-tasks:status-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgRelatedTaskRow\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", RelatedTaskRowDirective]);\n\n  RelatedTaskCreateFormDirective = function($repo, $compile, $confirm, $tgmodel, $loading, $analytics, $template) {\n    var link, newTask, template;\n    template = $template.get(\"task/related-task-create-form.html\", true);\n    newTask = {\n      subject: \"\",\n      assigned_to: null\n    };\n    link = function($scope, $el, $attrs) {\n      var close, createTask, render;\n      createTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        task.assigned_to = $scope.newTask.assigned_to;\n        task.status = $scope.newTask.status;\n        $scope.newTask.status = $scope.project.default_task_status;\n        $scope.newTask.assigned_to = null;\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.create(\"tasks\", task);\n        promise.then(function() {\n          $analytics.trackEvent(\"task\", \"create\", \"create task on userstory\", 1);\n          currentLoading.finish();\n          $scope.$emit(\"related-tasks:add\");\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function() {\n          $el.find('input').val(task.subject);\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n        return promise;\n      });\n      close = function() {\n        $el.off();\n        $el.html(\"\");\n        return $scope.newRelatedTaskFormOpen = false;\n      };\n      render = function() {\n        $scope.newRelatedTaskFormOpen = true;\n        $el.html($compile(template())($scope));\n        $el.find('input').focus().select();\n        $el.addClass('active');\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return createTask(newTask).then(function() {\n              return render();\n            });\n          } else if (event.keyCode === 27) {\n            return $scope.$apply(function() {\n              return close();\n            });\n          }\n        });\n        $el.on(\"click\", \".icon-delete\", function(event) {\n          return $scope.$apply(function() {\n            return close();\n          });\n        });\n        return $el.on(\"click\", \".icon-floppy\", function(event) {\n          return createTask(newTask).then(function() {\n            return close();\n          });\n        });\n      };\n      taiga.bindOnce($scope, \"us\", function(val) {\n        newTask[\"status\"] = $scope.project.default_task_status;\n        newTask[\"project\"] = $scope.project.id;\n        newTask[\"user_story\"] = $scope.us.id;\n        $scope.newTask = $tgmodel.make_model(\"tasks\", newTask);\n        return $el.html(\"\");\n      });\n      $scope.$on(\"related-tasks:show-form\", function() {\n        return render();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateForm\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgLoading\", \"$tgAnalytics\", \"$tgTemplate\", RelatedTaskCreateFormDirective]);\n\n  RelatedTaskCreateButtonDirective = function($repo, $compile, $confirm, $tgmodel) {\n    var link, template;\n    template = _.template(\"<a ng-show=\\\"!newRelatedTaskFormOpen\\\" class=\\\"icon icon-plus related-tasks-buttons ng-animate-disabled\\\"></a>\");\n    link = function($scope, $el, $attrs) {\n      $scope.$watch(\"project\", function(val) {\n        if (!val) {\n          return;\n        }\n        $el.off();\n        if ($scope.project.my_permissions.indexOf(\"add_task\") !== -1) {\n          $el.html($compile(template())($scope));\n        } else {\n          $el.html(\"\");\n        }\n        return $el.on(\"click\", \".icon\", function(event) {\n          return $scope.$emit(\"related-tasks:add-new-clicked\");\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateButton\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", RelatedTaskCreateButtonDirective]);\n\n  RelatedTasksDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loadTasks;\n      loadTasks = function() {\n        return $rs.tasks.list($scope.projectId, null, $scope.usId).then((function(_this) {\n          return function(tasks) {\n            $scope.tasks = _.sortBy(tasks, 'ref');\n            return tasks;\n          };\n        })(this));\n      };\n      $scope.$on(\"related-tasks:add\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:delete\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:add-new-clicked\", function() {\n        return $scope.$broadcast(\"related-tasks:show-form\");\n      });\n      taiga.bindOnce($scope, \"us\", function(val) {\n        return loadTasks();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", RelatedTasksDirective]);\n\n  RelatedTaskAssignedToInlineEditionDirective = function($repo, $rootscope, popoverService) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task, updateRelatedTask;\n      updateRelatedTask = function(task) {\n        var ctx, member;\n        ctx = {\n          name: \"Unassigned\",\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[task.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".task-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      updateRelatedTask(task);\n      $el.on(\"click\", \".task-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", task);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", debounce(2000, (function(_this) {\n        return function(ctx, userId, updatedRelatedTask) {\n          if (updatedRelatedTask.id === task.id) {\n            updatedRelatedTask.assigned_to = userId;\n            if (autoSave) {\n              $repo.save(updatedRelatedTask).then(function() {\n                return $scope.$emit(\"related-tasks:assigned-to-changed\");\n              });\n            }\n            return updateRelatedTask(updatedRelatedTask);\n          }\n        };\n      })(this)));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", RelatedTaskAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources.coffee\n */\n\n(function() {\n  var ResourcesService, initResources, initUrls, module, taiga, urls,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ResourcesService = (function(superClass) {\n    extend(ResourcesService, superClass);\n\n    function ResourcesService() {\n      return ResourcesService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ResourcesService;\n\n  })(taiga.Service);\n\n  urls = {\n    \"auth\": \"/auth\",\n    \"auth-register\": \"/auth/register\",\n    \"invitations\": \"/invitations\",\n    \"users\": \"/users\",\n    \"by_username\": \"/users/by_username\",\n    \"users-password-recovery\": \"/users/password_recovery\",\n    \"users-change-password-from-recovery\": \"/users/change_password_from_recovery\",\n    \"users-change-password\": \"/users/change_password\",\n    \"users-change-email\": \"/users/change_email\",\n    \"users-cancel-account\": \"/users/cancel\",\n    \"user-stats\": \"/users/%s/stats\",\n    \"user-liked\": \"/users/%s/liked\",\n    \"user-voted\": \"/users/%s/voted\",\n    \"user-watched\": \"/users/%s/watched\",\n    \"user-contacts\": \"/users/%s/contacts\",\n    \"permissions\": \"/permissions\",\n    \"notify-policies\": \"/notify-policies\",\n    \"user-storage\": \"/user-storage\",\n    \"memberships\": \"/memberships\",\n    \"bulk-create-memberships\": \"/memberships/bulk_create\",\n    \"roles\": \"/roles\",\n    \"permissions\": \"/permissions\",\n    \"resolver\": \"/resolver\",\n    \"projects\": \"/projects\",\n    \"project-templates\": \"/project-templates\",\n    \"project-modules\": \"/projects/%s/modules\",\n    \"bulk-update-projects-order\": \"/projects/bulk_update_order\",\n    \"project-like\": \"/projects/%s/like\",\n    \"project-unlike\": \"/projects/%s/unlike\",\n    \"project-watch\": \"/projects/%s/watch\",\n    \"project-unwatch\": \"/projects/%s/unwatch\",\n    \"userstory-statuses\": \"/userstory-statuses\",\n    \"points\": \"/points\",\n    \"task-statuses\": \"/task-statuses\",\n    \"issue-statuses\": \"/issue-statuses\",\n    \"issue-types\": \"/issue-types\",\n    \"priorities\": \"/priorities\",\n    \"severities\": \"/severities\",\n    \"triggers\": \"/triggers\",\n    \"milestones\": \"/milestones\",\n    \"userstories\": \"/userstories\",\n    \"bulk-create-us\": \"/userstories/bulk_create\",\n    \"bulk-update-us-backlog-order\": \"/userstories/bulk_update_backlog_order\",\n    \"bulk-update-us-sprint-order\": \"/userstories/bulk_update_sprint_order\",\n    \"bulk-update-us-kanban-order\": \"/userstories/bulk_update_kanban_order\",\n    \"userstories-filters\": \"/userstories/filters_data\",\n    \"userstory-upvote\": \"/userstories/%s/upvote\",\n    \"userstory-downvote\": \"/userstories/%s/downvote\",\n    \"userstory-watch\": \"/userstories/%s/watch\",\n    \"userstory-unwatch\": \"/userstories/%s/unwatch\",\n    \"tasks\": \"/tasks\",\n    \"bulk-create-tasks\": \"/tasks/bulk_create\",\n    \"bulk-update-task-taskboard-order\": \"/tasks/bulk_update_taskboard_order\",\n    \"task-upvote\": \"/tasks/%s/upvote\",\n    \"task-downvote\": \"/tasks/%s/downvote\",\n    \"task-watch\": \"/tasks/%s/watch\",\n    \"task-unwatch\": \"/tasks/%s/unwatch\",\n    \"issues\": \"/issues\",\n    \"bulk-create-issues\": \"/issues/bulk_create\",\n    \"issues-filters\": \"/issues/filters_data\",\n    \"issue-upvote\": \"/issues/%s/upvote\",\n    \"issue-downvote\": \"/issues/%s/downvote\",\n    \"issue-watch\": \"/issues/%s/watch\",\n    \"issue-unwatch\": \"/issues/%s/unwatch\",\n    \"wiki\": \"/wiki\",\n    \"wiki-restore\": \"/wiki/%s/restore\",\n    \"wiki-links\": \"/wiki-links\",\n    \"history/us\": \"/history/userstory\",\n    \"history/issue\": \"/history/issue\",\n    \"history/task\": \"/history/task\",\n    \"history/wiki\": \"/history/wiki\",\n    \"attachments/us\": \"/userstories/attachments\",\n    \"attachments/issue\": \"/issues/attachments\",\n    \"attachments/task\": \"/tasks/attachments\",\n    \"attachments/wiki_page\": \"/wiki/attachments\",\n    \"custom-attributes/userstory\": \"/userstory-custom-attributes\",\n    \"custom-attributes/issue\": \"/issue-custom-attributes\",\n    \"custom-attributes/task\": \"/task-custom-attributes\",\n    \"custom-attributes-values/userstory\": \"/userstories/custom-attributes-values\",\n    \"custom-attributes-values/issue\": \"/issues/custom-attributes-values\",\n    \"custom-attributes-values/task\": \"/tasks/custom-attributes-values\",\n    \"webhooks\": \"/webhooks\",\n    \"webhooks-test\": \"/webhooks/%s/test\",\n    \"webhooklogs\": \"/webhooklogs\",\n    \"webhooklogs-resend\": \"/webhooklogs/%s/resend\",\n    \"userstories-csv\": \"/userstories/csv?uuid=%s\",\n    \"tasks-csv\": \"/tasks/csv?uuid=%s\",\n    \"issues-csv\": \"/issues/csv?uuid=%s\",\n    \"timeline-profile\": \"/timeline/profile\",\n    \"timeline-user\": \"/timeline/user\",\n    \"timeline-project\": \"/timeline/project\",\n    \"search\": \"/search\",\n    \"exporter\": \"/exporter\",\n    \"importer\": \"/importer/load_dump\",\n    \"feedback\": \"/feedback\",\n    \"locales\": \"/locales\",\n    \"applications\": \"/applications\",\n    \"application-tokens\": \"/application-tokens\"\n  };\n\n  initUrls = function($log, $urls) {\n    $log.debug(\"Initialize api urls\");\n    return $urls.update(urls);\n  };\n\n  initResources = function($log, $rs) {\n    var i, len, provider, providers, results;\n    $log.debug(\"Initialize resources\");\n    providers = _.toArray(arguments).slice(2);\n    results = [];\n    for (i = 0, len = providers.length; i < len; i++) {\n      provider = providers[i];\n      results.push(provider($rs));\n    }\n    return results;\n  };\n\n  module = angular.module(\"taigaResources\", [\"taigaBase\"]);\n\n  module.service(\"$tgResources\", ResourcesService);\n\n  module.run([\"$log\", \"$tgUrls\", initUrls]);\n\n  module.run([\"$log\", \"$tgResources\", \"$tgProjectsResourcesProvider\", \"$tgCustomAttributesResourcesProvider\", \"$tgCustomAttributesValuesResourcesProvider\", \"$tgMembershipsResourcesProvider\", \"$tgNotifyPoliciesResourcesProvider\", \"$tgInvitationsResourcesProvider\", \"$tgRolesResourcesProvider\", \"$tgUserSettingsResourcesProvider\", \"$tgSprintsResourcesProvider\", \"$tgUserstoriesResourcesProvider\", \"$tgTasksResourcesProvider\", \"$tgIssuesResourcesProvider\", \"$tgWikiResourcesProvider\", \"$tgSearchResourcesProvider\", \"$tgAttachmentsResourcesProvider\", \"$tgMdRenderResourcesProvider\", \"$tgHistoryResourcesProvider\", \"$tgKanbanResourcesProvider\", \"$tgModulesResourcesProvider\", \"$tgWebhooksResourcesProvider\", \"$tgWebhookLogsResourcesProvider\", \"$tgLocalesResourcesProvider\", \"$tgUsersResourcesProvider\", initResources]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/search.coffee\n */\n\n(function() {\n  var SearchBoxDirective, SearchController, SearchDirective, bindOnce, debounce, debounceLeading, groupBy, mixOf, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaSearch\", []);\n\n  SearchController = (function(superClass) {\n    extend(SearchController, superClass);\n\n    SearchController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$translate\"];\n\n    function SearchController(scope1, repo, rs, params, q, location, appMetaService, navUrls, translate) {\n      var loadSearchData, promise;\n      this.scope = scope1;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.scope.sectionName = \"Search\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"SEARCH.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"SEARCH.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.searchTerm = null;\n      loadSearchData = debounceLeading(100, (function(_this) {\n        return function(t) {\n          return _this.loadSearchData(t);\n        };\n      })(this));\n      bindOnce(this.scope, \"projectId\", (function(_this) {\n        return function(projectId) {\n          if (!_this.scope.searchResults && _this.scope.searchTerm) {\n            return _this.loadSearchData();\n          }\n        };\n      })(this));\n      this.scope.$watch(\"searchTerm\", (function(_this) {\n        return function(term) {\n          if (term !== void 0 && _this.scope.projectId) {\n            return _this.loadSearchData(term);\n          }\n        };\n      })(this));\n    }\n\n    SearchController.prototype.loadFilters = function() {\n      var defered;\n      defered = this.q.defer();\n      defered.resolve();\n      return defered.promise;\n    };\n\n    SearchController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    SearchController.prototype.loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      this.scope.loading = true;\n      return this._loadSearchData(term).then((function(_this) {\n        return function(data) {\n          _this.scope.searchResults = data;\n          return _this.scope.loading = false;\n        };\n      })(this));\n    };\n\n    SearchController.prototype._loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      if (this._promise) {\n        this._promise.abort();\n      }\n      this._promise = this.rs.search[\"do\"](this.scope.projectId, term);\n      return this._promise;\n    };\n\n    SearchController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          return _this.fillUsersAndRoles(project.members, project.roles);\n        };\n      })(this));\n    };\n\n    return SearchController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"SearchController\", SearchController);\n\n  SearchBoxDirective = function(projectService, $lightboxService, $navurls, $location, $route) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var openLightbox, project, submit;\n      project = null;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, text, url;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          text = $el.find(\"#search-text\").val();\n          url = $navurls.resolve(\"project-search\", {\n            project: project.get(\"slug\")\n          });\n          return $scope.$apply(function() {\n            $lightboxService.close($el);\n            $location.path(url);\n            $location.search(\"text\", text).path(url);\n            return $route.reload();\n          });\n        };\n      })(this));\n      openLightbox = function() {\n        project = projectService.project;\n        return $lightboxService.open($el).then(function() {\n          return $el.find(\"#search-text\").focus();\n        });\n      };\n      $el.on(\"submit\", \"form\", submit);\n      return openLightbox();\n    };\n    return {\n      templateUrl: \"search/lightbox-search.html\",\n      link: link\n    };\n  };\n\n  SearchBoxDirective.$inject = [\"tgProjectService\", \"lightboxService\", \"$tgNavUrls\", \"$tgLocation\", \"$route\"];\n\n  module.directive(\"tgSearchBox\", SearchBoxDirective);\n\n  SearchDirective = function($log, $compile, $templatecache, $routeparams, $location) {\n    var link, linkTable;\n    linkTable = function($scope, $el, $attrs, $ctrl) {\n      var activeSectionName, applyAutoTab, getActiveSection, lastSearchResults, markSectionTabActive, renderFilterTabs, renderTableContent, tabsDom, templates;\n      applyAutoTab = true;\n      activeSectionName = \"userstories\";\n      tabsDom = $el.find(\"section.search-filter\");\n      lastSearchResults = null;\n      getActiveSection = function(data) {\n        var i, len, maxVal, name, ref, selectedSection, value;\n        maxVal = 0;\n        selectedSection = {};\n        selectedSection.name = \"userstories\";\n        selectedSection.value = [];\n        if (!applyAutoTab) {\n          selectedSection.name = activeSectionName;\n          selectedSection.value = data[activeSectionName];\n          return selectedSection;\n        }\n        if (data) {\n          ref = [\"userstories\", \"issues\", \"tasks\", \"wikipages\"];\n          for (i = 0, len = ref.length; i < len; i++) {\n            name = ref[i];\n            value = data[name];\n            if (value.length > maxVal) {\n              maxVal = value.length;\n              selectedSection.name = name;\n              selectedSection.value = value;\n              break;\n            }\n          }\n        }\n        if (maxVal === 0) {\n          return selectedSection;\n        }\n        return selectedSection;\n      };\n      renderFilterTabs = function(data) {\n        var name, results, value;\n        results = [];\n        for (name in data) {\n          value = data[name];\n          if (name === \"count\") {\n            continue;\n          }\n          results.push(tabsDom.find(\"li.\" + name + \" .num\").html(value.length));\n        }\n        return results;\n      };\n      markSectionTabActive = function(section) {\n        tabsDom.find(\"a.active\").removeClass(\"active\");\n        tabsDom.find(\"li.\" + section.name + \" a\").addClass(\"active\");\n        applyAutoTab = false;\n        return activeSectionName = section.name;\n      };\n      templates = {\n        issues: $templatecache.get(\"search-issues\"),\n        tasks: $templatecache.get(\"search-tasks\"),\n        userstories: $templatecache.get(\"search-userstories\"),\n        wikipages: $templatecache.get(\"search-wikipages\")\n      };\n      renderTableContent = function(section) {\n        var element, oldElements, oldScope, scope, template;\n        oldElements = $el.find(\".search-result-table\").children();\n        oldScope = oldElements.scope();\n        if (oldScope) {\n          oldScope.$destroy();\n          oldElements.remove();\n        }\n        scope = $scope.$new();\n        scope[section.name] = section.value;\n        template = angular.element.parseHTML(trim(templates[section.name]));\n        element = $compile(template)(scope);\n        return $el.find(\".search-result-table\").html(element);\n      };\n      $scope.$watch(\"searchResults\", function(data) {\n        var activeSection;\n        lastSearchResults = data;\n        if (!lastSearchResults) {\n          return;\n        }\n        activeSection = getActiveSection(data);\n        renderFilterTabs(data);\n        renderTableContent(activeSection);\n        return markSectionTabActive(activeSection);\n      });\n      $scope.$watch(\"searchTerm\", function(searchTerm) {\n        if (searchTerm !== void 0) {\n          return $location.search(\"text\", searchTerm);\n        }\n      });\n      return $el.on(\"click\", \".search-filter li > a\", function(event) {\n        var section, sectionData, sectionName, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        sectionName = target.parent().data(\"name\");\n        sectionData = !lastSearchResults ? [] : lastSearchResults[sectionName];\n        section = {\n          name: sectionName,\n          value: sectionData\n        };\n        return $scope.$apply(function() {\n          renderTableContent(section);\n          return markSectionTabActive(section);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, searchText;\n      $ctrl = $el.controller();\n      linkTable($scope, $el, $attrs, $ctrl);\n      searchText = $routeparams.text;\n      return $scope.$watch(\"projectId\", function(projectId) {\n        if (projectId != null) {\n          return $scope.searchTerm = searchText;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSearch\", [\"$log\", \"$compile\", \"$templateCache\", \"$routeParams\", \"$tgLocation\", SearchDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTaskboard\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTasks\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTeam\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserSettings\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserStories\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaWiki\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/analytics.coffee\n */\n\n(function() {\n  var AnalyticsService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  AnalyticsService = (function(superClass) {\n    extend(AnalyticsService, superClass);\n\n    AnalyticsService.$inject = [\"$rootScope\", \"$log\", \"$tgConfig\", \"$window\", \"$document\", \"$location\"];\n\n    function AnalyticsService(rootscope, log, config, win, doc, location) {\n      var conf;\n      this.rootscope = rootscope;\n      this.log = log;\n      this.config = config;\n      this.win = win;\n      this.doc = doc;\n      this.location = location;\n      this.initialized = false;\n      conf = this.config.get(\"analytics\", {});\n      this.accountId = conf.accountId;\n      this.pageEvent = conf.pageEvent || \"$routeChangeSuccess\";\n      this.trackRoutes = conf.trackRoutes || true;\n      this.ignoreFirstPageLoad = conf.ignoreFirstPageLoad || false;\n    }\n\n    AnalyticsService.prototype.initialize = function() {\n      if (!this.accountId) {\n        this.log.debug(\"Analytics: no acount id provided. Disabling.\");\n        return;\n      }\n      this.injectAnalytics();\n      this.win.ga(\"create\", this.accountId, \"auto\");\n      this.win.ga(\"require\", \"displayfeatures\");\n      if (this.trackRoutes && (!this.ignoreFirstPageLoad)) {\n        this.win.ga(\"send\", \"pageview\", this.getUrl());\n      }\n      if (this.trackRoutes) {\n        this.rootscope.$on(this.pageEvent, (function(_this) {\n          return function() {\n            return _this.trackPage(_this.getUrl(), \"Taiga\");\n          };\n        })(this));\n      }\n      return this.initialized = true;\n    };\n\n    AnalyticsService.prototype.getUrl = function() {\n      return this.location.path();\n    };\n\n    AnalyticsService.prototype.injectAnalytics = function() {\n      var fn;\n      fn = (function(i,s,o,g,r,a,m){i[\"GoogleAnalyticsObject\"]=r;i[r]=i[r]||function(){\n              (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);});\n      return fn(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n    };\n\n    AnalyticsService.prototype.trackPage = function(url, title) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      title = title || this.doc[0].title;\n      return this.win.ga(\"send\", \"pageview\", {\n        \"page\": url,\n        \"title\": title\n      });\n    };\n\n    AnalyticsService.prototype.trackEvent = function(category, action, label, value) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga(\"send\", \"event\", category, action, label, value);\n    };\n\n    return AnalyticsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAnalytics\", AnalyticsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var AttachmentDirective, AttachmentsController, AttachmentsDirective, bindMethods, bindOnce, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaCommon\");\n\n  AttachmentsController = (function(superClass) {\n    extend(AttachmentsController, superClass);\n\n    AttachmentsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\", \"$translate\"];\n\n    function AttachmentsController(scope, rootscope, repo, rs, confirm, q, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      this.translate = translate;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.uploadingAttachments = [];\n      this.attachments = [];\n      this.attachmentsCount = 0;\n      this.deprecatedAttachmentsCount = 0;\n      this.showDeprecated = false;\n    }\n\n    AttachmentsController.prototype.initialize = function(type, objectId) {\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    AttachmentsController.prototype.loadAttachments = function() {\n      var urlname;\n      if (!this.objectId) {\n        return this.attachments;\n      }\n      urlname = \"attachments/\" + this.type;\n      return this.rs.attachments.list(urlname, this.objectId, this.projectId).then((function(_this) {\n        return function(attachments) {\n          _this.attachments = _.sortBy(attachments, \"order\");\n          _this.updateCounters();\n          return attachments;\n        };\n      })(this));\n    };\n\n    AttachmentsController.prototype.updateCounters = function() {\n      this.attachmentsCount = this.attachments.length;\n      return this.deprecatedAttachmentsCount = _.filter(this.attachments, {\n        is_deprecated: true\n      }).length;\n    };\n\n    AttachmentsController.prototype._createAttachment = function(attachment) {\n      var promise, urlName;\n      urlName = \"attachments/\" + this.type;\n      promise = this.rs.attachments.create(urlName, this.projectId, this.objectId, attachment);\n      promise = promise.then((function(_this) {\n        return function(data) {\n          var index;\n          data.isCreatedRightNow = true;\n          index = _this.uploadingAttachments.indexOf(attachment);\n          _this.uploadingAttachments.splice(index, 1);\n          _this.attachments.push(data);\n          return _this.rootscope.$broadcast(\"attachment:create\");\n        };\n      })(this));\n      promise = promise.then(null, (function(_this) {\n        return function(data) {\n          var index, message;\n          if (data.status === 413) {\n            _this.scope.$emit(\"attachments:size-error\");\n          }\n          index = _this.uploadingAttachments.indexOf(attachment);\n          _this.uploadingAttachments.splice(index, 1);\n          message = _this.translate.instant(\"ATTACHMENT.ERROR_UPLOAD_ATTACHMENT\", {\n            fileName: attachment.name,\n            errorMessage: data.data._error_message\n          });\n          _this.confirm.notify(\"error\", message);\n          return _this.q.reject(data);\n        };\n      })(this));\n      return promise;\n    };\n\n    AttachmentsController.prototype.createAttachments = function(attachments) {\n      var promises;\n      promises = _.map(attachments, (function(_this) {\n        return function(x) {\n          return _this._createAttachment(x);\n        };\n      })(this));\n      return this.q.all(promises).then((function(_this) {\n        return function() {\n          return _this.updateCounters();\n        };\n      })(this));\n    };\n\n    AttachmentsController.prototype.addUploadingAttachments = function(attachments) {\n      return this.uploadingAttachments = _.union(this.uploadingAttachments, attachments);\n    };\n\n    AttachmentsController.prototype.reorderAttachment = function(attachment, newIndex) {\n      var oldIndex;\n      oldIndex = this.attachments.indexOf(attachment);\n      if (oldIndex === newIndex) {\n        return;\n      }\n      this.attachments.splice(oldIndex, 1);\n      this.attachments.splice(newIndex, 0, attachment);\n      return _.each(this.attachments, function(x, i) {\n        return x.order = i + 1;\n      });\n    };\n\n    AttachmentsController.prototype.updateAttachment = function(attachment) {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.updateCounters();\n          return _this.rootscope.$broadcast(\"attachment:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          if (response.status === 413) {\n            $scope.$emit(\"attachments:size-error\");\n          }\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      return this.repo.save(attachment).then(onSuccess, onError);\n    };\n\n    AttachmentsController.prototype.saveAttachments = function() {\n      return this.repo.saveAll(this.attachments).then(null, (function(_this) {\n        return function() {\n          var item, j, len, ref;\n          ref = _this.attachments;\n          for (j = 0, len = ref.length; j < len; j++) {\n            item = ref[j];\n            item.revert();\n          }\n          return _this.attachments = _.sortBy(_this.attachments, \"order\");\n        };\n      })(this));\n    };\n\n    AttachmentsController.prototype.removeAttachment = function(attachment) {\n      var message, title;\n      title = this.translate.instant(\"ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT\");\n      message = this.translate.instant(\"ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT\", {\n        fileName: attachment.name\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var index;\n            askResponse.finish();\n            index = _this.attachments.indexOf(attachment);\n            _this.attachments.splice(index, 1);\n            _this.updateCounters();\n            return _this.rootscope.$broadcast(\"attachment:delete\");\n          };\n          onError = function() {\n            askResponse.finish(false);\n            message = _this.translate.instant(\"ATTACHMENT.ERROR_DELETE_ATTACHMENT\", {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return _this.q.reject();\n          };\n          return _this.repo.remove(attachment).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    AttachmentsController.prototype.filterAttachments = function(item) {\n      if (this.showDeprecated) {\n        return true;\n      }\n      return !item.is_deprecated;\n    };\n\n    return AttachmentsController;\n\n  })(taiga.Controller);\n\n  AttachmentsDirective = function($config, $confirm, $templates, $translate) {\n    var link, template, templateFn;\n    template = $templates.get(\"attachment/attachments.html\", true);\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model, showSizeInfo, tdom;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadAttachments();\n      });\n      tdom = $el.find(\"div.attachment-body.sortable\");\n      tdom.sortable({\n        items: \"div.single-attachment\",\n        handle: \"a.settings.icon.icon-drag-v\",\n        containment: \".attachments\",\n        dropOnEmpty: true,\n        scroll: false,\n        tolerance: \"pointer\",\n        placeholder: \"sortable-placeholder single-attachment\"\n      });\n      tdom.on(\"sortstop\", function(event, ui) {\n        var attachment, newIndex;\n        attachment = ui.item.scope().attach;\n        newIndex = ui.item.index();\n        $ctrl.reorderAttachment(attachment, newIndex);\n        return $ctrl.saveAttachments().then(function() {\n          return $scope.$emit(\"attachment:edit\");\n        });\n      });\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      $scope.$on(\"attachments:size-error\", function() {\n        return showSizeInfo();\n      });\n      $el.on(\"change\", \".attachments-header input\", function(event) {\n        var files;\n        files = _.toArray(event.target.files);\n        if (files.length < 1) {\n          return;\n        }\n        return $scope.$apply(function() {\n          $ctrl.addUploadingAttachments(files);\n          return $ctrl.createAttachments(files);\n        });\n      });\n      $el.on(\"click\", \".more-attachments\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $ctrl.showDeprecated = !$ctrl.showDeprecated;\n        });\n        target.find(\"span.text\").addClass(\"hidden\");\n        if ($ctrl.showDeprecated) {\n          target.find(\"span[data-type=hide]\").removeClass(\"hidden\");\n          return target.find(\"more-attachments-num\").addClass(\"hidden\");\n        } else {\n          target.find(\"span[data-type=show]\").removeClass(\"hidden\");\n          return target.find(\"more-attachments-num\").removeClass(\"hidden\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      var ctx, maxFileSize, maxFileSizeMsg;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        maxFileSize = sizeFormat(maxFileSize);\n      }\n      maxFileSizeMsg = maxFileSize ? $translate.instant(\"ATTACHMENT.MAX_UPLOAD_SIZE\", {\n        maxFileSize: maxFileSize\n      }) : \"\";\n      ctx = {\n        type: $attrs.type,\n        maxFileSize: maxFileSize,\n        maxFileSizeMsg: maxFileSizeMsg\n      };\n      return template(ctx);\n    };\n    return {\n      require: [\"tgAttachments\", \"ngModel\"],\n      controller: AttachmentsController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgAttachments\", [\"$tgConfig\", \"$tgConfirm\", \"$tgTemplate\", \"$translate\", AttachmentsDirective]);\n\n  AttachmentDirective = function($template, $compile, $translate, $rootScope) {\n    var link, template, templateEdit;\n    template = $template.get(\"attachment/attachment.html\", true);\n    templateEdit = $template.get(\"attachment/attachment-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attachment, render, saveAttachment;\n      render = function(attachment, edit) {\n        var ctx, html, modifyPermission, permissions;\n        if (edit == null) {\n          edit = false;\n        }\n        permissions = $scope.project.my_permissions;\n        modifyPermission = permissions.indexOf(\"modify_\" + $ctrl.type) > -1;\n        ctx = {\n          id: attachment.id,\n          name: attachment.name,\n          title: $translate.instant(\"ATTACHMENT.TITLE\", {\n            fileName: attachment.name,\n            date: moment(attachment.created_date).format($translate.instant(\"ATTACHMENT.DATE\"))\n          }),\n          url: attachment.url,\n          size: sizeFormat(attachment.size),\n          description: attachment.description,\n          isDeprecated: attachment.is_deprecated,\n          modifyPermission: modifyPermission\n        };\n        if (edit) {\n          html = $compile(templateEdit(ctx))($scope);\n        } else {\n          html = $compile(template(ctx))($scope);\n        }\n        $el.html(html);\n        if (attachment.is_deprecated) {\n          $el.addClass(\"deprecated\");\n          return $el.find(\"input:checkbox\").prop('checked', true);\n        } else {\n          return $el.removeClass(\"deprecated\");\n        }\n      };\n      saveAttachment = function() {\n        attachment.description = $el.find(\"input[name='description']\").val();\n        attachment.is_deprecated = $el.find(\"input[name='is-deprecated']\").prop(\"checked\");\n        attachment.isCreatedRightNow = false;\n        return $scope.$apply(function() {\n          return $ctrl.updateAttachment(attachment).then(function() {\n            return render(attachment, false);\n          });\n        });\n      };\n      $el.on(\"click\", \"a.editable-settings.icon-floppy\", function(event) {\n        event.preventDefault();\n        return saveAttachment();\n      });\n      $el.on(\"keyup\", \"input[name=description]\", function(event) {\n        if (event.keyCode === 13) {\n          return saveAttachment();\n        } else if (event.keyCode === 27) {\n          return $scope.$apply(function() {\n            return render(attachment, false);\n          });\n        }\n      });\n      $el.on(\"click\", \"a.editable-settings.icon-delete\", function(event) {\n        event.preventDefault();\n        return render(attachment, false);\n      });\n      $el.on(\"click\", \"a.settings.icon-edit\", function(event) {\n        event.preventDefault();\n        render(attachment, true);\n        return $el.find(\"input[name='description']\").focus().select();\n      });\n      $el.on(\"click\", \"a.settings.icon-delete\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return $ctrl.removeAttachment(attachment);\n        });\n      });\n      $el.on(\"click\", \"div.attachment-name a\", function(event) {\n        if (null !== attachment.name.match(/\\.(jpe?g|png|gif|gifv|webm)/i)) {\n          event.preventDefault();\n          return $scope.$apply(function() {\n            return $rootScope.$broadcast(\"attachment:preview\", attachment);\n          });\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      attachment = $scope.$eval($attrs.tgAttachment);\n      render(attachment, attachment.isCreatedRightNow);\n      if (attachment.isCreatedRightNow) {\n        return $el.find(\"input[name='description']\").focus().select();\n      }\n    };\n    return {\n      link: link,\n      require: \"^tgAttachments\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgAttachment\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$rootScope\", AttachmentDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: bind-scope.coffee\n */\n\n(function() {\n  var BindScope, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  BindScope = function(config) {\n    var link;\n    if (!config.debugInfo) {\n      jQuery.fn.scope = function() {\n        return this.data('scope');\n      };\n    }\n    link = function($scope, $el) {\n      if (!config.debugInfo) {\n        return $el.data('scope', $scope).addClass('tg-scope');\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBindScope\", [\"$tgConfig\", BindScope]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: compile-html.directive.coffee\n */\n\n(function() {\n  var CompileHtmlDirective;\n\n  CompileHtmlDirective = function($compile) {\n    var link;\n    link = function(scope, element, attrs) {\n      return scope.$watch(attrs.tgCompileHtml, function(newValue, oldValue) {\n        element.html(newValue);\n        return $compile(element.contents())(scope);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CompileHtmlDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaCommon\").directive(\"tgCompileHtml\", CompileHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/components.coffee\n */\n\n(function() {\n  var AssignedToDirective, BlockButtonDirective, CreatedByDisplayDirective, DateRangeDirective, DateSelectorDirective, DeleteButtonDirective, EditableDescriptionDirective, EditableSubjectDirective, ListItemAssignedtoDirective, ListItemIssueStatusDirective, ListItemPriorityDirective, ListItemSeverityDirective, ListItemTaskStatusDirective, ListItemTriggerDirective, ListItemTypeDirective, ListItemUsStatusDirective, SprintProgressBarDirective, TgMainTitleDirective, TgProgressBarDirective, WatchersDirective, bindOnce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  DateRangeDirective = function($translate) {\n    var link, renderRange;\n    renderRange = function($el, first, second) {\n      var endDate, initDate, prettyDate;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      initDate = moment(first).format(prettyDate);\n      endDate = moment(second).format(prettyDate);\n      return $el.html(initDate + \"-\" + endDate);\n    };\n    link = function($scope, $el, $attrs) {\n      var first, ref, second;\n      ref = $attrs.tgDateRange.split(\",\"), first = ref[0], second = ref[1];\n      return bindOnce($scope, first, function(valFirst) {\n        return bindOnce($scope, second, function(valSecond) {\n          return renderRange($el, valFirst, valSecond);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateRange\", [\"$translate\", DateRangeDirective]);\n\n  DateSelectorDirective = function($rootscope, datePickerConfigService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var initialize, selectedDate, unbind;\n      selectedDate = null;\n      initialize = function() {\n        var datePickerConfig;\n        datePickerConfig = datePickerConfigService.get();\n        _.merge(datePickerConfig, {\n          field: $el[0],\n          onSelect: (function(_this) {\n            return function(date) {\n              return selectedDate = date;\n            };\n          })(this),\n          onOpen: (function(_this) {\n            return function() {\n              if (selectedDate != null) {\n                return $el.picker.setDate(selectedDate);\n              }\n            };\n          })(this)\n        });\n        return $el.picker = new Pikaday(datePickerConfig);\n      };\n      unbind = $rootscope.$on(\"$translateChangeEnd\", (function(_this) {\n        return function(ctx) {\n          return initialize();\n        };\n      })(this));\n      $scope.$watch($attrs.ngModel, function(val) {\n        if ((val != null) && !$el.picker) {\n          initialize();\n        }\n        if (val != null) {\n          return $el.picker.setDate(val);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgDateSelector\", [\"$rootScope\", \"tgDatePickerConfigService\", DateSelectorDirective]);\n\n  SprintProgressBarDirective = function() {\n    var link, renderProgress;\n    renderProgress = function($el, percentage, visual_percentage) {\n      if ($el.hasClass(\".current-progress\")) {\n        return $el.css(\"width\", percentage + \"%\");\n      } else {\n        $el.find(\".current-progress\").css(\"width\", visual_percentage + \"%\");\n        return $el.find(\".number\").html(percentage + \" %\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.tgSprintProgressbar, function(sprint) {\n        var closedPoints, percentage, totalPoints, visual_percentage;\n        closedPoints = sprint.closed_points;\n        totalPoints = sprint.total_points;\n        percentage = 0;\n        if (totalPoints !== 0) {\n          percentage = Math.round(100 * (closedPoints / totalPoints));\n        }\n        visual_percentage = 0;\n        if (totalPoints !== 0) {\n          visual_percentage = Math.round(98 * (closedPoints / totalPoints));\n        }\n        return renderProgress($el, percentage, visual_percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintProgressbar\", SprintProgressBarDirective);\n\n  CreatedByDisplayDirective = function($template, $compile, $translate, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        var ref;\n        if (model != null) {\n          $scope.owner = model.owner_extra_info || {\n            full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\"),\n            photo: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n          $scope.url = ((ref = $scope.owner) != null ? ref.is_active : void 0) ? $navUrls.resolve(\"user-profile\", {\n            username: $scope.owner.username\n          }) : \"\";\n          return $scope.date = moment(model.created_date).format($translate.instant(\"COMMON.DATETIME\"));\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true,\n      templateUrl: \"common/components/created-by.html\"\n    };\n  };\n\n  module.directive(\"tgCreatedByDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", CreatedByDisplayDirective]);\n\n  WatchersDirective = function($rootscope, $confirm, $repo, $qqueue, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/watchers.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var deleteWatcher, isEditable, renderWatchers, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(watchers) {\n          var item, promise;\n          item = $model.$modelValue.clone();\n          item.watchers = watchers;\n          $model.$setViewValue(item);\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            watchers = _.map(watchers, function(watcherId) {\n              return $scope.usersById[watcherId];\n            });\n            renderWatchers(watchers);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            return $model.$modelValue.revert();\n          });\n        };\n      })(this));\n      deleteWatcher = $qqueue.bindAdd((function(_this) {\n        return function(watcherIds) {\n          var item, promise;\n          item = $model.$modelValue.clone();\n          item.watchers = watcherIds;\n          $model.$setViewValue(item);\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            var watchers;\n            $confirm.notify(\"success\");\n            watchers = _.map(item.watchers, function(watcherId) {\n              return $scope.usersById[watcherId];\n            });\n            renderWatchers(watchers);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            item.revert();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      renderWatchers = function(watchers) {\n        var ctx, html;\n        ctx = {\n          watchers: watchers,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".js-delete-watcher\", function(event) {\n        var message, target, title, watcherId;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        watcherId = target.data(\"watcher-id\");\n        title = $translate.instant(\"COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER\");\n        message = $scope.usersById[watcherId].full_name_display;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var watcherIds;\n            askResponse.finish();\n            watcherIds = _.clone($model.$modelValue.watchers, false);\n            watcherIds = _.pull(watcherIds, watcherId);\n            return deleteWatcher(watcherIds);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".js-add-watcher\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"watcher:add\", $model.$modelValue);\n        });\n      });\n      $scope.$on(\"watcher:added\", function(ctx, watcherId) {\n        var watchers;\n        watchers = _.clone($model.$modelValue.watchers, false);\n        watchers.push(watcherId);\n        watchers = _.uniq(watchers);\n        return save(watchers);\n      });\n      $scope.$watch($attrs.ngModel, function(item) {\n        var watchers;\n        if (item == null) {\n          return;\n        }\n        watchers = _.map(item.watchers, function(watcherId) {\n          return $scope.usersById[watcherId];\n        });\n        return renderWatchers(watchers);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWatchers\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", \"$translate\", WatchersDirective]);\n\n  AssignedToDirective = function($rootscope, $confirm, $repo, $loading, $qqueue, $template, $translate, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/assigned-to.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, renderAssignedTo, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(userId) {\n          var currentLoading, promise;\n          $model.$modelValue.assigned_to = userId;\n          currentLoading = $loading().target($el).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            renderAssignedTo($model.$modelValue);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            $model.$modelValue.revert();\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          });\n          return promise;\n        };\n      })(this));\n      renderAssignedTo = function(issue) {\n        var assignedTo, assignedToId, ctx, html;\n        assignedToId = issue != null ? issue.assigned_to : void 0;\n        assignedTo = assignedToId != null ? $scope.usersById[assignedToId] : null;\n        ctx = {\n          assignedTo: assignedTo,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".user-assigned\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"assigned-to:add\", $model.$modelValue);\n        });\n      });\n      $el.on(\"click\", \".icon-delete\", function(event) {\n        var title;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        title = $translate.instant(\"COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED\");\n        return $confirm.ask(title).then((function(_this) {\n          return function(response) {\n            response.finish();\n            $model.$modelValue.assigned_to = null;\n            return save(null);\n          };\n        })(this));\n      });\n      $scope.$on(\"assigned-to:added\", function(ctx, userId, item) {\n        if (item.id !== $model.$modelValue.id) {\n          return;\n        }\n        return save(userId);\n      });\n      $scope.$watch($attrs.ngModel, function(instance) {\n        return renderAssignedTo(instance);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgAssignedTo\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$translate\", \"$compile\", AssignedToDirective]);\n\n  BlockButtonDirective = function($rootscope, $loading, $template) {\n    var link, template;\n    template = $template.get(\"common/components/block-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      $scope.$watch($attrs.ngModel, function(item) {\n        if (!item) {\n          return;\n        }\n        if (isEditable()) {\n          $el.find('.item-block').addClass('editable');\n        }\n        if (item.is_blocked) {\n          $el.find('.item-block').hide();\n          return $el.find('.item-unblock').show();\n        } else {\n          $el.find('.item-block').show();\n          return $el.find('.item-unblock').hide();\n        }\n      });\n      $el.on(\"click\", \".item-block\", function(event) {\n        event.preventDefault();\n        return $rootscope.$broadcast(\"block\", $model.$modelValue);\n      });\n      $el.on(\"click\", \".item-unblock\", function(event) {\n        var currentLoading, finish;\n        event.preventDefault();\n        currentLoading = $loading().target($el.find(\".item-unblock\")).start();\n        finish = function() {\n          return currentLoading.finish();\n        };\n        return $rootscope.$broadcast(\"unblock\", $model.$modelValue, finish);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgBlockButton\", [\"$rootScope\", \"$tgLoading\", \"$tgTemplate\", BlockButtonDirective]);\n\n  DeleteButtonDirective = function($log, $repo, $confirm, $location, $template) {\n    var link, template;\n    template = $template.get(\"common/components/delete-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.onDeleteGoToUrl) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-go-to-url set in scope.\");\n      }\n      if (!$attrs.onDeleteTitle) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-title set in scope.\");\n      }\n      $el.on(\"click\", \".button-delete\", function(event) {\n        var subtitle, title;\n        title = $attrs.onDeleteTitle;\n        subtitle = $model.$modelValue.subject;\n        return $confirm.askOnDelete(title, subtitle).then((function(_this) {\n          return function(askResponse) {\n            var promise;\n            promise = $repo.remove($model.$modelValue);\n            promise.then(function() {\n              var url;\n              askResponse.finish();\n              url = $scope.$eval($attrs.onDeleteGoToUrl);\n              return $location.path(url);\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgDeleteButton\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgTemplate\", DeleteButtonDirective]);\n\n  EditableSubjectDirective = function($rootscope, $repo, $confirm, $loading, $qqueue, $template) {\n    var link, template;\n    template = $template.get(\"common/components/editable-subject.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-subject').hide();\n        return $el.find('.view-subject').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(subject) {\n          var currentLoading, promise;\n          $model.$modelValue.subject = subject;\n          currentLoading = $loading().target($el.find('.save-container')).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-subject').hide();\n            return $el.find('.view-subject').show();\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n          return promise;\n        };\n      })(this));\n      $el.click(function() {\n        if (!isEditable()) {\n          return;\n        }\n        $el.find('.edit-subject').show();\n        $el.find('.view-subject').hide();\n        return $el.find('input').focus();\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var subject;\n        e.preventDefault();\n        subject = $scope.item.subject;\n        return save(subject);\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var subject;\n        if (event.keyCode === 13) {\n          subject = $scope.item.subject;\n          return save(subject);\n        } else if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $model.$modelValue.revert();\n            };\n          })(this));\n          $el.find('div.edit-subject').hide();\n          return $el.find('div.view-subject').show();\n        }\n      });\n      $el.find('div.edit-subject').hide();\n      $el.find('div.view-subject span.edit').hide();\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (!isEditable()) {\n          return $el.find('.view-subject .edit').remove();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableSubject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", EditableSubjectDirective]);\n\n  EditableDescriptionDirective = function($rootscope, $repo, $confirm, $compile, $loading, $selectedText, $qqueue, $template) {\n    var link, noDescriptionMegEditMode, noDescriptionMegReadMode, template;\n    template = $template.get(\"common/components/editable-description.html\");\n    noDescriptionMegEditMode = $template.get(\"common/components/editable-description-msg-edit-mode.html\");\n    noDescriptionMegReadMode = $template.get(\"common/components/editable-description-msg-read-mode.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $el.find('.edit-description').hide();\n      $el.find('.view-description .edit').hide();\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(description) {\n          var currentLoading, promise;\n          $model.$modelValue.description = description;\n          currentLoading = $loading().target($el.find('.save-container')).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-description').hide();\n            return $el.find('.view-description').show();\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          return promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n      $el.on(\"mouseup\", \".view-description\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        $el.find('.edit-description').show();\n        $el.find('.view-description').hide();\n        return $el.find('textarea').focus();\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var description;\n        e.preventDefault();\n        description = $scope.item.description;\n        return save(description);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $scope.item.revert();\n            };\n          })(this));\n          $el.find('.edit-description').hide();\n          return $el.find('.view-description').show();\n        }\n      });\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (isEditable()) {\n          $el.find('.view-description .edit').show();\n          $el.find('.view-description .us-content').addClass('editable');\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegEditMode)($scope);\n        } else {\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegReadMode)($scope);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableDescription\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", \"$tgLoading\", \"$selectedText\", \"$tgQqueue\", \"$tgTemplate\", EditableDescriptionDirective]);\n\n  ListItemUsStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var us;\n      us = $scope.$eval($attrs.tgListitemUsStatus);\n      return bindOnce($scope, \"usStatusById\", function(usStatusById) {\n        return $el.html(usStatusById[us.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemUsStatus\", ListItemUsStatusDirective);\n\n  ListItemTaskStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var task;\n      task = $scope.$eval($attrs.tgListitemTaskStatus);\n      return bindOnce($scope, \"taskStatusById\", function(taskStatusById) {\n        return $el.html(taskStatusById[task.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTaskStatus\", ListItemTaskStatusDirective);\n\n  ListItemAssignedtoDirective = function($template) {\n    var link, template;\n    template = $template.get(\"common/components/list-item-assigned-to-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"usersById\", function(usersById) {\n        var ctx, item, member;\n        item = $scope.$eval($attrs.tgListitemAssignedto);\n        ctx = {\n          name: \"Unassigned\",\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = usersById[item.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        return $el.html(template(ctx));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemAssignedto\", [\"$tgTemplate\", ListItemAssignedtoDirective]);\n\n  ListItemIssueStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemIssueStatus);\n      return bindOnce($scope, \"issueStatusById\", function(issueStatusById) {\n        return $el.html(issueStatusById[issue.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemIssueStatus\", ListItemIssueStatusDirective);\n\n  ListItemTypeDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issueTypeById, issue) {\n        var domNode, type;\n        type = issueTypeById[issue.type];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", type.color);\n        return domNode.attr(\"title\", type.name);\n      };\n      bindOnce($scope, \"issueTypeById\", function(issueTypeById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemType);\n        return render(issueTypeById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemType, function(issue) {\n        return render($scope.issueTypeById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemType\", ListItemTypeDirective);\n\n  ListItemPriorityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(priorityById, issue) {\n        var domNode, priority;\n        priority = priorityById[issue.priority];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", priority.color);\n        return domNode.attr(\"title\", priority.name);\n      };\n      bindOnce($scope, \"priorityById\", function(priorityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemPriority);\n        return render(priorityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemPriority, function(issue) {\n        return render($scope.priorityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemPriority\", ListItemPriorityDirective);\n\n  ListItemSeverityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(severityById, issue) {\n        var domNode, severity;\n        severity = severityById[issue.severity];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", severity.color);\n        return domNode.attr(\"title\", severity.name);\n      };\n      bindOnce($scope, \"severityById\", function(severityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemSeverity);\n        return render(severityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemSeverity, function(issue) {\n        return render($scope.severityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemSeverity\", ListItemSeverityDirective);\n\n  ListItemTriggerDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemTrigger);\n      return bindOnce($scope, \"triggerById\", function(triggerById) {\n        return $el.html(triggerById[issue.trigger].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTrigger\", ListItemTriggerDirective);\n\n  TgProgressBarDirective = function($template) {\n    var link, render, template;\n    template = $template.get(\"common/components/progress-bar.html\", true);\n    render = function(el, percentage) {\n      return el.html(template({\n        percentage: percentage\n      }));\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgProgressBar, function(percentage) {\n        percentage = _.max([0, percentage]);\n        percentage = _.min([100, percentage]);\n        return render($el, percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProgressBar\", [\"$tgTemplate\", TgProgressBarDirective]);\n\n  TgMainTitleDirective = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $attrs.$observe(\"i18nSectionName\", function(i18nSectionName) {\n        return $scope.sectionName = $translate.instant(i18nSectionName);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/main-title.html\",\n      scope: {\n        projectName: \"=projectName\"\n      }\n    };\n  };\n\n  module.directive(\"tgMainTitle\", [\"$translate\", TgMainTitleDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/confirm.coffee\n */\n\n(function() {\n  var ConfirmService, NOTIFICATION_MSG, bindMethods, cancelTimeout, debounce, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  timeout = this.taiga.timeout;\n\n  cancelTimeout = this.taiga.cancelTimeout;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  NOTIFICATION_MSG = {\n    \"success\": {\n      title: \"NOTIFICATION.OK\",\n      message: \"NOTIFICATION.SAVED\"\n    },\n    \"error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    },\n    \"light-error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    }\n  };\n\n  ConfirmService = (function(superClass) {\n    extend(ConfirmService, superClass);\n\n    ConfirmService.$inject = [\"$q\", \"lightboxService\", \"$tgLoading\", \"$translate\"];\n\n    function ConfirmService(q, lightboxService, loading, translate) {\n      this.q = q;\n      this.lightboxService = lightboxService;\n      this.loading = loading;\n      this.translate = translate;\n      bindMethods(this);\n    }\n\n    ConfirmService.prototype.hide = function(el) {\n      if (el) {\n        this.lightboxService.close(el);\n        return el.off(\".confirm-dialog\");\n      }\n    };\n\n    ConfirmService.prototype.ask = function(title, subtitle, message, lightboxSelector) {\n      var defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-generic-ask\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\"h2.title\").text(title);\n      el.find(\"span.subtitle\").text(subtitle);\n      el.find(\"span.message\").text(message);\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \"a.button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.askOnDelete = function(title, message) {\n      return this.ask(title, this.translate.instant(\"NOTIFICATION.ASK_DELETE\"), message);\n    };\n\n    ConfirmService.prototype.askChoice = function(title, subtitle, choices, replacement, warning, lightboxSelector) {\n      var choicesField, defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-ask-choice\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").html(title);\n      el.find(\".subtitle\").html(subtitle);\n      if (replacement) {\n        el.find(\".replacement\").html(replacement);\n      } else {\n        el.find(\".replacement\").remove();\n      }\n      if (warning) {\n        el.find(\".warning\").html(warning);\n      } else {\n        el.find(\".warning\").remove();\n      }\n      choicesField = el.find(\".choices\");\n      choicesField.html('');\n      _.each(choices, function(value, key) {\n        return choicesField.append(angular.element(\"<option value='\" + key + \"'>\" + value + \"</option>\"));\n      });\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            selected: choicesField.val(),\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \"a.button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.error = function(message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-error\");\n      el.find(\"h2.title\").html(message);\n      el.on(\"click.confirm-dialog\", \"a.button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \"a.close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.success = function(title, message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-success\");\n      if (title) {\n        el.find(\"h2.title\").html(title);\n      }\n      if (message) {\n        el.find(\"p.message\").html(message);\n      }\n      el.on(\"click.confirm-dialog\", \"a.button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \"a.close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.loader = function(title, message) {\n      var el;\n      el = angular.element(\".lightbox-generic-loading\");\n      if (title) {\n        el.find(\"h2.title\").html(title);\n      }\n      if (message) {\n        el.find(\"p.message\").html(message);\n      }\n      return {\n        start: (function(_this) {\n          return function() {\n            return _this.lightboxService.open(el);\n          };\n        })(this),\n        stop: (function(_this) {\n          return function() {\n            return _this.lightboxService.close(el);\n          };\n        })(this),\n        update: (function(_this) {\n          return function(status, title, message, percent) {\n            if (title) {\n              el.find(\"h2.title\").html(title);\n            }\n            if (message) {\n              el.find(\"p.message\").html(message);\n            }\n            if (percent) {\n              el.find(\".spin\").addClass(\"hidden\");\n              el.find(\".progress-bar-wrapper\").removeClass(\"hidden\");\n              el.find(\".progress-bar-wrapper > .bar\").width(percent + '%');\n              return el.find(\".progress-bar-wrapper > span\").html(percent + '%').css('left', (percent - 9) + '%');\n            } else {\n              el.find(\".spin\").removeClass(\"hidden\");\n              return el.find(\".progress-bar-wrapper\").addClass(\"hidden\");\n            }\n          };\n        })(this)\n      };\n    };\n\n    ConfirmService.prototype.notify = function(type, message, title, time) {\n      var body, el, selector;\n      selector = \".notification-message-\" + type;\n      el = angular.element(selector);\n      if (el.hasClass(\"active\")) {\n        return;\n      }\n      if (title) {\n        el.find(\"h4\").html(title);\n      } else {\n        el.find(\"h4\").html(this.translate.instant(NOTIFICATION_MSG[type].title));\n      }\n      if (message) {\n        el.find(\"p\").html(message);\n      } else {\n        el.find(\"p\").html(this.translate.instant(NOTIFICATION_MSG[type].message));\n      }\n      body = angular.element(\"body\");\n      body.find(\".notification-message .notification-light\").removeClass('active').addClass('inactive');\n      body.find(selector).removeClass('inactive').addClass('active');\n      if (this.tsem) {\n        cancelTimeout(this.tsem);\n      }\n      if (!time) {\n        time = type === 'error' || type === 'light-error' ? 3500 : 1500;\n      }\n      this.tsem = timeout(time, (function(_this) {\n        return function() {\n          body.find(selector).removeClass('active').addClass('inactive');\n          return delete _this.tsem;\n        };\n      })(this));\n      return el.on(\"click\", \".icon-delete, .close\", (function(_this) {\n        return function(event) {\n          return body.find(selector).removeClass('active').addClass('inactive');\n        };\n      })(this));\n    };\n\n    return ConfirmService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaCommon\");\n\n  module.service(\"$tgConfirm\", ConfirmService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/custom-field-values.coffee\n */\n\n(function() {\n  var CustomAttributeValueDirective, CustomAttributesValuesController, CustomAttributesValuesDirective, DATE_TYPE, MULTILINE_TYPE, SELECT_TYPE, TEXT_TYPE, TYPE_CHOICES, bindMethods, bindOnce, debounce, generateHash, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = this.taiga.bindMethods;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  generateHash = taiga.generateHash;\n\n  module = angular.module(\"taigaCommon\");\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  SELECT_TYPE = \"select\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: SELECT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_SELECT\"\n    }\n  ];\n\n  CustomAttributesValuesController = (function(superClass) {\n    extend(CustomAttributesValuesController, superClass);\n\n    CustomAttributesValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\"];\n\n    function CustomAttributesValuesController(scope, rootscope, repo, rs, confirm, q) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.customAttributes = [];\n      this.customAttributesValues = null;\n    }\n\n    CustomAttributesValuesController.prototype.initialize = function(type, objectId) {\n      this.project = this.scope.project;\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    CustomAttributesValuesController.prototype.loadCustomAttributesValues = function() {\n      if (!this.objectId) {\n        return this.customAttributesValues;\n      }\n      return this.rs.customAttributesValues[this.type].get(this.objectId).then((function(_this) {\n        return function(customAttributesValues) {\n          _this.customAttributes = _this.project[_this.type + \"_custom_attributes\"];\n          _this.customAttributesValues = customAttributesValues;\n          return customAttributesValues;\n        };\n      })(this));\n    };\n\n    CustomAttributesValuesController.prototype.getAttributeValue = function(attribute) {\n      var attributeValue;\n      attributeValue = _.clone(attribute, false);\n      attributeValue.value = this.customAttributesValues.attributes_values[attribute.id];\n      return attributeValue;\n    };\n\n    CustomAttributesValuesController.prototype.updateAttributeValue = function(attributeValue) {\n      var attributesValues, onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"custom-attributes-values:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      attributesValues = _.clone(this.customAttributesValues.attributes_values, true);\n      attributesValues[attributeValue.id] = attributeValue.value;\n      this.customAttributesValues.attributes_values = attributesValues;\n      this.customAttributesValues.id = this.objectId;\n      return this.repo.save(this.customAttributesValues).then(onSuccess, onError);\n    };\n\n    return CustomAttributesValuesController;\n\n  })(taiga.Controller);\n\n  CustomAttributesValuesDirective = function($templates, $storage) {\n    var collapsedHash, link, template, templateFn;\n    template = $templates.get(\"custom-attributes/custom-attributes-values.html\", true);\n    collapsedHash = function(type) {\n      return generateHash([\"custom-attributes-collapsed\", type]);\n    };\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadCustomAttributesValues();\n      });\n      $el.on(\"click\", \".custom-fields-header a\", function() {\n        var collapsed, hash;\n        hash = collapsedHash($attrs.type);\n        collapsed = !($storage.get(hash) || false);\n        $storage.set(hash, collapsed);\n        if (collapsed) {\n          $el.find(\".custom-fields-header a\").removeClass(\"open\");\n          return $el.find(\".custom-fields-body\").removeClass(\"open\");\n        } else {\n          $el.find(\".custom-fields-header a\").addClass(\"open\");\n          return $el.find(\".custom-fields-body\").addClass(\"open\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      var collapsed;\n      collapsed = $storage.get(collapsedHash($attrs.type)) || false;\n      return template({\n        requiredEditionPerm: $attrs.requiredEditionPerm,\n        collapsed: collapsed\n      });\n    };\n    return {\n      require: [\"tgCustomAttributesValues\", \"ngModel\"],\n      controller: CustomAttributesValuesController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgCustomAttributesValues\", [\"$tgTemplate\", \"$tgStorage\", \"$translate\", CustomAttributesValuesDirective]);\n\n  CustomAttributeValueDirective = function($template, $selectedText, $compile, $translate, datePickerConfigService) {\n    var link, template, templateEdit;\n    template = $template.get(\"custom-attributes/custom-attribute-value.html\", true);\n    templateEdit = $template.get(\"custom-attributes/custom-attribute-value-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attributeValue, isEditable, prettyDate, render, setFocusAndSelectOnInputField, submit;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      render = function(attributeValue, edit) {\n        var ctx, datePickerConfig, editable, html, value;\n        if (edit == null) {\n          edit = false;\n        }\n        if (attributeValue.type === DATE_TYPE && attributeValue.value) {\n          value = moment(attributeValue.value, \"YYYY-MM-DD\").format(prettyDate);\n        } else {\n          value = attributeValue.value;\n        }\n        editable = isEditable();\n        ctx = {\n          id: attributeValue.id,\n          name: attributeValue.name,\n          description: attributeValue.description,\n          value: value,\n          isEditable: editable,\n          type: attributeValue.type\n        };\n        if (editable && (edit || !value)) {\n          html = templateEdit(ctx);\n          html = $compile(html)($scope);\n          $el.html(html);\n          if (attributeValue.type === DATE_TYPE) {\n            datePickerConfig = datePickerConfigService.get();\n            _.merge(datePickerConfig, {\n              field: $el.find(\"input[name=value]\")[0],\n              onSelect: (function(_this) {\n                return function(date) {\n                  var selectedDate;\n                  return selectedDate = date;\n                };\n              })(this),\n              onOpen: (function(_this) {\n                return function() {\n                  if (typeof selectedDate !== \"undefined\" && selectedDate !== null) {\n                    return $el.picker.setDate(selectedDate);\n                  }\n                };\n              })(this)\n            });\n            return $el.picker = new Pikaday(datePickerConfig);\n          }\n        } else {\n          html = template(ctx);\n          html = $compile(html)($scope);\n          return $el.html(html);\n        }\n      };\n      isEditable = function() {\n        var permissions, requiredEditionPerm;\n        permissions = $scope.project.my_permissions;\n        requiredEditionPerm = $attrs.requiredEditionPerm;\n        return permissions.indexOf(requiredEditionPerm) > -1;\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          attributeValue.value = $el.find(\"input[name=value], textarea[name='value'], select[name='value']\").val();\n          if (attributeValue.type === DATE_TYPE) {\n            if (moment(attributeValue.value, prettyDate).isValid()) {\n              attributeValue.value = moment(attributeValue.value, prettyDate).format(\"YYYY-MM-DD\");\n            } else {\n              attributeValue.value = \"\";\n            }\n          }\n          return $scope.$apply(function() {\n            return $ctrl.updateAttributeValue(attributeValue).then(function() {\n              return render(attributeValue, false);\n            });\n          });\n        };\n      })(this));\n      setFocusAndSelectOnInputField = function() {\n        return $el.find(\"input[name='value'], textarea[name='value'], select[name='value']\").focus().select();\n      };\n      attributeValue = $scope.$eval($attrs.tgCustomAttributeValue);\n      render(attributeValue);\n      $el.on(\"click\", \".js-value-view-mode\", function() {\n        if (!isEditable()) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"click\", \"a.icon-edit\", function(event) {\n        event.preventDefault();\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"keyup\", \"input[name=value], textarea[name='value'], select[name='value']\", function(event) {\n        if (event.keyCode === 13 && event.currentTarget.type !== \"textarea\" && event.currentTarget.type !== \"select\") {\n          return submit(event);\n        } else if (event.keyCode === 27) {\n          return render(attributeValue, false);\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \"a.icon-floppy\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"^tgCustomAttributesValues\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgCustomAttributeValue\", [\"$tgTemplate\", \"$selectedText\", \"$compile\", \"$translate\", \"tgDatePickerConfigService\", CustomAttributeValueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/estimation.coffee\n */\n\n(function() {\n  var EstimationsService, LbUsEstimationDirective, UsEstimationDirective, groupBy, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaCommon\");\n\n  LbUsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $confirm, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return $scope.$apply(function() {\n              return $model.$setViewValue(us);\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", LbUsEstimationDirective]);\n\n  UsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $confirm, $qqueue, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return this.save(roleId, pointId).then(function() {\n              return $rootScope.$broadcast(\"object:updated\");\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsEstimationDirective]);\n\n  EstimationsService = function($template, $qqueue, $repo, $confirm, $q) {\n    var EstimationProcess, create, pointsTemplate;\n    pointsTemplate = $template.get(\"common/estimation/us-estimation-points.html\", true);\n    EstimationProcess = (function() {\n      function EstimationProcess($el1, us1, project1) {\n        this.$el = $el1;\n        this.us = us1;\n        this.project = project1;\n        this.bindClickEvents = bind(this.bindClickEvents, this);\n        this.isEditable = this.project.my_permissions.indexOf(\"modify_us\") !== -1;\n        this.roles = this.project.roles;\n        this.points = this.project.points;\n        this.pointsById = groupBy(this.points, function(x) {\n          return x.id;\n        });\n        this.onSelectedPointForRole = function(roleId, pointId) {};\n        this.render = function() {};\n      }\n\n      EstimationProcess.prototype.save = function(roleId, pointId) {\n        var deferred;\n        deferred = $q.defer();\n        $qqueue.add((function(_this) {\n          return function() {\n            var onError, onSuccess;\n            onSuccess = function() {\n              deferred.resolve();\n              return $confirm.notify(\"success\");\n            };\n            onError = function() {\n              $confirm.notify(\"error\");\n              _this.us.revert();\n              _this.render();\n              return deferred.reject();\n            };\n            return $repo.save(_this.us).then(onSuccess, onError);\n          };\n        })(this));\n        return deferred.promise;\n      };\n\n      EstimationProcess.prototype.calculateTotalPoints = function() {\n        var notNullValues, values;\n        values = _.map(this.us.points, (function(_this) {\n          return function(v, k) {\n            var ref;\n            return (ref = _this.pointsById[v]) != null ? ref.value : void 0;\n          };\n        })(this));\n        if (values.length === 0) {\n          return \"0\";\n        }\n        notNullValues = _.filter(values, function(v) {\n          return v != null;\n        });\n        if (notNullValues.length === 0) {\n          return \"?\";\n        }\n        return _.reduce(notNullValues, function(acc, num) {\n          return acc + num;\n        });\n      };\n\n      EstimationProcess.prototype.calculateRoles = function() {\n        var computableRoles, roles;\n        computableRoles = _.filter(this.project.roles, \"computable\");\n        roles = _.map(computableRoles, (function(_this) {\n          return function(role) {\n            var pointId, pointObj;\n            pointId = _this.us.points[role.id];\n            pointObj = _this.pointsById[pointId];\n            role = _.clone(role, true);\n            role.points = (pointObj != null) && (pointObj.name != null) ? pointObj.name : \"?\";\n            return role;\n          };\n        })(this));\n        return roles;\n      };\n\n      EstimationProcess.prototype.bindClickEvents = function() {\n        this.$el.on(\"click\", \".total.clickable\", (function(_this) {\n          return function(event) {\n            var roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            _this.renderPointsSelector(roleId, target);\n            target.siblings().removeClass('active');\n            return target.addClass('active');\n          };\n        })(this));\n        return this.$el.on(\"click\", \".point\", (function(_this) {\n          return function(event) {\n            var pointId, points, roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            pointId = target.data(\"point-id\");\n            _this.$el.find(\".popover\").popover().close();\n            points = _.clone(_this.us.points, true);\n            points[roleId] = pointId;\n            _this.us.points = points;\n            _this.render();\n            return _this.onSelectedPointForRole(roleId, pointId);\n          };\n        })(this));\n      };\n\n      EstimationProcess.prototype.renderPointsSelector = function(roleId, target) {\n        var horizontalList, html, maxPointLength, points, pop;\n        points = _.map(this.points, (function(_this) {\n          return function(point) {\n            point = _.clone(point, true);\n            point.selected = _this.us.points[roleId] === point.id ? false : true;\n            return point;\n          };\n        })(this));\n        maxPointLength = 5;\n        horizontalList = _.some(points, (function(_this) {\n          return function(point) {\n            return point.name.length > maxPointLength;\n          };\n        })(this));\n        html = pointsTemplate({\n          \"points\": points,\n          roleId: roleId,\n          horizontal: horizontalList\n        });\n        this.$el.find(\".popover\").popover().close();\n        this.$el.find(\".pop-points-open\").remove();\n        if (target != null) {\n          this.$el.find(target).append(html);\n        } else {\n          this.$el.append(html);\n        }\n        this.$el.find(\".pop-points-open\").popover().open(function() {\n          return $(this).removeClass(\"active\").closest(\"li\").removeClass(\"active\");\n        });\n        this.$el.find(\".pop-points-open\").show();\n        pop = this.$el.find(\".pop-points-open\");\n        if (pop.offset().top + pop.height() > document.body.clientHeight) {\n          return pop.addClass('pop-bottom');\n        }\n      };\n\n      return EstimationProcess;\n\n    })();\n    create = function($el, us, project) {\n      var estimationProcess;\n      $el.unbind(\"click\");\n      estimationProcess = new EstimationProcess($el, us, project);\n      if (estimationProcess.isEditable) {\n        estimationProcess.bindClickEvents();\n      }\n      return estimationProcess;\n    };\n    return {\n      create: create\n    };\n  };\n\n  module.factory(\"$tgEstimationsService\", [\"$tgTemplate\", \"$tgQqueue\", \"$tgRepo\", \"$tgConfirm\", \"$q\", EstimationsService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/filters.coffee\n */\n\n(function() {\n  var defaultFilter, module, momentFormat, momentFromNow, taiga, unslugify, yesNoFilter;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  defaultFilter = function() {\n    return function(value, defaultValue) {\n      if (value === [null, void 0]) {\n        return defaultValue;\n      }\n      return value;\n    };\n  };\n\n  module.filter(\"default\", defaultFilter);\n\n  yesNoFilter = function($translate) {\n    return function(value) {\n      if (value) {\n        return $translate.instant(\"COMMON.YES\");\n      }\n      return $translate.instant(\"COMMON.NO\");\n    };\n  };\n\n  module.filter(\"yesNo\", [\"$translate\", yesNoFilter]);\n\n  unslugify = function() {\n    return taiga.unslugify;\n  };\n\n  module.filter(\"unslugify\", unslugify);\n\n  momentFormat = function() {\n    return function(input, format) {\n      if (input) {\n        return moment(input).format(format);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFormat\", momentFormat);\n\n  momentFromNow = function() {\n    return function(input, without_suffix) {\n      if (input) {\n        return moment(input).fromNow(without_suffix || false);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFromNow\", momentFromNow);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/history.coffee\n */\n\n(function() {\n  var HistoryController, HistoryDirective, IGNORED_FIELDS, bindOnce, debounce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  IGNORED_FIELDS = {\n    \"userstories.userstory\": [\"watchers\", \"kanban_order\", \"backlog_order\", \"sprint_order\", \"finish_date\", \"tribe_gig\"],\n    \"tasks.task\": [\"watchers\", \"us_order\", \"taskboard_order\"],\n    \"issues.issue\": [\"watchers\"]\n  };\n\n  HistoryController = (function(superClass) {\n    extend(HistoryController, superClass);\n\n    HistoryController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\"];\n\n    function HistoryController(scope, repo, rs) {\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n    }\n\n    HistoryController.prototype.initialize = function(type, objectId) {\n      this.type = type;\n      return this.objectId = objectId;\n    };\n\n    HistoryController.prototype.loadHistory = function(type, objectId) {\n      return this.rs.history.get(type, objectId).then((function(_this) {\n        return function(history) {\n          var changeModel, historyEntry, historyResult, i, j, len, len1;\n          for (i = 0, len = history.length; i < len; i++) {\n            historyResult = history[i];\n            if (historyResult.values_diff.description_diff != null) {\n              historyResult.values_diff.description = historyResult.values_diff.description_diff;\n            }\n            delete historyResult.values_diff.description_html;\n            delete historyResult.values_diff.description_diff;\n            if (historyResult.values_diff.blocked_note_diff != null) {\n              historyResult.values_diff.blocked_note = historyResult.values_diff.blocked_note_diff;\n            }\n            delete historyResult.values_diff.blocked_note_html;\n            delete historyResult.values_diff.blocked_note_diff;\n          }\n          for (j = 0, len1 = history.length; j < len1; j++) {\n            historyEntry = history[j];\n            changeModel = historyEntry.key.split(\":\")[0];\n            if (IGNORED_FIELDS[changeModel] != null) {\n              historyEntry.values_diff = _.removeKeys(historyEntry.values_diff, IGNORED_FIELDS[changeModel]);\n            }\n          }\n          _this.scope.history = _.filter(history, function(item) {\n            return Object.keys(item.values_diff).length > 0;\n          });\n          return _this.scope.comments = _.filter(history, function(item) {\n            return item.comment !== \"\";\n          });\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.deleteComment = function(type, objectId, activityId) {\n      return this.rs.history.deleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.undeleteComment = function(type, objectId, activityId) {\n      return this.rs.history.undeleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    return HistoryController;\n\n  })(taiga.Controller);\n\n  HistoryDirective = function($log, $loading, $qqueue, $template, $confirm, $translate, $compile, $navUrls, $rootScope) {\n    var link, templateActivity, templateBase, templateBaseEntries, templateChangeAttachment, templateChangeDiff, templateChangeGeneric, templateChangeList, templateChangePoints, templateDeletedComment, templateFn;\n    templateChangeDiff = $template.get(\"common/history/history-change-diff.html\", true);\n    templateChangePoints = $template.get(\"common/history/history-change-points.html\", true);\n    templateChangeGeneric = $template.get(\"common/history/history-change-generic.html\", true);\n    templateChangeAttachment = $template.get(\"common/history/history-change-attachment.html\", true);\n    templateChangeList = $template.get(\"common/history/history-change-list.html\", true);\n    templateDeletedComment = $template.get(\"common/history/history-deleted-comment.html\", true);\n    templateActivity = $template.get(\"common/history/history-activity.html\", true);\n    templateBaseEntries = $template.get(\"common/history/history-base-entries.html\", true);\n    templateBase = $template.get(\"common/history/history-base.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var countChanges, formatChange, getHumanizedFieldName, getPrettyDateFormat, objectId, renderActivity, renderAttachmentEntry, renderChange, renderChangeEntries, renderChangeEntry, renderChangesHelperText, renderComment, renderComments, renderCustomAttributesEntry, renderHistory, save, showAllActivity, showAllComments, type;\n      type = $attrs.type;\n      objectId = null;\n      showAllComments = false;\n      showAllActivity = false;\n      getPrettyDateFormat = function() {\n        return $translate.instant(\"ACTIVITY.DATETIME\");\n      };\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        type = $attrs.type;\n        objectId = model.id;\n        $ctrl.initialize(type, objectId);\n        return $ctrl.loadHistory(type, objectId);\n      });\n      getHumanizedFieldName = function(field) {\n        var humanizedFieldNames;\n        humanizedFieldNames = {\n          subject: $translate.instant(\"ACTIVITY.FIELDS.SUBJECT\"),\n          name: $translate.instant(\"ACTIVITY.FIELDS.NAME\"),\n          description: $translate.instant(\"ACTIVITY.FIELDS.DESCRIPTION\"),\n          content: $translate.instant(\"ACTIVITY.FIELDS.CONTENT\"),\n          status: $translate.instant(\"ACTIVITY.FIELDS.STATUS\"),\n          is_closed: $translate.instant(\"ACTIVITY.FIELDS.IS_CLOSED\"),\n          finish_date: $translate.instant(\"ACTIVITY.FIELDS.FINISH_DATE\"),\n          type: $translate.instant(\"ACTIVITY.FIELDS.TYPE\"),\n          priority: $translate.instant(\"ACTIVITY.FIELDS.PRIORITY\"),\n          severity: $translate.instant(\"ACTIVITY.FIELDS.SEVERITY\"),\n          trigger: $translate.instant(\"ACTIVITY.FIELDS.TRIGGER\"),\n          assigned_to: $translate.instant(\"ACTIVITY.FIELDS.ASSIGNED_TO\"),\n          watchers: $translate.instant(\"ACTIVITY.FIELDS.WATCHERS\"),\n          milestone: $translate.instant(\"ACTIVITY.FIELDS.MILESTONE\"),\n          user_story: $translate.instant(\"ACTIVITY.FIELDS.USER_STORY\"),\n          project: $translate.instant(\"ACTIVITY.FIELDS.PROJECT\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          points: $translate.instant(\"ACTIVITY.FIELDS.POINTS\"),\n          client_requirement: $translate.instant(\"ACTIVITY.FIELDS.CLIENT_REQUIREMENT\"),\n          team_requirement: $translate.instant(\"ACTIVITY.FIELDS.TEAM_REQUIREMENT\"),\n          is_iocaine: $translate.instant(\"ACTIVITY.FIELDS.IS_IOCAINE\"),\n          tags: $translate.instant(\"ACTIVITY.FIELDS.TAGS\"),\n          attachments: $translate.instant(\"ACTIVITY.FIELDS.ATTACHMENTS\"),\n          is_deprecated: $translate.instant(\"ACTIVITY.FIELDS.IS_DEPRECATED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          order: $translate.instant(\"ACTIVITY.FIELDS.ORDER\"),\n          backlog_order: $translate.instant(\"ACTIVITY.FIELDS.BACKLOG_ORDER\"),\n          sprint_order: $translate.instant(\"ACTIVITY.FIELDS.SPRINT_ORDER\"),\n          kanban_order: $translate.instant(\"ACTIVITY.FIELDS.KANBAN_ORDER\"),\n          taskboard_order: $translate.instant(\"ACTIVITY.FIELDS.TASKBOARD_ORDER\"),\n          us_order: $translate.instant(\"ACTIVITY.FIELDS.US_ORDER\")\n        };\n        return humanizedFieldNames[field] || field;\n      };\n      countChanges = function(comment) {\n        return _.keys(comment.values_diff).length;\n      };\n      formatChange = function(change) {\n        if (_.isArray(change)) {\n          if (change.length === 0) {\n            return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n          }\n          return change.join(\", \");\n        }\n        if (change === \"\") {\n          return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n        }\n        if ((change == null) || change === false) {\n          return $translate.instant(\"ACTIVITY.VALUES.NO\");\n        }\n        if (change === true) {\n          return $translate.instant(\"ACTIVITY.VALUES.YES\");\n        }\n        return change;\n      };\n      renderAttachmentEntry = function(value) {\n        var attachments;\n        attachments = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.NEW_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var diff, name;\n              name = $translate.instant(\"ACTIVITY.UPDATED_ATTACHMENT\", {\n                filename: change.filename\n              });\n              diff = _.map(change.changes, function(values, name) {\n                return {\n                  name: getHumanizedFieldName(name),\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                };\n              });\n              return templateChangeAttachment({\n                name: name,\n                diff: diff\n              });\n            });\n          }\n        });\n        return _.flatten(attachments).join(\"\\n\");\n      };\n      renderCustomAttributesEntry = function(value) {\n        var customAttributes;\n        customAttributes = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              var html;\n              html = templateChangeGeneric({\n                name: change.name,\n                from: formatChange(\"\"),\n                to: formatChange(change.value)\n              });\n              html = $compile(html)($scope);\n              return html[0].outerHTML;\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_CUSTOM_ATTRIBUTE\"),\n                diff: change.name\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var customAttrsChanges;\n              customAttrsChanges = _.map(change.changes, function(values) {\n                return templateChangeGeneric({\n                  name: change.name,\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                });\n              });\n              return _.flatten(customAttrsChanges).join(\"\\n\");\n            });\n          }\n        });\n        return _.flatten(customAttributes).join(\"\\n\");\n      };\n      renderChangeEntry = function(field, value) {\n        var added, from, html, name, removed, to;\n        if (field === \"description\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"description\"),\n            diff: value[1]\n          });\n        } else if (field === \"blocked_note\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"blocked_note\"),\n            diff: value[1]\n          });\n        } else if (field === \"points\") {\n          html = templateChangePoints({\n            points: value\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"attachments\") {\n          return renderAttachmentEntry(value);\n        } else if (field === \"custom_attributes\") {\n          return renderCustomAttributesEntry(value);\n        } else if (field === \"tags\" || field === \"watchers\") {\n          name = getHumanizedFieldName(field);\n          removed = _.difference(value[0], value[1]);\n          added = _.difference(value[1], value[0]);\n          html = templateChangeList({\n            name: name,\n            removed: removed,\n            added: added\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"assigned_to\") {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          to = formatChange(value[1] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        } else {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0]);\n          to = formatChange(value[1]);\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        }\n      };\n      renderChangeEntries = function(change) {\n        return _.map(change.values_diff, function(value, field) {\n          return renderChangeEntry(field, value);\n        });\n      };\n      renderChangesHelperText = function(change) {\n        var size;\n        size = countChanges(change);\n        return $translate.instant(\"ACTIVITY.SIZE_CHANGE\", {\n          size: size\n        }, 'messageformat');\n      };\n      renderComment = function(comment) {\n        var html, ref, ref1, ref2;\n        if (comment.delete_comment_date || ((ref = comment.delete_comment_user) != null ? ref.name : void 0)) {\n          html = templateDeletedComment({\n            deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n            deleteCommentUser: comment.delete_comment_user.name,\n            deleteComment: comment.comment_html,\n            activityId: comment.id,\n            canRestoreComment: $scope.user && (comment.delete_comment_user.pk === $scope.user.id || $scope.project.my_permissions.indexOf(\"modify_project\") > -1)\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        }\n        html = templateActivity({\n          avatar: comment.user.photo,\n          userFullName: comment.user.name,\n          userProfileUrl: comment.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: comment.user.username\n          }) : \"\",\n          creationDate: moment(comment.created_at).format(getPrettyDateFormat()),\n          comment: comment.comment_html,\n          changesText: renderChangesHelperText(comment),\n          changes: renderChangeEntries(comment),\n          mode: \"comment\",\n          deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref1 = comment.delete_comment_user) != null ? ref1.name : void 0) ? comment.delete_comment_user.name : void 0,\n          activityId: comment.id,\n          canDeleteComment: comment.user.pk === ((ref2 = $scope.user) != null ? ref2.id : void 0) || $scope.project.my_permissions.indexOf(\"modify_project\") > -1\n        });\n        html = $compile(html)($scope);\n        return html[0].outerHTML;\n      };\n      renderChange = function(change) {\n        var ref;\n        return templateActivity({\n          avatar: change.user.photo,\n          userFullName: change.user.name,\n          userProfileUrl: change.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: change.user.username\n          }) : \"\",\n          creationDate: moment(change.created_at).format(getPrettyDateFormat()),\n          comment: change.comment_html,\n          changes: renderChangeEntries(change),\n          changesText: \"\",\n          mode: \"activity\",\n          deleteCommentDate: change.delete_comment_date ? moment(change.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref = change.delete_comment_user) != null ? ref.name : void 0) ? change.delete_comment_user.name : void 0,\n          activityId: change.id\n        });\n      };\n      renderHistory = function(entries, totalEntries) {\n        var html, showMore;\n        if (entries.length === totalEntries) {\n          showMore = 0;\n        } else {\n          showMore = totalEntries - entries.length;\n        }\n        html = templateBaseEntries({\n          entries: entries,\n          showMore: showMore\n        });\n        html = $compile(html)($scope);\n        return html;\n      };\n      renderComments = function() {\n        var comments, html, totalComments;\n        comments = $scope.comments || [];\n        totalComments = comments.length;\n        if (!showAllComments) {\n          comments = _.last(comments, 4);\n        }\n        comments = _.map(comments, function(x) {\n          return renderComment(x);\n        });\n        html = renderHistory(comments, totalComments);\n        return $el.find(\".comments-list\").html(html);\n      };\n      renderActivity = function() {\n        var changes, html, totalChanges;\n        changes = $scope.history || [];\n        totalChanges = changes.length;\n        if (!showAllActivity) {\n          changes = _.last(changes, 4);\n        }\n        changes = _.map(changes, function(x) {\n          return renderChange(x);\n        });\n        html = renderHistory(changes, totalChanges);\n        return $el.find(\".changes-list\").html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(target) {\n          var currentLoading, model, onError, onSuccess;\n          $scope.$broadcast(\"markdown-editor:submit\");\n          $el.find(\".comment-list\").addClass(\"activeanimation\");\n          currentLoading = $loading().target(target).start();\n          onSuccess = function() {\n            $rootScope.$broadcast(\"comment:new\");\n            return $ctrl.loadHistory(type, objectId)[\"finally\"](function() {\n              return currentLoading.finish();\n            });\n          };\n          onError = function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          };\n          model = $scope.$eval($attrs.ngModel);\n          return $ctrl.repo.save(model).then(onSuccess, onError);\n        };\n      })(this));\n      $scope.$watch(\"comments\", renderComments);\n      $scope.$watch(\"history\", renderActivity);\n      $scope.$on(\"object:updated\", function() {\n        return $ctrl.loadHistory(type, objectId);\n      });\n      $el.on(\"click\", \".add-comment button.button-green\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      }));\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href && href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".show-more\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.parent().is(\".changes-list\")) {\n          showAllActivity = !showAllActivity;\n          return renderActivity();\n        } else {\n          showAllComments = !showAllComments;\n          return renderComments();\n        }\n      });\n      $el.on(\"click\", \".show-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').show();\n        target.parents('.activity-single').find('.show-deleted-comment').hide();\n        return target.parents('.activity-single').find('.comment-body').show();\n      });\n      $el.on(\"click\", \".hide-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').hide();\n        target.parents('.activity-single').find('.show-deleted-comment').show();\n        return target.parents('.activity-single').find('.comment-body').hide();\n      });\n      $el.on(\"click\", \".changes-title\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return target.parent().find(\".change-entry\").toggleClass(\"active\");\n      });\n      $el.on(\"focus\", \".add-comment textarea\", function(event) {\n        return $(this).addClass('active');\n      });\n      $el.on(\"click\", \".history-tabs li a\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        $el.find(\".history-tabs li a\").removeClass(\"active\");\n        target.addClass(\"active\");\n        $el.find(\".history section\").addClass(\"hidden\");\n        return $el.find(\".history section.\" + (target.data('section-class'))).removeClass(\"hidden\");\n      });\n      $el.on(\"click\", \".comment-delete\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.deleteComment(type, objectId, activityId);\n      }));\n      $el.on(\"click\", \".comment-restore\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.undeleteComment(type, objectId, activityId);\n      }));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      var html;\n      html = templateBase({\n        ngmodel: $attrs.ngModel,\n        type: $attrs.type,\n        mode: $attrs.mode\n      });\n      return html;\n    };\n    return {\n      controller: HistoryController,\n      template: templateFn,\n      restrict: \"AE\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistory\", [\"$log\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$tgConfirm\", \"$translate\", \"$compile\", \"$tgNavUrls\", \"$rootScope\", HistoryDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/importer.coffee\n */\n\n(function() {\n  var ImportProjectButtonDirective, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  ImportProjectButtonDirective = function($rs, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $el.on(\"click\", \".import-project-button\", function(event) {\n        event.preventDefault();\n        $el.find(\"input.import-file\").val(\"\");\n        return $el.find(\"input.import-file\").trigger(\"click\");\n      });\n      return $el.on(\"change\", \"input.import-file\", function(event) {\n        var file, loader, onError, onSuccess;\n        event.preventDefault();\n        file = event.target.files[0];\n        if (!file) {\n          return;\n        }\n        loader = $confirm.loader($translate.instant(\"PROJECT.IMPORT.UPLOADING_FILE\"));\n        onSuccess = function(result) {\n          var ctx, message, msg, title;\n          loader.stop();\n          if (result.status === 202) {\n            title = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE\");\n            message = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE\");\n            return $confirm.success(title, message);\n          } else {\n            ctx = {\n              project: result.data.slug\n            };\n            $location.path($navUrls.resolve(\"project-admin-project-profile-details\", ctx));\n            msg = $translate.instant(\"PROJECT.IMPORT.SYNC_SUCCESS\");\n            return $confirm.notify(\"success\", msg);\n          }\n        };\n        onError = function(result) {\n          var errorMsg, ref;\n          loader.stop();\n          errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR\");\n          if (result.status === 429) {\n            errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST\");\n          } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n            errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MESSAGE\", {\n              error_message: result.data._error_message\n            });\n          }\n          return $confirm.notify(\"error\", errorMsg);\n        };\n        loader.start();\n        return $rs.projects[\"import\"](file, loader.update).then(onSuccess, onError);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgImportProjectButton\", [\"$tgResources\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$translate\", ImportProjectButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/lightboxes.coffee\n */\n\n(function() {\n  var AssignedToLightboxDirective, AttachmentPreviewLightboxDirective, BlockLightboxDirective, BlockingMessageInputDirective, CreateBulkUserstoriesDirective, CreateEditUserstoryDirective, LightboxDirective, LightboxKeyboardNavigationService, LightboxService, WatchersLightboxDirective, bindOnce, debounce, module, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaCommon\");\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  LightboxService = (function(superClass) {\n    extend(LightboxService, superClass);\n\n    function LightboxService(animationFrame, q) {\n      this.animationFrame = animationFrame;\n      this.q = q;\n    }\n\n    LightboxService.prototype.open = function($el) {\n      var defered, docEl, lightboxContent;\n      defered = this.q.defer();\n      lightboxContent = $el.children().not(\".close\");\n      lightboxContent.hide();\n      this.animationFrame.add(function() {\n        return $el.css('display', 'flex');\n      });\n      this.animationFrame.add(function() {\n        $el.addClass(\"open\");\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            return $el.find('input,textarea').first().focus();\n          };\n        })(this));\n      });\n      this.animationFrame.add((function(_this) {\n        return function() {\n          lightboxContent.show();\n          return defered.resolve();\n        };\n      })(this));\n      docEl = angular.element(document);\n      docEl.on(\"keydown.lightbox\", (function(_this) {\n        return function(e) {\n          var code;\n          code = e.keyCode ? e.keyCode : e.which;\n          if (code === 27) {\n            return _this.close($el);\n          }\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    LightboxService.prototype.close = function($el) {\n      var docEl, scope;\n      docEl = angular.element(document);\n      docEl.off(\".lightbox\");\n      docEl.off(\".keyboard-navigation\");\n      $el.one(\"transitionend\", (function(_this) {\n        return function() {\n          $el.removeAttr('style');\n          return $el.removeClass(\"open\").removeClass('close');\n        };\n      })(this));\n      $el.addClass('close');\n      if ($el.hasClass(\"remove-on-close\")) {\n        scope = $el.data(\"scope\");\n        scope.$destroy();\n        return $el.remove();\n      }\n    };\n\n    LightboxService.prototype.closeAll = function() {\n      var docEl, i, len, lightboxEl, ref, results;\n      docEl = angular.element(document);\n      ref = docEl.find(\".lightbox.open\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lightboxEl = ref[i];\n        results.push(this.close($(lightboxEl)));\n      }\n      return results;\n    };\n\n    return LightboxService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxService\", [\"animationFrame\", \"$q\", LightboxService]);\n\n  LightboxKeyboardNavigationService = (function(superClass) {\n    extend(LightboxKeyboardNavigationService, superClass);\n\n    function LightboxKeyboardNavigationService() {\n      return LightboxKeyboardNavigationService.__super__.constructor.apply(this, arguments);\n    }\n\n    LightboxKeyboardNavigationService.prototype.stop = function() {\n      var docEl;\n      docEl = angular.element(document);\n      return docEl.off(\".keyboard-navigation\");\n    };\n\n    LightboxKeyboardNavigationService.prototype.dispatch = function($el, code) {\n      var activeElement, next, prev;\n      activeElement = $el.find(\".selected\");\n      if (code === 13) {\n        if ($el.find(\".user-list-single\").length === 1) {\n          return $el.find('.user-list-single:first').trigger(\"click\");\n        } else {\n          return activeElement.trigger(\"click\");\n        }\n      } else if (code === 40) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:not(\".is-active\"):first').addClass('selected');\n        } else {\n          next = activeElement.next('.user-list-single');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return next.addClass('selected');\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:last').addClass('selected');\n        } else {\n          prev = activeElement.prev('.user-list-single:not(\".is-active\")');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return prev.addClass('selected');\n          }\n        }\n      }\n    };\n\n    LightboxKeyboardNavigationService.prototype.init = function($el) {\n      var docEl;\n      this.stop();\n      docEl = angular.element(document);\n      return docEl.on(\"keydown.keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38 || code === 13) {\n            event.preventDefault();\n            return _this.dispatch($el, code);\n          }\n        };\n      })(this));\n    };\n\n    return LightboxKeyboardNavigationService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxKeyboardNavigationService\", LightboxKeyboardNavigationService);\n\n  LightboxDirective = function(lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n    };\n    return {\n      restrict: \"C\",\n      link: link\n    };\n  };\n\n  module.directive(\"lightbox\", [\"lightboxService\", LightboxDirective]);\n\n  BlockLightboxDirective = function($rootscope, $tgrepo, $confirm, lightboxService, $loading, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var block, title, unblock;\n      title = $translate.instant($attrs.title);\n      $el.find(\"h2.title\").text(title);\n      unblock = $qqueue.bindAdd((function(_this) {\n        return function(item, finishCallback) {\n          var promise;\n          promise = $tgrepo.save(item);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $model.$setViewValue(item);\n            return finishCallback();\n          });\n          promise.then(null, function() {\n            $confirm.notify(\"error\");\n            item.revert();\n            return $model.$setViewValue(item);\n          });\n          promise[\"finally\"](function() {\n            return finishCallback();\n          });\n          return promise;\n        };\n      })(this));\n      block = $qqueue.bindAdd((function(_this) {\n        return function(item) {\n          var currentLoading, promise;\n          $model.$setViewValue(item);\n          currentLoading = $loading().target($el.find(\".button-green\")).start();\n          promise = $tgrepo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            $confirm.notify(\"error\");\n            item.revert();\n            return $model.$setViewValue(item);\n          });\n          return promise[\"finally\"](function() {\n            currentLoading.finish();\n            return lightboxService.close($el);\n          });\n        };\n      })(this));\n      $scope.$on(\"block\", function() {\n        $el.find(\".reason\").val($model.$modelValue.blocked_note);\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"unblock\", (function(_this) {\n        return function(event, model, finishCallback) {\n          var item;\n          item = $model.$modelValue.clone();\n          item.is_blocked = false;\n          item.blocked_note = \"\";\n          return unblock(item, finishCallback);\n        };\n      })(this));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        var item;\n        event.preventDefault();\n        item = $model.$modelValue.clone();\n        item.is_blocked = true;\n        item.blocked_note = $el.find(\".reason\").val();\n        return block(item);\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-block.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbBlock\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"lightboxService\", \"$tgLoading\", \"$tgQqueue\", \"$translate\", BlockLightboxDirective]);\n\n  BlockingMessageInputDirective = function($log, $template, $compile) {\n    var link, template, templateFn;\n    template = $template.get(\"common/lightbox/lightbox-blocking-message-input.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.watch) {\n        return $log.error(\"No watch attribute on tg-blocking-message-input directive\");\n      }\n      return $scope.$watch($attrs.watch, function(value) {\n        if (value === !void 0 && value === true) {\n          return $el.find(\".blocked-note\").removeClass(\"hidden\");\n        } else {\n          return $el.find(\".blocked-note\").addClass(\"hidden\");\n        }\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        ngmodel: $attrs.ngModel\n      });\n    };\n    return {\n      template: templateFn,\n      link: link,\n      require: \"ngModel\",\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBlockingMessageInput\", [\"$log\", \"$tgTemplate\", \"$compile\", BlockingMessageInputDirective]);\n\n  CreateEditUserstoryDirective = function($repo, $model, $rs, $rootScope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.isNew = true;\n      $scope.$on(\"usform:new\", function(ctx, projectId, status, statusList) {\n        $scope.isNew = true;\n        $scope.usStatusList = statusList;\n        $scope.us = $model.make_model(\"userstories\", {\n          project: projectId,\n          points: {},\n          status: status,\n          is_archived: false,\n          tags: []\n        });\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.CREATE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.NEW_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        $el.find(\".blocked-note\").addClass(\"hidden\");\n        $el.find(\"label.blocked\").removeClass(\"selected\");\n        $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"usform:edit\", function(ctx, us) {\n        $scope.us = us;\n        $scope.isNew = false;\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.SAVE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.EDIT_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        if (us.is_blocked) {\n          $el.find(\".blocked-note\").removeClass(\"hidden\");\n          $el.find(\"label.blocked\").addClass(\"selected\");\n        } else {\n          $el.find(\".blocked-note\").addClass(\"hidden\");\n          $el.find(\"label.blocked\").removeClass(\"selected\");\n        }\n        if (us.team_requirement) {\n          $el.find(\"label.team-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        }\n        if (us.client_requirement) {\n          $el.find(\"label.client-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        }\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          if ($scope.isNew) {\n            promise = $repo.create(\"userstories\", $scope.us);\n            broadcastEvent = \"usform:new:success\";\n          } else {\n            promise = $repo.save($scope.us);\n            broadcastEvent = \"usform:edit:success\";\n          }\n          promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootScope.$broadcast(broadcastEvent, data);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $scope.us.revert();\n        });\n        return lightboxService.close($el);\n      });\n      $el.keydown(function(event) {\n        var code;\n        code = event.keyCode ? event.keyCode : event.which;\n        if (code === 27) {\n          lightboxService.close($el);\n          return $scope.$apply(function() {\n            return $scope.us.revert();\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditUserstory\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditUserstoryDirective]);\n\n  CreateBulkUserstoriesDirective = function($repo, $rs, $rootscope, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.$on(\"usform:bulk\", function(ctx, projectId, status) {\n        $scope[\"new\"] = {\n          projectId: projectId,\n          statusId: status,\n          bulk: \"\"\n        };\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley({\n            onlyOneErrorElement: true\n          });\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userstories.bulkCreate($scope[\"new\"].projectId, $scope[\"new\"].statusId, $scope[\"new\"].bulk);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"usform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkUserstories\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", CreateBulkUserstoriesDirective]);\n\n  AssignedToLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, filterUsers, normalizeString, render, selectedItem, selectedUser, usersTemplate;\n      selectedUser = null;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      normalizeString = function(string) {\n        var normalizedString;\n        normalizedString = string;\n        normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n        normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n        normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n        normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n        normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n        return normalizedString;\n      };\n      filterUsers = function(text, user) {\n        var username;\n        username = user.full_name_display.toUpperCase();\n        username = normalizeString(username);\n        text = text.toUpperCase();\n        text = normalizeString(text);\n        return _.contains(username, text);\n      };\n      render = function(selected, text) {\n        var ctx, html, users;\n        users = _.clone($scope.activeUsers, true);\n        if (selected != null) {\n          users = _.reject(users, {\n            \"id\": selected.id\n          });\n        }\n        if (text != null) {\n          users = _.filter(users, _.partial(filterUsers, text));\n        }\n        ctx = {\n          selected: selected,\n          users: _.first(users, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".assigned-to-list\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"assigned-to:add\", function(ctx, item) {\n        var assignedToId;\n        selectedItem = item;\n        assignedToId = item.assigned_to;\n        selectedUser = $scope.usersById[assignedToId];\n        render(selectedUser);\n        return lightboxService.open($el).then(function() {\n          $el.find('input').focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        if (searchingText != null) {\n          render(selectedUser, searchingText);\n          return $el.find('input').focus();\n        }\n      });\n      $el.on(\"click\", \".user-list-single\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.$broadcast(\"assigned-to:added\", target.data(\"user-id\"), selectedItem);\n          return $scope.usersSearch = null;\n        });\n      });\n      $el.on(\"click\", \".remove-assigned-to\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"assigned-to:added\", null, selectedItem);\n        });\n      });\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-assigned-to.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAssignedto\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", AssignedToLightboxDirective]);\n\n  WatchersLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, getFilteredUsers, render, selectedItem, usersTemplate;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      getFilteredUsers = function(text) {\n        var _filterUsers, users;\n        if (text == null) {\n          text = \"\";\n        }\n        _filterUsers = function(text, user) {\n          var username;\n          if (selectedItem && _.find(selectedItem.watchers, function(x) {\n            return x === user.id;\n          })) {\n            return false;\n          }\n          username = user.full_name_display.toUpperCase();\n          text = text.toUpperCase();\n          return _.contains(username, text);\n        };\n        users = _.clone($scope.activeUsers, true);\n        users = _.filter(users, _.partial(_filterUsers, text));\n        return users;\n      };\n      render = function(users) {\n        var ctx, html;\n        ctx = {\n          selected: false,\n          users: _.first(users, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".ticket-watchers\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"watcher:add\", function(ctx, item) {\n        var users;\n        selectedItem = item;\n        users = getFilteredUsers();\n        render(users);\n        return lightboxService.open($el).then(function() {\n          $el.find(\"input\").focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        var users;\n        if (searchingText == null) {\n          return;\n        }\n        users = getFilteredUsers(searchingText);\n        render(users);\n        return $el.find(\"input\").focus();\n      });\n      $el.on(\"click\", \".user-list-single\", debounce(2000, function(event) {\n        var target;\n        closeLightbox();\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"watcher:added\", target.data(\"user-id\"));\n        });\n      }));\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-users.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbWatchers\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", WatchersLightboxDirective]);\n\n  AttachmentPreviewLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var render, template;\n      template = $template.get(\"common/lightbox/lightbox-attachment-preview.html\", true);\n      $scope.$on(\"attachment:preview\", function(event, attachment) {\n        lightboxService.open($el);\n        return render(attachment);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return render = function(attachment) {\n        var ctx, html;\n        ctx = {\n          url: attachment.url,\n          title: attachment.description,\n          name: attachment.name\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAttachmentPreview\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", AttachmentPreviewLightboxDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/loader.coffee\n */\n\n(function() {\n  var Loader, LoaderDirective, module, sizeFormat, taiga, timeout;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaCommon\");\n\n  LoaderDirective = function(tgLoader, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      tgLoader.onStart(function() {\n        $(document.body).addClass(\"loader-active\");\n        return $el.addClass(\"active\");\n      });\n      return tgLoader.onEnd(function() {\n        $(document.body).removeClass(\"loader-active\");\n        return $el.removeClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoader\", [\"tgLoader\", \"$rootScope\", LoaderDirective]);\n\n  Loader = function($rootscope) {\n    var autoClose, config, lastResponseDate, open, pageLoaded, requestCount, start, startLoadTime;\n    config = {\n      minTime: 300\n    };\n    open = false;\n    startLoadTime = 0;\n    requestCount = 0;\n    lastResponseDate = 0;\n    pageLoaded = function(force) {\n      var diff, endTime, timeoutValue;\n      if (force == null) {\n        force = false;\n      }\n      if (startLoadTime) {\n        timeoutValue = 0;\n        if (!force) {\n          endTime = new Date().getTime();\n          diff = endTime - startLoadTime;\n          if (diff < config.minTime) {\n            timeoutValue = config.minTime - diff;\n          }\n        }\n        timeout(timeoutValue, function() {\n          $rootscope.$broadcast(\"loader:end\");\n          open = false;\n          return window.prerenderReady = true;\n        });\n      }\n      startLoadTime = 0;\n      requestCount = 0;\n      return lastResponseDate = 0;\n    };\n    autoClose = function() {\n      var intervalAuto;\n      return intervalAuto = setInterval((function() {\n        if (lastResponseDate && requestCount === 0) {\n          pageLoaded();\n          return clearInterval(intervalAuto);\n        }\n      }), 50);\n    };\n    start = function() {\n      startLoadTime = new Date().getTime();\n      $rootscope.$broadcast(\"loader:start\");\n      return open = true;\n    };\n    return {\n      pageLoaded: pageLoaded,\n      start: function(auto) {\n        if (auto == null) {\n          auto = false;\n        }\n        if (!open) {\n          start();\n          if (auto) {\n            return autoClose();\n          }\n        }\n      },\n      onStart: function(fn) {\n        return $rootscope.$on(\"loader:start\", fn);\n      },\n      onEnd: function(fn) {\n        return $rootscope.$on(\"loader:end\", fn);\n      },\n      logRequest: function() {\n        return requestCount++;\n      },\n      logResponse: function() {\n        requestCount--;\n        return lastResponseDate = new Date().getTime();\n      }\n    };\n  };\n\n  Loader.$inject = [\"$rootScope\"];\n\n  module.factory(\"tgLoader\", Loader);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/lightboxes.coffee\n */\n\n(function() {\n  var LoadingDirective, TgLoadingService, module,\n    slice = [].slice;\n\n  module = angular.module(\"taigaCommon\");\n\n  TgLoadingService = function($compile) {\n    var spinner;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    return function() {\n      var service;\n      service = {\n        settings: {\n          target: null,\n          scope: null,\n          classes: [],\n          timeout: 0,\n          template: null\n        },\n        target: function(target) {\n          service.settings.target = target;\n          return service;\n        },\n        scope: function(scope) {\n          service.settings.scope = scope;\n          return service;\n        },\n        template: function(template) {\n          service.settings.template = template;\n          return service;\n        },\n        removeClasses: function() {\n          var classess;\n          classess = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          service.settings.classes = classess;\n          return service;\n        },\n        timeout: function(timeout) {\n          service.settings.timeout = timeout;\n          return service;\n        },\n        start: function() {\n          var target, timeoutId;\n          target = service.settings.target;\n          service.settings.classes.map(function(className) {\n            return target.removeClass(className);\n          });\n          timeoutId = setTimeout((function() {\n            if (!target.hasClass('loading')) {\n              if (!service.settings.template) {\n                service.settings.template = target.html();\n              }\n              target.addClass('loading');\n              return target.html(spinner);\n            }\n          }), service.settings.timeout);\n          service.settings.timeoutId = timeoutId;\n          return service;\n        },\n        finish: function() {\n          var removeClasses, target, timeoutId;\n          target = service.settings.target;\n          timeoutId = service.settings.timeoutId;\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n            removeClasses = service.settings.classes;\n            removeClasses.map(function(className) {\n              return service.settings.target.addClass(className);\n            });\n            target.html(service.settings.template);\n            target.removeClass('loading');\n            if (service.settings.scope) {\n              $compile(target.contents())(service.settings.scope);\n            }\n          }\n          return service;\n        }\n      };\n      return service;\n    };\n  };\n\n  TgLoadingService.$inject = [\"$compile\"];\n\n  module.factory(\"$tgLoading\", TgLoadingService);\n\n  LoadingDirective = function($loading) {\n    var link;\n    link = function($scope, $el, attr) {\n      var currentLoading, template;\n      currentLoading = null;\n      template = $el.html();\n      return $scope.$watch(attr.tgLoading, (function(_this) {\n        return function(showLoading) {\n          if (showLoading) {\n            return currentLoading = $loading().target($el).timeout(50).template(template).scope($scope).start();\n          } else if (currentLoading) {\n            return currentLoading.finish();\n          }\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoading\", [\"$tgLoading\", LoadingDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/popovers.coffee\n */\n\n(function() {\n  var RelatedTaskStatusDirective, UsStatusDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  UsStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a US and a popover to change it.\n    - tg-us-status: The user story\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-us-status=\"us\" on-update=\"ctrl.loadSprintState()\")\n        a.us-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'usStatusById' and 'project'.\n     */\n    var link, template;\n    template = $template.get(\"common/popover/popover-us-status.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render, us;\n      $ctrl = $el.controller();\n      render = function(us) {\n        var usStatusById, usStatusDom, usStatusDomParent;\n        usStatusDomParent = $el.find(\".us-status\");\n        usStatusDom = $el.find(\".us-status .us-status-bind\");\n        usStatusById = $scope.usStatusById;\n        if (usStatusById[us.status]) {\n          usStatusDom.text(usStatusById[us.status].name);\n          return usStatusDomParent.css(\"color\", usStatusById[us.status].color);\n        }\n      };\n      $el.on(\"click\", \".us-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target, us;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        us = $scope.$eval($attrs.tgUsStatus);\n        us.status = target.data(\"status-id\");\n        render(us);\n        $el.find(\".pop-status\").popover().close();\n        return $scope.$apply(function() {\n          return $repo.save(us).then(function() {\n            return $scope.$eval($attrs.onUpdate);\n          });\n        });\n      }));\n      $scope.$on(\"userstories:loaded\", function() {\n        return render($scope.$eval($attrs.tgUsStatus));\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      us = $scope.$eval($attrs.tgUsStatus);\n      render(us);\n      return bindOnce($scope, \"project\", function(project) {\n        var html;\n        html = template({\n          \"statuses\": project.us_statuses\n        });\n        $el.append(html);\n        if ($scope.project.my_permissions.indexOf(\"modify_us\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsStatus\", [\"$tgRepo\", \"$tgTemplate\", UsStatusDirective]);\n\n  RelatedTaskStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a related task and a popover to change it.\n    - tg-related-task-status: The related task\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-related-task-status=\"task\" on-update=\"ctrl.loadSprintState()\")\n        a.task-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'taskStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateTaskStatus;\n    selectionTemplate = $template.get(\"common/popover/popover-related-task-status.html\", true);\n    updateTaskStatus = function($el, task, taskStatusById) {\n      var taskStatusDom, taskStatusDomParent;\n      taskStatusDomParent = $el.find(\".us-status\");\n      taskStatusDom = $el.find(\".task-status .task-status-bind\");\n      if (taskStatusById[task.status]) {\n        taskStatusDom.text(taskStatusById[task.status].name);\n        return taskStatusDomParent.css('color', taskStatusById[task.status].color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task;\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskStatus);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $el.on(\"click\", \".task-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        task.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (autoSave) {\n          return $scope.$apply(function() {\n            return $repo.save(task).then(function() {\n              $scope.$eval($attrs.onUpdate);\n              return $scope.$emit(\"related-tasks:status-changed\");\n            });\n          });\n        }\n      }));\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.task_statuses\n        }));\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskStatus\", [\"$tgRepo\", \"$tgTemplate\", RelatedTaskStatusDirective]);\n\n  $.fn.popover = function() {\n    var $el, close, closeAll, closePopover, isVisible, open;\n    $el = this;\n    isVisible = (function(_this) {\n      return function() {\n        var docViewBottom, docViewLeft, docViewRight, docViewTop, docViewWidth, elemBottom, elemLeft, elemRight, elemTop, elemWidth;\n        $el.css({\n          \"display\": \"block\",\n          \"visibility\": \"hidden\"\n        });\n        docViewTop = $(window).scrollTop();\n        docViewBottom = docViewTop + $(window).height();\n        docViewWidth = $(window).width();\n        docViewRight = docViewWidth;\n        docViewLeft = 0;\n        elemTop = $el.offset().top;\n        elemBottom = elemTop + $el.height();\n        elemWidth = $el.width();\n        elemLeft = $el.offset().left;\n        elemRight = $el.offset().left + elemWidth;\n        $el.css({\n          \"display\": \"none\",\n          \"visibility\": \"visible\"\n        });\n        return (elemBottom <= docViewBottom) && (elemTop >= docViewTop) && (elemLeft >= docViewLeft) && (elemRight <= docViewRight);\n      };\n    })(this);\n    closePopover = (function(_this) {\n      return function(onClose) {\n        if (onClose) {\n          onClose.call($el);\n        }\n        $el.fadeOut(function() {\n          return $el.removeClass(\"active\").removeClass(\"fix\");\n        });\n        return $el.off(\"popup:close\");\n      };\n    })(this);\n    closeAll = (function(_this) {\n      return function() {\n        return $(\".popover.active\").each(function() {\n          return $(this).trigger(\"popup:close\");\n        });\n      };\n    })(this);\n    open = (function(_this) {\n      return function(onClose) {\n        if ($el.hasClass(\"active\")) {\n          return close();\n        } else {\n          closeAll();\n          if (!isVisible()) {\n            $el.addClass(\"fix\");\n          }\n          $el.fadeIn(function() {\n            $el.addClass(\"active\");\n            $(document.body).off(\"popover\");\n            return $(document.body).one(\"click.popover\", function() {\n              return closeAll();\n            });\n          });\n          return $el.on(\"popup:close\", function(e) {\n            return closePopover(onClose);\n          });\n        }\n      };\n    })(this);\n    close = (function(_this) {\n      return function() {\n        return $el.trigger(\"popup:close\");\n      };\n    })(this);\n    return {\n      open: open,\n      close: close,\n      closeAll: closeAll\n    };\n  };\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/raven-logger.coffee\n */\n\n(function() {\n  var ExceptionHandlerFactory, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  ExceptionHandlerFactory = function($log, config) {\n    var ravenConfig;\n    this.config = config;\n    ravenConfig = this.config.get(\"ravenConfig\", null);\n    if (ravenConfig) {\n      $log.debug(\"Using the RavenJS exception handler.\");\n      Raven.config(ravenConfig).install();\n      return function(exception, cause) {\n        $log.error.apply($log, arguments);\n        return Raven.captureException(exception);\n      };\n    } else {\n      $log.debug(\"Using the default logging exception handler.\");\n      return function(exception, cause) {\n        return $log.error.apply($log, arguments);\n      };\n    }\n  };\n\n  module.factory(\"$exceptionHandler\", [\"$log\", \"$tgConfig\", ExceptionHandlerFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/tags.coffee\n */\n\n(function() {\n  var ColorizeTagsDirective, LbTagLineDirective, TagLineDirective, TagsDirective, bindOnce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  TagsDirective = function() {\n    var formatter, link, parser;\n    formatter = function(v) {\n      if (_.isArray(v)) {\n        return v.join(\", \");\n      }\n      return \"\";\n    };\n    parser = function(v) {\n      var result;\n      if (!v) {\n        return [];\n      }\n      result = _(v.split(\",\")).map(function(x) {\n        return _.str.trim(x);\n      });\n      return result.value();\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      $ctrl.$formatters.push(formatter);\n      $ctrl.$parsers.push(parser);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgTags\", TagsDirective);\n\n  ColorizeTagsDirective = function() {\n    var link, templates;\n    templates = {\n      backlog: _.template(\"<% _.each(tags, function(tag) { %>\\n    <span class=\\\"tag\\\" style=\\\"border-left: 5px solid <%- tag.color %>\\\"><%- tag.name %></span>\\n<% }) %>\"),\n      kanban: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"kanban-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\"),\n      taskboard: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"taskboard-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\")\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      var render;\n      render = function(srcTags) {\n        var html, tags, template;\n        template = templates[$attrs.tgColorizeTagsType];\n        srcTags.sort();\n        tags = _.map(srcTags, function(tag) {\n          var color;\n          color = $scope.project.tags_colors[tag];\n          return {\n            name: tag,\n            color: color\n          };\n        });\n        html = template({\n          tags: tags\n        });\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.tgColorizeTags, function(tags) {\n        if (tags != null) {\n          return render(tags);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgColorizeTags\", ColorizeTagsDirective);\n\n  LbTagLineDirective = function($rs, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/lb-tag-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideSaveButton, removeInputLastCharacter, renderTags, resetInput, saveInputTag, showSaveButton;\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          })\n        };\n        _.map(ctx.tags, (function(_this) {\n          return function(tag) {\n            if (tag.color) {\n              return tag.style = \"border-left: 5px solid \" + tag.color;\n            }\n          };\n        })(this));\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\"div.tags-container\").html(html);\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return $el.find(\"input\").autocomplete(\"close\");\n      };\n      addValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n        return hideSaveButton();\n      };\n      deleteValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        tags = _.pull(tags, value);\n        return $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      removeInputLastCharacter = (function(_this) {\n        return function(input) {\n          var inputValue;\n          inputValue = input.val();\n          return input.val(inputValue.substring(0, inputValue.length - 1));\n        };\n      })(this);\n      $el.on(\"keypress\", \"input\", function(event) {\n        if (event.keyCode !== ENTER_KEY) {\n          return;\n        }\n        return event.preventDefault();\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          return saveInputTag();\n        } else if (event.keyCode === COMMA_KEY) {\n          removeInputLastCharacter(target);\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".icon-delete\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project\", function(project) {\n        var positioningFunction;\n        positioningFunction = function(position, elements) {\n          var menu;\n          menu = elements.element.element;\n          menu.css(\"width\", elements.target.width);\n          menu.css(\"top\", position.top);\n          return menu.css(\"left\", position.left);\n        };\n        return $el.find(\"input\").autocomplete({\n          source: _.keys(project.tags_colors),\n          position: {\n            my: \"left top\",\n            using: positioningFunction\n          },\n          select: function(event, ui) {\n            addValue(ui.item.value);\n            return ui.item.value = \"\";\n          }\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(tags) {\n        var ref, tagsColors;\n        tagsColors = ((ref = $scope.project) != null ? ref.tags_colors : void 0) || [];\n        return renderTags(tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/lb-tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgLbTagLine\", [\"$tgResources\", \"$tgTemplate\", \"$compile\", LbTagLineDirective]);\n\n  TagLineDirective = function($rootScope, $repo, $rs, $confirm, $qqueue, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, ESC_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    ESC_KEY = 27;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/tags-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideAddTagButton, hideAddTagButtonText, hideInput, hideSaveButton, isEditable, removeInputLastCharacter, renderInReadModeOnly, renderTags, resetInput, saveInputTag, showAddTagButton, showAddTagButtonText, showInput, showSaveButton;\n      isEditable = function() {\n        if ($attrs.requiredPerm != null) {\n          return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n        }\n        return true;\n      };\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          }),\n          isEditable: isEditable()\n        };\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\"div.tags-container\").html(html);\n      };\n      renderInReadModeOnly = function() {\n        $el.find(\".add-tag\").remove();\n        $el.find(\"input\").remove();\n        return $el.find(\".save\").remove();\n      };\n      showAddTagButton = function() {\n        return $el.find(\".add-tag\").removeClass(\"hidden\");\n      };\n      hideAddTagButton = function() {\n        return $el.find(\".add-tag\").addClass(\"hidden\");\n      };\n      showAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").removeClass(\"hidden\");\n      };\n      hideAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").addClass(\"hidden\");\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      showInput = function() {\n        return $el.find(\"input\").removeClass(\"hidden\").focus();\n      };\n      hideInput = function() {\n        return $el.find(\"input\").addClass(\"hidden\").blur();\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return $el.find(\"input\").autocomplete(\"close\");\n      };\n      addValue = $qqueue.bindAdd(function(value) {\n        var model, onError, onSuccess, tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue.tags, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        model = $model.$modelValue.clone();\n        model.tags = tags;\n        $model.$setViewValue(model);\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          model.revert();\n          return $model.$setViewValue(model);\n        };\n        $repo.save(model).then(onSuccess, onError);\n        return hideSaveButton();\n      });\n      deleteValue = $qqueue.bindAdd(function(value) {\n        var model, onError, onSuccess, tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue.tags, false);\n        tags = _.pull(tags, value);\n        model = $model.$modelValue.clone();\n        model.tags = tags;\n        $model.$setViewValue(model);\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          model.revert();\n          return $model.$setViewValue(model);\n        };\n        return $repo.save(model).then(onSuccess, onError);\n      });\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      removeInputLastCharacter = (function(_this) {\n        return function(input) {\n          var inputValue;\n          inputValue = input.val();\n          return input.val(inputValue.substring(0, inputValue.length - 1));\n        };\n      })(this);\n      $el.on(\"keypress\", \"input\", function(event) {\n        var ref;\n        if ((ref = event.keyCode) !== ENTER_KEY && ref !== ESC_KEY) {\n          return;\n        }\n        return event.preventDefault();\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          return saveInputTag();\n        } else if (event.keyCode === COMMA_KEY) {\n          removeInputLastCharacter(target);\n          return saveInputTag();\n        } else if (event.keyCode === ESC_KEY) {\n          resetInput();\n          hideInput();\n          hideSaveButton();\n          return showAddTagButton();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".add-tag\", function(event) {\n        event.preventDefault();\n        hideAddTagButton();\n        return showInput();\n      });\n      $el.on(\"click\", \".icon-delete\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project.tags_colors\", function(tags_colors) {\n        var positioningFunction;\n        if (!isEditable()) {\n          renderInReadModeOnly();\n          return;\n        }\n        showAddTagButton();\n        positioningFunction = function(position, elements) {\n          var menu;\n          menu = elements.element.element;\n          menu.css(\"width\", elements.target.width);\n          menu.css(\"top\", position.top);\n          return menu.css(\"left\", position.left);\n        };\n        return $el.find(\"input\").autocomplete({\n          source: _.keys(tags_colors),\n          position: {\n            my: \"left top\",\n            using: positioningFunction\n          },\n          select: function(event, ui) {\n            addValue(ui.item.value);\n            return ui.item.value = \"\";\n          }\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(model) {\n        var ref, ref1, tagsColors;\n        if (!model) {\n          return;\n        }\n        if ((ref = model.tags) != null ? ref.length : void 0) {\n          hideAddTagButtonText();\n        } else {\n          showAddTagButtonText();\n        }\n        tagsColors = ((ref1 = $scope.project) != null ? ref1.tags_colors : void 0) || [];\n        return renderTags(model.tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgTagLine\", [\"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", TagLineDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/wisiwyg.coffee\n */\n\n(function() {\n  var MarkitupDirective, bindOnce, module, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  MarkitupDirective = function($rootscope, $rs, $selectedText, $template, $compile, $translate) {\n    var link, previewTemplate;\n    previewTemplate = $template.get(\"common/wysiwyg/wysiwyg-markitup-preview.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addLine, cancelablePromise, closePreviewMode, element, markdownTitle, prepareUrlFormatting, preview, previewDomNode, renderMarkItUp, setCaretPosition, unbind, urlFormatting;\n      element = angular.element($el);\n      previewDomNode = $(\"<div/>\", {\n        \"class\": \"preview\"\n      });\n      closePreviewMode = function() {\n        element.parents(\".markdown\").find(\".preview\").remove();\n        return element.parents(\".markItUp\").show();\n      };\n      $scope.$on(\"markdown-editor:submit\", function() {\n        return closePreviewMode();\n      });\n      cancelablePromise = null;\n      preview = function() {\n        var markItUpDomNode, markdownDomNode;\n        markdownDomNode = element.parents(\".markdown\");\n        markItUpDomNode = element.parents(\".markItUp\");\n        return $rs.mdrender.render($scope.projectId, $model.$modelValue).then(function(data) {\n          var html, markdown;\n          html = previewTemplate({\n            data: data.data\n          });\n          html = $compile(html)($scope);\n          markdownDomNode.append(html);\n          markItUpDomNode.hide();\n          markdown = element.closest(\".markdown\");\n          return markdown.on(\"mouseup.preview\", \".preview\", function(event) {\n            var target;\n            event.preventDefault();\n            target = angular.element(event.target);\n            if (!target.is('a') && $selectedText.get().length) {\n              return;\n            }\n            markdown.off(\".preview\");\n            return closePreviewMode();\n          });\n        });\n      };\n      setCaretPosition = function(textarea, caretPosition) {\n        var line, range, scrollRelation, totalLines;\n        if (textarea.createTextRange) {\n          range = textarea.createTextRange();\n          range.move(\"character\", caretPosition);\n          range.select();\n        } else if (textarea.selectionStart) {\n          textarea.focus();\n          textarea.setSelectionRange(caretPosition, caretPosition);\n        }\n        totalLines = textarea.value.split(\"\\n\").length;\n        line = textarea.value.slice(0, +(caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n        scrollRelation = line / totalLines;\n        return $el.scrollTop((scrollRelation * $el[0].scrollHeight) - ($el.height() / 2));\n      };\n      addLine = function(textarea, nline, replace) {\n        var cursorPosition, j, key, len, line, lines;\n        lines = textarea.value.split(\"\\n\");\n        if (replace) {\n          lines[nline] = replace + lines[nline];\n        } else {\n          lines[nline] = \"\";\n        }\n        cursorPosition = 0;\n        for (key = j = 0, len = lines.length; j < len; key = ++j) {\n          line = lines[key];\n          cursorPosition += line.length + 1 || 1;\n          if (key === nline) {\n            break;\n          }\n        }\n        textarea.value = lines.join(\"\\n\");\n        if (replace) {\n          return cursorPosition - lines[nline].length + replace.length - 1;\n        } else {\n          return cursorPosition;\n        }\n      };\n      prepareUrlFormatting = function(markItUp) {\n        var indices, regex, result;\n        regex = /(<<<|>>>)/gi;\n        result = 0;\n        indices = [];\n        while ((result = regex.exec(markItUp.textarea.value))) {\n          indices.push(result.index);\n        }\n        return markItUp.donotparse = indices;\n      };\n      urlFormatting = function(markItUp) {\n        var endIndex, ref, ref1, regex, result, startIndex, url, value;\n        regex = /<<</gi;\n        result = 0;\n        startIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref = result.index, indexOf.call(markItUp.donotparse, ref) < 0) {\n            startIndex = result.index;\n            break;\n          }\n        }\n        if (!result) {\n          return;\n        }\n        regex = />>>/gi;\n        endIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref1 = result.index, indexOf.call(markItUp.donotparse, ref1) < 0) {\n            endIndex = result.index;\n            break;\n          }\n        }\n        value = markItUp.textarea.value;\n        url = value.substring(startIndex, endIndex).replace('<<<', '').replace('>>>', '');\n        url = url.replace('(', '%28').replace(')', '%29');\n        url = url.replace('[', '%5B').replace(']', '%5D');\n        value = value.substring(0, startIndex) + url + value.substring(endIndex + 3, value.length);\n        markItUp.textarea.value = value;\n        return markItUp.donotparse = void 0;\n      };\n      markdownTitle = function(markItUp, char) {\n        var heading, i, j, n, ref;\n        heading = \"\";\n        n = $.trim(markItUp.selection || markItUp.placeHolder).length;\n        for (i = j = 0, ref = n - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n          heading += char;\n        }\n        return \"\\n\" + heading + \"\\n\";\n      };\n      renderMarkItUp = function() {\n        var markdownSettings;\n        markdownSettings = {\n          nameSpace: \"markdown\",\n          onShiftEnter: {\n            keepDefault: false,\n            openWith: \"\\n\\n\"\n          },\n          onEnter: {\n            keepDefault: false,\n            replaceWith: function() {\n              if (!$('.textcomplete-dropdown').is(':visible')) {\n                return \"\\n\";\n              }\n            },\n            afterInsert: function(data) {\n              var cursorLine, emptyListItem, lastLine, lines, markdownCaretPositon, match, newLineContent, nline, replace;\n              lines = data.textarea.value.split(\"\\n\");\n              if (data.caretPosition > 0) {\n                cursorLine = data.textarea.value.slice(0, +(data.caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n              } else {\n                cursorLine = 1;\n              }\n              newLineContent = data.textarea.value.slice(data.caretPosition).split(\"\\n\")[0];\n              lastLine = lines[cursorLine - 1];\n              match = lastLine.match(/^(\\s*- ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)\\-\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*\\* ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*\\* )$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*)(\\d+)\\.\\s/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)(\\d+)\\.\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = (match[1] + (parseInt(match[2], 10) + 1)) + \". \";\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              if (markdownCaretPositon) {\n                return setCaretPosition(data.textarea, markdownCaretPositon);\n              }\n            }\n          },\n          markupSet: [\n            {\n              name: $translate.instant(\"COMMON.WYSIWYG.H1_BUTTON\"),\n              key: \"1\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H1_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"=\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H2_BUTTON\"),\n              key: \"2\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H2_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"-\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H3_BUTTON\"),\n              key: \"3\",\n              openWith: \"### \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H3_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON\"),\n              key: \"B\",\n              openWith: \"**\",\n              closeWith: \"**\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\"),\n              key: \"I\",\n              openWith: \"_\",\n              closeWith: \"_\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.STRIKE_BUTTON\"),\n              key: \"S\",\n              openWith: \"~~\",\n              closeWith: \"~~\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_BUTTON\"),\n              openWith: \"- \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_BUTTON\"),\n              openWith: function(markItUp) {\n                return markItUp.line + \". \";\n              },\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PICTURE_BUTTON\"),\n              key: \"P\",\n              openWith: \"![\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.LINK_BUTTON\"),\n              key: \"L\",\n              openWith: \"[\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.LINK_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON\"),\n              openWith: \"> \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_BUTTON\"),\n              openWith: \"```\\n\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT\"),\n              closeWith: \"\\n```\"\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PREVIEW_BUTTON\"),\n              call: preview,\n              className: \"preview-icon\"\n            }\n          ],\n          afterInsert: function(event) {\n            var target;\n            target = angular.element(event.textarea);\n            return $model.$setViewValue(target.val());\n          }\n        };\n        return element.markItUpRemove().markItUp(markdownSettings).textcomplete([\n          {\n            cache: true,\n            match: /(^|\\s)#([a-z0-9]+)$/i,\n            search: function(term, callback) {\n              var filter, searchProps, searchTypes;\n              term = taiga.slugify(term);\n              searchTypes = ['issues', 'tasks', 'userstories'];\n              searchProps = ['ref', 'subject'];\n              filter = (function(_this) {\n                return function(item) {\n                  var j, len, prop;\n                  for (j = 0, len = searchProps.length; j < len; j++) {\n                    prop = searchProps[j];\n                    if (taiga.slugify(item[prop]).indexOf(term) >= 0) {\n                      return true;\n                    }\n                  }\n                  return false;\n                };\n              })(this);\n              if (cancelablePromise) {\n                cancelablePromise.abort();\n              }\n              cancelablePromise = $rs.search[\"do\"]($scope.projectId, term);\n              cancelablePromise.then((function(_this) {\n                return function(res) {\n                  var j, len, results, type;\n                  if (res.count < 1 || res.count === res.wikipages.length) {\n                    return callback([]);\n                  } else {\n                    results = [];\n                    for (j = 0, len = searchTypes.length; j < len; j++) {\n                      type = searchTypes[j];\n                      if (res[type] && res[type].length > 0) {\n                        results.push(callback(res[type].filter(filter), true));\n                      } else {\n                        results.push(void 0);\n                      }\n                    }\n                    return results;\n                  }\n                };\n              })(this));\n              return callback([]);\n            },\n            replace: function(res) {\n              return \"$1\\#\" + res.ref + \" \";\n            },\n            template: function(res, term) {\n              return \"\\#\" + res.ref + \" - \" + res.subject;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)@([a-z0-9\\-\\._]{2,})$/i,\n            search: function(term, callback) {\n              var searchProps, username;\n              username = taiga.slugify(term);\n              searchProps = ['username', 'full_name', 'full_name_display'];\n              if ($scope.project.members.length < 1) {\n                return callback([]);\n              } else {\n                return callback($scope.project.members.filter((function(_this) {\n                  return function(user) {\n                    var j, len, prop;\n                    for (j = 0, len = searchProps.length; j < len; j++) {\n                      prop = searchProps[j];\n                      if (taiga.slugify(user[prop]).indexOf(username) >= 0) {\n                        return true;\n                      }\n                    }\n                    return false;\n                  };\n                })(this)));\n              }\n            },\n            replace: function(user) {\n              return \"$1@\" + user.username + \" \";\n            },\n            template: function(user) {\n              return user.username + \" - \" + user.full_name_display;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)\\[\\[([a-z0-9\\-]+)$/i,\n            search: function(term, callback) {\n              term = taiga.slugify(term);\n              return $rs.search[\"do\"]($scope.projectId, term).then((function(_this) {\n                return function(res) {\n                  if (res.count < 1) {\n                    callback([]);\n                  }\n                  if (res.count < 1 || !res.wikipages || res.wikipages.length <= 0) {\n                    callback([]);\n                  } else {\n                    callback(res.wikipages.filter(function(page) {\n                      return taiga.slugify(page['slug']).indexOf(term) >= 0;\n                    }), true);\n                  }\n                  return callback([]);\n                };\n              })(this));\n            },\n            replace: function(res) {\n              return \"$1[[\" + res.slug + \"]]\";\n            },\n            template: function(res, term) {\n              return res.slug;\n            }\n          }\n        ], {\n          debounce: 200\n        });\n      };\n      renderMarkItUp();\n      unbind = $rootscope.$on(\"$translateChangeEnd\", renderMarkItUp);\n      element.on(\"keypress\", function(event) {\n        return $scope.$apply();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgMarkitup\", [\"$rootScope\", \"$tgResources\", \"$selectedText\", \"$tgTemplate\", \"$compile\", \"$translate\", MarkitupDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogFiltersDirective, bindOnce, debounceLeading, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogFiltersDirective = function($q, $log, $location, $templates) {\n    var link, template, templateSelected;\n    template = $templates.get(\"backlog/filters.html\", true);\n    templateSelected = $templates.get(\"backlog/filter-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, currentFiltersType, getFiltersType, initializeSelectedFilters, reloadUserstories, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection;\n      currentFiltersType = '';\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\"h2.breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 a.subfilter span.title\").html(title);\n        $el.find(\"h2 a.subfilter span.title\").prop(\"data-type\", type);\n        return currentFiltersType = getFiltersType();\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\"h2.breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function() {\n        var i, len, name, ref, val, values;\n        showCategories();\n        selectedFilters = [];\n        ref = $scope.filters;\n        for (name in ref) {\n          values = ref[name];\n          for (i = 0, len = values.length; i < len; i++) {\n            val = values[i];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters();\n      };\n      renderSelectedFilters = function() {\n        var html;\n        _.map(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        return $el.find(\".filters-applied\").html(html);\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.map(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n      };\n      reloadUserstories = function() {\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadUserstories(), $ctrl.generateFilters()]).then(function() {\n          var currentFilters;\n          currentFilters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(currentFilters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var filter, filters;\n        currentFiltersType = getFiltersType();\n        filters = $scope.filters[type];\n        filter = _.find(filters, {\n          id: id\n        });\n        filter.selected = !filter.selected;\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $scope.$apply(function() {\n            return $ctrl.selectFilter(type, id);\n          });\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(selected) {\n            return filter.type === selected.type && filter.id === selected.id;\n          });\n          $ctrl.unselectFilter(type, id);\n        }\n        renderSelectedFilters(selectedFilters);\n        if (type === currentFiltersType) {\n          renderFilters(_.reject(filters, \"selected\"));\n        }\n        return reloadUserstories();\n      };\n      selectQFilter = debounceLeading(100, function(value) {\n        if (value === void 0) {\n          return;\n        }\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n        }\n        return reloadUserstories();\n      });\n      $scope.$watch(\"filtersQ\", selectQFilter);\n      $scope.$on(\"backlog:loaded\", function(ctx) {\n        return initializeSelectedFilters();\n      });\n      $scope.$on(\"filters:update\", function(ctx) {\n        return $ctrl.generateFilters().then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          if (currentFiltersType) {\n            return renderFilters(_.reject(filters, \"selected\"));\n          }\n        });\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data('type'));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories();\n      });\n      $el.on(\"click\", \".filters-applied a\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      return $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.hasClass(\"active\")) {\n          target.removeClass(\"active\");\n        } else {\n          target.addClass(\"active\");\n        }\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgTemplate\", BacklogFiltersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/lightboxes.coffee\n */\n\n(function() {\n  var CreateEditSprint, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  CreateEditSprint = function($repo, $confirm, $rs, $rootscope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var createSprint, getLastSprint, hasErrors, remove, resetSprint, submit;\n      hasErrors = false;\n      createSprint = true;\n      resetSprint = function() {\n        return $scope.sprint = {\n          project: null,\n          name: null,\n          estimated_start: null,\n          estimated_finish: null\n        };\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, newSprint, prettyDate, promise, submitButton, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          submitButton = $el.find(\".submit-button\");\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            hasErrors = true;\n            $el.find(\".last-sprint-name\").addClass(\"disappear\");\n            return;\n          }\n          hasErrors = false;\n          newSprint = angular.copy($scope.sprint);\n          broadcastEvent = null;\n          if (createSprint) {\n            newSprint.estimated_start = moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.create(\"milestones\", newSprint);\n            broadcastEvent = \"sprintform:create:success\";\n          } else {\n            newSprint.setAttr(\"estimated_start\", moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\"));\n            newSprint.setAttr(\"estimated_finish\", moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\"));\n            promise = $repo.save(newSprint);\n            broadcastEvent = \"sprintform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise.then(function(data) {\n            currentLoading.finish();\n            if (createSprint) {\n              $scope.sprintsCounter += 1;\n            }\n            $rootscope.$broadcast(broadcastEvent, data);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"light-error\", data._error_message);\n            } else if (data.__all__) {\n              return $confirm.notify(\"light-error\", data.__all__[0]);\n            }\n          });\n        };\n      })(this));\n      remove = function() {\n        var message, title;\n        title = $translate.instant(\"LIGHTBOX.DELETE_SPRINT.TITLE\");\n        message = $scope.sprint.name;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSuccess;\n            onSuccess = function() {\n              askResponse.finish();\n              $scope.milestonesCounter -= 1;\n              lightboxService.close($el);\n              return $rootscope.$broadcast(\"sprintform:remove:success\", $scope.sprint);\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove($scope.sprint).then(onSuccess, onError);\n          };\n        })(this));\n      };\n      getLastSprint = function() {\n        var openSprints, sortedSprints;\n        openSprints = _.filter($scope.sprints, function(sprint) {\n          return !sprint.closed;\n        });\n        sortedSprints = _.sortBy(openSprints, function(sprint) {\n          return moment(sprint.estimated_finish, 'YYYY-MM-DD').format('X');\n        });\n        return sortedSprints[sortedSprints.length - 1];\n      };\n      $scope.$on(\"sprintform:create\", function(event, projectId) {\n        var estimatedFinish, estimatedStart, form, lastSprint, lastSprintNameDom, prettyDate, text;\n        resetSprint();\n        form = $el.find(\"form\").checksley();\n        form.reset();\n        createSprint = true;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.sprint.project = projectId;\n        $scope.sprint.name = null;\n        $scope.sprint.slug = null;\n        lastSprint = getLastSprint();\n        estimatedStart = moment();\n        if (lastSprint) {\n          estimatedStart = moment(lastSprint.estimated_finish);\n        } else if ($scope.sprint.estimated_start) {\n          estimatedStart = moment($scope.sprint.estimated_start);\n        }\n        $scope.sprint.estimated_start = estimatedStart.format(prettyDate);\n        estimatedFinish = moment().add(2, \"weeks\");\n        if (lastSprint) {\n          estimatedFinish = moment(lastSprint.estimated_finish).add(2, \"weeks\");\n        } else if ($scope.sprint.estimated_finish) {\n          estimatedFinish = moment($scope.sprint.estimated_finish);\n        }\n        $scope.sprint.estimated_finish = estimatedFinish.format(prettyDate);\n        lastSprintNameDom = $el.find(\".last-sprint-name\");\n        if ((lastSprint != null ? lastSprint.name : void 0) != null) {\n          text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME\", {\n            lastSprint: lastSprint.name\n          });\n          lastSprintNameDom.html(text);\n        }\n        $el.find(\".delete-sprint\").addClass(\"hidden\");\n        text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.TITLE\");\n        $el.find(\".title\").text(text);\n        text = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").text(text);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus();\n        return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n      });\n      $scope.$on(\"sprintform:edit\", function(ctx, sprint) {\n        var editSprint, prettyDate, save;\n        resetSprint();\n        createSprint = false;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.$apply(function() {\n          $scope.sprint = sprint;\n          $scope.sprint.estimated_start = moment($scope.sprint.estimated_start).format(prettyDate);\n          return $scope.sprint.estimated_finish = moment($scope.sprint.estimated_finish).format(prettyDate);\n        });\n        $el.find(\".delete-sprint\").removeClass(\"hidden\");\n        editSprint = $translate.instant(\"BACKLOG.EDIT_SPRINT\");\n        $el.find(\".title\").text(editSprint);\n        save = $translate.instant(\"COMMON.SAVE\");\n        $el.find(\".button-green\").text(save);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus().select();\n        return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n      });\n      $el.on(\"keyup\", \".sprint-name\", function(event) {\n        if ($el.find(\".sprint-name\").val().length > 0 || hasErrors) {\n          return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n        } else {\n          return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".delete-sprint .icon-delete\", function(event) {\n        event.preventDefault();\n        return remove();\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return resetSprint();\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditSprint\", [\"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditSprint]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogController, BacklogDirective, BurndownBacklogGraphDirective, TgBacklogProgressBarDirective, ToggleBurndownVisibility, UsPointsDirective, UsRolePointsSelectorDirective, bindMethods, bindOnce, generateHash, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  generateHash = this.taiga.generateHash;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogController = (function(superClass) {\n    extend(BacklogController, superClass);\n\n    BacklogController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLoading\"];\n\n    function BacklogController(scope1, rootscope, repo, confirm, rs, params1, q, location, appMetaService, navUrls, events, analytics, translate, loading) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loading = loading;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"BACKLOG.SECTION_NAME\");\n      this.showTags = false;\n      this.activeFilters = false;\n      this.scope.showGraphPlaceholder = null;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"BACKLOG.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"BACKLOG.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          _this.appMetaService.setAll(title, description);\n          if (_this.rs.userstories.getShowTags(_this.scope.projectId)) {\n            _this.showTags = true;\n            return _this.scope.$broadcast(\"showTags\", _this.showTags);\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    BacklogController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:create:success\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"sprint\", \"create\", \"create sprint on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.loadProjectStats();\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"sprintform:remove:success\", (function(_this) {\n        return function(event, sprint) {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.loadUserstories();\n          if (sprint.closed) {\n            _this.loadClosedSprints();\n          }\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"sprint:us:move\", this.moveUs);\n      this.scope.$on(\"sprint:us:moved\", this.loadSprints);\n      this.scope.$on(\"sprint:us:moved\", this.loadProjectStats);\n      this.scope.$on(\"backlog:load-closed-sprints\", this.loadClosedSprints);\n      return this.scope.$on(\"backlog:unload-closed-sprints\", this.unloadClosedSprints);\n    };\n\n    BacklogController.prototype.initializeSubscription = function() {\n      var routingKey1, routingKey2;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.loadUserstories();\n          return _this.loadSprints();\n        };\n      })(this));\n      routingKey2 = \"changes.project.\" + this.scope.projectId + \".milestones\";\n      return this.events.subscribe(this.scope, routingKey2, (function(_this) {\n        return function(message) {\n          return _this.loadSprints();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleShowTags = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.showTags = !_this.showTags;\n          return _this.rs.userstories.storeShowTags(_this.scope.projectId, _this.showTags);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleActiveFilters = function() {\n      return this.activeFilters = !this.activeFilters;\n    };\n\n    BacklogController.prototype.loadProjectStats = function() {\n      return this.rs.projects.stats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totalPoints;\n          _this.scope.stats = stats;\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          if (totalPoints) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.closed_points / totalPoints);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.showGraphPlaceholder = !((stats.total_points != null) && (stats.total_milestones != null));\n          return stats;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.unloadClosedSprints = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.scope.closedSprints = [];\n          return _this.rootscope.$broadcast(\"closed-sprints:reloaded\", []);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadClosedSprints = function() {\n      var params;\n      params = {\n        closed: true\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalClosedMilestones = result.closed;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.closedSprints = sprints;\n          _this.scope.closedSprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"closed-sprints:reloaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadSprints = function() {\n      var params;\n      params = {\n        closed: false\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalMilestones = sprints;\n          _this.scope.totalClosedMilestones = result.closed;\n          _this.scope.totalOpenMilestones = result.open;\n          _this.scope.totalMilestones = _this.scope.totalOpenMilestones + _this.scope.totalClosedMilestones;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.sprints = sprints;\n          _this.scope.openSprints = _.filter(sprints, function(sprint) {\n            return !sprint.closed;\n          }).reverse();\n          if (!_this.scope.closedSprints) {\n            _this.scope.closedSprints = [];\n          }\n          _this.scope.sprintsCounter = sprints.length;\n          _this.scope.sprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"sprints:loaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.restoreFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = this.scope.oldSelectedTags;\n      selectedStatuses = this.scope.oldSelectedStatuses;\n      if (!selectedStatuses && !selectedStatuses) {\n        return;\n      }\n      this.scope.filtersQ = this.scope.filtersQOld;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = true;\n            return _this.selectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.resetFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = _.filter(this.scope.filters.tags, \"selected\");\n      selectedStatuses = _.filter(this.scope.filters.status, \"selected\");\n      this.scope.oldSelectedTags = selectedTags;\n      this.scope.oldSelectedStatuses = selectedStatuses;\n      this.scope.filtersQOld = this.scope.filtersQ;\n      this.scope.filtersQ = void 0;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = false;\n            return _this.unselectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.loadUserstories = function() {\n      var promise;\n      this.scope.httpParams = this.getUrlFilters();\n      this.rs.userstories.storeQueryParams(this.scope.projectId, this.scope.httpParams);\n      promise = this.rs.userstories.listUnassigned(this.scope.projectId, this.scope.httpParams);\n      return promise.then((function(_this) {\n        return function(userstories) {\n          _this.scope.userstories = _.sortBy(userstories, \"backlog_order\");\n          _this.setSearchDataFilters();\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\");\n          });\n          return userstories;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadBacklog = function() {\n      return this.q.all([this.loadProjectStats(), this.loadSprints(), this.loadUserstories()]);\n    };\n\n    BacklogController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.closedMilestones = !!project.total_closed_milestones;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"id\");\n          return project;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.initializeSubscription();\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadBacklog();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.generateFilters();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.scope.$emit(\"backlog:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    BacklogController.prototype.resortUserStories = function(uses, field) {\n      var index, item, items, j, len;\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      items = [];\n      for (index = j = 0, len = uses.length; j < len; index = ++j) {\n        item = uses[index];\n        item[field] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    BacklogController.prototype.moveUs = function(ctx, usList, newUsIndex, newSprintId) {\n      var data, items, j, l, len, len1, len2, m, movedFromClosedSprint, movedToClosedSprint, newSprint, oldSprintId, project, promise, promises, sprint, us, userstories;\n      oldSprintId = usList[0].milestone;\n      project = usList[0].project;\n      movedFromClosedSprint = false;\n      movedToClosedSprint = false;\n      sprint = this.scope.sprintsById[oldSprintId];\n      if (!sprint && this.scope.closedSprintsById) {\n        sprint = this.scope.closedSprintsById[oldSprintId];\n        if (sprint) {\n          movedFromClosedSprint = true;\n        }\n      }\n      newSprint = this.scope.sprintsById[newSprintId];\n      if (!newSprint && newSprintId) {\n        newSprint = this.scope.closedSprintsById[newSprintId];\n        if (newSprint) {\n          movedToClosedSprint = true;\n        }\n      }\n      if (newSprintId === oldSprintId) {\n        items = null;\n        userstories = null;\n        if (newSprintId === null) {\n          userstories = this.scope.userstories;\n        } else {\n          userstories = newSprint.user_stories;\n        }\n        this.scope.$apply(function() {\n          var args, j, key, len, r, us;\n          for (key = j = 0, len = usList.length; j < len; key = ++j) {\n            us = usList[key];\n            r = userstories.indexOf(us);\n            userstories.splice(r, 1);\n          }\n          args = [newUsIndex, 0].concat(usList);\n          return Array.prototype.splice.apply(userstories, args);\n        });\n        if (newSprintId === null) {\n          items = this.resortUserStories(userstories, \"backlog_order\");\n          data = this.prepareBulkUpdateData(items, \"backlog_order\");\n          this.rs.userstories.bulkUpdateBacklogOrder(project, data).then((function(_this) {\n            return function() {\n              var j, len, results, us;\n              results = [];\n              for (j = 0, len = usList.length; j < len; j++) {\n                us = usList[j];\n                results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n              }\n              return results;\n            };\n          })(this));\n        } else {\n          items = this.resortUserStories(userstories, \"sprint_order\");\n          data = this.prepareBulkUpdateData(items, \"sprint_order\");\n          this.rs.userstories.bulkUpdateSprintOrder(project, data).then((function(_this) {\n            return function() {\n              var j, len, results, us;\n              results = [];\n              for (j = 0, len = usList.length; j < len; j++) {\n                us = usList[j];\n                results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n              }\n              return results;\n            };\n          })(this));\n        }\n        return promise;\n      }\n      if (newSprintId === null) {\n        for (j = 0, len = usList.length; j < len; j++) {\n          us = usList[j];\n          us.milestone = null;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, l, len1, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(_this.scope.userstories, args);\n            results = [];\n            for (key = l = 0, len1 = usList.length; l < len1; key = ++l) {\n              us = usList[key];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n        promise = this.repo.save(us);\n        promise = promise.then((function(_this) {\n          return function() {\n            items = _this.resortUserStories(_this.scope.userstories, \"backlog_order\");\n            data = _this.prepareBulkUpdateData(items, \"backlog_order\");\n            return _this.rs.userstories.bulkUpdateBacklogOrder(us.project, data).then(function() {\n              _this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId);\n              if (movedFromClosedSprint) {\n                return _this.rootscope.$broadcast(\"backlog:load-closed-sprints\");\n              }\n            });\n          };\n        })(this));\n        promise.then(null, function() {\n          return console.log(\"FAIL\");\n        });\n        return promise;\n      }\n      if (oldSprintId === null) {\n        for (l = 0, len1 = usList.length; l < len1; l++) {\n          us = usList[l];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, len2, m, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (key = m = 0, len2 = usList.length; m < len2; key = ++m) {\n              us = usList[key];\n              r = _this.scope.userstories.indexOf(us);\n              results.push(_this.scope.userstories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      } else {\n        for (m = 0, len2 = usList.length; m < len2; m++) {\n          us = usList[m];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, len3, n, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (n = 0, len3 = usList.length; n < len3; n++) {\n              us = usList[n];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      }\n      promises = _.map(usList, (function(_this) {\n        return function(us) {\n          return _this.repo.save(us);\n        };\n      })(this));\n      promise = this.q.all(promises).then((function(_this) {\n        return function() {\n          items = _this.resortUserStories(newSprint.user_stories, \"sprint_order\");\n          data = _this.prepareBulkUpdateData(items, \"sprint_order\");\n          _this.rs.userstories.bulkUpdateSprintOrder(project, data).then(function(result) {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId);\n          });\n          _this.rs.userstories.bulkUpdateBacklogOrder(project, data).then(function() {\n            var len3, n, results;\n            results = [];\n            for (n = 0, len3 = usList.length; n < len3; n++) {\n              us = usList[n];\n              results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n            }\n            return results;\n          });\n          if (movedToClosedSprint || movedFromClosedSprint) {\n            return _this.scope.$broadcast(\"backlog:load-closed-sprints\");\n          }\n        };\n      })(this));\n      promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n      return promise;\n    };\n\n    BacklogController.prototype.isFilterSelected = function(type, id) {\n      if ((this.searchdata[type] != null) && this.searchdata[type][id]) {\n        return true;\n      }\n      return false;\n    };\n\n    BacklogController.prototype.setSearchDataFilters = function() {\n      var name, results, urlfilters, val, value;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = this.scope.filtersQ || urlfilters.q;\n      }\n      this.searchdata = {};\n      results = [];\n      for (name in urlfilters) {\n        value = urlfilters[name];\n        if (this.searchdata[name] == null) {\n          this.searchdata[name] = {};\n        }\n        results.push((function() {\n          var j, len, ref1, results1;\n          ref1 = taiga.toString(value).split(\",\");\n          results1 = [];\n          for (j = 0, len = ref1.length; j < len; j++) {\n            val = ref1[j];\n            results1.push(this.searchdata[name][val] = true);\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    BacklogController.prototype.getUrlFilters = function() {\n      return _.pick(this.location.search(), \"status\", \"tags\", \"q\");\n    };\n\n    BacklogController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      urlfilters = this.getUrlFilters();\n      this.scope.filters = {};\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.milestone = 'null';\n      return this.rs.userstories.filtersData(loadFilters).then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, selectedStatuses, selectedTags, tagsFilterFormat;\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.usStatusById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          selectedTags = _.filter(_this.scope.filters.tags, \"selected\");\n          selectedTags = _.map(selectedTags, \"id\");\n          selectedStatuses = _.filter(_this.scope.filters.status, \"selected\");\n          selectedStatuses = _.map(selectedStatuses, \"id\");\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rs.userstories.storeQueryParams(_this.scope.projectId, {\n            \"status\": selectedStatuses,\n            \"tags\": selectedTags,\n            \"project\": _this.scope.projectId,\n            \"milestone\": null\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref1, ref2, results, searchdata, val, value;\n      searchdata = {};\n      ref1 = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref1) {\n        value = ref1[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref2 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref2.length; j < len; j++) {\n          val = ref2[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var l, len1, results1;\n          results1 = [];\n          for (l = 0, len1 = value.length; l < len1; l++) {\n            obj = value[l];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    BacklogController.prototype.updateUserStoryStatus = function() {\n      this.setSearchDataFilters();\n      return this.generateFilters().then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.loadProjectStats();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.editUserStory = function(projectId, ref, $event) {\n      var currentLoading, target;\n      target = $($event.target);\n      currentLoading = this.loading().target(target).removeClasses(\"icon-edit\").timeout(200).start();\n      return this.rs.userstories.getByRef(projectId, ref).then((function(_this) {\n        return function(us) {\n          _this.rootscope.$broadcast(\"usform:edit\", us);\n          return currentLoading.finish();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.deleteUserStory = function(us) {\n      var message, title;\n      title = this.translate.instant(\"US.TITLE_DELETE_ACTION\");\n      message = us.subject;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var promise;\n          _this.scope.userstories = _.without(_this.scope.userstories, us);\n          promise = _this.repo.remove(us);\n          promise.then(function() {\n            askResponse.finish();\n            return _this.loadBacklog();\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.addNewUs = function(type) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, this.scope.project.default_us_status, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, this.scope.project.default_us_status);\n      }\n    };\n\n    BacklogController.prototype.addNewSprint = function() {\n      return this.rootscope.$broadcast(\"sprintform:create\", this.scope.projectId);\n    };\n\n    return BacklogController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BacklogController\", BacklogController);\n\n  BacklogDirective = function($repo, $rootscope, $translate) {\n    var doomLineTemplate, link, linkDoomLine, linkFilters, linkToolbar, showHideFilter, showHideTags;\n    doomLineTemplate = _.template(\"<div class=\\\"doom-line\\\"><span><%- text %></span></div>\");\n    linkDoomLine = function($scope, $el, $attrs, $ctrl) {\n      var addDoomLineDom, getUsItems, reloadDoomLine, removeDoomlineDom;\n      reloadDoomLine = function() {\n        var current_sum, domElement, i, j, len, ref1, results, stats, total_points, us;\n        if (($scope.stats != null) && ($scope.stats.total_points != null) && $scope.stats.total_points !== 0) {\n          removeDoomlineDom();\n          stats = $scope.stats;\n          total_points = stats.total_points;\n          current_sum = stats.assigned_points;\n          if (!$scope.userstories) {\n            return;\n          }\n          ref1 = $scope.userstories;\n          results = [];\n          for (i = j = 0, len = ref1.length; j < len; i = ++j) {\n            us = ref1[i];\n            current_sum += us.total_points;\n            if (current_sum > total_points) {\n              domElement = $el.find('.backlog-table-body .us-item-row')[i];\n              addDoomLineDom(domElement);\n              break;\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        }\n      };\n      removeDoomlineDom = function() {\n        return $el.find(\".doom-line\").remove();\n      };\n      addDoomLineDom = function(element) {\n        var text;\n        text = $translate.instant(\"BACKLOG.DOOMLINE\");\n        return $(element).before(doomLineTemplate({\n          \"text\": text\n        }));\n      };\n      getUsItems = function() {\n        var rowElements;\n        rowElements = $el.find('.backlog-table-body .us-item-row');\n        return _.map(rowElements, function(x) {\n          return angular.element(x);\n        });\n      };\n      $scope.$on(\"userstories:loaded\", reloadDoomLine);\n      return $scope.$watch(\"stats\", reloadDoomLine);\n    };\n    linkToolbar = function($scope, $el, $attrs, $ctrl) {\n      var checkSelected, lastChecked, moveToCurrentSprint, shiftPressed;\n      moveToCurrentSprint = function(selectedUss) {\n        var extraPoints, totalExtraPoints, ussCurrent;\n        ussCurrent = _($scope.userstories);\n        $scope.userstories = ussCurrent.without.apply(ussCurrent, selectedUss).value();\n        extraPoints = _.map(selectedUss, function(v, k) {\n          return v.total_points;\n        });\n        totalExtraPoints = _.reduce(extraPoints, function(acc, num) {\n          return acc + num;\n        });\n        $scope.sprints[0].user_stories = _.union($scope.sprints[0].user_stories, selectedUss);\n        $scope.sprints[0].total_points += totalExtraPoints;\n        return $repo.saveAll(selectedUss).then(function() {\n          $ctrl.loadSprints();\n          return $ctrl.loadProjectStats();\n        });\n      };\n      shiftPressed = false;\n      lastChecked = null;\n      checkSelected = function(target) {\n        var moveToCurrentSprintDom, selectedUsDom;\n        lastChecked = target.closest(\".us-item-row\");\n        moveToCurrentSprintDom = $el.find(\"#move-to-current-sprint\");\n        selectedUsDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        if (selectedUsDom.length > 0 && $scope.sprints.length > 0) {\n          moveToCurrentSprintDom.show();\n        } else {\n          moveToCurrentSprintDom.hide();\n        }\n        return target.closest('.us-item-row').toggleClass('ui-multisortable-multiple');\n      };\n      $(window).on(\"keydown.shift-pressed keyup.shift-pressed\", function(event) {\n        shiftPressed = !!event.shiftKey;\n        return true;\n      });\n      $el.on(\"change\", \".backlog-table-body input:checkbox\", function(event) {\n        var current, elements, nextAll, prevAll, target;\n        if (lastChecked && shiftPressed) {\n          elements = [];\n          current = $(event.currentTarget).closest(\".us-item-row\");\n          nextAll = lastChecked.nextAll();\n          prevAll = lastChecked.prevAll();\n          if (_.some(nextAll, function(next) {\n            return next === current[0];\n          })) {\n            elements = lastChecked.nextUntil(current);\n          } else if (_.some(prevAll, function(prev) {\n            return prev === current[0];\n          })) {\n            elements = lastChecked.prevUntil(current);\n          }\n          _.map(elements, function(elm) {\n            var input;\n            input = $(elm).find(\"input:checkbox\");\n            input.prop('checked', true);\n            return checkSelected(input);\n          });\n        }\n        target = angular.element(event.currentTarget);\n        target.closest(\".us-item-row\").toggleClass('is-checked');\n        return checkSelected(target);\n      });\n      $el.on(\"click\", \"#move-to-current-sprint\", (function(_this) {\n        return function(event) {\n          var ussDom, ussToMove;\n          ussDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n          ussToMove = _.map(ussDom, function(item) {\n            var itemScope;\n            item = $(item).closest('.tg-scope');\n            itemScope = item.scope();\n            itemScope.us.milestone = $scope.sprints[0].id;\n            return itemScope.us;\n          });\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        };\n      })(this));\n      return $el.on(\"click\", \"#show-tags\", function(event) {\n        event.preventDefault();\n        $ctrl.toggleShowTags();\n        return showHideTags($ctrl);\n      });\n    };\n    showHideTags = function($ctrl) {\n      var elm, text;\n      elm = angular.element(\"#show-tags\");\n      if ($ctrl.showTags) {\n        elm.addClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.HIDE\");\n        return elm.text(text);\n      } else {\n        elm.removeClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.SHOW\");\n        return elm.text(text);\n      }\n    };\n    showHideFilter = function($scope, $el, $ctrl) {\n      var hideText, showText, sidebar, target;\n      sidebar = $el.find(\"sidebar.filters-bar\");\n      sidebar.one(\"transitionend\", function() {\n        return timeout(150, function() {\n          $rootscope.$broadcast(\"resize\");\n          return $('.burndown').css(\"visibility\", \"visible\");\n        });\n      });\n      target = angular.element(\"#show-filters-button\");\n      $('.burndown').css(\"visibility\", \"hidden\");\n      sidebar.toggleClass(\"active\");\n      target.toggleClass(\"active\");\n      hideText = $translate.instant(\"BACKLOG.FILTERS.HIDE\");\n      showText = $translate.instant(\"BACKLOG.FILTERS.SHOW\");\n      toggleText(target, [hideText, showText]);\n      if (!sidebar.hasClass(\"active\")) {\n        $ctrl.resetFilters();\n      } else {\n        $ctrl.restoreFilters();\n      }\n      return $ctrl.toggleActiveFilters();\n    };\n    linkFilters = function($scope, $el, $attrs, $ctrl) {\n      $scope.filtersSearch = {};\n      return $el.on(\"click\", \"#show-filters-button\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return showHideFilter($scope, $el, $ctrl);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs, $rootscope) {\n      var $ctrl, filters;\n      $ctrl = $el.controller();\n      linkToolbar($scope, $el, $attrs, $ctrl);\n      linkFilters($scope, $el, $attrs, $ctrl);\n      linkDoomLine($scope, $el, $attrs, $ctrl);\n      $el.find(\".backlog-table-body\").disableSelection();\n      filters = $ctrl.getUrlFilters();\n      if (filters.status || filters.tags || filters.q) {\n        showHideFilter($scope, $el, $ctrl);\n      }\n      $scope.$on(\"showTags\", function() {\n        return showHideTags($ctrl);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $(window).off(\".shift-pressed\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklog\", [\"$tgRepo\", \"$rootScope\", \"$translate\", BacklogDirective]);\n\n  UsRolePointsSelectorDirective = function($rootscope, $template, $compile, $translate) {\n    var link, selectionTemplate;\n    selectionTemplate = $template.get(\"backlog/us-role-points-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var numberOfRoles, roles;\n        roles = _.filter(project.roles, \"computable\");\n        numberOfRoles = _.size(roles);\n        if (numberOfRoles > 1) {\n          return $el.append($compile(selectionTemplate({\n            \"roles\": roles\n          }))($scope));\n        } else {\n          $el.find(\".icon-arrow-bottom\").remove();\n          return $el.find(\".header-points\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        $el.find(\".popover\").popover().close();\n        return $el.find(\".header-points\").html(roleName + \"/<span>Total</span>\");\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx, roleId) {\n        var text;\n        $el.find(\".popover\").popover().close();\n        text = $translate.instant(\"COMMON.FIELDS.POINTS\");\n        return $el.find(\".header-points\").text(text);\n      });\n      $el.on(\"click\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (target.is(\"span\") || target.is(\"div\")) {\n          event.stopPropagation();\n        }\n        return $el.find(\".popover\").popover().open();\n      });\n      $el.on(\"click\", \".clear-selection\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $rootscope.$broadcast(\"uspoints:clear-selection\");\n      });\n      $el.on(\"click\", \".role\", function(event) {\n        var rolScope, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        rolScope = target.scope();\n        return $rootscope.$broadcast(\"uspoints:select\", target.data(\"role-id\"), target.text());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsRolePointsSelector\", [\"$rootScope\", \"$tgTemplate\", \"$compile\", UsRolePointsSelectorDirective]);\n\n  UsPointsDirective = function($tgEstimationsService, $repo, $tgTemplate) {\n    var link, rolesTemplate;\n    rolesTemplate = $tgTemplate.get(\"common/estimation/us-points-roles-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, bindClickElements, estimationProcess, filteringRoleId, renderRolesSelector, selectedRoleId, updatingSelectedRoleId;\n      $ctrl = $el.controller();\n      updatingSelectedRoleId = null;\n      selectedRoleId = null;\n      filteringRoleId = null;\n      estimationProcess = null;\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = roleId;\n        return estimationProcess.render();\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = null;\n        return estimationProcess.render();\n      });\n      $scope.$watch($attrs.tgBacklogUsPoints, function(us) {\n        var roles;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          roles = estimationProcess.calculateRoles();\n          if (roles.length === 0) {\n            $el.find(\".icon-arrow-bottom\").remove();\n            $el.find(\"a.us-points\").addClass(\"not-clickable\");\n          } else if (roles.length === 1) {\n            selectedRoleId = _.keys(us.points)[0];\n          }\n          if (estimationProcess.isEditable) {\n            bindClickElements();\n          }\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return this.save(roleId, pointId).then(function() {\n              return $ctrl.loadProjectStats();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, pointId, pointObj, template, text, title, totalPoints;\n            totalPoints = this.calculateTotalPoints();\n            if ((selectedRoleId == null) || roles.length === 1) {\n              text = totalPoints;\n              title = totalPoints;\n            } else {\n              pointId = this.us.points[selectedRoleId];\n              pointObj = this.pointsById[pointId];\n              text = pointObj.name + \" / <span>\" + totalPoints + \"</span>\";\n              title = pointObj.name + \" / \" + totalPoints;\n            }\n            ctx = {\n              totalPoints: totalPoints,\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              text: text,\n              title: title\n            };\n            mainTemplate = \"common/estimation/us-estimation-total.html\";\n            template = $tgTemplate.get(mainTemplate, true);\n            html = template(ctx);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      renderRolesSelector = function() {\n        var html, roles;\n        roles = estimationProcess.calculateRoles();\n        html = rolesTemplate({\n          \"roles\": roles\n        });\n        $el.append(html);\n        return $el.find(\".pop-role\").popover().open(function() {\n          return $(this).remove();\n        });\n      };\n      bindClickElements = function() {\n        $el.on(\"click\", \"a.us-points span\", function(event) {\n          var us;\n          event.preventDefault();\n          event.stopPropagation();\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = selectedRoleId;\n          if (selectedRoleId != null) {\n            return estimationProcess.renderPointsSelector(selectedRoleId);\n          } else {\n            return renderRolesSelector();\n          }\n        });\n        return $el.on(\"click\", \".role\", function(event) {\n          var popRolesDom, target, us;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = target.data(\"role-id\");\n          popRolesDom = $el.find(\".pop-role\");\n          popRolesDom.find(\"a\").removeClass(\"active\");\n          popRolesDom.find(\"a[data-role-id='\" + updatingSelectedRoleId + \"']\").addClass(\"active\");\n          return estimationProcess.renderPointsSelector(updatingSelectedRoleId);\n        });\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogUsPoints\", [\"$tgEstimationsService\", \"$tgRepo\", \"$tgTemplate\", UsPointsDirective]);\n\n  ToggleBurndownVisibility = function($storage) {\n    var hide, link, show;\n    hide = function() {\n      $(\".js-burndown-graph\").removeClass(\"shown\");\n      $(\".js-toggle-burndown-visibility-button\").removeClass(\"active\");\n      return $(\".js-burndown-graph\").removeClass(\"open\");\n    };\n    show = function(firstLoad) {\n      $(\".js-toggle-burndown-visibility-button\").addClass(\"active\");\n      if (firstLoad) {\n        return $(\".js-burndown-graph\").addClass(\"shown\");\n      } else {\n        return $(\".js-burndown-graph\").addClass(\"open\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var firstLoad, hash, toggleGraph;\n      firstLoad = true;\n      hash = generateHash([\"is-burndown-grpahs-collapsed\"]);\n      $scope.isBurndownGraphCollapsed = $storage.get(hash) || false;\n      toggleGraph = function() {\n        if ($scope.isBurndownGraphCollapsed) {\n          hide(firstLoad);\n        } else {\n          show(firstLoad);\n        }\n        return firstLoad = false;\n      };\n      $scope.$watch(\"showGraphPlaceholder\", function() {\n        if ($scope.showGraphPlaceholder != null) {\n          $scope.isBurndownGraphCollapsed = $scope.isBurndownGraphCollapsed || $scope.showGraphPlaceholder;\n          return toggleGraph();\n        }\n      });\n      $el.on(\"click\", \".js-toggle-burndown-visibility-button\", function() {\n        $scope.isBurndownGraphCollapsed = !$scope.isBurndownGraphCollapsed;\n        $storage.set(hash, $scope.isBurndownGraphCollapsed);\n        return toggleGraph();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleBurndownVisibility\", [\"$tgStorage\", ToggleBurndownVisibility]);\n\n  BurndownBacklogGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var client_increment_line, colors, data, evolution_line, j, milestonesRange, optimal_line, options, ref1, results, team_increment_line, width, zero_line;\n      width = element.width();\n      element.height(width / 6);\n      milestonesRange = (function() {\n        results = [];\n        for (var j = 0, ref1 = dataToDraw.milestones.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; 0 <= ref1 ? j++ : j--){ results.push(j); }\n        return results;\n      }).apply(this);\n      data = [];\n      zero_line = _.map(dataToDraw.milestones, function(ml) {\n        return 0;\n      });\n      data.push({\n        data: _.zip(milestonesRange, zero_line),\n        lines: {\n          fillColor: \"rgba(0,0,0,0)\"\n        },\n        points: {\n          show: false\n        }\n      });\n      optimal_line = _.map(dataToDraw.milestones, function(ml) {\n        return ml.optimal;\n      });\n      data.push({\n        data: _.zip(milestonesRange, optimal_line),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      evolution_line = _.filter(_.map(dataToDraw.milestones, function(ml) {\n        return ml.evolution;\n      }), function(evolution) {\n        return evolution != null;\n      });\n      data.push({\n        data: _.zip(milestonesRange, evolution_line),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      client_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"] - ml[\"client-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, client_increment_line),\n        lines: {\n          fillColor: \"rgba(255,51,51,0.3)\"\n        }\n      });\n      team_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, team_increment_line),\n        lines: {\n          fillColor: \"rgba(153,51,51,0.3)\"\n        }\n      });\n      colors = [\"rgba(0,0,0,1)\", \"rgba(120,120,120,0.2)\", \"rgba(102,153,51,1)\", \"rgba(153,51,51,1)\", \"rgba(255,51,51,1)\"];\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: \"#ccc\",\n          hoverable: true\n        },\n        xaxis: {\n          ticks: dataToDraw.milestones.length,\n          axisLabel: $translate.instant(\"BACKLOG.CHART.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5,\n          tickFormatter: function(val, axis) {\n            return \"\";\n          }\n        },\n        yaxis: {\n          axisLabel: $translate.instant(\"BACKLOG.CHART.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: colors,\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var ctx;\n            if (flotItem.seriesIndex === 1) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.OPTIMAL\", ctx);\n            } else if (flotItem.seriesIndex === 2) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.REAL\", ctx);\n            } else if (flotItem.seriesIndex === 3) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_CLIENT\", ctx);\n            } else {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_TEAM\", ctx);\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch(\"stats\", function(value) {\n        if ($scope.stats != null) {\n          redrawChart(element, $scope.stats);\n          return $scope.$on(\"resize\", function() {\n            return redrawChart(element, $scope.stats);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBurndownBacklogGraph\", [\"$translate\", BurndownBacklogGraphDirective]);\n\n  TgBacklogProgressBarDirective = function($template, $compile) {\n    var adjustPercentaje, link, render, template;\n    template = $template.get(\"backlog/progress-bar.html\", true);\n    render = function(scope, el, projectPointsPercentaje, closedPointsPercentaje) {\n      var html;\n      html = template({\n        projectPointsPercentaje: projectPointsPercentaje,\n        closedPointsPercentaje: closedPointsPercentaje\n      });\n      html = $compile(html)(scope);\n      return el.html(html);\n    };\n    adjustPercentaje = function(percentage) {\n      var adjusted;\n      adjusted = _.max([0, percentage]);\n      adjusted = _.min([100, adjusted]);\n      return Math.round(adjusted);\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgBacklogProgressBar, function(stats) {\n        var closedPoints, closedPointsPercentaje, definedPoints, projectPointsPercentaje, totalPoints;\n        if (stats != null) {\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          definedPoints = stats.defined_points;\n          closedPoints = stats.closed_points;\n          if (definedPoints > totalPoints) {\n            projectPointsPercentaje = totalPoints * 100 / definedPoints;\n            closedPointsPercentaje = closedPoints * 100 / definedPoints;\n          } else {\n            projectPointsPercentaje = 100;\n            closedPointsPercentaje = closedPoints * 100 / totalPoints;\n          }\n          projectPointsPercentaje = adjustPercentaje(projectPointsPercentaje - 3);\n          closedPointsPercentaje = adjustPercentaje(closedPointsPercentaje - 3);\n          return render($scope, $el, projectPointsPercentaje, closedPointsPercentaje);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogProgressBar\", [\"$tgTemplate\", \"$compile\", TgBacklogProgressBarDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sortable.coffee\n */\n\n(function() {\n  var BacklogEmptySortableDirective, BacklogSortableDirective, SprintSortableDirective, bindOnce, deleteElement, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  deleteElement = function(el) {\n    el.scope().$destroy();\n    el.off();\n    return el.remove();\n  };\n\n  BacklogSortableDirective = function($repo, $rs, $rootscope, $tgConfirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var getUsIndex;\n      getUsIndex = (function(_this) {\n        return function(us) {\n          return $(us).index(\".backlog-table-body .row\");\n        };\n      })(this);\n      bindOnce($scope, \"project\", function(project) {\n        var filterError;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        filterError = function() {\n          var text;\n          text = $translate.instant(\"BACKLOG.SORTABLE_FILTER_ERROR\");\n          return $tgConfirm.notify(\"error\", text);\n        };\n        $el.sortable({\n          items: \".us-item-row\",\n          cancel: \".popover\",\n          connectWith: \".sprint\",\n          dropOnEmpty: true,\n          placeholder: \"row us-item-row us-item-drag sortable-placeholder\",\n          scroll: true,\n          disableHorizontalScroll: true,\n          tolerance: \"pointer\",\n          revert: false,\n          start: function() {\n            return $(document.body).addClass(\"drag-active\");\n          },\n          stop: function() {\n            $(document.body).removeClass(\"drag-active\");\n            if ($el.hasClass(\"active-filters\")) {\n              $el.sortable(\"cancel\");\n              return filterError();\n            }\n          }\n        });\n        $el.on(\"multiplesortreceive\", function(event, ui) {\n          var itemIndex, itemUs;\n          if ($el.hasClass(\"active-filters\")) {\n            ui.source.sortable(\"cancel\");\n            filterError();\n            return;\n          }\n          itemUs = ui.item.scope().us;\n          itemIndex = getUsIndex(ui.item);\n          deleteElement(ui.item);\n          $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, null);\n          return ui.item.find('a').removeClass('noclick');\n        });\n        $el.on(\"multiplesortstop\", function(event, ui) {\n          var index, items, us;\n          if ($(ui.items[0]).parent().length === 0) {\n            return;\n          }\n          if ($el.hasClass(\"active-filters\")) {\n            return;\n          }\n          items = _.sortBy(ui.items, function(item) {\n            return $(item).index();\n          });\n          index = _.min(_.map(items, function(item) {\n            return getUsIndex(item);\n          }));\n          us = _.map(items, function(item) {\n            var itemUs;\n            item = $(item);\n            itemUs = item.scope().us;\n            setTimeout(((function(_this) {\n              return function() {\n                return item.find('a').removeClass('noclick');\n              };\n            })(this)), 300);\n            return itemUs;\n          });\n          return $scope.$emit(\"sprint:us:move\", us, index, null);\n        });\n        return $el.on(\"sortstart\", function(event, ui) {\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BacklogEmptySortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          $el.sortable({\n            items: \".us-item-row\",\n            dropOnEmpty: true\n          });\n          return $el.on(\"sortreceive\", function(event, ui) {\n            var itemIndex, itemUs;\n            itemUs = ui.item.scope().us;\n            itemIndex = ui.item.index();\n            deleteElement(ui.item);\n            $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, null);\n            return ui.item.find('a').removeClass('noclick');\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  SprintSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          $el.sortable({\n            scroll: true,\n            dropOnEmpty: true,\n            items: \".sprint-table .milestone-us-item-row\",\n            disableHorizontalScroll: true,\n            connectWith: \".sprint,.backlog-table-body,.empty-backlog\",\n            placeholder: \"row us-item-row sortable-placeholder\",\n            forcePlaceholderSize: true\n          });\n          $el.on(\"multiplesortreceive\", function(event, ui) {\n            var index, items, us;\n            items = _.sortBy(ui.items, function(item) {\n              return $(item).index();\n            });\n            index = _.min(_.map(items, function(item) {\n              return $(item).index();\n            }));\n            us = _.map(items, function(item) {\n              var itemUs;\n              item = $(item);\n              itemUs = item.scope().us;\n              deleteElement(item);\n              return itemUs;\n            });\n            return $scope.$emit(\"sprint:us:move\", us, index, $scope.sprint.id);\n          });\n          $el.on(\"multiplesortstop\", function(event, ui) {\n            var itemIndex, itemUs;\n            if (ui.item.parent().length === 0) {\n              return;\n            }\n            itemUs = ui.item.scope().us;\n            itemIndex = ui.item.index();\n            setTimeout(((function(_this) {\n              return function() {\n                return ui.item.find('a').removeClass('noclick');\n              };\n            })(this)), 300);\n            return $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, $scope.sprint.id);\n          });\n          return $el.on(\"sortstart\", function(event, ui) {\n            return ui.item.find('a').addClass('noclick');\n          });\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgConfirm\", \"$translate\", BacklogSortableDirective]);\n\n  module.directive(\"tgBacklogEmptySortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", BacklogEmptySortableDirective]);\n\n  module.directive(\"tgSprintSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", SprintSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sprints.coffee\n */\n\n(function() {\n  var BacklogSprintDirective, BacklogSprintHeaderDirective, ToggleExcludeClosedSprintsVisualization, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogSprintDirective = function($repo, $rootscope) {\n    var link, slideOptions, sprintTableMinHeight, toggleSprint;\n    sprintTableMinHeight = 50;\n    slideOptions = {\n      duration: 500,\n      easing: 'linear'\n    };\n    toggleSprint = (function(_this) {\n      return function($el) {\n        var sprintArrow, sprintTable;\n        sprintTable = $el.find(\".sprint-table\");\n        sprintArrow = $el.find(\".icon-arrow-up\");\n        sprintArrow.toggleClass('active');\n        return sprintTable.toggleClass('open');\n      };\n    })(this);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch($attrs.tgBacklogSprint, function(sprint) {\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        if (sprint.closed) {\n          return $el.addClass(\"sprint-closed\");\n        } else {\n          return toggleSprint($el);\n        }\n      });\n      $el.on(\"click\", \".sprint-name > .icon-arrow-up\", function(event) {\n        event.preventDefault();\n        toggleSprint($el);\n        return $el.find(\".sprint-table\").slideToggle(slideOptions);\n      });\n      $el.on(\"click\", \".sprint-name > .icon-edit\", function(event) {\n        var sprint;\n        event.preventDefault();\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        return $rootscope.$broadcast(\"sprintform:edit\", sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSprint\", [\"$tgRepo\", \"$rootScope\", BacklogSprintDirective]);\n\n  BacklogSprintHeaderDirective = function($navUrls, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"backlog/sprint-header.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, isVisible, prettyDate, render;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_milestone\") !== -1;\n      };\n      isVisible = function() {\n        return $scope.project.my_permissions.indexOf(\"view_milestones\") !== -1;\n      };\n      render = function(sprint) {\n        var compiledTemplate, ctx, estimatedDateRange, finish, start, taskboardUrl, templateScope;\n        taskboardUrl = $navUrls.resolve(\"project-taskboard\", {\n          project: $scope.project.slug,\n          sprint: sprint.slug\n        });\n        start = moment(sprint.estimated_start).format(prettyDate);\n        finish = moment(sprint.estimated_finish).format(prettyDate);\n        estimatedDateRange = start + \"-\" + finish;\n        ctx = {\n          name: sprint.name,\n          taskboardUrl: taskboardUrl,\n          estimatedDateRange: estimatedDateRange,\n          closedPoints: sprint.closed_points || 0,\n          totalPoints: sprint.total_points || 0,\n          isVisible: isVisible(),\n          isEditable: isEditable()\n        };\n        templateScope = $scope.$new();\n        _.assign(templateScope, ctx);\n        compiledTemplate = $compile(template)(templateScope);\n        return $el.html(compiledTemplate);\n      };\n      $scope.$watch($attrs.ngModel, function(sprint) {\n        return render(sprint);\n      });\n      $scope.$on(\"sprintform:edit:success\", function() {\n        return render($model.$modelValue);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgBacklogSprintHeader\", [\"$tgNavUrls\", \"$tgTemplate\", \"$compile\", \"$translate\", BacklogSprintHeaderDirective]);\n\n  ToggleExcludeClosedSprintsVisualization = function($rootscope, $loading, $translate) {\n    var excludeClosedSprints, link;\n    excludeClosedSprints = true;\n    link = function($scope, $el, $attrs) {\n      var currentLoading, loadingElm;\n      loadingElm = $(\"<div>\");\n      $el.after(loadingElm);\n      currentLoading = null;\n      $el.on(\"click\", function(event) {\n        event.preventDefault();\n        excludeClosedSprints = !excludeClosedSprints;\n        currentLoading = $loading().target(loadingElm).start();\n        if (excludeClosedSprints) {\n          return $rootscope.$broadcast(\"backlog:unload-closed-sprints\");\n        } else {\n          return $rootscope.$broadcast(\"backlog:load-closed-sprints\");\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $scope.$on(\"closed-sprints:reloaded\", (function(_this) {\n        return function(ctx, sprints) {\n          var key, text;\n          currentLoading.finish();\n          if (sprints.length > 0) {\n            key = \"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS\";\n          } else {\n            key = \"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS\";\n          }\n          text = $translate.instant(key);\n          return $el.find(\".text\").text(text);\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogToggleClosedSprintsVisualization\", [\"$rootScope\", \"$tgLoading\", \"$translate\", ToggleExcludeClosedSprintsVisualization]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/charts.coffee\n */\n\n(function() {\n  var SprintGraphDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  SprintGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var data, days, options, width;\n      width = element.width();\n      element.height(240);\n      days = _.map(dataToDraw, function(x) {\n        return moment(x.day);\n      });\n      data = [];\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.optimal_points;\n        })),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.open_points;\n        })),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: '#ccc',\n          hoverable: true\n        },\n        xaxis: {\n          tickSize: [1, \"day\"],\n          min: days[0],\n          max: _.last(days),\n          mode: \"time\",\n          daysNames: days,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        yaxis: {\n          min: 0,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: [\"rgba(102,153,51,1)\", \"rgba(120,120,120,0.2)\"],\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var formattedDate, roundedValue;\n            formattedDate = moment(xval).format($translate.instant(\"TASKBOARD.CHARTS.DATE\"));\n            roundedValue = Math.round(yval);\n            if (flotItem.seriesIndex === 1) {\n              return $translate.instant(\"TASKBOARD.CHARTS.OPTIMAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            } else {\n              return $translate.instant(\"TASKBOARD.CHARTS.REAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$on(\"resize\", function() {\n        if ($scope.stats) {\n          return redrawChart(element, $scope.stats.days);\n        }\n      });\n      $scope.$on(\"taskboard:graph:toggle-visibility\", function() {\n        $el.parent().toggleClass('open');\n        return timeout(100, function() {\n          if ($scope.stats) {\n            return redrawChart(element, $scope.stats.days);\n          }\n        });\n      });\n      $scope.$watch('stats', function(value) {\n        if ($scope.stats == null) {\n          return;\n        }\n        return redrawChart(element, $scope.stats.days);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintGraph\", [\"$translate\", SprintGraphDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkTasksDirective, CreateEditTaskDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  CreateEditTaskDirective = function($repo, $model, $rs, $rootscope, $loading, lightboxService, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.isNew = true;\n      $scope.$on(\"taskform:new\", function(ctx, sprintId, usId) {\n        var create, newTask;\n        $scope.task = {\n          project: $scope.projectId,\n          milestone: sprintId,\n          user_story: usId,\n          is_archived: false,\n          status: $scope.project.default_task_status,\n          assigned_to: null,\n          tags: []\n        };\n        $scope.isNew = true;\n        create = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").html(create);\n        newTask = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.TITLE\");\n        $el.find(\".title\").html(newTask + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"taskform:edit\", function(ctx, task) {\n        var edit, save;\n        $scope.task = task;\n        $scope.isNew = false;\n        save = $translate.instant(\"COMMON.SAVE\");\n        edit = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT\");\n        $el.find(\".button-green\").html(save);\n        $el.find(\".title\").html(edit + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      submitButton = $el.find(\".submit-button\");\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.isNew) {\n            promise = $repo.create(\"tasks\", $scope.task);\n            broadcastEvent = \"taskform:new:success\";\n          } else {\n            promise = $repo.save($scope.task);\n            broadcastEvent = \"taskform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          return promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootscope.$broadcast(broadcastEvent, data);\n          });\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CreateBulkTasksDirective = function($repo, $rs, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.form = {\n        data: \"\",\n        usId: null\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise, sprintId, usId;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope.form.data;\n          projectId = $scope.projectId;\n          sprintId = $scope.form.sprintId;\n          usId = $scope.form.usId;\n          promise = $rs.tasks.bulkCreate(projectId, sprintId, usId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"taskform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n      $scope.$on(\"taskform:bulk\", function(ctx, sprintId, usId) {\n        lightboxService.open($el);\n        return $scope.form = {\n          data: \"\",\n          sprintId: sprintId,\n          usId: usId\n        };\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaTaskboard\");\n\n  module.directive(\"tgLbCreateEditTask\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$translate\", CreateEditTaskDirective]);\n\n  module.directive(\"tgLbCreateBulkTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkTasksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var TaskboardController, TaskboardDirective, TaskboardSquishColumnDirective, TaskboardTaskDirective, TaskboardUserDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  toggleText = this.taiga.toggleText;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  TaskboardController = (function(superClass) {\n    extend(TaskboardController, superClass);\n\n    TaskboardController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"tgAppMetaService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskboardController(scope, rootscope, repo, confirm, rs1, params1, q, appMetaService, location, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.appMetaService = appMetaService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"TASKBOARD.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskboardController.prototype._setMeta = function() {\n      var description, prettyDate, title;\n      prettyDate = this.translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      title = this.translate.instant(\"TASKBOARD.PAGE_TITLE\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name\n      });\n      description = this.translate.instant(\"TASKBOARD.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name,\n        startDate: moment(this.scope.sprint.estimated_start).format(prettyDate),\n        endDate: moment(this.scope.sprint.estimated_finish).format(prettyDate),\n        completedPercentage: this.scope.stats.completedPercentage || \"0\",\n        completedPoints: this.scope.stats.completedPointsSum || \"--\",\n        totalPoints: this.scope.stats.totalPointsSum || \"--\",\n        openTasks: this.scope.stats.openTasks || \"--\",\n        totalTasks: this.scope.stats.total_tasks || \"--\"\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskboardController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"taskform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"bulk create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:new:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      this.scope.$on(\"taskboard:task:move\", this.taskMove);\n      return this.scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, task) {\n          var promise;\n          task.assigned_to = userId;\n          promise = _this.repo.save(task);\n          return promise.then(null, function() {\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.initializeSubscription = function() {\n      var routingKey, routingKey1;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".tasks\";\n      this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.refreshTagsColors();\n          _this.loadSprintStats();\n          return _this.loadSprint();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadProject = function() {\n      return this.rs.projects.get(this.scope.projectId).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(e) {\n            return e.id;\n          });\n          _this.scope.roleById = groupBy(project.roles, function(e) {\n            return e.id;\n          });\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(e) {\n            return e.id;\n          });\n          _this.scope.$emit('project:loaded', project);\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return project;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprintStats = function() {\n      return this.rs.sprints.stats(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(stats) {\n          var completedPointsSum, remainingPointsSum, remainingTasks, totalPointsSum;\n          totalPointsSum = _.reduce(_.values(stats.total_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          completedPointsSum = _.reduce(_.values(stats.completed_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          remainingPointsSum = totalPointsSum - completedPointsSum;\n          remainingTasks = stats.total_tasks - stats.completed_tasks;\n          _this.scope.stats = stats;\n          _this.scope.stats.totalPointsSum = totalPointsSum;\n          _this.scope.stats.completedPointsSum = completedPointsSum;\n          _this.scope.stats.remainingPointsSum = remainingPointsSum;\n          _this.scope.stats.remainingTasks = remainingTasks;\n          if (stats.totalPointsSum) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.completedPointsSum / stats.totalPointsSum);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.stats.openTasks = stats.total_tasks - stats.completed_tasks;\n          return stats;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprint = function() {\n      return this.rs.sprints.get(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(sprint) {\n          _this.scope.sprint = sprint;\n          _this.scope.userstories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          return sprint;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(tasks) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, task, us, usId;\n          _this.scope.tasks = _.sortBy(tasks, 'taskboard_order');\n          _this.scope.usTasks = {};\n          ref = _.union(_this.scope.userstories, [\n            {\n              id: null\n            }\n          ]);\n          for (i = 0, len = ref.length; i < len; i++) {\n            us = ref[i];\n            _this.scope.usTasks[us.id] = {};\n            ref1 = _this.scope.taskStatusList;\n            for (j = 0, len1 = ref1.length; j < len1; j++) {\n              status = ref1[j];\n              _this.scope.usTasks[us.id][status.id] = [];\n            }\n          }\n          ref2 = _this.scope.tasks;\n          for (k = 0, len2 = ref2.length; k < len2; k++) {\n            task = ref2[k];\n            if ((_this.scope.usTasks[task.user_story] != null) && (_this.scope.usTasks[task.user_story][task.status] != null)) {\n              _this.scope.usTasks[task.user_story][task.status].push(task);\n            }\n          }\n          if (tasks.length === 0) {\n            if (_this.scope.userstories.length > 0) {\n              usId = _this.scope.userstories[0].id;\n            } else {\n              usId = null;\n            }\n            _this.scope.usTasks[usId][_this.scope.taskStatusList[0].id].push({\n              isPlaceholder: true\n            });\n          }\n          return tasks;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTaskboard = function() {\n      return this.q.all([\n        this.refreshTagsColors(), this.loadSprintStats(), this.loadSprint().then((function(_this) {\n          return function() {\n            return _this.loadTasks();\n          };\n        })(this))\n      ]);\n    };\n\n    TaskboardController.prototype.loadInitialData = function() {\n      var params, promise;\n      params = {\n        pslug: this.params.pslug,\n        sslug: this.params.sslug\n      };\n      promise = this.repo.resolve(params).then((function(_this) {\n        return function(data) {\n          _this.scope.projectId = data.project;\n          _this.scope.sprintId = data.milestone;\n          _this.initializeSubscription();\n          return data;\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTasksOrder = function(tasks) {\n      var data, items;\n      items = this.resortTasks(tasks);\n      data = this.prepareBulkUpdateData(items);\n      return this.rs.tasks.bulkUpdateTaskTaskboardOrder(this.scope.project.id, data);\n    };\n\n    TaskboardController.prototype.resortTasks = function(tasks) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = tasks.length; i < len; index = ++i) {\n        item = tasks[index];\n        item[\"taskboard_order\"] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    TaskboardController.prototype.prepareBulkUpdateData = function(uses) {\n      return _.map(uses, function(x) {\n        return {\n          \"task_id\": x.id,\n          \"order\": x[\"taskboard_order\"]\n        };\n      });\n    };\n\n    TaskboardController.prototype.taskMove = function(ctx, task, usId, statusId, order) {\n      var promise, r, tasks;\n      r = this.scope.usTasks[task.user_story][task.status].indexOf(task);\n      this.scope.usTasks[task.user_story][task.status].splice(r, 1);\n      tasks = this.scope.usTasks[usId][statusId];\n      tasks.splice(order, 0, task);\n      task.user_story = usId;\n      task.status = statusId;\n      task.taskboard_order = order;\n      promise = this.repo.save(task);\n      this.rootscope.$broadcast(\"sprint:task:moved\", task);\n      promise.then((function(_this) {\n        return function() {\n          _this.refreshTasksOrder(tasks);\n          return _this.loadSprintStats();\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function() {\n          return console.log(\"FAIL TASK SAVE\");\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.addNewTask = function(type, us) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"taskform:new\", this.scope.sprintId, us != null ? us.id : void 0);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"taskform:bulk\", this.scope.sprintId, us != null ? us.id : void 0);\n      }\n    };\n\n    TaskboardController.prototype.editTaskAssignedTo = function(task) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", task);\n    };\n\n    return TaskboardController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskboardController\", TaskboardController);\n\n  TaskboardDirective = function($rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, tableBodyDom;\n      $ctrl = $el.controller();\n      $el.on(\"click\", \".toggle-analytics-visibility\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass('active');\n        return $rootscope.$broadcast(\"taskboard:graph:toggle-visibility\");\n      });\n      tableBodyDom = $el.find(\".taskboard-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".taskboard-table-header .taskboard-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboard\", [\"$rootScope\", TaskboardDirective]);\n\n  TaskboardTaskDirective = function($rootscope, $loading, $rs) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $el.disableSelection();\n      $scope.$watch(\"task\", function(task) {\n        if (task.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!task.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      return $el.find(\".icon-edit\").on(\"click\", function(event) {\n        if ($el.find('.icon-edit').hasClass('noclick')) {\n          return;\n        }\n        return $scope.$apply(function() {\n          var currentLoading, target, task;\n          target = $(event.target);\n          currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n          task = $scope.task;\n          return $rs.tasks.getByRef(task.project, task.ref).then((function(_this) {\n            return function(editingTask) {\n              $rootscope.$broadcast(\"taskform:edit\", editingTask);\n              return currentLoading.finish();\n            };\n          })(this));\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardTask\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", TaskboardTaskDirective]);\n\n  TaskboardSquishColumnDirective = function(rs) {\n    var avatarWidth, link, maxColumnWidth;\n    avatarWidth = 40;\n    maxColumnWidth = 300;\n    link = function($scope, $el, $attrs) {\n      var getCeilWidth, recalculateStatusColumnWidth, recalculateTaskboardWidth, refreshTaskboardTableWidth, setStatusColumnWidth;\n      $scope.$on(\"sprint:task:moved\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      bindOnce($scope, \"usTasks\", function(project) {\n        $scope.statusesFolded = rs.tasks.getStatusColumnModes($scope.project.id);\n        $scope.usFolded = rs.tasks.getUsRowModes($scope.project.id, $scope.sprintId);\n        return recalculateTaskboardWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.statusesFolded[status.id] = !!!$scope.statusesFolded[status.id];\n        rs.tasks.storeStatusColumnModes($scope.projectId, $scope.statusesFolded);\n        return recalculateTaskboardWidth();\n      };\n      $scope.foldUs = function(us) {\n        if (!us) {\n          $scope.usFolded[null] = !!!$scope.usFolded[null];\n        } else {\n          $scope.usFolded[us.id] = !!!$scope.usFolded[us.id];\n        }\n        rs.tasks.storeUsRowModes($scope.projectId, $scope.sprintId, $scope.usFolded);\n        return recalculateTaskboardWidth();\n      };\n      getCeilWidth = (function(_this) {\n        return function(usId, statusId) {\n          var tasks, tasksMatrixSize, width;\n          tasks = $scope.usTasks[usId][statusId].length;\n          if ($scope.statusesFolded[statusId]) {\n            if (tasks && $scope.usFolded[usId]) {\n              tasksMatrixSize = Math.round(Math.sqrt(tasks));\n              width = avatarWidth * tasksMatrixSize;\n            } else {\n              width = avatarWidth;\n            }\n            return width;\n          }\n          return 0;\n        };\n      })(this);\n      setStatusColumnWidth = (function(_this) {\n        return function(statusId, width) {\n          var column;\n          column = $el.find(\".squish-status-\" + statusId);\n          if (width) {\n            return column.css('max-width', width);\n          } else {\n            return column.css(\"max-width\", maxColumnWidth);\n          }\n        };\n      })(this);\n      refreshTaskboardTableWidth = (function(_this) {\n        return function() {\n          var columnWidths, columns, totalWidth;\n          columnWidths = [];\n          columns = $el.find(\".task-colum-name\");\n          columnWidths = _.map(columns, function(column) {\n            return $(column).outerWidth(true);\n          });\n          totalWidth = _.reduce(columnWidths, function(total, width) {\n            return total + width;\n          });\n          return $el.find('.taskboard-table-inner').css(\"width\", totalWidth);\n        };\n      })(this);\n      recalculateStatusColumnWidth = (function(_this) {\n        return function(statusId) {\n          var statusFoldedWidth;\n          statusFoldedWidth = getCeilWidth(null, statusId);\n          _.forEach($scope.userstories, function(us) {\n            var width;\n            width = getCeilWidth(us.id, statusId);\n            if (width > statusFoldedWidth) {\n              return statusFoldedWidth = width;\n            }\n          });\n          return setStatusColumnWidth(statusId, statusFoldedWidth);\n        };\n      })(this);\n      return recalculateTaskboardWidth = (function(_this) {\n        return function() {\n          _.forEach($scope.taskStatusList, function(status) {\n            return recalculateStatusColumnWidth(status.id);\n          });\n          refreshTaskboardTableWidth();\n        };\n      })(this);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSquishColumn\", [\"$tgResources\", TaskboardSquishColumnDirective]);\n\n  TaskboardUserDirective = function($log) {\n    var clickable, link;\n    clickable = false;\n    link = function($scope, $el, $attrs) {\n      var username_label;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      $scope.$watch('task.assigned_to', function(assigned_to) {\n        var user;\n        user = $scope.usersById[assigned_to];\n        if (user === void 0) {\n          _.assign($scope, {\n            name: \"Unassigned\",\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          });\n        } else {\n          _.assign($scope, {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          });\n        }\n        return username_label.text($scope.name);\n      });\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") > -1) {\n          clickable = true;\n          $el.find(\".avatar-assigned-to\").on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl;\n              if ($el.find('a').hasClass('noclick')) {\n                return;\n              }\n              $ctrl = $el.controller();\n              return $ctrl.editTaskAssignedTo($scope.task);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl;\n            if ($el.find('a').hasClass('noclick')) {\n              return;\n            }\n            $ctrl = $el.controller();\n            return $ctrl.editTaskAssignedTo($scope.task);\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"taskboard/taskboard-user.html\",\n      scope: {\n        \"usersById\": \"=users\",\n        \"project\": \"=\",\n        \"task\": \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgTaskboardUserAvatar\", [\"$log\", TaskboardUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/sortable.coffee\n */\n\n(function() {\n  var TaskboardSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  TaskboardSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var deleteElement, itemEl, newParentScope, oldParentScope, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        tdom.sortable({\n          handle: \".taskboard-task-inner\",\n          dropOnEmpty: true,\n          connectWith: \".taskboard-tasks-box\",\n          revert: 400\n        });\n        tdom.on(\"sortstop\", function(event, ui) {\n          var itemIndex, itemTask, newStatusId, newUsId, oldStatusId, oldUsId, parentEl;\n          parentEl = ui.item.parent();\n          itemEl = ui.item;\n          itemTask = itemEl.scope().task;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          oldUsId = oldParentScope.us ? oldParentScope.us.id : null;\n          oldStatusId = oldParentScope.st.id;\n          newUsId = newParentScope.us ? newParentScope.us.id : null;\n          newStatusId = newParentScope.st.id;\n          if (newStatusId !== oldStatusId || newUsId !== oldUsId) {\n            deleteElement(itemEl);\n          }\n          $scope.$apply(function() {\n            return $rootscope.$broadcast(\"taskboard:task:move\", itemTask, newUsId, newStatusId, itemIndex);\n          });\n          return ui.item.find('a').removeClass('noclick');\n        });\n        return tdom.on(\"sortstart\", function(event, ui) {\n          oldParentScope = ui.item.parent().scope();\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", TaskboardSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/main.coffee\n */\n\n(function() {\n  var KanbanArchivedStatusHeaderDirective, KanbanArchivedStatusIntroDirective, KanbanController, KanbanDirective, KanbanSquishColumnDirective, KanbanUserDirective, KanbanUserstoryDirective, KanbanWipLimitDirective, bindMethods, bindOnce, defaultViewMode, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText, viewModes,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaKanban\");\n\n  defaultViewMode = \"maximized\";\n\n  viewModes = [\"maximized\", \"minimized\"];\n\n  KanbanController = (function(superClass) {\n    extend(KanbanController, superClass);\n\n    KanbanController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function KanbanController(scope, rootscope, repo, confirm, rs1, params1, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"KANBAN.SECTION_NAME\");\n      this.scope.statusViewModes = {};\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"KANBAN.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"KANBAN.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    KanbanController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.refreshTagsColors();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.refreshTagsColors();\n        };\n      })(this));\n      this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n      this.scope.$on(\"kanban:us:move\", this.moveUs);\n      this.scope.$on(\"kanban:show-userstories-for-status\", this.loadUserStoriesForStatus);\n      return this.scope.$on(\"kanban:hide-userstories-for-status\", this.hideUserStoriesForStatus);\n    };\n\n    KanbanController.prototype.addNewUs = function(type, statusId) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, statusId, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, statusId);\n      }\n    };\n\n    KanbanController.prototype.changeUsAssignedTo = function(us) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", us);\n    };\n\n    KanbanController.prototype.onAssignedToChanged = function(ctx, userid, us) {\n      var promise;\n      us.assigned_to = userid;\n      promise = this.repo.save(us);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    KanbanController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadUserstories = function() {\n      var params, promise;\n      params = {\n        status__is_archived: false\n      };\n      promise = this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, us, usByStatus, us_archived;\n          _this.scope.userstories = userstories;\n          usByStatus = _.groupBy(userstories, \"status\");\n          us_archived = [];\n          ref = _this.scope.usStatusList;\n          for (i = 0, len = ref.length; i < len; i++) {\n            status = ref[i];\n            if (usByStatus[status.id] == null) {\n              usByStatus[status.id] = [];\n            }\n            if (_this.scope.usByStatus != null) {\n              ref1 = _this.scope.usByStatus[status.id];\n              for (j = 0, len1 = ref1.length; j < len1; j++) {\n                us = ref1[j];\n                if (us.status !== status.id) {\n                  us_archived.push(us);\n                }\n              }\n            }\n            if (status.is_archived && (_this.scope.usByStatus != null) && _this.scope.usByStatus[status.id].length !== 0) {\n              ref2 = _this.scope.usByStatus[status.id].concat(us_archived);\n              for (k = 0, len2 = ref2.length; k < len2; k++) {\n                us = ref2[k];\n                if (us.status === status.id) {\n                  usByStatus[status.id].push(us);\n                }\n              }\n            }\n            usByStatus[status.id] = _.sortBy(usByStatus[status.id], \"kanban_order\");\n          }\n          if (userstories.length === 0) {\n            status = _this.scope.usStatusList[0];\n            usByStatus[status.id].push({\n              isPlaceholder: true\n            });\n          }\n          _this.scope.usByStatus = usByStatus;\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\", userstories);\n          });\n          return userstories;\n        };\n      })(this));\n      promise.then((function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    KanbanController.prototype.loadUserStoriesForStatus = function(ctx, statusId) {\n      var params;\n      params = {\n        status: statusId\n      };\n      return this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.scope.usByStatus[statusId] = _.sortBy(userstories, \"kanban_order\");\n          _this.scope.$broadcast(\"kanban:shown-userstories-for-status\", statusId, userstories);\n          return userstories;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.hideUserStoriesForStatus = function(ctx, statusId) {\n      this.scope.usByStatus[statusId] = [];\n      return this.scope.$broadcast(\"kanban:hidden-userstories-for-status\", statusId);\n    };\n\n    KanbanController.prototype.loadKanban = function() {\n      return this.q.all([this.refreshTagsColors(), this.loadUserstories()]);\n    };\n\n    KanbanController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_kanban_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.projectId = project.id;\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.generateStatusViewModes();\n          _this.scope.$emit(\"project:loaded\", project);\n          return project;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeSubscription = function() {\n      var routingKey1;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          return _this.loadKanban();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.generateStatusViewModes = function() {\n      var i, len, mode, ref, status, storedStatusViewModes;\n      storedStatusViewModes = this.rs.kanban.getStatusViewModes(this.scope.projectId);\n      this.scope.statusViewModes = {};\n      ref = this.scope.usStatusList;\n      for (i = 0, len = ref.length; i < len; i++) {\n        status = ref[i];\n        mode = storedStatusViewModes[status.id] || defaultViewMode;\n        this.scope.statusViewModes[status.id] = mode;\n      }\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.storeStatusViewModes = function() {\n      return this.rs.kanban.storeStatusViewModes(this.scope.projectId, this.scope.statusViewModes);\n    };\n\n    KanbanController.prototype.updateStatusViewMode = function(statusId, newViewMode) {\n      this.scope.statusViewModes[statusId] = newViewMode;\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.isMaximized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'maximized';\n    };\n\n    KanbanController.prototype.isMinimized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'minimized';\n    };\n\n    KanbanController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"kanban_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    KanbanController.prototype.resortUserStories = function(uses) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = uses.length; i < len; index = ++i) {\n        item = uses[index];\n        item.kanban_order = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    KanbanController.prototype.moveUs = function(ctx, us, oldStatusId, newStatusId, index) {\n      var itemsToSave, promise, r;\n      if (oldStatusId !== newStatusId) {\n        r = this.scope.usByStatus[oldStatusId].indexOf(us);\n        this.scope.usByStatus[oldStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n        us.status = newStatusId;\n      } else {\n        r = this.scope.usByStatus[newStatusId].indexOf(us);\n        this.scope.usByStatus[newStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n      }\n      itemsToSave = this.resortUserStories(this.scope.usByStatus[newStatusId]);\n      this.scope.usByStatus[newStatusId] = _.sortBy(this.scope.usByStatus[newStatusId], \"kanban_order\");\n      promise = this.repo.save(us);\n      promise = promise.then((function(_this) {\n        return function() {\n          var data;\n          itemsToSave = _.reject(itemsToSave, {\n            \"id\": us.id\n          });\n          data = _this.prepareBulkUpdateData(itemsToSave);\n          return _this.rs.userstories.bulkUpdateKanbanOrder(us.project, data).then(function() {\n            return itemsToSave;\n          });\n        };\n      })(this));\n      return promise;\n    };\n\n    return KanbanController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"KanbanController\", KanbanController);\n\n  KanbanDirective = function($repo, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var tableBodyDom;\n      tableBodyDom = $el.find(\".kanban-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".kanban-table-header .kanban-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanban\", [\"$tgRepo\", \"$rootScope\", KanbanDirective]);\n\n  KanbanArchivedStatusHeaderDirective = function($rootscope, $translate) {\n    var hideArchivedText, link, showArchivedText;\n    showArchivedText = $translate.instant(\"KANBAN.ACTION_SHOW_ARCHIVED\");\n    hideArchivedText = $translate.instant(\"KANBAN.ACTION_HIDE_ARCHIVED\");\n    link = function($scope, $el, $attrs) {\n      var hidden, status;\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusHeader);\n      hidden = true;\n      $scope[\"class\"] = \"icon-open-eye\";\n      $scope.title = showArchivedText;\n      $el.on(\"click\", function(event) {\n        hidden = !hidden;\n        return $scope.$apply(function() {\n          if (hidden) {\n            $scope[\"class\"] = \"icon-open-eye\";\n            $scope.title = showArchivedText;\n            return $rootscope.$broadcast(\"kanban:hide-userstories-for-status\", status.id);\n          } else {\n            $scope[\"class\"] = \"icon-closed-eye\";\n            $scope.title = hideArchivedText;\n            return $rootscope.$broadcast(\"kanban:show-userstories-for-status\", status.id);\n          }\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusHeader\", [\"$rootScope\", \"$translate\", KanbanArchivedStatusHeaderDirective]);\n\n  KanbanArchivedStatusIntroDirective = function($translate) {\n    var link, userStories;\n    userStories = [];\n    link = function($scope, $el, $attrs) {\n      var hiddenUserStoriexText, status, updateIntroText;\n      hiddenUserStoriexText = $translate.instant(\"KANBAN.HIDDEN_USER_STORIES\");\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusIntro);\n      $el.text(hiddenUserStoriexText);\n      updateIntroText = function() {\n        if (userStories.length > 0) {\n          return $el.text(\"\");\n        } else {\n          return $el.text(hiddenUserStoriexText);\n        }\n      };\n      $scope.$on(\"kanban:us:move\", function(ctx, itemUs, oldStatusId, newStatusId, itemIndex) {\n        var r;\n        if (status.id === newStatusId) {\n          if (status.id === oldStatusId) {\n            r = userStories.indexOf(itemUs);\n            userStories.splice(r, 1);\n            userStories.splice(itemIndex, 0, itemUs);\n          } else {\n            itemUs.isArchived = true;\n            userStories.splice(itemIndex, 0, itemUs);\n          }\n        } else if (status.id === oldStatusId) {\n          itemUs.isArchived = false;\n          r = userStories.indexOf(itemUs);\n          userStories.splice(r, 1);\n        }\n        return updateIntroText();\n      });\n      $scope.$on(\"kanban:shown-userstories-for-status\", function(ctx, statusId, userStoriesLoaded) {\n        if (statusId === status.id) {\n          userStories = _.filter(userStoriesLoaded, function(us) {\n            return us.status === status.id;\n          });\n          return updateIntroText();\n        }\n      });\n      $scope.$on(\"kanban:hidden-userstories-for-status\", function(ctx, statusId) {\n        if (statusId === status.id) {\n          userStories = [];\n          return updateIntroText();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusIntro\", [\"$translate\", KanbanArchivedStatusIntroDirective]);\n\n  KanbanUserstoryDirective = function($rootscope, $loading, $rs) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $el.disableSelection();\n      $scope.$watch(\"us\", function(us) {\n        if (us.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!us.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      $el.on('click', '.icon-edit', function(event) {\n        var currentLoading, target, us;\n        if ($el.find(\".icon-edit\").hasClass(\"noclick\")) {\n          return;\n        }\n        target = $(event.target);\n        currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n        us = $model.$modelValue;\n        return $rs.userstories.getByRef(us.project, us.ref).then((function(_this) {\n          return function(editingUserStory) {\n            $rootscope.$broadcast(\"usform:edit\", editingUserStory);\n            return currentLoading.finish();\n          };\n        })(this));\n      });\n      $scope.getTemplateUrl = function() {\n        if ($scope.us.isPlaceholder) {\n          return \"common/components/kanban-placeholder.html\";\n        } else {\n          return \"kanban/kanban-task.html\";\n        }\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      template: '<ng-include src=\"getTemplateUrl()\"/>',\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserstory\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", KanbanUserstoryDirective]);\n\n  KanbanSquishColumnDirective = function(rs) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var updateTableWidth;\n      $scope.$on(\"project:loaded\", function(event, project) {\n        $scope.folds = rs.kanban.getStatusColumnModes(project.id);\n        return updateTableWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.folds[status.id] = !!!$scope.folds[status.id];\n        rs.kanban.storeStatusColumnModes($scope.projectId, $scope.folds);\n        updateTableWidth();\n      };\n      return updateTableWidth = function() {\n        var columnWidths, totalWidth;\n        columnWidths = _.map($scope.usStatusList, function(status) {\n          if ($scope.folds[status.id]) {\n            return 40;\n          } else {\n            return 310;\n          }\n        });\n        totalWidth = _.reduce(columnWidths, function(total, width) {\n          return total + width;\n        });\n        return $el.find('.kanban-table-inner').css(\"width\", totalWidth);\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSquishColumn\", [\"$tgResources\", KanbanSquishColumnDirective]);\n\n  KanbanWipLimitDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var redrawWipLimit, status;\n      $el.disableSelection();\n      status = $scope.$eval($attrs.tgKanbanWipLimit);\n      redrawWipLimit = (function(_this) {\n        return function() {\n          $el.find(\".kanban-wip-limit\").remove();\n          return timeout(200, function() {\n            var element;\n            element = $el.find(\".kanban-task\")[status.wip_limit];\n            if (element) {\n              return angular.element(element).before(\"<div class='kanban-wip-limit'></div>\");\n            }\n          });\n        };\n      })(this);\n      if (status && !status.is_archived) {\n        $scope.$on(\"redraw:wip\", redrawWipLimit);\n        $scope.$on(\"kanban:us:move\", redrawWipLimit);\n        $scope.$on(\"usform:new:success\", redrawWipLimit);\n        $scope.$on(\"usform:bulk:success\", redrawWipLimit);\n      }\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanWipLimit\", KanbanWipLimitDirective);\n\n  KanbanUserDirective = function($log, $compile) {\n    var clickable, link, template;\n    template = _.template(\"<figure class=\\\"avatar\\\">\\n    <a href=\\\"#\\\" title=\\\"{{'US.ASSIGN' | translate}}\\\" <% if (!clickable) {%>class=\\\"not-clickable\\\"<% } %>>\\n        <img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\" class=\\\"avatar\\\">\\n    </a>\\n</figure>\");\n    clickable = false;\n    link = function($scope, $el, $attrs, $model) {\n      var render, username_label, wtid;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      if (!$attrs.tgKanbanUserAvatar) {\n        return $log.error(\"KanbanUserDirective: no attr is defined\");\n      }\n      wtid = $scope.$watch($attrs.tgKanbanUserAvatar, function(v) {\n        var user;\n        if ($scope.usersById == null) {\n          $log.error(\"KanbanUserDirective requires userById set in scope.\");\n          return wtid();\n        } else {\n          user = $scope.usersById[v];\n          return render(user);\n        }\n      });\n      render = function(user) {\n        var ctx, html;\n        if (user === void 0) {\n          ctx = {\n            name: \"Unassigned\",\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          };\n        } else {\n          ctx = {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          };\n        }\n        html = $compile(template(ctx))($scope);\n        $el.html(html);\n        return username_label.text(ctx.name);\n      };\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          clickable = true;\n          $el.on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl, us;\n              if ($el.find(\"a\").hasClass(\"noclick\")) {\n                return;\n              }\n              us = $model.$modelValue;\n              $ctrl = $el.controller();\n              return $ctrl.changeUsAssignedTo(us);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl, us;\n            if ($el.find(\"a\").hasClass(\"noclick\")) {\n              return;\n            }\n            us = $model.$modelValue;\n            $ctrl = $el.controller();\n            return $ctrl.changeUsAssignedTo(us);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserAvatar\", [\"$log\", \"$compile\", KanbanUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/sortable.coffee\n */\n\n(function() {\n  var KanbanSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var deleteElement, itemEl, newParentScope, oldParentScope, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        tdom.sortable({\n          handle: \".kanban-task-inner\",\n          dropOnEmpty: true,\n          connectWith: \".kanban-uses-box\",\n          revert: 400\n        });\n        tdom.on(\"sortstop\", function(event, ui) {\n          var itemIndex, itemUs, newStatusId, oldStatusId, parentEl;\n          parentEl = ui.item.parent();\n          itemEl = ui.item;\n          itemUs = itemEl.scope().us;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          newStatusId = newParentScope.s.id;\n          oldStatusId = oldParentScope.s.id;\n          if (newStatusId !== oldStatusId) {\n            deleteElement(itemEl);\n          }\n          $scope.$apply(function() {\n            return $rootscope.$broadcast(\"kanban:us:move\", itemUs, itemUs.status, newStatusId, itemIndex);\n          });\n          return ui.item.find('a').removeClass('noclick');\n        });\n        return tdom.on(\"sortstart\", function(event, ui) {\n          oldParentScope = ui.item.parent().scope();\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", KanbanSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/detail.coffee\n */\n\n(function() {\n  var IssueDetailController, IssuePriorityButtonDirective, IssueSeverityButtonDirective, IssueStatusButtonDirective, IssueStatusDisplayDirective, IssueTriggerButtonDirective, IssueTypeButtonDirective, PromoteIssueToUsButtonDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssueDetailController = (function(superClass) {\n    extend(IssueDetailController, superClass);\n\n    IssueDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\"];\n\n    function IssueDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, analytics, navUrls, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.issueRef = this.params.issueref;\n      this.scope.sectionName = this.translate.instant(\"ISSUES.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    IssueDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, ref3, ref4, title;\n      title = this.translate.instant(\"ISSUE.PAGE_TITLE\", {\n        issueRef: \"#\" + this.scope.issue.ref,\n        issueSubject: this.scope.issue.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"ISSUE.PAGE_DESCRIPTION\", {\n        issueStatus: ((ref = this.scope.statusById[this.scope.issue.status]) != null ? ref.name : void 0) || \"--\",\n        issueType: ((ref1 = this.scope.typeById[this.scope.issue.type]) != null ? ref1.name : void 0) || \"--\",\n        issueSeverity: ((ref2 = this.scope.severityById[this.scope.issue.severity]) != null ? ref2.name : void 0) || \"--\",\n        issueTrigger: ((ref3 = this.scope.triggerById[this.scope.issue.trigger]) != null ? ref3.name : void 0) || \"--\",\n        issuePriority: ((ref4 = this.scope.priorityById[this.scope.issue.priority]) != null ? ref4.name : void 0) || \"--\",\n        issueDescription: angular.element(this.scope.issue.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    IssueDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on issue\", 1);\n        };\n      })(this));\n      this.scope.$on(\"promote-issue-to-us:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"promoteToUserstory\", \"promote issue to userstory\", 1);\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.loadIssue();\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadIssue();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      if (this.scope.project.is_issues_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-issues\", ctx);\n      } else {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      }\n    };\n\n    IssueDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.issue_statuses;\n          _this.scope.statusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.typeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          _this.scope.typeList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.severityList = project.severities;\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerList = project.triggers;\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = project.priorities;\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadIssue = function() {\n      return this.rs.issues.getByRef(this.scope.projectId, this.params.issueref).then((function(_this) {\n        return function(issue) {\n          var ctx, ref, ref1;\n          _this.scope.issue = issue;\n          _this.scope.issueId = issue.id;\n          _this.scope.commentModel = issue;\n          if (((ref = _this.scope.issue.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.issue.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadIssue();\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    IssueDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.upvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.downvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    IssueDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.watch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.unwatch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    return IssueDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"IssueDetailController\", IssueDetailController);\n\n  IssueStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issue) {\n        var html, status;\n        status = $scope.statusById[issue.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue != null) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusDisplay\", [\"$tgTemplate\", \"$compile\", IssueStatusDisplayDirective]);\n\n  IssueStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issues-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, status;\n          status = $scope.statusById[issue.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(statusId) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.status = statusId;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $confirm.notify(\"success\");\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".status-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueStatusButtonDirective]);\n\n  IssueTypeButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-type-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, type;\n          type = $scope.typeById[issue.type];\n          html = template({\n            type: type,\n            typees: $scope.typeList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(type) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.type = type;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $confirm.notify(\"success\");\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".type-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-type\").popover().open();\n      });\n      $el.on(\"click\", \".type\", function(event) {\n        var target, type;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        type = target.data(\"type-id\");\n        return save(type);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTypeButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueTypeButtonDirective]);\n\n  IssueSeverityButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-severity-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, severity;\n          severity = $scope.severityById[issue.severity];\n          html = template({\n            severity: severity,\n            severityes: $scope.severityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(severity) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.severity = severity;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $confirm.notify(\"success\");\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".severity-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-severity\").popover().open();\n      });\n      $el.on(\"click\", \".severity\", function(event) {\n        var severity, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        severity = target.data(\"severity-id\");\n        return save(severity);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueSeverityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueSeverityButtonDirective]);\n\n  IssueTriggerButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-trigger-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, trigger;\n          trigger = $scope.triggerById[issue.trigger];\n          html = template({\n            trigger: trigger,\n            triggeres: $scope.triggerList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(trigger) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.trigger = trigger;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $confirm.notify(\"success\");\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".trigger-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-trigger\").popover().open();\n      });\n      $el.on(\"click\", \".trigger\", function(event) {\n        var target, trigger;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        trigger = target.data(\"trigger-id\");\n        return save(trigger);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTriggerButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueTriggerButtonDirective]);\n\n  IssuePriorityButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-priority-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, priority;\n          priority = $scope.priorityById[issue.priority];\n          html = template({\n            priority: priority,\n            priorityes: $scope.priorityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(priority) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.priority = priority;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $confirm.notify(\"success\");\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".priority-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-priority\").popover().open();\n      });\n      $el.on(\"click\", \".priority\", function(event) {\n        var priority, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        priority = target.data(\"priority-id\");\n        return save(priority);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssuePriorityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssuePriorityButtonDirective]);\n\n  PromoteIssueToUsButtonDirective = function($rootScope, $repo, $confirm, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = $qqueue.bindAdd((function(_this) {\n        return function(issue, askResponse) {\n          var data, onError, onSuccess;\n          data = {\n            generated_from_issue: issue.id,\n            project: issue.project,\n            subject: issue.subject,\n            description: issue.description,\n            tags: issue.tags,\n            is_blocked: issue.is_blocked,\n            blocked_note: issue.blocked_note\n          };\n          onSuccess = function() {\n            askResponse.finish();\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"promote-issue-to-us:success\");\n          };\n          onError = function() {\n            askResponse.finish();\n            return $confirm.notify(\"error\");\n          };\n          return $repo.create(\"userstories\", data).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \"a\", function(event) {\n        var issue, message, subtitle, title;\n        event.preventDefault();\n        issue = $model.$modelValue;\n        title = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.TITLE\");\n        message = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.MESSAGE\");\n        subtitle = issue.subject;\n        return $confirm.ask(title, subtitle, message).then((function(_this) {\n          return function(response) {\n            return save(issue, response);\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      restrict: \"AE\",\n      require: \"ngModel\",\n      templateUrl: \"issue/promote-issue-to-us-button.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgPromoteIssueToUsButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgQqueue\", \"$translate\", PromoteIssueToUsButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkIssuesDirective, CreateIssueDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaIssues\");\n\n  CreateIssueDirective = function($repo, $confirm, $rootscope, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      $scope.issue = {};\n      $scope.$on(\"issueform:new\", function(ctx, project) {\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el);\n        return $scope.issue = {\n          project: project.id,\n          subject: \"\",\n          status: project.default_issue_status,\n          type: project.default_issue_type,\n          priority: project.default_priority,\n          severity: project.default_severity,\n          trigger: project.default_trigger,\n          tags: []\n        };\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"issues\", $scope.issue);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", data);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateIssue\", [\"$tgRepo\", \"$tgConfirm\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", CreateIssueDirective]);\n\n  CreateBulkIssuesDirective = function($repo, $rs, $confirm, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.$on(\"issueform:bulk\", function(ctx, projectId, status) {\n        lightboxService.open($el);\n        return $scope[\"new\"] = {\n          projectId: projectId,\n          bulk: \"\"\n        };\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope[\"new\"].bulk;\n          projectId = $scope[\"new\"].projectId;\n          promise = $rs.issues.bulkCreate(projectId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", result);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkIssues\", [\"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkIssuesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/list.coffee\n */\n\n(function() {\n  var IssueAssignedToInlineEditionDirective, IssueStatusInlineEditionDirective, IssueTriggerInlineEditionDirective, IssuesController, IssuesDirective, IssuesFiltersDirective, bindOnce, debounceLeading, groupBy, joinStr, mixOf, module, startswith, taiga, toString, trim,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  startswith = this.taiga.startswith;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssuesController = (function(superClass) {\n    extend(IssuesController, superClass);\n\n    IssuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgUrls\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function IssuesController(scope, rootscope, repo, confirm, rs, urls, params, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var filters, promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.urls = urls;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loadIssues = bind(this.loadIssues, this);\n      this.scope.sectionName = \"Issues\";\n      this.scope.filters = {};\n      if (_.isEmpty(this.location.search())) {\n        filters = this.rs.issues.getFilters(this.params.pslug);\n        filters.page = 1;\n        this.location.search(filters);\n        this.location.replace();\n        return;\n      }\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ISSUES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"ISSUES.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"issueform:new:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"create\", \"create issue on issues list\", 1);\n          return _this.loadIssues();\n        };\n      })(this));\n    }\n\n    IssuesController.prototype.initializeSubscription = function() {\n      var routingKey;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".issues\";\n      return this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.storeFilters = function() {\n      return this.rs.issues.storeFilters(this.params.pslug, this.location.search());\n    };\n\n    IssuesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_issues_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.severityList = _.sortBy(project.severities, \"order\");\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerList = _.sortBy(project.triggers, \"order\");\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = _.sortBy(project.priorities, \"order\");\n          _this.scope.issueTypes = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueTypeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\", \"tags\", \"status\", \"types\", \"q\", \"severities\", \"triggers\", \"priorities\", \"assignedTo\", \"createdBy\", \"orderBy\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    IssuesController.prototype.getUrlFilter = function(name) {\n      var filters;\n      filters = _.pick(this.location.search(), name);\n      return filters[name];\n    };\n\n    IssuesController.prototype.loadMyFilters = function() {\n      return this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          return _.map(filters, function(value, key) {\n            return {\n              id: key,\n              name: key,\n              type: \"myFilters\",\n              selected: false\n            };\n          });\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.removeNotExistingFiltersFromUrl = function() {\n      var currentSearch, existingValues, filterName, filterValue, splittedValues, urlfilters;\n      currentSearch = this.location.search();\n      urlfilters = this.getUrlFilters();\n      for (filterName in urlfilters) {\n        filterValue = urlfilters[filterName];\n        if (filterName === \"page\" || filterName === \"orderBy\" || filterName === \"q\") {\n          continue;\n        }\n        if (filterName === \"tags\") {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"));\n        } else {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"), function(x) {\n            if (x === \"null\") {\n              return null;\n            } else {\n              return parseInt(x);\n            }\n          });\n        }\n        existingValues = _.intersection(splittedValues, _.map(this.scope.filters[filterName], \"id\"));\n        if (splittedValues.length !== existingValues.length) {\n          this.location.search(filterName, existingValues.join());\n        }\n      }\n      if (currentSearch !== this.location.search()) {\n        return this.location.replace();\n      }\n    };\n\n    IssuesController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref, ref1, results, searchdata, val, value;\n      searchdata = {};\n      ref = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref) {\n        value = ref[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref1 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref1.length; j < len; j++) {\n          val = ref1[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var k, len1, results1;\n          results1 = [];\n          for (k = 0, len1 = value.length; k < len1; k++) {\n            obj = value[k];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    IssuesController.prototype.loadFilters = function() {\n      var loadFilters, promise, urlfilters;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = urlfilters.q;\n      }\n      promise = this.loadMyFilters().then((function(_this) {\n        return function(myFilters) {\n          _this.scope.filters.myFilters = myFilters;\n          return myFilters;\n        };\n      })(this));\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.types = urlfilters.types;\n      loadFilters.severities = urlfilters.severities;\n      loadFilters.triggers = urlfilters.triggers;\n      loadFilters.priorities = urlfilters.priorities;\n      loadFilters.assigned_to = urlfilters.assignedTo;\n      loadFilters.owner = urlfilters.createdBy;\n      promise = promise.then((function(_this) {\n        return function() {\n          return _this.rs.issues.filtersData(loadFilters);\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, tagsFilterFormat, usersFiltersFormat;\n          usersFiltersFormat = function(users, type, unknownOption) {\n            var reformatedUsers, unknownItem;\n            reformatedUsers = _.map(users, function(t) {\n              t.type = type;\n              t.name = t.full_name ? t.full_name : unknownOption;\n              return t;\n            });\n            unknownItem = _.remove(reformatedUsers, function(u) {\n              return !u.id;\n            });\n            reformatedUsers = _.sortBy(reformatedUsers, function(u) {\n              return u.name.toUpperCase();\n            });\n            if (unknownItem.length > 0) {\n              reformatedUsers.unshift(unknownItem[0]);\n            }\n            return reformatedUsers;\n          };\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.issueStatusById);\n          _this.scope.filters.severities = choicesFiltersFormat(data.severities, \"severities\", _this.scope.severityById);\n          _this.scope.filters.triggers = choicesFiltersFormat(data.triggers, \"triggers\", _this.scope.triggerById);\n          _this.scope.filters.priorities = choicesFiltersFormat(data.priorities, \"priorities\", _this.scope.priorityById);\n          _this.scope.filters.assignedTo = usersFiltersFormat(data.assigned_to, \"assignedTo\", \"Unassigned\");\n          _this.scope.filters.createdBy = usersFiltersFormat(data.owners, \"createdBy\", \"Unknown\");\n          _this.scope.filters.types = choicesFiltersFormat(data.types, \"types\", _this.scope.issueTypeById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          _this.removeNotExistingFiltersFromUrl();\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rootscope.$broadcast(\"filters:loaded\", _this.scope.filters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadIssuesRequests = 0;\n\n    IssuesController.prototype.loadIssues = function() {\n      var name, promise, ref, values;\n      this.scope.urlFilters = this.getUrlFilters();\n      this.scope.httpParams = {};\n      ref = this.scope.urlFilters;\n      for (name in ref) {\n        values = ref[name];\n        if (name === \"severities\") {\n          name = \"severity\";\n        } else if (name === \"orderBy\") {\n          name = \"order_by\";\n        } else if (name === \"priorities\") {\n          name = \"priority\";\n        } else if (name === \"triggers\") {\n          name = \"trigger\";\n        } else if (name === \"assignedTo\") {\n          name = \"assigned_to\";\n        } else if (name === \"createdBy\") {\n          name = \"owner\";\n        } else if (name === \"status\") {\n          name = \"status\";\n        } else if (name === \"types\") {\n          name = \"type\";\n        }\n        this.scope.httpParams[name] = values;\n      }\n      promise = this.rs.issues.list(this.scope.projectId, this.scope.httpParams);\n      this.loadIssuesRequests += 1;\n      promise.index = this.loadIssuesRequests;\n      promise.then((function(_this) {\n        return function(data) {\n          if (promise.index === _this.loadIssuesRequests) {\n            _this.scope.issues = data.models;\n            _this.scope.page = data.current;\n            _this.scope.count = data.count;\n            _this.scope.paginatedBy = data.paginatedBy;\n          }\n          return data;\n        };\n      })(this));\n      return promise;\n    };\n\n    IssuesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          _this.loadFilters();\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.saveCurrentFiltersTo = function(newFilter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          filters[newFilter] = _this.location.search();\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.deleteMyFilter = function(filter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          delete filters[filter];\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.addNewIssue = function() {\n      return this.rootscope.$broadcast(\"issueform:new\", this.scope.project);\n    };\n\n    IssuesController.prototype.addIssuesInBulk = function() {\n      return this.rootscope.$broadcast(\"issueform:bulk\", this.scope.projectId);\n    };\n\n    return IssuesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"IssuesController\", IssuesController);\n\n  IssuesDirective = function($log, $location, $template, $compile) {\n    var link, linkOrdering, linkPagination, template;\n    template = $template.get(\"issue/issue-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".issues-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        $pagEl.show();\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        return $pagEl.html(html);\n      };\n      $scope.$watch(\"issues\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".issues-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      $el.on(\"click\", \".issues-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      return $el.on(\"click\", \".issues-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadIssues();\n        });\n      });\n    };\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var colHeadElement, currentOrder, icon;\n      currentOrder = $ctrl.getUrlFilter(\"orderBy\") || \"created_date\";\n      if (currentOrder) {\n        icon = startswith(currentOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        colHeadElement.html((colHeadElement.html()) + \"<span class='icon \" + icon + \"'></span>\");\n      }\n      return $el.on(\"click\", \".row.title > div\", function(event) {\n        var finalOrder, newOrder, target;\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getUrlFilter(\"orderBy\");\n        newOrder = target.data(\"fieldname\");\n        finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        return $scope.$apply(function() {\n          $ctrl.replaceFilter(\"orderBy\", finalOrder);\n          $ctrl.storeFilters();\n          return $ctrl.loadIssues().then(function() {\n            $el.find(\".row.title > div > span.icon\").remove();\n            icon = startswith(finalOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n            return target.html((target.html()) + \"<span class='icon \" + icon + \"'></span>\");\n          });\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkOrdering($scope, $el, $attrs, $ctrl);\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssues\", [\"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", IssuesDirective]);\n\n  IssuesFiltersDirective = function($q, $log, $location, $rs, $confirm, $loading, $template, $translate, $compile, $auth) {\n    var link, template, templateSelected;\n    template = $template.get(\"issue/issues-filters.html\", true);\n    templateSelected = $template.get(\"issue/issues-filters-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, getFiltersType, initializeSelectedFilters, reloadIssues, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection, unwatchIssues;\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\"h2.breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 a.subfilter span.title\").html(title);\n        return $el.find(\"h2 a.subfilter span.title\").prop(\"data-type\", type);\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\"h2.breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function(filters) {\n        var j, len, name, val, values;\n        selectedFilters = [];\n        for (name in filters) {\n          values = filters[name];\n          for (j = 0, len = values.length; j < len; j++) {\n            val = values[j];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters(selectedFilters);\n      };\n      renderSelectedFilters = function(selectedFilters) {\n        var html;\n        _.filter(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        $el.find(\".filters-applied\").html(html);\n        if ($auth.isAuthenticated() && selectedFilters.length > 0) {\n          return $el.find(\".save-filters\").show();\n        } else {\n          return $el.find(\".save-filters\").hide();\n        }\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.filter(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n      };\n      reloadIssues = function() {\n        var currentFiltersType;\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadIssues(), $ctrl.loadFilters()]).then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(filters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var currentFiltersType, filter, filterId, filters;\n        if (type === \"myFilters\") {\n          $rs.issues.getMyFilters($scope.projectId).then(function(data) {\n            var filters, myFilters;\n            myFilters = data;\n            filters = myFilters[id];\n            filters.page = 1;\n            $ctrl.replaceAllFilters(filters);\n            $ctrl.storeFilters();\n            $ctrl.loadIssues();\n            $ctrl.markSelectedFilters($scope.filters, filters);\n            return initializeSelectedFilters($scope.filters);\n          });\n          return null;\n        }\n        filters = $scope.filters[type];\n        filterId = type === 'tags' ? taiga.toString(id) : id;\n        filter = _.find(filters, {\n          id: filterId\n        });\n        filter.selected = !filter.selected;\n        if (id === null) {\n          id = \"null\";\n        }\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $ctrl.selectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(f) {\n            return f.id === filter.id && f.type === filter.type;\n          });\n          $ctrl.unselectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        }\n        reloadIssues();\n        renderSelectedFilters(selectedFilters);\n        currentFiltersType = getFiltersType();\n        if (type === currentFiltersType) {\n          return renderFilters(_.reject(filters, \"selected\"));\n        }\n      };\n      $scope.$on(\"filters:loaded\", function(ctx, filters) {\n        return initializeSelectedFilters(filters);\n      });\n      $scope.$on(\"filters:issueupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.status\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      $scope.$on(\"filters:triggerupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.triggers\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      selectQFilter = debounceLeading(100, function(value, oldValue) {\n        if (value === void 0 || value === oldValue) {\n          return;\n        }\n        $ctrl.replaceFilter(\"page\", null, true);\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n          $ctrl.storeFilters();\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n          $ctrl.storeFilters();\n        }\n        return reloadIssues();\n      });\n      unwatchIssues = $scope.$watch(\"issues\", function(newValue) {\n        if (!_.isUndefined(newValue)) {\n          $scope.$watch(\"filtersQ\", selectQFilter);\n          return unwatchIssues();\n        }\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data(\"type\"));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories($el);\n      });\n      $el.on(\"click\", \".filters-applied a\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"active\");\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        if (type === \"myFilters\") {\n          target.removeClass(\"active\");\n        }\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter .icon-delete\", function(event) {\n        var customFilterName, message, target, title;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        customFilterName = target.parent().data('id');\n        title = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.TITLE\");\n        message = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.MESSAGE\", {\n          customFilterName: customFilterName\n        });\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var promise;\n          promise = $ctrl.deleteMyFilter(customFilterName);\n          promise.then(function() {\n            promise = $ctrl.loadMyFilters();\n            promise.then(function(filters) {\n              askResponse.finish();\n              $scope.filters.myFilters = filters;\n              return renderFilters($scope.filters.myFilters);\n            });\n            return promise.then(null, function() {\n              return askResponse.finish();\n            });\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return $confirm.notify(\"error\");\n          });\n        });\n      });\n      $el.on(\"click\", \".save-filters\", function(event) {\n        event.preventDefault();\n        renderFilters($scope.filters[\"myFilters\"]);\n        showFilters(\"My filters\", \"myFilters\");\n        $el.find('.save-filters').hide();\n        $el.find('.my-filter-name').removeClass(\"hidden\");\n        $el.find('.my-filter-name').focus();\n        return $scope.$apply();\n      });\n      return $el.on(\"keyup\", \".my-filter-name\", function(event) {\n        var currentLoading, newFilter, promise, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newFilter = target.val();\n          currentLoading = $loading().target($el.find(\".new\")).start();\n          promise = $ctrl.saveCurrentFiltersTo(newFilter);\n          promise.then(function() {\n            var loadPromise;\n            loadPromise = $ctrl.loadMyFilters();\n            loadPromise.then(function(filters) {\n              var currentfilterstype;\n              currentLoading.finish();\n              $scope.filters.myFilters = filters;\n              currentfilterstype = $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n              if (currentfilterstype === \"myFilters\") {\n                renderFilters($scope.filters.myFilters);\n              }\n              $el.find('.my-filter-name').addClass(\"hidden\");\n              return $el.find('.save-filters').show();\n            });\n            return loadPromise.then(null, function() {\n              currentLoading.finish();\n              return $confirm.notify(\"error\", \"Error loading custom filters\");\n            });\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            $el.find(\".my-filter-name\").val(newFilter).focus().select();\n            return $confirm.notify(\"error\", \"Filter not saved\");\n          });\n        } else if (event.keyCode === 27) {\n          $el.find('.my-filter-name').val('');\n          $el.find('.my-filter-name').addClass(\"hidden\");\n          return $el.find('.save-filters').show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssuesFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", \"$compile\", \"$tgAuth\", IssuesFiltersDirective]);\n\n  IssueStatusInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the status of an Issue and a popover to change it.\n    - tg-issue-status-inline-edition: The issue\n    \n    Example:\n    \n      div.status(tg-issue-status-inline-edition=\"issue\")\n        a.issue-status(href=\"\")\n    \n    NOTE: This directive need 'issueStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueStatus;\n    selectionTemplate = $template.get(\"issue/issue-status-inline-edition-selection.html\", true);\n    updateIssueStatus = function($el, issue, issueStatusById) {\n      var issueStatusDom, issueStatusDomParent, status;\n      issueStatusDomParent = $el.find(\".issue-status\");\n      issueStatusDom = $el.find(\".issue-status .issue-status-bind\");\n      status = issueStatusById[issue.status];\n      if (status) {\n        issueStatusDom.text(status.name);\n        issueStatusDom.prop(\"title\", status.name);\n        return issueStatusDomParent.css('color', status.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueStatusInlineEdition);\n      $el.on(\"click\", \".issue-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.status;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.status) {\n            filter.count--;\n          }\n        }\n        issue.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.status;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.status) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:issueupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.issue_statuses\n        }));\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueStatusInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueStatus($el, val, $scope.issueStatusById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueStatusInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueStatusInlineEditionDirective]);\n\n  IssueTriggerInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the trigger of an Issue and a popover to change it.\n    - tg-issue-trigger-inline-edition: The issue\n    \n    Example:\n    \n      div.trigger(tg-issue-trigger-inline-edition=\"issue\")\n        a.issue-trigger(href=\"\")\n    \n    NOTE: This directive need 'triggerById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueTrigger;\n    selectionTemplate = $template.get(\"issue/issue-trigger-inline-edition-selection.html\", true);\n    updateIssueTrigger = function($el, issue, triggerById) {\n      var issueTriggerDom, issueTriggerDomParent, trigger;\n      issueTriggerDomParent = $el.find(\".issue-trigger\");\n      issueTriggerDom = $el.find(\".issue-trigger .issue-trigger-bind\");\n      trigger = triggerById[issue.trigger];\n      if (trigger) {\n        issueTriggerDom.text(trigger.name);\n        issueTriggerDom.prop(\"title\", trigger.name);\n        return issueTriggerDomParent.css('color', trigger.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueTriggerInlineEdition);\n      $el.on(\"click\", \".issue-trigger\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-trigger\").popover().open();\n      });\n      $el.on(\"click\", \".trigger\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.triggers;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.trigger) {\n            filter.count--;\n          }\n        }\n        issue.trigger = target.data(\"trigger-id\");\n        $el.find(\".pop-trigger\").popover().close();\n        updateIssueTrigger($el, issue, $scope.triggerById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.triggers;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.trigger) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:triggerupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'triggeres': project.triggers\n        }));\n        updateIssueTrigger($el, issue, $scope.triggerById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueTriggerInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueTrigger($el, val, $scope.triggerById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueTriggerInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueTriggerInlineEditionDirective]);\n\n  IssueAssignedToInlineEditionDirective = function($repo, $rootscope, popoverService) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue, updateIssue;\n      updateIssue = function(issue) {\n        var ctx, member;\n        ctx = {\n          name: \"Unassigned\",\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[issue.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".issue-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueAssignedToInlineEdition);\n      updateIssue(issue);\n      $el.on(\"click\", \".issue-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", issue);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, updatedIssue) {\n          if (updatedIssue.id === issue.id) {\n            updatedIssue.assigned_to = userId;\n            $repo.save(updatedIssue);\n            return updateIssue(updatedIssue);\n          }\n        };\n      })(this));\n      $scope.$watch($attrs.tgIssueAssignedToInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssue(val);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", IssueAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories/detail.coffee\n */\n\n(function() {\n  var UsClientRequirementButtonDirective, UsStatusButtonDirective, UsStatusDisplayDirective, UsTasksProgressDisplayDirective, UsTeamRequirementButtonDirective, UserStoryDetailController, bindMethods, bindOnce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaUserStories\");\n\n  UserStoryDetailController = (function(superClass) {\n    extend(UserStoryDetailController, superClass);\n\n    UserStoryDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function UserStoryDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.usRef = this.params.usref;\n      this.scope.sectionName = this.translate.instant(\"US.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserStoryDetailController.prototype._setMeta = function() {\n      var closedTasks, description, progressPercentage, ref, title, totalTasks;\n      totalTasks = this.scope.tasks.length;\n      closedTasks = _.filter(this.scope.tasks, (function(_this) {\n        return function(t) {\n          return _this.scope.taskStatusById[t.status].is_closed;\n        };\n      })(this)).length;\n      progressPercentage = totalTasks > 0 ? Math.round(100 * closedTasks / totalTasks) : 0;\n      title = this.translate.instant(\"US.PAGE_TITLE\", {\n        userStoryRef: \"#\" + this.scope.us.ref,\n        userStorySubject: this.scope.us.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"US.PAGE_DESCRIPTION\", {\n        userStoryStatus: ((ref = this.scope.statusById[this.scope.us.status]) != null ? ref.name : void 0) || \"--\",\n        userStoryPoints: this.scope.us.total_points,\n        userStoryDescription: angular.element(this.scope.us.description_html || \"\").text(),\n        userStoryClosedTasks: closedTasks,\n        userStoryTotalTasks: totalTasks,\n        userStoryProgressPercentage: progressPercentage\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    UserStoryDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"related-tasks:update\", (function(_this) {\n        return function() {\n          return _this.scope.tasks = _.clone(_this.scope.tasks, false);\n        };\n      })(this));\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on userstory\", 1);\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadUs();\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.us.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else {\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-backlog\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-kanban\", ctx);\n      }\n    };\n\n    UserStoryDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.us_statuses;\n          _this.scope.statusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(_this.scope.pointsList, function(e) {\n            return e.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadUs = function() {\n      var httpParams, kanbanStaus, milestone, noMilestone;\n      httpParams = _.pick(this.location.search(), \"milestone\", \"no-milestone\", \"kanban-status\");\n      milestone = httpParams.milestone;\n      if (milestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: milestone,\n          order_by: \"sprint_order\"\n        });\n      }\n      noMilestone = httpParams[\"no-milestone\"];\n      if (noMilestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: \"null\",\n          order_by: \"backlog_order\"\n        });\n      }\n      kanbanStaus = httpParams[\"kanban-status\"];\n      if (kanbanStaus) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          status: kanbanStaus,\n          order_by: \"kanban_order\"\n        });\n      }\n      return this.rs.userstories.getByRef(this.scope.projectId, this.params.usref).then((function(_this) {\n        return function(us) {\n          var ctx, ref, ref1;\n          _this.scope.us = us;\n          _this.scope.usId = us.id;\n          _this.scope.commentModel = us;\n          if (((ref = _this.scope.us.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.us.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          return us;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadSprint = function() {\n      if (this.scope.us.milestone) {\n        return this.rs.sprints.get(this.scope.us.project, this.scope.us.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    UserStoryDetailController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, null, this.scope.usId).then((function(_this) {\n        return function(tasks) {\n          _this.scope.tasks = tasks;\n          return tasks;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadUs().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadTasks()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    UserStoryDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.upvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.downvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    UserStoryDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.watch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.unwatch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    return UserStoryDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserStoryDetailController\", UserStoryDetailController);\n\n  UsStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(us) {\n        var html, status;\n        status = $scope.statusById[us.status];\n        html = template({\n          is_closed: us.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us != null) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusDisplay\", [\"$tgTemplate\", \"$compile\", UsStatusDisplayDirective]);\n\n  UsTasksProgressDisplayDirective = function($template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(tasks) {\n        var progress, totalClosedTasks, totalTasks;\n        totalTasks = tasks.length;\n        totalClosedTasks = _.filter(tasks, (function(_this) {\n          return function(task) {\n            return $scope.taskStatusById[task.status].is_closed;\n          };\n        })(this)).length;\n        progress = totalTasks > 0 ? 100 * totalClosedTasks / totalTasks : 0;\n        return _.assign($scope, {\n          totalTasks: totalTasks,\n          totalClosedTasks: totalClosedTasks,\n          progress: progress,\n          style: {\n            width: progress + \"%\"\n          }\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(tasks) {\n        if (tasks != null) {\n          return render(tasks);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"us/us-task-progress.html\",\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true\n    };\n  };\n\n  module.directive(\"tgUsTasksProgressDisplay\", [\"$tgTemplate\", \"$compile\", UsTasksProgressDisplayDirective]);\n\n  UsStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template) {\n    var link, template;\n    template = $template.get(\"us/us-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = (function(_this) {\n        return function(us) {\n          var html, status;\n          status = $scope.statusById[us.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, us;\n          us = $model.$modelValue.clone();\n          us.status = status;\n          $.fn.popover().closeAll();\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $confirm.notify(\"success\");\n            $model.$setViewValue(us);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return $repo.save(us).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".status-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var status, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        status = target.data(\"status-id\");\n        return save(status);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", UsStatusButtonDirective]);\n\n  UsTeamRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-team-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        if (!canEdit() && !us.team_requirement) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.team_requirement\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(team_requirement) {\n          var currentLoading, promise, us;\n          us = $model.$modelValue.clone();\n          us.team_requirement = team_requirement;\n          currentLoading = $loading().target($el.find(\"label\")).start();\n          promise = $tgrepo.save(us);\n          promise.then(function() {\n            $model.$setViewValue(us);\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".team-requirement\", function(event) {\n        var team_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        team_requirement = !$model.$modelValue.team_requirement;\n        return save(team_requirement);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsTeamRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsTeamRequirementButtonDirective]);\n\n  UsClientRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-client-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        if (!canEdit() && !us.client_requirement) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.client_requirement\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(client_requirement) {\n          var currentLoading, promise, us;\n          us = $model.$modelValue.clone();\n          us.client_requirement = client_requirement;\n          currentLoading = $loading().target($el.find(\"label\")).start();\n          promise = $tgrepo.save(us);\n          promise.then(function() {\n            $model.$setViewValue(us);\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".client-requirement\", function(event) {\n        var client_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        client_requirement = !$model.$modelValue.client_requirement;\n        return save(client_requirement);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsClientRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsClientRequirementButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks/detail.coffee\n */\n\n(function() {\n  var TaskDetailController, TaskIsIocaineButtonDirective, TaskStatusButtonDirective, TaskStatusDisplayDirective, bindMethods, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTasks\");\n\n  TaskDetailController = (function(superClass) {\n    extend(TaskDetailController, superClass);\n\n    TaskDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.taskRef = this.params.taskref;\n      this.scope.sectionName = this.translate.instant(\"TASK.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"TASK.PAGE_TITLE\", {\n        taskRef: \"#\" + this.scope.task.ref,\n        taskSubject: this.scope.task.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"TASK.PAGE_DESCRIPTION\", {\n        taskStatus: ((ref = this.scope.statusById[this.scope.task.status]) != null ? ref.name : void 0) || \"--\",\n        taskDescription: angular.element(this.scope.task.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on task\", 1);\n        };\n      })(this));\n      this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadTask();\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.task.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else if (this.scope.task.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        if (this.scope.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      }\n    };\n\n    TaskDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.task_statuses;\n          _this.scope.statusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadTask = function() {\n      return this.rs.tasks.getByRef(this.scope.projectId, this.params.taskref).then((function(_this) {\n        return function(task) {\n          var ctx, ref, ref1;\n          _this.scope.task = task;\n          _this.scope.taskId = task.id;\n          _this.scope.commentModel = task;\n          if (((ref = _this.scope.task.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.task.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          return task;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadSprint = function() {\n      if (this.scope.task.milestone) {\n        return this.rs.sprints.get(this.scope.task.project, this.scope.task.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadUserStory = function() {\n      if (this.scope.task.user_story) {\n        return this.rs.userstories.get(this.scope.task.project, this.scope.task.user_story).then((function(_this) {\n          return function(us) {\n            _this.scope.us = us;\n            return us;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadTask().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadUserStory()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    TaskDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.upvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.downvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    TaskDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.watch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    return TaskDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskDetailController\", TaskDetailController);\n\n  TaskStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(task) {\n        var html, status;\n        status = $scope.statusById[task.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task != null) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusDisplay\", [\"$tgTemplate\", \"$compile\", TaskStatusDisplayDirective]);\n\n  TaskStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"us/us-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = (function(_this) {\n        return function(task) {\n          var html, status;\n          status = $scope.statusById[task.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, task;\n          task = $model.$modelValue.clone();\n          task.status = status;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(task);\n            $confirm.notify(\"success\");\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return $repo.save(task).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".status-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$compile\", \"$translate\", \"$tgTemplate\", TaskStatusButtonDirective]);\n\n  TaskIsIocaineButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $compile) {\n    var link, template;\n    template = _.template(\"<fieldset title=\\\"{{ 'TASK.TITLE_ACTION_IOCAINE' | translate }}\\\">\\n  <label for=\\\"is-iocaine\\\"\\n         translate=\\\"TASK.ACTION_IOCAINE\\\"\\n         class=\\\"button button-gray is-iocaine <% if(isEditable){ %>editable<% }; %> <% if(isIocaine){ %>active<% }; %>\\\">\\n        Iocaine\\n  </label>\\n  <input type=\\\"checkbox\\\" id=\\\"is-iocaine\\\" name=\\\"is-iocaine\\\"/>\\n</fieldset>\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = function(task) {\n        var ctx, html;\n        if (!isEditable() && !task.is_iocaine) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          isIocaine: task.is_iocaine,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(is_iocaine) {\n          var currentLoading, promise, task;\n          task = $model.$modelValue.clone();\n          task.is_iocaine = is_iocaine;\n          currentLoading = $loading().target($el.find('label')).start();\n          promise = $tgrepo.save(task);\n          promise.then(function() {\n            $model.$setViewValue(task);\n            $confirm.notify(\"success\");\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          return promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".is-iocaine\", function(event) {\n        var is_iocaine;\n        if (!isEditable()) {\n          return;\n        }\n        is_iocaine = !$model.$modelValue.is_iocaine;\n        return save(is_iocaine);\n      });\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskIsIocaineButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$compile\", TaskIsIocaineButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team/main.coffee\n */\n\n(function() {\n  var LeaveProjectDirective, TeamController, TeamFiltersDirective, TeamMemberCurrentUserDirective, TeamMemberStatsDirective, TeamMembersDirective, membersFilter, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaTeam\");\n\n  TeamController = (function(superClass) {\n    extend(TeamController, superClass);\n\n    TeamController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$location\", \"$tgNavUrls\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function TeamController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, auth, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.scope.sectionName = \"TEAM.SECTION_NAME\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"TEAM.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"TEAM.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TeamController.prototype.setRole = function(role) {\n      if (role) {\n        return this.scope.filtersRole = role;\n      } else {\n        return this.scope.filtersRole = null;\n      }\n    };\n\n    TeamController.prototype.loadMembers = function() {\n      var i, len, member, ref, user;\n      user = this.auth.getUser();\n      this.scope.totals = {};\n      ref = this.scope.activeUsers;\n      for (i = 0, len = ref.length; i < len; i++) {\n        member = ref[i];\n        this.scope.totals[member.id] = 0;\n      }\n      this.scope.currentUser = _.find(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n      return this.scope.memberships = _.reject(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n    };\n\n    TeamController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issuesEnabled = project.is_issues_activated;\n          _this.scope.tasksEnabled = project.is_kanban_activated || project.is_backlog_activated;\n          _this.scope.wikiEnabled = project.is_wiki_activated;\n          return project;\n        };\n      })(this));\n    };\n\n    TeamController.prototype.loadMemberStats = function() {\n      return this.rs.projects.memberStats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totals;\n          totals = {};\n          _.forEach(_this.scope.totals, function(total, userId) {\n            var vals;\n            vals = _.map(stats, function(memberStats, statsKey) {\n              return memberStats[userId];\n            });\n            total = _.reduce(vals, function(sum, el) {\n              return sum + el;\n            });\n            return _this.scope.totals[userId] = total;\n          });\n          _this.scope.stats = _this._processStats(stats);\n          return _this.scope.stats.totals = _this.scope.totals;\n        };\n      })(this));\n    };\n\n    TeamController.prototype._processStat = function(stat) {\n      var max, min, singleStat;\n      max = _.max(stat);\n      min = _.min(stat);\n      singleStat = _.map(stat, function(value, key) {\n        if (value === min) {\n          return [key, 0.1];\n        }\n        if (value === max) {\n          return [key, 1];\n        }\n        return [key, (value * 0.5) / max];\n      });\n      singleStat = _.object(singleStat);\n      return singleStat;\n    };\n\n    TeamController.prototype._processStats = function(stats) {\n      var key, value;\n      for (key in stats) {\n        value = stats[key];\n        stats[key] = this._processStat(value);\n      }\n      return stats;\n    };\n\n    TeamController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.loadMembers();\n          return _this.loadMemberStats();\n        };\n      })(this));\n    };\n\n    return TeamController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TeamController\", TeamController);\n\n  TeamFiltersDirective = function() {\n    return {\n      templateUrl: \"team/team-filter.html\"\n    };\n  };\n\n  module.directive(\"tgTeamFilters\", [TeamFiltersDirective]);\n\n  TeamMemberStatsDirective = function() {\n    return {\n      templateUrl: \"team/team-member-stats.html\",\n      scope: {\n        stats: \"=\",\n        userId: \"=user\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMemberStats\", TeamMemberStatsDirective);\n\n  TeamMemberCurrentUserDirective = function() {\n    return {\n      templateUrl: \"team/team-member-current-user.html\",\n      scope: {\n        projectId: \"=projectid\",\n        currentUser: \"=currentuser\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamCurrentUser\", TeamMemberCurrentUserDirective);\n\n  TeamMembersDirective = function() {\n    var template;\n    template = \"team/team-members.html\";\n    return {\n      templateUrl: template,\n      scope: {\n        memberships: \"=\",\n        filtersQ: \"=filtersq\",\n        filtersRole: \"=filtersrole\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMembers\", TeamMembersDirective);\n\n  LeaveProjectDirective = function($repo, $confirm, $location, $rs, $navurls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.leave = function() {\n        var confirm_leave_project_text, leave_project_text;\n        leave_project_text = $translate.instant(\"TEAM.ACTION_LEAVE_PROJECT\");\n        confirm_leave_project_text = $translate.instant(\"TEAM.CONFIRM_LEAVE_PROJECT\");\n        return $confirm.ask(leave_project_text, confirm_leave_project_text).then((function(_this) {\n          return function(response) {\n            var promise;\n            promise = $rs.projects.leave($attrs.projectid);\n            promise.then(function() {\n              response.finish();\n              $confirm.notify(\"success\");\n              return $location.path($navurls.resolve(\"home\"));\n            });\n            return promise.then(null, function(response) {\n              response.finish();\n              return $confirm.notify('error', response.data._error_message);\n            });\n          };\n        })(this));\n      };\n    };\n    return {\n      scope: {},\n      templateUrl: \"team/leave-project.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLeaveProject\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgResources\", \"$tgNavUrls\", \"$translate\", LeaveProjectDirective]);\n\n  membersFilter = function() {\n    return function(members, filtersQ, filtersRole) {\n      return _.filter(members, function(m) {\n        return (!filtersRole || m.role === filtersRole.id) && (!filtersQ || m.full_name.search(new RegExp(filtersQ, \"i\")) >= 0);\n      });\n    };\n  };\n\n  module.filter('membersFilter', membersFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var EditableWikiContentDirective, WikiDetailController, WikiSummaryDirective, bindOnce, debounce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiDetailController = (function(superClass) {\n    extend(WikiDetailController, superClass);\n\n    WikiDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$filter\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function WikiDetailController(scope, rootscope, repo, model, confirm, rs, params, q, location, filter, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.filter = filter;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.wikiTitle = this.scope.wikiSlug;\n      this.scope.sectionName = \"Wiki\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiDetailController.prototype._setMeta = function() {\n      var description, title;\n      title = this.translate.instant(\"WIKI.PAGE_TITLE\", {\n        wikiPageName: this.scope.wikiTitle,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"WIKI.PAGE_DESCRIPTION\", {\n        wikiPageContent: angular.element(this.scope.wiki.html || \"\").text(),\n        totalEditions: this.scope.wiki.editions || 0,\n        lastModifiedDate: moment(this.scope.wiki.modified_date).format(this.translate.instant(\"WIKI.DATETIME\"))\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    WikiDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_wiki_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWiki = function() {\n      var promise;\n      promise = this.rs.wiki.getBySlug(this.scope.projectId, this.params.slug);\n      promise.then((function(_this) {\n        return function(wiki) {\n          _this.scope.wiki = wiki;\n          _this.scope.wikiId = wiki.id;\n          return _this.scope.wiki;\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function(xhr) {\n          var data;\n          _this.scope.wikiId = null;\n          if (_this.scope.project.my_permissions.indexOf(\"add_wiki_page\") === -1) {\n            return null;\n          }\n          data = {\n            project: _this.scope.projectId,\n            slug: _this.scope.wikiSlug,\n            content: \"\"\n          };\n          _this.scope.wiki = _this.model.make_model(\"wiki\", data);\n          return _this.scope.wiki;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n          if (selectedWikiLink != null) {\n            return _this.scope.wikiTitle = selectedWikiLink.title;\n          }\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.q.all([_this.loadWikiLinks(), _this.loadWiki()]).then(function() {});\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype[\"delete\"] = function() {\n      var message, title;\n      title = this.translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n      message = this.scope.wikiTitle;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var ctx;\n            askResponse.finish();\n            ctx = {\n              project: _this.scope.projectSlug\n            };\n            _this.location.path(_this.navUrls.resolve(\"project-wiki\", ctx));\n            return _this.confirm.notify(\"success\");\n          };\n          onError = function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          };\n          return _this.repo.remove(_this.scope.wiki).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    return WikiDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiDetailController\", WikiDetailController);\n\n  WikiSummaryDirective = function($log, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-summary.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var render;\n      render = function(wiki) {\n        var ctx, html, user;\n        if ($scope.usersById == null) {\n          $log.error(\"WikiSummaryDirective requires userById set in scope.\");\n        } else {\n          user = $scope.usersById[wiki.last_modifier];\n        }\n        if (user === void 0) {\n          user = {\n            name: \"unknown\",\n            imgUrl: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n        } else {\n          user = {\n            name: user.full_name_display,\n            imgUrl: user.photo\n          };\n        }\n        ctx = {\n          totalEditions: wiki.editions,\n          lastModifiedDate: moment(wiki.modified_date).format($translate.instant(\"WIKI.DATETIME\")),\n          user: user\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        return render(wikiPage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWikiSummary\", [\"$log\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiSummaryDirective]);\n\n  EditableWikiContentDirective = function($window, $document, $repo, $confirm, $loading, $analytics, $qqueue) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, disableEdition, getSelectedText, isEditable, save, switchToEditMode, switchToReadMode;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_wiki_page\") !== -1;\n      };\n      switchToEditMode = function() {\n        $el.find('.edit-wiki-content').show();\n        $el.find('.view-wiki-content').hide();\n        return $el.find('textarea').focus();\n      };\n      switchToReadMode = function() {\n        $el.find('.edit-wiki-content').hide();\n        return $el.find('.view-wiki-content').show();\n      };\n      disableEdition = function() {\n        $el.find(\".view-wiki-content .edit\").remove();\n        return $el.find(\".edit-wiki-content\").remove();\n      };\n      cancelEdition = function() {\n        if (!$model.$modelValue.id) {\n          return;\n        }\n        $scope.$apply((function(_this) {\n          return function() {\n            return $model.$modelValue.revert();\n          };\n        })(this));\n        return switchToReadMode();\n      };\n      getSelectedText = function() {\n        if ($window.getSelection) {\n          return $window.getSelection().toString();\n        } else if ($document.selection) {\n          return $document.selection.createRange().text;\n        }\n        return null;\n      };\n      save = $qqueue.bindAdd(function(wiki) {\n        var currentLoading, onError, onSuccess, promise;\n        onSuccess = function(wikiPage) {\n          if (wiki.id == null) {\n            $analytics.trackEvent(\"wikipage\", \"create\", \"create wiki page\", 1);\n          }\n          $model.$setViewValue(wikiPage.clone());\n          $confirm.notify(\"success\");\n          return switchToReadMode();\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        currentLoading = $loading().removeClasses(\"icon-floppy\").target($el.find('.icon-floppy')).start();\n        if (wiki.id != null) {\n          promise = $repo.save(wiki).then(onSuccess, onError);\n        } else {\n          promise = $repo.create(\"wiki\", wiki).then(onSuccess, onError);\n        }\n        return promise[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"mousedown\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (event.button === 2) {\n\n        }\n      });\n      $el.on(\"mouseup\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (getSelectedText()) {\n          return;\n        }\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if (target.is('pre')) {\n          return;\n        }\n        return switchToEditMode();\n      });\n      $el.on(\"click\", \".save\", debounce(2000, function() {\n        return save($scope.wiki);\n      }));\n      $el.on(\"click\", \".cancel\", function() {\n        return cancelEdition();\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode === 27) {\n          return cancelEdition();\n        }\n      });\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        if (isEditable()) {\n          $el.addClass('editable');\n          if ((wikiPage.id == null) || $.trim(wikiPage.content).length === 0) {\n            return switchToEditMode();\n          }\n        } else {\n          return disableEdition();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      templateUrl: \"wiki/editable-wiki-content.html\"\n    };\n  };\n\n  module.directive(\"tgEditableWikiContent\", [\"$window\", \"$document\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", \"$tgQqueue\", EditableWikiContentDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiNavDirective, bindOnce, groupBy, mixOf, module, taiga;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiNavDirective = function($tgrepo, $log, $location, $confirm, $navUrls, $analytics, $loading, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-nav.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render;\n      $ctrl = $el.controller();\n      if ($attrs.ngModel == null) {\n        return $log.error(\"WikiNavDirective: no ng-model attr is defined\");\n      }\n      render = function(wikiLinks) {\n        var addWikiLinkPermission, deleteWikiLinkPermission, html;\n        addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n        deleteWikiLinkPermission = $scope.project.my_permissions.indexOf(\"delete_wiki_link\") > -1;\n        html = template({\n          wikiLinks: wikiLinks,\n          projectSlug: $scope.projectSlug,\n          addWikiLinkPermission: addWikiLinkPermission,\n          deleteWikiLinkPermission: deleteWikiLinkPermission\n        });\n        html = $compile(html)($scope);\n        $el.off();\n        $el.html(html);\n        $el.on(\"click\", \".wiki-link .link-title\", function(event) {\n          var linkId, linkSlug, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          linkSlug = $scope.wikiLinks[linkId].href;\n          return $scope.$apply(function() {\n            var ctx;\n            ctx = {\n              project: $scope.projectSlug,\n              slug: linkSlug\n            };\n            return $location.path($navUrls.resolve(\"project-wiki-page\", ctx));\n          });\n        });\n        $el.on(\"click\", \".add-button\", function(event) {\n          event.preventDefault();\n          $el.find(\".new\").removeClass(\"hidden\");\n          $el.find(\".new input\").focus();\n          return $el.find(\".add-button\").hide();\n        });\n        $el.on(\"click\", \".wiki-link .icon-delete\", function(event) {\n          var linkId, message, target, title;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          title = $translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n          message = $scope.wikiLinks[linkId].title;\n          return $confirm.askOnDelete(title, message).then((function(_this) {\n            return function(askResponse) {\n              var promise;\n              promise = $tgrepo.remove($scope.wikiLinks[linkId]);\n              promise.then(function() {\n                promise = $ctrl.loadWikiLinks();\n                promise.then(function() {\n                  askResponse.finish();\n                  return render($scope.wikiLinks);\n                });\n                return promise.then(null, function() {\n                  return askResponse.finish();\n                });\n              });\n              return promise.then(null, function() {\n                askResponse.finish(false);\n                return $confirm.notify(\"error\");\n              });\n            };\n          })(this));\n        });\n        return $el.on(\"keyup\", \".new input\", function(event) {\n          var currentLoading, newLink, promise, target;\n          event.preventDefault();\n          if (event.keyCode === 13) {\n            target = angular.element(event.currentTarget);\n            newLink = target.val();\n            currentLoading = $loading().target($el.find(\".new\")).start();\n            promise = $tgrepo.create(\"wiki-links\", {\n              project: $scope.projectId,\n              title: newLink\n            });\n            promise.then(function() {\n              var loadPromise;\n              $analytics.trackEvent(\"wikilink\", \"create\", \"create wiki link\", 1);\n              loadPromise = $ctrl.loadWikiLinks();\n              loadPromise.then(function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return render($scope.wikiLinks);\n              });\n              return loadPromise.then(null, function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return $confirm.notify(\"error\", \"Error loading wiki links\");\n              });\n            });\n            return promise.then(null, function(error) {\n              var ref;\n              currentLoading.finish();\n              $el.find(\".new input\").val(newLink);\n              $el.find(\".new input\").focus().select();\n              if ((error != null ? (ref = error.__all__) != null ? ref[0] : void 0 : void 0) != null) {\n                return $confirm.notify(\"error\", \"The link already exists\");\n              } else {\n                return $confirm.notify(\"error\");\n              }\n            });\n          } else if (event.keyCode === 27) {\n            target = angular.element(event.currentTarget);\n            $el.find(\".new\").addClass(\"hidden\");\n            $el.find(\".new input\").val('');\n            return $el.find(\".add-button\").show();\n          }\n        });\n      };\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiNav\", [\"$tgRepo\", \"$log\", \"$tgLocation\", \"$tgConfirm\", \"$tgNavUrls\", \"$tgAnalytics\", \"$tgLoading\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiNavDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/lightboxes.coffee\n */\n\n(function() {\n  var CreateMembersDirective, MAX_MEMBERSHIP_FIELDSETS, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaKanban\");\n\n  MAX_MEMBERSHIP_FIELDSETS = 4;\n\n  CreateMembersDirective = function($rs, $rootScope, $confirm, $loading, lightboxService, $compile) {\n    var extraTextTemplate, link, template;\n    extraTextTemplate = \"<fieldset class=\\\"extra-text\\\">\\n    <textarea ng-attr-placeholder=\\\"{{'LIGHTBOX.CREATE_MEMBER.PLACEHOLDER_INVITATION_TEXT' | translate}}\\\"\\n              maxlength=\\\"255\\\"></textarea>\\n</fieldset>\";\n    template = _.template(\"<div class=\\\"add-member-wrapper\\\">\\n    <fieldset>\\n        <input tg-capslock type=\\\"email\\\" placeholder=\\\"{{'LIGHTBOX.CREATE_MEMBER.PLACEHOLDER_TYPE_EMAIL' | translate}}\\\"\\n               <% if(required) { %> data-required=\\\"true\\\" <% } %> data-type=\\\"email\\\" />\\n    </fieldset>\\n    <fieldset>\\n        <select <% if(required) { %> data-required=\\\"true\\\" <% } %> data-required=\\\"true\\\">\\n            <% _.each(roleList, function(role) { %>\\n            <option value=\\\"<%- role.id %>\\\"><%- role.name %></option>\\n            <% }); %>\\n        </select>\\n        <a class=\\\"icon icon-plus add-fieldset\\\" href=\\\"\\\"></a>\\n    </fieldset>\\n</div>\");\n    link = function($scope, $el, $attrs) {\n      var createFieldSet, resetForm, submit, submitButton;\n      createFieldSet = function(required) {\n        var ctx;\n        if (required == null) {\n          required = true;\n        }\n        ctx = {\n          roleList: $scope.project.roles,\n          required: required\n        };\n        return $compile(template(ctx))($scope);\n      };\n      resetForm = function() {\n        var fieldSet, invitations;\n        $el.find(\"form textarea\").remove();\n        $el.find(\"form .add-member-wrapper\").remove();\n        invitations = $el.find(\".add-member-forms\");\n        invitations.html($compile(extraTextTemplate)($scope));\n        fieldSet = createFieldSet();\n        return invitations.prepend(fieldSet);\n      };\n      $scope.$on(\"membersform:new\", function() {\n        resetForm();\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \".delete-fieldset\", function(event) {\n        var fieldSet, lastActionButton, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        fieldSet = target.closest('.add-member-wrapper');\n        fieldSet.remove();\n        lastActionButton = $el.find(\".add-member-wrapper fieldset:last > a\");\n        if (lastActionButton.hasClass(\"icon-delete delete-fieldset\")) {\n          return lastActionButton.removeClass(\"icon-delete delete-fieldset\").addClass(\"icon-plus add-fieldset\");\n        }\n      });\n      $el.on(\"click\", \".add-fieldset\", function(event) {\n        var fieldSet, newFieldSet, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        fieldSet = target.closest('.add-member-wrapper');\n        target.removeClass(\"icon-plus add-fieldset\").addClass(\"icon-delete delete-fieldset\");\n        newFieldSet = createFieldSet(false);\n        fieldSet.after(newFieldSet);\n        $scope.$digest();\n        if ($el.find(\".add-member-wrapper\").length === MAX_MEMBERSHIP_FIELDSETS) {\n          return $el.find(\".add-member-wrapper fieldset:last > a\").removeClass(\"icon-plus add-fieldset\").addClass(\"icon-delete delete-fieldset\");\n        }\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, form, invitation_extra_text, invitations, memberWrappers, onError, onSuccess, promise;\n          event.preventDefault();\n          currentLoading = $loading().target(submitButton).start();\n          onSuccess = function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"membersform:new:success\");\n          };\n          onError = function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            $confirm.notify(\"error\");\n            return $rootScope.$broadcast(\"membersform:new:error\");\n          };\n          form = $el.find(\"form\").checksley();\n          form.destroy();\n          form.initialize();\n          if (!form.validate()) {\n            return;\n          }\n          memberWrappers = $el.find(\"form .add-member-wrapper\");\n          memberWrappers = _.filter(memberWrappers, function(mw) {\n            return angular.element(mw).find(\"input\").hasClass('checksley-ok');\n          });\n          invitations = _.map(memberWrappers, function(mw) {\n            var email, memberWrapper, role;\n            memberWrapper = angular.element(mw);\n            email = memberWrapper.find(\"input\");\n            role = memberWrapper.find(\"select\");\n            return {\n              email: email.val(),\n              role_id: role.val()\n            };\n          });\n          if (invitations.length) {\n            invitation_extra_text = $el.find(\"form textarea\").val();\n            promise = $rs.memberships.bulkCreateMemberships($scope.project.id, invitations, invitation_extra_text);\n            return promise.then(onSuccess, onError);\n          }\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateMembers\", [\"$tgResources\", \"$rootScope\", \"$tgConfirm\", \"$tgLoading\", \"lightboxService\", \"$compile\", CreateMembersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var MembershipsController, MembershipsDirective, MembershipsRowActionsDirective, MembershipsRowAdminCheckboxDirective, MembershipsRowAvatarDirective, MembershipsRowRoleSelectorDirective, bindMethods, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  MembershipsController = (function(superClass) {\n    extend(MembershipsController, superClass);\n\n    MembershipsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAnalytics\", \"tgAppMetaService\", \"$translate\"];\n\n    function MembershipsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, analytics, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.project = {};\n      this.scope.filters = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.MEMBERSHIPS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"membersform:new:success\", (function(_this) {\n        return function() {\n          _this.loadMembers();\n          return _this.analytics.trackEvent(\"membership\", \"create\", \"create memberships on admin\", 1);\n        };\n      })(this));\n    }\n\n    MembershipsController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadMembers = function() {\n      var httpFilters;\n      httpFilters = this.getUrlFilters();\n      return this.rs.memberships.list(this.scope.projectId, httpFilters).then((function(_this) {\n        return function(data) {\n          _this.scope.memberships = _.filter(data.models, function(membership) {\n            return membership.user === null || membership.is_user_active;\n          });\n          _this.scope.page = data.current;\n          _this.scope.count = data.count;\n          _this.scope.paginatedBy = data.paginatedBy;\n          return data;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadMembers();\n        };\n      })(this));\n      return promise;\n    };\n\n    MembershipsController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    MembershipsController.prototype.addNewMembers = function() {\n      return this.rootscope.$broadcast(\"membersform:new\");\n    };\n\n    return MembershipsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"MembershipsController\", MembershipsController);\n\n  MembershipsDirective = function($template, $compile) {\n    var link, linkPagination, template;\n    template = $template.get(\"admin/admin-membership-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".memberships-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        $pagEl.html(html);\n        return $pagEl.show();\n      };\n      $scope.$watch(\"memberships\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".memberships-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      $el.on(\"click\", \".memberships-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      return $el.on(\"click\", \".memberships-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadMembers();\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMemberships\", [\"$tgTemplate\", \"$compile\", MembershipsDirective]);\n\n  MembershipsRowAvatarDirective = function($log, $template, $translate) {\n    var link, template;\n    template = $template.get(\"admin/memberships-row-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      var member, pending, render;\n      pending = $translate.instant(\"ADMIN.MEMBERSHIP.STATUS_PENDING\");\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          full_name: member.full_name ? member.full_name : \"\",\n          email: member.user_email ? member.user_email : member.email,\n          imgurl: member.photo ? member.photo : \"/\" + window._version + \"/images/unnamed.png\",\n          pending: !member.is_user_active ? pending : \"\"\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAvatar == null) {\n        return $log.error(\"MembershipsRowAvatarDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAvatar);\n      render(member);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAvatar\", [\"$log\", \"$tgTemplate\", '$translate', MembershipsRowAvatarDirective]);\n\n  MembershipsRowAdminCheckboxDirective = function($log, $repo, $confirm, $template, $compile) {\n    var link, template;\n    template = $template.get(\"admin/admin-memberships-row-checkbox.html\", true);\n    link = function($scope, $el, $attrs) {\n      var html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          inputId: \"is-admin-\" + member.id\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAdminCheckbox == null) {\n        return $log.error(\"MembershipsRowAdminCheckboxDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAdminCheckbox);\n      html = render(member);\n      if (member.is_owner) {\n        $el.find(\":checkbox\").prop(\"checked\", true);\n      }\n      $el.on(\"click\", \":checkbox\", (function(_this) {\n        return function(event) {\n          var onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function(data) {\n            member.revert();\n            $el.find(\":checkbox\").prop(\"checked\", member.is_owner);\n            return $confirm.notify(\"error\", data.is_owner[0]);\n          };\n          target = angular.element(event.currentTarget);\n          member.is_owner = target.prop(\"checked\");\n          return $repo.save(member).then(onSuccess, onError);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAdminCheckbox\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", MembershipsRowAdminCheckboxDirective]);\n\n  MembershipsRowRoleSelectorDirective = function($log, $repo, $confirm) {\n    var link, template;\n    template = _.template(\"<select>\\n    <% _.each(roleList, function(role) { %>\\n    <option value=\\\"<%- role.id %>\\\" <% if(selectedRole === role.id){ %>selected=\\\"selected\\\"<% } %>>\\n        <%- role.name %>\\n    </option>\\n    <% }); %>\\n</select>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          roleList: $scope.project.roles,\n          selectedRole: member.role\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowRoleSelector == null) {\n        return $log.error(\"MembershipsRowRoleSelectorDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowRoleSelector);\n      html = render(member);\n      $el.on(\"change\", \"select\", (function(_this) {\n        return function(event) {\n          var newRole, onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          target = angular.element(event.currentTarget);\n          newRole = parseInt(target.val(), 10);\n          if (member.role !== newRole) {\n            member.role = newRole;\n            return $repo.save(member).then(onSuccess, onError);\n          }\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowRoleSelector\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", MembershipsRowRoleSelectorDirective]);\n\n  MembershipsRowActionsDirective = function($log, $repo, $rs, $confirm, $compile, $translate) {\n    var activedTemplate, link, pendingTemplate;\n    activedTemplate = \"<div class=\\\"active\\\"\\n     translate=\\\"ADMIN.MEMBERSHIP.STATUS_ACTIVE\\\">\\n</div>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <span class=\\\"icon icon-delete\\\"></span>\\n</a>\";\n    pendingTemplate = \"<a class=\\\"resend js-resend\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.RESEND' | translate }}\\\"\\n   translate=\\\"ADMIN.MEMBERSHIP.RESEND\\\">\\n</a>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <span class=\\\"icon icon-delete\\\"></span>\\n</a>\";\n    link = function($scope, $el, $attrs) {\n      var $ctrl, member, render;\n      render = function(member) {\n        var html;\n        if (member.user) {\n          html = $compile(activedTemplate)($scope);\n        } else {\n          html = $compile(pendingTemplate)($scope);\n        }\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowActions == null) {\n        return $log.error(\"MembershipsRowActionsDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowActions);\n      render(member);\n      $el.on(\"click\", \".js-resend\", function(event) {\n        var onError, onSuccess;\n        event.preventDefault();\n        onSuccess = function() {\n          var text;\n          text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION\", {\n            email: $scope.member.email\n          });\n          return $confirm.notify(\"success\", text);\n        };\n        onError = function() {\n          var text;\n          text = $translate.instant(\"ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION\");\n          return $confirm.notify(\"error\", text);\n        };\n        return $rs.memberships.resendInvitation($scope.member.id).then(onSuccess, onError);\n      });\n      $el.on(\"click\", \".delete\", function(event) {\n        var defaultMsg, message, title;\n        event.preventDefault();\n        title = $translate.instant(\"ADMIN.MEMBERSHIP.DELETE_MEMBER\");\n        defaultMsg = $translate.instant(\"ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE\", {\n          email: member.email\n        });\n        message = member.user ? member.full_name : defaultMsg;\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish();\n              if ($scope.page > 1 && ($scope.count - 1) <= $scope.paginatedBy) {\n                $ctrl.selectFilter(\"page\", $scope.page - 1);\n              }\n              $ctrl.loadMembers();\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_DELETE\");\n              return $confirm.notify(\"success\", null, text);\n            };\n          })(this);\n          onError = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish(false);\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.ERROR_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"error\", null, text);\n            };\n          })(this);\n          return $repo.remove(member).then(onSuccess, onError);\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowActions\", [\"$log\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$compile\", \"$translate\", MembershipsRowActionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/nav.coffee\n */\n\n(function() {\n  var AdminNavigationDirective, module;\n\n  AdminNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgAdminNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#adminmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaAdmin\");\n\n  module.directive(\"tgAdminNavigation\", AdminNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var CsvExporterController, CsvExporterIssuesController, CsvExporterTasksController, CsvExporterUserstoriesController, CsvIssueDirective, CsvTaskDirective, CsvUsDirective, ProjectDefaultValuesDirective, ProjectExportDirective, ProjectModulesDirective, ProjectProfileController, ProjectProfileDirective, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectProfileController = (function(superClass) {\n    extend(ProjectProfileController, superClass);\n\n    ProjectProfileController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectProfileController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectProfileController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.prioritiesList = _.sortBy(project.priorities, \"order\");\n          _this.scope.severitiesList = _.sortBy(project.severities, \"order\");\n          _this.scope.triggersList = _.sortBy(project.triggers, \"order\");\n          _this.scope.issueTypesList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectProfileController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    ProjectProfileController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.project);\n    };\n\n    return ProjectProfileController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectProfileController\", ProjectProfileController);\n\n  ProjectProfileDirective = function($repo, $confirm, $loading, $navurls, $location, projectService, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, form, submit, submitButton;\n      $ctrl = $el.controller();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            var newUrl;\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            newUrl = $navurls.resolve(\"project-admin-project-profile-details\", {\n              project: $scope.project.slug\n            });\n            $location.path(newUrl);\n            $ctrl.loadInitialData();\n            projectService.fetchProject();\n            return currentUserService.loadProjects();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectProfile\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgNavUrls\", \"$tgLocation\", \"tgProjectService\", \"tgCurrentUserService\", ProjectProfileDirective]);\n\n  ProjectDefaultValuesDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectDefaultValues\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", ProjectDefaultValuesDirective]);\n\n  ProjectModulesDirective = function($repo, $confirm, $loading, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = (function(_this) {\n        return function() {\n          var currentLoading, form, promise, target;\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          target = angular.element(\".admin-functionalities .submit-button\");\n          currentLoading = $loading().target(target).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            $scope.$emit(\"project:loaded\", $scope.project);\n            return projectService.fetchProject();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            return $confirm.notify(\"error\", data._error_message);\n          });\n        };\n      })(this);\n      $el.on(\"submit\", \"form\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \".admin-functionalities a.button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $scope.$watch(\"isVideoconferenceActivated\", function(isVideoconferenceActivated) {\n        if (isVideoconferenceActivated) {\n          return $el.find(\".videoconference-attributes\").removeClass(\"hidden\");\n        } else {\n          $el.find(\".videoconference-attributes\").addClass(\"hidden\");\n          $scope.project.videoconferences = null;\n          return $scope.project.videoconferences_extra_data = \"\";\n        }\n      });\n      return $scope.$watch(\"project\", function(project) {\n        if (project.videoconferences != null) {\n          return $scope.isVideoconferenceActivated = true;\n        } else {\n          return $scope.isVideoconferenceActivated = false;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectModules\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgProjectService\", ProjectModulesDirective]);\n\n  ProjectExportDirective = function($window, $rs, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var asyn_message, buttonsEl, dump_ready_text, hideButtons, hideResult, hideSpinner, loading_msg, loading_title, resultEl, resultMessageEl, resultTitleEl, setAsyncMessage, setAsyncTitle, setLoadingMessage, setLoadingTitle, setSyncMessage, setSyncTitle, showButtons, showErrorMode, showExportResultAsyncMode, showExportResultSyncMode, showLoadingMode, showResult, showSpinner, spinnerEl, syn_message;\n      buttonsEl = $el.find(\".admin-project-export-buttons\");\n      showButtons = function() {\n        return buttonsEl.removeClass(\"hidden\");\n      };\n      hideButtons = function() {\n        return buttonsEl.addClass(\"hidden\");\n      };\n      resultEl = $el.find(\".admin-project-export-result\");\n      showResult = function() {\n        return resultEl.removeClass(\"hidden\");\n      };\n      hideResult = function() {\n        return resultEl.addClass(\"hidden\");\n      };\n      spinnerEl = $el.find(\".spin\");\n      showSpinner = function() {\n        return spinnerEl.removeClass(\"hidden\");\n      };\n      hideSpinner = function() {\n        return spinnerEl.addClass(\"hidden\");\n      };\n      resultTitleEl = $el.find(\".result-title\");\n      loading_title = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_TITLE\");\n      loading_msg = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_MESSAGE\");\n      dump_ready_text = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.DUMP_READY\"));\n      };\n      asyn_message = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE\"));\n      };\n      syn_message = function(url) {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.SYNC_MESSAGE\", {\n          url: url\n        }));\n      };\n      setLoadingTitle = function() {\n        return resultTitleEl.html(loading_title);\n      };\n      setAsyncTitle = function() {\n        return resultTitleEl.html(loading_msg);\n      };\n      setSyncTitle = function() {\n        return resultTitleEl.html(dump_ready_text);\n      };\n      resultMessageEl = $el.find(\".result-message \");\n      setLoadingMessage = function() {\n        return resultMessageEl.html(loading_msg);\n      };\n      setAsyncMessage = function() {\n        return resultMessageEl.html(asyn_message);\n      };\n      setSyncMessage = function(url) {\n        return resultMessageEl.html(syn_message(url));\n      };\n      showLoadingMode = function() {\n        showSpinner();\n        setLoadingTitle();\n        setLoadingMessage();\n        hideButtons();\n        return showResult();\n      };\n      showExportResultAsyncMode = function() {\n        hideSpinner();\n        setAsyncTitle();\n        return setAsyncMessage();\n      };\n      showExportResultSyncMode = function(url) {\n        hideSpinner();\n        setSyncTitle();\n        return setSyncMessage(url);\n      };\n      showErrorMode = function() {\n        hideSpinner();\n        hideResult();\n        return showButtons();\n      };\n      return $el.on(\"click\", \"a.button-export\", debounce(2000, (function(_this) {\n        return function(event) {\n          var onError, onSuccess;\n          event.preventDefault();\n          onSuccess = function(result) {\n            var dumpUrl;\n            if (result.status === 202) {\n              return showExportResultAsyncMode();\n            } else {\n              dumpUrl = result.data.url;\n              showExportResultSyncMode(dumpUrl);\n              return $window.open(dumpUrl, \"_blank\");\n            }\n          };\n          onError = function(result) {\n            var errorMsg, ref;\n            showErrorMode();\n            errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\", {\n                message: result.data._error_message\n              });\n            }\n            return $confirm.notify(\"error\", errorMsg);\n          };\n          showLoadingMode();\n          return $rs.projects[\"export\"]($scope.projectId).then(onSuccess, onError);\n        };\n      })(this)));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectExport\", [\"$window\", \"$tgResources\", \"$tgConfirm\", \"$translate\", ProjectExportDirective]);\n\n  CsvExporterController = (function(superClass) {\n    extend(CsvExporterController, superClass);\n\n    CsvExporterController.$inject = [\"$scope\", \"$rootScope\", \"$tgUrls\", \"$tgConfirm\", \"$tgResources\", \"$translate\"];\n\n    function CsvExporterController(scope, rootscope, urls, confirm, rs, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.urls = urls;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.translate = translate;\n      this._generateUuid = bind(this._generateUuid, this);\n      this.setCsvUuid = bind(this.setCsvUuid, this);\n      this.rootscope.$on(\"project:loaded\", this.setCsvUuid);\n      this.scope.$watch(\"csvUuid\", (function(_this) {\n        return function(value) {\n          if (value) {\n            return _this.scope.csvUrl = _this.urls.resolveAbsolute(_this.type + \"-csv\", value);\n          } else {\n            return _this.scope.csvUrl = \"\";\n          }\n        };\n      })(this));\n    }\n\n    CsvExporterController.prototype.setCsvUuid = function() {\n      return this.scope.csvUuid = this.scope.project[this.type + \"_csv_uuid\"];\n    };\n\n    CsvExporterController.prototype._generateUuid = function(response) {\n      var promise;\n      if (response == null) {\n        response = null;\n      }\n      promise = this.rs.projects[\"regenerate_\" + this.type + \"_csv_uuid\"](this.scope.projectId);\n      promise.then((function(_this) {\n        return function(data) {\n          var ref;\n          return _this.scope.csvUuid = (ref = data.data) != null ? ref.uuid : void 0;\n        };\n      })(this));\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n      promise[\"finally\"](function() {\n        if (response) {\n          return response.finish();\n        }\n      });\n      return promise;\n    };\n\n    CsvExporterController.prototype.regenerateUuid = function() {\n      var subtitle, title;\n      if (this.scope.csvUuid) {\n        title = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_TITLE\");\n        subtitle = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_SUBTITLE\");\n        return this.confirm.ask(title, subtitle).then(this._generateUuid);\n      } else {\n        return this._generateUuid();\n      }\n    };\n\n    return CsvExporterController;\n\n  })(taiga.Controller);\n\n  CsvExporterUserstoriesController = (function(superClass) {\n    extend(CsvExporterUserstoriesController, superClass);\n\n    function CsvExporterUserstoriesController() {\n      return CsvExporterUserstoriesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterUserstoriesController.prototype.type = \"userstories\";\n\n    return CsvExporterUserstoriesController;\n\n  })(CsvExporterController);\n\n  CsvExporterTasksController = (function(superClass) {\n    extend(CsvExporterTasksController, superClass);\n\n    function CsvExporterTasksController() {\n      return CsvExporterTasksController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterTasksController.prototype.type = \"tasks\";\n\n    return CsvExporterTasksController;\n\n  })(CsvExporterController);\n\n  CsvExporterIssuesController = (function(superClass) {\n    extend(CsvExporterIssuesController, superClass);\n\n    function CsvExporterIssuesController() {\n      return CsvExporterIssuesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterIssuesController.prototype.type = \"issues\";\n\n    return CsvExporterIssuesController;\n\n  })(CsvExporterController);\n\n  module.controller(\"CsvExporterUserstoriesController\", CsvExporterUserstoriesController);\n\n  module.controller(\"CsvExporterTasksController\", CsvExporterTasksController);\n\n  module.controller(\"CsvExporterIssuesController\", CsvExporterIssuesController);\n\n  CsvUsDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_US\";\n    };\n    return {\n      controller: \"CsvExporterUserstoriesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvUs\", [\"$translate\", CsvUsDirective]);\n\n  CsvTaskDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_TASK\";\n    };\n    return {\n      controller: \"CsvExporterTasksController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvTask\", [\"$translate\", CsvTaskDirective]);\n\n  CsvIssueDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_ISSUE\";\n    };\n    return {\n      controller: \"CsvExporterIssuesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvIssue\", [\"$translate\", CsvIssueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var ColorSelectionDirective, DATE_TYPE, MULTILINE_TYPE, ProjectCustomAttributesController, ProjectCustomAttributesDirective, ProjectValuesController, ProjectValuesDirective, ProjectValuesSectionController, SELECT_TYPE, TEXT_TYPE, TYPE_CHOICES, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectValuesSectionController = (function(superClass) {\n    extend(ProjectValuesSectionController, superClass);\n\n    ProjectValuesSectionController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectValuesSectionController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_VALUES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    ProjectValuesSectionController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectValuesSectionController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    return ProjectValuesSectionController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectValuesSectionController\", ProjectValuesSectionController);\n\n  ProjectValuesController = (function(superClass) {\n    extend(ProjectValuesController, superClass);\n\n    ProjectValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\"];\n\n    function ProjectValuesController(scope, rootscope, repo, confirm, rs) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.moveValue = bind(this.moveValue, this);\n      this.loadValues = bind(this.loadValues, this);\n      this.scope.$on(\"admin:project-values:move\", this.moveValue);\n      this.rootscope.$on(\"project:loaded\", this.loadValues);\n    }\n\n    ProjectValuesController.prototype.loadValues = function() {\n      return this.rs[this.scope.resource].listValues(this.scope.projectId, this.scope.type).then((function(_this) {\n        return function(values) {\n          _this.scope.values = values;\n          _this.scope.maxValueOrder = _.max(values, \"order\").order;\n          return values;\n        };\n      })(this));\n    };\n\n    ProjectValuesController.prototype.moveValue = function(ctx, itemValue, itemIndex) {\n      var r, values;\n      values = this.scope.values;\n      r = values.indexOf(itemValue);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, itemValue);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return ProjectValuesController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectValuesController\", ProjectValuesController);\n\n  ProjectValuesDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link, linkDragAndDrop, linkValue;\n    linkDragAndDrop = function($scope, $el, $attrs) {\n      var itemEl, newParentScope, oldParentScope, tdom;\n      oldParentScope = null;\n      newParentScope = null;\n      itemEl = null;\n      tdom = $el.find(\".sortable\");\n      tdom.sortable({\n        handle: \".row.table-main.visualization\",\n        dropOnEmpty: true,\n        connectWith: \".project-values-body\",\n        revert: 400,\n        axis: \"y\"\n      });\n      tdom.on(\"sortstop\", function(event, ui) {\n        var itemIndex, itemValue;\n        itemEl = ui.item;\n        itemValue = itemEl.scope().value;\n        itemIndex = itemEl.index();\n        return $scope.$broadcast(\"admin:project-values:move\", itemValue, itemIndex);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    linkValue = function($scope, $el, $attrs) {\n      var $ctrl, cancel, goToBottomList, initializeNewValue, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"is_closed\": false,\n          \"is_archived\": false\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_\" + (objName.toUpperCase()) + \".ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = function(target) {\n        var form, formEl, promise, value;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        value = formEl.scope().value;\n        promise = $repo.save(value);\n        promise.then((function(_this) {\n          return function() {\n            var row;\n            row = target.parents(\".row.table-main\");\n            row.addClass(\"hidden\");\n            return row.siblings(\".visualization\").removeClass('hidden');\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      saveNewValue = function(target) {\n        var form, formEl, promise;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        $scope.newValue.order = $scope.maxValueOrder ? $scope.maxValueOrder + 1 : 1;\n        promise = $repo.create(valueType, $scope.newValue);\n        promise.then((function(_this) {\n          return function(data) {\n            target.addClass(\"hidden\");\n            $scope.values.push(data);\n            $scope.maxValueOrder = data.order;\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      cancel = function(target) {\n        var formEl, row, value;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          value.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").removeClass('hidden');\n        return goToBottomList(true);\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".edition input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return saveValue(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      return $el.on(\"click\", \".delete-value\", function(event) {\n        var choices, formEl, subtitle, target, text, title, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        choices = {};\n        _.each($scope.values, function(option) {\n          if (value.id !== option.id) {\n            return choices[option.id] = option.name;\n          }\n        });\n        subtitle = value.name;\n        if (_.keys(choices).length === 0) {\n          return $confirm.error($translate.instant(\"ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL\"));\n        }\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\");\n        text = $translate.instant(\"ADMIN.PROJECT_VALUES.REPLACEMENT\");\n        return $confirm.askChoice(title, subtitle, choices, text).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadValues()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $repo.remove(value, {\n            \"moveTo\": response.selected\n          }).then(onSucces, onError);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      linkDragAndDrop($scope, $el, $attrs);\n      linkValue($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectValues\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectValuesDirective]);\n\n  ColorSelectionDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$watch($attrs.ngModel, function(element) {\n        return $scope.color = element.color;\n      });\n      $el.on(\"click\", \".current-color\", function(event) {\n        var body, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        $el.find(\".select-color\").hide();\n        target.siblings(\".select-color\").show();\n        body = angular.element(\"body\");\n        return body.on(\"click\", (function(_this) {\n          return function(event) {\n            if (angular.element(event.target).parent(\".select-color\").length === 0) {\n              $el.find(\".select-color\").hide();\n              return body.unbind(\"click\");\n            }\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".select-color .color\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $model.$modelValue.color = target.data(\"color\");\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"click\", \".select-color .selected-color\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $model.$modelValue.color = $scope.color;\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgColorSelection\", ColorSelectionDirective);\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  SELECT_TYPE = \"select\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: SELECT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_SELECT\"\n    }\n  ];\n\n  ProjectCustomAttributesController = (function(superClass) {\n    extend(ProjectCustomAttributesController, superClass);\n\n    ProjectCustomAttributesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectCustomAttributesController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.moveCustomAttributes = bind(this.moveCustomAttributes, this);\n      this.deleteCustomAttribute = bind(this.deleteCustomAttribute, this);\n      this.saveCustomAttribute = bind(this.saveCustomAttribute, this);\n      this.createCustomAttribute = bind(this.createCustomAttribute, this);\n      this.loadCustomAttributes = bind(this.loadCustomAttributes, this);\n      this.scope.TYPE_CHOICES = TYPE_CHOICES;\n      this.scope.project = {};\n      this.rootscope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          _this.loadCustomAttributes();\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectCustomAttributesController.prototype.loadCustomAttributes = function() {\n      return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((function(_this) {\n        return function(customAttributes) {\n          _this.scope.customAttributes = customAttributes;\n          _this.scope.maxOrder = _.max(customAttributes, \"order\").order;\n          return customAttributes;\n        };\n      })(this));\n    };\n\n    ProjectCustomAttributesController.prototype.createCustomAttribute = function(attrValues) {\n      return this.repo.create(\"custom-attributes/\" + this.scope.type, attrValues);\n    };\n\n    ProjectCustomAttributesController.prototype.saveCustomAttribute = function(attrModel) {\n      return this.repo.save(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.deleteCustomAttribute = function(attrModel) {\n      return this.repo.remove(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.moveCustomAttributes = function(attrModel, newIndex) {\n      var customAttributes, r;\n      customAttributes = this.scope.customAttributes;\n      r = customAttributes.indexOf(attrModel);\n      customAttributes.splice(r, 1);\n      customAttributes.splice(newIndex, 0, attrModel);\n      _.each(customAttributes, function(val, idx) {\n        return val.order = idx;\n      });\n      return this.repo.saveAll(customAttributes);\n    };\n\n    return ProjectCustomAttributesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectCustomAttributesController\", ProjectCustomAttributesController);\n\n  ProjectCustomAttributesDirective = function($log, $confirm, animationFrame, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, cancelCreate, cancelUpdate, create, deleteCustomAttribute, hideAddButton, hideCancelButton, hideCreateForm, hideEditForm, resetNewAttr, revertChangesInCustomAttribute, showAddButton, showCancelButton, showCreateForm, showEditForm, sortableEl, update;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      sortableEl = $el.find(\".js-sortable\");\n      sortableEl.sortable({\n        handle: \".js-view-custom-field\",\n        dropOnEmpty: true,\n        revert: 400,\n        axis: \"y\"\n      });\n      sortableEl.on(\"sortstop\", function(event, ui) {\n        var itemAttr, itemEl, itemIndex;\n        itemEl = ui.item;\n        itemAttr = itemEl.scope().attr;\n        itemIndex = itemEl.index();\n        return $ctrl.moveCustomAttributes(itemAttr, itemIndex);\n      });\n      showCreateForm = function() {\n        $el.find(\".js-new-custom-field\").removeClass(\"hidden\");\n        return $el.find(\".js-new-custom-field input:visible\").first().focus();\n      };\n      hideCreateForm = function() {\n        return $el.find(\".js-new-custom-field\").addClass(\"hidden\");\n      };\n      showAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").addClass(\"hidden\");\n      };\n      showCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").addClass(\"hidden\");\n      };\n      resetNewAttr = function() {\n        return $scope.newAttr = {};\n      };\n      create = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideCreateForm();\n            resetNewAttr();\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = $scope.newAttr;\n        attr.project = $scope.projectId;\n        attr.order = $scope.maxOrder ? $scope.maxOrder + 1 : 1;\n        return $ctrl.createCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelCreate = function() {\n        hideCreateForm();\n        return resetNewAttr();\n      };\n      $scope.$watch(\"customAttributes\", function(customAttributes) {\n        if (!customAttributes) {\n          return;\n        }\n        if (customAttributes.length === 0) {\n          hideCancelButton();\n          hideAddButton();\n          return showCreateForm();\n        } else {\n          hideCreateForm();\n          showAddButton();\n          return showCancelButton();\n        }\n      });\n      $el.on(\"click\", \".js-add-custom-field-button\", function(event) {\n        event.preventDefault();\n        return showCreateForm();\n      });\n      $el.on(\"click\", \".js-create-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return create(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-new-custom-field-button\", function(event) {\n        event.preventDefault();\n        return cancelCreate();\n      });\n      $el.on(\"keyup\", \".js-new-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return create(formEl);\n        } else if (event.keyCode === 27) {\n          return cancelCreate();\n        }\n      });\n      showEditForm = function(formEl) {\n        formEl.find(\".js-view-custom-field\").addClass(\"hidden\");\n        formEl.find(\".js-edit-custom-field\").removeClass(\"hidden\");\n        return formEl.find(\".js-edit-custom-field input:visible\").first().focus().select();\n      };\n      hideEditForm = function(formEl) {\n        formEl.find(\".js-edit-custom-field\").addClass(\"hidden\");\n        return formEl.find(\".js-view-custom-field\").removeClass(\"hidden\");\n      };\n      revertChangesInCustomAttribute = function(formEl) {\n        return $scope.$apply(function() {\n          return formEl.scope().attr.revert();\n        });\n      };\n      update = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideEditForm(formEl);\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = formEl.scope().attr;\n        return $ctrl.saveCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelUpdate = function(formEl) {\n        hideEditForm(formEl);\n        return revertChangesInCustomAttribute(formEl);\n      };\n      $el.on(\"click\", \".js-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return showEditForm(formEl);\n      });\n      $el.on(\"click\", \".js-update-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return update(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return cancelUpdate(formEl);\n      });\n      $el.on(\"keyup\", \".js-edit-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return update(formEl);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return cancelUpdate(formEl);\n        }\n      });\n      deleteCustomAttribute = function(formEl) {\n        var attr, message, text, title;\n        attr = formEl.scope().attr;\n        message = attr.name;\n        title = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.DELETE\");\n        text = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE\");\n        return $confirm.ask(title, text, message).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadCustomAttributes()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\", null, \"We have not been able to delete '\" + message + \"'.\");\n          };\n          return $ctrl.deleteCustomAttribute(attr).then(onSucces, onError);\n        });\n      };\n      return $el.on(\"click\", \".js-delete-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return deleteCustomAttribute(formEl);\n      }));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectCustomAttributes\", [\"$log\", \"$tgConfirm\", \"animationFrame\", \"$translate\", ProjectCustomAttributesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var EditRoleDirective, NewRoleDirective, RolePermissionsDirective, RolesController, RolesDirective, bindMethods, bindOnce, debounce, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  RolesController = (function(superClass) {\n    extend(RolesController, superClass);\n\n    RolesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function RolesController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this._disableComputable = bind(this._disableComputable, this);\n      this._enableComputable = bind(this._enableComputable, this);\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.MENU.PERMISSIONS\";\n      this.scope.project = {};\n      this.scope.anyComputableRole = true;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.ROLES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    RolesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.anyComputableRole = _.some(_.map(project.roles, function(point) {\n            return point.computable;\n          }));\n          return project;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadRoles = function() {\n      return this.rs.roles.list(this.scope.projectId).then((function(_this) {\n        return function(roles) {\n          var public_permission;\n          roles = roles.map(function(role) {\n            role.external_user = false;\n            return role;\n          });\n          public_permission = {\n            \"name\": _this.translate.instant(\"ADMIN.ROLES.EXTERNAL_USER\"),\n            \"permissions\": _this.scope.project.public_permissions,\n            \"external_user\": true\n          };\n          roles.push(public_permission);\n          _this.scope.roles = roles;\n          _this.scope.role = _this.scope.roles[0];\n          return roles;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadRoles();\n        };\n      })(this));\n      return promise;\n    };\n\n    RolesController.prototype.setRole = function(role) {\n      this.scope.role = role;\n      return this.scope.$broadcast(\"role:changed\", this.scope.role);\n    };\n\n    RolesController.prototype[\"delete\"] = function() {\n      var choices, i, len, ref, replacement, role, subtitle, title, warning;\n      choices = {};\n      ref = this.scope.roles;\n      for (i = 0, len = ref.length; i < len; i++) {\n        role = ref[i];\n        if (role.id !== this.scope.role.id) {\n          choices[role.id] = role.name;\n        }\n      }\n      if (_.keys(choices).length === 0) {\n        return this.confirm.error(this.translate.instant(\"ADMIN.ROLES.ERROR_DELETE_ALL\"));\n      }\n      title = this.translate.instant(\"ADMIN.ROLES.TITLE_DELETE_ROLE\");\n      subtitle = this.scope.role.name;\n      replacement = this.translate.instant(\"ADMIN.ROLES.REPLACEMENT_ROLE\");\n      warning = this.translate.instant(\"ADMIN.ROLES.WARNING_DELETE_ROLE\");\n      return this.confirm.askChoice(title, subtitle, choices, replacement, warning).then((function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            _this.loadProject();\n            return _this.loadRoles()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return _this.confirm.notify('error');\n          };\n          return _this.repo.remove(_this.scope.role, {\n            moveTo: response.selected\n          }).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    RolesController.prototype._enableComputable = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"success\");\n          return _this.loadProject();\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.scope.role.revert();\n        };\n      })(this);\n      return this.repo.save(this.scope.role).then(onSuccess, onError);\n    };\n\n    RolesController.prototype._disableComputable = function() {\n      var askOnError, askOnSuccess, message, subtitle, title;\n      askOnSuccess = (function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            response.finish();\n            _this.confirm.notify(\"success\");\n            return _this.loadProject();\n          };\n          onError = function() {\n            response.finish();\n            _this.confirm.notify(\"error\");\n            return _this.scope.role.revert();\n          };\n          return _this.repo.save(_this.scope.role).then(onSuccess, onError);\n        };\n      })(this);\n      askOnError = (function(_this) {\n        return function(response) {\n          return _this.scope.role.revert();\n        };\n      })(this);\n      title = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE\");\n      subtitle = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE\", {\n        roleName: this.scope.role.name\n      });\n      message = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_MESSAGE\");\n      return this.confirm.ask(title, subtitle, message).then(askOnSuccess, askOnError);\n    };\n\n    RolesController.prototype.toggleComputable = debounce(2000, function() {\n      if (!this.scope.role.computable) {\n        return this._disableComputable();\n      } else {\n        return this._enableComputable();\n      }\n    });\n\n    return RolesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"RolesController\", RolesController);\n\n  EditRoleDirective = function($repo, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, toggleView;\n      toggleView = function() {\n        $el.find('.total').toggle();\n        return $el.find('.edit-role').toggle();\n      };\n      submit = function() {\n        var promise;\n        $scope.role.name = $el.find(\"input\").val();\n        promise = $repo.save($scope.role);\n        promise.then(function() {\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function(data) {\n          return $confirm.notify(\"error\");\n        });\n        return toggleView();\n      };\n      $el.on(\"click\", \"a.icon-edit\", function() {\n        toggleView();\n        $el.find(\"input\").focus();\n        return $el.find(\"input\").val($scope.role.name);\n      });\n      $el.on(\"click\", \"a.save\", submit);\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return submit();\n        } else if (event.keyCode === 27) {\n          return toggleView();\n        }\n      });\n      $scope.$on(\"role:changed\", function() {\n        if ($el.find('.edit-role').is(\":visible\")) {\n          return toggleView();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgEditRole\", [\"$tgRepo\", \"$tgConfirm\", EditRoleDirective]);\n\n  RolesDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRoles\", RolesDirective);\n\n  NewRoleDirective = function($tgrepo, $confirm) {\n    var DEFAULT_PERMISSIONS, link;\n    DEFAULT_PERMISSIONS = [\"view_project\", \"view_milestones\", \"view_us\", \"view_tasks\", \"view_issues\"];\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \"a.add-button\", function(event) {\n        event.preventDefault();\n        $el.find(\".new\").removeClass(\"hidden\");\n        $el.find(\".new\").focus();\n        return $el.find(\".add-button\").hide();\n      });\n      return $el.on(\"keyup\", \".new\", function(event) {\n        var newRole, onError, onSuccess, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newRole = {\n            project: $scope.projectId,\n            name: target.val(),\n            permissions: DEFAULT_PERMISSIONS,\n            order: _.max($scope.roles, function(r) {\n              return r.order;\n            }).order + 1,\n            computable: false\n          };\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          onSuccess = function(role) {\n            var insertPosition;\n            insertPosition = $scope.roles.length - 1;\n            $scope.roles.splice(insertPosition, 0, role);\n            $ctrl.setRole(role);\n            $el.find(\".add-button\").show();\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $tgrepo.create(\"roles\", newRole).then(onSuccess, onError);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          return $el.find(\".add-button\").show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewRole\", [\"$tgRepo\", \"$tgConfirm\", NewRoleDirective]);\n\n  RolePermissionsDirective = function($rootscope, $repo, $confirm, $compile) {\n    var baseTemplate, categoryTemplate, link, resumeTemplate;\n    resumeTemplate = _.template(\"<div class=\\\"resume-title\\\" translate=\\\"<%- category.name %>\\\"></div>\\n<div class=\\\"summary-role\\\">\\n    <div class=\\\"count\\\"><%- category.activePermissions %>/<%- category.permissions.length %></div>\\n    <% _.each(category.permissions, function(permission) { %>\\n        <div class=\\\"role-summary-single <% if(permission.active) { %>active<% } %>\\\"\\n             title=\\\"{{ '<%- permission.name %>' | translate }}\\\"></div>\\n    <% }) %>\\n</div>\\n<div class=\\\"icon icon-arrow-bottom\\\"></div>\");\n    categoryTemplate = _.template(\"<div class=\\\"category-config\\\" data-id=\\\"<%- index %>\\\">\\n    <div class=\\\"resume\\\">\\n    </div>\\n    <div class=\\\"category-items\\\">\\n        <div class=\\\"items-container\\\">\\n        <% _.each(category.permissions, function(permission) { %>\\n            <div class=\\\"category-item\\\" data-id=\\\"<%- permission.key %>\\\">\\n                <span translate=\\\"<%- permission.name %>\\\"></span>\\n                <div class=\\\"check\\\">\\n                    <input type=\\\"checkbox\\\"\\n                           <% if(!permission.editable) { %> disabled=\\\"disabled\\\" <% } %>\\n                           <% if(permission.active) { %> checked=\\\"checked\\\" <% } %>/>\\n                    <div></div>\\n                    <span class=\\\"check-text check-yes\\\" translate=\\\"COMMON.YES\\\"></span>\\n                    <span class=\\\"check-text check-no\\\" translate=\\\"COMMON.NO\\\"></span>\\n                </div>\\n            </div>\\n        <% }) %>\\n        </div>\\n    </div>\\n</div>\");\n    baseTemplate = _.template(\"<div class=\\\"category-config-list\\\"></div>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, generateCategoriesFromRole, renderCategory, renderPermissions, renderResume;\n      $ctrl = $el.controller();\n      generateCategoriesFromRole = function(role) {\n        var categories, isPermissionEditable, issuePermissions, milestonePermissions, setActivePermissions, setActivePermissionsPerCategory, taskPermissions, userStoryPermissions, wikiPermissions;\n        setActivePermissions = function(permissions) {\n          return _.map(permissions, function(x) {\n            var ref;\n            return _.extend({}, x, {\n              active: (ref = x[\"key\"], indexOf.call(role.permissions, ref) >= 0)\n            });\n          });\n        };\n        isPermissionEditable = function(permission, role, project) {\n          if (role.external_user && !project.is_private && permission.key.indexOf(\"view_\") === 0) {\n            return false;\n          } else {\n            return true;\n          }\n        };\n        setActivePermissionsPerCategory = function(category) {\n          return _.map(category, function(cat) {\n            cat.permissions = cat.permissions.map(function(permission) {\n              permission.editable = isPermissionEditable(permission, role, $scope.project);\n              return permission;\n            });\n            return _.extend({}, cat, {\n              activePermissions: _.filter(cat[\"permissions\"], \"active\").length\n            });\n          });\n        };\n        categories = [];\n        milestonePermissions = [\n          {\n            key: \"view_milestones\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS\"\n          }, {\n            key: \"add_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS\"\n          }, {\n            key: \"modify_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS\"\n          }, {\n            key: \"delete_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME\",\n          permissions: setActivePermissions(milestonePermissions)\n        });\n        userStoryPermissions = [\n          {\n            key: \"view_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES\"\n          }, {\n            key: \"add_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES\"\n          }, {\n            key: \"modify_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES\"\n          }, {\n            key: \"delete_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME\",\n          permissions: setActivePermissions(userStoryPermissions)\n        });\n        taskPermissions = [\n          {\n            key: \"view_tasks\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS\"\n          }, {\n            key: \"add_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS\"\n          }, {\n            key: \"modify_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS\"\n          }, {\n            key: \"delete_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME\",\n          permissions: setActivePermissions(taskPermissions)\n        });\n        issuePermissions = [\n          {\n            key: \"view_issues\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES\"\n          }, {\n            key: \"add_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES\"\n          }, {\n            key: \"modify_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES\"\n          }, {\n            key: \"delete_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME\",\n          permissions: setActivePermissions(issuePermissions)\n        });\n        wikiPermissions = [\n          {\n            key: \"view_wiki_pages\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES\"\n          }, {\n            key: \"add_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES\"\n          }, {\n            key: \"modify_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES\"\n          }, {\n            key: \"delete_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES\"\n          }, {\n            key: \"view_wiki_links\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS\"\n          }, {\n            key: \"add_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS\"\n          }, {\n            key: \"delete_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME\",\n          permissions: setActivePermissions(wikiPermissions)\n        });\n        return setActivePermissionsPerCategory(categories);\n      };\n      renderResume = function(element, category) {\n        return element.find(\".resume\").html($compile(resumeTemplate({\n          category: category\n        }))($scope));\n      };\n      renderCategory = function(category, index) {\n        var html;\n        html = categoryTemplate({\n          category: category,\n          index: index\n        });\n        html = angular.element(html);\n        renderResume(html, category);\n        return $compile(html)($scope);\n      };\n      renderPermissions = function() {\n        var html;\n        $el.off();\n        html = baseTemplate();\n        _.each(generateCategoriesFromRole($scope.role), function(category, index) {\n          return html = angular.element(html).append(renderCategory(category, index));\n        });\n        $el.html(html);\n        $el.on(\"click\", \".resume\", function(event) {\n          var target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          return target.next().toggleClass(\"open\");\n        });\n        return $el.on(\"change\", \".category-item input\", function(event) {\n          var getActivePermissions, onError, onSuccess, target;\n          getActivePermissions = function() {\n            var activePermissions;\n            activePermissions = _.filter($el.find(\".category-item input\"), function(t) {\n              return angular.element(t).is(\":checked\");\n            });\n            activePermissions = _.sortBy(_.map(activePermissions, function(t) {\n              var permission;\n              return permission = angular.element(t).parents(\".category-item\").data(\"id\");\n            }));\n            if (activePermissions.length) {\n              activePermissions.push(\"view_project\");\n            }\n            return activePermissions;\n          };\n          target = angular.element(event.currentTarget);\n          $scope.role.permissions = getActivePermissions();\n          onSuccess = function() {\n            var categories, categoryId;\n            categories = generateCategoriesFromRole($scope.role);\n            categoryId = target.parents(\".category-config\").data(\"id\");\n            renderResume(target.parents(\".category-config\"), categories[categoryId]);\n            $rootscope.$broadcast(\"projects:reload\");\n            $confirm.notify(\"success\");\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            target.prop(\"checked\", !target.prop(\"checked\"));\n            return $scope.role.permissions = getActivePermissions();\n          };\n          if ($scope.role.external_user) {\n            $scope.project.public_permissions = $scope.role.permissions;\n            $scope.project.anon_permissions = $scope.role.permissions.filter(function(permission) {\n              return permission.indexOf(\"view_\") === 0;\n            });\n            return $repo.save($scope.project).then(onSuccess, onError);\n          } else {\n            return $repo.save($scope.role).then(onSuccess, onError);\n          }\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $scope.$on(\"role:changed\", function() {\n        return renderPermissions();\n      });\n      return bindOnce($scope, $attrs.ngModel, renderPermissions);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRolePermissions\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", RolePermissionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/third-parties.coffee\n */\n\n(function() {\n  var BitbucketController, BitbucketWebhooksDirective, GithubController, GithubWebhooksDirective, GitlabController, GitlabWebhooksDirective, NewWebhookDirective, SelectInputText, ValidOriginIpsDirective, WebhookDirective, WebhooksController, bindMethods, debounce, mixOf, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  debounce = this.taiga.debounce;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaAdmin\");\n\n  WebhooksController = (function(superClass) {\n    extend(WebhooksController, superClass);\n\n    WebhooksController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function WebhooksController(scope, repo, rs, params, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.WEBHOOKS.SECTION_NAME\";\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.WEBHOOKS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"webhooks:reload\", this.loadWebhooks);\n    }\n\n    WebhooksController.prototype.loadWebhooks = function() {\n      return this.rs.webhooks.list(this.scope.projectId).then((function(_this) {\n        return function(webhooks) {\n          return _this.scope.webhooks = webhooks;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadWebhooks();\n        };\n      })(this));\n      return promise;\n    };\n\n    return WebhooksController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"WebhooksController\", WebhooksController);\n\n  WebhookDirective = function($rs, $repo, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var cancel, openHistory, save, showEditMode, showVisualizationMode, updateLogs, updateShowHideHistoryText, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      updateLogs = function() {\n        var prettyDate;\n        prettyDate = $translate.instant(\"ADMIN.WEBHOOKS.DATE\");\n        return $rs.webhooklogs.list(webhook.id).then((function(_this) {\n          return function(webhooklogs) {\n            var i, len, log, ref;\n            for (i = 0, len = webhooklogs.length; i < len; i++) {\n              log = webhooklogs[i];\n              log.validStatus = (200 <= (ref = log.status) && ref < 300);\n              log.prettySentHeaders = _.map(_.pairs(log.request_headers), function(arg) {\n                var header, value;\n                header = arg[0], value = arg[1];\n                return header + \": \" + value;\n              }).join(\"\\n\");\n              log.prettySentData = JSON.stringify(log.request_data);\n              log.prettyDate = moment(log.created).format(prettyDate);\n            }\n            webhook.logs_counter = webhooklogs.length;\n            webhook.logs = webhooklogs;\n            return updateShowHideHistoryText();\n          };\n        })(this));\n      };\n      updateShowHideHistoryText = function() {\n        var historyElement, text, textElement, title;\n        textElement = $el.find(\".toggle-history\");\n        historyElement = textElement.parents(\".single-webhook-wrapper\").find(\".webhooks-history\");\n        if (historyElement.hasClass(\"open\")) {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE\");\n        } else {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE\");\n        }\n        textElement.text(text);\n        return textElement.prop(\"title\", title);\n      };\n      showVisualizationMode = function() {\n        $el.find(\".edition-mode\").addClass(\"hidden\");\n        return $el.find(\".visualization-mode\").removeClass(\"hidden\");\n      };\n      showEditMode = function() {\n        $el.find(\".visualization-mode\").addClass(\"hidden\");\n        return $el.find(\".edition-mode\").removeClass(\"hidden\");\n      };\n      openHistory = function() {\n        return $el.find(\".webhooks-history\").addClass(\"open\");\n      };\n      cancel = function() {\n        showVisualizationMode();\n        return $scope.$apply(function() {\n          return webhook.revert();\n        });\n      };\n      save = debounce(2000, function(target) {\n        var form, promise;\n        form = target.parents(\"form\").checksley();\n        if (!form.validate()) {\n          return;\n        }\n        promise = $repo.save(webhook);\n        promise.then((function(_this) {\n          return function() {\n            return showVisualizationMode();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      $el.on(\"click\", \".test-webhook\", function() {\n        openHistory();\n        return $rs.webhooks.test(webhook.id).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".edit-webhook\", function() {\n        return showEditMode();\n      });\n      $el.on(\"click\", \".cancel-existing\", function() {\n        return cancel();\n      });\n      $el.on(\"click\", \".edit-existing\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      });\n      $el.on(\"keyup\", \".edition-mode input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return save(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".delete-webhook\", function() {\n        var message, title;\n        title = $translate.instant(\"ADMIN.WEBHOOKS.DELETE\");\n        message = $translate.instant(\"ADMIN.WEBHOOKS.WEBHOOK_NAME\", {\n          name: webhook.name\n        });\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSucces;\n            onSucces = function() {\n              askResponse.finish();\n              return $scope.$emit(\"webhooks:reload\");\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove(webhook).then(onSucces, onError);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".toggle-history\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if ((webhook.logs == null) || webhook.logs.length === 0) {\n          return updateLogs().then(function() {\n            return timeout(0, function() {\n              $el.find(\".webhooks-history\").toggleClass(\"open\");\n              return updateShowHideHistoryText();\n            });\n          });\n        } else {\n          $el.find(\".webhooks-history\").toggleClass(\"open\");\n          return $scope.$apply(function() {\n            return updateShowHideHistoryText();\n          });\n        }\n      });\n      $el.on(\"click\", \".history-single\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"history-single-open\");\n        return target.siblings(\".history-single-response\").toggleClass(\"open\");\n      });\n      return $el.on(\"click\", \".resend-request\", function(event) {\n        var log, target;\n        target = angular.element(event.currentTarget);\n        log = target.data(\"log\");\n        return $rs.webhooklogs.resend(log).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", WebhookDirective]);\n\n  NewWebhookDirective = function($rs, $repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var addWebhookDOMNode, formDOMNode, initializeNewValue, save, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      formDOMNode = $el.find(\".new-webhook-form\");\n      addWebhookDOMNode = $el.find(\".add-webhook\");\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"url\": \"\",\n          \"key\": \"\"\n        };\n      };\n      initializeNewValue();\n      $scope.$watch(\"webhooks\", function(webhooks) {\n        if (webhooks != null) {\n          if (webhooks.length === 0) {\n            formDOMNode.removeClass(\"hidden\");\n            addWebhookDOMNode.addClass(\"hidden\");\n            return formDOMNode.find(\"input\")[0].focus();\n          } else {\n            formDOMNode.addClass(\"hidden\");\n            return addWebhookDOMNode.removeClass(\"hidden\");\n          }\n        }\n      });\n      save = debounce(2000, function() {\n        var form, promise;\n        form = formDOMNode.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        promise = $repo.create(\"webhooks\", $scope.newValue);\n        promise.then((function(_this) {\n          return function() {\n            $scope.$emit(\"webhooks:reload\");\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      formDOMNode.on(\"click\", \".add-new\", function(event) {\n        event.preventDefault();\n        return save();\n      });\n      formDOMNode.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return save();\n        }\n      });\n      formDOMNode.on(\"click\", \".cancel-new\", function(event) {\n        return $scope.$apply(function() {\n          return initializeNewValue();\n        });\n      });\n      return addWebhookDOMNode.on(\"click\", function(event) {\n        formDOMNode.removeClass(\"hidden\");\n        return formDOMNode.find(\"input\")[0].focus();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", NewWebhookDirective]);\n\n  GithubController = (function(superClass) {\n    extend(GithubController, superClass);\n\n    GithubController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GithubController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITHUB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITHUB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GithubController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"github\").then((function(_this) {\n        return function(github) {\n          return _this.scope.github = github;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GithubController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GithubController\", GithubController);\n\n  GitlabController = (function(superClass) {\n    extend(GitlabController, superClass);\n\n    GitlabController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GitlabController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITLAB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITLAB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    GitlabController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gitlab\").then((function(_this) {\n        return function(gitlab) {\n          return _this.scope.gitlab = gitlab;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GitlabController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GitlabController\", GitlabController);\n\n  BitbucketController = (function(superClass) {\n    extend(BitbucketController, superClass);\n\n    BitbucketController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function BitbucketController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.BITBUCKET.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.BITBUCKET.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    BitbucketController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"bitbucket\").then((function(_this) {\n        return function(bitbucket) {\n          return _this.scope.bitbucket = bitbucket;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return BitbucketController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BitbucketController\", BitbucketController);\n\n  SelectInputText = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".select-input-content\", function() {\n        $el.find(\"input\").select();\n        return $el.find(\".help-copy\").addClass(\"visible\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSelectInputText\", SelectInputText);\n\n  GithubWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.github, \"github\");\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGithubWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GithubWebhooksDirective]);\n\n  GitlabWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gitlab, \"gitlab\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGitlabWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GitlabWebhooksDirective]);\n\n  BitbucketWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.bitbucket, \"bitbucket\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBitbucketWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", BitbucketWebhooksDirective]);\n\n  ValidOriginIpsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $ngModel) {\n      return $ngModel.$parsers.push(function(value) {\n        value = $.trim(value);\n        if (value === \"\") {\n          return [];\n        }\n        return value.split(\",\");\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgValidOriginIps\", ValidOriginIpsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var CreateProject, DeleteProjectDirective, bindOnce, debounce, module, taiga, timeout;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaProject\");\n\n  CreateProject = function($rootscope, $repo, $confirm, $location, $navurls, $rs, $projectUrl, $loading, lightboxService, $cacheFactory, $translate, currentUserService) {\n    var directive, link;\n    link = function($scope, $el, attrs) {\n      var currentLoading, form, onErrorSubmit, onSuccessSubmit, openLightbox, submit, submitButton;\n      $scope.data = {};\n      $scope.templates = [];\n      currentLoading = null;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      onSuccessSubmit = function(response) {\n        $cacheFactory.get('$http').removeAll();\n        currentLoading.finish();\n        $rootscope.$broadcast(\"projects:reload\");\n        $confirm.notify(\"success\", $translate.instant(\"COMMON.SAVE\"));\n        $location.url($projectUrl.get(response));\n        lightboxService.close($el);\n        return currentUserService.loadProjects();\n      };\n      onErrorSubmit = function(response) {\n        var error_field, error_step, i, len, ref, selectors;\n        currentLoading.finish();\n        form.setErrors(response);\n        selectors = [];\n        ref = _.keys(response);\n        for (i = 0, len = ref.length; i < len; i++) {\n          error_field = ref[i];\n          selectors.push(\"[name=\" + error_field + \"]\");\n        }\n        $el.find(\".active\").removeClass(\"active\");\n        error_step = $el.find(selectors.join(\",\")).first().parents(\".wizard-step\");\n        error_step.addClass(\"active\");\n        return $el.find('.progress-bar').removeClass().addClass('progress-bar').addClass(error_step.data(\"step\"));\n      };\n      submit = (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"projects\", $scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this);\n      openLightbox = function() {\n        $scope.data = {};\n        if (!$scope.templates.length) {\n          $rs.projects.templates().then((function(_this) {\n            return function(result) {\n              $scope.templates = result;\n              return $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n                return x.slug === \"scrum\";\n              })).id;\n            };\n          })(this));\n        } else {\n          $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n            return x.slug === \"scrum\";\n          })).id;\n        }\n        $el.find(\".active\").removeClass(\"active\");\n        $el.find(\".create-step1\").addClass(\"active\");\n        lightboxService.open($el);\n        return timeout(600, function() {\n          return $el.find(\".progress-bar\").addClass('step1');\n        });\n      };\n      $el.on(\"click\", \".button-next\", function(event) {\n        var current, field, i, len, next, ref, step, valid;\n        event.preventDefault();\n        current = $el.find(\".active\");\n        valid = true;\n        ref = form.fields;\n        for (i = 0, len = ref.length; i < len; i++) {\n          field = ref[i];\n          if (current.find(\"[name=\" + (field.element.attr('name')) + \"]\").length) {\n            valid = field.validate() !== false && valid;\n          }\n        }\n        if (!valid) {\n          return;\n        }\n        next = current.next();\n        current.toggleClass('active');\n        next.toggleClass('active');\n        step = next.data('step');\n        return $el.find('.progress-bar').removeClass().addClass('progress-bar').addClass(step);\n      });\n      $el.on(\"click\", \".button-prev\", function(event) {\n        var current, prev, step;\n        event.preventDefault();\n        current = $el.find(\".active\");\n        prev = current.prev();\n        current.toggleClass('active');\n        prev.toggleClass('active');\n        step = prev.data('step');\n        return $el.find('.progress-bar').removeClass().addClass('progress-bar').addClass(step);\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"project/wizard-create-project.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbCreateProject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$tgResources\", \"$projectUrl\", \"$tgLoading\", \"lightboxService\", \"$cacheFactory\", \"$translate\", \"tgCurrentUserService\", CreateProject]);\n\n  DeleteProjectDirective = function($repo, $rootscope, $auth, $location, $navUrls, $confirm, lightboxService, tgLoader, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var projectToDelete, submit;\n      projectToDelete = null;\n      $scope.$on(\"deletelightbox:new\", function(ctx, project) {\n        lightboxService.open($el);\n        return projectToDelete = project;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        tgLoader.start();\n        lightboxService.close($el);\n        promise = $repo.remove(projectToDelete);\n        promise.then(function(data) {\n          tgLoader.pageLoaded();\n          $rootscope.$broadcast(\"projects:reload\");\n          $location.path($navUrls.resolve(\"home\"));\n          $confirm.notify(\"success\");\n          return currentUserService.loadProjects();\n        });\n        return promise.then(null, function() {\n          $confirm.notify(\"error\");\n          return lightboxService.close($el);\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDeleteProject\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfirm\", \"lightboxService\", \"tgLoader\", \"tgCurrentUserService\", DeleteProjectDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/bind.coffee\n */\n\n(function() {\n  var BindHtmlDirective, BindOnceAltDirective, BindOnceBindDirective, BindOnceHrefDirective, BindOnceHtmlDirective, BindOnceRefDirective, BindOnceSrcDirective, BindOnceTitleDirective, BindTitleDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  BindOnceBindDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoBind, function(val) {\n        return $el.text(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHtml, function(val) {\n        return $el.html(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceRefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoRef, function(val) {\n        return $el.html(\"#\" + val + \" \");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceSrcDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoSrc, function(val) {\n        return $el.attr(\"src\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHrefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHref, function(val) {\n        return $el.attr(\"href\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceAltDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoAlt, function(val) {\n        return $el.attr(\"alt\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoTitle, function(val) {\n        return $el.attr(\"title\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgTitleHtml, function(val) {\n        if (val != null) {\n          return $el.attr(\"title\", val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgBindHtml, function(val) {\n        if (val != null) {\n          return $el.html(val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.directive(\"tgBoBind\", BindOnceBindDirective);\n\n  module.directive(\"tgBoHtml\", BindOnceHtmlDirective);\n\n  module.directive(\"tgBoRef\", BindOnceRefDirective);\n\n  module.directive(\"tgBoSrc\", BindOnceSrcDirective);\n\n  module.directive(\"tgBoHref\", BindOnceHrefDirective);\n\n  module.directive(\"tgBoAlt\", BindOnceAltDirective);\n\n  module.directive(\"tgBoTitle\", BindOnceTitleDirective);\n\n  module.directive(\"tgBindTitle\", BindTitleDirective);\n\n  module.directive(\"tgBindHtml\", BindHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/conf.coffee\n */\n\n(function() {\n  var ConfigurationService, module;\n\n  ConfigurationService = (function() {\n    function ConfigurationService() {\n      this.config = window.taigaConfig;\n    }\n\n    ConfigurationService.prototype.get = function(key, defaultValue) {\n      if (defaultValue == null) {\n        defaultValue = null;\n      }\n      if (_.has(this.config, key)) {\n        return this.config[key];\n      }\n      return defaultValue;\n    };\n\n    return ConfigurationService;\n\n  })();\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgConfig\", ConfigurationService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/contrib.coffee\n */\n\n(function() {\n  var ContribController, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaBase\");\n\n  ContribController = (function(superClass) {\n    extend(ContribController, superClass);\n\n    ContribController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\"];\n\n    function ContribController(rootScope, scope, params, repo, rs, confirm) {\n      var promise;\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.scope.currentPlugin = _.first(_.where(this.rootScope.adminPlugins, {\n        \"slug\": this.params.plugin\n      }));\n      this.scope.projectSlug = this.params.pslug;\n      promise = this.loadInitialData();\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    }\n\n    ContribController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.$broadcast('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ContribController.prototype.loadInitialData = function() {\n      return this.loadProject();\n    };\n\n    return ContribController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribController\", ContribController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/filters.coffee\n */\n\n(function() {\n  var FiltersStorageService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  FiltersStorageService = (function(superClass) {\n    extend(FiltersStorageService, superClass);\n\n    FiltersStorageService.$inject = [\"$tgStorage\", \"$routeParams\"];\n\n    function FiltersStorageService(storage, params) {\n      this.storage = storage;\n      this.params = params;\n    }\n\n    FiltersStorageService.prototype.generateHash = function(components) {\n      if (components == null) {\n        components = [];\n      }\n      components = _.map(components, function(x) {\n        return JSON.stringify(x);\n      });\n      return hex_sha1(components.join(\":\"));\n    };\n\n    return FiltersStorageService;\n\n  })(taiga.Service);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var HttpService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  HttpService = (function(superClass) {\n    extend(HttpService, superClass);\n\n    HttpService.$inject = [\"$http\", \"$q\", \"$tgStorage\", \"$rootScope\", \"$cacheFactory\", \"$translate\"];\n\n    function HttpService(http, q, storage, rootScope, cacheFactory, translate) {\n      this.http = http;\n      this.q = q;\n      this.storage = storage;\n      this.rootScope = rootScope;\n      this.cacheFactory = cacheFactory;\n      this.translate = translate;\n      HttpService.__super__.constructor.call(this);\n      this.cache = this.cacheFactory(\"httpget\");\n    }\n\n    HttpService.prototype.headers = function() {\n      var headers, lang, token;\n      headers = {};\n      token = this.storage.get('token');\n      if (token) {\n        headers[\"Authorization\"] = \"Bearer \" + token;\n      }\n      lang = this.translate.preferredLanguage();\n      if (lang) {\n        headers[\"Accept-Language\"] = lang;\n      }\n      return headers;\n    };\n\n    HttpService.prototype.request = function(options) {\n      options.headers = _.merge({}, options.headers || {}, this.headers());\n      return this.http(options);\n    };\n\n    HttpService.prototype.get = function(url, params, options) {\n      options = _.merge({\n        method: \"GET\",\n        url: url\n      }, options);\n      if (params) {\n        options.params = params;\n      }\n      options.cache = this.cache;\n      return this.request(options)[\"finally\"]((function(_this) {\n        return function(data) {\n          return _this.cache.removeAll();\n        };\n      })(this));\n    };\n\n    HttpService.prototype.post = function(url, data, params, options) {\n      options = _.merge({\n        method: \"POST\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.put = function(url, data, params, options) {\n      options = _.merge({\n        method: \"PUT\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.patch = function(url, data, params, options) {\n      options = _.merge({\n        method: \"PATCH\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype[\"delete\"] = function(url, data, params, options) {\n      options = _.merge({\n        method: \"DELETE\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    return HttpService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgHttp\", HttpService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/location.coffee\n */\n\n(function() {\n  var locationFactory, module;\n\n  locationFactory = function($location, $route, $rootscope) {\n    $location.noreload = function(scope) {\n      var lastRoute, un;\n      lastRoute = $route.current;\n      un = scope.$on(\"$locationChangeSuccess\", function() {\n        $route.current = lastRoute;\n        return un();\n      });\n      return $location;\n    };\n    $location.isInCurrentRouteParams = function(name, value) {\n      var params;\n      params = $location.search() || {};\n      return params[name] === value;\n    };\n    return $location;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgLocation\", [\"$location\", \"$route\", \"$rootScope\", locationFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/model.coffee\n */\n\n(function() {\n  var Model, ModelService, module, provider, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    function Model(name, data, dataTypes) {\n      this._attrs = data;\n      this._name = name;\n      this._dataTypes = dataTypes;\n      this.setAttrs(data);\n      this.initialize();\n    }\n\n    Model.prototype.clone = function() {\n      var instance;\n      instance = new Model(this._name, this._attrs, this._dataTypes);\n      instance._modifiedAttrs = this._modifiedAttrs;\n      instance._isModified = this._isModified;\n      return instance;\n    };\n\n    Model.prototype.applyCasts = function() {\n      var attrName, castMethod, castName, ref, results;\n      ref = this._dataTypes;\n      results = [];\n      for (attrName in ref) {\n        castName = ref[attrName];\n        castMethod = service.casts[castName];\n        if (!castMethod) {\n          continue;\n        }\n        results.push(this._attrs[attrName] = castMethod(this._attrs[attrName]));\n      }\n      return results;\n    };\n\n    Model.prototype.getIdAttrName = function() {\n      return \"id\";\n    };\n\n    Model.prototype.getName = function() {\n      return this._name;\n    };\n\n    Model.prototype.getAttrs = function(patch) {\n      if (patch == null) {\n        patch = false;\n      }\n      if (this._attrs.version != null) {\n        this._modifiedAttrs.version = this._attrs.version;\n      }\n      if (patch) {\n        return _.extend({}, this._modifiedAttrs);\n      }\n      return _.extend({}, this._attrs, this._modifiedAttrs);\n    };\n\n    Model.prototype.setAttrs = function(attrs) {\n      this._attrs = attrs;\n      this._modifiedAttrs = {};\n      this.applyCasts();\n      return this._isModified = false;\n    };\n\n    Model.prototype.setAttr = function(name, value) {\n      this._modifiedAttrs[name] = value;\n      return this._isModified = true;\n    };\n\n    Model.prototype.initialize = function() {\n      var getter, self, setter;\n      self = this;\n      getter = function(name) {\n        return function() {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            return self[name];\n          }\n          if (indexOf.call(_.keys(self._modifiedAttrs), name) < 0) {\n            return self._attrs[name];\n          }\n          return self._modifiedAttrs[name];\n        };\n      };\n      setter = function(name) {\n        return function(value) {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            self[name] = value;\n            return;\n          }\n          if (self._attrs[name] !== value) {\n            self._modifiedAttrs[name] = value;\n            self._isModified = true;\n          } else {\n            delete self._modifiedAttrs[name];\n          }\n        };\n      };\n      return _.each(this._attrs, function(value, name) {\n        var options;\n        options = {\n          get: getter(name),\n          set: setter(name),\n          enumerable: true,\n          configurable: true\n        };\n        return Object.defineProperty(self, name, options);\n      });\n    };\n\n    Model.prototype.serialize = function() {\n      var data;\n      data = {\n        \"data\": _.clone(this._attrs),\n        \"name\": this._name\n      };\n      return JSON.stringify(data);\n    };\n\n    Model.prototype.isModified = function() {\n      return this._isModified;\n    };\n\n    Model.prototype.isAttributeModified = function(attribute) {\n      return this._modifiedAttrs[attribute] != null;\n    };\n\n    Model.prototype.markSaved = function() {\n      this._isModified = false;\n      this._attrs = this.getAttrs();\n      return this._modifiedAttrs = {};\n    };\n\n    Model.prototype.revert = function() {\n      this._modifiedAttrs = {};\n      return this._isModified = false;\n    };\n\n    Model.desSerialize = function(sdata) {\n      var ddata, model;\n      ddata = JSON.parse(sdata);\n      model = new Model(ddata.url, ddata.data);\n      return model;\n    };\n\n    return Model;\n\n  })();\n\n  taiga = this.taiga;\n\n  ModelService = (function(superClass) {\n    extend(ModelService, superClass);\n\n    ModelService.$inject = [\"$q\", \"$tgUrls\", \"$tgStorage\", \"$tgHttp\"];\n\n    function ModelService(q, urls, storage, http) {\n      this.q = q;\n      this.urls = urls;\n      this.storage = storage;\n      this.http = http;\n      ModelService.__super__.constructor.call(this);\n    }\n\n    return ModelService;\n\n  })(taiga.Service);\n\n  provider = function($q, $http, $gmUrls, $gmStorage) {\n    var service;\n    service = {};\n    service.make_model = function(name, data, cls, dataTypes) {\n      if (cls == null) {\n        cls = Model;\n      }\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      return new cls(name, data, dataTypes);\n    };\n    service.cls = Model;\n    service.casts = {\n      int: function(value) {\n        return parseInt(value, 10);\n      },\n      float: function(value) {\n        return parseFloat(value, 10);\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgModel\", [\"$q\", \"$http\", \"$tgUrls\", \"$tgStorage\", provider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/navurl.coffee\n */\n\n(function() {\n  var NavigationUrlsDirective, NavigationUrlsService, bindOnce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\");\n\n  NavigationUrlsService = (function(superClass) {\n    extend(NavigationUrlsService, superClass);\n\n    function NavigationUrlsService() {\n      this.urls = {};\n    }\n\n    NavigationUrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge({}, this.urls, urls || {});\n    };\n\n    NavigationUrlsService.prototype.formatUrl = function(url, ctx) {\n      var replacer;\n      if (ctx == null) {\n        ctx = {};\n      }\n      replacer = function(match) {\n        match = trim(match, \":\");\n        return ctx[match] || \"undefined\";\n      };\n      return url.replace(/(:\\w+)/g, replacer);\n    };\n\n    NavigationUrlsService.prototype.resolve = function(name, ctx) {\n      var url;\n      url = this.urls[name];\n      if (!url) {\n        return \"\";\n      }\n      if (ctx) {\n        return this.formatUrl(url, ctx);\n      }\n      return url;\n    };\n\n    return NavigationUrlsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgNavUrls\", NavigationUrlsService);\n\n  NavigationUrlsDirective = function($navurls, $auth, $q, $location) {\n    var bindOnceP, link, parseNav;\n    bindOnceP = function($scope, attr) {\n      var defered;\n      defered = $q.defer();\n      bindOnce($scope, attr, function(v) {\n        return defered.resolve(v);\n      });\n      return defered.promise;\n    };\n    parseNav = function(data, $scope) {\n      var index, name, obj, params, promises, ref, result, values;\n      ref = _.map(data.split(\":\"), trim), name = ref[0], params = ref[1];\n      if (params) {\n        result = params.split(/(\\w+)=/);\n        result = _.filter(result, function(str) {\n          return str.length;\n        });\n        result = _.map(result, function(str) {\n          return trim(str.replace(/,$/g, ''));\n        });\n        params = [];\n        index = 0;\n        while (index < result.length) {\n          obj = {};\n          obj[result[index]] = result[index + 1];\n          params.push(obj);\n          index = index + 2;\n        }\n      } else {\n        params = [];\n      }\n      values = _.map(params, function(param) {\n        return _.values(param)[0];\n      });\n      promises = _.map(values, function(x) {\n        return bindOnceP($scope, x);\n      });\n      return $q.all(promises).then(function() {\n        var i, key, len, options, param, value;\n        options = {};\n        for (i = 0, len = params.length; i < len; i++) {\n          param = params[i];\n          key = Object.keys(param)[0];\n          value = param[key];\n          options[key] = $scope.$eval(value);\n        }\n        return [name, options];\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      if ($el.is(\"a\")) {\n        $el.attr(\"href\", \"#\");\n      }\n      $el.on(\"mouseenter\", function(event) {\n        var target;\n        target = $(event.currentTarget);\n        if (!target.data(\"fullUrl\")) {\n          return parseNav($attrs.tgNav, $scope).then(function(result) {\n            var fullUrl, getURLParams, getURLParamsStr, name, options, url, user;\n            name = result[0], options = result[1];\n            user = $auth.getUser();\n            if (user) {\n              options.user = user.username;\n            }\n            url = $navurls.resolve(name);\n            fullUrl = $navurls.formatUrl(url, options);\n            if ($attrs.tgNavGetParams) {\n              getURLParams = JSON.parse($attrs.tgNavGetParams);\n              getURLParamsStr = $.param(getURLParams);\n              fullUrl = fullUrl + \"?\" + getURLParamsStr;\n            }\n            target.data(\"fullUrl\", fullUrl);\n            if (target.is(\"a\")) {\n              target.attr(\"href\", fullUrl);\n            }\n            return $el.on(\"click\", function(event) {\n              if (event.metaKey || event.ctrlKey) {\n                return;\n              }\n              event.preventDefault();\n              target = $(event.currentTarget);\n              if (target.hasClass('noclick')) {\n                return;\n              }\n              fullUrl = target.data(\"fullUrl\");\n              switch (event.which) {\n                case 1:\n                  $location.url(fullUrl);\n                  return $scope.$apply();\n                case 2:\n                  return window.open(fullUrl);\n              }\n            });\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNav\", [\"$tgNavUrls\", \"$tgAuth\", \"$q\", \"$tgLocation\", NavigationUrlsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/repository.coffee\n */\n\n(function() {\n  var RepositoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  RepositoryService = (function(superClass) {\n    extend(RepositoryService, superClass);\n\n    RepositoryService.$inject = [\"$q\", \"$tgModel\", \"$tgStorage\", \"$tgHttp\", \"$tgUrls\"];\n\n    function RepositoryService(q, model1, storage, http, urls) {\n      this.q = q;\n      this.model = model1;\n      this.storage = storage;\n      this.http = http;\n      this.urls = urls;\n      RepositoryService.__super__.constructor.call(this);\n    }\n\n    RepositoryService.prototype.resolveUrlForModel = function(model) {\n      var idAttrName;\n      idAttrName = model.getIdAttrName();\n      return (this.urls.resolve(model.getName())) + \"/\" + model[idAttrName];\n    };\n\n    RepositoryService.prototype.resolveUrlForAttributeModel = function(model) {\n      return this.urls.resolve(model.getName(), model.parent);\n    };\n\n    RepositoryService.prototype.create = function(name, data, dataTypes, extraParams) {\n      var defered, promise, url;\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      defered = this.q.defer();\n      url = this.urls.resolve(name);\n      promise = this.http.post(url, JSON.stringify(data));\n      promise.success((function(_this) {\n        return function(_data, _status) {\n          return defered.resolve(_this.model.make_model(name, _data, null, dataTypes));\n        };\n      })(this));\n      promise.error((function(_this) {\n        return function(data, status) {\n          return defered.reject(data);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.remove = function(model, params) {\n      var defered, promise, url;\n      if (params == null) {\n        params = {};\n      }\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http[\"delete\"](url, {}, params);\n      promise.success(function(data, status) {\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(model);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAll = function(models, patch) {\n      var promises;\n      if (patch == null) {\n        patch = true;\n      }\n      promises = _.map(models, (function(_this) {\n        return function(x) {\n          return _this.save(x, true);\n        };\n      })(this));\n      return this.q.all(promises);\n    };\n\n    RepositoryService.prototype.save = function(model, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForModel(model);\n      data = JSON.stringify(model.getAttrs(patch));\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAttribute = function(model, attribute, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForAttributeModel(model);\n      data = {};\n      data[attribute] = model.getAttrs();\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.refresh = function(model) {\n      var defered, promise, url;\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http.get(url);\n      promise.success(function(data, status) {\n        model._modifiedAttrs = {};\n        model._attrs = data;\n        model._isModified = false;\n        model.applyCasts();\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.queryMany = function(name, params, options, headers) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      if (headers == null) {\n        headers = false;\n      }\n      url = this.urls.resolve(name);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var result;\n          result = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          if (headers) {\n            return [result, data.headers];\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneAttribute = function(name, id, attribute, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name, id);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var model;\n          model = _this.model.make_model(name, data.data[attribute]);\n          model.parent = id;\n          return model;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOne = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return _this.model.make_model(name, data.data);\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryPaginated = function(name, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.models = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOnePaginatedRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.data = data.data;\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.resolve = function(options) {\n      var cache, params;\n      params = {};\n      if (options.pslug != null) {\n        params.project = options.pslug;\n      }\n      if (options.usref != null) {\n        params.us = options.usref;\n      }\n      if (options.taskref != null) {\n        params.task = options.taskref;\n      }\n      if (options.issueref != null) {\n        params.issue = options.issueref;\n      }\n      if (options.sslug != null) {\n        params.milestone = options.sslug;\n      }\n      if (options.wikipage != null) {\n        params.wikipage = options.wikipage;\n      }\n      cache = !(options.wikipage || options.sslug);\n      return this.queryOneRaw(\"resolver\", null, params, {\n        cache: cache\n      });\n    };\n\n    return RepositoryService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgRepo\", RepositoryService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/storage.coffee\n */\n\n(function() {\n  var StorageService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  StorageService = (function(superClass) {\n    extend(StorageService, superClass);\n\n    StorageService.$inject = [\"$rootScope\"];\n\n    function StorageService($rootScope) {\n      StorageService.__super__.constructor.call(this);\n    }\n\n    StorageService.prototype.get = function(key, _default) {\n      var serializedValue;\n      serializedValue = localStorage.getItem(key);\n      if (serializedValue === null) {\n        return _default || null;\n      }\n      return JSON.parse(serializedValue);\n    };\n\n    StorageService.prototype.set = function(key, val) {\n      if (_.isObject(key)) {\n        return _.each(key, (function(_this) {\n          return function(val, key) {\n            return _this.set(key, val);\n          };\n        })(this));\n      } else {\n        return localStorage.setItem(key, JSON.stringify(val));\n      }\n    };\n\n    StorageService.prototype.contains = function(key) {\n      var value;\n      value = this.get(key);\n      return value !== null;\n    };\n\n    StorageService.prototype.remove = function(key) {\n      return localStorage.removeItem(key);\n    };\n\n    StorageService.prototype.clear = function() {\n      return localStorage.clear();\n    };\n\n    return StorageService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgStorage\", StorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var UrlsService, format, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  format = function(fmt, obj) {\n    obj = _.clone(obj);\n    return fmt.replace(/%s/g, function(match) {\n      return String(obj.shift());\n    });\n  };\n\n  taiga = this.taiga;\n\n  UrlsService = (function(superClass) {\n    extend(UrlsService, superClass);\n\n    UrlsService.$inject = [\"$tgConfig\"];\n\n    function UrlsService(config) {\n      this.config = config;\n      this.urls = {};\n      this.mainUrl = this.config.get(\"api\");\n    }\n\n    UrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge(this.urls, urls);\n    };\n\n    UrlsService.prototype.resolve = function() {\n      var args, name, url;\n      args = _.toArray(arguments);\n      if (args.length === 0) {\n        throw Error(\"wrong arguments to setUrls\");\n      }\n      name = args.slice(0, 1)[0];\n      url = format(this.urls[name], args.slice(1));\n      return format(\"%s/%s\", [_.str.rtrim(this.mainUrl, \"/\"), _.str.ltrim(url, \"/\")]);\n    };\n\n    UrlsService.prototype.resolveAbsolute = function() {\n      var url;\n      url = this.resolve.apply(this, arguments);\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n      if (/^\\//.test(url)) {\n        return window.location.protocol + \"//\" + window.location.host + url;\n      }\n      return window.location.protocol + \"//\" + window.location.host + \"/\" + url;\n    };\n\n    return UrlsService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service('$tgUrls', UrlsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/attachments.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($rootScope, $config, $urls, $model, $repo, $auth, $q) {\n    var service;\n    service = {};\n    service.list = function(urlName, objectId, projectId) {\n      var params;\n      params = {\n        object_id: objectId,\n        project: projectId\n      };\n      return $repo.queryMany(urlName, params);\n    };\n    service.create = function(urlName, projectId, objectId, file) {\n      var data, defered, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      if (file === void 0) {\n        defered.reject(null);\n        return defered.promise;\n      }\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"in-progress\";\n            file.size = sizeFormat(evt.total);\n            file.progressMessage = \"upload \" + (sizeFormat(evt.loaded)) + \" of \" + (sizeFormat(evt.total));\n            return file.progressPercent = (Math.round((evt.loaded / evt.total) * 100)) + \"%\";\n          });\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            var data, error, model, ref, status;\n            file.status = \"done\";\n            status = evt.target.status;\n            try {\n              data = JSON.parse(evt.target.responseText);\n            } catch (error) {\n              data = {};\n            }\n            if (status >= 200 && status < 400) {\n              model = $model.make_model(urlName, data);\n              return defered.resolve(model);\n            } else {\n              response = {\n                status: status,\n                data: {\n                  _error_message: (ref = data['attached_file']) != null ? ref[0] : void 0\n                }\n              };\n              return defered.reject(response);\n            }\n          });\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"error\";\n            return defered.reject(\"fail\");\n          });\n        };\n      })(this);\n      data = new FormData();\n      data.append(\"project\", projectId);\n      data.append(\"object_id\", objectId);\n      data.append(\"attached_file\", file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.addEventListener(\"load\", uploadComplete, false);\n      xhr.addEventListener(\"error\", uploadFailed, false);\n      xhr.open(\"POST\", $urls.resolve(urlName));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function(instance) {\n      return instance.attachments = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgAttachmentsResourcesProvider\", [\"$rootScope\", \"$tgConfig\", \"$tgUrls\", \"$tgModel\", \"$tgRepo\", \"$tgAuth\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/custom-field-values.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var _get, service;\n    _get = function(objectId, resource) {\n      return $repo.queryOne(resource, objectId);\n    };\n    service = {\n      userstory: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/userstory\");\n        }\n      },\n      task: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/task\");\n        }\n      },\n      issue: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributesValues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesValuesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var _list, service;\n    _list = function(projectId, resource) {\n      return $repo.queryMany(resource, {\n        project: projectId\n      });\n    };\n    service = {\n      userstory: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/userstory\");\n        }\n      },\n      task: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/task\");\n        }\n      },\n      issue: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributes = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/history.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(type, objectId) {\n      return $repo.queryOneRaw(\"history/\" + type, objectId);\n    };\n    service.deleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/delete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.undeleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/undelete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.history = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgHistoryResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.get = function(token) {\n      return $repo.queryOne(\"invitations\", token);\n    };\n    return function(instance) {\n      return instance.invitations = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgInvitationsResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/issues.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var filtersHashSuffix, hashSuffix, myFiltersHashSuffix, service;\n    service = {};\n    hashSuffix = \"issues-queryparams\";\n    filtersHashSuffix = \"issues-filters\";\n    myFiltersHashSuffix = \"issues-my-filters\";\n    service.get = function(projectId, issueId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"issues\", issueId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"issues\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"issues\", filters);\n    };\n    service.list = function(projectId, filters, options) {\n      var params;\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryPaginated(\"issues\", params, options);\n    };\n    service.bulkCreate = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-issues\");\n      params = {\n        project_id: projectId,\n        bulk_issues: data\n      };\n      return $http.post(url, params);\n    };\n    service.upvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-upvote\", issueId);\n      return $http.post(url);\n    };\n    service.downvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-downvote\", issueId);\n      return $http.post(url);\n    };\n    service.watch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-watch\", issueId);\n      return $http.post(url);\n    };\n    service.unwatch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-unwatch\", issueId);\n      return $http.post(url);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/issues_stats\");\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"issues-filters\", null, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeFilters = function(projectSlug, params) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getFilters = function(projectSlug) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeMyFilters = function(projectId, myFilters) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      if (_.isEmpty(myFilters)) {\n        promise = $http[\"delete\"](url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function() {\n          return deferred.resolve();\n        });\n        promise.then(null, function() {\n          return deferred.reject();\n        });\n      } else {\n        promise = $http.put(url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function(data) {\n          return deferred.resolve();\n        });\n        promise.then(null, function(data) {\n          var innerPromise;\n          innerPromise = $http.post(\"\" + url, {\n            key: hash,\n            value: myFilters\n          });\n          innerPromise.then(function() {\n            return deferred.resolve();\n          });\n          return innerPromise.then(null, function() {\n            return deferred.reject();\n          });\n        });\n      }\n      return deferred.promise;\n    };\n    service.getMyFilters = function(projectId) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      promise = $http.get(url + \"/\" + hash);\n      promise.then(function(data) {\n        return deferred.resolve(data.data.value);\n      });\n      promise.then(null, function(data) {\n        return deferred.resolve({});\n      });\n      return deferred.promise;\n    };\n    return function(instance) {\n      return instance.issues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgIssuesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/kanban.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($storage) {\n    var hashSuffixStatusColumnModes, hashSuffixStatusViewModes, service;\n    service = {};\n    hashSuffixStatusViewModes = \"kanban-statusviewmodels\";\n    hashSuffixStatusColumnModes = \"kanban-statuscolumnmodels\";\n    service.storeStatusViewModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusViewModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.kanban = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgKanbanResourcesProvider\", [\"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/locales.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {\n      list: function() {\n        return $repo.queryMany(\"locales\");\n      }\n    };\n    return function(instance) {\n      return instance.locales = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgLocalesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/mdrender.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.render = function(projectId, content) {\n      var params, url;\n      if ((content == null) || content === \"\") {\n        content = ' ';\n      }\n      params = {\n        project_id: projectId,\n        content: content\n      };\n      url = $urls.resolve(\"wiki\");\n      return $http.post(url + \"/render\", params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.mdrender = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMdRenderResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"memberships\", id);\n    };\n    service.list = function(projectId, filters, enablePagination) {\n      var options, params;\n      if (enablePagination == null) {\n        enablePagination = true;\n      }\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      if (enablePagination) {\n        return $repo.queryPaginated(\"memberships\", params);\n      }\n      return $repo.queryMany(\"memberships\", params, options = {\n        enablePagination: enablePagination\n      });\n    };\n    service.listByUser = function(userId, filters) {\n      var params;\n      params = {\n        user: userId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryPaginated(\"memberships\", params);\n    };\n    service.resendInvitation = function(id) {\n      var url;\n      url = $urls.resolve(\"memberships\");\n      return $http.post(url + \"/\" + id + \"/resend_invitation\", {});\n    };\n    service.bulkCreateMemberships = function(projectId, data, invitation_extra_text) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-memberships\");\n      params = {\n        project_id: projectId,\n        bulk_memberships: data,\n        invitation_extra_text: invitation_extra_text\n      };\n      return $http.post(url, params);\n    };\n    return function(instance) {\n      return instance.memberships = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMembershipsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.list = function(projectId, module) {\n      return $repo.queryOneAttribute(\"project-modules\", projectId, module);\n    };\n    return function(instance) {\n      return instance.modules = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgModulesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"notify-policies\", id);\n    };\n    service.list = function(filters) {\n      var params;\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"notify-policies\", params);\n    };\n    return function(instance) {\n      return instance.notifyPolicies = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgNotifyPoliciesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $auth, $q, $translate) {\n    var service;\n    service = {};\n    service.get = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId);\n    };\n    service.getBySlug = function(projectSlug) {\n      return $repo.queryOne(\"projects\", \"by_slug?slug=\" + projectSlug);\n    };\n    service.list = function() {\n      return $repo.queryMany(\"projects\");\n    };\n    service.listByMember = function(memberId) {\n      var params;\n      params = {\n        \"member\": memberId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return $repo.queryMany(\"projects\", params);\n    };\n    service.templates = function() {\n      return $repo.queryMany(\"project-templates\");\n    };\n    service.usersList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"users\", params);\n    };\n    service.rolesList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"roles\", params);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/stats\");\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = $urls.resolve(\"bulk-update-projects-order\");\n      return $http.post(url, bulkData);\n    };\n    service.regenerate_userstories_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_userstories_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_issues_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_issues_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_tasks_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_tasks_csv_uuid\";\n      return $http.post(url);\n    };\n    service.leave = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/leave\";\n      return $http.post(url);\n    };\n    service.memberStats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/member_stats\");\n    };\n    service.tagsColors = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId + \"/tags_colors\");\n    };\n    service[\"export\"] = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"exporter\")) + \"/\" + projectId;\n      return $http.get(url);\n    };\n    service[\"import\"] = function(file, statusUpdater) {\n      var complete, data, defered, errorMsg, failed, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED\", {\n          fileName: file.name,\n          fileSize: sizeFormat(file.size),\n          maxFileSize: sizeFormat(maxFileSize)\n        });\n        response = {\n          status: 413,\n          data: {\n            _error_message: errorMsg\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          var message, percent;\n          percent = Math.round((evt.loaded / evt.total) * 100);\n          message = $translate.instant(\"PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE\", {\n            uploadedSize: sizeFormat(evt.loaded),\n            totalSize: sizeFormat(evt.total)\n          });\n          return statusUpdater(\"in-progress\", null, message, percent);\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"done\", $translate.instant(\"PROJECT.IMPORT.TITLE\"), $translate.instant(\"PROJECT.IMPORT.DESCRIPTION\"));\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"error\");\n        };\n      })(this);\n      complete = (function(_this) {\n        return function(evt) {\n          var error, ref;\n          response = {};\n          try {\n            response.data = JSON.parse(evt.target.responseText);\n          } catch (error) {\n            response.data = {};\n          }\n          response.status = evt.target.status;\n          if ((ref = response.status) === 201 || ref === 202) {\n            defered.resolve(response);\n          }\n          return defered.reject(response);\n        };\n      })(this);\n      failed = (function(_this) {\n        return function(evt) {\n          return defered.reject(\"fail\");\n        };\n      })(this);\n      data = new FormData();\n      data.append('dump', file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.upload.addEventListener(\"load\", uploadComplete, false);\n      xhr.upload.addEventListener(\"error\", uploadFailed, false);\n      xhr.upload.addEventListener(\"abort\", uploadFailed, false);\n      xhr.addEventListener(\"load\", complete, false);\n      xhr.addEventListener(\"error\", failed, false);\n      xhr.open(\"POST\", $urls.resolve(\"importer\"));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function(instance) {\n      return instance.projects = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgProjectsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgAuth\", \"$q\", \"$translate\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"roles\", id);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"roles\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.roles = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgRolesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/search.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http, $q) {\n    var service;\n    service = {};\n    service[\"do\"] = function(projectId, term) {\n      var deferredAbort, params, request, url;\n      deferredAbort = $q.defer();\n      url = $urls.resolve(\"search\");\n      params = {\n        url: url,\n        method: \"GET\",\n        timeout: deferredAbort.promise,\n        cancelable: true,\n        params: {\n          project: projectId,\n          text: term,\n          get_all: false\n        }\n      };\n      request = $http.request(params).then(function(data) {\n        return data.data;\n      });\n      request.abort = function() {\n        return deferredAbort.resolve();\n      };\n      request[\"finally\"] = function() {\n        request.abort = angular.noop;\n        return deferredAbort = request = null;\n      };\n      return request;\n    };\n    return function(instance) {\n      return instance.search = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSearchResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/sprints.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $model, $storage) {\n    var service;\n    service = {};\n    service.get = function(projectId, sprintId) {\n      return $repo.queryOne(\"milestones\", sprintId).then(function(sprint) {\n        var uses;\n        uses = sprint.user_stories;\n        uses = _.map(uses, function(u) {\n          return $model.make_model(\"userstories\", u);\n        });\n        sprint._attrs.user_stories = uses;\n        return sprint;\n      });\n    };\n    service.stats = function(projectId, sprintId) {\n      return $repo.queryOneRaw(\"milestones\", sprintId + \"/stats\");\n    };\n    service.list = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"milestones\", params, {}, true).then((function(_this) {\n        return function(result) {\n          var headers, i, len, m, milestones, uses;\n          milestones = result[0];\n          headers = result[1];\n          for (i = 0, len = milestones.length; i < len; i++) {\n            m = milestones[i];\n            uses = m.user_stories;\n            uses = _.map(uses, function(u) {\n              return $model.make_model(\"userstories\", u);\n            });\n            m._attrs.user_stories = uses;\n          }\n          return {\n            milestones: milestones,\n            closed: parseInt(headers(\"Taiga-Info-Total-Closed-Milestones\"), 10),\n            open: parseInt(headers(\"Taiga-Info-Total-Opened-Milestones\"), 10)\n          };\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.sprints = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSprintsResourcesProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/tasks.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, hashSuffixStatusColumnModes, hashSuffixUsRowModes, service;\n    service = {};\n    hashSuffix = \"tasks-queryparams\";\n    hashSuffixStatusColumnModes = \"tasks-statuscolumnmodels\";\n    hashSuffixUsRowModes = \"tasks-usrowmodels\";\n    service.get = function(projectId, taskId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"tasks\", taskId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"tasks\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"tasks\", filters);\n    };\n    service.list = function(projectId, sprintId, userStoryId) {\n      var params;\n      if (sprintId == null) {\n        sprintId = null;\n      }\n      if (userStoryId == null) {\n        userStoryId = null;\n      }\n      params = {\n        project: projectId\n      };\n      if (sprintId) {\n        params.milestone = sprintId;\n      }\n      if (userStoryId) {\n        params.user_story = userStoryId;\n      }\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"tasks\", params);\n    };\n    service.bulkCreate = function(projectId, sprintId, usId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-tasks\");\n      params = {\n        project_id: projectId,\n        sprint_id: sprintId,\n        us_id: usId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params).then(function(result) {\n        return result.data;\n      });\n    };\n    service.upvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-upvote\", taskId);\n      return $http.post(url);\n    };\n    service.downvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-downvote\", taskId);\n      return $http.post(url);\n    };\n    service.watch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-watch\", taskId);\n      return $http.post(url);\n    };\n    service.unwatch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-unwatch\", taskId);\n      return $http.post(url);\n    };\n    service.bulkUpdateTaskTaskboardOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-task-taskboard-order\");\n      params = {\n        project_id: projectId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeUsRowModes = function(projectId, sprintId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getUsRowModes = function(projectId, sprintId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.tasks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgTasksResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $q) {\n    var service;\n    service = {};\n    service.changeAvatar = function(file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('avatar', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"users\")) + \"/change_avatar\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeAvatar = function() {\n      var url;\n      url = ($urls.resolve(\"users\")) + \"/remove_avatar\";\n      return $http.post(url);\n    };\n    service.changePassword = function(currentPassword, newPassword) {\n      var data, url;\n      url = ($urls.resolve(\"users\")) + \"/change_password\";\n      data = {\n        current_password: currentPassword,\n        password: newPassword\n      };\n      return $http.post(url, data);\n    };\n    return function(instance) {\n      return instance.userSettings = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserSettingsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/user.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($http, $urls) {\n    var service;\n    service = {};\n    service.contacts = function(userId, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = $urls.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return $http.get(url, {}, httpOptions).then(function(result) {\n        return result.data;\n      });\n    };\n    return function(instance) {\n      return instance.users = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUsersResourcesProvider\", [\"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/userstories.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"userstories-queryparams\";\n    service.get = function(projectId, usId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"userstories\", usId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"userstories\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"userstories\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"userstories-filters\", null, params);\n    };\n    service.listUnassigned = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId,\n        \"milestone\": \"null\"\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.listAll = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.bulkCreate = function(projectId, status, bulk) {\n      var data, url;\n      data = {\n        project_id: projectId,\n        status_id: status,\n        bulk_stories: bulk\n      };\n      url = $urls.resolve(\"bulk-create-us\");\n      return $http.post(url, data);\n    };\n    service.upvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-upvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.downvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-downvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.watch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-watch\", userStoryId);\n      return $http.post(url);\n    };\n    service.unwatch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-unwatch\", userStoryId);\n      return $http.post(url);\n    };\n    service.bulkUpdateBacklogOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-backlog-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateSprintOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-sprint-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateKanbanOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-kanban-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeShowTags = function(projectId, showTags) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.set(hash, showTags);\n    };\n    service.getShowTags = function(projectId) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.get(hash) || null;\n    };\n    return function(instance) {\n      return instance.userstories = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserstoriesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooklogs.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(webhookId) {\n      var params;\n      params = {\n        webhook: webhookId\n      };\n      return $repo.queryMany(\"webhooklogs\", params);\n    };\n    service.resend = function(webhooklogId) {\n      var url;\n      url = $urls.resolve(\"webhooklogs-resend\", webhooklogId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooklogs = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhookLogsResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooks.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(projectId) {\n      var params;\n      params = {\n        project: projectId\n      };\n      return $repo.queryMany(\"webhooks\", params);\n    };\n    service.test = function(webhookId) {\n      var url;\n      url = $urls.resolve(\"webhooks-test\", webhookId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhooksResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/wikis.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(wikiId) {\n      return $repo.queryOne(\"wiki\", wikiId);\n    };\n    service.getBySlug = function(projectId, slug) {\n      return $repo.queryOne(\"wiki\", \"by_slug?project=\" + projectId + \"&slug=\" + slug);\n    };\n    service.listLinks = function(projectId) {\n      return $repo.queryMany(\"wiki-links\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.wiki = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWikiResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var UserChangePasswordController, UserChangePasswordDirective, debounce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserChangePasswordController = (function(superClass) {\n    extend(UserChangePasswordController, superClass);\n\n    UserChangePasswordController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserChangePasswordController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = this.translate.instant(\"CHANGE_PASSWORD.SECTION_NAME\");\n      this.scope.user = this.auth.getUser();\n    }\n\n    return UserChangePasswordController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserChangePasswordController\", UserChangePasswordController);\n\n  UserChangePasswordDirective = function($rs, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, ctrl) {\n      var submit, submitButton;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if ($scope.newPassword1 !== $scope.newPassword2) {\n            $confirm.notify('error', $translate.instant(\"CHANGE_PASSWORD.ERROR_PASSWORD_MATCH\"));\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userSettings.changePassword($scope.currentPassword, $scope.newPassword1);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify('success');\n          });\n          return promise.then(null, function(response) {\n            currentLoading.finish();\n            return $confirm.notify('error', response.data._error_message);\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserChangePassword\", [\"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", UserChangePasswordDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var DeleteUserDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  DeleteUserDirective = function($repo, $rootscope, $auth, $location, $navUrls, lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      $scope.$on(\"deletelightbox:new\", function(ctx, user) {\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        promise = $repo.remove($scope.user);\n        promise.then(function(data) {\n          lightboxService.close($el);\n          $auth.logout();\n          return $location.path($navUrls.resolve(\"login\"));\n        });\n        return promise.then(null, function() {\n          return console.log(\"FAIL\");\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", debounce(2000, function(event) {\n        event.preventDefault();\n        return submit();\n      }));\n    };\n    return {\n      link: link,\n      templateUrl: \"user/lightbox/lightbox-delete-account.html\"\n    };\n  };\n\n  module.directive(\"tgLbDeleteUser\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"lightboxService\", DeleteUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var TaigaAvatarModelDirective, UserAvatarDirective, UserProfileDirective, UserSettingsController, debounce, mixOf, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  debounce = this.taiga.debounce;\n\n  UserSettingsController = (function(superClass) {\n    extend(UserSettingsController, superClass);\n\n    UserSettingsController.$inject = [\"$scope\", \"$rootScope\", \"$tgConfig\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserSettingsController(scope, rootscope, config, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      var maxFileSize, promise, text;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.config = config;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = \"USER_SETTINGS.MENU.SECTION_TITLE\";\n      this.scope.project = {};\n      this.scope.user = this.auth.getUser();\n      if (!this.scope.user) {\n        this.location.path(this.navUrls.resolve(\"permission-denied\"));\n        this.location.replace();\n      }\n      this.scope.lang = this.getLan();\n      this.scope.theme = this.getTheme();\n      maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        text = this.translate.instant(\"USER_SETTINGS.AVATAR_MAX_SIZE\", {\n          \"maxFileSize\": sizeFormat(maxFileSize)\n        });\n        this.scope.maxFileSizeMsg = text;\n      }\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserSettingsController.prototype.loadInitialData = function() {\n      this.scope.availableThemes = this.config.get(\"themes\", []);\n      return this.rs.locales.list().then((function(_this) {\n        return function(locales) {\n          _this.scope.locales = locales;\n          return locales;\n        };\n      })(this));\n    };\n\n    UserSettingsController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.user);\n    };\n\n    UserSettingsController.prototype.getLan = function() {\n      return this.scope.user.lang || this.translate.preferredLanguage();\n    };\n\n    UserSettingsController.prototype.getTheme = function() {\n      return this.scope.user.theme || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    return UserSettingsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserSettingsController\", UserSettingsController);\n\n  UserProfileDirective = function($confirm, $auth, $repo, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var changeEmail, form, onError, onSuccess;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          changeEmail = $scope.user.isAttributeModified(\"email\");\n          $scope.user.lang = $scope.lang;\n          $scope.user.theme = $scope.theme;\n          onSuccess = function(data) {\n            var text;\n            $auth.setUser(data);\n            if (changeEmail) {\n              text = $translate.instant(\"USER_PROFILE.CHANGE_EMAIL_SUCCESS\");\n              return $confirm.success(text);\n            } else {\n              return $confirm.notify('success');\n            }\n          };\n          onError = function(data) {\n            form.setErrors(data);\n            return $confirm.notify('error', data._error_message);\n          };\n          return $repo.save($scope.user).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserProfile\", [\"$tgConfirm\", \"$tgAuth\", \"$tgRepo\", \"$translate\", UserProfileDirective]);\n\n  UserAvatarDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      onSuccess = function(response) {\n        var user;\n        user = $model.make_model(\"users\", response.data);\n        $auth.setUser(user);\n        $scope.user = user;\n        $el.find('.overlay').addClass('hidden');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.overlay').addClass('hidden');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-avatar\", function() {\n        return $el.find(\"#avatar-field\").click();\n      });\n      $el.on(\"change\", \"#avatar-field\", function(event) {\n        if ($scope.avatarAttachment) {\n          $el.find('.overlay').removeClass('hidden');\n          return $rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.use-gravatar\", function(event) {\n        $el.find('.overlay').removeClass('hidden');\n        return $rs.userSettings.removeAvatar().then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserAvatar\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", UserAvatarDirective]);\n\n  TaigaAvatarModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgAvatarModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgAvatarModel', ['$parse', TaigaAvatarModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/nav.coffee\n */\n\n(function() {\n  var UserSettingsNavigationDirective, module;\n\n  UserSettingsNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgUserSettingsNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#usersettingsmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaUserSettings\");\n\n  module.directive(\"tgUserSettingsNavigation\", UserSettingsNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/notifications.coffee\n */\n\n(function() {\n  var UserNotificationsController, UserNotificationsDirective, UserNotificationsListDirective, bindOnce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserNotificationsController = (function(superClass) {\n    extend(UserNotificationsController, superClass);\n\n    UserNotificationsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\"];\n\n    function UserNotificationsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.scope.sectionName = \"USER_SETTINGS.NOTIFICATIONS.SECTION_NAME\";\n      this.scope.user = this.auth.getUser();\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserNotificationsController.prototype.loadInitialData = function() {\n      return this.rs.notifyPolicies.list().then((function(_this) {\n        return function(notifyPolicies) {\n          _this.scope.notifyPolicies = notifyPolicies;\n          return notifyPolicies;\n        };\n      })(this));\n    };\n\n    return UserNotificationsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserNotificationsController\", UserNotificationsController);\n\n  UserNotificationsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotifications\", UserNotificationsDirective);\n\n  UserNotificationsListDirective = function($repo, $confirm, $compile) {\n    var link, template;\n    template = _.template(\"<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\\n<div class=\\\"policy-table-row\\\" data-index=\\\"<%- index %>\\\">\\n  <div class=\\\"policy-table-project\\\"><span><%- notifyPolicy.project_name %></span></div>\\n  <div class=\\\"policy-table-all\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             value=\\\"2\\\" <% if (notifyPolicy.notify_level == 2) { %>checked=\\\"checked\\\"<% } %>/>\\n      <label for=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_ALL\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-involved\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             value=\\\"1\\\" <% if (notifyPolicy.notify_level == 1) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-none\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             value=\\\"3\\\" <% if (notifyPolicy.notify_level == 3) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_NONE\\\"></label>\\n    </fieldset>\\n  </div>\\n</div>\\n<% }) %>\");\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function() {\n        var ctx, html;\n        $el.off();\n        ctx = {\n          notifyPolicies: $scope.notifyPolicies\n        };\n        html = template(ctx);\n        $el.html($compile(html)($scope));\n        return $el.on(\"change\", \"input[type=radio]\", function(event) {\n          var onError, onSuccess, policy, policyIndex, prev_level, target;\n          target = angular.element(event.currentTarget);\n          policyIndex = target.parents(\".policy-table-row\").data('index');\n          policy = $scope.notifyPolicies[policyIndex];\n          prev_level = policy.notify_level;\n          policy.notify_level = parseInt(target.val(), 10);\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return target.parents(\".policy-table-row\").find(\"input[value=\" + prev_level + \"]\").prop(\"checked\", true);\n          };\n          return $repo.save(policy).then(onSuccess, onError);\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotificationsList\", [\"$tgRepo\", \"$tgConfirm\", \"$compile\", UserNotificationsListDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: components.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaComponents\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaExternalApps\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaHome\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaNavigationBar\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProfile\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaProjects\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaResources2\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaUserTimeline\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.directive.coffee\n */\n\n(function() {\n  var JoyRideDirective, taiga;\n\n  taiga = this.taiga;\n\n  JoyRideDirective = function($rootScope, currentUserService, joyRideService, $location, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var initJoyrRide, intro, unsuscribe;\n      unsuscribe = null;\n      intro = introJs();\n      intro.oncomplete(function() {\n        return $('html,body').scrollTop(0);\n      });\n      intro.onexit(function() {\n        return currentUserService.disableJoyRide();\n      });\n      initJoyrRide = function(next, config) {\n        if (!config[next.joyride]) {\n          return;\n        }\n        intro.setOptions({\n          exitOnEsc: false,\n          exitOnOverlayClick: false,\n          showStepNumbers: false,\n          nextLabel: $translate.instant('JOYRIDE.NAV.NEXT') + ' &rarr;',\n          prevLabel: '&larr; ' + $translate.instant('JOYRIDE.NAV.BACK'),\n          skipLabel: $translate.instant('JOYRIDE.NAV.SKIP'),\n          doneLabel: $translate.instant('JOYRIDE.NAV.DONE'),\n          disableInteraction: true\n        });\n        intro.setOption('steps', joyRideService.get(next.joyride));\n        return intro.start();\n      };\n      return $rootScope.$on('$routeChangeSuccess', function(event, next) {\n        if (!next.joyride || !currentUserService.isAuthenticated()) {\n          intro.exit();\n          if (unsuscribe) {\n            unsuscribe();\n          }\n          return;\n        }\n        intro.oncomplete(function() {\n          return currentUserService.disableJoyRide(next.joyride);\n        });\n        if (next.loader) {\n          return unsuscribe = $rootScope.$on('loader:end', function() {\n            currentUserService.loadJoyRideConfig().then(function(config) {\n              return initJoyrRide(next, config);\n            });\n            return unsuscribe();\n          });\n        } else {\n          return currentUserService.loadJoyRideConfig().then(function(config) {\n            return initJoyrRide(next, config);\n          });\n        }\n      });\n    };\n    return {\n      scope: {},\n      link: link\n    };\n  };\n\n  JoyRideDirective.$inject = [\"$rootScope\", \"tgCurrentUserService\", \"tgJoyRideService\", \"$location\", \"$translate\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgJoyRide\", JoyRideDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.service.coffee\n */\n\n(function() {\n  var JoyRideService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JoyRideService = (function(superClass) {\n    extend(JoyRideService, superClass);\n\n    JoyRideService.$inject = ['$translate', 'tgCheckPermissionsService'];\n\n    function JoyRideService(translate, checkPermissionsService) {\n      this.translate = translate;\n      this.checkPermissionsService = checkPermissionsService;\n    }\n\n    JoyRideService.prototype.getConfig = function() {\n      return {\n        dashboard: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.project-list > section:not(.ng-hide)',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TEXT')\n                }\n              }, {\n                element: '.working-on-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TEXT')\n                }\n              }, {\n                element: '.watching-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT2')]\n                }\n              }\n            ];\n            if (!$('.project-list .create-project-button').is(':hidden')) {\n              steps.push({\n                element: '.project-list .create-project-button',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        backlog: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.summary',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT1'), _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT2')]\n                }\n              }, {\n                element: '.backlog-table-empty',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TEXT')\n                }\n              }, {\n                element: '.sprints',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.new-us',\n                position: 'rigth',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TEXT')\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        kanban: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.kanban-table-inner',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TEXT')\n                }\n              }, {\n                element: '.card-placeholder',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.icon-plus',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this)\n      };\n    };\n\n    JoyRideService.prototype.get = function(name) {\n      var joyRide, joyRides;\n      joyRides = this.getConfig();\n      joyRide = joyRides[name].call(this);\n      return _.map(joyRide, function(item) {\n        var html;\n        html = \"\";\n        if (item.joyride.title) {\n          html += \"<h3>\" + item.joyride.title + \"</h3>\";\n        }\n        if (_.isArray(item.joyride.text)) {\n          _.forEach(item.joyride.text, function(text) {\n            return html += \"<p>\" + text + \"</p>\";\n          });\n        } else {\n          html += \"<p>\" + item.joyride.text + \"</p>\";\n        }\n        item.intro = html;\n        return item;\n      });\n    };\n\n    return JoyRideService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgJoyRideService\", JoyRideService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2015 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2015 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: live-announcement.directive.coffee\n */\n\n(function() {\n  var LiveAnnouncementDirective;\n\n  LiveAnnouncementDirective = function(liveAnnouncementService) {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      restrict: \"AE\",\n      scope: {},\n      controllerAs: 'vm',\n      controller: function() {\n        this.close = function() {\n          return liveAnnouncementService.open = false;\n        };\n        return Object.defineProperties(this, {\n          open: {\n            get: function() {\n              return liveAnnouncementService.open;\n            }\n          },\n          title: {\n            get: function() {\n              return liveAnnouncementService.title;\n            }\n          },\n          desc: {\n            get: function() {\n              return liveAnnouncementService.desc;\n            }\n          }\n        });\n      },\n      link: link,\n      templateUrl: \"components/live-announcement/live-announcement.html\"\n    };\n  };\n\n  LiveAnnouncementDirective.$inject = [\"tgLiveAnnouncementService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgLiveAnnouncement\", LiveAnnouncementDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: notification.service.coffee\n */\n\n(function() {\n  var LiveAnnouncementService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  LiveAnnouncementService = (function(superClass) {\n    extend(LiveAnnouncementService, superClass);\n\n    function LiveAnnouncementService() {\n      this.open = false;\n      this.title = \"\";\n      this.desc = \"\";\n    }\n\n    LiveAnnouncementService.prototype.show = function(title, desc) {\n      this.open = true;\n      this.title = title;\n      return this.desc = desc;\n    };\n\n    return LiveAnnouncementService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgLiveAnnouncementService\", LiveAnnouncementService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.controller.coffee\n */\n\n(function() {\n  var ProjectMenuController;\n\n  ProjectMenuController = (function() {\n    ProjectMenuController.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n    function ProjectMenuController(projectService, lightboxFactory) {\n      this.projectService = projectService;\n      this.lightboxFactory = lightboxFactory;\n      this.project = null;\n      this.menu = Immutable.Map();\n    }\n\n    ProjectMenuController.prototype.show = function() {\n      this.project = this.projectService.project;\n      this.active = this._getActiveSection();\n      this._setVideoConference();\n      return this._setMenuPermissions();\n    };\n\n    ProjectMenuController.prototype.hide = function() {\n      this.project = null;\n      return this.menu = {};\n    };\n\n    ProjectMenuController.prototype.search = function() {\n      return this.lightboxFactory.create(\"tg-search-box\", {\n        \"class\": \"lightbox lightbox-search\"\n      });\n    };\n\n    ProjectMenuController.prototype._setVideoConference = function() {\n      var videoconferenceUrl;\n      videoconferenceUrl = this._videoConferenceUrl();\n      if (videoconferenceUrl) {\n        return this.project = this.project.set(\"videoconferenceUrl\", videoconferenceUrl);\n      }\n    };\n\n    ProjectMenuController.prototype._setMenuPermissions = function() {\n      this.menu = Immutable.Map({\n        backlog: false,\n        kanban: false,\n        issues: false,\n        wiki: false\n      });\n      if (this.project.get(\"is_backlog_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"backlog\", true);\n      }\n      if (this.project.get(\"is_kanban_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"kanban\", true);\n      }\n      if (this.project.get(\"is_issues_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_issues\") !== -1) {\n        this.menu = this.menu.set(\"issues\", true);\n      }\n      if (this.project.get(\"is_wiki_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_wiki_pages\") !== -1) {\n        return this.menu = this.menu.set(\"wiki\", true);\n      }\n    };\n\n    ProjectMenuController.prototype._getActiveSection = function() {\n      var indexBacklog, indexKanban, oldSectionName, sectionName, sectionsBreadcrumb;\n      sectionName = this.projectService.section;\n      sectionsBreadcrumb = this.projectService.sectionsBreadcrumb;\n      indexBacklog = sectionsBreadcrumb.lastIndexOf(\"backlog\");\n      indexKanban = sectionsBreadcrumb.lastIndexOf(\"kanban\");\n      if (indexBacklog !== -1 || indexKanban !== -1) {\n        if (indexKanban === -1 || indexBacklog < indexKanban) {\n          oldSectionName = \"backlog\";\n        } else {\n          oldSectionName = \"kanban\";\n        }\n      }\n      if (sectionName === \"backlog-kanban\") {\n        if (oldSectionName === \"backlog\" || oldSectionName === \"kanban\") {\n          sectionName = oldSectionName;\n        } else if (this.project.get(\"is_backlog_activated\") && !this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"backlog\";\n        } else if (!this.project.get(\"is_backlog_activated\") && this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"kanban\";\n        }\n      }\n      return sectionName;\n    };\n\n    ProjectMenuController.prototype._videoConferenceUrl = function() {\n      var baseUrl, url;\n      if (this.project.get(\"videoconferences\") === \"appear-in\") {\n        baseUrl = \"https://appear.in/\";\n      } else if (this.project.get(\"videoconferences\") === \"talky\") {\n        baseUrl = \"https://talky.io/\";\n      } else if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        baseUrl = \"https://meet.jit.si/\";\n        url = this.project.get(\"slug\") + \"-\" + taiga.slugify(this.project.get(\"videoconferences_extra_data\"));\n        url = url.replace(/-/g, \"\");\n        return baseUrl + url;\n      } else if (this.project.get(\"videoconferences\") === \"custom\") {\n        return this.project.get(\"videoconferences_extra_data\");\n      } else {\n        return \"\";\n      }\n      if (this.project.get(\"videoconferences_extra_data\")) {\n        url = this.project.get(\"slug\") + \"-\" + this.project.get(\"videoconferences_extra_data\");\n      } else {\n        url = this.project.get(\"slug\");\n      }\n      return baseUrl + url;\n    };\n\n    return ProjectMenuController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"ProjectMenu\", ProjectMenuController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.directive.coffee\n */\n\n(function() {\n  var ProjectMenuDirective, taiga;\n\n  taiga = this.taiga;\n\n  ProjectMenuDirective = function(projectService, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var projectChange;\n      projectChange = function() {\n        if (projectService.project) {\n          return ctrl.show();\n        } else {\n          return ctrl.hide();\n        }\n      };\n      return scope.$watch((function() {\n        return projectService.project;\n      }), projectChange);\n    };\n    return {\n      scope: {},\n      controller: \"ProjectMenu\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/project-menu/project-menu.html\",\n      link: link\n    };\n  };\n\n  ProjectMenuDirective.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectMenu\", ProjectMenuDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.directive.coffee\n */\n\n(function() {\n  var TermsOfServiceAndPrivacyPolicyNoticeDirective;\n\n  TermsOfServiceAndPrivacyPolicyNoticeDirective = function($config) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.privacyPolicyUrl = $config.get(\"privacyPolicyUrl\");\n      return scope.termsOfServiceUrl = $config.get(\"termsOfServiceUrl\");\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      link: link,\n      templateUrl: \"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgTermsOfServiceAndPrivacyPolicyNotice\", [\"$tgConfig\", TermsOfServiceAndPrivacyPolicyNoticeDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.controller.coffee\n */\n\n(function() {\n  var VoteButtonController;\n\n  VoteButtonController = (function() {\n    VoteButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function VoteButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    VoteButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    VoteButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    VoteButtonController.prototype.toggleVote = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_voter) {\n        promise = this._upvote();\n      } else {\n        promise = this._downvote();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    VoteButtonController.prototype._upvote = function() {\n      return this.onUpvote().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    VoteButtonController.prototype._downvote = function() {\n      return this.onDownvote();\n    };\n\n    return VoteButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"VoteButton\", VoteButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.directive.coffee\n */\n\n(function() {\n  var VoteButtonDirective;\n\n  VoteButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"VoteButton\",\n      bindToController: {\n        item: \"=\",\n        onUpvote: \"=\",\n        onDownvote: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/vote-button/vote-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgVoteButton\", VoteButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.controller.coffee\n */\n\n(function() {\n  var WatchButtonController;\n\n  WatchButtonController = (function() {\n    WatchButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function WatchButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    WatchButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    WatchButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    WatchButtonController.prototype.toggleWatch = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_watcher) {\n        promise = this._watch();\n      } else {\n        promise = this._unwatch();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    WatchButtonController.prototype._watch = function() {\n      return this.onWatch().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    WatchButtonController.prototype._unwatch = function() {\n      return this.onUnwatch();\n    };\n\n    return WatchButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"WatchButton\", WatchButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.directive.coffee\n */\n\n(function() {\n  var WatchButtonDirective;\n\n  WatchButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchButton\",\n      bindToController: {\n        item: \"=\",\n        onWatch: \"=\",\n        onUnwatch: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/watch-button/watch-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWatchButton\", WatchButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.controller.coffee\n */\n\n(function() {\n  var ExternalAppController, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ExternalAppController = (function(superClass) {\n    extend(ExternalAppController, superClass);\n\n    ExternalAppController.$inject = [\"$routeParams\", \"tgExternalAppsService\", \"$window\", \"tgCurrentUserService\", \"$location\", \"$tgNavUrls\", \"tgXhrErrorService\", \"tgLoader\"];\n\n    function ExternalAppController(routeParams, externalAppsService, window, currentUserService, location, navUrls, xhrError, loader) {\n      var loginUrl, nextUrl;\n      this.routeParams = routeParams;\n      this.externalAppsService = externalAppsService;\n      this.window = window;\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.xhrError = xhrError;\n      this.loader = loader;\n      this.createApplicationToken = bind(this.createApplicationToken, this);\n      this._getApplicationToken = bind(this._getApplicationToken, this);\n      this._redirect = bind(this._redirect, this);\n      this.loader.start(false);\n      this._applicationId = this.routeParams.application;\n      this._state = this.routeParams.state;\n      this._getApplicationToken();\n      this._user = this.currentUserService.getUser();\n      this._application = null;\n      nextUrl = encodeURIComponent(this.location.url());\n      loginUrl = this.navUrls.resolve(\"login\");\n      this.loginWithAnotherUserUrl = loginUrl + \"?next=\" + nextUrl;\n      taiga.defineImmutableProperty(this, \"user\", (function(_this) {\n        return function() {\n          return _this._user;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"application\", (function(_this) {\n        return function() {\n          return _this._application;\n        };\n      })(this));\n    }\n\n    ExternalAppController.prototype._redirect = function(applicationToken) {\n      var nextUrl;\n      nextUrl = applicationToken.get(\"next_url\");\n      return this.window.open(nextUrl, \"_self\");\n    };\n\n    ExternalAppController.prototype._getApplicationToken = function() {\n      return this.externalAppsService.getApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          _this._application = data.get(\"application\");\n          if (data.get(\"auth_code\")) {\n            return _this._redirect(data);\n          } else {\n            return _this.loader.pageLoaded();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          _this.loader.pageLoaded();\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    ExternalAppController.prototype.cancel = function() {\n      return this.window.history.back();\n    };\n\n    ExternalAppController.prototype.createApplicationToken = function() {\n      return this.externalAppsService.authorizeApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          return _this._redirect(data);\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    return ExternalAppController;\n\n  })(taiga.Controller);\n\n  angular.module(\"taigaExternalApps\").controller(\"ExternalApp\", ExternalAppController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.service.coffee\n */\n\n(function() {\n  var ExternalAppsService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ExternalAppsService = (function(superClass) {\n    extend(ExternalAppsService, superClass);\n\n    ExternalAppsService.$inject = [\"tgResources\"];\n\n    function ExternalAppsService(rs) {\n      this.rs = rs;\n    }\n\n    ExternalAppsService.prototype.getApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.getApplicationToken(applicationId, state);\n    };\n\n    ExternalAppsService.prototype.authorizeApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.authorizeApplicationToken(applicationId, state);\n    };\n\n    return ExternalAppsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaExternalApps\").service(\"tgExternalAppsService\", ExternalAppsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: feedback.service.coffee\n */\n\n(function() {\n  var FeedbackService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FeedbackService = (function(superClass) {\n    extend(FeedbackService, superClass);\n\n    FeedbackService.$inject = [\"tgLightboxFactory\"];\n\n    function FeedbackService(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    FeedbackService.prototype.sendFeedback = function() {\n      return this.lightboxFactory.create(\"tg-lb-feedback\", {\n        \"class\": \"lightbox lightbox-feedback lightbox-generic-form\"\n      });\n    };\n\n    return FeedbackService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaFeedback\").service(\"tgFeedbackService\", FeedbackService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duty.directive.coffee\n */\n\n(function() {\n  var DutyDirective;\n\n  DutyDirective = function(navurls, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.duty = scope.duty;\n      return scope.vm.getDutyType = function() {\n        if (scope.vm.duty) {\n          if (scope.vm.duty.get('_name') === \"userstories\") {\n            return $translate.instant(\"COMMON.USER_STORY\");\n          }\n          if (scope.vm.duty.get('_name') === \"tasks\") {\n            return $translate.instant(\"COMMON.TASK\");\n          }\n          if (scope.vm.duty.get('_name') === \"issues\") {\n            return $translate.instant(\"COMMON.ISSUE\");\n          }\n        }\n      };\n    };\n    return {\n      templateUrl: \"home/duties/duty.html\",\n      scope: {\n        \"duty\": \"=tgDuty\"\n      },\n      link: link\n    };\n  };\n\n  DutyDirective.$inject = [\"$tgNavUrls\", \"$translate\"];\n\n  angular.module(\"taigaHome\").directive(\"tgDuty\", DutyDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var HomeService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  HomeService = (function(superClass) {\n    extend(HomeService, superClass);\n\n    HomeService.$inject = [\"$tgNavUrls\", \"tgResources\", \"tgProjectsService\"];\n\n    function HomeService(navurls, rs, projectsService) {\n      this.navurls = navurls;\n      this.rs = rs;\n      this.projectsService = projectsService;\n    }\n\n    HomeService.prototype._attachProjectInfoToWorkInProgress = function(workInProgress, projectsById) {\n      var _attachProjectInfoToDuty, _duties, assignedTo, watching;\n      _attachProjectInfoToDuty = (function(_this) {\n        return function(duty, objType) {\n          var ctx, project, url;\n          project = projectsById.get(String(duty.get('project')));\n          ctx = {\n            project: project.get('slug'),\n            ref: duty.get('ref')\n          };\n          url = _this.navurls.resolve(\"project-\" + objType + \"-detail\", ctx);\n          duty = duty.set('url', url);\n          duty = duty.set('projectName', project.get('name'));\n          duty = duty.set(\"_name\", objType);\n          return duty;\n        };\n      })(this);\n      assignedTo = workInProgress.get(\"assignedTo\");\n      if (assignedTo.get(\"userStories\")) {\n        _duties = assignedTo.get(\"userStories\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"userstories\");\n        });\n        assignedTo = assignedTo.set(\"userStories\", _duties);\n      }\n      if (assignedTo.get(\"tasks\")) {\n        _duties = assignedTo.get(\"tasks\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"tasks\");\n        });\n        assignedTo = assignedTo.set(\"tasks\", _duties);\n      }\n      if (assignedTo.get(\"issues\")) {\n        _duties = assignedTo.get(\"issues\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"issues\");\n        });\n        assignedTo = assignedTo.set(\"issues\", _duties);\n      }\n      watching = workInProgress.get(\"watching\");\n      if (watching.get(\"userStories\")) {\n        _duties = watching.get(\"userStories\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"userstories\");\n        });\n        watching = watching.set(\"userStories\", _duties);\n      }\n      if (watching.get(\"tasks\")) {\n        _duties = watching.get(\"tasks\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"tasks\");\n        });\n        watching = watching.set(\"tasks\", _duties);\n      }\n      if (watching.get(\"issues\")) {\n        _duties = watching.get(\"issues\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"issues\");\n        });\n        watching = watching.set(\"issues\", _duties);\n      }\n      workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n      return workInProgress = workInProgress.set(\"watching\", watching);\n    };\n\n    HomeService.prototype.getWorkInProgress = function(userId) {\n      var assignedIssuesPromise, assignedTasksPromise, assignedTo, assignedUserStoriesPromise, params, params_us, projectsById, projectsPromise, watching, watchingIssuesPromise, watchingTasksPromise, watchingUserStoriesPromise, workInProgress;\n      projectsById = Immutable.Map();\n      projectsPromise = this.projectsService.getProjectsByUserId(userId).then(function(projects) {\n        return projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n          return p.id;\n        }));\n      });\n      assignedTo = Immutable.Map();\n      params = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_us = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      assignedUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return assignedTo = assignedTo.set(\"userStories\", userstories);\n      });\n      assignedTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return assignedTo = assignedTo.set(\"tasks\", tasks);\n      });\n      assignedIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return assignedTo = assignedTo.set(\"issues\", issues);\n      });\n      params = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_us = {\n        is_closed: false,\n        watchers: userId\n      };\n      watching = Immutable.Map();\n      watchingUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return watching = watching.set(\"userStories\", userstories);\n      });\n      watchingTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return watching = watching.set(\"tasks\", tasks);\n      });\n      watchingIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return watching = watching.set(\"issues\", issues);\n      });\n      workInProgress = Immutable.Map();\n      return Promise.all([projectsPromise, assignedUserStoriesPromise, assignedTasksPromise, assignedIssuesPromise, watchingUserStoriesPromise, watchingTasksPromise, watchingIssuesPromise]).then((function(_this) {\n        return function() {\n          workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n          workInProgress = workInProgress.set(\"watching\", watching);\n          workInProgress = _this._attachProjectInfoToWorkInProgress(workInProgress, projectsById);\n          return workInProgress;\n        };\n      })(this));\n    };\n\n    return HomeService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaHome\").service(\"tgHomeService\", HomeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home-project-list.directive.coffee\n */\n\n(function() {\n  var HomeProjectListDirective;\n\n  HomeProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"home/projects/home-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  HomeProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgHomeProjectList\", HomeProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var WorkingOnController;\n\n  WorkingOnController = (function() {\n    WorkingOnController.$inject = [\"tgHomeService\"];\n\n    function WorkingOnController(homeService) {\n      this.homeService = homeService;\n      this.assignedTo = Immutable.Map();\n      this.watching = Immutable.Map();\n    }\n\n    WorkingOnController.prototype._setAssignedTo = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"assignedTo\").get(\"userStories\");\n      tasks = workInProgress.get(\"assignedTo\").get(\"tasks\");\n      issues = workInProgress.get(\"assignedTo\").get(\"issues\");\n      this.assignedTo = userStories.concat(tasks).concat(issues);\n      if (this.assignedTo.size > 0) {\n        return this.assignedTo = this.assignedTo.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype._setWatching = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"watching\").get(\"userStories\");\n      tasks = workInProgress.get(\"watching\").get(\"tasks\");\n      issues = workInProgress.get(\"watching\").get(\"issues\");\n      this.watching = userStories.concat(tasks).concat(issues);\n      if (this.watching.size > 0) {\n        return this.watching = this.watching.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype.getWorkInProgress = function(userId) {\n      return this.homeService.getWorkInProgress(userId).then((function(_this) {\n        return function(workInProgress) {\n          _this._setAssignedTo(workInProgress);\n          return _this._setWatching(workInProgress);\n        };\n      })(this));\n    };\n\n    return WorkingOnController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"WorkingOn\", WorkingOnController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.directive.coffee\n */\n\n(function() {\n  var WorkingOnDirective;\n\n  WorkingOnDirective = function(homeService, currentUserService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var user, userId;\n      user = currentUserService.getUser();\n      if (user) {\n        userId = user.get(\"id\");\n        return ctrl.getWorkInProgress(userId);\n      }\n    };\n    return {\n      controller: \"WorkingOn\",\n      controllerAs: \"vm\",\n      templateUrl: \"home/working-on/working-on.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  WorkingOnDirective.$inject = [\"tgHomeService\", \"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgWorkingOn\", WorkingOnDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-project-list.directive.coffee\n */\n\n(function() {\n  var DropdownProjectListDirective;\n\n  DropdownProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-project-list/dropdown-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownProjectList\", DropdownProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-user.directive.coffee\n */\n\n(function() {\n  var DropdownUserDirective;\n\n  DropdownUserDirective = function(authService, configService, locationService, navUrlsService, feedbackService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.isFeedbackEnabled = configService.get(\"feedbackEnabled\");\n      taiga.defineImmutableProperty(scope.vm, \"user\", function() {\n        return authService.userData;\n      });\n      scope.vm.logout = function() {\n        authService.logout();\n        return locationService.path(navUrlsService.resolve(\"login\"));\n      };\n      return scope.vm.sendFeedback = function() {\n        return feedbackService.sendFeedback();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-user/dropdown-user.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownUserDirective.$inject = [\"$tgAuth\", \"$tgConfig\", \"$tgLocation\", \"$tgNavUrls\", \"tgFeedbackService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownUser\", DropdownUserDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.directive.coffee\n */\n\n(function() {\n  var NavigationBarDirective;\n\n  NavigationBarDirective = function(currentUserService, navigationBarService, $location) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.$on(\"$routeChangeSuccess\", function() {\n        if ($location.path() === \"/\") {\n          return scope.vm.active = true;\n        } else {\n          return scope.vm.active = false;\n        }\n      });\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isAuthenticated\", function() {\n        return currentUserService.isAuthenticated();\n      });\n      return taiga.defineImmutableProperty(scope.vm, \"isEnabledHeader\", function() {\n        return navigationBarService.isEnabledHeader();\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/navigation-bar.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  NavigationBarDirective.$inject = [\"tgCurrentUserService\", \"tgNavigationBarService\", \"$location\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgNavigationBar\", NavigationBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.service.coffee\n */\n\n(function() {\n  var NavigationBarService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  NavigationBarService = (function(superClass) {\n    extend(NavigationBarService, superClass);\n\n    function NavigationBarService() {\n      this.disableHeader();\n    }\n\n    NavigationBarService.prototype.enableHeader = function() {\n      return this.enabledHeader = true;\n    };\n\n    NavigationBarService.prototype.disableHeader = function() {\n      return this.enabledHeader = false;\n    };\n\n    NavigationBarService.prototype.isEnabledHeader = function() {\n      return this.enabledHeader;\n    };\n\n    return NavigationBarService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaNavigationBar\").service(\"tgNavigationBarService\", NavigationBarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.controller.coffee\n */\n\n(function() {\n  var ProfileBarController;\n\n  ProfileBarController = (function() {\n    ProfileBarController.$inject = [\"tgUserService\"];\n\n    function ProfileBarController(userService) {\n      this.userService = userService;\n      this.loadStats();\n    }\n\n    ProfileBarController.prototype.loadStats = function() {\n      return this.userService.getStats(this.user.get(\"id\")).then((function(_this) {\n        return function(stats) {\n          return _this.stats = stats;\n        };\n      })(this));\n    };\n\n    return ProfileBarController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileBar\", ProfileBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.directive.coffee\n */\n\n(function() {\n  var ProfileBarDirective;\n\n  ProfileBarDirective = function() {\n    return {\n      templateUrl: \"profile/profile-bar/profile-bar.html\",\n      controller: \"ProfileBar\",\n      controllerAs: \"vm\",\n      scope: {\n        user: \"=user\",\n        isCurrentUser: \"=iscurrentuser\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileBar\", ProfileBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.controller.coffee\n */\n\n(function() {\n  var ProfileContactsController;\n\n  ProfileContactsController = (function() {\n    ProfileContactsController.$inject = [\"tgUserService\", \"tgCurrentUserService\"];\n\n    function ProfileContactsController(userService, currentUserService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.currentUser = this.currentUserService.getUser();\n      this.isCurrentUser = false;\n      if (this.currentUser && this.currentUser.get(\"id\") === this.user.get(\"id\")) {\n        this.isCurrentUser = true;\n      }\n    }\n\n    ProfileContactsController.prototype.loadContacts = function() {\n      return this.userService.getContacts(this.user.get(\"id\")).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    return ProfileContactsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileContacts\", ProfileContactsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.directive.coffee\n */\n\n(function() {\n  var ProfileContactsDirective;\n\n  ProfileContactsDirective = function() {\n    var link;\n    link = function(scope, elm, attrs, ctrl) {\n      return ctrl.loadContacts();\n    };\n    return {\n      templateUrl: \"profile/profile-contacts/profile-contacts.html\",\n      scope: {\n        user: \"=\"\n      },\n      controllerAs: \"vm\",\n      controller: \"ProfileContacts\",\n      link: link,\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileContacts\", ProfileContactsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: items.directive.coffee\n */\n\n(function() {\n  var FavItemDirective;\n\n  FavItemDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.vm = {\n        item: scope.item\n      };\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.itemType === \"project\") {\n        return \"profile/profile-favs/items/project.html\";\n      } else {\n        return \"profile/profile-favs/items/ticket.html\";\n      }\n    };\n    return {\n      scope: {\n        \"item\": \"=tgFavItem\"\n      },\n      link: link,\n      templateUrl: templateUrl\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgFavItem\", FavItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.controller.coffee\n */\n\n(function() {\n  var FavsBaseController, ProfileLikedController, ProfileVotedController, ProfileWatchedController, debounceLeading,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  FavsBaseController = (function() {\n    function FavsBaseController() {\n      this._init();\n    }\n\n    FavsBaseController.prototype._init = function() {\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._resetList();\n      this.q = null;\n      return this.type = null;\n    };\n\n    FavsBaseController.prototype._resetList = function() {\n      this.items = Immutable.List();\n      this.scrollDisabled = false;\n      return this._page = 1;\n    };\n\n    FavsBaseController.prototype._enableLoadingSpinner = function() {\n      return this.isLoading = true;\n    };\n\n    FavsBaseController.prototype._disableLoadingSpinner = function() {\n      return this.isLoading = false;\n    };\n\n    FavsBaseController.prototype._enableScroll = function() {\n      return this.scrollDisabled = false;\n    };\n\n    FavsBaseController.prototype._disableScroll = function() {\n      return this.scrollDisabled = true;\n    };\n\n    FavsBaseController.prototype._checkIfHasMorePages = function(hasNext) {\n      if (hasNext) {\n        this._page += 1;\n        return this._enableScroll();\n      } else {\n        return this._disableScroll();\n      }\n    };\n\n    FavsBaseController.prototype._checkIfHasNoResults = function() {\n      return this.hasNoResults = this.items.size === 0;\n    };\n\n    FavsBaseController.prototype.loadItems = function() {\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      return this._getItems(this.user.get(\"id\"), this._page, this.type, this.q).then((function(_this) {\n        return function(response) {\n          _this.items = _this.items.concat(response.get(\"data\"));\n          _this._checkIfHasMorePages(response.get(\"next\"));\n          _this._checkIfHasNoResults();\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this));\n    };\n\n    FavsBaseController.prototype.filterByTextQuery = debounceLeading(500, function() {\n      this._resetList();\n      return this.loadItems();\n    });\n\n    FavsBaseController.prototype.showAll = function() {\n      if (this.type !== null) {\n        this.type = null;\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showProjectsOnly = function() {\n      if (this.type !== \"project\") {\n        this.type = \"project\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showUserStoriesOnly = function() {\n      if (this.type !== \"userstory\") {\n        this.type = \"userstory\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showTasksOnly = function() {\n      if (this.type !== \"task\") {\n        this.type = \"task\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showIssuesOnly = function() {\n      if (this.type !== \"issue\") {\n        this.type = \"issue\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    return FavsBaseController;\n\n  })();\n\n  ProfileLikedController = (function(superClass) {\n    extend(ProfileLikedController, superClass);\n\n    ProfileLikedController.$inject = [\"tgUserService\"];\n\n    function ProfileLikedController(userService) {\n      this.userService = userService;\n      ProfileLikedController.__super__.constructor.call(this);\n      this.enableFilterByAll = false;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = false;\n      this.enableFilterByTasks = false;\n      this.enableFilterByIssues = false;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getLiked;\n    }\n\n    return ProfileLikedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileLiked\", ProfileLikedController);\n\n  ProfileVotedController = (function(superClass) {\n    extend(ProfileVotedController, superClass);\n\n    ProfileVotedController.$inject = [\"tgUserService\"];\n\n    function ProfileVotedController(userService) {\n      this.userService = userService;\n      ProfileVotedController.__super__.constructor.call(this);\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getVoted;\n    }\n\n    return ProfileVotedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileVoted\", ProfileVotedController);\n\n  ProfileWatchedController = (function(superClass) {\n    extend(ProfileWatchedController, superClass);\n\n    ProfileWatchedController.$inject = [\"tgUserService\"];\n\n    function ProfileWatchedController(userService) {\n      this.userService = userService;\n      ProfileWatchedController.__super__.constructor.call(this);\n      this._getItems = this.userService.getWatched;\n    }\n\n    return ProfileWatchedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWatched\", ProfileWatchedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.directive.coffee\n */\n\n(function() {\n  var ProfileLikedDirective, ProfileVotedDirective, ProfileWatchedDirective, base;\n\n  base = {\n    scope: {},\n    bindToController: {\n      user: \"=\",\n      type: \"@\",\n      q: \"@\",\n      scrollDisabled: \"@\",\n      isLoading: \"@\",\n      hasNoResults: \"@\"\n    },\n    controller: null,\n    controllerAs: \"vm\",\n    templateUrl: \"profile/profile-favs/profile-favs.html\"\n  };\n\n  ProfileLikedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileLiked\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileLiked\", ProfileLikedDirective);\n\n  ProfileVotedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileVoted\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileVoted\", ProfileVotedDirective);\n\n  ProfileWatchedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileWatched\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWatched\", ProfileWatchedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.controller.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = (function() {\n    ProfileHints.prototype.HINTS = [\n      {\n        url: \"https://taiga.io/support/import-export-projects/\"\n      }, {\n        url: \"https://taiga.io/support/custom-fields/\"\n      }, {}, {}\n    ];\n\n    function ProfileHints(translate) {\n      var hintKey;\n      this.translate = translate;\n      hintKey = Math.floor(Math.random() * this.HINTS.length) + 1;\n      this.hint = this.HINTS[hintKey - 1];\n      this.hint.linkText = this.hint.linkText || 'HINTS.LINK';\n      this.hint.title = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TITLE\");\n      this.hint.text = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TEXT\");\n    }\n\n    return ProfileHints;\n\n  })();\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").controller(\"ProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.directive.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = function($translate) {\n    return {\n      scope: {},\n      controller: \"ProfileHints\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-hints/profile-hints.html\"\n    };\n  };\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.controller.coffee\n */\n\n(function() {\n  var ProfileProjectsController;\n\n  ProfileProjectsController = (function() {\n    ProfileProjectsController.$inject = [\"tgProjectsService\", \"tgUserService\"];\n\n    function ProfileProjectsController(projectsService, userService) {\n      this.projectsService = projectsService;\n      this.userService = userService;\n    }\n\n    ProfileProjectsController.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this.user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.userService.attachUserContactsToProjects(_this.user.get(\"id\"), projects);\n        };\n      })(this)).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    return ProfileProjectsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileProjects\", ProfileProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.directive.coffee\n */\n\n(function() {\n  var ProfileProjectsDirective;\n\n  ProfileProjectsDirective = function() {\n    var link;\n    link = function(scope, elm, attr, ctrl) {\n      return ctrl.loadProjects();\n    };\n    return {\n      templateUrl: \"profile/profile-projects/profile-projects.html\",\n      scope: {\n        user: \"=\"\n      },\n      link: link,\n      bindToController: true,\n      controllerAs: \"vm\",\n      controller: \"ProfileProjects\"\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileProjects\", ProfileProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tab.directive.coffee\n */\n\n(function() {\n  var ProfileTabDirective;\n\n  ProfileTabDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl, transclude) {\n      scope.tab = {};\n      attrs.$observe(\"tgProfileTab\", function(name) {\n        return scope.tab.name = name;\n      });\n      attrs.$observe(\"tabTitle\", function(title) {\n        return scope.tab.title = title;\n      });\n      scope.tab.icon = attrs.tabIcon;\n      scope.tab.active = !!attrs.tabActive;\n      if (scope.$eval(attrs.tabDisabled) !== true) {\n        return ctrl.addTab(scope.tab);\n      }\n    };\n    return {\n      templateUrl: \"profile/profile-tab/profile-tab.html\",\n      scope: {},\n      require: \"^tgProfileTabs\",\n      link: link,\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTab\", ProfileTabDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.controller.coffee\n */\n\n(function() {\n  var ProfileTabsController;\n\n  ProfileTabsController = (function() {\n    function ProfileTabsController() {\n      this.tabs = [];\n    }\n\n    ProfileTabsController.prototype.addTab = function(tab) {\n      return this.tabs.push(tab);\n    };\n\n    ProfileTabsController.prototype.toggleTab = function(tab) {\n      _.map(this.tabs, function(tab) {\n        return tab.active = false;\n      });\n      return tab.active = true;\n    };\n\n    return ProfileTabsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileTabs\", ProfileTabsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.directive.coffee\n */\n\n(function() {\n  var ProfileTabsDirective;\n\n  ProfileTabsDirective = function() {\n    return {\n      scope: {},\n      controller: \"ProfileTabs\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-tabs/profile-tabs.html\",\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTabs\", ProfileTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.controller.coffee\n */\n\n(function() {\n  var ProfileController;\n\n  ProfileController = (function() {\n    ProfileController.$inject = [\"tgAppMetaService\", \"tgCurrentUserService\", \"$routeParams\", \"tgUserService\", \"tgXhrErrorService\", \"$translate\"];\n\n    function ProfileController(appMetaService, currentUserService, routeParams, userService, xhrError, translate) {\n      this.appMetaService = appMetaService;\n      this.currentUserService = currentUserService;\n      this.routeParams = routeParams;\n      this.userService = userService;\n      this.xhrError = xhrError;\n      this.translate = translate;\n      this.isCurrentUser = false;\n      if (this.routeParams.slug) {\n        this.userService.getUserByUserName(this.routeParams.slug).then((function(_this) {\n          return function(user) {\n            if (!user.get('is_active')) {\n              return _this.xhrError.notFound();\n            } else {\n              _this.user = user;\n              _this.isCurrentUser = false;\n              _this._setMeta(_this.user);\n              return user;\n            }\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function(xhr) {\n            return _this.xhrError.response(xhr);\n          };\n        })(this));\n      } else {\n        this.user = this.currentUserService.getUser();\n        this.isCurrentUser = true;\n        this._setMeta(this.user);\n      }\n    }\n\n    ProfileController.prototype._setMeta = function(user) {\n      var ctx, description, title;\n      ctx = {\n        userFullName: user.get(\"full_name_display\"),\n        userUsername: user.get(\"username\")\n      };\n      title = this.translate.instant(\"USER.PROFILE.PAGE_TITLE\", ctx);\n      description = user.get(\"bio\");\n      return this.appMetaService.setAll(title, description);\n    };\n\n    return ProfileController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"Profile\", ProfileController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var LikeProjectButtonController;\n\n  LikeProjectButtonController = (function() {\n    LikeProjectButtonController.$inject = [\"$tgConfirm\", \"tgLikeProjectButtonService\"];\n\n    function LikeProjectButtonController(confirm, likeButtonService) {\n      this.confirm = confirm;\n      this.likeButtonService = likeButtonService;\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    LikeProjectButtonController.prototype.toggleLike = function() {\n      var promise;\n      this.loading = true;\n      if (!this.project.get(\"is_fan\")) {\n        promise = this._like();\n      } else {\n        promise = this._unlike();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    LikeProjectButtonController.prototype._like = function() {\n      return this.likeButtonService.like(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    LikeProjectButtonController.prototype._unlike = function() {\n      return this.likeButtonService.unlike(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"LikeProjectButton\", LikeProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.directive.coffee\n */\n\n(function() {\n  var LikeProjectButtonDirective;\n\n  LikeProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"LikeProjectButton\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/like-project-button/like-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLikeProjectButton\", LikeProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.service.coffee\n */\n\n(function() {\n  var LikeProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  LikeProjectButtonService = (function(superClass) {\n    extend(LikeProjectButtonService, superClass);\n\n    LikeProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function LikeProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    LikeProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    LikeProjectButtonService.prototype._updateProjects = function(projectId, isFan) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, function(project) {\n        var totalFans;\n        totalFans = project.get(\"total_fans\");\n        if (isFan) {\n          totalFans++;\n        } else {\n          totalFans--;\n        }\n        return project.merge({\n          is_fan: isFan,\n          total_fans: totalFans\n        });\n      });\n      return this.currentUserService.setProjects(projects);\n    };\n\n    LikeProjectButtonService.prototype._updateCurrentProject = function(isFan) {\n      var project, totalFans;\n      totalFans = this.projectService.project.get(\"total_fans\");\n      if (isFan) {\n        totalFans++;\n      } else {\n        totalFans--;\n      }\n      project = this.projectService.project.merge({\n        is_fan: isFan,\n        total_fans: totalFans\n      });\n      return this.projectService.setProject(project);\n    };\n\n    LikeProjectButtonService.prototype.like = function(projectId) {\n      return this.rs.projects.likeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, true);\n          return _this._updateCurrentProject(true);\n        };\n      })(this));\n    };\n\n    LikeProjectButtonService.prototype.unlike = function(projectId) {\n      return this.rs.projects.unlikeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, false);\n          return _this._updateCurrentProject(false);\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgLikeProjectButtonService\", LikeProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: sort-projects.directive.coffee\n */\n\n(function() {\n  var SortProjectsDirective;\n\n  SortProjectsDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      var itemEl;\n      itemEl = null;\n      el.sortable({\n        dropOnEmpty: true,\n        revert: 200,\n        axis: \"y\",\n        opacity: .95,\n        placeholder: 'placeholder',\n        cancel: '.project-name'\n      });\n      return el.on(\"sortstop\", function(event, ui) {\n        var i, index, len, project, sortData, sorted_project_ids, value;\n        itemEl = ui.item;\n        project = itemEl.scope().project;\n        index = itemEl.index();\n        sorted_project_ids = _.map(scope.projects.toJS(), function(p) {\n          return p.id;\n        });\n        sorted_project_ids = _.without(sorted_project_ids, project.get(\"id\"));\n        sorted_project_ids.splice(index, 0, project.get('id'));\n        sortData = [];\n        for (index = i = 0, len = sorted_project_ids.length; i < len; index = ++i) {\n          value = sorted_project_ids[index];\n          sortData.push({\n            \"project_id\": value,\n            \"order\": index\n          });\n        }\n        return currentUserService.bulkUpdateProjectsOrder(sortData);\n      });\n    };\n    directive = {\n      scope: {\n        projects: \"=tgSortProjects\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgSortProjects\", [\"tgCurrentUserService\", SortProjectsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.controller.coffee\n */\n\n(function() {\n  var WatchProjectButtonController;\n\n  WatchProjectButtonController = (function() {\n    WatchProjectButtonController.$inject = [\"$tgConfirm\", \"tgWatchProjectButtonService\"];\n\n    function WatchProjectButtonController(confirm, watchButtonService) {\n      this.confirm = confirm;\n      this.watchButtonService = watchButtonService;\n      this.showWatchOptions = false;\n      this.loading = false;\n    }\n\n    WatchProjectButtonController.prototype.toggleWatcherOptions = function() {\n      return this.showWatchOptions = !this.showWatchOptions;\n    };\n\n    WatchProjectButtonController.prototype.closeWatcherOptions = function() {\n      return this.showWatchOptions = false;\n    };\n\n    WatchProjectButtonController.prototype.watch = function(notifyLevel) {\n      if (notifyLevel === this.project.get('notify_level')) {\n        return;\n      }\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.watch(this.project.get('id'), notifyLevel)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    WatchProjectButtonController.prototype.unwatch = function() {\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.unwatch(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"WatchProjectButton\", WatchProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.directive.coffee\n */\n\n(function() {\n  var WatchProjectButtonDirective;\n\n  WatchProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchProjectButton\",\n      bindToController: {\n        project: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/watch-project-button/watch-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgWatchProjectButton\", WatchProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.service.coffee\n */\n\n(function() {\n  var WatchProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  WatchProjectButtonService = (function(superClass) {\n    extend(WatchProjectButtonService, superClass);\n\n    WatchProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function WatchProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    WatchProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    WatchProjectButtonService.prototype._updateProjects = function(projectId, notifyLevel, isWatcher) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, (function(_this) {\n        return function(project) {\n          var totalWatchers;\n          totalWatchers = project.get('total_watchers');\n          if (!_this.projectService.project.get('is_watcher') && isWatcher) {\n            totalWatchers++;\n          } else if (_this.projectService.project.get('is_watcher') && !isWatcher) {\n            totalWatchers--;\n          }\n          return project.merge({\n            is_watcher: isWatcher,\n            total_watchers: totalWatchers,\n            notify_level: notifyLevel\n          });\n        };\n      })(this));\n      return this.currentUserService.setProjects(projects);\n    };\n\n    WatchProjectButtonService.prototype._updateCurrentProject = function(notifyLevel, isWatcher) {\n      var project, totalWatchers;\n      totalWatchers = this.projectService.project.get(\"total_watchers\");\n      if (!this.projectService.project.get('is_watcher') && isWatcher) {\n        totalWatchers++;\n      } else if (this.projectService.project.get('is_watcher') && !isWatcher) {\n        totalWatchers--;\n      }\n      project = this.projectService.project.merge({\n        is_watcher: isWatcher,\n        notify_level: notifyLevel,\n        total_watchers: totalWatchers\n      });\n      return this.projectService.setProject(project);\n    };\n\n    WatchProjectButtonService.prototype.watch = function(projectId, notifyLevel) {\n      return this.rs.projects.watchProject(projectId, notifyLevel).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, notifyLevel, true);\n          return _this._updateCurrentProject(notifyLevel, true);\n        };\n      })(this));\n    };\n\n    WatchProjectButtonService.prototype.unwatch = function(projectId) {\n      return this.rs.projects.unwatchProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, null, false);\n          return _this._updateCurrentProject(null, false);\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgWatchProjectButtonService\", WatchProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-listing.controller.coffee\n */\n\n(function() {\n  var ProjectsListingController;\n\n  ProjectsListingController = (function() {\n    ProjectsListingController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n    function ProjectsListingController(currentUserService, projectsService) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n    }\n\n    ProjectsListingController.prototype.newProject = function() {\n      return this.projectsService.newProject();\n    };\n\n    return ProjectsListingController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ProjectsListing\", ProjectsListingController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var ProjectController;\n\n  ProjectController = (function() {\n    ProjectController.$inject = [\"$routeParams\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectController(routeParams, appMetaService, auth, translate, projectService) {\n      var projectSlug;\n      this.routeParams = routeParams;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      projectSlug = this.routeParams.pslug;\n      this.user = this.auth.userData;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"members\", (function(_this) {\n        return function() {\n          return _this.projectService.activeMembers;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    ProjectController.prototype._setMeta = function(project) {\n      var ctx, metas;\n      if (!this.project) {\n        return null;\n      }\n      metas = {};\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      metas.title = this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx);\n      metas.description = this.project.get(\"description\");\n      return metas;\n    };\n\n    return ProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"Project\", ProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.service.coffee\n */\n\n(function() {\n  var ProjectsService, groupBy, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  ProjectsService = (function(superClass) {\n    extend(ProjectsService, superClass);\n\n    ProjectsService.$inject = [\"tgResources\", \"$projectUrl\", \"tgLightboxFactory\"];\n\n    function ProjectsService(rs, projectUrl, lightboxFactory) {\n      this.rs = rs;\n      this.projectUrl = projectUrl;\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    ProjectsService.prototype.getProjectBySlug = function(projectSlug) {\n      return this.rs.projects.getProjectBySlug(projectSlug).then((function(_this) {\n        return function(project) {\n          return _this._decorate(project);\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype.getProjectStats = function(projectId) {\n      return this.rs.projects.getProjectStats(projectId);\n    };\n\n    ProjectsService.prototype.getProjectsByUserId = function(userId, paginate) {\n      return this.rs.projects.getProjectsByUserId(userId, paginate).then((function(_this) {\n        return function(projects) {\n          return projects.map(_this._decorate.bind(_this));\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype._decorate = function(project) {\n      var colorized_tags, tags, url;\n      url = this.projectUrl.get(project.toJS());\n      project = project.set(\"url\", url);\n      colorized_tags = [];\n      if (project.get(\"tags\")) {\n        tags = project.get(\"tags\").sort();\n        colorized_tags = tags.map(function(tag) {\n          var color;\n          color = project.get(\"tags_colors\").get(tag);\n          return Immutable.fromJS({\n            name: tag,\n            color: color\n          });\n        });\n        project = project.set(\"colorized_tags\", colorized_tags);\n      }\n      return project;\n    };\n\n    ProjectsService.prototype.newProject = function() {\n      return this.lightboxFactory.create(\"tg-lb-create-project\", {\n        \"class\": \"wizard-create-project\"\n      });\n    };\n\n    ProjectsService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.rs.projects.bulkUpdateOrder(sortData);\n    };\n\n    return ProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgProjectsService\", ProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getApplicationToken = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"applications\");\n      url = url + \"/\" + applicationId + \"/token?state=\" + state;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.authorizeApplicationToken = function(applicationId, state) {\n      var data, url;\n      url = urlsService.resolve(\"application-tokens\");\n      url = url + \"/authorize\";\n      data = {\n        \"state\": state,\n        \"application\": applicationId\n      };\n      return http.post(url, data).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"externalapps\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgExternalAppsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: issues-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"issues\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"issues\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgIssuesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, pagination;\n\n  pagination = function() {};\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getProjectBySlug = function(projectSlug) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/by_slug?slug=\" + projectSlug;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectsByUserId = function(userId, paginate) {\n      var httpOptions, params, url;\n      if (paginate == null) {\n        paginate = false;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!paginate) {\n        httpOptions.headers = {\n          \"x-disable-pagination\": \"1\"\n        };\n      }\n      params = {\n        \"member\": userId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectStats = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = urlsService.resolve(\"bulk-update-projects-order\");\n      return http.post(url, bulkData);\n    };\n    service.getTimeline = function(projectId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-project\");\n      url = url + \"/\" + projectId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.likeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-like\", projectId);\n      return http.post(url);\n    };\n    service.unlikeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unlike\", projectId);\n      return http.post(url);\n    };\n    service.watchProject = function(projectId, notifyLevel) {\n      var data, url;\n      data = {\n        notify_level: notifyLevel\n      };\n      url = urlsService.resolve(\"project-watch\", projectId);\n      return http.post(url, data);\n    };\n    service.unwatchProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unwatch\", projectId);\n      return http.post(url);\n    };\n    return function() {\n      return {\n        \"projects\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgProjectsResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.coffee\n */\n\n(function() {\n  var Resources, services;\n\n  services = [\"tgProjectsResources\", \"tgUserResources\", \"tgUsersResources\", \"tgUserstoriesResource\", \"tgTasksResource\", \"tgIssuesResource\", \"tgExternalAppsResource\"];\n\n  Resources = function($injector) {\n    var i, j, len, len1, ref, service, serviceFn, serviceName, serviceProperty;\n    for (i = 0, len = services.length; i < len; i++) {\n      serviceName = services[i];\n      serviceFn = $injector.get(serviceName);\n      service = $injector.invoke(serviceFn);\n      ref = Object.keys(service);\n      for (j = 0, len1 = ref.length; j < len1; j++) {\n        serviceProperty = ref[j];\n        if (this[serviceProperty]) {\n          console.warm(\"repeated resource \" + serviceProperty);\n        }\n        this[serviceProperty] = service[serviceProperty];\n      }\n    }\n    return this;\n  };\n\n  Resources.$inject = [\"$injector\"];\n\n  angular.module(\"taigaResources2\").service(\"tgResources\", Resources);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tasks-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"tasks\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"tasks\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTasksResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserStorage = function(key) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-storage\");\n      if (key) {\n        url += '/' + key;\n      }\n      httpOptions = {};\n      return http.get(url, {}).then(function(response) {\n        return response.data.value;\n      });\n    };\n    service.setUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\") + '/' + key;\n      params = {\n        key: key,\n        value: value\n      };\n      return http.put(url, params);\n    };\n    service.createUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\");\n      params = {\n        key: key,\n        value: value\n      };\n      return http.post(url, params);\n    };\n    return function() {\n      return {\n        \"user\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: users-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserByUsername = function(username) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"by_username\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        username: username\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getStats = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-stats\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getContacts = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getLiked = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-liked\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      params.only_relevant = true;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getVoted = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-voted\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWatched = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-watched\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getProfileTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page\n      };\n      url = urlsService.resolve(\"timeline-profile\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getUserTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-user\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    return function() {\n      return {\n        \"users\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUsersResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: userstories-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"userstories\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserstoriesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app-meta.service.coffee\n */\n\n(function() {\n  var AppMetaService, taiga, truncate;\n\n  taiga = this.taiga;\n\n  truncate = taiga.truncate;\n\n  AppMetaService = (function() {\n    AppMetaService.$inject = [\"$rootScope\"];\n\n    function AppMetaService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    AppMetaService.prototype._set = function(key, value) {\n      var meta;\n      if (!key) {\n        return;\n      }\n      if (key === \"title\") {\n        meta = $(\"title\");\n        if (meta.length === 0) {\n          meta = $(\"<title></title>\");\n          $(\"head\").append(meta);\n        }\n        return meta.text(value || \"\");\n      } else if (key.indexOf(\"og:\") === 0) {\n        meta = $(\"meta[property='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta property='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      } else {\n        meta = $(\"meta[name='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta name='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      }\n    };\n\n    AppMetaService.prototype.setTitle = function(title) {\n      return this._set('title', title);\n    };\n\n    AppMetaService.prototype.setDescription = function(description) {\n      return this._set(\"description\", truncate(description, 250));\n    };\n\n    AppMetaService.prototype.setTwitterMetas = function(title, description) {\n      this._set(\"twitter:card\", \"summary\");\n      this._set(\"twitter:site\", \"@taigaio\");\n      this._set(\"twitter:title\", title);\n      this._set(\"twitter:description\", truncate(description, 300));\n      return this._set(\"twitter:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n    };\n\n    AppMetaService.prototype.setOpenGraphMetas = function(title, description) {\n      this._set(\"og:type\", \"object\");\n      this._set(\"og:site_name\", \"Taiga - Love your projects\");\n      this._set(\"og:title\", title);\n      this._set(\"og:description\", truncate(description, 300));\n      this._set(\"og:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n      return this._set(\"og:url\", window.location.href);\n    };\n\n    AppMetaService.prototype.setAll = function(title, description) {\n      this.setTitle(title);\n      this.setDescription(description);\n      this.setTwitterMetas(title, description);\n      return this.setOpenGraphMetas(title, description);\n    };\n\n    AppMetaService.prototype.addMobileViewport = function() {\n      return $(\"head\").append(\"<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\\\">\");\n    };\n\n    AppMetaService.prototype.removeMobileViewport = function() {\n      return $(\"meta[name=\\\"viewport\\\"]\").remove();\n    };\n\n    AppMetaService.prototype.setfn = function(fn) {\n      if (this.listener) {\n        this._listener();\n      }\n      return this._listener = this.rootScope.$watchCollection(fn, (function(_this) {\n        return function(metas) {\n          if (metas) {\n            _this.setAll(metas.title, metas.description);\n            return _this._listener();\n          }\n        };\n      })(this));\n    };\n\n    return AppMetaService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAppMetaService\", AppMetaService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: check-permissions.service.coffee\n */\n\n(function() {\n  var ChekcPermissionsService, taiga;\n\n  taiga = this.taiga;\n\n  ChekcPermissionsService = (function() {\n    ChekcPermissionsService.$inject = [\"tgProjectService\"];\n\n    function ChekcPermissionsService(projectService) {\n      this.projectService = projectService;\n    }\n\n    ChekcPermissionsService.prototype.check = function(permission) {\n      return this.projectService.project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    return ChekcPermissionsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCheckPermissionsService\", ChekcPermissionsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: current-user.service.coffee\n */\n\n(function() {\n  var CurrentUserService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  CurrentUserService = (function() {\n    CurrentUserService.$inject = [\"tgProjectsService\", \"$tgStorage\", \"tgResources\"];\n\n    function CurrentUserService(projectsService, storageService, rs) {\n      this.projectsService = projectsService;\n      this.storageService = storageService;\n      this.rs = rs;\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      this._joyride = null;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this._projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsById\", (function(_this) {\n        return function() {\n          return _this._projectsById;\n        };\n      })(this));\n    }\n\n    CurrentUserService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    CurrentUserService.prototype.getUser = function() {\n      var userData;\n      if (!this._user) {\n        userData = this.storageService.get(\"userInfo\");\n        if (userData) {\n          userData = Immutable.fromJS(userData);\n          this.setUser(userData);\n        }\n      }\n      return this._user;\n    };\n\n    CurrentUserService.prototype.removeUser = function() {\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      return this._joyride = null;\n    };\n\n    CurrentUserService.prototype.setUser = function(user) {\n      this._user = user;\n      return this._loadUserInfo();\n    };\n\n    CurrentUserService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.projectsService.bulkUpdateProjectsOrder(sortData).then((function(_this) {\n        return function() {\n          return _this.loadProjects();\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this._user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.setProjects(projects);\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.disableJoyRide = function(section) {\n      if (section) {\n        this._joyride[section] = false;\n      } else {\n        this._joyride = {\n          backlog: false,\n          kanban: false,\n          dashboard: false\n        };\n      }\n      return this.rs.user.setUserStorage('joyride', this._joyride);\n    };\n\n    CurrentUserService.prototype.loadJoyRideConfig = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if (_this._joyride !== null) {\n            resolve(_this._joyride);\n            return;\n          }\n          return _this.rs.user.getUserStorage('joyride').then(function(config) {\n            _this._joyride = config;\n            return resolve(_this._joyride);\n          })[\"catch\"](function() {\n            _this._joyride = {\n              backlog: true,\n              kanban: true,\n              dashboard: true\n            };\n            _this.rs.user.createUserStorage('joyride', _this._joyride);\n            return resolve(_this._joyride);\n          });\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype._loadUserInfo = function() {\n      return Promise.all([this.loadProjects()]);\n    };\n\n    CurrentUserService.prototype.setProjects = function(projects) {\n      this._projects = this._projects.set(\"all\", projects);\n      this._projects = this._projects.set(\"recents\", projects.slice(0, 10));\n      this._projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n        return p.id;\n      }));\n      return this.projects;\n    };\n\n    return CurrentUserService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCurrentUserService\", CurrentUserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lightbox-factory.service.coffee\n */\n\n(function() {\n  var LightboxFactory;\n\n  LightboxFactory = (function() {\n    LightboxFactory.$inject = [\"$rootScope\", \"$compile\"];\n\n    function LightboxFactory(rootScope, compile) {\n      this.rootScope = rootScope;\n      this.compile = compile;\n    }\n\n    LightboxFactory.prototype.create = function(name, attrs) {\n      var elm, html, scope;\n      scope = this.rootScope.$new();\n      elm = $(\"<div>\").attr(name, true).attr(\"tg-bind-scope\", true);\n      if (attrs) {\n        elm.attr(attrs);\n      }\n      elm.addClass(\"remove-on-close\");\n      html = this.compile(elm)(scope);\n      $(document.body).append(html);\n    };\n\n    return LightboxFactory;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgLightboxFactory\", LightboxFactory);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: paginate-response.service.coffee\n */\n\n(function() {\n  var PaginateResponse;\n\n  PaginateResponse = function() {\n    return function(result) {\n      var paginateResponse;\n      paginateResponse = Immutable.Map({\n        \"data\": result.get(\"data\"),\n        \"next\": !!result.get(\"headers\")(\"x-pagination-next\"),\n        \"prev\": !!result.get(\"headers\")(\"x-pagination-prev\"),\n        \"current\": result.get(\"headers\")(\"x-pagination-current\"),\n        \"count\": result.get(\"headers\")(\"x-pagination-count\")\n      });\n      return paginateResponse;\n    };\n  };\n\n  angular.module(\"taigaCommon\").factory(\"tgPaginateResponseService\", PaginateResponse);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.service.coffee\n */\n\n(function() {\n  var ProjectService, taiga;\n\n  taiga = this.taiga;\n\n  ProjectService = (function() {\n    ProjectService.$inject = [\"tgProjectsService\", \"tgXhrErrorService\"];\n\n    function ProjectService(projectsService, xhrError) {\n      this.projectsService = projectsService;\n      this.xhrError = xhrError;\n      this._project = null;\n      this._section = null;\n      this._sectionsBreadcrumb = Immutable.List();\n      this._activeMembers = Immutable.List();\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this._project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"section\", (function(_this) {\n        return function() {\n          return _this._section;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"sectionsBreadcrumb\", (function(_this) {\n        return function() {\n          return _this._sectionsBreadcrumb;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"activeMembers\", (function(_this) {\n        return function() {\n          return _this._activeMembers;\n        };\n      })(this));\n    }\n\n    ProjectService.prototype.setSection = function(section) {\n      this._section = section;\n      if (section) {\n        return this._sectionsBreadcrumb = this._sectionsBreadcrumb.push(this._section);\n      } else {\n        return this._sectionsBreadcrumb = Immutable.List();\n      }\n    };\n\n    ProjectService.prototype.setProjectBySlug = function(pslug) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (!_this.project || _this.project.get('slug') !== pslug) {\n            return _this.projectsService.getProjectBySlug(pslug).then(function(project) {\n              _this.setProject(project);\n              return resolve();\n            })[\"catch\"](function(xhr) {\n              return _this.xhrError.response(xhr);\n            });\n          } else {\n            return resolve();\n          }\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.setProject = function(project) {\n      this._project = project;\n      return this._activeMembers = this._project.get('members').filter(function(member) {\n        return member.get('is_active');\n      });\n    };\n\n    ProjectService.prototype.cleanProject = function() {\n      this._project = null;\n      this._activeMembers = Immutable.List();\n      this._section = null;\n      return this._sectionsBreadcrumb = Immutable.List();\n    };\n\n    ProjectService.prototype.fetchProject = function() {\n      var pslug;\n      pslug = this.project.get('slug');\n      return this.projectsService.getProjectBySlug(pslug).then((function(_this) {\n        return function(project) {\n          return _this.setProject(project);\n        };\n      })(this));\n    };\n\n    return ProjectService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectService\", ProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: scope-event.service.coffee\n */\n\n(function() {\n  var ScopeEvent;\n\n  ScopeEvent = (function() {\n    function ScopeEvent() {}\n\n    ScopeEvent.prototype.scopes = {};\n\n    ScopeEvent.prototype._searchDuplicatedScopes = function(id) {\n      return _.find(Object.keys(this.scopes), (function(_this) {\n        return function(key) {\n          return _this.scopes[key].$id === id;\n        };\n      })(this));\n    };\n\n    ScopeEvent.prototype._create = function(name, scope) {\n      var duplicatedScopeName;\n      duplicatedScopeName = this._searchDuplicatedScopes(scope.$id);\n      if (duplicatedScopeName) {\n        throw new Error(\"scopeEvent: this scope is already register with the name \\\"\" + duplicatedScopeName + \"\\\"\");\n      }\n      if (this.scopes[name]) {\n        throw new Error(\"scopeEvent: \\\"\" + name + \"\\\" already in use\");\n      } else {\n        scope._tgEmitter = new EventEmitter2();\n        scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            scope._tgEmitter.removeAllListeners();\n            return delete _this.scopes[name];\n          };\n        })(this));\n        return this.scopes[name] = scope;\n      }\n    };\n\n    ScopeEvent.prototype.emitter = function(name, scope) {\n      if (scope) {\n        scope = this._create(name, scope);\n      } else if (this.scopes[name]) {\n        scope = this.scopes[name];\n      } else {\n        throw new Error(\"scopeEvent: \\\"\" + name + \"\\\" scope doesn't exist'\");\n      }\n      return scope._tgEmitter;\n    };\n\n    return ScopeEvent;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgScopeEvent\", ScopeEvent);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: theme.service.coffee\n */\n\n(function() {\n  var ThemeService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ThemeService = (function(superClass) {\n    extend(ThemeService, superClass);\n\n    function ThemeService() {\n      return ThemeService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ThemeService;\n\n  })(taiga.Service = function() {\n    return {\n      use: function(themeName) {\n        var stylesheetEl;\n        stylesheetEl = $(\"link[rel='stylesheet']:first\");\n        if (stylesheetEl.length === 0) {\n          stylesheetEl = $(\"<link rel='stylesheet' href='' type='text/css'>\");\n          $(\"head\").append(stylesheetEl);\n        }\n        return stylesheetEl.attr(\"href\", \"/\" + window._version + \"/styles/theme-\" + themeName + \".css\");\n      }\n    };\n  });\n\n  angular.module(\"taigaCommon\").service(\"tgThemeService\", ThemeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user.service.coffee\n */\n\n(function() {\n  var UserService, bindMethods, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = taiga.bindMethods;\n\n  UserService = (function(superClass) {\n    extend(UserService, superClass);\n\n    UserService.$inject = [\"tgResources\"];\n\n    function UserService(rs) {\n      this.rs = rs;\n      bindMethods(this);\n    }\n\n    UserService.prototype.getUserByUserName = function(username) {\n      return this.rs.users.getUserByUsername(username);\n    };\n\n    UserService.prototype.getContacts = function(userId) {\n      return this.rs.users.getContacts(userId);\n    };\n\n    UserService.prototype.getLiked = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getLiked(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getVoted = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getVoted(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getWatched = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getWatched(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getStats = function(userId) {\n      return this.rs.users.getStats(userId);\n    };\n\n    UserService.prototype.attachUserContactsToProjects = function(userId, projects) {\n      return this.getContacts(userId).then(function(contacts) {\n        projects = projects.map(function(project) {\n          var contactsFiltered;\n          contactsFiltered = contacts.filter(function(contact) {\n            var contactId;\n            contactId = contact.get(\"id\");\n            return project.get('members').indexOf(contactId) !== -1;\n          });\n          project = project.set(\"contacts\", contactsFiltered);\n          return project;\n        });\n        return projects;\n      });\n    };\n\n    return UserService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgUserService\", UserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: xhrError.service.coffee\n */\n\n(function() {\n  var xhrError,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  xhrError = (function(superClass) {\n    extend(xhrError, superClass);\n\n    xhrError.$inject = [\"$q\", \"$location\", \"$tgNavUrls\"];\n\n    function xhrError(q, location, navUrls) {\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n    }\n\n    xhrError.prototype.notFound = function() {\n      this.location.path(this.navUrls.resolve(\"not-found\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.permissionDenied = function() {\n      this.location.path(this.navUrls.resolve(\"permission-denied\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.response = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.notFound();\n        } else if (xhr.status === 403) {\n          this.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return xhrError;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgXhrErrorService\", xhrError);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-attachment.directive.coffee\n */\n\n(function() {\n  var UserTimelineAttachmentDirective;\n\n  UserTimelineAttachmentDirective = function(template, $compile) {\n    var isImage, link, validFileExtensions;\n    validFileExtensions = [\".jpg\", \".jpeg\", \".bmp\", \".gif\", \".png\"];\n    isImage = function(url) {\n      url = url.toLowerCase();\n      return _.some(validFileExtensions, function(extension) {\n        return url.indexOf(extension, url - extension.length) !== -1;\n      });\n    };\n    link = function(scope, el) {\n      var is_image, templateHtml;\n      is_image = isImage(scope.attachment.get('url'));\n      if (is_image) {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment-image.html\");\n      } else {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment.html\");\n      }\n      el.html(templateHtml);\n      $compile(el.contents())(scope);\n      return el.find(\"img\").error(function() {\n        return this.remove();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        attachment: \"=tgUserTimelineAttachment\"\n      }\n    };\n  };\n\n  UserTimelineAttachmentDirective.$inject = [\"$tgTemplate\", \"$compile\"];\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineAttachment\", UserTimelineAttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-title.service.coffee\n */\n\n(function() {\n  var UserTimelineItemTitle, unslugify;\n\n  unslugify = this.taiga.unslugify;\n\n  UserTimelineItemTitle = (function() {\n    UserTimelineItemTitle.$inject = [\"$translate\", \"$sce\"];\n\n    UserTimelineItemTitle.prototype._fieldTranslationKey = {\n      'status': 'COMMON.FIELDS.STATUS',\n      'subject': 'COMMON.FIELDS.SUBJECT',\n      'description_diff': 'COMMON.FIELDS.DESCRIPTION',\n      'points': 'COMMON.FIELDS.POINTS',\n      'assigned_to': 'COMMON.FIELDS.ASSIGNED_TO',\n      'severity': 'ISSUES.FIELDS.SEVERITY',\n      'trigger': 'ISSUES.FIELDS.TRIGGER',\n      'priority': 'ISSUES.FIELDS.PRIORITY',\n      'type': 'ISSUES.FIELDS.TYPE',\n      'is_iocaine': 'TASK.FIELDS.IS_IOCAINE',\n      'is_blocked': 'COMMON.FIELDS.IS_BLOCKED'\n    };\n\n    UserTimelineItemTitle.prototype._params = {\n      username: function(timeline, event) {\n        var title_attr, url, user;\n        user = timeline.getIn(['data', 'user']);\n        if (user.get('is_profile_visible')) {\n          title_attr = this.translate.instant('COMMON.SEE_USER_PROFILE', {\n            username: user.get('username')\n          });\n          url = \"user-profile:username=timeline.getIn(['data', 'user', 'username'])\";\n          return this._getLink(url, user.get('name'), title_attr);\n        } else {\n          return this._getUsernameSpan(user.get('name'));\n        }\n      },\n      field_name: function(timeline, event) {\n        var field_name;\n        field_name = timeline.getIn(['data', 'value_diff', 'key']);\n        return this.translate.instant(this._fieldTranslationKey[field_name]);\n      },\n      project_name: function(timeline, event) {\n        var url;\n        url = \"project:project=timeline.getIn(['data', 'project', 'slug'])\";\n        return this._getLink(url, timeline.getIn([\"data\", \"project\", \"name\"]));\n      },\n      new_value: function(timeline, event) {\n        var new_value, value;\n        if (_.isArray(timeline.getIn([\"data\", \"value_diff\", \"value\"]).toJS())) {\n          value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).get(1);\n          if (value === null && timeline.getIn([\"data\", \"value_diff\", \"key\"]) === 'assigned_to') {\n            value = this.translate.instant('ACTIVITY.VALUES.UNASSIGNED');\n          }\n          new_value = value;\n        } else {\n          new_value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).first().get(1);\n        }\n        return _.escape(new_value);\n      },\n      sprint_name: function(timeline, event) {\n        var url;\n        url = \"project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])\";\n        return this._getLink(url, timeline.getIn(['data', 'milestone', 'name']));\n      },\n      us_name: function(timeline, event) {\n        var event_us, obj, text, url;\n        obj = this._getTimelineObj(timeline, event).get('userstory');\n        event_us = {\n          obj: 'parent_userstory'\n        };\n        url = this._getDetailObjUrl(event_us);\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      obj_name: function(timeline, event) {\n        var obj, text, url;\n        obj = this._getTimelineObj(timeline, event);\n        url = this._getDetailObjUrl(event);\n        if (event.obj === 'wikipage') {\n          text = unslugify(obj.get('slug'));\n        } else if (event.obj === 'milestone') {\n          text = obj.get('name');\n        } else {\n          text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        }\n        return this._getLink(url, text);\n      },\n      role_name: function(timeline, event) {\n        return _.escape(timeline.getIn(['data', 'value_diff', 'value']).keySeq().first());\n      }\n    };\n\n    function UserTimelineItemTitle(translate, sce) {\n      this.translate = translate;\n      this.sce = sce;\n    }\n\n    UserTimelineItemTitle.prototype._translateTitleParams = function(param, timeline, event) {\n      return this._params[param].call(this, timeline, event);\n    };\n\n    UserTimelineItemTitle.prototype._getTimelineObj = function(timeline, event) {\n      return timeline.getIn(['data', event.obj]);\n    };\n\n    UserTimelineItemTitle.prototype._getDetailObjUrl = function(event) {\n      var url;\n      url = {\n        \"issue\": [\"project-issues-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"wikipage\": [\"project-wiki-page\", \":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])\"],\n        \"task\": [\"project-tasks-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"parent_userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])\"],\n        \"milestone\": [\"project-taskboard\", \":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])\"]\n      };\n      return url[event.obj][0] + url[event.obj][1];\n    };\n\n    UserTimelineItemTitle.prototype._getLink = function(url, text, title) {\n      title = title || text;\n      return $('<a>').attr('tg-nav', url).text(text).attr('title', title).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getUsernameSpan = function(text) {\n      var title;\n      title = title || text;\n      return $('<span>').addClass('username').text(text).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getParams = function(timeline, event, timeline_type) {\n      var params;\n      params = {};\n      timeline_type.translate_params.forEach((function(_this) {\n        return function(param) {\n          return params[param] = _this._translateTitleParams(param, timeline, event);\n        };\n      })(this));\n      return params;\n    };\n\n    UserTimelineItemTitle.prototype.getTitle = function(timeline, event, type) {\n      var params, paramsKeys, translation;\n      params = this._getParams(timeline, event, type);\n      paramsKeys = {};\n      Object.keys(params).forEach(function(key) {\n        return paramsKeys[key] = '{{' + key + '}}';\n      });\n      translation = this.translate.instant(type.key, paramsKeys);\n      Object.keys(params).forEach(function(key) {\n        var find;\n        find = '{{' + key + '}}';\n        return translation = translation.replace(new RegExp(find, 'g'), params[key]);\n      });\n      return translation;\n    };\n\n    return UserTimelineItemTitle;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemTitle\", UserTimelineItemTitle);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-type.service.coffee\n */\n\n(function() {\n  var UserTimelineType, timelineType;\n\n  timelineType = function(timeline, event) {\n    var types;\n    types = [\n      {\n        check: function(timeline, event) {\n          return event.obj === 'membership';\n        },\n        key: 'TIMELINE.NEW_MEMBER',\n        translate_params: ['project_name'],\n        member: function(timeline) {\n          return Immutable.Map({\n            user: timeline.getIn(['data', 'user']),\n            role: timeline.getIn(['data', 'role'])\n          });\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'project' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_PROJECT',\n        translate_params: ['username', 'project_name'],\n        description: function(timeline) {\n          return timeline.getIn(['data', 'project', 'description']);\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'attachments';\n        },\n        key: 'TIMELINE.UPLOAD_ATTACHMENT',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.US_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'create';\n        },\n        key: 'TIMELINE.ISSUE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'create';\n        },\n        key: 'TIMELINE.WIKI_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED_WITH_US',\n        translate_params: ['username', 'project_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'create';\n        },\n        key: 'TIMELINE.MILESTONE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.NEW_COMMENT_US',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          return $(timeline.getIn(['data', 'comment_html'])).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'issue';\n        },\n        key: 'TIMELINE.NEW_COMMENT_ISSUE',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          return $(timeline.getIn(['data', 'comment_html'])).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'task';\n        },\n        key: 'TIMELINE.NEW_COMMENT_TASK',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          return $(timeline.getIn(['data', 'comment_html'])).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && timeline.hasIn(['data', 'value_diff', 'value', 'backlog_order']) && event.type === 'change';\n        },\n        key: 'TIMELINE.US_MOVED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'milestone']).get(1) === null;\n          }\n          return false;\n        },\n        key: 'TIMELINE.US_REMOVED_FROM_MILESTONE',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_ADDED_MILESTONE',\n        translate_params: ['username', 'obj_name', 'sprint_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === true;\n          }\n          return false;\n        },\n        key: 'TIMELINE.BLOCKED',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          if (timeline.hasIn(['data', 'value_diff', 'value', 'blocked_note_html'])) {\n            return $(timeline.getIn(['data', 'value_diff', 'value', 'blocked_note_html']).get(1)).text();\n          } else {\n            return false;\n          }\n        }\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === false;\n          }\n          return false;\n        },\n        key: 'TIMELINE.UNBLOCKED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'change';\n        },\n        key: 'TIMELINE.MILESTONE_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'change';\n        },\n        key: 'TIMELINE.WIKI_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'points';\n        },\n        key: 'TIMELINE.US_UPDATED_POINTS',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value', 'role_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.US_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'user' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_USER',\n        translate_params: ['username']\n      }\n    ];\n    return _.find(types, function(obj) {\n      return obj.check(timeline, event);\n    });\n  };\n\n  UserTimelineType = (function() {\n    function UserTimelineType() {}\n\n    UserTimelineType.prototype.getType = function(timeline, event) {\n      return timelineType(timeline, event);\n    };\n\n    return UserTimelineType;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemType\", UserTimelineType);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item.directive.coffee\n */\n\n(function() {\n  var UserTimelineItemDirective;\n\n  UserTimelineItemDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline-item/user-timeline-item.html\",\n      scope: {\n        timeline: \"=tgUserTimelineItem\"\n      }\n    };\n  };\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineItem\", UserTimelineItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-pagination-sequence.service.coffee\n */\n\n(function() {\n  var UserTimelinePaginationSequence;\n\n  UserTimelinePaginationSequence = function() {\n    var obj;\n    obj = {};\n    obj.generate = function(config) {\n      var getContent, items, next, page;\n      page = 1;\n      items = Immutable.List();\n      config.minItems = config.minItems || 20;\n      next = function() {\n        items = Immutable.List();\n        return getContent();\n      };\n      getContent = function() {\n        return config.fetch(page).then(function(response) {\n          var data;\n          page++;\n          data = response.get(\"data\");\n          if (config.filter) {\n            data = config.filter(data);\n          }\n          if (config.map) {\n            data = data.map(config.map);\n          }\n          items = items.concat(data);\n          if (items.size < config.minItems && response.get(\"next\")) {\n            return getContent();\n          }\n          return Immutable.Map({\n            items: items,\n            next: response.get(\"next\")\n          });\n        });\n      };\n      return {\n        next: function() {\n          return next();\n        }\n      };\n    };\n    return obj;\n  };\n\n  angular.module(\"taigaUserTimeline\").factory(\"tgUserTimelinePaginationSequenceService\", UserTimelinePaginationSequence);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.be>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/profile/profile-timeline/profile-timeline.controller.coffee\n */\n\n(function() {\n  var UserTimelineController, mixOf, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  UserTimelineController = (function(superClass) {\n    extend(UserTimelineController, superClass);\n\n    UserTimelineController.$inject = [\"tgUserTimelineService\"];\n\n    function UserTimelineController(userTimelineService) {\n      this.userTimelineService = userTimelineService;\n      this.timelineList = Immutable.List();\n      this.scrollDisabled = false;\n      this.timeline = null;\n      if (this.projectId) {\n        this.timeline = this.userTimelineService.getProjectTimeline(this.projectId);\n      } else if (this.currentUser) {\n        this.timeline = this.userTimelineService.getProfileTimeline(this.user.get(\"id\"));\n      } else {\n        this.timeline = this.userTimelineService.getUserTimeline(this.user.get(\"id\"));\n      }\n    }\n\n    UserTimelineController.prototype.loadTimeline = function() {\n      this.scrollDisabled = true;\n      return this.timeline.next().then((function(_this) {\n        return function(response) {\n          _this.timelineList = _this.timelineList.concat(response.get(\"items\"));\n          if (response.get(\"next\")) {\n            _this.scrollDisabled = false;\n          }\n          return _this.timelineList;\n        };\n      })(this));\n    };\n\n    return UserTimelineController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  angular.module(\"taigaUserTimeline\").controller(\"UserTimeline\", UserTimelineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.directive.coffee\n */\n\n(function() {\n  var UserTimelineDirective;\n\n  UserTimelineDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline/user-timeline.html\",\n      controller: \"UserTimeline\",\n      controllerAs: \"vm\",\n      scope: {\n        projectId: \"=projectid\",\n        user: \"=\",\n        currentUser: \"=\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgUserTimeline\", UserTimelineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.service.coffee\n */\n\n(function() {\n  var UserTimelineService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  UserTimelineService = (function(superClass) {\n    extend(UserTimelineService, superClass);\n\n    UserTimelineService.$inject = [\"tgResources\", \"tgUserTimelinePaginationSequenceService\", \"tgUserTimelineItemType\", \"tgUserTimelineItemTitle\"];\n\n    function UserTimelineService(rs, userTimelinePaginationSequenceService, userTimelineItemType, userTimelineItemTitle) {\n      this.rs = rs;\n      this.userTimelinePaginationSequenceService = userTimelinePaginationSequenceService;\n      this.userTimelineItemType = userTimelineItemType;\n      this.userTimelineItemTitle = userTimelineItemTitle;\n    }\n\n    UserTimelineService.prototype._valid_fields = ['status', 'subject', 'description_diff', 'assigned_to', 'points', 'severity', 'trigger', 'priority', 'type', 'attachments', 'is_iocaine', 'content_diff', 'name', 'estimated_finish', 'estimated_start', 'blocked', 'moveInBacklog', 'milestone'];\n\n    UserTimelineService.prototype._invalid = [\n      {\n        check: function(timeline) {\n          var fieldKey, value_diff;\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff) {\n            fieldKey = value_diff.get('key');\n            if (this._valid_fields.indexOf(fieldKey) === -1) {\n              return true;\n            } else if (fieldKey === 'attachments' && value_diff.get('value').get('new').size === 0) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          return event[2] === 'change' && value_diff === void 0;\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[2] === 'delete';\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[1] === 'project' && event[2] === 'change';\n        }\n      }, {\n        check: function(timeline) {\n          return !!timeline.get(\"data\").get(\"comment_deleted\");\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff && event[1] === \"task\" && event[2] === \"change\" && value_diff.get(\"key\") === \"milestone\") {\n            return timeline.get(\"data\").get(\"value_diff\").get(\"value\");\n          }\n          return false;\n        }\n      }\n    ];\n\n    UserTimelineService.prototype._isInValidTimeline = function(timeline) {\n      return _.some(this._invalid, (function(_this) {\n        return function(invalid) {\n          return invalid.check.call(_this, timeline);\n        };\n      })(this));\n    };\n\n    UserTimelineService.prototype._parseEventType = function(event_type) {\n      event_type = event_type.split(\".\");\n      return {\n        section: event_type[0],\n        obj: event_type[1],\n        type: event_type[2]\n      };\n    };\n\n    UserTimelineService.prototype._getTimelineObject = function(timeline, event) {\n      if (timeline.get('data').get(event.obj)) {\n        return timeline.get('data').get(event.obj);\n      }\n    };\n\n    UserTimelineService.prototype._attachExtraInfoToTimelineEntry = function(timeline, event, type) {\n      var title;\n      title = this.userTimelineItemTitle.getTitle(timeline, event, type);\n      timeline = timeline.set('title_html', title);\n      timeline = timeline.set('obj', this._getTimelineObject(timeline, event));\n      if (type.description) {\n        timeline = timeline.set('description', type.description(timeline));\n      }\n      if (type.member) {\n        timeline = timeline.set('member', type.member(timeline));\n      }\n      if (timeline.getIn(['data', 'value_diff', 'key']) === 'attachments' && timeline.hasIn(['data', 'value_diff', 'value', 'new'])) {\n        timeline = timeline.set('attachments', timeline.getIn(['data', 'value_diff', 'value', 'new']));\n      }\n      return timeline;\n    };\n\n    UserTimelineService.prototype._parseTimeline = function(response) {\n      var newdata;\n      newdata = Immutable.List();\n      response.get('data').forEach((function(_this) {\n        return function(item) {\n          var data, event, newItem, values_diff;\n          event = _this._parseEventType(item.get('event_type'));\n          data = item.get('data');\n          values_diff = data.get('values_diff');\n          if (values_diff && values_diff.count()) {\n            if (values_diff.has('is_blocked')) {\n              values_diff = Immutable.Map({\n                'blocked': values_diff\n              });\n            }\n            if (values_diff.has('milestone')) {\n              values_diff = Immutable.Map({\n                'moveInBacklog': values_diff\n              });\n            } else if (event.obj === 'milestone') {\n              values_diff = Immutable.Map({\n                'milestone': values_diff\n              });\n            }\n            return values_diff.forEach(function(value, key) {\n              var newItem, obj;\n              obj = Immutable.Map({\n                key: key,\n                value: value\n              });\n              newItem = item.setIn(['data', 'value_diff'], obj);\n              newItem = newItem.deleteIn(['data', 'values_diff']);\n              return newdata = newdata.push(newItem);\n            });\n          } else {\n            newItem = item.deleteIn(['data', 'values_diff']);\n            return newdata = newdata.push(newItem);\n          }\n        };\n      })(this));\n      return response.set('data', newdata);\n    };\n\n    UserTimelineService.prototype._addEntyAttributes = function(item) {\n      var event, type;\n      event = this._parseEventType(item.get('event_type'));\n      type = this.userTimelineItemType.getType(item, event);\n      return this._attachExtraInfoToTimelineEntry(item, event, type);\n    };\n\n    UserTimelineService.prototype.getProfileTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getProfileTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getUserTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getUserTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getProjectTimeline = function(projectId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.projects.getTimeline(projectId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    return UserTimelineService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineService\", UserTimelineService);\n\n}).call(this);\n\n//# sourceMappingURL=maps/app.js.map\n"]}