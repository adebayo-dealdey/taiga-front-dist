{"version":3,"sources":["app.js"],"names":["configure","i18nInit","init","module","modules","pluginsWithModule","taiga","this","taigaContribPlugins","window","generateHash","components","_","map","x","JSON","stringify","hex_sha1","join","generateUniqueSessionIdentifier","date","randomNumber","Date","getTime","Math","floor","random","sessionId","$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","authHttpIntercept","blockingIntercept","decorators","defaultHeaders","loaderIntercept","originalWhen","preferedLangCode","userInfo","versionCheckHttpIntercept","classNameFilter","when","path","route","resolve","angular","extend","languageLoad","$q","$translate","deferred","defer","then","promise","call","templateUrl","controller","controllerAs","loader","title","description","joyride","reloadOnSearch","access","requiresLogin","section","redirectTo","params","pslug","disableHeader","mobileViewport","otherwise","html5Mode","enabled","requireBase","Content-Type","Accept-Language","taigaConfig","defaultLanguage","X-Session-Id","defaults","headers","patch","post","put","get","useApplyAsync","setSessionId","$location","$navUrls","$lightboxService","httpResponseError","response","nextUrl","status","config","cancelable","closeAll","replace","url","indexOf","encodeURIComponent","search","reject","responseError","factory","interceptors","push","loaderService","request","logRequest","requestError","rejection","logResponse","$injector","data","version","element","injector","invoke","_this","$confirm","versionErrorMsg","instant","notify","$routeParams","redirectToBlockedPage","responseOk","blockedUrl","currentUrl","project","blocked_code","debugInfoEnabled","debugInfo","localStorage","parse","lang","addPart","useLoader","urlTemplate","_version","useSanitizeValueStrategy","addInterpolation","preferredLanguage","fallbackLanguage","getDecorators","each","decorator","provider","messages","moment","locale","defaultMessage","type","email","urlstrict","number","digits","dateIso","alphanum","phone","notnull","notblank","required","regexp","min","max","range","minlength","maxlength","rangelength","mincheck","maxcheck","rangecheck","equalto","linewidth","pikaday","checksley","updateMessages","$log","$rootscope","$auth","$events","$analytics","appMetaService","projectService","navigationBarService","un","user","validators","debug","$on","refresh","val","width","lines","valid","nl2br","split","every","line","length","prettyDate","isValid","updateValidators","contribPlugins","adminPlugins","filter","userSettingsPlugins","e","ctx","language","Promise","setScheduler","cb","$evalAsync","setupConnection","isAuthenticated","getUser","initialize","event","next","start","setSection","setProjectBySlug","cleanProject","setAll","addMobileViewport","removeMobileViewport","enableHeader","plugin","value","concat","run","TaigaBase","TaigaController","TaigaService","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","bind","fn","me","apply","arguments","superClass","onInitialDataError","xhr","location","navUrls","q","Base","Service","Controller","bindMethods","bindOnce","cancelTimeout","debounce","debounceLeading","defineImmutableProperty","groupBy","isImage","joinStr","mixOf","replaceTags","scopeDefer","sizeFormat","slugify","startswith","stripTags","timeout","toString","toggleText","trim","truncate","unslugify","item","i","l","slice","str","breakTag","object","dependencies","methods","keys","forIn","bindAll","scope","attr","continuation","delBind","$eval","$watch","Mixed","base","method","mixin","mixins","name","ref","char","toLowerCase","capitalize","texts","nextTextPosition","text","coll","pred","len","result","wait","setTimeout","timeoutVar","clearTimeout","func","$apply","isNumber","isString","isPlainObject","isUndefined","leading","trailing","str1","str2","startsWith","maxLength","suffix","out","String","substring","lastIndexOf","input","precision","size","units","isNaN","parseFloat","isFinite","log","pow","toFixed","exception","pattern","RegExp","tags","obj","Object","defineProperty","fn_result","isFunction","isObject","removeKeys","chain","flatten","reduce","cartesianProduct","reduceRight","a","b","y","match","oldImmutable","newImmutable","pathObj","forEach","newValue","toJS","FiltersMixin","PageMixin","fillUsersAndRoles","users","roles","activeUsers","computableRoles","is_active","sortBy","activeUsersById","id","usersById","members","uniq","includes","loadUsersAndRoles","all","rs","projects","usersList","projectId","rolesList","results","selectFilter","load","existing","compact","isInCurrentRouteParams","noreload","replaceFilter","replaceAllFilters","filters","unselectFilter","newValues","parsedValues","isEmpty","AuthService","CancelAccountDirective","ChangeEmailDirective","ChangePasswordFromRecoveryDirective","ForgotPasswordDirective","InvitationDirective","LoginDirective","LoginPage","PublicRegisterMessageDirective","RegisterDirective","currentUserService","$inject","rootscope","storage","model","http","urls","translate","currentUserService1","themeService","userModel","_currentTheme","_getUserTheme","setUserdata","userData","Immutable","fromJS","getAttrs","setUser","theme","_setTheme","newTheme","use","_setLocales","make_model","auth","set","clear","remove","setToken","token","getToken","removeToken","auth_token","login","clone","logout","removeUser","register","getInvitation","invitations","acceptInvitiationWithNewUser","acceptInvitiationWithExistingUser","forgotPassword","changePasswordFromRecovery","changeEmail","cancelAccount","service","$config","templates","template","templateFn","publicRegisterEnabled","restrict","directive","link","$scope","$el","$attrs","form","onError","onSuccess","submit","Form","find","decodeURIComponent","loginFormType","preventDefault","validate","username","password","on","prerenderReady","off","onErrorSubmit","onSuccessSubmit","onlyOneErrorElement","trackEvent","_error_message","error","setErrors","message","success","$params","tokenInParams","loginForm","onErrorSubmitLogin","onErrorSubmitRegister","onSuccessSubmitLogin","onSuccessSubmitRegister","registerForm","submitLogin","submitRegister","invitation","dataLogin","project_slug","project_name","dataRegister","escape","$repo","$model","email_token","queryOne","cancel_token","TaigaMainDirective","$window","onresize","$broadcast","home","not-found","permission-denied","discover","discover-search","forgot-password","change-password","change-email","cancel-account","create-project","profile","user-profile","blocked-project","project-backlog","project-taskboard","project-kanban","project-issues","project-search","project-userstories-detail","project-tasks-detail","project-issues-detail","project-wiki","project-wiki-page","project-team","project-admin-home","project-admin-project-profile-details","project-admin-project-profile-default-values","project-admin-project-profile-modules","project-admin-project-profile-export","project-admin-project-profile-reports","project-admin-project-values-status","project-admin-project-values-points","project-admin-project-values-priorities","project-admin-project-values-severities","project-admin-project-values-triggers","project-admin-project-values-types","project-admin-project-values-custom-fields","project-admin-memberships","project-admin-roles","project-admin-third-parties-webhooks","project-admin-third-parties-github","project-admin-third-parties-gitlab","project-admin-third-parties-bitbucket","project-admin-contrib","user-settings-user-profile","user-settings-user-change-password","user-settings-user-avatar","user-settings-mail-notifications","user-settings-contrib","$navurls","update","AnimationFrame","Capslock","CheckPermissionDirective","ClassPermissionDirective","DataPickerConfig","ProjectUrl","Qqueue","SelectedText","Template","ToggleCommentDirective","i18n","previousMonth","nextMonth","months","weekdays","weekdaysShort","isRTL","firstDay","parseInt","format","$document","getSelection","selection","createRange","render","permission","removeClass","unObserve","unwatch","addClass","tgCheckPermission","$observe","checkPermissions","tgClassPermissionWatchAction","unbindWatcher","className","negation","my_permissions","classes","add","animationFrame","performAnimation","tail","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","time","shift","slug","is_backlog_activated","is_kanban_activated","is_wiki_activated","is_issues_activated","lastPromise","qqueue","bindAdd","args","$templateCache","lodash","tmp","hideIcon","open","showIcon","warningIcon","$","fadeOut","currentTarget","append","fadeIn","EventsProvider","EventsService","win","liveAnnouncementService1","rootScope","liveAnnouncementService","processMessage","subscriptions","connected","pendingMessages","missedHeartbeats","heartbeatInterval","WebSocket","info","loc","scheme","stopExistingConnection","protocol","trimStart","host","ws","addEventListener","onOpen","onMessage","onClose","removeEventListener","stopHeartBeatMessages","close","notifications","subscribe","show","desc","$digest","startHeartBeatMessages","heartbeatIntervalTime","maxMissedHeartbeats","setInterval","error1","Error","sendMessage","cmd","clearInterval","processHeartBeatPongMessage","serialize","msg","send","routingKey","subscription","routing_key","callback","unsubscribe","$get","$win","$conf","$rootScope","FeedbackDirective","$loading","feedbackService","openLightbox","submitButton","currentLoading","target","create","feedback","finish","focus","RelatedTaskAssignedToInlineEditionDirective","RelatedTaskCreateButtonDirective","RelatedTaskCreateFormDirective","RelatedTaskRowDirective","RelatedTasksDirective","$compile","$template","templateEdit","templateView","renderEdit","renderView","saveTask","task","subject","save","html","keyCode","$modelValue","perms","modify_task","delete_task","select","askOnDelete","askResponse","$emit","ngModel","require","$tgmodel","newTask","assigned_to","createTask","default_task_status","newRelatedTaskFormOpen","us","$rs","_isEditable","_isVisible","loadTasks","tasks","list","usId","showRelatedTasks","$ctrl","autoSave","notAutoSave","updateRelatedTask","member","imgurl","photo","full_name_display","tgRelatedTaskAssignedToInlineEdition","unbind","userId","updatedRelatedTask","ResourcesService","initResources","initUrls","auth-register","by_username","users-password-recovery","users-change-password-from-recovery","users-change-password","users-change-email","users-cancel-account","user-stats","user-liked","user-voted","user-watched","user-contacts","user-me","permissions","notify-policies","user-storage","memberships","bulk-create-memberships","resolver","project-templates","project-modules","bulk-update-projects-order","project-like","project-unlike","project-watch","project-unwatch","project-transfer-validate-token","project-transfer-accept","project-transfer-reject","project-transfer-request","project-transfer-start","userstory-statuses","points","task-statuses","issue-statuses","issue-types","priorities","severities","triggers","milestones","userstories","bulk-create-us","bulk-update-us-backlog-order","bulk-update-us-sprint-order","bulk-update-us-kanban-order","userstories-filters","userstory-upvote","userstory-downvote","userstory-watch","userstory-unwatch","bulk-create-tasks","bulk-update-task-taskboard-order","task-upvote","task-downvote","task-watch","task-unwatch","issues","bulk-create-issues","issues-filters","issue-upvote","issue-downvote","issue-watch","issue-unwatch","wiki","wiki-restore","wiki-links","history/us","history/issue","history/task","history/wiki","attachments/us","attachments/issue","attachments/task","attachments/wiki_page","custom-attributes/userstory","custom-attributes/issue","custom-attributes/task","custom-attributes-values/userstory","custom-attributes-values/issue","custom-attributes-values/task","webhooks","webhooks-test","webhooklogs","webhooklogs-resend","userstories-csv","tasks-csv","issues-csv","timeline-profile","timeline-user","timeline-project","exporter","importer","locales","applications","application-tokens","stats-discover","$urls","providers","toArray","SearchBoxDirective","SearchController","SearchDirective","scope1","repo","loadSearchData","sectionName","loadInitialData","projectName","projectDescription","searchTerm","t","searchResults","term","loadFilters","defered","loadProject","getBySlug","issueStatusById","issue_statuses","taskStatusById","task_statuses","severityById","triggerById","priorityById","usStatusById","us_statuses","loading","_loadSearchData","_promise","abort","$route","reload","$templatecache","$routeparams","linkTable","activeSectionName","applyAutoTab","getActiveSection","lastSearchResults","markSectionTabActive","renderFilterTabs","renderTableContent","tabsDom","maxVal","selectedSection","wikipages","oldElements","oldScope","children","$destroy","$new","parseHTML","activeSection","sectionData","searchText","AnalyticsService","doc","conf","initialized","accountId","pageEvent","trackRoutes","ignoreFirstPageLoad","injectAnalytics","ga","getUrl","trackPage","s","o","g","r","m","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","page","category","action","label","BindScope","jQuery","CompileHtmlDirective","attrs","tgCompileHtml","oldValue","contents","AssignedToDirective","BlockButtonDirective","CreatedByDisplayDirective","DateRangeDirective","DateSelectorDirective","DeleteButtonDirective","EditableDescriptionDirective","EditableSubjectDirective","EditableWysiwyg","ListItemAssignedtoDirective","ListItemIssueStatusDirective","ListItemPriorityDirective","ListItemSeverityDirective","ListItemTaskStatusDirective","ListItemTriggerDirective","ListItemTypeDirective","ListItemUsStatusDirective","SprintProgressBarDirective","TgMainTitleDirective","TgProgressBarDirective","WatchersDirective","renderRange","first","second","endDate","initDate","tgDateRange","valFirst","valSecond","datePickerConfigService","selectedDate","datePickerConfig","merge","field","onSelect","picker","setDate","Pikaday","renderProgress","percentage","visual_percentage","hasClass","css","tgSprintProgressbar","sprint","closedPoints","totalPoints","closed_points","total_points","round","owner","owner_extra_info","created_date","$qqueue","deleteWatcher","isEditable","renderWatchers","ref1","requiredPerm","watchers","$setViewValue","watcherId","revert","watcherIds","pull","$currentUserService","renderAssignedTo","assignedObject","fullName","isIocaine","isUnassigned","assigned_to_extra_info","is_iocaine","fullNameVisible","ask","instance","is_blocked","onDeleteGoToUrl","onDeleteTitle","subtitle","hide","click","$selectedText","noDescriptionMegEditMode","noDescriptionMegReadMode","is","href","scrollTop","offset","top","noDescriptionMsg","attachmentsService","attachmentsFullService","isInEditMode","uploadFile","file","addAttachment","getIn","textarea","dataTransfer","promises","stopPropagation","originalEvent","files","markItUp","replaceWith","tgListitemUsStatus","tgListitemTaskStatus","tgListitemAssignedto","issue","tgListitemIssueStatus","issueTypeById","domNode","color","tgListitemType","priority","tgListitemPriority","severity","tgListitemSeverity","tgListitemTrigger","trigger","el","tgProgressBar","i18nSectionName","ConfirmService","NOTIFICATION_MSG","light-error","lightboxService","lightboxSelector","ok","askChoice","choices","replacement","warning","choicesField","selected","icon","detailImage","useSVG","createElementNS","setAttributeNS","classList","appendChild","prepend","stop","percent","body","selector","tsem","one","CustomAttributeValueDirective","CustomAttributesValuesController","CustomAttributesValuesDirective","DATE_TYPE","MULTILINE_TYPE","SELECT_TYPE","TEXT_TYPE","TYPE_CHOICES","URL_TYPE","confirm","objectId","customAttributes","customAttributesValues","loadCustomAttributesValues","getAttributeValue","attribute","attributeValue","attributes_values","updateAttributeValue","attributesValues","$templates","$storage","collapsedHash","$ctrls","collapsed","hash","requiredEditionPerm","setFocusAndSelectOnInputField","edit","editable","tgCustomAttributeValue","EstimationsService","LbUsEstimationDirective","UsEstimationDirective","$tgEstimationsService","estimationProcess","onSelectedPointForRole","roleId","pointId","mainTemplate","calculateTotalPoints","calculateRoles","EstimationProcess","pointsTemplate","$el1","us1","project1","bindClickEvents","pointsById","notNullValues","values","v","k","acc","num","role","pointObj","renderPointsSelector","siblings","popover","horizontalList","maxPointLength","pop","point","some","horizontal","closest","height","clientHeight","defaultFilter","momentFormat","momentFromNow","yesNoFilter","defaultValue","without_suffix","fromNow","HistoryController","HistoryDirective","IGNORED_FIELDS","userstories.userstory","tasks.task","issues.issue","loadHistory","history","changeModel","historyEntry","historyResult","j","len1","values_diff","description_diff","description_html","blocked_note_diff","blocked_note","blocked_note_html","comments","comment","deleteComment","activityId","undeleteComment","checkPermissionsService","templateActivity","templateBase","templateBaseEntries","templateChangeAttachment","templateChangeDiff","templateChangeGeneric","templateChangeList","templateChangePoints","templateDeletedComment","countChanges","formatChange","getHumanizedFieldName","getPrettyDateFormat","renderActivity","renderAttachmentEntry","renderBase","renderChange","renderChangeEntries","renderChangeEntry","renderChangesHelperText","renderComment","renderComments","renderCustomAttributesEntry","renderHistory","rerender","showAllActivity","showAllComments","humanizedFieldNames","content","is_closed","finish_date","milestone","user_story","client_requirement","team_requirement","attachments","is_deprecated","order","backlog_order","sprint_order","kanban_order","taskboard_order","us_order","change","isArray","changes","diff","filename","from","to","outerHTML","customAttrsChanges","added","removed","difference","ref2","delete_comment_date","delete_comment_user","deleteCommentDate","deleteCommentUser","comment_html","canRestoreComment","pk","avatar","userFullName","userProfileUrl","creationDate","created_at","changesText","mode","deleteCommentActionTitle","canDeleteComment","entries","totalEntries","showMore","commentsVisible","historyVisible","check","ngmodel","totalComments","takeRight","totalChanges","parents","toggleClass","ImportProjectButtonDirective","LbImportErrorDirective","$lightboxFactory","$tgAuth","getRestrictionError","errorKey","maxMemberships","membersError","privateError","publicError","isPrivate","canCreatePrivateProjects","canCreatePublicProjects","max_memberships","loadProjects","errorMsg","restrictionError","class","error_message","AssignedToLightboxDirective","AttachmentPreviewLightboxDirective","BlockLightboxDirective","BlockingMessageInputDirective","CreateBulkUserstoriesDirective","CreateEditUserstoryDirective","LightboxDirective","LightboxKeyboardNavigationService","LightboxLeaveProjectWarningDirective","LightboxService","WatchersLightboxDirective","docEl","lightboxContent","not","code","which","removeAttr","lightboxEl","dispatch","activeElement","prev","$tgrepo","block","unblock","finishCallback","watch","attachmentsToAdd","attachmentsToDelete","createAttachments","deleteAttachments","resetAttachments","createEditUs","isNew","List","attachment","deleteAttachment","statusList","reset","usStatusList","is_archived","upload","broadcastEvent","keydown","statusId","bulk","bulkCreate","lightboxKeyboardNavigationService","closeLightbox","filterUsers","normalizeString","selectedItem","selectedUser","usersTemplate","string","normalizedString","toUpperCase","partial","assignedToId","searchingText","usersSearch","getFilteredUsers","_filterUsers","Loader","LoaderDirective","tgLoader","onStart","onEnd","autoClose","lastResponseDate","pageLoaded","requestCount","startLoadTime","minTime","force","endTime","timeoutValue","intervalAuto","auto","LoadingDirective","TgLoadingService","spinner","settings","removeClasses","classess","timeoutId","tgLoading","showLoading","RelatedTaskStatusDirective","UsStatusDirective","usStatusDom","usStatusDomParent","tgUsStatus","onUpdate","statuses","selectionTemplate","updateTaskStatus","taskStatusDom","taskStatusDomParent","tgRelatedTaskStatus","closePopover","isVisible","docViewBottom","docViewLeft","docViewRight","docViewTop","docViewWidth","elemBottom","elemLeft","elemRight","elemTop","elemWidth","display","visibility","left","ExceptionHandlerFactory","ravenConfig","Raven","install","cause","captureException","ColorizeTagsDirective","LbTagLineDirective","TagLineDirective","TagsDirective","formatter","parser","$formatters","$parsers","backlog","kanban","taskboard","srcTags","tgColorizeTagsType","sort","tag","tags_colors","tgColorizeTags","COMMA_KEY","ENTER_KEY","templateTags","addValue","deleteValue","hideSaveButton","renderTags","resetInput","saveInputTag","showSaveButton","tagsColors","style","autocomplete","fromCharCode","positioningFunction","position","elements","menu","source","my","using","ui","ESC_KEY","hideAddTagButton","hideAddTagButtonText","hideInput","renderInReadModeOnly","showAddTagButton","showAddTagButtonText","showInput","blur","MarkitupDirective","previewTemplate","addLine","cancelablePromise","closePreviewMode","markdownTitle","prepareUrlFormatting","preview","previewDomNode","previewInProgress","renderMarkItUp","setCaretPosition","urlFormatting","markItUpDomNode","markdownDomNode","mdrender","markdown","caretPosition","scrollRelation","totalLines","createTextRange","move","selectionStart","setSelectionRange","scrollHeight","nline","cursorPosition","indices","regex","exec","index","donotparse","endIndex","startIndex","heading","n","placeHolder","markdownSettings","nameSpace","onShiftEnter","keepDefault","openWith","onEnter","afterInsert","cursorLine","emptyListItem","lastLine","markdownCaretPositon","newLineContent","markupSet","closeWith","separator","beforeInsert","markItUpRemove","textcomplete","cache","searchProps","searchTypes","prop","res","count","BacklogFiltersDirective","templateSelected","currentFiltersType","getFiltersType","initializeSelectedFilters","reloadUserstories","renderFilters","renderSelectedFilters","selectQFilter","selectedFilters","showCategories","showFilters","toggleFilterSelection","f","loadUserstories","generateFilters","currentFilters","CreateEditSprint","createSprint","getLastSprint","hasErrors","resetSprint","estimated_start","estimated_finish","newSprint","copy","setAttr","sprintsCounter","__all__","milestonesCounter","openSprints","sortedSprints","sprints","closed","estimatedFinish","estimatedStart","lastSprint","lastSprintNameDom","editSprint","BacklogController","BacklogDirective","BurndownBacklogGraphDirective","TgBacklogProgressBarDirective","ToggleBurndownVisibility","UsPointsDirective","UsRolePointsSelectorDirective","params1","events","analytics","rs2","showTags","activeFilters","showGraphPlaceholder","initializeEventHandlers","getShowTags","loadProjectStats","loadSprints","loadClosedSprints","moveUs","unloadClosedSprints","initializeSubscription","routingKey1","routingKey2","toggleShowTags","storeShowTags","toggleActiveFilters","stats","defined_points","completedPercentage","total_milestones","closedSprints","totalClosedMilestones","user_stories","closedSprintsById","totalMilestones","totalOpenMilestones","reverse","sprintsById","currentSprint","findCurrentSprint","restoreFilters","selectedStatuses","selectedTags","oldSelectedTags","oldSelectedStatuses","filtersQ","filtersQOld","filterGrp","resetFilters","httpParams","getUrlFilters","storeQueryParams","listUnassigned","setSearchDataFilters","loadBacklog","closedMilestones","total_closed_milestones","prepareBulkUpdateData","uses","us_id","resortUserStories","items","isModified","usList","newUsIndex","newSprintId","len2","movedFromClosedSprint","movedToClosedSprint","oldSprintId","splice","Array","bulkUpdateBacklogOrder","bulkUpdateSprintOrder","console","len3","isFilterSelected","searchdata","urlfilters","results1","pick","filtersData","choicesFiltersFormat","tagsFilterFormat","byIdObject","markSelectedFilters","isSelected","omit","updateUserStoryStatus","editUserStory","$event","getByRef","deleteUserStory","without","addNewUs","default_us_status","addNewSprint","currentDate","end","doomLineTemplate","linkDoomLine","linkFilters","linkToolbar","showHideFilter","showHideTags","addDoomLineDom","getUsItems","reloadDoomLine","removeDoomlineDom","current_sum","domElement","assigned_points","before","rowElements","checkSelected","getUsToMove","lastChecked","moveToCurrentSprint","moveToLatestSprint","moveUssToSprint","shiftPressed","ussDom","itemScope","selectedUss","extraPoints","totalExtraPoints","ussCurrent","union","saveAll","moveToSprintDom","selectedUsDom","shiftKey","current","nextAll","prevAll","nextUntil","prevUntil","elm","ussToMove","hideText","showText","sidebar","filtersSearch","disableSelection","numberOfRoles","roleName","rolScope","$tgTemplate","rolesTemplate","bindClickElements","filteringRoleId","renderRolesSelector","selectedRoleId","updatingSelectedRoleId","tgBacklogUsPoints","popRolesDom","firstLoad","toggleGraph","isBurndownGraphCollapsed","redrawChart","dataToDraw","client_increment_line","colors","evolution_line","milestonesRange","optimal_line","options","team_increment_line","zero_line","ml","zip","fillColor","optimal","evolution","grid","borderWidth","right","bottom","borderColor","hoverable","xaxis","ticks","axisLabel","axisLabelUseCanvas","axisLabelFontSizePixels","axisLabelFontFamily","axisLabelPadding","tickFormatter","axis","yaxis","series","shadowSize","fill","radius","lineWidth","tooltip","tooltipOpts","xval","yval","flotItem","seriesIndex","sprintName","abs","empty","plot","adjustPercentaje","projectPointsPercentaje","closedPointsPercentaje","adjusted","tgBacklogProgressBar","definedPoints","BacklogEmptySortableDirective","BacklogSortableDirective","SprintSortableDirective","deleteElement","$tgConfirm","getUsIndex","filterError","sortable","cancel","connectWith","dropOnEmpty","placeholder","scroll","disableHorizontalScroll","tolerance","itemIndex","itemUs","forcePlaceholderSize","BacklogSprintDirective","BacklogSprintHeaderDirective","ToggleExcludeClosedSprintsVisualization","slideOptions","sprintTableMinHeight","toggleSprint","duration","easing","sprintArrow","sprintTable","tgBacklogSprint","slideToggle","compiledTemplate","estimatedDateRange","taskboardUrl","templateScope","assign","excludeClosedSprints","loadingElm","after","SprintGraphDirective","days","day","unshift","d","optimal_points","open_points","tickSize","last","daysNames","formattedDate","roundedValue","CreateBulkTasksDirective","CreateEditTaskDirective","sprintId","TaskboardController","TaskboardDirective","TaskboardSquishColumnDirective","TaskboardTaskDirective","TaskboardUserDirective","rs1","_setMeta","startDate","completedPoints","completedPointsSum","totalPointsSum","openTasks","totalTasks","total_tasks","loadTaskboard","taskMove","refreshTagsColors","loadSprintStats","loadSprint","pointsList","roleById","taskStatusList","remainingPointsSum","remainingTasks","completed_points","completed_tasks","usTasks","isPlaceholder","sslug","refreshTasksOrder","resortTasks","bulkUpdateTaskTaskboardOrder","task_id","addNewTask","editTaskAssignedTo","tableBodyDom","tableHeaderDom","scrollLeft","$rs2","editingTask","avatarWidth","maxColumnWidth","getCeilWidth","recalculateStatusColumnWidth","recalculateTaskboardWidth","refreshTaskboardTableWidth","setStatusColumnWidth","statusesFolded","getStatusColumnModes","usFolded","getUsRowModes","foldStatus","storeStatusColumnModes","foldUs","storeUsRowModes","tasksMatrixSize","sqrt","column","columnWidths","columns","totalWidth","outerWidth","total","statusFoldedWidth","clickable","username_label","TaskboardSortableDirective","itemEl","newParentScope","oldParentScope","tdom","handle","itemTask","newStatusId","newUsId","oldStatusId","oldUsId","parentEl","st","KanbanArchivedStatusHeaderDirective","KanbanArchivedStatusIntroDirective","KanbanController","KanbanDirective","KanbanSquishColumnDirective","KanbanUserDirective","KanbanUserstoryDirective","KanbanWipLimitDirective","defaultViewMode","viewModes","statusViewModes","onAssignedToChanged","loadUserStoriesForStatus","hideUserStoriesForStatus","changeUsAssignedTo","userid","status__is_archived","listAll","usByStatus","us_archived","loadKanban","generateStatusViewModes","storedStatusViewModes","getStatusViewModes","storeStatusViewModes","updateStatusViewMode","newViewMode","isMaximized","isMinimized","itemsToSave","bulkUpdateKanbanOrder","hideArchivedText","showArchivedText","hidden","tgKanbanArchivedStatusHeader","userStories","hiddenUserStoriexText","updateIntroText","tgKanbanArchivedStatusIntro","isArchived","userStoriesLoaded","editingUserStory","getTemplateUrl","updateTableWidth","folds","redrawWipLimit","tgKanbanWipLimit","wip_limit","wtid","tgKanbanUserAvatar","KanbanSortableDirective","IssueDetailController","IssuePriorityButtonDirective","IssueSeverityButtonDirective","IssueStatusButtonDirective","IssueStatusDisplayDirective","IssueTriggerButtonDirective","IssueTypeButtonDirective","PromoteIssueToUsButtonDirective","issueRef","issueref","initializeOnDeleteGoToUrl","ref3","ref4","issueSubject","issueStatus","statusById","issueType","typeById","issueSeverity","issueTrigger","issuePriority","issueDescription","loadIssue","issue_types","typeList","severityList","triggerList","priorityList","issueId","commentModel","neighbors","previous","previousUrl","onUpvote","upvote","onDownvote","downvote","onWatch","onUnwatch","typees","severityes","triggeres","priorityes","generated_from_issue","CreateBulkIssuesDirective","CreateIssueDirective","default_issue_status","default_issue_type","default_priority","default_severity","default_trigger","IssueAssignedToInlineEditionDirective","IssueStatusInlineEditionDirective","IssueTriggerInlineEditionDirective","IssuesController","IssuesDirective","IssuesFiltersDirective","loadIssues","getFilters","storeFilters","issueStatusList","issueTypes","getUrlFilter","loadMyFilters","getMyFilters","removeNotExistingFiltersFromUrl","currentSearch","existingValues","filterName","filterValue","splittedValues","intersection","myFilters","types","assignedTo","createdBy","usersFiltersFormat","unknownOption","reformatedUsers","unknownItem","full_name","u","owners","loadIssuesRequests","urlFilters","models","paginatedBy","saveCurrentFiltersTo","newFilter","storeMyFilters","deleteMyFilter","addNewIssue","addIssuesInBulk","linkOrdering","linkPagination","$pagEl","afterCurrent","atBegin","atEnd","beforeCurrent","getNumPages","renderPagination","numPages","cpage","pages","showPrevious","showNext","pagenum","colHeadElement","currentOrder","finalOrder","newOrder","reloadIssues","unwatchIssues","filterId","customFilterName","loadPromise","currentfilterstype","updateIssueStatus","issueStatusDom","issueStatusDomParent","tgIssueStatusInlineEdition","updateIssueTrigger","issueTriggerDom","issueTriggerDomParent","tgIssueTriggerInlineEdition","updateIssue","tgIssueAssignedToInlineEdition","updatedIssue","UsClientRequirementButtonDirective","UsStatusButtonDirective","UsStatusDisplayDirective","UsTeamRequirementButtonDirective","UserStoryDetailController","usRef","usref","closedTasks","progressPercentage","userStoryRef","userStorySubject","userStoryStatus","userStoryPoints","userStoryDescription","userStoryClosedTasks","userStoryTotalTasks","userStoryProgressPercentage","allClosed","loadUs","kanbanStaus","noMilestone","order_by","canEdit","isRequired","TaskDetailController","TaskIsIocaineButtonDirective","TaskStatusButtonDirective","TaskStatusDisplayDirective","taskRef","taskref","taskSubject","taskStatus","taskDescription","loadTask","taskId","loadUserStory","LeaveProjectDirective","TeamController","TeamFiltersDirective","TeamMemberCurrentUserDirective","TeamMemberStatsDirective","TeamMembersDirective","membersFilter","setRole","filtersRole","loadMembers","totals","currentUser","issuesEnabled","tasksEnabled","wikiEnabled","loadMemberStats","memberStats","vals","statsKey","sum","_processStats","_processStat","stat","singleStat","userRoles","lightboxFactory","leaveConfirm","confirm_leave_project_text","leave_project_text","leave","isCurrentUser","EditableWikiContentDirective","WikiDetailController","WikiSummaryDirective","projectSlug","wikiSlug","wikiTitle","linksVisible","wikiPageName","wikiPageContent","totalEditions","editions","lastModifiedDate","modified_date","loadWiki","wikiId","loadWikiLinks","listLinks","wikiLinks","selectedWikiLink","checkLinksPerms","last_modifier","imgUrl","wikiPage","cancelEdition","disableEdition","getSelectedText","switchToEditMode","switchToReadMode","button","WikiNavDirective","addWikiLinkPermission","deleteWikiLinkPermission","linkId","linkSlug","newLink","ChangeOwnerLightboxController","ChangeOwnerLightboxDirective","LbRequestOwnershipDirective","LightboxAddMembersController","LightboxAddMembersDirective","LightboxAddMembersWarningMessageDirective","TransferProjectStartSuccessDirective","lightboxService1","pendingMembersCount","_defaultMaxInvites","_defaultRole","submitInvites","canAddUsers","memberInvites","membersLimit","total_memberships","addSingleMember","role_id","showWarningMessage","removeSingleMember","initializeFields","invites","bulkCreateMemberships","invitationText","_onSuccessInvite","_onErrorInvite","ctrl","bindToController","confirmService","transferRequest","commentOpen","limit","getUsers","currentOwnerId","userSearch","selectUser","transferStart","MembershipsController","MembershipsDirective","MembershipsRowActionsDirective","MembershipsRowAdminCheckboxDirective","MembershipsRowAvatarDirective","MembershipsRowRoleSelectorDirective","NoMoreMembershipsExplanationDirective","lightboxFactory1","i_am_admin","httpFilters","membership","is_user_active","addNewMembers","showLimitUsersWarningMessage","pending","user_email","isOwner","is_owner","tgMembershipsRowAvatar","tgMembershipsRowAdminCheckbox","inputId","is_admin","roleList","selectedRole","tgMembershipsRowRoleSelector","newRole","activedTemplate","pendingTemplate","tgMembershipsRowActions","resendInvitation","defaultMsg","AdminNavigationDirective","tgAdminNavigation","AdminProjectChangeOwnerDirective","AdminProjectRequestOwnershipDirective","AdminProjectRestrictionsDirective","CsvExporterController","CsvExporterIssuesController","CsvExporterTasksController","CsvExporterUserstoriesController","CsvIssueDirective","CsvTaskDirective","CsvUsDirective","ProjectDefaultValuesDirective","ProjectExportDirective","ProjectLogoDirective","ProjectLogoModelDirective","ProjectModulesDirective","ProjectProfileController","ProjectProfileDirective","tgAuth","prioritiesList","severitiesList","triggersList","issueTypesList","openDeleteLightbox","newUrl","fetchProject","newVal","oldVal","videoconferences_extra_data","videoconferences","isVideoconferenceActivated","asyn_message","buttonsEl","dump_ready_text","hideButtons","hideResult","hideSpinner","loading_msg","loading_title","resultEl","resultMessageEl","resultTitleEl","setAsyncMessage","setAsyncTitle","setLoadingMessage","setLoadingTitle","setSyncMessage","setSyncTitle","showButtons","showErrorMode","showExportResultAsyncMode","showExportResultSyncMode","showLoadingMode","showResult","showSpinner","spinnerEl","syn_message","dumpUrl","_generateUuid","setCsvUuid","csvUrl","resolveAbsolute","csvUuid","uuid","regenerateUuid","sectionTitle","showSizeInfo","logoAttachment","changeLogo","removeLogo","$parse","modelSetter","tgProjectLogoModel","requestOwnership","changeOwner","project-id","active-users","current-owner-id","ColorSelectionDirective","ProjectCustomAttributesController","ProjectCustomAttributesDirective","ProjectValuesController","ProjectValuesDirective","ProjectValuesSectionController","moveValue","loadValues","resource","listValues","maxValueOrder","maxBy","itemValue","linkDragAndDrop","linkValue","goToBottomList","initializeNewValue","initializeTextTranslations","objName","saveNewValue","saveValue","valueType","objname","addNewElementText","table","formEl","row","editionRow","option","onSucces","moveTo","moveCustomAttributes","deleteCustomAttribute","saveCustomAttribute","createCustomAttribute","loadCustomAttributes","maxOrder","attrValues","attrModel","newIndex","idx","cancelCreate","cancelUpdate","hideAddButton","hideCancelButton","hideCreateForm","hideEditForm","resetNewAttr","revertChangesInCustomAttribute","showAddButton","showCancelButton","showCreateForm","showEditForm","sortableEl","itemAttr","newAttr","EditRoleDirective","NewRoleDirective","RolePermissionsDirective","RolesController","RolesDirective","_disableComputable","_enableComputable","anyComputableRole","computable","loadRoles","public_permission","external_user","public_permissions","askOnError","askOnSuccess","toggleComputable","toggleView","toggle","DEFAULT_PERMISSIONS","insertPosition","baseTemplate","categoryTemplate","resumeTemplate","generateCategoriesFromRole","renderCategory","renderPermissions","renderResume","categories","isPermissionEditable","issuePermissions","milestonePermissions","setActivePermissions","setActivePermissionsPerCategory","taskPermissions","userStoryPermissions","wikiPermissions","active","is_private","cat","activePermissions","getActivePermissions","categoryId","anon_permissions","BitbucketController","BitbucketWebhooksDirective","GithubController","GithubWebhooksDirective","GitlabController","GitlabWebhooksDirective","NewWebhookDirective","SelectInputText","ValidOriginIpsDirective","WebhookDirective","WebhooksController","loadWebhooks","openHistory","showEditMode","showVisualizationMode","updateLogs","updateShowHideHistoryText","webhook","tgWebhook","validStatus","prettySentHeaders","toPairs","request_headers","arg","header","prettySentData","request_data","created","logs_counter","logs","historyElement","textElement","test","resend","addWebhookDOMNode","formDOMNode","loadModules","github","gitlab","bitbucket","saveAttribute","$ngModel","createProjectRestrictionDirective","CreateProject","DeleteProjectDirective","$projectUrl","$cacheFactory","removeAll","error_field","selectors","creation_template","head","projectToDelete","BindHtmlDirective","BindOnceAltDirective","BindOnceBindDirective","BindOnceHrefDirective","BindOnceHtmlDirective","BindOnceRefDirective","BindOnceSrcDirective","BindOnceTitleDirective","BindTitleDirective","tgBoBind","tgBoHtml","tgBoRef","tgBoSrc","tgBoHref","tgBoAlt","tgBoTitle","tgTitleHtml","tgBindHtml","ConfigurationService","has","ContribController","ContribUserSettingsController","currentPlugin","FiltersStorageService","HttpService","cacheFactory","locationFactory","lastRoute","Model","ModelService","dataTypes","_attrs","_name","_dataTypes","setAttrs","_modifiedAttrs","_isModified","applyCasts","attrName","castMethod","castName","casts","getIdAttrName","getName","getter","self","setter","substr","enumerable","configurable","isAttributeModified","markSaved","desSerialize","sdata","ddata","$http","$gmUrls","$gmStorage","cls","int","float","NavigationUrlsDirective","NavigationUrlsService","formatUrl","replacer","bindOnceP","parseNav","param","tgNavGetParams","tgNav","fullUrl","getURLParams","getURLParamsStr","metaKey","ctrlKey","RepositoryService","model1","resolveUrlForModel","idAttrName","resolveUrlForAttributeModel","extraParams","_data","_status","queryMany","httpOptions","enablePagination","queryOneAttribute","queryOneRaw","queryPaginated","queryOnePaginatedRaw","wikipage","StorageService","_default","serializedValue","getItem","setItem","contains","removeItem","UrlsService","fmt","mainUrl","trimEnd","resourceProvider","_get","userstory","_list","filtersHashSuffix","hashSuffix","myFiltersHashSuffix","getQueryParams","listInAllProjects","project_id","bulk_issues","ns","innerPromise","hashSuffixStatusColumnModes","hashSuffixStatusViewModes","listByUser","invitation_extra_text","bulk_memberships","notifyPolicies","listByMember","memberId","bulkUpdateOrder","bulkData","regenerate_userstories_csv_uuid","regenerate_issues_csv_uuid","regenerate_tasks_csv_uuid","statusUpdater","complete","failed","maxFileSize","uploadComplete","uploadFailed","uploadProgress","fileName","fileSize","evt","loaded","uploadedSize","totalSize","responseText","getResponseHeader","FormData","XMLHttpRequest","setRequestHeader","transformRequest","identity","deferredAbort","get_all","noop","hashSuffixUsRowModes","userStoryId","sprint_id","bulk_tasks","changeAvatar","removeAvatar","changePassword","currentPassword","newPassword","current_password","userSettings","contacts","status_id","bulk_stories","webhookId","webhooklogId","UserChangePasswordController","UserChangePasswordDirective","newPassword1","newPassword2","DeleteUserDirective","TaigaAvatarModelDirective","UserAvatarDirective","UserProfileDirective","UserSettingsController","getLan","getTheme","maxFileSizeMsg","availableThemes","avatarAttachment","tgAvatarModel","UserSettingsNavigationDirective","tgUserSettingsNavigation","UserNotificationsController","UserNotificationsDirective","UserNotificationsListDirective","policy","policyIndex","prev_level","notify_level","AttachmentLinkDirective","tgAttachmentLink","AttachmentGalleryDirective","onDelete","AttachmentController","editMode","mergeIn","AttachmentDirective","AttachmentsDropDirective","eventAttr","tgAttachmentsDrop","AttachmentsFullController","deprecatedsCount","attachmentsVisible","deprecatedsVisible","uploadingAttachments","objId","setMode","toggleDeprecatedsVisible","addAttachments","loadAttachments","toDeleteAttachment","errorMessage","reorderAttachment","updateAttachment","toUpdateAttachment","hasPermission","editPermission","showAttachments","AttachmentsFullDirective","AttachmentsFullService","_attachments","_deprecatedsCount","_attachmentsVisible","_deprecatedsVisible","regenerate","it","uploading","Map","oldIndex","findIndex","setIn","oldAttachment","AttachmentsSimpleController","onAdd","AttachmentsSimpleDirective","AttachmentSortableDirective","tgAttachmentsSortable","containment","helper","AutoSelectDirective","$timeout","FileChangeDirective","tgFileChange","JoyRideDirective","joyRideService","initJoyrRide","intro","unsuscribe","introJs","oncomplete","onexit","disableJoyRide","setOptions","exitOnEsc","exitOnOverlayClick","showStepNumbers","nextLabel","prevLabel","skipLabel","doneLabel","disableInteraction","setOption","loadJoyRideConfig","exit","JoyRideService","getConfig","dashboard","steps","joyRide","joyRides","LiveAnnouncementDirective","defineProperties","LiveAnnouncementService","ProjectLogoBigSrcDirective","projectLogoService","logo","projectLogo","getDefaultProjectLogo","ProjectLogoSmallSrcDirective","ProjectMenuController","_getActiveSection","_setVideoConference","_setMenuPermissions","videoconferenceUrl","_videoConferenceUrl","indexBacklog","indexKanban","oldSectionName","sectionsBreadcrumb","baseUrl","ProjectMenuDirective","projectChange","vm","fixed","TermsOfServiceAndPrivacyPolicyNoticeDirective","privacyPolicyUrl","termsOfServiceUrl","VoteButtonController","isMouseOver","showTextWhenMouseIsOver","showTextWhenMouseIsLeave","toggleVote","is_voter","_downvote","_upvote","VoteButtonDirective","WatchButtonController","openWatchers","getPerms","toggleWatch","is_watcher","_unwatch","_watch","WatchButtonDirective","attributes","environment","DiscoverHomeOrderByController","is_open","week","month","year","currentText","currentOrderBy","orderBy","onChange","DiscoverHomeOrderByDirective","DiscoverSearchBarController","discoverProjectsService","projectsCount","fetchStats","submitFilter","DiscoverSearchBarDirective","DiscoverSearchListHeaderController","like_is_open","activity_is_open","openLike","setOrderBy","openActivity","DiscoverSearchListHeaderDirective","FeaturedProjectsController","featured","fetchFeatured","FeaturedProjectsDirective","HighlightedDirective","highlighted","MostActiveController","mostActive","getOrderBy","fetch","fetchMostActive","MostActiveDirective","MostLikedController","mostLiked","fetchMostLiked","MostLikedDirective","DiscoverHomeController","onSubmit","DiscoverSearchController","routeParams","searchResult","nextSearchPage","loadingGlobal","loadingList","loadingPagination","resetSearchList","fetchByGlobalSearch","fetchByOrderBy","getFilter","fetchSearch","is_looking_for_people","onChangeFilter","updateParams","onChangeOrder","DiscoverSearchDirective","DiscoverProjectsService","projectsService","_mostLiked","_mostActive","_featured","_searchResult","_projectsCount","decorate","_decorate","_nextSearchPage","_discoverParams","discover_mode","_params","getProjects","is_featured","ExternalAppController","externalAppsService","xhrError","loginUrl","createApplicationToken","_getApplicationToken","_redirect","_applicationId","application","_state","state","_user","_application","loginWithAnotherUserUrl","applicationToken","getApplicationToken","back","authorizeApplicationToken","ExternalAppsService","applicationId","externalapps","FeedbackService","sendFeedback","DutyDirective","navurls","duty","getDutyType","HomeController","HomeService","_attachProjectInfoToWorkInProgress","workInProgress","projectsById","_attachProjectInfoToDuty","_duties","watching","objType","getWorkInProgress","assignedIssuesPromise","assignedTasksPromise","assignedUserStoriesPromise","params_us","projectsPromise","watchingIssuesPromise","watchingTasksPromise","watchingUserStoriesPromise","getProjectsByUserId","p","status__is_closed","HomeProjectListDirective","newProject","WorkingOnController","homeService","_setAssignedTo","elem","_setWatching","WorkingOnDirective","DropdownProjectListDirective","DropdownUserDirective","authService","configService","locationService","navUrlsService","isFeedbackEnabled","userMenu","NavigationBarDirective","isEnabledHeader","NavigationBarService","enabledHeader","ProfileBarController","userService","loadStats","getStats","ProfileBarDirective","ProfileContactsController","loadContacts","getContacts","ProfileContactsDirective","FavItemDirective","itemType","FavsBaseController","ProfileLikedController","ProfileVotedController","ProfileWatchedController","_init","enableFilterByAll","enableFilterByProjects","enableFilterByUserStories","enableFilterByTasks","enableFilterByIssues","enableFilterByTextQuery","_resetList","scrollDisabled","_page","_enableLoadingSpinner","isLoading","_disableLoadingSpinner","_enableScroll","_disableScroll","_checkIfHasMorePages","hasNext","_checkIfHasNoResults","hasNoResults","loadItems","_getItems","filterByTextQuery","showAll","showProjectsOnly","showUserStoriesOnly","showTasksOnly","showIssuesOnly","getLiked","getVoted","getWatched","ProfileLikedDirective","ProfileVotedDirective","ProfileWatchedDirective","ProfileHints","hintKey","HINTS","hint","linkText","ProfileProjectsController","attachUserContactsToProjects","ProfileProjectsDirective","ProfileTabDirective","transclude","tab","tabIcon","iconName","tabActive","tabDisabled","addTab","ProfileTabsController","tabs","toggleTab","ProfileTabsDirective","ProfileController","getUserByUserName","notFound","userUsername","BlockedProjectExplanationDirective","LikeProjectButtonController","likeButtonService","toggleLike","_unlike","_like","like","unlike","LikeProjectButtonDirective","LikeProjectButtonService","_getProjectIndex","_updateProjects","isFan","projectIndex","totalFans","is_fan","total_fans","setProjects","_updateCurrentProject","setProject","likeProject","unlikeProject","SortProjectsDirective","opacity","sortData","sorted_project_ids","bulkUpdateProjectsOrder","WatchProjectButtonController","watchButtonService","showWatchOptions","toggleWatcherOptions","closeWatcherOptions","notifyLevel","WatchProjectButtonDirective","WatchProjectButtonService","isWatcher","totalWatchers","total_watchers","watchProject","unwatchProject","ProjectsListingController","ProjectController","activeMembers","setfn","metas","ProjectsService","projectUrl","getProjectBySlug","getProjectStats","paginate","colorized_tags","transferValidateToken","transferAccept","reason","transferReject","CantOwnProjectExplanationDirective","TransferProject","showAddComment","_refreshUserData","_validateToken","_setProjectData","_checkOwnerData","canBeOwnedByUser","canOwnProject","ownerMessage","maxProjects","currentProjects","validNumberOfMemberships","addComment","hideComment","TransferProjectDirective","Resource","urlsService","urlname","object_id","x-disable-pagination","progressMessage","progressPercent","pagination","paginateResponseService","x-lazy-pagination","getTimeline","only_relevant","Resources","services","serviceFn","serviceName","serviceProperty","warm","getUserStorage","setUserStorage","createUserStorage","getUserByUsername","getProfileTimeline","getUserTimeline","AppMetaService","_set","meta","setTitle","setDescription","setTwitterMetas","origin","setOpenGraphMetas","listener","_listener","$watchCollection","AttachmentsService","getMaxFileSize","maxFileSizeFormated","sizeError","saveError","ChekcPermissionsService","CurrentUserService","storageService","_projects","_projectsById","_joyride","_loadUserInfo","LightboxFactory","compile","scopeAttrs","PaginateResponse","paginateResponse","ProjectLogoService","modulo","COLORS","IMAGES","logos","murmurhash3_32_gc","ProjectService","_project","_section","_sectionsBreadcrumb","_activeMembers","ScopeEvent","scopes","_searchDuplicatedScopes","$id","_create","duplicatedScopeName","_tgEmitter","EventEmitter2","removeAllListeners","emitter","ThemeService","themeName","stylesheetEl","UserService","pageNumber","objectType","textQuery","contactsFiltered","contact","contactId","permissionDenied","UserTimelineAttachmentDirective","validFileExtensions","extension","is_image","templateHtml","UserTimelineItemTitle","sce","_fieldTranslationKey","timeline","title_attr","_getLink","_getUsernameSpan","field_name","new_value","sprint_name","us_name","event_us","_getTimelineObj","_getDetailObjUrl","obj_name","role_name","keySeq","_translateTitleParams","parent_userstory","_getParams","timeline_type","translate_params","getTitle","paramsKeys","translation","UserTimelineType","timelineType","hasIn","getType","UserTimelineItemDirective","UserTimelinePaginationSequence","generate","getContent","minItems","UserTimelineController","userTimelineService","timelineList","getProjectTimeline","loadTimeline","UserTimelineDirective","UserTimelineService","userTimelinePaginationSequenceService","userTimelineItemType","userTimelineItemTitle","_valid_fields","_invalid","fieldKey","value_diff","_isInValidTimeline","invalid","_parseEventType","event_type","_getTimelineObject","_attachExtraInfoToTimelineEntry","_parseTimeline","newdata","newItem","blocked","moveInBacklog","deleteIn","_addEntyAttributes","filterNot"],"mappings":"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","file":"app.js","sourceRoot":"/source/","sourcesContent":["\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app.coffee\n */\n\n(function() {\n  var configure, i18nInit, init, module, modules, pluginsWithModule, taiga;\n\n  this.taiga = taiga = {};\n\n  this.taigaContribPlugins = this.taigaContribPlugins || window.taigaContribPlugins || [];\n\n  taiga.generateHash = function(components) {\n    if (components == null) {\n      components = [];\n    }\n    components = _.map(components, function(x) {\n      return JSON.stringify(x);\n    });\n    return hex_sha1(components.join(\":\"));\n  };\n\n  taiga.generateUniqueSessionIdentifier = function() {\n    var date, randomNumber;\n    date = (new Date()).getTime();\n    randomNumber = Math.floor(Math.random() * 0x9000000);\n    return taiga.generateHash([date, randomNumber]);\n  };\n\n  taiga.sessionId = taiga.generateUniqueSessionIdentifier();\n\n  configure = function($routeProvider, $locationProvider, $httpProvider, $provide, $tgEventsProvider, $compileProvider, $translateProvider, $translatePartialLoaderProvider, $animateProvider) {\n    var authHttpIntercept, blockingIntercept, decorators, defaultHeaders, loaderIntercept, originalWhen, preferedLangCode, userInfo, versionCheckHttpIntercept;\n    $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);\n    originalWhen = $routeProvider.when;\n    $routeProvider.when = function(path, route) {\n      route.resolve || (route.resolve = {});\n      angular.extend(route.resolve, {\n        languageLoad: [\n          \"$q\", \"$translate\", function($q, $translate) {\n            var deferred;\n            deferred = $q.defer();\n            $translate().then(function() {\n              return deferred.resolve();\n            });\n            return deferred.promise;\n          }\n        ]\n      });\n      return originalWhen.call($routeProvider, path, route);\n    };\n    $routeProvider.when(\"/\", {\n      templateUrl: \"home/home.html\",\n      controller: \"Home\",\n      controllerAs: \"vm\",\n      loader: true,\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/discover\", {\n      templateUrl: \"discover/discover-home/discover-home.html\",\n      controller: \"DiscoverHome\",\n      controllerAs: \"vm\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true\n    });\n    $routeProvider.when(\"/discover/search\", {\n      templateUrl: \"discover/discover-search/discover-search.html\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true,\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      reloadOnSearch: false\n    });\n    $routeProvider.when(\"/projects/\", {\n      templateUrl: \"projects/listing/projects-listing.html\",\n      access: {\n        requiresLogin: true\n      },\n      title: \"PROJECTS.PAGE_TITLE\",\n      description: \"PROJECTS.PAGE_DESCRIPTION\",\n      loader: true,\n      controller: \"ProjectsListing\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/blocked-project/:pslug/\", {\n      templateUrl: \"projects/project/blocked-project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/\", {\n      templateUrl: \"projects/project/project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\",\n      section: \"project-timeline\"\n    });\n    $routeProvider.when(\"/project/:pslug/search\", {\n      templateUrl: \"search/search.html\",\n      reloadOnSearch: false,\n      section: \"search\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/backlog\", {\n      templateUrl: \"backlog/backlog.html\",\n      loader: true,\n      section: \"backlog\",\n      joyride: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/kanban\", {\n      templateUrl: \"kanban/kanban.html\",\n      loader: true,\n      section: \"kanban\",\n      joyride: \"kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/taskboard/:sslug\", {\n      templateUrl: \"taskboard/taskboard.html\",\n      loader: true,\n      section: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/us/:usref\", {\n      templateUrl: \"us/us-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/task/:taskref\", {\n      templateUrl: \"task/task-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki\", {\n      redirectTo: function(params) {\n        return \"/project/\" + params.pslug + \"/wiki/home\";\n      }\n    });\n    $routeProvider.when(\"/project/:pslug/wiki/:slug\", {\n      templateUrl: \"wiki/wiki.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/team\", {\n      templateUrl: \"team/team.html\",\n      loader: true,\n      section: \"team\"\n    });\n    $routeProvider.when(\"/project/:pslug/issues\", {\n      templateUrl: \"issue/issues.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/issue/:issueref\", {\n      templateUrl: \"issue/issues-detail.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/details\", {\n      templateUrl: \"admin/admin-project-profile.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/default-values\", {\n      templateUrl: \"admin/admin-project-default-values.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/modules\", {\n      templateUrl: \"admin/admin-project-modules.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/export\", {\n      templateUrl: \"admin/admin-project-export.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/reports\", {\n      templateUrl: \"admin/admin-project-reports.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/status\", {\n      templateUrl: \"admin/admin-project-values-status.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/points\", {\n      templateUrl: \"admin/admin-project-values-points.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/priorities\", {\n      templateUrl: \"admin/admin-project-values-priorities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/severities\", {\n      templateUrl: \"admin/admin-project-values-severities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/triggers\", {\n      templateUrl: \"admin/admin-project-values-triggers.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/types\", {\n      templateUrl: \"admin/admin-project-values-types.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/custom-fields\", {\n      templateUrl: \"admin/admin-project-values-custom-fields.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/memberships\", {\n      templateUrl: \"admin/admin-memberships.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/roles\", {\n      templateUrl: \"admin/admin-roles.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/webhooks\", {\n      templateUrl: \"admin/admin-third-parties-webhooks.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/github\", {\n      templateUrl: \"admin/admin-third-parties-github.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gitlab\", {\n      templateUrl: \"admin/admin-third-parties-gitlab.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/bitbucket\", {\n      templateUrl: \"admin/admin-third-parties-bitbucket.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/contrib/:plugin\", {\n      templateUrl: \"contrib/main.html\"\n    });\n    $routeProvider.when(\"/project/:pslug/transfer/:token\", {\n      templateUrl: \"projects/transfer/transfer-page.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/user-settings/user-profile\", {\n      templateUrl: \"user/user-profile.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-change-password\", {\n      templateUrl: \"user/user-change-password.html\"\n    });\n    $routeProvider.when(\"/user-settings/mail-notifications\", {\n      templateUrl: \"user/mail-notifications.html\"\n    });\n    $routeProvider.when(\"/change-email/:email_token\", {\n      templateUrl: \"user/change-email.html\"\n    });\n    $routeProvider.when(\"/cancel-account/:cancel_token\", {\n      templateUrl: \"user/cancel-account.html\"\n    });\n    $routeProvider.when(\"/user-settings/contrib/:plugin\", {\n      templateUrl: \"contrib/user-settings.html\"\n    });\n    $routeProvider.when(\"/profile\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      access: {\n        requiresLogin: true\n      },\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/profile/:slug\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/login\", {\n      templateUrl: \"auth/login.html\",\n      title: \"LOGIN.PAGE_TITLE\",\n      description: \"LOGIN.PAGE_DESCRIPTION\",\n      disableHeader: true,\n      controller: \"LoginPage\"\n    });\n    $routeProvider.when(\"/register\", {\n      templateUrl: \"auth/register.html\",\n      title: \"REGISTER.PAGE_TITLE\",\n      description: \"REGISTER.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/forgot-password\", {\n      templateUrl: \"auth/forgot-password.html\",\n      title: \"FORGOT_PASSWORD.PAGE_TITLE\",\n      description: \"FORGOT_PASSWORD.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/change-password/:token\", {\n      templateUrl: \"auth/change-password-from-recovery.html\",\n      title: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      description: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/invitation/:token\", {\n      templateUrl: \"auth/invitation.html\",\n      title: \"INVITATION.PAGE_TITLE\",\n      description: \"INVITATION.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/external-apps\", {\n      templateUrl: \"external-apps/external-app.html\",\n      title: \"EXTERNAL_APP.PAGE_TITLE\",\n      description: \"EXTERNAL_APP.PAGE_DESCRIPTION\",\n      controller: \"ExternalApp\",\n      controllerAs: \"vm\",\n      disableHeader: true,\n      mobileViewport: true\n    });\n    $routeProvider.when(\"/error\", {\n      templateUrl: \"error/error.html\"\n    });\n    $routeProvider.when(\"/not-found\", {\n      templateUrl: \"error/not-found.html\"\n    });\n    $routeProvider.when(\"/permission-denied\", {\n      templateUrl: \"error/permission-denied.html\"\n    });\n    $routeProvider.otherwise({\n      redirectTo: \"/not-found\"\n    });\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n    defaultHeaders = {\n      \"Content-Type\": \"application/json\",\n      \"Accept-Language\": window.taigaConfig.defaultLanguage || \"en\",\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.defaults.headers[\"delete\"] = defaultHeaders;\n    $httpProvider.defaults.headers.patch = defaultHeaders;\n    $httpProvider.defaults.headers.post = defaultHeaders;\n    $httpProvider.defaults.headers.put = defaultHeaders;\n    $httpProvider.defaults.headers.get = {\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.useApplyAsync(true);\n    $tgEventsProvider.setSessionId(taiga.sessionId);\n    authHttpIntercept = function($q, $location, $navUrls, $lightboxService) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var nextUrl;\n        if (response.status === 0 || (response.status === -1 && !response.config.cancelable)) {\n          $lightboxService.closeAll();\n          $location.path($navUrls.resolve(\"error\"));\n          $location.replace();\n        } else if (response.status === 401 && $location.url().indexOf('/login') === -1) {\n          nextUrl = encodeURIComponent($location.url());\n          $location.url($navUrls.resolve(\"login\")).search(\"next=\" + nextUrl);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"authHttpIntercept\", [\"$q\", \"$location\", \"$tgNavUrls\", \"lightboxService\", authHttpIntercept]);\n    $httpProvider.interceptors.push(\"authHttpIntercept\");\n    loaderIntercept = function($q, loaderService) {\n      return {\n        request: function(config) {\n          loaderService.logRequest();\n          return config;\n        },\n        requestError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        responseError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        response: function(response) {\n          loaderService.logResponse();\n          return response;\n        }\n      };\n    };\n    $provide.factory(\"loaderIntercept\", [\"$q\", \"tgLoader\", loaderIntercept]);\n    $httpProvider.interceptors.push(\"loaderIntercept\");\n    versionCheckHttpIntercept = function($q) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var $injector;\n        if (response.status === 400 && response.data.version) {\n          $injector = angular.element(\"body\").injector();\n          $injector.invoke([\n            \"$tgConfirm\", \"$translate\", (function(_this) {\n              return function($confirm, $translate) {\n                var versionErrorMsg;\n                versionErrorMsg = $translate.instant(\"ERROR.VERSION_ERROR\");\n                return $confirm.notify(\"error\", versionErrorMsg, null, 10000);\n              };\n            })(this)\n          ]);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"versionCheckHttpIntercept\", [\"$q\", versionCheckHttpIntercept]);\n    $httpProvider.interceptors.push(\"versionCheckHttpIntercept\");\n    blockingIntercept = function($q, $routeParams, $location, $navUrls) {\n      var redirectToBlockedPage, responseError, responseOk;\n      redirectToBlockedPage = function() {\n        var blockedUrl, currentUrl, pslug;\n        pslug = $routeParams.pslug;\n        blockedUrl = $navUrls.resolve(\"blocked-project\", {\n          project: pslug\n        });\n        currentUrl = $location.url();\n        if (currentUrl.indexOf(blockedUrl) === -1) {\n          return $location.replace().path(blockedUrl);\n        }\n      };\n      responseOk = function(response) {\n        if (response.data.blocked_code) {\n          redirectToBlockedPage();\n        }\n        return response;\n      };\n      responseError = function(response) {\n        if (response.status === 451) {\n          redirectToBlockedPage();\n        }\n        return $q.reject(response);\n      };\n      return {\n        response: responseOk,\n        responseError: responseError\n      };\n    };\n    $provide.factory(\"blockingIntercept\", [\"$q\", \"$routeParams\", \"$location\", \"$tgNavUrls\", blockingIntercept]);\n    $httpProvider.interceptors.push(\"blockingIntercept\");\n    $compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo || false);\n    if (localStorage.userInfo) {\n      userInfo = JSON.parse(localStorage.userInfo);\n    }\n    preferedLangCode = (userInfo != null ? userInfo.lang : void 0) || window.taigaConfig.defaultLanguage || \"en\";\n    $translatePartialLoaderProvider.addPart('taiga');\n    $translateProvider.useLoader('$translatePartialLoader', {\n      urlTemplate: '/' + window._version + '/locales/{part}/locale-{lang}.json'\n    }).useSanitizeValueStrategy('escapeParameters').addInterpolation('$translateMessageFormatInterpolation').preferredLanguage(preferedLangCode);\n    $translateProvider.fallbackLanguage(preferedLangCode);\n    decorators = window.getDecorators();\n    return _.each(decorators, function(decorator) {\n      return $provide.decorator(decorator.provider, decorator.decorator);\n    });\n  };\n\n  i18nInit = function(lang, $translate) {\n    var messages;\n    moment.locale(lang);\n    messages = {\n      defaultMessage: $translate.instant(\"COMMON.FORM_ERRORS.DEFAULT_MESSAGE\"),\n      type: {\n        email: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_EMAIL\"),\n        url: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URL\"),\n        urlstrict: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URLSTRICT\"),\n        number: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_NUMBER\"),\n        digits: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DIGITS\"),\n        dateIso: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DATEISO\"),\n        alphanum: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_ALPHANUM\"),\n        phone: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_PHONE\")\n      },\n      notnull: $translate.instant(\"COMMON.FORM_ERRORS.NOTNULL\"),\n      notblank: $translate.instant(\"COMMON.FORM_ERRORS.NOT_BLANK\"),\n      required: $translate.instant(\"COMMON.FORM_ERRORS.REQUIRED\"),\n      regexp: $translate.instant(\"COMMON.FORM_ERRORS.REGEXP\"),\n      min: $translate.instant(\"COMMON.FORM_ERRORS.MIN\"),\n      max: $translate.instant(\"COMMON.FORM_ERRORS.MAX\"),\n      range: $translate.instant(\"COMMON.FORM_ERRORS.RANGE\"),\n      minlength: $translate.instant(\"COMMON.FORM_ERRORS.MIN_LENGTH\"),\n      maxlength: $translate.instant(\"COMMON.FORM_ERRORS.MAX_LENGTH\"),\n      rangelength: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_LENGTH\"),\n      mincheck: $translate.instant(\"COMMON.FORM_ERRORS.MIN_CHECK\"),\n      maxcheck: $translate.instant(\"COMMON.FORM_ERRORS.MAX_CHECK\"),\n      rangecheck: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_CHECK\"),\n      equalto: $translate.instant(\"COMMON.FORM_ERRORS.EQUAL_TO\"),\n      linewidth: $translate.instant(\"COMMON.FORM_ERRORS.LINEWIDTH\"),\n      pikaday: $translate.instant(\"COMMON.FORM_ERRORS.PIKADAY\")\n    };\n    return checksley.updateMessages('default', messages);\n  };\n\n  init = function($log, $rootscope, $auth, $events, $analytics, $translate, $location, $navUrls, appMetaService, projectService, loaderService, navigationBarService) {\n    var un, user, validators;\n    $log.debug(\"Initialize application\");\n    $rootscope.$on('$translatePartialLoaderStructureChanged', function() {\n      return $translate.refresh();\n    });\n    validators = {\n      linewidth: function(val, width) {\n        var lines, valid;\n        lines = taiga.nl2br(val).split(\"<br />\");\n        valid = _.every(lines, function(line) {\n          return line.length < width;\n        });\n        return valid;\n      },\n      pikaday: function(val) {\n        var prettyDate;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        return moment(val, prettyDate).isValid();\n      }\n    };\n    checksley.updateValidators(validators);\n    $rootscope.contribPlugins = this.taigaContribPlugins;\n    $rootscope.adminPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"admin\"\n    });\n    $rootscope.userSettingsPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"userSettings\"\n    });\n    $rootscope.$on(\"$translateChangeEnd\", function(e, ctx) {\n      var lang;\n      lang = ctx.language;\n      return i18nInit(lang, $translate);\n    });\n    Promise.setScheduler(function(cb) {\n      return $rootscope.$evalAsync(cb);\n    });\n    $events.setupConnection();\n    if ($auth.isAuthenticated()) {\n      user = $auth.getUser();\n    }\n    $analytics.initialize();\n    un = $rootscope.$on('$routeChangeStart', function(event, next) {\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      return un();\n    });\n    return $rootscope.$on('$routeChangeSuccess', function(event, next) {\n      var description, title;\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      if (next.access && next.access.requiresLogin) {\n        if (!$auth.isAuthenticated()) {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n      }\n      projectService.setSection(next.section);\n      if (next.params.pslug) {\n        projectService.setProjectBySlug(next.params.pslug);\n      } else {\n        projectService.cleanProject();\n      }\n      if (next.title || next.description) {\n        title = $translate.instant(next.title || \"\");\n        description = $translate.instant(next.description || \"\");\n        appMetaService.setAll(title, description);\n      }\n      if (next.mobileViewport) {\n        appMetaService.addMobileViewport();\n      } else {\n        appMetaService.removeMobileViewport();\n      }\n      if (next.disableHeader) {\n        return navigationBarService.disableHeader();\n      } else {\n        return navigationBarService.enableHeader();\n      }\n    });\n  };\n\n  pluginsWithModule = _.filter(this.taigaContribPlugins, function(plugin) {\n    return plugin.module;\n  });\n\n  angular.module('infinite-scroll').value('THROTTLE_MILLISECONDS', 500);\n\n  modules = [\"taigaBase\", \"taigaCommon\", \"taigaResources\", \"taigaResources2\", \"taigaAuth\", \"taigaEvents\", \"taigaHome\", \"taigaNavigationBar\", \"taigaProjects\", \"taigaRelatedTasks\", \"taigaBacklog\", \"taigaTaskboard\", \"taigaKanban\", \"taigaIssues\", \"taigaUserStories\", \"taigaTasks\", \"taigaTeam\", \"taigaWiki\", \"taigaSearch\", \"taigaAdmin\", \"taigaProject\", \"taigaUserSettings\", \"taigaFeedback\", \"taigaPlugins\", \"taigaIntegrations\", \"taigaComponents\", \"taigaProfile\", \"taigaHome\", \"taigaUserTimeline\", \"taigaExternalApps\", \"taigaDiscover\", \"templates\", \"ngSanitize\", \"ngRoute\", \"ngAnimate\", \"ngAria\", \"pascalprecht.translate\", \"infinite-scroll\", \"tgRepeat\"].concat(_.map(pluginsWithModule, function(plugin) {\n    return plugin.module;\n  }));\n\n  module = angular.module(\"taiga\", modules);\n\n  module.config([\"$routeProvider\", \"$locationProvider\", \"$httpProvider\", \"$provide\", \"$tgEventsProvider\", \"$compileProvider\", \"$translateProvider\", \"$translatePartialLoaderProvider\", \"$animateProvider\", configure]);\n\n  module.run([\"$log\", \"$rootScope\", \"$tgAuth\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"tgProjectService\", \"tgLoader\", \"tgNavigationBarService\", \"$route\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: classes.coffee\n */\n\n(function() {\n  var TaigaBase, TaigaController, TaigaService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  TaigaBase = (function() {\n    function TaigaBase() {}\n\n    return TaigaBase;\n\n  })();\n\n  TaigaService = (function(superClass) {\n    extend(TaigaService, superClass);\n\n    function TaigaService() {\n      return TaigaService.__super__.constructor.apply(this, arguments);\n    }\n\n    return TaigaService;\n\n  })(TaigaBase);\n\n  TaigaController = (function(superClass) {\n    extend(TaigaController, superClass);\n\n    function TaigaController() {\n      this.onInitialDataError = bind(this.onInitialDataError, this);\n      return TaigaController.__super__.constructor.apply(this, arguments);\n    }\n\n    TaigaController.prototype.onInitialDataError = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.location.path(this.navUrls.resolve(\"not-found\"));\n          this.location.replace();\n        } else if (xhr.status === 403) {\n          this.location.path(this.navUrls.resolve(\"permission-denied\"));\n          this.location.replace();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return TaigaController;\n\n  })(TaigaBase);\n\n  this.taiga.Base = TaigaBase;\n\n  this.taiga.Service = TaigaService;\n\n  this.taiga.Controller = TaigaController;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.coffee\n */\n\n(function() {\n  var bindMethods, bindOnce, cancelTimeout, debounce, debounceLeading, defineImmutableProperty, groupBy, isImage, joinStr, mixOf, nl2br, patch, replaceTags, scopeDefer, sizeFormat, slugify, startswith, stripTags, taiga, timeout, toString, toggleText, trim, truncate, unslugify,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  nl2br = (function(_this) {\n    return function(str) {\n      var breakTag;\n      breakTag = '<br />';\n      return (str + '').replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + breakTag + '$2');\n    };\n  })(this);\n\n  bindMethods = (function(_this) {\n    return function(object) {\n      var dependencies, methods;\n      dependencies = _.keys(object);\n      methods = [];\n      _.forIn(object, function(value, key) {\n        if (indexOf.call(dependencies, key) < 0) {\n          return methods.push(key);\n        }\n      });\n      return _.bindAll(object, methods);\n    };\n  })(this);\n\n  bindOnce = (function(_this) {\n    return function(scope, attr, continuation) {\n      var delBind, val;\n      val = scope.$eval(attr);\n      if (val !== void 0) {\n        return continuation(val);\n      }\n      delBind = null;\n      return delBind = scope.$watch(attr, function(val) {\n        if (val === void 0) {\n          return;\n        }\n        continuation(val);\n        if (delBind) {\n          return delBind();\n        }\n      });\n    };\n  })(this);\n\n  mixOf = function() {\n    var Mixed, base, i, method, mixin, mixins, name, ref;\n    base = arguments[0], mixins = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    Mixed = (function(superClass) {\n      extend(Mixed, superClass);\n\n      function Mixed() {\n        return Mixed.__super__.constructor.apply(this, arguments);\n      }\n\n      return Mixed;\n\n    })(base);\n    for (i = mixins.length - 1; i >= 0; i += -1) {\n      mixin = mixins[i];\n      ref = mixin.prototype;\n      for (name in ref) {\n        method = ref[name];\n        Mixed.prototype[name] = method;\n      }\n    }\n    return Mixed;\n  };\n\n  trim = function(data, char) {\n    return _.trim(data, char);\n  };\n\n  slugify = function(data) {\n    return data.toString().toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, '-and-').replace(/[^\\w\\-]+/g, '').replace(/\\-\\-+/g, '-');\n  };\n\n  unslugify = function(data) {\n    if (data) {\n      return _.capitalize(data.replace(/-/g, ' '));\n    }\n    return data;\n  };\n\n  toggleText = function(element, texts) {\n    var nextTextPosition, text;\n    nextTextPosition = element.data('nextTextPosition');\n    if ((nextTextPosition == null) || nextTextPosition >= texts.length) {\n      nextTextPosition = 0;\n    }\n    text = texts[nextTextPosition];\n    element.data('nextTextPosition', nextTextPosition + 1);\n    return element.text(text);\n  };\n\n  groupBy = function(coll, pred) {\n    var i, item, len, result;\n    result = {};\n    for (i = 0, len = coll.length; i < len; i++) {\n      item = coll[i];\n      result[pred(item)] = item;\n    }\n    return result;\n  };\n\n  timeout = function(wait, continuation) {\n    return window.setTimeout(continuation, wait);\n  };\n\n  cancelTimeout = function(timeoutVar) {\n    return window.clearTimeout(timeoutVar);\n  };\n\n  scopeDefer = function(scope, func) {\n    return _.defer((function(_this) {\n      return function() {\n        return scope.$apply(func);\n      };\n    })(this));\n  };\n\n  toString = function(value) {\n    if (_.isNumber(value)) {\n      return value + \"\";\n    } else if (_.isString(value)) {\n      return value;\n    } else if (_.isPlainObject(value)) {\n      return JSON.stringify(value);\n    } else if (_.isUndefined(value)) {\n      return \"\";\n    }\n    return value.toString();\n  };\n\n  joinStr = function(str, coll) {\n    return coll.join(str);\n  };\n\n  debounce = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: true,\n      trailing: false\n    });\n  };\n\n  debounceLeading = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: false,\n      trailing: true\n    });\n  };\n\n  startswith = function(str1, str2) {\n    return _.startsWith(str1, str2);\n  };\n\n  truncate = function(str, maxLength, suffix) {\n    var out;\n    if (suffix == null) {\n      suffix = \"...\";\n    }\n    if ((typeof str !== \"string\") && !(str instanceof String)) {\n      return str;\n    }\n    out = str.slice(0);\n    if (out.length > maxLength) {\n      out = out.substring(0, maxLength + 1);\n      out = out.substring(0, Math.min(out.length, out.lastIndexOf(\" \")));\n      out = out + suffix;\n    }\n    return out;\n  };\n\n  sizeFormat = function(input, precision) {\n    var number, size, units;\n    if (precision == null) {\n      precision = 1;\n    }\n    if (isNaN(parseFloat(input)) || !isFinite(input)) {\n      return \"-\";\n    }\n    if (input === 0) {\n      return \"0 bytes\";\n    }\n    units = [\"bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n    number = Math.floor(Math.log(input) / Math.log(1024));\n    if (number > 5) {\n      number = 5;\n    }\n    size = (input / Math.pow(1024, number)).toFixed(precision);\n    return size + \" \" + units[number];\n  };\n\n  stripTags = function(str, exception) {\n    var pattern;\n    if (exception) {\n      pattern = new RegExp('<(?!' + exception + '\\s*\\/?)[^>]+>', 'gi');\n      return String(str).replace(pattern, '');\n    } else {\n      return String(str).replace(/<\\/?[^>]+>/g, '');\n    }\n  };\n\n  replaceTags = function(str, tags, replace) {\n    var pattern;\n    pattern = new RegExp('<(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '<' + replace + '>');\n    pattern = new RegExp('<\\/(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '</' + replace + '>');\n    return str;\n  };\n\n  defineImmutableProperty = (function(_this) {\n    return function(obj, name, fn) {\n      return Object.defineProperty(obj, name, {\n        get: function() {\n          var fn_result;\n          if (!_.isFunction(fn)) {\n            throw \"defineImmutableProperty third param must be a function\";\n          }\n          fn_result = fn();\n          if (fn_result && _.isObject(fn_result)) {\n            if (fn_result.size === void 0) {\n              throw \"defineImmutableProperty must return immutable data\";\n            }\n          }\n          return fn_result;\n        }\n      });\n    };\n  })(this);\n\n  _.mixin({\n    removeKeys: function(obj, keys) {\n      return _.chain([keys]).flatten().reduce(function(obj, key) {\n        delete obj[key];\n        return obj;\n      }, obj).value();\n    },\n    cartesianProduct: function() {\n      return _.reduceRight(arguments, function(a, b) {\n        return _.flatten(_.map(a, function(x) {\n          return _.map(b, function(y) {\n            return [y].concat(x);\n          });\n        }), true);\n      }, [[]]);\n    }\n  });\n\n  isImage = function(name) {\n    return name.match(/\\.(jpe?g|png|gif|gifv|webm)/i) !== null;\n  };\n\n  patch = function(oldImmutable, newImmutable) {\n    var pathObj;\n    pathObj = {};\n    newImmutable.forEach(function(newValue, key) {\n      if (newValue !== oldImmutable.get(key)) {\n        if (newValue.toJS) {\n          return pathObj[key] = newValue.toJS();\n        } else {\n          return pathObj[key] = newValue;\n        }\n      }\n    });\n    return pathObj;\n  };\n\n  taiga = this.taiga;\n\n  taiga.nl2br = nl2br;\n\n  taiga.bindMethods = bindMethods;\n\n  taiga.bindOnce = bindOnce;\n\n  taiga.mixOf = mixOf;\n\n  taiga.trim = trim;\n\n  taiga.slugify = slugify;\n\n  taiga.unslugify = unslugify;\n\n  taiga.toggleText = toggleText;\n\n  taiga.groupBy = groupBy;\n\n  taiga.timeout = timeout;\n\n  taiga.cancelTimeout = cancelTimeout;\n\n  taiga.scopeDefer = scopeDefer;\n\n  taiga.toString = toString;\n\n  taiga.joinStr = joinStr;\n\n  taiga.truncate = truncate;\n\n  taiga.debounce = debounce;\n\n  taiga.debounceLeading = debounceLeading;\n\n  taiga.startswith = startswith;\n\n  taiga.sizeFormat = sizeFormat;\n\n  taiga.stripTags = stripTags;\n\n  taiga.replaceTags = replaceTags;\n\n  taiga.defineImmutableProperty = defineImmutableProperty;\n\n  taiga.isImage = isImage;\n\n  taiga.patch = patch;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/controllerMixins.coffee\n */\n\n(function() {\n  var FiltersMixin, PageMixin, groupBy, joinStr, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  joinStr = this.taiga.joinStr;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  PageMixin = (function() {\n    function PageMixin() {}\n\n    PageMixin.prototype.fillUsersAndRoles = function(users, roles) {\n      var activeUsers, computableRoles;\n      activeUsers = _.filter(users, (function(_this) {\n        return function(user) {\n          return user.is_active;\n        };\n      })(this));\n      this.scope.activeUsers = _.sortBy(activeUsers, \"full_name_display\");\n      this.scope.activeUsersById = groupBy(this.scope.activeUsers, function(e) {\n        return e.id;\n      });\n      this.scope.users = _.sortBy(users, \"full_name_display\");\n      this.scope.usersById = groupBy(this.scope.users, function(e) {\n        return e.id;\n      });\n      this.scope.roles = _.sortBy(roles, \"order\");\n      computableRoles = _(this.scope.project.members).map(\"role\").uniq().value();\n      return this.scope.computableRoles = _(roles).filter(\"computable\").filter(function(x) {\n        return _.includes(computableRoles, x.id);\n      }).value();\n    };\n\n    PageMixin.prototype.loadUsersAndRoles = function() {\n      var promise;\n      promise = this.q.all([this.rs.projects.usersList(this.scope.projectId), this.rs.projects.rolesList(this.scope.projectId)]);\n      return promise.then((function(_this) {\n        return function(results) {\n          var roles, users;\n          users = results[0], roles = results[1];\n          _this.fillUsersAndRoles(users, roles);\n          return results;\n        };\n      })(this));\n    };\n\n    return PageMixin;\n\n  })();\n\n  taiga.PageMixin = PageMixin;\n\n  FiltersMixin = (function() {\n    function FiltersMixin() {}\n\n    FiltersMixin.prototype.selectFilter = function(name, value, load) {\n      var existing, location, params;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] !== void 0 && name !== \"page\") {\n        existing = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n          return trim(x);\n        });\n        existing.push(taiga.toString(value));\n        existing = _.compact(existing);\n        value = joinStr(\",\", _.uniq(existing));\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceFilter = function(name, value, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceAllFilters = function(filters, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(filters);\n    };\n\n    FiltersMixin.prototype.unselectFilter = function(name, value, load) {\n      var location, newValues, params, parsedValues;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] === void 0) {\n        return;\n      }\n      if (value === void 0 || value === null) {\n        delete params[name];\n      }\n      parsedValues = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n        return trim(x);\n      });\n      newValues = _.reject(parsedValues, function(x) {\n        return x === taiga.toString(value);\n      });\n      newValues = _.compact(newValues);\n      if (_.isEmpty(newValues)) {\n        value = null;\n      } else {\n        value = joinStr(\",\", _.uniq(newValues));\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(name, value);\n    };\n\n    return FiltersMixin;\n\n  })();\n\n  taiga.FiltersMixin = FiltersMixin;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaAdmin\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/auth.coffee\n */\n\n(function() {\n  var AuthService, CancelAccountDirective, ChangeEmailDirective, ChangePasswordFromRecoveryDirective, ForgotPasswordDirective, InvitationDirective, LoginDirective, LoginPage, PublicRegisterMessageDirective, RegisterDirective, debounce, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAuth\", [\"taigaResources\"]);\n\n  LoginPage = (function() {\n    LoginPage.$inject = ['tgCurrentUserService', '$location', '$tgNavUrls', '$routeParams'];\n\n    function LoginPage(currentUserService, $location, $navUrls, $routeParams) {\n      var url;\n      if (currentUserService.isAuthenticated()) {\n        url = $navUrls.resolve(\"home\");\n        if ($routeParams['next']) {\n          url = $routeParams['next'];\n          $location.search('next', null);\n        }\n        $location.path(url);\n      }\n    }\n\n    return LoginPage;\n\n  })();\n\n  module.controller('LoginPage', LoginPage);\n\n  AuthService = (function(superClass) {\n    extend(AuthService, superClass);\n\n    AuthService.$inject = [\"$rootScope\", \"$tgStorage\", \"$tgModel\", \"$tgResources\", \"$tgHttp\", \"$tgUrls\", \"$tgConfig\", \"$translate\", \"tgCurrentUserService\", \"tgThemeService\"];\n\n    function AuthService(rootscope, storage, model, rs, http, urls, config, translate, currentUserService1, themeService) {\n      var userModel;\n      this.rootscope = rootscope;\n      this.storage = storage;\n      this.model = model;\n      this.rs = rs;\n      this.http = http;\n      this.urls = urls;\n      this.config = config;\n      this.translate = translate;\n      this.currentUserService = currentUserService1;\n      this.themeService = themeService;\n      AuthService.__super__.constructor.call(this);\n      userModel = this.getUser();\n      this._currentTheme = this._getUserTheme();\n      this.setUserdata(userModel);\n    }\n\n    AuthService.prototype.setUserdata = function(userModel) {\n      if (userModel) {\n        this.userData = Immutable.fromJS(userModel.getAttrs());\n        return this.currentUserService.setUser(this.userData);\n      } else {\n        return this.userData = null;\n      }\n    };\n\n    AuthService.prototype._getUserTheme = function() {\n      var ref;\n      return ((ref = this.rootscope.user) != null ? ref.theme : void 0) || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    AuthService.prototype._setTheme = function() {\n      var newTheme;\n      newTheme = this._getUserTheme();\n      if (this._currentTheme !== newTheme) {\n        this._currentTheme = newTheme;\n        return this.themeService.use(this._currentTheme);\n      }\n    };\n\n    AuthService.prototype._setLocales = function() {\n      var lang, ref;\n      lang = ((ref = this.rootscope.user) != null ? ref.lang : void 0) || this.config.get(\"defaultLanguage\") || \"en\";\n      this.translate.preferredLanguage(lang);\n      return this.translate.use(lang);\n    };\n\n    AuthService.prototype.getUser = function() {\n      var user, userData;\n      if (this.rootscope.user) {\n        return this.rootscope.user;\n      }\n      userData = this.storage.get(\"userInfo\");\n      if (userData) {\n        user = this.model.make_model(\"users\", userData);\n        this.rootscope.user = user;\n        this._setLocales();\n        this._setTheme();\n        return user;\n      } else {\n        this._setTheme();\n      }\n      return null;\n    };\n\n    AuthService.prototype.setUser = function(user) {\n      this.rootscope.auth = user;\n      this.storage.set(\"userInfo\", user.getAttrs());\n      this.rootscope.user = user;\n      this.setUserdata(user);\n      this._setLocales();\n      return this._setTheme();\n    };\n\n    AuthService.prototype.clear = function() {\n      this.rootscope.auth = null;\n      this.rootscope.user = null;\n      return this.storage.remove(\"userInfo\");\n    };\n\n    AuthService.prototype.setToken = function(token) {\n      return this.storage.set(\"token\", token);\n    };\n\n    AuthService.prototype.getToken = function() {\n      return this.storage.get(\"token\");\n    };\n\n    AuthService.prototype.removeToken = function() {\n      return this.storage.remove(\"token\");\n    };\n\n    AuthService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    AuthService.prototype.refresh = function() {\n      var url;\n      url = this.urls.resolve(\"user-me\");\n      return this.http.get(url).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = data.data;\n          user.token = _this.getUser().auth_token;\n          user = _this.model.make_model(\"users\", user);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.login = function(data, type) {\n      var url;\n      url = this.urls.resolve(\"auth\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"normal\";\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = _this.model.make_model(\"users\", data.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.logout = function() {\n      this.removeToken();\n      this.clear();\n      this.currentUserService.removeUser();\n      this._setTheme();\n      return this._setLocales();\n    };\n\n    AuthService.prototype.register = function(data, type, existing) {\n      var url;\n      url = this.urls.resolve(\"auth-register\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"public\";\n      if (type === \"private\") {\n        data.existing = existing ? existing : false;\n      }\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(response) {\n          var user;\n          user = _this.model.make_model(\"users\", response.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.getInvitation = function(token) {\n      return this.rs.invitations.get(token);\n    };\n\n    AuthService.prototype.acceptInvitiationWithNewUser = function(data) {\n      return this.register(data, \"private\", false);\n    };\n\n    AuthService.prototype.acceptInvitiationWithExistingUser = function(data) {\n      return this.register(data, \"private\", true);\n    };\n\n    AuthService.prototype.forgotPassword = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-password-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changePasswordFromRecovery = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-password-from-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changeEmail = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-email\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.cancelAccount = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-cancel-account\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    return AuthService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAuth\", AuthService);\n\n  PublicRegisterMessageDirective = function($config, $navUrls, $routeParams, templates) {\n    var template, templateFn;\n    template = templates.get(\"auth/login-text.html\", true);\n    templateFn = function() {\n      var nextUrl, publicRegisterEnabled, url;\n      publicRegisterEnabled = $config.get(\"publicRegisterEnabled\");\n      if (!publicRegisterEnabled) {\n        return \"\";\n      }\n      url = $navUrls.resolve(\"register\");\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"register\")) {\n        nextUrl = encodeURIComponent($routeParams['next']);\n        url += \"?next=\" + nextUrl;\n      }\n      return template({\n        url: url\n      });\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgPublicRegisterMessage\", [\"$tgConfig\", \"$tgNavUrls\", \"$routeParams\", \"$tgTemplate\", PublicRegisterMessageDirective]);\n\n  LoginDirective = function($auth, $confirm, $location, $config, $routeParams, $navUrls, $events, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onError, onSuccess, submit;\n      form = new checksley.Form($el.find(\"form.login-form\"));\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      onSuccess = function(response) {\n        $events.setupConnection();\n        return $location.url($scope.nextUrl);\n      };\n      onError = function(response) {\n        return $confirm.notify(\"light-error\", $translate.instant(\"LOGIN_FORM.ERROR_AUTH_INCORRECT\"));\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          data = {\n            \"username\": $el.find(\"form.login-form input[name=username]\").val(),\n            \"password\": $el.find(\"form.login-form input[name=password]\").val()\n          };\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          promise = $auth.login(data, loginFormType);\n          return promise.then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      window.prerenderReady = true;\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLogin\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgEvents\", \"$translate\", LoginDirective]);\n\n  RegisterDirective = function($auth, $confirm, $location, $navUrls, $config, $routeParams, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      if (!$config.get(\"publicRegisterEnabled\")) {\n        $location.path($navUrls.resolve(\"not-found\"));\n        $location.replace();\n      }\n      $scope.data = {};\n      form = $el.find(\"form\").checksley({\n        onlyOneErrorElement: true\n      });\n      $scope.nextUrl = $navUrls.resolve(\"home\");\n      onSuccessSubmit = function(response) {\n        $analytics.trackEvent(\"auth\", \"register\", \"user registration\", 1);\n        return $location.url($scope.nextUrl);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return form.setErrors(response.data);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.register($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRegister\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\", \"$routeParams\", \"$tgAnalytics\", \"$translate\", RegisterDirective]);\n\n  ForgotPasswordDirective = function($auth, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var message, title;\n        $location.path($navUrls.resolve(\"login\"));\n        title = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TITLE\");\n        message = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TEXT\");\n        return $confirm.success(title, message);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.forgotPassword($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgForgotPassword\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$translate\", ForgotPasswordDirective]);\n\n  ChangePasswordFromRecoveryDirective = function($auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit, text;\n      $scope.data = {};\n      if ($params.token != null) {\n        $scope.tokenInParams = true;\n        $scope.data.token = $params.token;\n      } else {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        $confirm.notify(\"light-error\", text);\n      }\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.changePasswordFromRecovery($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangePasswordFromRecovery\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangePasswordFromRecoveryDirective]);\n\n  InvitationDirective = function($auth, $confirm, $location, $params, $navUrls, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loginForm, onErrorSubmitLogin, onErrorSubmitRegister, onSuccessSubmitLogin, onSuccessSubmitRegister, promise, registerForm, submitLogin, submitRegister, token;\n      token = $params.token;\n      promise = $auth.getInvitation(token);\n      promise.then(function(invitation) {\n        return $scope.invitation = invitation;\n      });\n      promise.then(null, function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.NOT_FOUND\");\n        return $confirm.notify(\"light-error\", text);\n      });\n      $scope.dataLogin = {\n        token: token\n      };\n      loginForm = $el.find(\"form.login-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitLogin = function(response) {\n        var text;\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with existing user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.SUCCESS\", {\n          \"project_name\": $scope.invitation.project_name\n        });\n        return $confirm.notify(\"success\", text);\n      };\n      onErrorSubmitLogin = function(response) {\n        return $confirm.notify(\"light-error\", response.data._error_message);\n      };\n      submitLogin = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!loginForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithExistingUser($scope.dataLogin);\n          return promise.then(onSuccessSubmitLogin, onErrorSubmitLogin);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.login-form\", submitLogin);\n      $el.on(\"click\", \".button-login\", submitLogin);\n      $scope.dataRegister = {\n        token: token\n      };\n      registerForm = $el.find(\"form.register-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitRegister = function(response) {\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with new user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        return $confirm.notify(\"success\", \"You've successfully joined this project\", \"Welcome to \" + (_.escape($scope.invitation.project_name)));\n      };\n      onErrorSubmitRegister = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return registerForm.setErrors(response.data);\n      };\n      submitRegister = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!registerForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithNewUser($scope.dataRegister);\n          return promise.then(onSuccessSubmitRegister, onErrorSubmitRegister);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.register-form\", submitRegister);\n      $el.on(\"click\", \".button-register\", submitRegister);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgInvitation\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", InvitationDirective]);\n\n  ChangeEmailDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.email_token = $params.email_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        if ($auth.isAuthenticated()) {\n          $repo.queryOne(\"users\", $auth.getUser().id).then((function(_this) {\n            return function(data) {\n              $auth.setUser(data);\n              return $location.path($navUrls.resolve(\"home\"));\n            };\n          })(this));\n        } else {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n        text = $translate.instant(\"CHANGE_EMAIL_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = function() {\n        var promise;\n        if (!form.validate()) {\n          return;\n        }\n        promise = $auth.changeEmail($scope.data);\n        return promise.then(onSuccessSubmit, onErrorSubmit);\n      };\n      $el.on(\"submit\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \"a.button-change-email\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangeEmail\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangeEmailDirective]);\n\n  CancelAccountDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.cancel_token = $params.cancel_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $auth.logout();\n        $location.path($navUrls.resolve(\"home\"));\n        text = $translate.instant(\"CANCEL_ACCOUNT.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.cancelAccount($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCancelAccount\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", CancelAccountDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaBacklog\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base.coffee\n */\n\n(function() {\n  var TaigaMainDirective, bindOnce, groupBy, init, module, taiga, urls;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\", []);\n\n  TaigaMainDirective = function($rootscope, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $window.onresize = function() {\n        return $rootscope.$broadcast(\"resize\");\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMain\", [\"$rootScope\", \"$window\", TaigaMainDirective]);\n\n  urls = {\n    \"home\": \"/\",\n    \"projects\": \"/projects\",\n    \"error\": \"/error\",\n    \"not-found\": \"/not-found\",\n    \"permission-denied\": \"/permission-denied\",\n    \"discover\": \"/discover\",\n    \"discover-search\": \"/discover/search\",\n    \"login\": \"/login\",\n    \"forgot-password\": \"/forgot-password\",\n    \"change-password\": \"/change-password/:token\",\n    \"change-email\": \"/change-email/:token\",\n    \"cancel-account\": \"/cancel-account/:token\",\n    \"register\": \"/register\",\n    \"invitation\": \"/invitation/:token\",\n    \"create-project\": \"/create-project\",\n    \"profile\": \"/profile\",\n    \"user-profile\": \"/profile/:username\",\n    \"blocked-project\": \"/blocked-project/:project\",\n    \"project\": \"/project/:project\",\n    \"project-backlog\": \"/project/:project/backlog\",\n    \"project-taskboard\": \"/project/:project/taskboard/:sprint\",\n    \"project-kanban\": \"/project/:project/kanban\",\n    \"project-issues\": \"/project/:project/issues\",\n    \"project-search\": \"/project/:project/search\",\n    \"project-userstories-detail\": \"/project/:project/us/:ref\",\n    \"project-tasks-detail\": \"/project/:project/task/:ref\",\n    \"project-issues-detail\": \"/project/:project/issue/:ref\",\n    \"project-wiki\": \"/project/:project/wiki\",\n    \"project-wiki-page\": \"/project/:project/wiki/:slug\",\n    \"project-team\": \"/project/:project/team\",\n    \"project-admin-home\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-details\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-default-values\": \"/project/:project/admin/project-profile/default-values\",\n    \"project-admin-project-profile-modules\": \"/project/:project/admin/project-profile/modules\",\n    \"project-admin-project-profile-export\": \"/project/:project/admin/project-profile/export\",\n    \"project-admin-project-profile-reports\": \"/project/:project/admin/project-profile/reports\",\n    \"project-admin-project-values-status\": \"/project/:project/admin/project-values/status\",\n    \"project-admin-project-values-points\": \"/project/:project/admin/project-values/points\",\n    \"project-admin-project-values-priorities\": \"/project/:project/admin/project-values/priorities\",\n    \"project-admin-project-values-severities\": \"/project/:project/admin/project-values/severities\",\n    \"project-admin-project-values-triggers\": \"/project/:project/admin/project-values/triggers\",\n    \"project-admin-project-values-types\": \"/project/:project/admin/project-values/types\",\n    \"project-admin-project-values-custom-fields\": \"/project/:project/admin/project-values/custom-fields\",\n    \"project-admin-memberships\": \"/project/:project/admin/memberships\",\n    \"project-admin-roles\": \"/project/:project/admin/roles\",\n    \"project-admin-third-parties-webhooks\": \"/project/:project/admin/third-parties/webhooks\",\n    \"project-admin-third-parties-github\": \"/project/:project/admin/third-parties/github\",\n    \"project-admin-third-parties-gitlab\": \"/project/:project/admin/third-parties/gitlab\",\n    \"project-admin-third-parties-bitbucket\": \"/project/:project/admin/third-parties/bitbucket\",\n    \"project-admin-contrib\": \"/project/:project/admin/contrib/:plugin\",\n    \"user-settings-user-profile\": \"/user-settings/user-profile\",\n    \"user-settings-user-change-password\": \"/user-settings/user-change-password\",\n    \"user-settings-user-avatar\": \"/user-settings/user-avatar\",\n    \"user-settings-mail-notifications\": \"/user-settings/mail-notifications\",\n    \"user-settings-contrib\": \"/user-settings/contrib/:plugin\"\n  };\n\n  init = function($log, $navurls) {\n    $log.debug(\"Initialize navigation urls\");\n    return $navurls.update(urls);\n  };\n\n  module.run([\"$log\", \"$tgNavUrls\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common.coffee\n */\n\n(function() {\n  var AnimationFrame, Capslock, CheckPermissionDirective, ClassPermissionDirective, DataPickerConfig, ProjectUrl, Qqueue, SelectedText, Template, ToggleCommentDirective, module, taiga,\n    slice = [].slice;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\", []);\n\n  DataPickerConfig = function($translate) {\n    return {\n      get: function() {\n        return {\n          i18n: {\n            previousMonth: $translate.instant(\"COMMON.PICKERDATE.PREV_MONTH\"),\n            nextMonth: $translate.instant(\"COMMON.PICKERDATE.NEXT_MONTH\"),\n            months: [$translate.instant(\"COMMON.PICKERDATE.MONTHS.JAN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.FEB\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.APR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAY\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUL\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.AUG\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.SEP\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.OCT\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.NOV\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.DEC\")],\n            weekdays: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SAT\")],\n            weekdaysShort: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT\")]\n          },\n          isRTL: $translate.instant(\"COMMON.PICKERDATE.IS_RTL\") === \"true\",\n          firstDay: parseInt($translate.instant(\"COMMON.PICKERDATE.FIRST_DAY_OF_WEEK\"), 10),\n          format: $translate.instant(\"COMMON.PICKERDATE.FORMAT\")\n        };\n      }\n    };\n  };\n\n  module.factory(\"tgDatePickerConfigService\", [\"$translate\", DataPickerConfig]);\n\n  SelectedText = function($window, $document) {\n    var get;\n    get = function() {\n      if ($window.getSelection) {\n        return $window.getSelection().toString();\n      } else if ($document.selection) {\n        return $document.selection.createRange().text;\n      }\n      return \"\";\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$selectedText\", [\"$window\", \"$document\", SelectedText]);\n\n  CheckPermissionDirective = function(projectService) {\n    var link, render;\n    render = function($el, project, permission) {\n      if (project && permission) {\n        if (project.get('my_permissions').indexOf(permission) > -1) {\n          return $el.removeClass('hidden');\n        }\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var permission, unObserve, unwatch;\n      $el.addClass('hidden');\n      permission = $attrs.tgCheckPermission;\n      unwatch = $scope.$watch(function() {\n        return projectService.project;\n      }, function() {\n        if (!projectService.project) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unwatch();\n      });\n      unObserve = $attrs.$observe(\"tgCheckPermission\", function(permission) {\n        if (!permission) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unObserve();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CheckPermissionDirective.$inject = [\"tgProjectService\"];\n\n  module.directive(\"tgCheckPermission\", CheckPermissionDirective);\n\n  ClassPermissionDirective = function() {\n    var link, name;\n    name = \"tgClassPermission\";\n    link = function($scope, $el, $attrs) {\n      var checkPermissions, tgClassPermissionWatchAction, unbindWatcher;\n      checkPermissions = function(project, className, permission) {\n        var negation;\n        negation = permission[0] === \"!\";\n        if (negation) {\n          permission = permission.slice(1);\n        }\n        if (negation && project.my_permissions.indexOf(permission) === -1) {\n          return $el.addClass(className);\n        } else if (!negation && project.my_permissions.indexOf(permission) !== -1) {\n          return $el.addClass(className);\n        } else {\n          return $el.removeClass(className);\n        }\n      };\n      tgClassPermissionWatchAction = function(project) {\n        var className, classes, permission, results;\n        if (project) {\n          unbindWatcher();\n          classes = $scope.$eval($attrs[name]);\n          results = [];\n          for (className in classes) {\n            permission = classes[className];\n            results.push(checkPermissions(project, className, permission));\n          }\n          return results;\n        }\n      };\n      return unbindWatcher = $scope.$watch(\"project\", tgClassPermissionWatchAction);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgClassPermission\", ClassPermissionDirective);\n\n  AnimationFrame = function() {\n    var add, animationFrame, performAnimation, tail;\n    animationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;\n    performAnimation = (function(_this) {\n      return function(time) {\n        var fn;\n        fn = tail.shift();\n        fn();\n        if (tail.length) {\n          return animationFrame(performAnimation);\n        }\n      };\n    })(this);\n    tail = [];\n    add = function() {\n      var fn, i, len, results;\n      results = [];\n      for (i = 0, len = arguments.length; i < len; i++) {\n        fn = arguments[i];\n        tail.push(fn);\n        if (tail.length === 1) {\n          results.push(animationFrame(performAnimation));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    return {\n      add: add\n    };\n  };\n\n  module.factory(\"animationFrame\", AnimationFrame);\n\n  ToggleCommentDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.find(\"textarea\").on(\"focus\", function() {\n        return $el.addClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleComment\", ToggleCommentDirective);\n\n  ProjectUrl = function($navurls) {\n    var get;\n    get = function(project) {\n      var ctx;\n      ctx = {\n        project: project.slug\n      };\n      if (project.is_backlog_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-backlog\", ctx);\n      }\n      if (project.is_kanban_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-kanban\", ctx);\n      }\n      if (project.is_wiki_activated && project.my_permissions.indexOf(\"view_wiki_pages\") > -1) {\n        return $navurls.resolve(\"project-wiki\", ctx);\n      }\n      if (project.is_issues_activated && project.my_permissions.indexOf(\"view_issues\") > -1) {\n        return $navurls.resolve(\"project-issues\", ctx);\n      }\n      return $navurls.resolve(\"project\", ctx);\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$projectUrl\", [\"$tgNavUrls\", ProjectUrl]);\n\n  Qqueue = function($q) {\n    var deferred, lastPromise, qqueue;\n    deferred = $q.defer();\n    deferred.resolve();\n    lastPromise = deferred.promise;\n    qqueue = {\n      bindAdd: (function(_this) {\n        return function(fn) {\n          return function() {\n            var args;\n            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n            return lastPromise = lastPromise.then(function() {\n              return fn.apply(_this, args);\n            });\n          };\n          return qqueue;\n        };\n      })(this),\n      add: (function(_this) {\n        return function(fn) {\n          if (!lastPromise) {\n            lastPromise = fn();\n          } else {\n            lastPromise = lastPromise.then(fn);\n          }\n          return qqueue;\n        };\n      })(this)\n    };\n    return qqueue;\n  };\n\n  module.factory(\"$tgQqueue\", [\"$q\", Qqueue]);\n\n  Template = function($templateCache) {\n    return {\n      get: (function(_this) {\n        return function(name, lodash) {\n          var tmp;\n          if (lodash == null) {\n            lodash = false;\n          }\n          tmp = $templateCache.get(name);\n          if (lodash) {\n            tmp = _.template(tmp);\n          }\n          return tmp;\n        };\n      })(this)\n    };\n  };\n\n  module.factory(\"$tgTemplate\", [\"$templateCache\", Template]);\n\n  Capslock = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var hideIcon, open, showIcon, warningIcon;\n      open = false;\n      warningIcon = \"<svg class='icon icon-capslock' title='\" + $translate.instant('COMMON.CAPSLOCK_WARNING') + \"'><use xlink:href='#icon-capslock'></svg>\";\n      hideIcon = function() {\n        return $('.icon-capslock').fadeOut(function() {\n          open = false;\n          return $(this).remove();\n        });\n      };\n      showIcon = function(e) {\n        var element;\n        if (open) {\n          return;\n        }\n        element = e.currentTarget;\n        $(element).parent().append(warningIcon);\n        $('.icon-capslock').fadeIn();\n        return open = true;\n      };\n      $el.on('blur', function(e) {\n        return hideIcon();\n      });\n      $el.on('keyup.capslock, focus', function(e) {\n        if ($el.val() === $el.val().toLowerCase()) {\n          return hideIcon(e);\n        } else {\n          return showIcon(e);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off('.capslock');\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCapslock\", [\"$translate\", Capslock]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/events.coffee\n */\n\n(function() {\n  var EventsProvider, EventsService, bindMethods, module, startswith, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEvents\", []);\n\n  EventsService = (function() {\n    function EventsService(win, log, config, auth, liveAnnouncementService1, rootScope) {\n      this.win = win;\n      this.log = log;\n      this.config = config;\n      this.auth = auth;\n      this.liveAnnouncementService = liveAnnouncementService1;\n      this.rootScope = rootScope;\n      this.processMessage = bind(this.processMessage, this);\n      bindMethods(this);\n    }\n\n    EventsService.prototype.initialize = function(sessionId) {\n      this.sessionId = sessionId;\n      this.subscriptions = {};\n      this.connected = false;\n      this.error = false;\n      this.pendingMessages = [];\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = null;\n      if (this.win.WebSocket === void 0) {\n        return this.log.info(\"WebSockets not supported on your browser\");\n      }\n    };\n\n    EventsService.prototype.setupConnection = function() {\n      var loc, path, scheme, url;\n      this.stopExistingConnection();\n      url = this.config.get(\"eventsUrl\");\n      if (!url) {\n        return;\n      }\n      if (!startswith(url, \"ws:\") && !startswith(url, \"wss:\")) {\n        loc = this.win.location;\n        scheme = loc.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        path = _.trimStart(url, \"/\");\n        url = scheme + \"//\" + loc.host + \"/\" + path;\n      }\n      this.ws = new this.win.WebSocket(url);\n      this.ws.addEventListener(\"open\", this.onOpen);\n      this.ws.addEventListener(\"message\", this.onMessage);\n      this.ws.addEventListener(\"error\", this.onError);\n      return this.ws.addEventListener(\"close\", this.onClose);\n    };\n\n    EventsService.prototype.stopExistingConnection = function() {\n      if (this.ws === void 0) {\n        return;\n      }\n      this.ws.removeEventListener(\"open\", this.onOpen);\n      this.ws.removeEventListener(\"close\", this.onClose);\n      this.ws.removeEventListener(\"error\", this.onError);\n      this.ws.removeEventListener(\"message\", this.onMessage);\n      this.stopHeartBeatMessages();\n      this.ws.close();\n      return delete this.ws;\n    };\n\n    EventsService.prototype.notifications = function() {\n      return this.subscribe(null, 'notifications', (function(_this) {\n        return function(data) {\n          _this.liveAnnouncementService.show(data.title, data.desc);\n          return _this.rootScope.$digest();\n        };\n      })(this));\n    };\n\n    EventsService.prototype.startHeartBeatMessages = function() {\n      var heartbeatIntervalTime, maxMissedHeartbeats;\n      if (this.heartbeatInterval) {\n        return;\n      }\n      maxMissedHeartbeats = this.config.get(\"eventsMaxMissedHeartbeats\", 5);\n      heartbeatIntervalTime = this.config.get(\"eventsHeartbeatIntervalTime\", 60000);\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = setInterval((function(_this) {\n        return function() {\n          var e, error1;\n          try {\n            if (_this.missedHeartbeats >= maxMissedHeartbeats) {\n              throw new Error(\"Too many missed heartbeats PINGs.\");\n            }\n            _this.missedHeartbeats++;\n            _this.sendMessage({\n              cmd: \"ping\"\n            });\n            return _this.log.debug(\"HeartBeat send PING\");\n          } catch (error1) {\n            e = error1;\n            _this.log.error(\"HeartBeat error: \" + e.message);\n            return _this.stopHeartBeatMessages();\n          }\n        };\n      })(this), heartbeatIntervalTime);\n      return this.log.debug(\"HeartBeat enabled\");\n    };\n\n    EventsService.prototype.stopHeartBeatMessages = function() {\n      if (!this.heartbeatInterval) {\n        return;\n      }\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n      return this.log.debug(\"HeartBeat disabled\");\n    };\n\n    EventsService.prototype.processHeartBeatPongMessage = function(data) {\n      this.missedHeartbeats = 0;\n      return this.log.debug(\"HeartBeat recived PONG\");\n    };\n\n    EventsService.prototype.serialize = function(message) {\n      if (_.isObject(message)) {\n        return JSON.stringify(message);\n      }\n      return message;\n    };\n\n    EventsService.prototype.sendMessage = function(message) {\n      var i, len, messages, msg, results;\n      this.pendingMessages.push(message);\n      if (!this.connected) {\n        return;\n      }\n      messages = _.map(this.pendingMessages, this.serialize);\n      this.pendingMessages = [];\n      results = [];\n      for (i = 0, len = messages.length; i < len; i++) {\n        msg = messages[i];\n        results.push(this.ws.send(msg));\n      }\n      return results;\n    };\n\n    EventsService.prototype.processMessage = function(data) {\n      var routingKey, subscription;\n      routingKey = data.routing_key;\n      if (this.subscriptions[routingKey] == null) {\n        return;\n      }\n      subscription = this.subscriptions[routingKey];\n      if (subscription.scope) {\n        return subscription.scope.$apply(function() {\n          return subscription.callback(data.data);\n        });\n      } else {\n        return subscription.callback(data.data);\n      }\n    };\n\n    EventsService.prototype.subscribe = function(scope, routingKey, callback) {\n      var message, subscription;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Subscribe to: \" + routingKey);\n      subscription = {\n        scope: scope,\n        routingKey: routingKey,\n        callback: _.debounce(callback, 500, {\n          \"leading\": true,\n          \"trailing\": false\n        })\n      };\n      message = {\n        \"cmd\": \"subscribe\",\n        \"routing_key\": routingKey\n      };\n      this.subscriptions[routingKey] = subscription;\n      this.sendMessage(message);\n      if (scope) {\n        return scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            return _this.unsubscribe(routingKey);\n          };\n        })(this));\n      }\n    };\n\n    EventsService.prototype.unsubscribe = function(routingKey) {\n      var message;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Unsubscribe from: \" + routingKey);\n      message = {\n        \"cmd\": \"unsubscribe\",\n        \"routing_key\": routingKey\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onOpen = function() {\n      var message, token;\n      this.connected = true;\n      this.startHeartBeatMessages();\n      this.notifications();\n      this.log.debug(\"WebSocket connection opened\");\n      token = this.auth.getToken();\n      message = {\n        cmd: \"auth\",\n        data: {\n          token: token,\n          sessionId: this.sessionId\n        }\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onMessage = function(event) {\n      var data;\n      this.log.debug(\"WebSocket message received: \" + event.data);\n      data = JSON.parse(event.data);\n      if (data.cmd === \"pong\") {\n        return this.processHeartBeatPongMessage(data);\n      } else {\n        return this.processMessage(data);\n      }\n    };\n\n    EventsService.prototype.onError = function(error) {\n      this.log.error(\"WebSocket error: \" + error);\n      return this.error = true;\n    };\n\n    EventsService.prototype.onClose = function() {\n      this.log.debug(\"WebSocket closed.\");\n      this.connected = false;\n      return this.stopHeartBeatMessages();\n    };\n\n    return EventsService;\n\n  })();\n\n  EventsProvider = (function() {\n    function EventsProvider() {}\n\n    EventsProvider.prototype.setSessionId = function(sessionId) {\n      return this.sessionId = sessionId;\n    };\n\n    EventsProvider.prototype.$get = function($win, $log, $conf, $auth, liveAnnouncementService, $rootScope) {\n      var service;\n      service = new EventsService($win, $log, $conf, $auth, liveAnnouncementService, $rootScope);\n      service.initialize(this.sessionId);\n      return service;\n    };\n\n    EventsProvider.prototype.$get.$inject = [\"$window\", \"$log\", \"$tgConfig\", \"$tgAuth\", \"tgLiveAnnouncementService\", \"$rootScope\"];\n\n    return EventsProvider;\n\n  })();\n\n  module.provider(\"$tgEvents\", EventsProvider);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/feedback.coffee\n */\n\n(function() {\n  var FeedbackDirective, bindOnce, debounce, groupBy, mixOf, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaFeedback\", []);\n\n  FeedbackDirective = function($lightboxService, $repo, $confirm, $loading, feedbackService) {\n    var directive, link;\n    link = function($scope, $el, $attrs) {\n      var form, openLightbox, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"feedback\", $scope.feedback);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $lightboxService.close($el);\n            return $confirm.notify(\"success\", \"\\\\o/ we'll be happy to read your\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      openLightbox = function() {\n        $scope.feedback = {};\n        $lightboxService.open($el);\n        return $el.find(\"textarea\").focus();\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"common/lightbox-feedback.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbFeedback\", [\"lightboxService\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgFeedbackService\", FeedbackDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/integrations.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIntegrations\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIssues\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaKanban\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaPlugins\", [\"ngRoute\"]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/projects.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProject\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/related-tasks.coffee\n */\n\n(function() {\n  var RelatedTaskAssignedToInlineEditionDirective, RelatedTaskCreateButtonDirective, RelatedTaskCreateFormDirective, RelatedTaskRowDirective, RelatedTasksDirective, debounce, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaRelatedTasks\", []);\n\n  RelatedTaskRowDirective = function($repo, $compile, $confirm, $rootscope, $loading, $template, $translate) {\n    var link, templateEdit, templateView;\n    templateView = $template.get(\"task/related-task-row.html\", true);\n    templateEdit = $template.get(\"task/related-task-row-edit.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var renderEdit, renderView, saveTask;\n      saveTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.save(task);\n        promise.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"related-tasks:update\");\n          };\n        })(this));\n        promise.then(null, (function(_this) {\n          return function() {\n            currentLoading.finish();\n            $el.find('input').val(task.subject);\n            return $confirm.notify(\"error\");\n          };\n        })(this));\n        return promise;\n      });\n      renderEdit = function(task) {\n        $el.html($compile(templateEdit({\n          task: task\n        }))($scope));\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return saveTask($model.$modelValue).then(function() {\n              return renderView($model.$modelValue);\n            });\n          } else if (event.keyCode === 27) {\n            return renderView($model.$modelValue);\n          }\n        });\n        $el.on(\"click\", \".save-task\", function(event) {\n          return saveTask($model.$modelValue).then(function() {\n            return renderView($model.$modelValue);\n          });\n        });\n        return $el.on(\"click\", \".cancel-edit\", function(event) {\n          return renderView($model.$modelValue);\n        });\n      };\n      renderView = function(task) {\n        var perms;\n        $el.off();\n        perms = {\n          modify_task: $scope.project.my_permissions.indexOf(\"modify_task\") !== -1,\n          delete_task: $scope.project.my_permissions.indexOf(\"delete_task\") !== -1\n        };\n        $el.html($compile(templateView({\n          task: task,\n          perms: perms\n        }))($scope));\n        $el.on(\"click\", \".edit-task\", function() {\n          renderEdit($model.$modelValue);\n          return $el.find('input').focus().select();\n        });\n        return $el.on(\"click\", \".delete-task\", function(event) {\n          var message, title;\n          title = $translate.instant(\"TASK.TITLE_DELETE_ACTION\");\n          task = $model.$modelValue;\n          message = task.subject;\n          return $confirm.askOnDelete(title, message).then(function(askResponse) {\n            var promise;\n            promise = $repo.remove(task);\n            promise.then(function() {\n              askResponse.finish();\n              return $scope.$emit(\"related-tasks:delete\");\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          });\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(val) {\n        if (!val) {\n          return;\n        }\n        return renderView(val);\n      });\n      $scope.$on(\"related-tasks:assigned-to-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      $scope.$on(\"related-tasks:status-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgRelatedTaskRow\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", RelatedTaskRowDirective]);\n\n  RelatedTaskCreateFormDirective = function($repo, $compile, $confirm, $tgmodel, $loading, $analytics, $template) {\n    var link, newTask, template;\n    template = $template.get(\"task/related-task-create-form.html\", true);\n    newTask = {\n      subject: \"\",\n      assigned_to: null\n    };\n    link = function($scope, $el, $attrs) {\n      var close, createTask, render;\n      createTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        task.assigned_to = $scope.newTask.assigned_to;\n        task.status = $scope.newTask.status;\n        $scope.newTask.status = $scope.project.default_task_status;\n        $scope.newTask.assigned_to = null;\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.create(\"tasks\", task);\n        promise.then(function() {\n          $analytics.trackEvent(\"task\", \"create\", \"create task on userstory\", 1);\n          currentLoading.finish();\n          return $scope.$emit(\"related-tasks:add\");\n        });\n        promise.then(null, function() {\n          $el.find('input').val(task.subject);\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n        return promise;\n      });\n      close = function() {\n        $el.off();\n        $el.html(\"\");\n        return $scope.newRelatedTaskFormOpen = false;\n      };\n      render = function() {\n        $scope.newRelatedTaskFormOpen = true;\n        $el.html($compile(template())($scope));\n        $el.find('input').focus().select();\n        $el.addClass('active');\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return createTask(newTask).then(function() {\n              return render();\n            });\n          } else if (event.keyCode === 27) {\n            return $scope.$apply(function() {\n              return close();\n            });\n          }\n        });\n        $el.on(\"click\", \".icon-close\", function(event) {\n          return $scope.$apply(function() {\n            return close();\n          });\n        });\n        return $el.on(\"click\", \".icon-save\", function(event) {\n          return createTask(newTask).then(function() {\n            return close();\n          });\n        });\n      };\n      taiga.bindOnce($scope, \"us\", function(val) {\n        newTask[\"status\"] = $scope.project.default_task_status;\n        newTask[\"project\"] = $scope.project.id;\n        newTask[\"user_story\"] = $scope.us.id;\n        $scope.newTask = $tgmodel.make_model(\"tasks\", newTask);\n        return $el.html(\"\");\n      });\n      $scope.$on(\"related-tasks:show-form\", function() {\n        return render();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateForm\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgLoading\", \"$tgAnalytics\", \"$tgTemplate\", RelatedTaskCreateFormDirective]);\n\n  RelatedTaskCreateButtonDirective = function($repo, $compile, $confirm, $tgmodel, $template) {\n    var link, template;\n    template = $template.get(\"common/components/add-button.html\", true);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch(\"project\", function(val) {\n        if (!val) {\n          return;\n        }\n        $el.off();\n        if ($scope.project.my_permissions.indexOf(\"add_task\") !== -1) {\n          $el.html($compile(template())($scope));\n        } else {\n          $el.html(\"\");\n        }\n        return $el.on(\"click\", \".add-button\", function(event) {\n          return $scope.$emit(\"related-tasks:add-new-clicked\");\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateButton\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgTemplate\", RelatedTaskCreateButtonDirective]);\n\n  RelatedTasksDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var _isEditable, _isVisible, loadTasks;\n      loadTasks = function() {\n        return $rs.tasks.list($scope.projectId, null, $scope.usId).then((function(_this) {\n          return function(tasks) {\n            $scope.tasks = _.sortBy(tasks, 'ref');\n            return tasks;\n          };\n        })(this));\n      };\n      _isVisible = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"view_tasks\") !== -1;\n        }\n        return false;\n      };\n      _isEditable = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n        }\n        return false;\n      };\n      $scope.showRelatedTasks = function() {\n        var ref;\n        return _isVisible() && (_isEditable() || ((ref = $scope.tasks) != null ? ref.length : void 0));\n      };\n      $scope.$on(\"related-tasks:add\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:delete\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:add-new-clicked\", function() {\n        return $scope.$broadcast(\"related-tasks:show-form\");\n      });\n      taiga.bindOnce($scope, \"us\", function(val) {\n        return loadTasks();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", RelatedTasksDirective]);\n\n  RelatedTaskAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task, updateRelatedTask;\n      updateRelatedTask = function(task) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[task.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".task-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      updateRelatedTask(task);\n      $el.on(\"click\", \".task-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", task);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", debounce(2000, (function(_this) {\n        return function(ctx, userId, updatedRelatedTask) {\n          if (updatedRelatedTask.id === task.id) {\n            updatedRelatedTask.assigned_to = userId;\n            if (autoSave) {\n              $repo.save(updatedRelatedTask).then(function() {\n                return $scope.$emit(\"related-tasks:assigned-to-changed\");\n              });\n            }\n            return updateRelatedTask(updatedRelatedTask);\n          }\n        };\n      })(this)));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", RelatedTaskAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources.coffee\n */\n\n(function() {\n  var ResourcesService, initResources, initUrls, module, taiga, urls,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ResourcesService = (function(superClass) {\n    extend(ResourcesService, superClass);\n\n    function ResourcesService() {\n      return ResourcesService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ResourcesService;\n\n  })(taiga.Service);\n\n  urls = {\n    \"auth\": \"/auth\",\n    \"auth-register\": \"/auth/register\",\n    \"invitations\": \"/invitations\",\n    \"users\": \"/users\",\n    \"by_username\": \"/users/by_username\",\n    \"users-password-recovery\": \"/users/password_recovery\",\n    \"users-change-password-from-recovery\": \"/users/change_password_from_recovery\",\n    \"users-change-password\": \"/users/change_password\",\n    \"users-change-email\": \"/users/change_email\",\n    \"users-cancel-account\": \"/users/cancel\",\n    \"user-stats\": \"/users/%s/stats\",\n    \"user-liked\": \"/users/%s/liked\",\n    \"user-voted\": \"/users/%s/voted\",\n    \"user-watched\": \"/users/%s/watched\",\n    \"user-contacts\": \"/users/%s/contacts\",\n    \"user-me\": \"/users/me\",\n    \"permissions\": \"/permissions\",\n    \"notify-policies\": \"/notify-policies\",\n    \"user-storage\": \"/user-storage\",\n    \"memberships\": \"/memberships\",\n    \"bulk-create-memberships\": \"/memberships/bulk_create\",\n    \"roles\": \"/roles\",\n    \"permissions\": \"/permissions\",\n    \"resolver\": \"/resolver\",\n    \"projects\": \"/projects\",\n    \"project-templates\": \"/project-templates\",\n    \"project-modules\": \"/projects/%s/modules\",\n    \"bulk-update-projects-order\": \"/projects/bulk_update_order\",\n    \"project-like\": \"/projects/%s/like\",\n    \"project-unlike\": \"/projects/%s/unlike\",\n    \"project-watch\": \"/projects/%s/watch\",\n    \"project-unwatch\": \"/projects/%s/unwatch\",\n    \"project-transfer-validate-token\": \"/projects/%s/transfer_validate_token\",\n    \"project-transfer-accept\": \"/projects/%s/transfer_accept\",\n    \"project-transfer-reject\": \"/projects/%s/transfer_reject\",\n    \"project-transfer-request\": \"/projects/%s/transfer_request\",\n    \"project-transfer-start\": \"/projects/%s/transfer_start\",\n    \"userstory-statuses\": \"/userstory-statuses\",\n    \"points\": \"/points\",\n    \"task-statuses\": \"/task-statuses\",\n    \"issue-statuses\": \"/issue-statuses\",\n    \"issue-types\": \"/issue-types\",\n    \"priorities\": \"/priorities\",\n    \"severities\": \"/severities\",\n    \"triggers\": \"/triggers\",\n    \"milestones\": \"/milestones\",\n    \"userstories\": \"/userstories\",\n    \"bulk-create-us\": \"/userstories/bulk_create\",\n    \"bulk-update-us-backlog-order\": \"/userstories/bulk_update_backlog_order\",\n    \"bulk-update-us-sprint-order\": \"/userstories/bulk_update_sprint_order\",\n    \"bulk-update-us-kanban-order\": \"/userstories/bulk_update_kanban_order\",\n    \"userstories-filters\": \"/userstories/filters_data\",\n    \"userstory-upvote\": \"/userstories/%s/upvote\",\n    \"userstory-downvote\": \"/userstories/%s/downvote\",\n    \"userstory-watch\": \"/userstories/%s/watch\",\n    \"userstory-unwatch\": \"/userstories/%s/unwatch\",\n    \"tasks\": \"/tasks\",\n    \"bulk-create-tasks\": \"/tasks/bulk_create\",\n    \"bulk-update-task-taskboard-order\": \"/tasks/bulk_update_taskboard_order\",\n    \"task-upvote\": \"/tasks/%s/upvote\",\n    \"task-downvote\": \"/tasks/%s/downvote\",\n    \"task-watch\": \"/tasks/%s/watch\",\n    \"task-unwatch\": \"/tasks/%s/unwatch\",\n    \"issues\": \"/issues\",\n    \"bulk-create-issues\": \"/issues/bulk_create\",\n    \"issues-filters\": \"/issues/filters_data\",\n    \"issue-upvote\": \"/issues/%s/upvote\",\n    \"issue-downvote\": \"/issues/%s/downvote\",\n    \"issue-watch\": \"/issues/%s/watch\",\n    \"issue-unwatch\": \"/issues/%s/unwatch\",\n    \"wiki\": \"/wiki\",\n    \"wiki-restore\": \"/wiki/%s/restore\",\n    \"wiki-links\": \"/wiki-links\",\n    \"history/us\": \"/history/userstory\",\n    \"history/issue\": \"/history/issue\",\n    \"history/task\": \"/history/task\",\n    \"history/wiki\": \"/history/wiki\",\n    \"attachments/us\": \"/userstories/attachments\",\n    \"attachments/issue\": \"/issues/attachments\",\n    \"attachments/task\": \"/tasks/attachments\",\n    \"attachments/wiki_page\": \"/wiki/attachments\",\n    \"custom-attributes/userstory\": \"/userstory-custom-attributes\",\n    \"custom-attributes/issue\": \"/issue-custom-attributes\",\n    \"custom-attributes/task\": \"/task-custom-attributes\",\n    \"custom-attributes-values/userstory\": \"/userstories/custom-attributes-values\",\n    \"custom-attributes-values/issue\": \"/issues/custom-attributes-values\",\n    \"custom-attributes-values/task\": \"/tasks/custom-attributes-values\",\n    \"webhooks\": \"/webhooks\",\n    \"webhooks-test\": \"/webhooks/%s/test\",\n    \"webhooklogs\": \"/webhooklogs\",\n    \"webhooklogs-resend\": \"/webhooklogs/%s/resend\",\n    \"userstories-csv\": \"/userstories/csv?uuid=%s\",\n    \"tasks-csv\": \"/tasks/csv?uuid=%s\",\n    \"issues-csv\": \"/issues/csv?uuid=%s\",\n    \"timeline-profile\": \"/timeline/profile\",\n    \"timeline-user\": \"/timeline/user\",\n    \"timeline-project\": \"/timeline/project\",\n    \"search\": \"/search\",\n    \"exporter\": \"/exporter\",\n    \"importer\": \"/importer/load_dump\",\n    \"feedback\": \"/feedback\",\n    \"locales\": \"/locales\",\n    \"applications\": \"/applications\",\n    \"application-tokens\": \"/application-tokens\",\n    \"stats-discover\": \"/stats/discover\"\n  };\n\n  initUrls = function($log, $urls) {\n    $log.debug(\"Initialize api urls\");\n    return $urls.update(urls);\n  };\n\n  initResources = function($log, $rs) {\n    var i, len, provider, providers, results;\n    $log.debug(\"Initialize resources\");\n    providers = _.toArray(arguments).slice(2);\n    results = [];\n    for (i = 0, len = providers.length; i < len; i++) {\n      provider = providers[i];\n      results.push(provider($rs));\n    }\n    return results;\n  };\n\n  module = angular.module(\"taigaResources\", [\"taigaBase\"]);\n\n  module.service(\"$tgResources\", ResourcesService);\n\n  module.run([\"$log\", \"$tgUrls\", initUrls]);\n\n  module.run([\"$log\", \"$tgResources\", \"$tgProjectsResourcesProvider\", \"$tgCustomAttributesResourcesProvider\", \"$tgCustomAttributesValuesResourcesProvider\", \"$tgMembershipsResourcesProvider\", \"$tgNotifyPoliciesResourcesProvider\", \"$tgInvitationsResourcesProvider\", \"$tgRolesResourcesProvider\", \"$tgUserSettingsResourcesProvider\", \"$tgSprintsResourcesProvider\", \"$tgUserstoriesResourcesProvider\", \"$tgTasksResourcesProvider\", \"$tgIssuesResourcesProvider\", \"$tgWikiResourcesProvider\", \"$tgSearchResourcesProvider\", \"$tgMdRenderResourcesProvider\", \"$tgHistoryResourcesProvider\", \"$tgKanbanResourcesProvider\", \"$tgModulesResourcesProvider\", \"$tgWebhooksResourcesProvider\", \"$tgWebhookLogsResourcesProvider\", \"$tgLocalesResourcesProvider\", \"$tgUsersResourcesProvider\", initResources]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/search.coffee\n */\n\n(function() {\n  var SearchBoxDirective, SearchController, SearchDirective, bindOnce, debounce, debounceLeading, groupBy, mixOf, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaSearch\", []);\n\n  SearchController = (function(superClass) {\n    extend(SearchController, superClass);\n\n    SearchController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$translate\"];\n\n    function SearchController(scope1, repo, rs, params, q, location, appMetaService, navUrls, translate) {\n      var loadSearchData, promise;\n      this.scope = scope1;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.scope.sectionName = \"Search\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"SEARCH.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"SEARCH.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.searchTerm = null;\n      loadSearchData = debounceLeading(100, (function(_this) {\n        return function(t) {\n          return _this.loadSearchData(t);\n        };\n      })(this));\n      bindOnce(this.scope, \"projectId\", (function(_this) {\n        return function(projectId) {\n          if (!_this.scope.searchResults && _this.scope.searchTerm) {\n            return _this.loadSearchData();\n          }\n        };\n      })(this));\n      this.scope.$watch(\"searchTerm\", (function(_this) {\n        return function(term) {\n          if (term !== void 0 && _this.scope.projectId) {\n            return _this.loadSearchData(term);\n          }\n        };\n      })(this));\n    }\n\n    SearchController.prototype.loadFilters = function() {\n      var defered;\n      defered = this.q.defer();\n      defered.resolve();\n      return defered.promise;\n    };\n\n    SearchController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    SearchController.prototype.loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      this.scope.loading = true;\n      return this._loadSearchData(term).then((function(_this) {\n        return function(data) {\n          _this.scope.searchResults = data;\n          return _this.scope.loading = false;\n        };\n      })(this));\n    };\n\n    SearchController.prototype._loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      if (this._promise) {\n        this._promise.abort();\n      }\n      this._promise = this.rs.search[\"do\"](this.scope.projectId, term);\n      return this._promise;\n    };\n\n    SearchController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          return _this.fillUsersAndRoles(project.members, project.roles);\n        };\n      })(this));\n    };\n\n    return SearchController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"SearchController\", SearchController);\n\n  SearchBoxDirective = function(projectService, $lightboxService, $navurls, $location, $route) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var openLightbox, project, submit;\n      project = null;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, text, url;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          text = $el.find(\"#search-text\").val();\n          url = $navurls.resolve(\"project-search\", {\n            project: project.get(\"slug\")\n          });\n          return $scope.$apply(function() {\n            $lightboxService.close($el);\n            $location.path(url);\n            $location.search(\"text\", text).path(url);\n            return $route.reload();\n          });\n        };\n      })(this));\n      openLightbox = function() {\n        project = projectService.project;\n        return $lightboxService.open($el).then(function() {\n          return $el.find(\"#search-text\").focus();\n        });\n      };\n      $el.on(\"submit\", \"form\", submit);\n      return openLightbox();\n    };\n    return {\n      templateUrl: \"search/lightbox-search.html\",\n      link: link\n    };\n  };\n\n  SearchBoxDirective.$inject = [\"tgProjectService\", \"lightboxService\", \"$tgNavUrls\", \"$tgLocation\", \"$route\"];\n\n  module.directive(\"tgSearchBox\", SearchBoxDirective);\n\n  SearchDirective = function($log, $compile, $templatecache, $routeparams, $location) {\n    var link, linkTable;\n    linkTable = function($scope, $el, $attrs, $ctrl) {\n      var activeSectionName, applyAutoTab, getActiveSection, lastSearchResults, markSectionTabActive, renderFilterTabs, renderTableContent, tabsDom, templates;\n      applyAutoTab = true;\n      activeSectionName = \"userstories\";\n      tabsDom = $el.find(\".search-filter\");\n      lastSearchResults = null;\n      getActiveSection = function(data) {\n        var i, len, maxVal, name, ref, selectedSection, value;\n        maxVal = 0;\n        selectedSection = {};\n        selectedSection.name = \"userstories\";\n        selectedSection.value = [];\n        if (!applyAutoTab) {\n          selectedSection.name = activeSectionName;\n          selectedSection.value = data[activeSectionName];\n          return selectedSection;\n        }\n        if (data) {\n          ref = [\"userstories\", \"issues\", \"tasks\", \"wikipages\"];\n          for (i = 0, len = ref.length; i < len; i++) {\n            name = ref[i];\n            value = data[name];\n            if (value.length > maxVal) {\n              maxVal = value.length;\n              selectedSection.name = name;\n              selectedSection.value = value;\n              break;\n            }\n          }\n        }\n        if (maxVal === 0) {\n          return selectedSection;\n        }\n        return selectedSection;\n      };\n      renderFilterTabs = function(data) {\n        var name, results, value;\n        results = [];\n        for (name in data) {\n          value = data[name];\n          tabsDom.find(\"li.\" + name).show();\n          results.push(tabsDom.find(\"li.\" + name + \" .num\").html(value.length));\n        }\n        return results;\n      };\n      markSectionTabActive = function(section) {\n        tabsDom.find(\"a.active\").removeClass(\"active\");\n        tabsDom.find(\"li.\" + section.name + \" a\").addClass(\"active\");\n        applyAutoTab = false;\n        return activeSectionName = section.name;\n      };\n      templates = {\n        issues: $templatecache.get(\"search-issues\"),\n        tasks: $templatecache.get(\"search-tasks\"),\n        userstories: $templatecache.get(\"search-userstories\"),\n        wikipages: $templatecache.get(\"search-wikipages\")\n      };\n      renderTableContent = function(section) {\n        var element, oldElements, oldScope, scope, template;\n        oldElements = $el.find(\".search-result-table\").children();\n        oldScope = oldElements.scope();\n        if (oldScope) {\n          oldScope.$destroy();\n          oldElements.remove();\n        }\n        scope = $scope.$new();\n        scope[section.name] = section.value;\n        template = angular.element.parseHTML(trim(templates[section.name]));\n        element = $compile(template)(scope);\n        return $el.find(\".search-result-table\").html(element);\n      };\n      $scope.$watch(\"searchResults\", function(data) {\n        var activeSection;\n        lastSearchResults = data;\n        if (!lastSearchResults) {\n          return;\n        }\n        activeSection = getActiveSection(data);\n        renderFilterTabs(data);\n        renderTableContent(activeSection);\n        return markSectionTabActive(activeSection);\n      });\n      $scope.$watch(\"searchTerm\", function(searchTerm) {\n        if (searchTerm !== void 0) {\n          return $location.search(\"text\", searchTerm);\n        }\n      });\n      return $el.on(\"click\", \".search-filter li > a\", function(event) {\n        var section, sectionData, sectionName, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        sectionName = target.parent().data(\"name\");\n        sectionData = !lastSearchResults ? [] : lastSearchResults[sectionName];\n        section = {\n          name: sectionName,\n          value: sectionData\n        };\n        return $scope.$apply(function() {\n          renderTableContent(section);\n          return markSectionTabActive(section);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, searchText;\n      $ctrl = $el.controller();\n      linkTable($scope, $el, $attrs, $ctrl);\n      searchText = $routeparams.text;\n      return $scope.$watch(\"projectId\", function(projectId) {\n        if (projectId != null) {\n          return $scope.searchTerm = searchText;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSearch\", [\"$log\", \"$compile\", \"$templateCache\", \"$routeParams\", \"$tgLocation\", SearchDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTaskboard\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTasks\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTeam\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserSettings\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserStories\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaWiki\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/analytics.coffee\n */\n\n(function() {\n  var AnalyticsService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  AnalyticsService = (function(superClass) {\n    extend(AnalyticsService, superClass);\n\n    AnalyticsService.$inject = [\"$rootScope\", \"$log\", \"$tgConfig\", \"$window\", \"$document\", \"$location\"];\n\n    function AnalyticsService(rootscope, log, config, win, doc, location) {\n      var conf;\n      this.rootscope = rootscope;\n      this.log = log;\n      this.config = config;\n      this.win = win;\n      this.doc = doc;\n      this.location = location;\n      this.initialized = false;\n      conf = this.config.get(\"analytics\", {});\n      this.accountId = conf.accountId;\n      this.pageEvent = conf.pageEvent || \"$routeChangeSuccess\";\n      this.trackRoutes = conf.trackRoutes || true;\n      this.ignoreFirstPageLoad = conf.ignoreFirstPageLoad || false;\n    }\n\n    AnalyticsService.prototype.initialize = function() {\n      if (!this.accountId) {\n        this.log.debug(\"Analytics: no acount id provided. Disabling.\");\n        return;\n      }\n      this.injectAnalytics();\n      this.win.ga(\"create\", this.accountId, \"auto\");\n      this.win.ga(\"require\", \"displayfeatures\");\n      if (this.trackRoutes && (!this.ignoreFirstPageLoad)) {\n        this.win.ga(\"send\", \"pageview\", this.getUrl());\n      }\n      if (this.trackRoutes) {\n        this.rootscope.$on(this.pageEvent, (function(_this) {\n          return function() {\n            return _this.trackPage(_this.getUrl(), \"Taiga\");\n          };\n        })(this));\n      }\n      return this.initialized = true;\n    };\n\n    AnalyticsService.prototype.getUrl = function() {\n      return this.location.path();\n    };\n\n    AnalyticsService.prototype.injectAnalytics = function() {\n      var fn;\n      fn = (function(i,s,o,g,r,a,m){i[\"GoogleAnalyticsObject\"]=r;i[r]=i[r]||function(){\n              (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);});\n      return fn(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n    };\n\n    AnalyticsService.prototype.trackPage = function(url, title) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      title = title || this.doc[0].title;\n      return this.win.ga(\"send\", \"pageview\", {\n        \"page\": url,\n        \"title\": title\n      });\n    };\n\n    AnalyticsService.prototype.trackEvent = function(category, action, label, value) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga(\"send\", \"event\", category, action, label, value);\n    };\n\n    return AnalyticsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAnalytics\", AnalyticsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: bind-scope.coffee\n */\n\n(function() {\n  var BindScope, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  BindScope = function(config) {\n    var link;\n    if (!config.debugInfo) {\n      jQuery.fn.scope = function() {\n        return this.data('scope');\n      };\n    }\n    link = function($scope, $el) {\n      if (!config.debugInfo) {\n        return $el.data('scope', $scope).addClass('tg-scope');\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBindScope\", [\"$tgConfig\", BindScope]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: compile-html.directive.coffee\n */\n\n(function() {\n  var CompileHtmlDirective;\n\n  CompileHtmlDirective = function($compile) {\n    var link;\n    link = function(scope, element, attrs) {\n      return scope.$watch(attrs.tgCompileHtml, function(newValue, oldValue) {\n        element.html(newValue);\n        return $compile(element.contents())(scope);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CompileHtmlDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaCommon\").directive(\"tgCompileHtml\", CompileHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/components.coffee\n */\n\n(function() {\n  var AssignedToDirective, BlockButtonDirective, CreatedByDisplayDirective, DateRangeDirective, DateSelectorDirective, DeleteButtonDirective, EditableDescriptionDirective, EditableSubjectDirective, EditableWysiwyg, ListItemAssignedtoDirective, ListItemIssueStatusDirective, ListItemPriorityDirective, ListItemSeverityDirective, ListItemTaskStatusDirective, ListItemTriggerDirective, ListItemTypeDirective, ListItemUsStatusDirective, SprintProgressBarDirective, TgMainTitleDirective, TgProgressBarDirective, WatchersDirective, bindOnce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  DateRangeDirective = function($translate) {\n    var link, renderRange;\n    renderRange = function($el, first, second) {\n      var endDate, initDate, prettyDate;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      initDate = moment(first).format(prettyDate);\n      endDate = moment(second).format(prettyDate);\n      return $el.html(initDate + \"-\" + endDate);\n    };\n    link = function($scope, $el, $attrs) {\n      var first, ref, second;\n      ref = $attrs.tgDateRange.split(\",\"), first = ref[0], second = ref[1];\n      return bindOnce($scope, first, function(valFirst) {\n        return bindOnce($scope, second, function(valSecond) {\n          return renderRange($el, valFirst, valSecond);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateRange\", [\"$translate\", DateRangeDirective]);\n\n  DateSelectorDirective = function($rootscope, datePickerConfigService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var initialize, selectedDate, unbind;\n      selectedDate = null;\n      initialize = function() {\n        var datePickerConfig;\n        datePickerConfig = datePickerConfigService.get();\n        _.merge(datePickerConfig, {\n          field: $el[0],\n          onSelect: (function(_this) {\n            return function(date) {\n              return selectedDate = date;\n            };\n          })(this),\n          onOpen: (function(_this) {\n            return function() {\n              if (selectedDate != null) {\n                return $el.picker.setDate(selectedDate);\n              }\n            };\n          })(this)\n        });\n        return $el.picker = new Pikaday(datePickerConfig);\n      };\n      unbind = $rootscope.$on(\"$translateChangeEnd\", (function(_this) {\n        return function(ctx) {\n          return initialize();\n        };\n      })(this));\n      $scope.$watch($attrs.ngModel, function(val) {\n        if ((val != null) && !$el.picker) {\n          initialize();\n        }\n        if (val != null) {\n          return $el.picker.setDate(val);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgDateSelector\", [\"$rootScope\", \"tgDatePickerConfigService\", DateSelectorDirective]);\n\n  SprintProgressBarDirective = function() {\n    var link, renderProgress;\n    renderProgress = function($el, percentage, visual_percentage) {\n      if ($el.hasClass(\".current-progress\")) {\n        return $el.css(\"width\", percentage + \"%\");\n      } else {\n        $el.find(\".current-progress\").css(\"width\", visual_percentage + \"%\");\n        return $el.find(\".number\").html(percentage + \" %\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.tgSprintProgressbar, function(sprint) {\n        var closedPoints, percentage, totalPoints, visual_percentage;\n        closedPoints = sprint.closed_points;\n        totalPoints = sprint.total_points;\n        percentage = 0;\n        if (totalPoints !== 0) {\n          percentage = Math.round(100 * (closedPoints / totalPoints));\n        }\n        visual_percentage = 0;\n        if (totalPoints !== 0) {\n          visual_percentage = Math.round(98 * (closedPoints / totalPoints));\n        }\n        return renderProgress($el, percentage, visual_percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintProgressbar\", SprintProgressBarDirective);\n\n  CreatedByDisplayDirective = function($template, $compile, $translate, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        var ref;\n        if (model != null) {\n          $scope.owner = model.owner_extra_info || {\n            full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\"),\n            photo: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n          $scope.url = ((ref = $scope.owner) != null ? ref.is_active : void 0) ? $navUrls.resolve(\"user-profile\", {\n            username: $scope.owner.username\n          }) : \"\";\n          return $scope.date = moment(model.created_date).format($translate.instant(\"COMMON.DATETIME\"));\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true,\n      templateUrl: \"common/components/created-by.html\"\n    };\n  };\n\n  module.directive(\"tgCreatedByDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", CreatedByDisplayDirective]);\n\n  WatchersDirective = function($rootscope, $confirm, $repo, $qqueue, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/watchers.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var deleteWatcher, isEditable, renderWatchers, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(watchers) {\n          var item, promise;\n          item = $model.$modelValue.clone();\n          item.watchers = watchers;\n          $model.$setViewValue(item);\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            watchers = _.map(watchers, function(watcherId) {\n              return $scope.usersById[watcherId];\n            });\n            renderWatchers(watchers);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            $model.$modelValue.revert();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      deleteWatcher = $qqueue.bindAdd((function(_this) {\n        return function(watcherIds) {\n          var item, promise;\n          item = $model.$modelValue.clone();\n          item.watchers = watcherIds;\n          $model.$setViewValue(item);\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            var watchers;\n            watchers = _.map(item.watchers, function(watcherId) {\n              return $scope.usersById[watcherId];\n            });\n            renderWatchers(watchers);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            item.revert();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      renderWatchers = function(watchers) {\n        var ctx, html;\n        ctx = {\n          watchers: watchers,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".js-delete-watcher\", function(event) {\n        var message, target, title, watcherId;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        watcherId = target.data(\"watcher-id\");\n        title = $translate.instant(\"COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER\");\n        message = $scope.usersById[watcherId].full_name_display;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var watcherIds;\n            askResponse.finish();\n            watcherIds = _.clone($model.$modelValue.watchers, false);\n            watcherIds = _.pull(watcherIds, watcherId);\n            return deleteWatcher(watcherIds);\n          };\n        })(this));\n      });\n      $scope.$on(\"watcher:added\", function(ctx, watcherId) {\n        var watchers;\n        watchers = _.clone($model.$modelValue.watchers, false);\n        watchers.push(watcherId);\n        watchers = _.uniq(watchers);\n        return save(watchers);\n      });\n      $scope.$watch($attrs.ngModel, function(item) {\n        var watchers;\n        if (item == null) {\n          return;\n        }\n        watchers = _.map(item.watchers, function(watcherId) {\n          return $scope.usersById[watcherId];\n        });\n        return renderWatchers(watchers);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWatchers\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", \"$translate\", WatchersDirective]);\n\n  AssignedToDirective = function($rootscope, $confirm, $repo, $loading, $qqueue, $template, $translate, $compile, $currentUserService) {\n    var link, template;\n    template = $template.get(\"common/components/assigned-to.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, renderAssignedTo, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(userId) {\n          var currentLoading, promise;\n          $model.$modelValue.assigned_to = userId;\n          currentLoading = $loading().target($el).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            currentLoading.finish();\n            renderAssignedTo($model.$modelValue);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            $model.$modelValue.revert();\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          });\n          return promise;\n        };\n      })(this));\n      renderAssignedTo = function(assignedObject) {\n        var ctx, fullName, html, isIocaine, isUnassigned, photo;\n        if ((assignedObject != null ? assignedObject.assigned_to : void 0) != null) {\n          fullName = assignedObject.assigned_to_extra_info.full_name_display;\n          photo = assignedObject.assigned_to_extra_info.photo;\n          isUnassigned = false;\n        } else {\n          fullName = $translate.instant(\"COMMON.ASSIGNED_TO.ASSIGN\");\n          photo = \"/\" + window._version + \"/images/unnamed.png\";\n          isUnassigned = true;\n        }\n        isIocaine = assignedObject != null ? assignedObject.is_iocaine : void 0;\n        ctx = {\n          fullName: fullName,\n          photo: photo,\n          isUnassigned: isUnassigned,\n          isEditable: isEditable(),\n          isIocaine: isIocaine,\n          fullNameVisible: !(isUnassigned && !$currentUserService.isAuthenticated())\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".user-assigned\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"assigned-to:add\", $model.$modelValue);\n        });\n      });\n      $el.on(\"click\", \".assign-to-me\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        $model.$modelValue.assigned_to = $currentUserService.getUser().get('id');\n        return save($currentUserService.getUser().get('id'));\n      });\n      $el.on(\"click\", \".remove-user\", function(event) {\n        var title;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        title = $translate.instant(\"COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED\");\n        return $confirm.ask(title).then((function(_this) {\n          return function(response) {\n            response.finish();\n            $model.$modelValue.assigned_to = null;\n            return save(null);\n          };\n        })(this));\n      });\n      $scope.$on(\"assigned-to:added\", function(ctx, userId, item) {\n        if (item.id !== $model.$modelValue.id) {\n          return;\n        }\n        return save(userId);\n      });\n      $scope.$watch($attrs.ngModel, function(instance) {\n        return renderAssignedTo(instance);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgAssignedTo\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$translate\", \"$compile\", \"tgCurrentUserService\", AssignedToDirective]);\n\n  BlockButtonDirective = function($rootscope, $loading, $template) {\n    var link, template;\n    template = $template.get(\"common/components/block-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      $scope.$watch($attrs.ngModel, function(item) {\n        if (!item) {\n          return;\n        }\n        if (isEditable()) {\n          $el.find('.item-block').addClass('editable');\n        }\n        if (item.is_blocked) {\n          $el.find('.item-block').removeClass('is-active');\n          return $el.find('.item-unblock').addClass('is-active');\n        } else {\n          $el.find('.item-block').addClass('is-active');\n          return $el.find('.item-unblock').removeClass('is-active');\n        }\n      });\n      $el.on(\"click\", \".item-block\", function(event) {\n        event.preventDefault();\n        return $rootscope.$broadcast(\"block\", $model.$modelValue);\n      });\n      $el.on(\"click\", \".item-unblock\", function(event) {\n        var currentLoading, finish;\n        event.preventDefault();\n        currentLoading = $loading().target($el.find(\".item-unblock\")).start();\n        finish = function() {\n          return currentLoading.finish();\n        };\n        return $rootscope.$broadcast(\"unblock\", $model.$modelValue, finish);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgBlockButton\", [\"$rootScope\", \"$tgLoading\", \"$tgTemplate\", BlockButtonDirective]);\n\n  DeleteButtonDirective = function($log, $repo, $confirm, $location, $template) {\n    var link, template;\n    template = $template.get(\"common/components/delete-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.onDeleteGoToUrl) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-go-to-url set in scope.\");\n      }\n      if (!$attrs.onDeleteTitle) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-title set in scope.\");\n      }\n      $el.on(\"click\", \".button-delete\", function(event) {\n        var subtitle, title;\n        title = $attrs.onDeleteTitle;\n        subtitle = $model.$modelValue.subject;\n        return $confirm.askOnDelete(title, subtitle).then((function(_this) {\n          return function(askResponse) {\n            var promise;\n            promise = $repo.remove($model.$modelValue);\n            promise.then(function() {\n              var url;\n              askResponse.finish();\n              url = $scope.$eval($attrs.onDeleteGoToUrl);\n              return $location.path(url);\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgDeleteButton\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgTemplate\", DeleteButtonDirective]);\n\n  EditableSubjectDirective = function($rootscope, $repo, $confirm, $loading, $qqueue, $template) {\n    var link, template;\n    template = $template.get(\"common/components/editable-subject.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-subject').hide();\n        return $el.find('.view-subject').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(subject) {\n          var currentLoading, promise;\n          $model.$modelValue.subject = subject;\n          currentLoading = $loading().target($el.find('.save-container')).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-subject').hide();\n            return $el.find('.view-subject').show();\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n          return promise;\n        };\n      })(this));\n      $el.click(function() {\n        if (!isEditable()) {\n          return;\n        }\n        $el.find('.edit-subject').show();\n        $el.find('.view-subject').hide();\n        return $el.find('input').focus();\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var subject;\n        e.preventDefault();\n        subject = $scope.item.subject;\n        return save(subject);\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var subject;\n        if (event.keyCode === 13) {\n          subject = $scope.item.subject;\n          return save(subject);\n        } else if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $model.$modelValue.revert();\n            };\n          })(this));\n          $el.find('.edit-subject').hide();\n          return $el.find('.view-subject').show();\n        }\n      });\n      $el.find('.edit-subject').hide();\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (!isEditable()) {\n          return $el.find('.view-subject .edit').remove();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableSubject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", EditableSubjectDirective]);\n\n  EditableDescriptionDirective = function($rootscope, $repo, $confirm, $compile, $loading, $selectedText, $qqueue, $template) {\n    var link, noDescriptionMegEditMode, noDescriptionMegReadMode, template;\n    template = $template.get(\"common/components/editable-description.html\");\n    noDescriptionMegEditMode = $template.get(\"common/components/editable-description-msg-edit-mode.html\");\n    noDescriptionMegReadMode = $template.get(\"common/components/editable-description-msg-read-mode.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $el.find('.edit-description').hide();\n      $el.find('.view-description .edit').hide();\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(description) {\n          var currentLoading, promise;\n          $model.$modelValue.description = description;\n          currentLoading = $loading().target($el.find('.save-container')).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-description').hide();\n            return $el.find('.view-description').show();\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          return promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n      $el.on(\"mouseup\", \".view-description\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        $el.find('.edit-description').show();\n        $el.find('.view-description').hide();\n        return $el.find('textarea').focus();\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var description;\n        e.preventDefault();\n        description = $scope.item.description;\n        return save(description);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $scope.item.revert();\n            };\n          })(this));\n          $el.find('.edit-description').hide();\n          return $el.find('.view-description').show();\n        }\n      });\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (isEditable()) {\n          $el.find('.view-description .edit').show();\n          $el.find('.view-description .us-content').addClass('editable');\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegEditMode)($scope);\n        } else {\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegReadMode)($scope);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableDescription\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", \"$tgLoading\", \"$selectedText\", \"$tgQqueue\", \"$tgTemplate\", EditableDescriptionDirective]);\n\n  EditableWysiwyg = function(attachmentsService, attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var isInEditMode, uploadFile;\n      isInEditMode = function() {\n        return $el.find('textarea').is(':visible');\n      };\n      uploadFile = function(file, type) {\n        if (!attachmentsService.validate(file)) {\n          return;\n        }\n        return attachmentsFullService.addAttachment($model.$modelValue.project, $model.$modelValue.id, type, file).then(function(result) {\n          if (taiga.isImage(result.getIn(['file', 'name']))) {\n            return '![' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          } else {\n            return '[' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          }\n        });\n      };\n      $el.on('dragover', function(e) {\n        var textarea;\n        textarea = $el.find('textarea').focus();\n        return false;\n      });\n      return $el.on('drop', function(e) {\n        var dataTransfer, promises, textarea, type;\n        e.stopPropagation();\n        e.preventDefault();\n        if (isInEditMode()) {\n          dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n          textarea = $el.find('textarea');\n          textarea.addClass('in-progress');\n          type = $model.$modelValue['_name'];\n          if (type === \"userstories\") {\n            type = \"us\";\n          } else if (type === \"tasks\") {\n            type = \"task\";\n          } else if (type === \"issues\") {\n            type = \"issue\";\n          } else if (type === \"wiki\") {\n            type = \"wiki_page\";\n          }\n          promises = _.map(dataTransfer.files, function(file) {\n            return uploadFile(file, type);\n          });\n          return Promise.all(promises).then(function(result) {\n            textarea = $el.find('textarea');\n            $.markItUp({\n              replaceWith: result.join(' ')\n            });\n            return textarea.removeClass('in-progress');\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEditableWysiwyg\", [\"tgAttachmentsService\", \"tgAttachmentsFullService\", EditableWysiwyg]);\n\n  ListItemUsStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var us;\n      us = $scope.$eval($attrs.tgListitemUsStatus);\n      return bindOnce($scope, \"usStatusById\", function(usStatusById) {\n        return $el.html(usStatusById[us.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemUsStatus\", ListItemUsStatusDirective);\n\n  ListItemTaskStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var task;\n      task = $scope.$eval($attrs.tgListitemTaskStatus);\n      return bindOnce($scope, \"taskStatusById\", function(taskStatusById) {\n        return $el.html(taskStatusById[task.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTaskStatus\", ListItemTaskStatusDirective);\n\n  ListItemAssignedtoDirective = function($template, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/list-item-assigned-to-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"usersById\", function(usersById) {\n        var ctx, item, member;\n        item = $scope.$eval($attrs.tgListitemAssignedto);\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = usersById[item.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        return $el.html(template(ctx));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemAssignedto\", [\"$tgTemplate\", \"$translate\", ListItemAssignedtoDirective]);\n\n  ListItemIssueStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemIssueStatus);\n      return bindOnce($scope, \"issueStatusById\", function(issueStatusById) {\n        return $el.html(issueStatusById[issue.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemIssueStatus\", ListItemIssueStatusDirective);\n\n  ListItemTypeDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issueTypeById, issue) {\n        var domNode, type;\n        type = issueTypeById[issue.type];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", type.color);\n        return domNode.attr(\"title\", type.name);\n      };\n      bindOnce($scope, \"issueTypeById\", function(issueTypeById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemType);\n        return render(issueTypeById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemType, function(issue) {\n        return render($scope.issueTypeById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemType\", ListItemTypeDirective);\n\n  ListItemPriorityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(priorityById, issue) {\n        var domNode, priority;\n        priority = priorityById[issue.priority];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", priority.color);\n        return domNode.attr(\"title\", priority.name);\n      };\n      bindOnce($scope, \"priorityById\", function(priorityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemPriority);\n        return render(priorityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemPriority, function(issue) {\n        return render($scope.priorityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemPriority\", ListItemPriorityDirective);\n\n  ListItemSeverityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(severityById, issue) {\n        var domNode, severity;\n        severity = severityById[issue.severity];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", severity.color);\n        return domNode.attr(\"title\", severity.name);\n      };\n      bindOnce($scope, \"severityById\", function(severityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemSeverity);\n        return render(severityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemSeverity, function(issue) {\n        return render($scope.severityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemSeverity\", ListItemSeverityDirective);\n\n  ListItemTriggerDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemTrigger);\n      return bindOnce($scope, \"triggerById\", function(triggerById) {\n        return $el.html(triggerById[issue.trigger].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTrigger\", ListItemTriggerDirective);\n\n  TgProgressBarDirective = function($template) {\n    var link, render, template;\n    template = $template.get(\"common/components/progress-bar.html\", true);\n    render = function(el, percentage) {\n      return el.html(template({\n        percentage: percentage\n      }));\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgProgressBar, function(percentage) {\n        percentage = _.max([0, percentage]);\n        percentage = _.min([100, percentage]);\n        return render($el, percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProgressBar\", [\"$tgTemplate\", TgProgressBarDirective]);\n\n  TgMainTitleDirective = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $attrs.$observe(\"i18nSectionName\", function(i18nSectionName) {\n        return $scope.sectionName = i18nSectionName;\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/main-title.html\",\n      scope: {\n        projectName: \"=projectName\"\n      }\n    };\n  };\n\n  module.directive(\"tgMainTitle\", [\"$translate\", TgMainTitleDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/confirm.coffee\n */\n\n(function() {\n  var ConfirmService, NOTIFICATION_MSG, bindMethods, cancelTimeout, debounce, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  timeout = this.taiga.timeout;\n\n  cancelTimeout = this.taiga.cancelTimeout;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  NOTIFICATION_MSG = {\n    \"success\": {\n      title: \"NOTIFICATION.OK\",\n      message: \"NOTIFICATION.SAVED\"\n    },\n    \"error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    },\n    \"light-error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    }\n  };\n\n  ConfirmService = (function(superClass) {\n    extend(ConfirmService, superClass);\n\n    ConfirmService.$inject = [\"$q\", \"lightboxService\", \"$tgLoading\", \"$translate\"];\n\n    function ConfirmService(q, lightboxService, loading, translate) {\n      this.q = q;\n      this.lightboxService = lightboxService;\n      this.loading = loading;\n      this.translate = translate;\n      bindMethods(this);\n    }\n\n    ConfirmService.prototype.hide = function(el) {\n      if (el) {\n        this.lightboxService.close(el);\n        return el.off(\".confirm-dialog\");\n      }\n    };\n\n    ConfirmService.prototype.ask = function(title, subtitle, message, lightboxSelector) {\n      var defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-generic-ask\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      el.find(\".message\").text(message);\n      el.on(\"click.confirm-dialog\", \".button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.askOnDelete = function(title, message) {\n      return this.ask(title, this.translate.instant(\"NOTIFICATION.ASK_DELETE\"), message);\n    };\n\n    ConfirmService.prototype.askChoice = function(title, subtitle, choices, replacement, warning, lightboxSelector) {\n      var choicesField, defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-ask-choice\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      if (replacement) {\n        el.find(\".replacement\").text(replacement);\n      } else {\n        el.find(\".replacement\").remove();\n      }\n      if (warning) {\n        el.find(\".warning\").text(warning);\n      } else {\n        el.find(\".warning\").remove();\n      }\n      choicesField = el.find(\".choices\");\n      choicesField.html('');\n      _.each(choices, function(value, key) {\n        value = _.escape(value);\n        return choicesField.append(angular.element(\"<option value='\" + key + \"'>\" + value + \"</option>\"));\n      });\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            selected: choicesField.val(),\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.error = function(message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-error\");\n      el.find(\".title\").html(message);\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.success = function(title, message, icon) {\n      var defered, detailImage, el, useSVG;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-success\");\n      el.find(\"img\").remove();\n      el.find(\"svg\").remove();\n      if (icon) {\n        if (icon.type === \"img\") {\n          detailImage = $('<img>').addClass('lb-icon').attr('src', icon.name);\n        } else if (icon.type === \"svg\") {\n          useSVG = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n          useSVG.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + icon.name);\n          detailImage = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n          detailImage.classList.add(\"icon\");\n          detailImage.classList.add(\"lb-icon\");\n          detailImage.classList.add(icon.name);\n          detailImage.appendChild(useSVG);\n        }\n        if (detailImage) {\n          el.find('section').prepend(detailImage);\n        }\n      }\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.loader = function(title, message) {\n      var el;\n      el = angular.element(\".lightbox-generic-loading\");\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      return {\n        start: (function(_this) {\n          return function() {\n            return _this.lightboxService.open(el);\n          };\n        })(this),\n        stop: (function(_this) {\n          return function() {\n            return _this.lightboxService.close(el);\n          };\n        })(this),\n        update: (function(_this) {\n          return function(status, title, message, percent) {\n            if (title) {\n              el.find(\".title\").html(title);\n            }\n            if (message) {\n              el.find(\".message\").html(message);\n            }\n            if (percent) {\n              el.find(\".spin\").addClass(\"hidden\");\n              el.find(\".progress-bar-wrapper\").removeClass(\"hidden\");\n              el.find(\".progress-bar-wrapper > .bar\").width(percent + '%');\n              return el.find(\".progress-bar-wrapper > span\").html(percent + '%').css('left', (percent - 9) + '%');\n            } else {\n              el.find(\".spin\").removeClass(\"hidden\");\n              return el.find(\".progress-bar-wrapper\").addClass(\"hidden\");\n            }\n          };\n        })(this)\n      };\n    };\n\n    ConfirmService.prototype.notify = function(type, message, title, time) {\n      var body, el, selector;\n      selector = \".notification-message-\" + type;\n      el = angular.element(selector);\n      if (el.hasClass(\"active\")) {\n        return;\n      }\n      if (title) {\n        el.find(\"h4\").html(title);\n      } else {\n        el.find(\"h4\").html(this.translate.instant(NOTIFICATION_MSG[type].title));\n      }\n      if (message) {\n        el.find(\"p\").html(message);\n      } else {\n        el.find(\"p\").html(this.translate.instant(NOTIFICATION_MSG[type].message));\n      }\n      body = angular.element(\"body\");\n      body.find(\".notification-message .notification-light\").removeClass('active').addClass('inactive');\n      body.find(selector).removeClass('inactive').addClass('active');\n      if (this.tsem) {\n        cancelTimeout(this.tsem);\n      }\n      if (!time) {\n        time = type === 'error' || type === 'light-error' ? 3500 : 1500;\n      }\n      this.tsem = timeout(time, (function(_this) {\n        return function() {\n          body.find(selector).removeClass('active').addClass('inactive').one('animationend', function() {\n            return $(this).removeClass('inactive');\n          });\n          return delete _this.tsem;\n        };\n      })(this));\n      return el.on(\"click\", \".icon-close, .close\", (function(_this) {\n        return function(event) {\n          return body.find(selector).removeClass('active').addClass('inactive');\n        };\n      })(this));\n    };\n\n    return ConfirmService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaCommon\");\n\n  module.service(\"$tgConfirm\", ConfirmService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/custom-field-values.coffee\n */\n\n(function() {\n  var CustomAttributeValueDirective, CustomAttributesValuesController, CustomAttributesValuesDirective, DATE_TYPE, MULTILINE_TYPE, SELECT_TYPE, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindMethods, bindOnce, debounce, generateHash, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = this.taiga.bindMethods;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  generateHash = taiga.generateHash;\n\n  module = angular.module(\"taigaCommon\");\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  SELECT_TYPE = \"select\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: SELECT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_SELECT\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  CustomAttributesValuesController = (function(superClass) {\n    extend(CustomAttributesValuesController, superClass);\n\n    CustomAttributesValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\"];\n\n    function CustomAttributesValuesController(scope, rootscope, repo, rs, confirm, q) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.customAttributes = [];\n      this.customAttributesValues = null;\n    }\n\n    CustomAttributesValuesController.prototype.initialize = function(type, objectId) {\n      this.project = this.scope.project;\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    CustomAttributesValuesController.prototype.loadCustomAttributesValues = function() {\n      if (!this.objectId) {\n        return this.customAttributesValues;\n      }\n      return this.rs.customAttributesValues[this.type].get(this.objectId).then((function(_this) {\n        return function(customAttributesValues) {\n          _this.customAttributes = _this.project[_this.type + \"_custom_attributes\"];\n          _this.customAttributesValues = customAttributesValues;\n          return customAttributesValues;\n        };\n      })(this));\n    };\n\n    CustomAttributesValuesController.prototype.getAttributeValue = function(attribute) {\n      var attributeValue;\n      attributeValue = _.clone(attribute, false);\n      attributeValue.value = this.customAttributesValues.attributes_values[attribute.id];\n      return attributeValue;\n    };\n\n    CustomAttributesValuesController.prototype.updateAttributeValue = function(attributeValue) {\n      var attributesValues, onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"custom-attributes-values:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      attributesValues = _.clone(this.customAttributesValues.attributes_values, true);\n      attributesValues[attributeValue.id] = attributeValue.value;\n      this.customAttributesValues.attributes_values = attributesValues;\n      this.customAttributesValues.id = this.objectId;\n      return this.repo.save(this.customAttributesValues).then(onSuccess, onError);\n    };\n\n    return CustomAttributesValuesController;\n\n  })(taiga.Controller);\n\n  CustomAttributesValuesDirective = function($templates, $storage) {\n    var collapsedHash, link, template, templateFn;\n    template = $templates.get(\"custom-attributes/custom-attributes-values.html\", true);\n    collapsedHash = function(type) {\n      return generateHash([\"custom-attributes-collapsed\", type]);\n    };\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadCustomAttributesValues();\n      });\n      $el.on(\"click\", \".custom-fields-header .icon\", function() {\n        var collapsed, hash;\n        hash = collapsedHash($attrs.type);\n        collapsed = !($storage.get(hash) || false);\n        $storage.set(hash, collapsed);\n        if (collapsed) {\n          $el.find(\".custom-fields-header .icon\").removeClass(\"open\");\n          return $el.find(\".custom-fields-body\").removeClass(\"open\");\n        } else {\n          $el.find(\".custom-fields-header .icon\").addClass(\"open\");\n          return $el.find(\".custom-fields-body\").addClass(\"open\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      var collapsed;\n      collapsed = $storage.get(collapsedHash($attrs.type)) || false;\n      return template({\n        requiredEditionPerm: $attrs.requiredEditionPerm,\n        collapsed: collapsed\n      });\n    };\n    return {\n      require: [\"tgCustomAttributesValues\", \"ngModel\"],\n      controller: CustomAttributesValuesController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgCustomAttributesValues\", [\"$tgTemplate\", \"$tgStorage\", \"$translate\", CustomAttributesValuesDirective]);\n\n  CustomAttributeValueDirective = function($template, $selectedText, $compile, $translate, datePickerConfigService) {\n    var link, template, templateEdit;\n    template = $template.get(\"custom-attributes/custom-attribute-value.html\", true);\n    templateEdit = $template.get(\"custom-attributes/custom-attribute-value-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attributeValue, isEditable, prettyDate, render, setFocusAndSelectOnInputField, submit;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      render = function(attributeValue, edit) {\n        var ctx, datePickerConfig, editable, html, value;\n        if (edit == null) {\n          edit = false;\n        }\n        if (attributeValue.type === DATE_TYPE && attributeValue.value) {\n          value = moment(attributeValue.value, \"YYYY-MM-DD\").format(prettyDate);\n        } else {\n          value = attributeValue.value;\n        }\n        editable = isEditable();\n        ctx = {\n          id: attributeValue.id,\n          name: attributeValue.name,\n          description: attributeValue.description,\n          value: value,\n          isEditable: editable,\n          type: attributeValue.type\n        };\n        if (editable && (edit || !value)) {\n          html = templateEdit(ctx);\n          html = $compile(html)($scope);\n          $el.html(html);\n          if (attributeValue.type === DATE_TYPE) {\n            datePickerConfig = datePickerConfigService.get();\n            _.merge(datePickerConfig, {\n              field: $el.find(\"input[name=value]\")[0],\n              onSelect: (function(_this) {\n                return function(date) {\n                  var selectedDate;\n                  return selectedDate = date;\n                };\n              })(this),\n              onOpen: (function(_this) {\n                return function() {\n                  if (typeof selectedDate !== \"undefined\" && selectedDate !== null) {\n                    return $el.picker.setDate(selectedDate);\n                  }\n                };\n              })(this)\n            });\n            return $el.picker = new Pikaday(datePickerConfig);\n          }\n        } else {\n          html = template(ctx);\n          html = $compile(html)($scope);\n          return $el.html(html);\n        }\n      };\n      isEditable = function() {\n        var permissions, requiredEditionPerm;\n        permissions = $scope.project.my_permissions;\n        requiredEditionPerm = $attrs.requiredEditionPerm;\n        return permissions.indexOf(requiredEditionPerm) > -1;\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, input;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          input = $el.find(\"input[name=value], textarea[name='value'], select[name='value']\");\n          attributeValue.value = input.val();\n          if (attributeValue.type === DATE_TYPE) {\n            if (moment(attributeValue.value, prettyDate).isValid()) {\n              attributeValue.value = moment(attributeValue.value, prettyDate).format(\"YYYY-MM-DD\");\n            }\n          }\n          return $scope.$apply(function() {\n            return $ctrl.updateAttributeValue(attributeValue).then(function() {\n              return render(attributeValue, false);\n            });\n          });\n        };\n      })(this));\n      setFocusAndSelectOnInputField = function() {\n        return $el.find(\"input[name='value'], textarea[name='value'], select[name='value']\").focus().select();\n      };\n      attributeValue = $scope.$eval($attrs.tgCustomAttributeValue);\n      render(attributeValue);\n      $el.on(\"click\", \".js-value-view-mode span a\", function(event) {\n        return event.stopPropagation();\n      });\n      $el.on(\"click\", \".js-value-view-mode\", function() {\n        if (!isEditable()) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"click\", \".js-edit-description\", function(event) {\n        event.preventDefault();\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"keyup\", \"input[name=value], textarea[name='value'], select[name='value']\", function(event) {\n        if (event.keyCode === 13 && event.currentTarget.type !== \"textarea\" && event.currentTarget.type !== \"select\") {\n          return submit(event);\n        } else if (event.keyCode === 27) {\n          return render(attributeValue, false);\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".js-save-description\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"^tgCustomAttributesValues\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgCustomAttributeValue\", [\"$tgTemplate\", \"$selectedText\", \"$compile\", \"$translate\", \"tgDatePickerConfigService\", CustomAttributeValueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/estimation.coffee\n */\n\n(function() {\n  var EstimationsService, LbUsEstimationDirective, UsEstimationDirective, groupBy, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaCommon\");\n\n  LbUsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return $scope.$apply(function() {\n              return $model.$setViewValue(us);\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", LbUsEstimationDirective]);\n\n  UsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $qqueue, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return this.save(roleId, pointId).then(function() {\n              return $rootScope.$broadcast(\"object:updated\");\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsEstimationDirective]);\n\n  EstimationsService = function($template, $qqueue, $repo, $confirm, $q) {\n    var EstimationProcess, create, pointsTemplate;\n    pointsTemplate = $template.get(\"common/estimation/us-estimation-points.html\", true);\n    EstimationProcess = (function() {\n      function EstimationProcess($el1, us1, project1) {\n        this.$el = $el1;\n        this.us = us1;\n        this.project = project1;\n        this.bindClickEvents = bind(this.bindClickEvents, this);\n        this.isEditable = this.project.my_permissions.indexOf(\"modify_us\") !== -1;\n        this.roles = this.project.roles;\n        this.points = this.project.points;\n        this.pointsById = groupBy(this.points, function(x) {\n          return x.id;\n        });\n        this.onSelectedPointForRole = function(roleId, pointId) {};\n        this.render = function() {};\n      }\n\n      EstimationProcess.prototype.save = function(roleId, pointId) {\n        var deferred;\n        deferred = $q.defer();\n        $qqueue.add((function(_this) {\n          return function() {\n            var onError, onSuccess;\n            onSuccess = function() {\n              return deferred.resolve();\n            };\n            onError = function() {\n              $confirm.notify(\"error\");\n              _this.us.revert();\n              _this.render();\n              return deferred.reject();\n            };\n            return $repo.save(_this.us).then(onSuccess, onError);\n          };\n        })(this));\n        return deferred.promise;\n      };\n\n      EstimationProcess.prototype.calculateTotalPoints = function() {\n        var notNullValues, values;\n        values = _.map(this.us.points, (function(_this) {\n          return function(v, k) {\n            var ref;\n            return (ref = _this.pointsById[v]) != null ? ref.value : void 0;\n          };\n        })(this));\n        if (values.length === 0) {\n          return \"?\";\n        }\n        notNullValues = _.filter(values, function(v) {\n          return v != null;\n        });\n        if (notNullValues.length === 0) {\n          return \"?\";\n        }\n        return _.reduce(notNullValues, function(acc, num) {\n          return acc + num;\n        });\n      };\n\n      EstimationProcess.prototype.calculateRoles = function() {\n        var computableRoles, roles;\n        computableRoles = _.filter(this.project.roles, \"computable\");\n        roles = _.map(computableRoles, (function(_this) {\n          return function(role) {\n            var pointId, pointObj;\n            pointId = _this.us.points[role.id];\n            pointObj = _this.pointsById[pointId];\n            role = _.clone(role, true);\n            role.points = (pointObj != null) && (pointObj.name != null) ? pointObj.name : \"?\";\n            return role;\n          };\n        })(this));\n        return roles;\n      };\n\n      EstimationProcess.prototype.bindClickEvents = function() {\n        this.$el.on(\"click\", \".total.clickable\", (function(_this) {\n          return function(event) {\n            var roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            _this.renderPointsSelector(roleId, target);\n            target.siblings().removeClass('active');\n            return target.addClass('active');\n          };\n        })(this));\n        return this.$el.on(\"click\", \".point\", (function(_this) {\n          return function(event) {\n            var pointId, points, roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            pointId = target.data(\"point-id\");\n            _this.$el.find(\".popover\").popover().close();\n            points = _.clone(_this.us.points, true);\n            points[roleId] = pointId;\n            _this.us.points = points;\n            _this.render();\n            return _this.onSelectedPointForRole(roleId, pointId);\n          };\n        })(this));\n      };\n\n      EstimationProcess.prototype.renderPointsSelector = function(roleId, target) {\n        var horizontalList, html, maxPointLength, points, pop;\n        points = _.map(this.points, (function(_this) {\n          return function(point) {\n            point = _.clone(point, true);\n            point.selected = _this.us.points[roleId] === point.id ? false : true;\n            return point;\n          };\n        })(this));\n        maxPointLength = 5;\n        horizontalList = _.some(points, (function(_this) {\n          return function(point) {\n            return point.name.length > maxPointLength;\n          };\n        })(this));\n        html = pointsTemplate({\n          \"points\": points,\n          roleId: roleId,\n          horizontal: horizontalList\n        });\n        this.$el.find(\".popover\").popover().close();\n        this.$el.find(\".pop-points-open\").remove();\n        if (target != null) {\n          this.$el.find(target).append(html);\n        } else {\n          this.$el.append(html);\n        }\n        this.$el.find(\".pop-points-open\").popover().open(function() {\n          return $(this).removeClass(\"active\").closest(\"li\").removeClass(\"active\");\n        });\n        this.$el.find(\".pop-points-open\").show();\n        pop = this.$el.find(\".pop-points-open\");\n        if (pop.offset().top + pop.height() > document.body.clientHeight) {\n          return pop.addClass('pop-bottom');\n        }\n      };\n\n      return EstimationProcess;\n\n    })();\n    create = function($el, us, project) {\n      var estimationProcess;\n      $el.unbind(\"click\");\n      estimationProcess = new EstimationProcess($el, us, project);\n      if (estimationProcess.isEditable) {\n        estimationProcess.bindClickEvents();\n      }\n      return estimationProcess;\n    };\n    return {\n      create: create\n    };\n  };\n\n  module.factory(\"$tgEstimationsService\", [\"$tgTemplate\", \"$tgQqueue\", \"$tgRepo\", \"$tgConfirm\", \"$q\", EstimationsService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/filters.coffee\n */\n\n(function() {\n  var defaultFilter, module, momentFormat, momentFromNow, sizeFormat, taiga, unslugify, yesNoFilter;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  defaultFilter = function() {\n    return function(value, defaultValue) {\n      if (value === [null, void 0]) {\n        return defaultValue;\n      }\n      return value;\n    };\n  };\n\n  module.filter(\"default\", defaultFilter);\n\n  yesNoFilter = function($translate) {\n    return function(value) {\n      if (value) {\n        return $translate.instant(\"COMMON.YES\");\n      }\n      return $translate.instant(\"COMMON.NO\");\n    };\n  };\n\n  module.filter(\"yesNo\", [\"$translate\", yesNoFilter]);\n\n  unslugify = function() {\n    return taiga.unslugify;\n  };\n\n  module.filter(\"unslugify\", unslugify);\n\n  momentFormat = function() {\n    return function(input, format) {\n      if (input) {\n        return moment(input).format(format);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFormat\", momentFormat);\n\n  momentFromNow = function() {\n    return function(input, without_suffix) {\n      if (input) {\n        return moment(input).fromNow(without_suffix || false);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFromNow\", momentFromNow);\n\n  sizeFormat = (function(_this) {\n    return function() {\n      return _this.taiga.sizeFormat;\n    };\n  })(this);\n\n  module.filter(\"sizeFormat\", sizeFormat);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/history.coffee\n */\n\n(function() {\n  var HistoryController, HistoryDirective, IGNORED_FIELDS, bindOnce, debounce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  IGNORED_FIELDS = {\n    \"userstories.userstory\": [\"watchers\", \"kanban_order\", \"backlog_order\", \"sprint_order\", \"finish_date\", \"tribe_gig\"],\n    \"tasks.task\": [\"watchers\", \"us_order\", \"taskboard_order\"],\n    \"issues.issue\": [\"watchers\"]\n  };\n\n  HistoryController = (function(superClass) {\n    extend(HistoryController, superClass);\n\n    HistoryController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\"];\n\n    function HistoryController(scope, repo, rs) {\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n    }\n\n    HistoryController.prototype.initialize = function(type, objectId) {\n      this.type = type;\n      return this.objectId = objectId;\n    };\n\n    HistoryController.prototype.loadHistory = function(type, objectId) {\n      return this.rs.history.get(type, objectId).then((function(_this) {\n        return function(history) {\n          var changeModel, historyEntry, historyResult, i, j, len, len1;\n          for (i = 0, len = history.length; i < len; i++) {\n            historyResult = history[i];\n            if (historyResult.values_diff.description_diff != null) {\n              historyResult.values_diff.description = historyResult.values_diff.description_diff;\n            }\n            delete historyResult.values_diff.description_html;\n            delete historyResult.values_diff.description_diff;\n            if (historyResult.values_diff.blocked_note_diff != null) {\n              historyResult.values_diff.blocked_note = historyResult.values_diff.blocked_note_diff;\n            }\n            delete historyResult.values_diff.blocked_note_html;\n            delete historyResult.values_diff.blocked_note_diff;\n          }\n          for (j = 0, len1 = history.length; j < len1; j++) {\n            historyEntry = history[j];\n            changeModel = historyEntry.key.split(\":\")[0];\n            if (IGNORED_FIELDS[changeModel] != null) {\n              historyEntry.values_diff = _.removeKeys(historyEntry.values_diff, IGNORED_FIELDS[changeModel]);\n            }\n          }\n          _this.scope.history = _.filter(history, function(item) {\n            return Object.keys(item.values_diff).length > 0;\n          });\n          return _this.scope.comments = _.filter(history, function(item) {\n            return item.comment !== \"\";\n          });\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.deleteComment = function(type, objectId, activityId) {\n      return this.rs.history.deleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.undeleteComment = function(type, objectId, activityId) {\n      return this.rs.history.undeleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    return HistoryController;\n\n  })(taiga.Controller);\n\n  HistoryDirective = function($log, $loading, $qqueue, $template, $confirm, $translate, $compile, $navUrls, $rootScope, checkPermissionsService) {\n    var link, templateActivity, templateBase, templateBaseEntries, templateChangeAttachment, templateChangeDiff, templateChangeGeneric, templateChangeList, templateChangePoints, templateDeletedComment;\n    templateChangeDiff = $template.get(\"common/history/history-change-diff.html\", true);\n    templateChangePoints = $template.get(\"common/history/history-change-points.html\", true);\n    templateChangeGeneric = $template.get(\"common/history/history-change-generic.html\", true);\n    templateChangeAttachment = $template.get(\"common/history/history-change-attachment.html\", true);\n    templateChangeList = $template.get(\"common/history/history-change-list.html\", true);\n    templateDeletedComment = $template.get(\"common/history/history-deleted-comment.html\", true);\n    templateActivity = $template.get(\"common/history/history-activity.html\", true);\n    templateBaseEntries = $template.get(\"common/history/history-base-entries.html\", true);\n    templateBase = $template.get(\"common/history/history-base.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var countChanges, formatChange, getHumanizedFieldName, getPrettyDateFormat, objectId, renderActivity, renderAttachmentEntry, renderBase, renderChange, renderChangeEntries, renderChangeEntry, renderChangesHelperText, renderComment, renderComments, renderCustomAttributesEntry, renderHistory, rerender, save, showAllActivity, showAllComments, type;\n      type = $attrs.type;\n      objectId = null;\n      showAllComments = false;\n      showAllActivity = false;\n      getPrettyDateFormat = function() {\n        return $translate.instant(\"ACTIVITY.DATETIME\");\n      };\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        type = $attrs.type;\n        objectId = model.id;\n        $ctrl.initialize(type, objectId);\n        return $ctrl.loadHistory(type, objectId);\n      });\n      getHumanizedFieldName = function(field) {\n        var humanizedFieldNames;\n        humanizedFieldNames = {\n          subject: $translate.instant(\"ACTIVITY.FIELDS.SUBJECT\"),\n          name: $translate.instant(\"ACTIVITY.FIELDS.NAME\"),\n          description: $translate.instant(\"ACTIVITY.FIELDS.DESCRIPTION\"),\n          content: $translate.instant(\"ACTIVITY.FIELDS.CONTENT\"),\n          status: $translate.instant(\"ACTIVITY.FIELDS.STATUS\"),\n          is_closed: $translate.instant(\"ACTIVITY.FIELDS.IS_CLOSED\"),\n          finish_date: $translate.instant(\"ACTIVITY.FIELDS.FINISH_DATE\"),\n          type: $translate.instant(\"ACTIVITY.FIELDS.TYPE\"),\n          priority: $translate.instant(\"ACTIVITY.FIELDS.PRIORITY\"),\n          severity: $translate.instant(\"ACTIVITY.FIELDS.SEVERITY\"),\n          trigger: $translate.instant(\"ACTIVITY.FIELDS.TRIGGER\"),\n          assigned_to: $translate.instant(\"ACTIVITY.FIELDS.ASSIGNED_TO\"),\n          watchers: $translate.instant(\"ACTIVITY.FIELDS.WATCHERS\"),\n          milestone: $translate.instant(\"ACTIVITY.FIELDS.MILESTONE\"),\n          user_story: $translate.instant(\"ACTIVITY.FIELDS.USER_STORY\"),\n          project: $translate.instant(\"ACTIVITY.FIELDS.PROJECT\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          points: $translate.instant(\"ACTIVITY.FIELDS.POINTS\"),\n          client_requirement: $translate.instant(\"ACTIVITY.FIELDS.CLIENT_REQUIREMENT\"),\n          team_requirement: $translate.instant(\"ACTIVITY.FIELDS.TEAM_REQUIREMENT\"),\n          is_iocaine: $translate.instant(\"ACTIVITY.FIELDS.IS_IOCAINE\"),\n          tags: $translate.instant(\"ACTIVITY.FIELDS.TAGS\"),\n          attachments: $translate.instant(\"ACTIVITY.FIELDS.ATTACHMENTS\"),\n          is_deprecated: $translate.instant(\"ACTIVITY.FIELDS.IS_DEPRECATED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          order: $translate.instant(\"ACTIVITY.FIELDS.ORDER\"),\n          backlog_order: $translate.instant(\"ACTIVITY.FIELDS.BACKLOG_ORDER\"),\n          sprint_order: $translate.instant(\"ACTIVITY.FIELDS.SPRINT_ORDER\"),\n          kanban_order: $translate.instant(\"ACTIVITY.FIELDS.KANBAN_ORDER\"),\n          taskboard_order: $translate.instant(\"ACTIVITY.FIELDS.TASKBOARD_ORDER\"),\n          us_order: $translate.instant(\"ACTIVITY.FIELDS.US_ORDER\")\n        };\n        return humanizedFieldNames[field] || field;\n      };\n      countChanges = function(comment) {\n        return _.keys(comment.values_diff).length;\n      };\n      formatChange = function(change) {\n        if (_.isArray(change)) {\n          if (change.length === 0) {\n            return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n          }\n          return change.join(\", \");\n        }\n        if (change === \"\") {\n          return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n        }\n        if ((change == null) || change === false) {\n          return $translate.instant(\"ACTIVITY.VALUES.NO\");\n        }\n        if (change === true) {\n          return $translate.instant(\"ACTIVITY.VALUES.YES\");\n        }\n        return change;\n      };\n      renderAttachmentEntry = function(value) {\n        var attachments;\n        attachments = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.NEW_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var diff, name;\n              name = $translate.instant(\"ACTIVITY.UPDATED_ATTACHMENT\", {\n                filename: change.filename\n              });\n              diff = _.map(change.changes, function(values, name) {\n                return {\n                  name: getHumanizedFieldName(name),\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                };\n              });\n              return templateChangeAttachment({\n                name: name,\n                diff: diff\n              });\n            });\n          }\n        });\n        return _.flatten(attachments).join(\"\\n\");\n      };\n      renderCustomAttributesEntry = function(value) {\n        var customAttributes;\n        customAttributes = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              var html;\n              html = templateChangeGeneric({\n                name: change.name,\n                from: formatChange(\"\"),\n                to: formatChange(change.value)\n              });\n              html = $compile(html)($scope);\n              return html[0].outerHTML;\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_CUSTOM_ATTRIBUTE\"),\n                diff: change.name\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var customAttrsChanges;\n              customAttrsChanges = _.map(change.changes, function(values) {\n                return templateChangeGeneric({\n                  name: change.name,\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                });\n              });\n              return _.flatten(customAttrsChanges).join(\"\\n\");\n            });\n          }\n        });\n        return _.flatten(customAttributes).join(\"\\n\");\n      };\n      renderChangeEntry = function(field, value) {\n        var added, from, html, name, removed, to;\n        if (field === \"description\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"description\"),\n            diff: value[1]\n          });\n        } else if (field === \"blocked_note\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"blocked_note\"),\n            diff: value[1]\n          });\n        } else if (field === \"points\") {\n          html = templateChangePoints({\n            points: value\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"attachments\") {\n          return renderAttachmentEntry(value);\n        } else if (field === \"custom_attributes\") {\n          return renderCustomAttributesEntry(value);\n        } else if (field === \"tags\" || field === \"watchers\") {\n          name = getHumanizedFieldName(field);\n          removed = _.difference(value[0], value[1]);\n          added = _.difference(value[1], value[0]);\n          html = templateChangeList({\n            name: name,\n            removed: removed,\n            added: added\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"assigned_to\") {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          to = formatChange(value[1] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        } else {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0]);\n          to = formatChange(value[1]);\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        }\n      };\n      renderChangeEntries = function(change) {\n        return _.map(change.values_diff, function(value, field) {\n          return renderChangeEntry(field, value);\n        });\n      };\n      renderChangesHelperText = function(change) {\n        var size;\n        size = countChanges(change);\n        return $translate.instant(\"ACTIVITY.SIZE_CHANGE\", {\n          size: size\n        }, 'messageformat');\n      };\n      renderComment = function(comment) {\n        var html, ref, ref1, ref2;\n        if (comment.delete_comment_date || ((ref = comment.delete_comment_user) != null ? ref.name : void 0)) {\n          html = templateDeletedComment({\n            deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n            deleteCommentUser: comment.delete_comment_user.name,\n            deleteComment: comment.comment_html,\n            activityId: comment.id,\n            canRestoreComment: $scope.user && (comment.delete_comment_user.pk === $scope.user.id || $scope.project.my_permissions.indexOf(\"modify_project\") > -1)\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        }\n        html = templateActivity({\n          avatar: comment.user.photo,\n          userFullName: comment.user.name,\n          userProfileUrl: comment.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: comment.user.username\n          }) : \"\",\n          creationDate: moment(comment.created_at).format(getPrettyDateFormat()),\n          comment: comment.comment_html,\n          changesText: renderChangesHelperText(comment),\n          changes: renderChangeEntries(comment),\n          mode: \"comment\",\n          deleteCommentActionTitle: $translate.instant(\"COMMENTS.DELETE\"),\n          deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref1 = comment.delete_comment_user) != null ? ref1.name : void 0) ? comment.delete_comment_user.name : void 0,\n          activityId: comment.id,\n          canDeleteComment: comment.user.pk === ((ref2 = $scope.user) != null ? ref2.id : void 0) || $scope.project.my_permissions.indexOf(\"modify_project\") > -1\n        });\n        html = $compile(html)($scope);\n        return html[0].outerHTML;\n      };\n      renderChange = function(change) {\n        var ref;\n        return templateActivity({\n          avatar: change.user.photo,\n          userFullName: change.user.name,\n          userProfileUrl: change.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: change.user.username\n          }) : \"\",\n          creationDate: moment(change.created_at).format(getPrettyDateFormat()),\n          comment: change.comment_html,\n          changes: renderChangeEntries(change),\n          changesText: \"\",\n          mode: \"activity\",\n          deleteCommentDate: change.delete_comment_date ? moment(change.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref = change.delete_comment_user) != null ? ref.name : void 0) ? change.delete_comment_user.name : void 0,\n          activityId: change.id\n        });\n      };\n      renderHistory = function(entries, totalEntries) {\n        var html, showMore;\n        if (entries.length === totalEntries) {\n          showMore = 0;\n        } else {\n          showMore = totalEntries - entries.length;\n        }\n        html = templateBaseEntries({\n          entries: entries,\n          showMore: showMore\n        });\n        html = $compile(html)($scope);\n        return html;\n      };\n      renderBase = function() {\n        var changes, comments, commentsVisible, historyVisible, html;\n        comments = $scope.comments || [];\n        changes = $scope.history || [];\n        historyVisible = !!changes.length;\n        commentsVisible = (!!comments.length) || checkPermissionsService.check('modify_' + $attrs.type);\n        html = templateBase({\n          ngmodel: $attrs.ngModel,\n          type: $attrs.type,\n          mode: $attrs.mode,\n          historyVisible: historyVisible,\n          commentsVisible: commentsVisible\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      rerender = function() {\n        renderBase();\n        renderComments();\n        return renderActivity();\n      };\n      renderComments = function() {\n        var comments, html, totalComments;\n        comments = $scope.comments || [];\n        totalComments = comments.length;\n        if (!showAllComments) {\n          comments = _.takeRight(comments, 4);\n        }\n        comments = _.map(comments, function(x) {\n          return renderComment(x);\n        });\n        html = renderHistory(comments, totalComments);\n        return $el.find(\".comments-list\").html(html);\n      };\n      renderActivity = function() {\n        var changes, html, totalChanges;\n        changes = $scope.history || [];\n        totalChanges = changes.length;\n        if (!showAllActivity) {\n          changes = _.takeRight(changes, 4);\n        }\n        changes = _.map(changes, function(x) {\n          return renderChange(x);\n        });\n        html = renderHistory(changes, totalChanges);\n        return $el.find(\".changes-list\").html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(target) {\n          var currentLoading, model, onError, onSuccess;\n          $scope.$broadcast(\"markdown-editor:submit\");\n          $el.find(\".comment-list\").addClass(\"activeanimation\");\n          currentLoading = $loading().target(target).start();\n          onSuccess = function() {\n            $rootScope.$broadcast(\"comment:new\");\n            return $ctrl.loadHistory(type, objectId)[\"finally\"](function() {\n              return currentLoading.finish();\n            });\n          };\n          onError = function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          };\n          model = $scope.$eval($attrs.ngModel);\n          return $ctrl.repo.save(model).then(onSuccess, onError);\n        };\n      })(this));\n      $scope.$watch(\"comments\", rerender);\n      $scope.$watch(\"history\", rerender);\n      $scope.$on(\"object:updated\", function() {\n        return $ctrl.loadHistory(type, objectId);\n      });\n      $el.on(\"click\", \".add-comment button.button-green\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      }));\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href && href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".show-more\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.parent().is(\".changes-list\")) {\n          showAllActivity = !showAllActivity;\n          return renderActivity();\n        } else {\n          showAllComments = !showAllComments;\n          return renderComments();\n        }\n      });\n      $el.on(\"click\", \".show-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').show();\n        target.parents('.activity-single').find('.show-deleted-comment').hide();\n        return target.parents('.activity-single').find('.comment-body').show();\n      });\n      $el.on(\"click\", \".hide-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').hide();\n        target.parents('.activity-single').find('.show-deleted-comment').show();\n        return target.parents('.activity-single').find('.comment-body').hide();\n      });\n      $el.on(\"click\", \".changes-title\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return target.parent().find(\".change-entry\").toggleClass(\"active\");\n      });\n      $el.on(\"focus\", \".add-comment textarea\", function(event) {\n        return $(this).addClass('active');\n      });\n      $el.on(\"click\", \".history-tabs li a\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        $el.find(\".history-tabs li a\").removeClass(\"active\");\n        target.addClass(\"active\");\n        $el.find(\".history section\").addClass(\"hidden\");\n        return $el.find(\".history section.\" + (target.data('section-class'))).removeClass(\"hidden\");\n      });\n      $el.on(\"click\", \".comment-delete\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.deleteComment(type, objectId, activityId);\n      }));\n      $el.on(\"click\", \".comment-restore\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.undeleteComment(type, objectId, activityId);\n      }));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return renderBase();\n    };\n    return {\n      controller: HistoryController,\n      restrict: \"AE\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistory\", [\"$log\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$tgConfirm\", \"$translate\", \"$compile\", \"$tgNavUrls\", \"$rootScope\", \"tgCheckPermissionsService\", HistoryDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/importer.coffee\n */\n\n(function() {\n  var ImportProjectButtonDirective, LbImportErrorDirective, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  ImportProjectButtonDirective = function($rs, $confirm, $location, $navUrls, $translate, $lightboxFactory, currentUserService, $tgAuth) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var getRestrictionError;\n      getRestrictionError = function(result) {\n        var errorKey, maxMemberships, membersError, privateError, publicError, user;\n        if (result.headers) {\n          errorKey = '';\n          user = currentUserService.getUser();\n          maxMemberships = 0;\n          if (result.headers.isPrivate) {\n            privateError = !currentUserService.canCreatePrivateProjects().valid;\n            maxMemberships = null;\n            if (user.get('max_memberships_private_projects') !== null && result.headers.memberships >= user.get('max_memberships_private_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (privateError && membersError) {\n              errorKey = 'private-space-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            } else if (privateError) {\n              errorKey = 'private-space';\n            } else if (membersError) {\n              errorKey = 'private-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            }\n          } else {\n            publicError = !currentUserService.canCreatePublicProjects().valid;\n            if (user.get('max_memberships_public_projects') !== null && result.headers.memberships >= user.get('max_memberships_public_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (publicError && membersError) {\n              errorKey = 'public-space-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            } else if (publicError) {\n              errorKey = 'public-space';\n            } else if (membersError) {\n              errorKey = 'public-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            }\n          }\n          return {\n            key: errorKey,\n            values: {\n              max_memberships: maxMemberships,\n              members: result.headers.memberships\n            }\n          };\n        } else {\n          return false;\n        }\n      };\n      $el.on(\"click\", \".import-project-button\", function(event) {\n        event.preventDefault();\n        $el.find(\"input.import-file\").val(\"\");\n        return $el.find(\"input.import-file\").trigger(\"click\");\n      });\n      return $el.on(\"change\", \"input.import-file\", function(event) {\n        var file, loader, onError, onSuccess;\n        event.preventDefault();\n        file = event.target.files[0];\n        if (!file) {\n          return;\n        }\n        loader = $confirm.loader($translate.instant(\"PROJECT.IMPORT.UPLOADING_FILE\"));\n        onSuccess = function(result) {\n          return currentUserService.loadProjects().then(function() {\n            var ctx, message, msg, title;\n            loader.stop();\n            if (result.status === 202) {\n              title = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE\");\n              message = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE\");\n              return $confirm.success(title, message);\n            } else {\n              ctx = {\n                project: result.data.slug\n              };\n              $location.path($navUrls.resolve(\"project-admin-project-profile-details\", ctx));\n              msg = $translate.instant(\"PROJECT.IMPORT.SYNC_SUCCESS\");\n              return $confirm.notify(\"success\", msg);\n            }\n          });\n        };\n        onError = function(result) {\n          return $tgAuth.refresh().then(function() {\n            var errorMsg, ref, restrictionError;\n            restrictionError = getRestrictionError(result);\n            loader.stop();\n            if (restrictionError) {\n              return $lightboxFactory.create('tg-lb-import-error', {\n                \"class\": 'lightbox lightbox-import-error'\n              }, restrictionError);\n            } else {\n              errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR\");\n              if (result.status === 429) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST\");\n              } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MESSAGE\", {\n                  error_message: result.data._error_message\n                });\n              }\n              return $confirm.notify(\"error\", errorMsg);\n            }\n          });\n        };\n        loader.start();\n        return $rs.projects[\"import\"](file, loader.update).then(onSuccess, onError);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgImportProjectButton\", [\"$tgResources\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", \"$tgAuth\", ImportProjectButtonDirective]);\n\n  LbImportErrorDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs) {\n      lightboxService.open(el);\n      return scope.close = function() {\n        lightboxService.close(el);\n      };\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-import-error.html\",\n      link: link\n    };\n  };\n\n  LbImportErrorDirective.$inject = [\"lightboxService\"];\n\n  module.directive(\"tgLbImportError\", LbImportErrorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/lightboxes.coffee\n */\n\n(function() {\n  var AssignedToLightboxDirective, AttachmentPreviewLightboxDirective, BlockLightboxDirective, BlockingMessageInputDirective, CreateBulkUserstoriesDirective, CreateEditUserstoryDirective, LightboxDirective, LightboxKeyboardNavigationService, LightboxLeaveProjectWarningDirective, LightboxService, WatchersLightboxDirective, bindOnce, debounce, module, sizeFormat, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaCommon\");\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  LightboxService = (function(superClass) {\n    extend(LightboxService, superClass);\n\n    function LightboxService(animationFrame, q) {\n      this.animationFrame = animationFrame;\n      this.q = q;\n    }\n\n    LightboxService.prototype.open = function($el) {\n      var defered, docEl, lightboxContent;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      defered = this.q.defer();\n      lightboxContent = $el.children().not(\".close\");\n      lightboxContent.hide();\n      this.animationFrame.add(function() {\n        return $el.css('display', 'flex');\n      });\n      this.animationFrame.add(function() {\n        $el.addClass(\"open\");\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            return $el.find('input,textarea').first().focus();\n          };\n        })(this));\n      });\n      this.animationFrame.add((function(_this) {\n        return function() {\n          lightboxContent.show();\n          return defered.resolve();\n        };\n      })(this));\n      docEl = angular.element(document);\n      docEl.on(\"keydown.lightbox\", (function(_this) {\n        return function(e) {\n          var code;\n          code = e.keyCode ? e.keyCode : e.which;\n          if (code === 27) {\n            return _this.close($el);\n          }\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    LightboxService.prototype.close = function($el) {\n      var docEl, scope;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      docEl = angular.element(document);\n      docEl.off(\".lightbox\");\n      docEl.off(\".keyboard-navigation\");\n      $el.one(\"transitionend\", (function(_this) {\n        return function() {\n          $el.removeAttr('style');\n          return $el.removeClass(\"open\").removeClass('close');\n        };\n      })(this));\n      this.animationFrame.add(function() {\n        return $el.addClass('close');\n      });\n      if ($el.hasClass(\"remove-on-close\")) {\n        scope = $el.data(\"scope\");\n        scope.$destroy();\n        return $el.remove();\n      }\n    };\n\n    LightboxService.prototype.closeAll = function() {\n      var docEl, i, len, lightboxEl, ref, results;\n      docEl = angular.element(document);\n      ref = docEl.find(\".lightbox.open\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lightboxEl = ref[i];\n        results.push(this.close($(lightboxEl)));\n      }\n      return results;\n    };\n\n    return LightboxService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxService\", [\"animationFrame\", \"$q\", LightboxService]);\n\n  LightboxKeyboardNavigationService = (function(superClass) {\n    extend(LightboxKeyboardNavigationService, superClass);\n\n    function LightboxKeyboardNavigationService() {\n      return LightboxKeyboardNavigationService.__super__.constructor.apply(this, arguments);\n    }\n\n    LightboxKeyboardNavigationService.prototype.stop = function() {\n      var docEl;\n      docEl = angular.element(document);\n      return docEl.off(\".keyboard-navigation\");\n    };\n\n    LightboxKeyboardNavigationService.prototype.dispatch = function($el, code) {\n      var activeElement, next, prev;\n      activeElement = $el.find(\".selected\");\n      if (code === 13) {\n        if ($el.find(\".user-list-single\").length === 1) {\n          return $el.find('.user-list-single:first').trigger(\"click\");\n        } else {\n          return activeElement.trigger(\"click\");\n        }\n      } else if (code === 40) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:not(\".is-active\"):first').addClass('selected');\n        } else {\n          next = activeElement.next('.user-list-single');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return next.addClass('selected');\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:last').addClass('selected');\n        } else {\n          prev = activeElement.prev('.user-list-single:not(\".is-active\")');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return prev.addClass('selected');\n          }\n        }\n      }\n    };\n\n    LightboxKeyboardNavigationService.prototype.init = function($el) {\n      var docEl;\n      this.stop();\n      docEl = angular.element(document);\n      return docEl.on(\"keydown.keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38 || code === 13) {\n            event.preventDefault();\n            return _this.dispatch($el, code);\n          }\n        };\n      })(this));\n    };\n\n    return LightboxKeyboardNavigationService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxKeyboardNavigationService\", LightboxKeyboardNavigationService);\n\n  LightboxDirective = function(lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n    };\n    return {\n      restrict: \"C\",\n      link: link\n    };\n  };\n\n  module.directive(\"lightbox\", [\"lightboxService\", LightboxDirective]);\n\n  BlockLightboxDirective = function($rootscope, $tgrepo, $confirm, lightboxService, $loading, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var block, title, unblock;\n      title = $translate.instant($attrs.title);\n      $el.find(\"h2.title\").text(title);\n      unblock = $qqueue.bindAdd((function(_this) {\n        return function(item, finishCallback) {\n          var promise;\n          promise = $tgrepo.save(item);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $model.$setViewValue(item);\n            return finishCallback();\n          });\n          promise.then(null, function() {\n            $confirm.notify(\"error\");\n            item.revert();\n            return $model.$setViewValue(item);\n          });\n          promise[\"finally\"](function() {\n            return finishCallback();\n          });\n          return promise;\n        };\n      })(this));\n      block = $qqueue.bindAdd((function(_this) {\n        return function(item) {\n          var currentLoading, promise;\n          $model.$setViewValue(item);\n          currentLoading = $loading().target($el.find(\".button-green\")).start();\n          promise = $tgrepo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            $confirm.notify(\"error\");\n            item.revert();\n            return $model.$setViewValue(item);\n          });\n          return promise[\"finally\"](function() {\n            currentLoading.finish();\n            return lightboxService.close($el);\n          });\n        };\n      })(this));\n      $scope.$on(\"block\", function() {\n        $el.find(\".reason\").val($model.$modelValue.blocked_note);\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"unblock\", (function(_this) {\n        return function(event, model, finishCallback) {\n          var item;\n          item = $model.$modelValue.clone();\n          item.is_blocked = false;\n          item.blocked_note = \"\";\n          return unblock(item, finishCallback);\n        };\n      })(this));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        var item;\n        event.preventDefault();\n        item = $model.$modelValue.clone();\n        item.is_blocked = true;\n        item.blocked_note = $el.find(\".reason\").val();\n        return block(item);\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-block.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbBlock\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"lightboxService\", \"$tgLoading\", \"$tgQqueue\", \"$translate\", BlockLightboxDirective]);\n\n  BlockingMessageInputDirective = function($log, $template, $compile) {\n    var link, template, templateFn;\n    template = $template.get(\"common/lightbox/lightbox-blocking-message-input.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.watch) {\n        return $log.error(\"No watch attribute on tg-blocking-message-input directive\");\n      }\n      return $scope.$watch($attrs.watch, function(value) {\n        if (value === !void 0 && value === true) {\n          return $el.find(\".blocked-note\").removeClass(\"hidden\");\n        } else {\n          return $el.find(\".blocked-note\").addClass(\"hidden\");\n        }\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        ngmodel: $attrs.ngModel\n      });\n    };\n    return {\n      template: templateFn,\n      link: link,\n      require: \"ngModel\",\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBlockingMessageInput\", [\"$log\", \"$tgTemplate\", \"$compile\", BlockingMessageInputDirective]);\n\n  CreateEditUserstoryDirective = function($repo, $model, $rs, $rootScope, lightboxService, $loading, $translate, $confirm, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, form, resetAttachments, submit, submitButton;\n      form = null;\n      $scope.createEditUs = {};\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      $scope.$on(\"usform:new\", function(ctx, projectId, status, statusList) {\n        if (form) {\n          form.reset();\n        }\n        $scope.isNew = true;\n        $scope.usStatusList = statusList;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        $scope.us = $model.make_model(\"userstories\", {\n          project: projectId,\n          points: {},\n          status: status,\n          is_archived: false,\n          tags: []\n        });\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.CREATE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.NEW_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        $el.find(\".blocked-note\").addClass(\"hidden\");\n        $el.find(\"label.blocked\").removeClass(\"selected\");\n        $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"usform:edit\", function(ctx, us, attachments) {\n        if (form) {\n          form.reset();\n        }\n        $scope.us = us;\n        $scope.attachments = Immutable.fromJS(attachments);\n        $scope.isNew = false;\n        resetAttachments();\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.SAVE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.EDIT_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        if (us.is_blocked) {\n          $el.find(\".blocked-note\").removeClass(\"hidden\");\n          $el.find(\"label.blocked\").addClass(\"selected\");\n        } else {\n          $el.find(\".blocked-note\").addClass(\"hidden\");\n          $el.find(\"label.blocked\").removeClass(\"selected\");\n        }\n        if (us.team_requirement) {\n          $el.find(\"label.team-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        }\n        if (us.client_requirement) {\n          $el.find(\"label.client-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        }\n        return lightboxService.open($el);\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.us.project, 'us');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"us\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          if ($scope.isNew) {\n            promise = $repo.create(\"userstories\", $scope.us);\n            broadcastEvent = \"usform:new:success\";\n          } else {\n            promise = $repo.save($scope.us);\n            broadcastEvent = \"usform:edit:success\";\n          }\n          promise.then(function(data) {\n            deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this));\n            return data;\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootScope.$broadcast(broadcastEvent, data);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $scope.us.revert();\n        });\n        return lightboxService.close($el);\n      });\n      $el.keydown(function(event) {\n        var code;\n        code = event.keyCode ? event.keyCode : event.which;\n        if (code === 27) {\n          lightboxService.close($el);\n          return $scope.$apply(function() {\n            return $scope.us.revert();\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditUserstory\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", \"$tgConfirm\", \"$q\", \"tgAttachmentsService\", CreateEditUserstoryDirective]);\n\n  CreateBulkUserstoriesDirective = function($repo, $rs, $rootscope, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"usform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        $scope[\"new\"] = {\n          projectId: projectId,\n          statusId: status,\n          bulk: \"\"\n        };\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley({\n            onlyOneErrorElement: true\n          });\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userstories.bulkCreate($scope[\"new\"].projectId, $scope[\"new\"].statusId, $scope[\"new\"].bulk);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"usform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkUserstories\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", CreateBulkUserstoriesDirective]);\n\n  AssignedToLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, filterUsers, normalizeString, render, selectedItem, selectedUser, usersTemplate;\n      selectedUser = null;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      normalizeString = function(string) {\n        var normalizedString;\n        normalizedString = string;\n        normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n        normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n        normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n        normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n        normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n        return normalizedString;\n      };\n      filterUsers = function(text, user) {\n        var username;\n        username = user.full_name_display.toUpperCase();\n        username = normalizeString(username);\n        text = text.toUpperCase();\n        text = normalizeString(text);\n        return _.includes(username, text);\n      };\n      render = function(selected, text) {\n        var ctx, html, users;\n        users = _.clone($scope.activeUsers, true);\n        if (selected != null) {\n          users = _.reject(users, {\n            \"id\": selected.id\n          });\n        }\n        if (text != null) {\n          users = _.filter(users, _.partial(filterUsers, text));\n        }\n        ctx = {\n          selected: selected,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".assigned-to-list\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"assigned-to:add\", function(ctx, item) {\n        var assignedToId;\n        selectedItem = item;\n        assignedToId = item.assigned_to;\n        selectedUser = $scope.usersById[assignedToId];\n        render(selectedUser);\n        return lightboxService.open($el).then(function() {\n          $el.find('input').focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        if (searchingText != null) {\n          render(selectedUser, searchingText);\n          return $el.find('input').focus();\n        }\n      });\n      $el.on(\"click\", \".user-list-single\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.$broadcast(\"assigned-to:added\", target.data(\"user-id\"), selectedItem);\n          return $scope.usersSearch = null;\n        });\n      });\n      $el.on(\"click\", \".remove-assigned-to\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"assigned-to:added\", null, selectedItem);\n        });\n      });\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-assigned-to.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAssignedto\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", AssignedToLightboxDirective]);\n\n  WatchersLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, getFilteredUsers, render, selectedItem, usersTemplate;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      getFilteredUsers = function(text) {\n        var _filterUsers, users;\n        if (text == null) {\n          text = \"\";\n        }\n        _filterUsers = function(text, user) {\n          var username;\n          if (selectedItem && _.find(selectedItem.watchers, function(x) {\n            return x === user.id;\n          })) {\n            return false;\n          }\n          username = user.full_name_display.toUpperCase();\n          text = text.toUpperCase();\n          return _.includes(username, text);\n        };\n        users = _.clone($scope.activeUsers, true);\n        users = _.filter(users, _.partial(_filterUsers, text));\n        return users;\n      };\n      render = function(users) {\n        var ctx, html;\n        ctx = {\n          selected: false,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".ticket-watchers\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"watcher:add\", function(ctx, item) {\n        var users;\n        selectedItem = item;\n        users = getFilteredUsers();\n        render(users);\n        return lightboxService.open($el).then(function() {\n          $el.find(\"input\").focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        var users;\n        if (searchingText == null) {\n          return;\n        }\n        users = getFilteredUsers(searchingText);\n        render(users);\n        return $el.find(\"input\").focus();\n      });\n      $el.on(\"click\", \".user-list-single\", debounce(2000, function(event) {\n        var target;\n        closeLightbox();\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"watcher:added\", target.data(\"user-id\"));\n        });\n      }));\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-users.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbWatchers\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", WatchersLightboxDirective]);\n\n  AttachmentPreviewLightboxDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-attachment-preview.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLbAttachmentPreview\", [\"lightboxService\", \"$tgTemplate\", \"$compile\", AttachmentPreviewLightboxDirective]);\n\n  LightboxLeaveProjectWarningDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-leave-project-warning.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLightboxLeaveProjectWarning\", [\"lightboxService\", LightboxLeaveProjectWarningDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/loader.coffee\n */\n\n(function() {\n  var Loader, LoaderDirective, module, sizeFormat, taiga, timeout;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaCommon\");\n\n  LoaderDirective = function(tgLoader, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      tgLoader.onStart(function() {\n        $(document.body).addClass(\"loader-active\");\n        return $el.addClass(\"active\");\n      });\n      return tgLoader.onEnd(function() {\n        $(document.body).removeClass(\"loader-active\");\n        return $el.removeClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoader\", [\"tgLoader\", \"$rootScope\", LoaderDirective]);\n\n  Loader = function($rootscope) {\n    var autoClose, config, lastResponseDate, open, pageLoaded, requestCount, start, startLoadTime;\n    config = {\n      minTime: 300\n    };\n    open = false;\n    startLoadTime = 0;\n    requestCount = 0;\n    lastResponseDate = 0;\n    pageLoaded = function(force) {\n      var diff, endTime, timeoutValue;\n      if (force == null) {\n        force = false;\n      }\n      if (startLoadTime) {\n        timeoutValue = 0;\n        if (!force) {\n          endTime = new Date().getTime();\n          diff = endTime - startLoadTime;\n          if (diff < config.minTime) {\n            timeoutValue = config.minTime - diff;\n          }\n        }\n        timeout(timeoutValue, function() {\n          $rootscope.$broadcast(\"loader:end\");\n          open = false;\n          return window.prerenderReady = true;\n        });\n      }\n      startLoadTime = 0;\n      requestCount = 0;\n      return lastResponseDate = 0;\n    };\n    autoClose = function() {\n      var intervalAuto;\n      return intervalAuto = setInterval((function() {\n        if (lastResponseDate && requestCount === 0) {\n          pageLoaded();\n          return clearInterval(intervalAuto);\n        }\n      }), 50);\n    };\n    start = function() {\n      startLoadTime = new Date().getTime();\n      $rootscope.$broadcast(\"loader:start\");\n      return open = true;\n    };\n    return {\n      pageLoaded: pageLoaded,\n      start: function(auto) {\n        if (auto == null) {\n          auto = false;\n        }\n        if (!open) {\n          start();\n          if (auto) {\n            return autoClose();\n          }\n        }\n      },\n      onStart: function(fn) {\n        return $rootscope.$on(\"loader:start\", fn);\n      },\n      onEnd: function(fn) {\n        return $rootscope.$on(\"loader:end\", fn);\n      },\n      logRequest: function() {\n        return requestCount++;\n      },\n      logResponse: function() {\n        requestCount--;\n        return lastResponseDate = new Date().getTime();\n      }\n    };\n  };\n\n  Loader.$inject = [\"$rootScope\"];\n\n  module.factory(\"tgLoader\", Loader);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/lightboxes.coffee\n */\n\n(function() {\n  var LoadingDirective, TgLoadingService, module,\n    slice = [].slice;\n\n  module = angular.module(\"taigaCommon\");\n\n  TgLoadingService = function($compile) {\n    var spinner;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    return function() {\n      var service;\n      service = {\n        settings: {\n          target: null,\n          scope: null,\n          classes: [],\n          timeout: 0,\n          template: null\n        },\n        target: function(target) {\n          service.settings.target = target;\n          return service;\n        },\n        scope: function(scope) {\n          service.settings.scope = scope;\n          return service;\n        },\n        template: function(template) {\n          service.settings.template = template;\n          return service;\n        },\n        removeClasses: function() {\n          var classess;\n          classess = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          service.settings.classes = classess;\n          return service;\n        },\n        timeout: function(timeout) {\n          service.settings.timeout = timeout;\n          return service;\n        },\n        start: function() {\n          var target, timeoutId;\n          target = service.settings.target;\n          service.settings.classes.map(function(className) {\n            return target.removeClass(className);\n          });\n          if (!target.hasClass('loading') && !service.settings.template) {\n            service.settings.template = target.html();\n          }\n          timeoutId = setTimeout((function() {\n            if (!target.hasClass('loading')) {\n              target.addClass('loading');\n              return target.html(spinner);\n            }\n          }), service.settings.timeout);\n          service.settings.timeoutId = timeoutId;\n          return service;\n        },\n        finish: function() {\n          var removeClasses, target, timeoutId;\n          target = service.settings.target;\n          timeoutId = service.settings.timeoutId;\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n            removeClasses = service.settings.classes;\n            removeClasses.map(function(className) {\n              return service.settings.target.addClass(className);\n            });\n            target.html(service.settings.template);\n            target.removeClass('loading');\n            if (service.settings.scope) {\n              $compile(target.contents())(service.settings.scope);\n            }\n          }\n          return service;\n        }\n      };\n      return service;\n    };\n  };\n\n  TgLoadingService.$inject = [\"$compile\"];\n\n  module.factory(\"$tgLoading\", TgLoadingService);\n\n  LoadingDirective = function($loading) {\n    var link;\n    link = function($scope, $el, attr) {\n      var currentLoading, template;\n      currentLoading = null;\n      template = $el.html();\n      return $scope.$watch(attr.tgLoading, (function(_this) {\n        return function(showLoading) {\n          if (showLoading) {\n            return currentLoading = $loading().target($el).timeout(100).template(template).scope($scope).start();\n          } else if (currentLoading) {\n            return currentLoading.finish();\n          }\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoading\", [\"$tgLoading\", LoadingDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/popovers.coffee\n */\n\n(function() {\n  var RelatedTaskStatusDirective, UsStatusDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  UsStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a US and a popover to change it.\n    - tg-us-status: The user story\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-us-status=\"us\" on-update=\"ctrl.loadSprintState()\")\n        a.us-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'usStatusById' and 'project'.\n     */\n    var link, template;\n    template = $template.get(\"common/popover/popover-us-status.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render, us;\n      $ctrl = $el.controller();\n      render = function(us) {\n        var usStatusById, usStatusDom, usStatusDomParent;\n        usStatusDomParent = $el.find(\".us-status\");\n        usStatusDom = $el.find(\".us-status .us-status-bind\");\n        usStatusById = $scope.usStatusById;\n        if (usStatusById[us.status]) {\n          usStatusDom.text(usStatusById[us.status].name);\n          return usStatusDomParent.css(\"color\", usStatusById[us.status].color);\n        }\n      };\n      $el.on(\"click\", \".us-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target, us;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        us = $scope.$eval($attrs.tgUsStatus);\n        us.status = target.data(\"status-id\");\n        render(us);\n        $el.find(\".pop-status\").popover().close();\n        return $scope.$apply(function() {\n          return $repo.save(us).then(function() {\n            return $scope.$eval($attrs.onUpdate);\n          });\n        });\n      }));\n      $scope.$on(\"userstories:loaded\", function() {\n        return render($scope.$eval($attrs.tgUsStatus));\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      us = $scope.$eval($attrs.tgUsStatus);\n      render(us);\n      return bindOnce($scope, \"project\", function(project) {\n        var html;\n        html = template({\n          \"statuses\": project.us_statuses\n        });\n        $el.append(html);\n        if ($scope.project.my_permissions.indexOf(\"modify_us\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsStatus\", [\"$tgRepo\", \"$tgTemplate\", UsStatusDirective]);\n\n  RelatedTaskStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a related task and a popover to change it.\n    - tg-related-task-status: The related task\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-related-task-status=\"task\" on-update=\"ctrl.loadSprintState()\")\n        a.task-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'taskStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateTaskStatus;\n    selectionTemplate = $template.get(\"common/popover/popover-related-task-status.html\", true);\n    updateTaskStatus = function($el, task, taskStatusById) {\n      var taskStatusDom, taskStatusDomParent;\n      taskStatusDomParent = $el.find(\".us-status\");\n      taskStatusDom = $el.find(\".task-status .task-status-bind\");\n      if (taskStatusById[task.status]) {\n        taskStatusDom.text(taskStatusById[task.status].name);\n        return taskStatusDomParent.css('color', taskStatusById[task.status].color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task;\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskStatus);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $el.on(\"click\", \".task-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        task.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (autoSave) {\n          return $scope.$apply(function() {\n            return $repo.save(task).then(function() {\n              $scope.$eval($attrs.onUpdate);\n              return $scope.$emit(\"related-tasks:status-changed\");\n            });\n          });\n        }\n      }));\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.task_statuses\n        }));\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskStatus\", [\"$tgRepo\", \"$tgTemplate\", RelatedTaskStatusDirective]);\n\n  $.fn.popover = function() {\n    var $el, close, closeAll, closePopover, isVisible, open;\n    $el = this;\n    isVisible = (function(_this) {\n      return function() {\n        var docViewBottom, docViewLeft, docViewRight, docViewTop, docViewWidth, elemBottom, elemLeft, elemRight, elemTop, elemWidth;\n        $el.css({\n          \"display\": \"block\",\n          \"visibility\": \"hidden\"\n        });\n        docViewTop = $(window).scrollTop();\n        docViewBottom = docViewTop + $(window).height();\n        docViewWidth = $(window).width();\n        docViewRight = docViewWidth;\n        docViewLeft = 0;\n        elemTop = $el.offset().top;\n        elemBottom = elemTop + $el.height();\n        elemWidth = $el.width();\n        elemLeft = $el.offset().left;\n        elemRight = $el.offset().left + elemWidth;\n        $el.css({\n          \"display\": \"none\",\n          \"visibility\": \"visible\"\n        });\n        return (elemBottom <= docViewBottom) && (elemTop >= docViewTop) && (elemLeft >= docViewLeft) && (elemRight <= docViewRight);\n      };\n    })(this);\n    closePopover = (function(_this) {\n      return function(onClose) {\n        if (onClose) {\n          onClose.call($el);\n        }\n        $el.fadeOut(function() {\n          return $el.removeClass(\"active\").removeClass(\"fix\");\n        });\n        return $el.off(\"popup:close\");\n      };\n    })(this);\n    closeAll = (function(_this) {\n      return function() {\n        return $(\".popover.active\").each(function() {\n          return $(this).trigger(\"popup:close\");\n        });\n      };\n    })(this);\n    open = (function(_this) {\n      return function(onClose) {\n        if ($el.hasClass(\"active\")) {\n          return close();\n        } else {\n          closeAll();\n          if (!isVisible()) {\n            $el.addClass(\"fix\");\n          }\n          $el.fadeIn(function() {\n            $el.addClass(\"active\");\n            $(document.body).off(\"popover\");\n            return $(document.body).one(\"click.popover\", function() {\n              return closeAll();\n            });\n          });\n          return $el.on(\"popup:close\", function(e) {\n            return closePopover(onClose);\n          });\n        }\n      };\n    })(this);\n    close = (function(_this) {\n      return function() {\n        return $el.trigger(\"popup:close\");\n      };\n    })(this);\n    return {\n      open: open,\n      close: close,\n      closeAll: closeAll\n    };\n  };\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/raven-logger.coffee\n */\n\n(function() {\n  var ExceptionHandlerFactory, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  ExceptionHandlerFactory = function($log, config) {\n    var ravenConfig;\n    this.config = config;\n    ravenConfig = this.config.get(\"ravenConfig\", null);\n    if (ravenConfig) {\n      $log.debug(\"Using the RavenJS exception handler.\");\n      Raven.config(ravenConfig).install();\n      return function(exception, cause) {\n        $log.error.apply($log, arguments);\n        return Raven.captureException(exception);\n      };\n    } else {\n      $log.debug(\"Using the default logging exception handler.\");\n      return function(exception, cause) {\n        return $log.error.apply($log, arguments);\n      };\n    }\n  };\n\n  module.factory(\"$exceptionHandler\", [\"$log\", \"$tgConfig\", ExceptionHandlerFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/tags.coffee\n */\n\n(function() {\n  var ColorizeTagsDirective, LbTagLineDirective, TagLineDirective, TagsDirective, bindOnce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  TagsDirective = function() {\n    var formatter, link, parser;\n    formatter = function(v) {\n      if (_.isArray(v)) {\n        return v.join(\", \");\n      }\n      return \"\";\n    };\n    parser = function(v) {\n      var result;\n      if (!v) {\n        return [];\n      }\n      result = _(v.split(\",\")).map(function(x) {\n        return _.trim(x);\n      });\n      return result.value();\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      $ctrl.$formatters.push(formatter);\n      $ctrl.$parsers.push(parser);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgTags\", TagsDirective);\n\n  ColorizeTagsDirective = function() {\n    var link, templates;\n    templates = {\n      backlog: _.template(\"<% _.each(tags, function(tag) { %>\\n    <span class=\\\"tag\\\" style=\\\"border-left: 5px solid <%- tag.color %>\\\"><%- tag.name %></span>\\n<% }) %>\"),\n      kanban: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"kanban-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\"),\n      taskboard: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"taskboard-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\")\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      var render;\n      render = function(srcTags) {\n        var html, tags, template;\n        template = templates[$attrs.tgColorizeTagsType];\n        srcTags.sort();\n        tags = _.map(srcTags, function(tag) {\n          var color;\n          color = $scope.project.tags_colors[tag];\n          return {\n            name: tag,\n            color: color\n          };\n        });\n        html = template({\n          tags: tags\n        });\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.tgColorizeTags, function(tags) {\n        if (tags != null) {\n          return render(tags);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgColorizeTags\", ColorizeTagsDirective);\n\n  LbTagLineDirective = function($rs, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/lb-tag-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideSaveButton, renderTags, resetInput, saveInputTag, showSaveButton;\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          })\n        };\n        _.map(ctx.tags, (function(_this) {\n          return function(tag) {\n            if (tag.color) {\n              return tag.style = \"border-left: 5px solid \" + tag.color;\n            }\n          };\n        })(this));\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\".tags-container\").html(html);\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return $el.find(\"input\").autocomplete(\"close\");\n      };\n      addValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n        return hideSaveButton();\n      };\n      deleteValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        tags = _.pull(tags, value);\n        return $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          event.preventDefault();\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project\", function(project) {\n        var positioningFunction;\n        positioningFunction = function(position, elements) {\n          var menu;\n          menu = elements.element.element;\n          menu.css(\"width\", elements.target.width);\n          menu.css(\"top\", position.top);\n          return menu.css(\"left\", position.left);\n        };\n        return $el.find(\"input\").autocomplete({\n          source: _.keys(project.tags_colors),\n          position: {\n            my: \"left top\",\n            using: positioningFunction\n          },\n          select: function(event, ui) {\n            addValue(ui.item.value);\n            return ui.item.value = \"\";\n          }\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(tags) {\n        var ref, tagsColors;\n        tagsColors = ((ref = $scope.project) != null ? ref.tags_colors : void 0) || [];\n        return renderTags(tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/lb-tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgLbTagLine\", [\"$tgResources\", \"$tgTemplate\", \"$compile\", LbTagLineDirective]);\n\n  TagLineDirective = function($rootScope, $repo, $rs, $confirm, $qqueue, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, ESC_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    ESC_KEY = 27;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/tags-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideAddTagButton, hideAddTagButtonText, hideInput, hideSaveButton, isEditable, renderInReadModeOnly, renderTags, resetInput, saveInputTag, showAddTagButton, showAddTagButtonText, showInput, showSaveButton;\n      isEditable = function() {\n        if ($attrs.requiredPerm != null) {\n          return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n        }\n        return true;\n      };\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          }),\n          isEditable: isEditable()\n        };\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\"div.tags-container\").html(html);\n      };\n      renderInReadModeOnly = function() {\n        $el.find(\".add-tag\").remove();\n        $el.find(\"input\").remove();\n        return $el.find(\".save\").remove();\n      };\n      showAddTagButton = function() {\n        return $el.find(\".add-tag\").removeClass(\"hidden\");\n      };\n      hideAddTagButton = function() {\n        return $el.find(\".add-tag\").addClass(\"hidden\");\n      };\n      showAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").removeClass(\"hidden\");\n      };\n      hideAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").addClass(\"hidden\");\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      showInput = function() {\n        return $el.find(\"input\").removeClass(\"hidden\").focus();\n      };\n      hideInput = function() {\n        return $el.find(\"input\").addClass(\"hidden\").blur();\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return $el.find(\"input\").autocomplete(\"close\");\n      };\n      addValue = $qqueue.bindAdd(function(value) {\n        var model, onError, onSuccess, tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue.tags, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        model = $model.$modelValue.clone();\n        model.tags = tags;\n        $model.$setViewValue(model);\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          model.revert();\n          return $model.$setViewValue(model);\n        };\n        hideSaveButton();\n        return $repo.save(model).then(onSuccess, onError);\n      });\n      deleteValue = $qqueue.bindAdd(function(value) {\n        var model, onError, onSuccess, tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue.tags, false);\n        tags = _.pull(tags, value);\n        model = $model.$modelValue.clone();\n        model.tags = tags;\n        $model.$setViewValue(model);\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          model.revert();\n          return $model.$setViewValue(model);\n        };\n        return $repo.save(model).then(onSuccess, onError);\n      });\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === ESC_KEY) {\n          resetInput();\n          hideInput();\n          hideSaveButton();\n          return showAddTagButton();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".add-tag\", function(event) {\n        event.preventDefault();\n        hideAddTagButton();\n        return showInput();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project.tags_colors\", function(tags_colors) {\n        var positioningFunction;\n        if (!isEditable()) {\n          renderInReadModeOnly();\n          return;\n        }\n        showAddTagButton();\n        positioningFunction = function(position, elements) {\n          var menu;\n          menu = elements.element.element;\n          menu.css(\"width\", elements.target.width);\n          menu.css(\"top\", position.top);\n          return menu.css(\"left\", position.left);\n        };\n        return $el.find(\"input\").autocomplete({\n          source: _.keys(tags_colors),\n          position: {\n            my: \"left top\",\n            using: positioningFunction\n          },\n          select: function(event, ui) {\n            addValue(ui.item.value);\n            return ui.item.value = \"\";\n          }\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(model) {\n        var ref, ref1, tagsColors;\n        if (!model) {\n          return;\n        }\n        if ((ref = model.tags) != null ? ref.length : void 0) {\n          hideAddTagButtonText();\n        } else {\n          showAddTagButtonText();\n        }\n        tagsColors = ((ref1 = $scope.project) != null ? ref1.tags_colors : void 0) || [];\n        return renderTags(model.tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgTagLine\", [\"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", TagLineDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/wisiwyg.coffee\n */\n\n(function() {\n  var MarkitupDirective, bindOnce, module, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  MarkitupDirective = function($rootscope, $rs, $selectedText, $template, $compile, $translate) {\n    var link, previewTemplate;\n    previewTemplate = $template.get(\"common/wysiwyg/wysiwyg-markitup-preview.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addLine, cancelablePromise, closePreviewMode, element, markdownTitle, prepareUrlFormatting, preview, previewDomNode, previewInProgress, renderMarkItUp, setCaretPosition, unbind, urlFormatting;\n      element = angular.element($el);\n      previewDomNode = $(\"<div/>\", {\n        \"class\": \"preview\"\n      });\n      closePreviewMode = function() {\n        element.parents(\".markdown\").find(\".preview\").remove();\n        return element.parents(\".markItUp\").show();\n      };\n      $scope.$on(\"markdown-editor:submit\", function() {\n        return closePreviewMode();\n      });\n      cancelablePromise = null;\n      previewInProgress = false;\n      preview = function() {\n        var markItUpDomNode, markdownDomNode;\n        if (previewInProgress) {\n          return;\n        }\n        previewInProgress = true;\n        markdownDomNode = element.parents(\".markdown\");\n        markItUpDomNode = element.parents(\".markItUp\");\n        return $rs.mdrender.render($scope.projectId, $model.$modelValue).then(function(data) {\n          var html, markdown;\n          html = previewTemplate({\n            data: data.data\n          });\n          html = $compile(html)($scope);\n          markdownDomNode.append(html);\n          markItUpDomNode.hide();\n          previewInProgress = false;\n          markdown = element.closest(\".markdown\");\n          return markdown.on(\"mouseup.preview\", \".preview\", function(event) {\n            var target;\n            event.preventDefault();\n            target = angular.element(event.target);\n            if (!target.is('a') && $selectedText.get().length) {\n              return;\n            }\n            markdown.off(\".preview\");\n            return closePreviewMode();\n          });\n        });\n      };\n      setCaretPosition = function(textarea, caretPosition) {\n        var line, range, scrollRelation, totalLines;\n        if (textarea.createTextRange) {\n          range = textarea.createTextRange();\n          range.move(\"character\", caretPosition);\n          range.select();\n        } else if (textarea.selectionStart) {\n          textarea.focus();\n          textarea.setSelectionRange(caretPosition, caretPosition);\n        }\n        totalLines = textarea.value.split(\"\\n\").length;\n        line = textarea.value.slice(0, +(caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n        scrollRelation = line / totalLines;\n        return $el.scrollTop((scrollRelation * $el[0].scrollHeight) - ($el.height() / 2));\n      };\n      addLine = function(textarea, nline, replace) {\n        var cursorPosition, j, key, len, line, lines;\n        lines = textarea.value.split(\"\\n\");\n        if (replace) {\n          lines[nline] = replace + lines[nline];\n        } else {\n          lines[nline] = \"\";\n        }\n        cursorPosition = 0;\n        for (key = j = 0, len = lines.length; j < len; key = ++j) {\n          line = lines[key];\n          cursorPosition += line.length + 1 || 1;\n          if (key === nline) {\n            break;\n          }\n        }\n        textarea.value = lines.join(\"\\n\");\n        if (replace) {\n          return cursorPosition - lines[nline].length + replace.length - 1;\n        } else {\n          return cursorPosition;\n        }\n      };\n      prepareUrlFormatting = function(markItUp) {\n        var indices, regex, result;\n        regex = /(<<<|>>>)/gi;\n        result = 0;\n        indices = [];\n        while ((result = regex.exec(markItUp.textarea.value))) {\n          indices.push(result.index);\n        }\n        return markItUp.donotparse = indices;\n      };\n      urlFormatting = function(markItUp) {\n        var endIndex, ref, ref1, regex, result, startIndex, url, value;\n        regex = /<<</gi;\n        result = 0;\n        startIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref = result.index, indexOf.call(markItUp.donotparse, ref) < 0) {\n            startIndex = result.index;\n            break;\n          }\n        }\n        if (!result) {\n          return;\n        }\n        regex = />>>/gi;\n        endIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref1 = result.index, indexOf.call(markItUp.donotparse, ref1) < 0) {\n            endIndex = result.index;\n            break;\n          }\n        }\n        value = markItUp.textarea.value;\n        url = value.substring(startIndex, endIndex).replace('<<<', '').replace('>>>', '');\n        url = url.replace('(', '%28').replace(')', '%29');\n        url = url.replace('[', '%5B').replace(']', '%5D');\n        value = value.substring(0, startIndex) + url + value.substring(endIndex + 3, value.length);\n        markItUp.textarea.value = value;\n        return markItUp.donotparse = void 0;\n      };\n      markdownTitle = function(markItUp, char) {\n        var heading, i, j, n, ref;\n        heading = \"\";\n        n = $.trim(markItUp.selection || markItUp.placeHolder).length;\n        for (i = j = 0, ref = n - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n          heading += char;\n        }\n        return \"\\n\" + heading + \"\\n\";\n      };\n      renderMarkItUp = function() {\n        var markdownSettings;\n        markdownSettings = {\n          nameSpace: \"markdown\",\n          onShiftEnter: {\n            keepDefault: false,\n            openWith: \"\\n\\n\"\n          },\n          onEnter: {\n            keepDefault: false,\n            replaceWith: function() {\n              if (!$('.textcomplete-dropdown').is(':visible')) {\n                return \"\\n\";\n              }\n            },\n            afterInsert: function(data) {\n              var cursorLine, emptyListItem, lastLine, lines, markdownCaretPositon, match, newLineContent, nline, replace;\n              lines = data.textarea.value.split(\"\\n\");\n              if (data.caretPosition > 0) {\n                cursorLine = data.textarea.value.slice(0, +(data.caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n              } else {\n                cursorLine = 1;\n              }\n              newLineContent = data.textarea.value.slice(data.caretPosition).split(\"\\n\")[0];\n              lastLine = lines[cursorLine - 1];\n              match = lastLine.match(/^(\\s*- ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)\\-\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*\\* ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*\\* )$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*)(\\d+)\\.\\s/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)(\\d+)\\.\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = (match[1] + (parseInt(match[2], 10) + 1)) + \". \";\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              if (markdownCaretPositon) {\n                return setCaretPosition(data.textarea, markdownCaretPositon);\n              }\n            }\n          },\n          markupSet: [\n            {\n              name: $translate.instant(\"COMMON.WYSIWYG.H1_BUTTON\"),\n              key: \"1\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H1_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"=\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H2_BUTTON\"),\n              key: \"2\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H2_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"-\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H3_BUTTON\"),\n              key: \"3\",\n              openWith: \"### \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H3_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON\"),\n              key: \"B\",\n              openWith: \"**\",\n              closeWith: \"**\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\"),\n              key: \"I\",\n              openWith: \"_\",\n              closeWith: \"_\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.STRIKE_BUTTON\"),\n              key: \"S\",\n              openWith: \"~~\",\n              closeWith: \"~~\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_BUTTON\"),\n              openWith: \"- \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_BUTTON\"),\n              openWith: function(markItUp) {\n                return markItUp.line + \". \";\n              },\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PICTURE_BUTTON\"),\n              key: \"P\",\n              openWith: \"![\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.LINK_BUTTON\"),\n              key: \"L\",\n              openWith: \"[\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.LINK_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON\"),\n              openWith: \"> \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_BUTTON\"),\n              openWith: \"```\\n\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT\"),\n              closeWith: \"\\n```\"\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PREVIEW_BUTTON\"),\n              call: preview,\n              className: \"preview-icon\"\n            }\n          ],\n          afterInsert: function(event) {\n            var target;\n            target = angular.element(event.textarea);\n            return $model.$setViewValue(target.val());\n          }\n        };\n        return element.markItUpRemove().markItUp(markdownSettings).textcomplete([\n          {\n            cache: true,\n            match: /(^|\\s)#([a-z0-9]+)$/i,\n            search: function(term, callback) {\n              var filter, searchProps, searchTypes;\n              term = taiga.slugify(term);\n              searchTypes = ['issues', 'tasks', 'userstories'];\n              searchProps = ['ref', 'subject'];\n              filter = (function(_this) {\n                return function(item) {\n                  var j, len, prop;\n                  for (j = 0, len = searchProps.length; j < len; j++) {\n                    prop = searchProps[j];\n                    if (taiga.slugify(item[prop]).indexOf(term) >= 0) {\n                      return true;\n                    }\n                  }\n                  return false;\n                };\n              })(this);\n              if (cancelablePromise) {\n                cancelablePromise.abort();\n              }\n              cancelablePromise = $rs.search[\"do\"]($scope.projectId, term);\n              cancelablePromise.then((function(_this) {\n                return function(res) {\n                  var j, len, results, type;\n                  if (res.count < 1 || res.count === res.wikipages.length) {\n                    return callback([]);\n                  } else {\n                    results = [];\n                    for (j = 0, len = searchTypes.length; j < len; j++) {\n                      type = searchTypes[j];\n                      if (res[type] && res[type].length > 0) {\n                        results.push(callback(res[type].filter(filter), true));\n                      } else {\n                        results.push(void 0);\n                      }\n                    }\n                    return results;\n                  }\n                };\n              })(this));\n              return callback([]);\n            },\n            replace: function(res) {\n              return \"$1\\#\" + res.ref + \" \";\n            },\n            template: function(res, term) {\n              return \"\\#\" + res.ref + \" - \" + res.subject;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)@([a-z0-9\\-\\._]{2,})$/i,\n            search: function(term, callback) {\n              var searchProps, username;\n              username = taiga.slugify(term);\n              searchProps = ['username', 'full_name', 'full_name_display'];\n              if ($scope.project.members.length < 1) {\n                return callback([]);\n              } else {\n                return callback($scope.project.members.filter((function(_this) {\n                  return function(user) {\n                    var j, len, prop;\n                    for (j = 0, len = searchProps.length; j < len; j++) {\n                      prop = searchProps[j];\n                      if (taiga.slugify(user[prop]).indexOf(username) >= 0) {\n                        return true;\n                      }\n                    }\n                    return false;\n                  };\n                })(this)));\n              }\n            },\n            replace: function(user) {\n              return \"$1@\" + user.username + \" \";\n            },\n            template: function(user) {\n              return user.username + \" - \" + user.full_name_display;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)\\[\\[([a-z0-9\\-]+)$/i,\n            search: function(term, callback) {\n              term = taiga.slugify(term);\n              return $rs.search[\"do\"]($scope.projectId, term).then((function(_this) {\n                return function(res) {\n                  if (res.count < 1) {\n                    callback([]);\n                  }\n                  if (res.count < 1 || !res.wikipages || res.wikipages.length <= 0) {\n                    callback([]);\n                  } else {\n                    callback(res.wikipages.filter(function(page) {\n                      return taiga.slugify(page['slug']).indexOf(term) >= 0;\n                    }), true);\n                  }\n                  return callback([]);\n                };\n              })(this));\n            },\n            replace: function(res) {\n              return \"$1[[\" + res.slug + \"]]\";\n            },\n            template: function(res, term) {\n              return res.slug;\n            }\n          }\n        ], {\n          debounce: 200\n        });\n      };\n      renderMarkItUp();\n      unbind = $rootscope.$on(\"$translateChangeEnd\", renderMarkItUp);\n      element.on(\"keypress\", function(event) {\n        return $scope.$apply();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgMarkitup\", [\"$rootScope\", \"$tgResources\", \"$selectedText\", \"$tgTemplate\", \"$compile\", \"$translate\", MarkitupDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogFiltersDirective, bindOnce, debounceLeading, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogFiltersDirective = function($q, $log, $location, $templates) {\n    var link, template, templateSelected;\n    template = $templates.get(\"backlog/filters.html\", true);\n    templateSelected = $templates.get(\"backlog/filter-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, currentFiltersType, getFiltersType, initializeSelectedFilters, reloadUserstories, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection;\n      currentFiltersType = '';\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\"h2.breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 a.subfilter span.title\").html(title);\n        $el.find(\"h2 a.subfilter span.title\").prop(\"data-type\", type);\n        return currentFiltersType = getFiltersType();\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\"h2.breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function() {\n        var i, len, name, ref, val, values;\n        showCategories();\n        selectedFilters = [];\n        ref = $scope.filters;\n        for (name in ref) {\n          values = ref[name];\n          for (i = 0, len = values.length; i < len; i++) {\n            val = values[i];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters();\n      };\n      renderSelectedFilters = function() {\n        var html;\n        _.map(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        return $el.find(\".filters-applied\").html(html);\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.map(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n      };\n      reloadUserstories = function() {\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadUserstories(), $ctrl.generateFilters()]).then(function() {\n          var currentFilters;\n          currentFilters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(currentFilters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var filter, filters;\n        currentFiltersType = getFiltersType();\n        filters = $scope.filters[type];\n        filter = _.find(filters, {\n          id: id\n        });\n        filter.selected = !filter.selected;\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $scope.$apply(function() {\n            return $ctrl.selectFilter(type, id);\n          });\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(selected) {\n            return filter.type === selected.type && filter.id === selected.id;\n          });\n          $ctrl.unselectFilter(type, id);\n        }\n        renderSelectedFilters(selectedFilters);\n        if (type === currentFiltersType) {\n          renderFilters(_.reject(filters, \"selected\"));\n        }\n        return reloadUserstories();\n      };\n      selectQFilter = debounceLeading(100, function(value) {\n        if (value === void 0) {\n          return;\n        }\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n        }\n        return reloadUserstories();\n      });\n      $scope.$watch(\"filtersQ\", selectQFilter);\n      $scope.$on(\"backlog:loaded\", function(ctx) {\n        return initializeSelectedFilters();\n      });\n      $scope.$on(\"filters:update\", function(ctx) {\n        return $ctrl.generateFilters().then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          if (currentFiltersType) {\n            return renderFilters(_.reject(filters, \"selected\"));\n          }\n        });\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data('type'));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories();\n      });\n      $el.on(\"click\", \".filters-applied a\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      return $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.hasClass(\"active\")) {\n          target.removeClass(\"active\");\n        } else {\n          target.addClass(\"active\");\n        }\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgTemplate\", BacklogFiltersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/lightboxes.coffee\n */\n\n(function() {\n  var CreateEditSprint, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  CreateEditSprint = function($repo, $confirm, $rs, $rootscope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var createSprint, form, getLastSprint, hasErrors, remove, resetSprint, submit;\n      hasErrors = false;\n      createSprint = true;\n      form = null;\n      resetSprint = function() {\n        if (form) {\n          form.reset();\n        }\n        return $scope.sprint = {\n          project: null,\n          name: null,\n          estimated_start: null,\n          estimated_finish: null\n        };\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, newSprint, prettyDate, promise, submitButton, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          submitButton = $el.find(\".submit-button\");\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            hasErrors = true;\n            $el.find(\".last-sprint-name\").addClass(\"disappear\");\n            return;\n          }\n          hasErrors = false;\n          newSprint = angular.copy($scope.sprint);\n          broadcastEvent = null;\n          if (createSprint) {\n            newSprint.estimated_start = moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.create(\"milestones\", newSprint);\n            broadcastEvent = \"sprintform:create:success\";\n          } else {\n            newSprint.setAttr(\"estimated_start\", moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\"));\n            newSprint.setAttr(\"estimated_finish\", moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\"));\n            promise = $repo.save(newSprint);\n            broadcastEvent = \"sprintform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise.then(function(data) {\n            currentLoading.finish();\n            if (createSprint) {\n              $scope.sprintsCounter += 1;\n            }\n            $rootscope.$broadcast(broadcastEvent, data);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"light-error\", data._error_message);\n            } else if (data.__all__) {\n              return $confirm.notify(\"light-error\", data.__all__[0]);\n            }\n          });\n        };\n      })(this));\n      remove = function() {\n        var message, title;\n        title = $translate.instant(\"LIGHTBOX.DELETE_SPRINT.TITLE\");\n        message = $scope.sprint.name;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSuccess;\n            onSuccess = function() {\n              askResponse.finish();\n              $scope.milestonesCounter -= 1;\n              lightboxService.close($el);\n              return $rootscope.$broadcast(\"sprintform:remove:success\", $scope.sprint);\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove($scope.sprint).then(onSuccess, onError);\n          };\n        })(this));\n      };\n      getLastSprint = function() {\n        var openSprints, sortedSprints;\n        openSprints = _.filter($scope.sprints, function(sprint) {\n          return !sprint.closed;\n        });\n        sortedSprints = _.sortBy(openSprints, function(sprint) {\n          return moment(sprint.estimated_finish, 'YYYY-MM-DD').format('X');\n        });\n        return sortedSprints[sortedSprints.length - 1];\n      };\n      $scope.$on(\"sprintform:create\", function(event, projectId) {\n        var estimatedFinish, estimatedStart, lastSprint, lastSprintNameDom, prettyDate, text;\n        resetSprint();\n        form = $el.find(\"form\").checksley();\n        form.reset();\n        createSprint = true;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.sprint.project = projectId;\n        $scope.sprint.name = null;\n        $scope.sprint.slug = null;\n        lastSprint = getLastSprint();\n        estimatedStart = moment();\n        if (lastSprint) {\n          estimatedStart = moment(lastSprint.estimated_finish);\n        } else if ($scope.sprint.estimated_start) {\n          estimatedStart = moment($scope.sprint.estimated_start);\n        }\n        $scope.sprint.estimated_start = estimatedStart.format(prettyDate);\n        estimatedFinish = moment().add(2, \"weeks\");\n        if (lastSprint) {\n          estimatedFinish = moment(lastSprint.estimated_finish).add(2, \"weeks\");\n        } else if ($scope.sprint.estimated_finish) {\n          estimatedFinish = moment($scope.sprint.estimated_finish);\n        }\n        $scope.sprint.estimated_finish = estimatedFinish.format(prettyDate);\n        lastSprintNameDom = $el.find(\".last-sprint-name\");\n        if ((lastSprint != null ? lastSprint.name : void 0) != null) {\n          text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME\", {\n            lastSprint: lastSprint.name\n          });\n          lastSprintNameDom.html(text);\n        }\n        $el.find(\".delete-sprint\").addClass(\"hidden\");\n        text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.TITLE\");\n        $el.find(\".title\").text(text);\n        text = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").text(text);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus();\n        return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n      });\n      $scope.$on(\"sprintform:edit\", function(ctx, sprint) {\n        var editSprint, prettyDate, save;\n        resetSprint();\n        createSprint = false;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.$apply(function() {\n          $scope.sprint = sprint;\n          $scope.sprint.estimated_start = moment($scope.sprint.estimated_start).format(prettyDate);\n          return $scope.sprint.estimated_finish = moment($scope.sprint.estimated_finish).format(prettyDate);\n        });\n        $el.find(\".delete-sprint\").removeClass(\"hidden\");\n        editSprint = $translate.instant(\"BACKLOG.EDIT_SPRINT\");\n        $el.find(\".title\").text(editSprint);\n        save = $translate.instant(\"COMMON.SAVE\");\n        $el.find(\".button-green\").text(save);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus().select();\n        return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n      });\n      $el.on(\"keyup\", \".sprint-name\", function(event) {\n        if ($el.find(\".sprint-name\").val().length > 0 || hasErrors) {\n          return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n        } else {\n          return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".delete-sprint\", function(event) {\n        event.preventDefault();\n        return remove();\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return resetSprint();\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditSprint\", [\"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditSprint]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogController, BacklogDirective, BurndownBacklogGraphDirective, TgBacklogProgressBarDirective, ToggleBurndownVisibility, UsPointsDirective, UsRolePointsSelectorDirective, bindMethods, bindOnce, generateHash, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  generateHash = this.taiga.generateHash;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogController = (function(superClass) {\n    extend(BacklogController, superClass);\n\n    BacklogController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLoading\", \"tgResources\"];\n\n    function BacklogController(scope1, rootscope, repo, confirm, rs, params1, q, location, appMetaService, navUrls, events, analytics, translate, loading, rs2) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loading = loading;\n      this.rs2 = rs2;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"BACKLOG.SECTION_NAME\");\n      this.showTags = false;\n      this.activeFilters = false;\n      this.scope.showGraphPlaceholder = null;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"BACKLOG.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"BACKLOG.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          _this.appMetaService.setAll(title, description);\n          if (_this.rs.userstories.getShowTags(_this.scope.projectId)) {\n            _this.showTags = true;\n            return _this.scope.$broadcast(\"showTags\", _this.showTags);\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    BacklogController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:create:success\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"sprint\", \"create\", \"create sprint on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.loadProjectStats();\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"sprintform:remove:success\", (function(_this) {\n        return function(event, sprint) {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.loadUserstories();\n          if (sprint.closed) {\n            _this.loadClosedSprints();\n          }\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"sprint:us:move\", this.moveUs);\n      this.scope.$on(\"sprint:us:moved\", this.loadSprints);\n      this.scope.$on(\"sprint:us:moved\", this.loadProjectStats);\n      this.scope.$on(\"backlog:load-closed-sprints\", this.loadClosedSprints);\n      return this.scope.$on(\"backlog:unload-closed-sprints\", this.unloadClosedSprints);\n    };\n\n    BacklogController.prototype.initializeSubscription = function() {\n      var routingKey1, routingKey2;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.loadUserstories();\n          return _this.loadSprints();\n        };\n      })(this));\n      routingKey2 = \"changes.project.\" + this.scope.projectId + \".milestones\";\n      return this.events.subscribe(this.scope, routingKey2, (function(_this) {\n        return function(message) {\n          return _this.loadSprints();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleShowTags = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.showTags = !_this.showTags;\n          return _this.rs.userstories.storeShowTags(_this.scope.projectId, _this.showTags);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleActiveFilters = function() {\n      return this.activeFilters = !this.activeFilters;\n    };\n\n    BacklogController.prototype.loadProjectStats = function() {\n      return this.rs.projects.stats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totalPoints;\n          _this.scope.stats = stats;\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          if (totalPoints) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.closed_points / totalPoints);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.showGraphPlaceholder = !((stats.total_points != null) && (stats.total_milestones != null));\n          return stats;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.unloadClosedSprints = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.scope.closedSprints = [];\n          return _this.rootscope.$broadcast(\"closed-sprints:reloaded\", []);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadClosedSprints = function() {\n      var params;\n      params = {\n        closed: true\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalClosedMilestones = result.closed;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.closedSprints = sprints;\n          _this.scope.closedSprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"closed-sprints:reloaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadSprints = function() {\n      var params;\n      params = {\n        closed: false\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalMilestones = sprints;\n          _this.scope.totalClosedMilestones = result.closed;\n          _this.scope.totalOpenMilestones = result.open;\n          _this.scope.totalMilestones = _this.scope.totalOpenMilestones + _this.scope.totalClosedMilestones;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.sprints = sprints;\n          _this.scope.openSprints = _.filter(sprints, function(sprint) {\n            return !sprint.closed;\n          }).reverse();\n          if (!_this.scope.closedSprints) {\n            _this.scope.closedSprints = [];\n          }\n          _this.scope.sprintsCounter = sprints.length;\n          _this.scope.sprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"sprints:loaded\", sprints);\n          _this.scope.currentSprint = _this.findCurrentSprint();\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.restoreFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = this.scope.oldSelectedTags;\n      selectedStatuses = this.scope.oldSelectedStatuses;\n      if (!selectedStatuses && !selectedStatuses) {\n        return;\n      }\n      this.scope.filtersQ = this.scope.filtersQOld;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = true;\n            return _this.selectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.resetFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = _.filter(this.scope.filters.tags, \"selected\");\n      selectedStatuses = _.filter(this.scope.filters.status, \"selected\");\n      this.scope.oldSelectedTags = selectedTags;\n      this.scope.oldSelectedStatuses = selectedStatuses;\n      this.scope.filtersQOld = this.scope.filtersQ;\n      this.scope.filtersQ = void 0;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = false;\n            return _this.unselectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.loadUserstories = function() {\n      var promise;\n      this.scope.httpParams = this.getUrlFilters();\n      this.rs.userstories.storeQueryParams(this.scope.projectId, this.scope.httpParams);\n      promise = this.rs.userstories.listUnassigned(this.scope.projectId, this.scope.httpParams);\n      return promise.then((function(_this) {\n        return function(userstories) {\n          _this.scope.userstories = _.sortBy(userstories, \"backlog_order\");\n          _this.setSearchDataFilters();\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\");\n          });\n          return userstories;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadBacklog = function() {\n      return this.q.all([this.loadProjectStats(), this.loadSprints(), this.loadUserstories()]);\n    };\n\n    BacklogController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.closedMilestones = !!project.total_closed_milestones;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"id\");\n          return project;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.initializeSubscription();\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadBacklog();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.generateFilters();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.scope.$emit(\"backlog:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    BacklogController.prototype.resortUserStories = function(uses, field) {\n      var index, item, items, j, len;\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      items = [];\n      for (index = j = 0, len = uses.length; j < len; index = ++j) {\n        item = uses[index];\n        item[field] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    BacklogController.prototype.moveUs = function(ctx, usList, newUsIndex, newSprintId) {\n      var data, items, j, l, len, len1, len2, m, movedFromClosedSprint, movedToClosedSprint, newSprint, oldSprintId, project, promise, promises, sprint, us, userstories;\n      oldSprintId = usList[0].milestone;\n      project = usList[0].project;\n      movedFromClosedSprint = false;\n      movedToClosedSprint = false;\n      sprint = this.scope.sprintsById[oldSprintId];\n      if (!sprint && this.scope.closedSprintsById) {\n        sprint = this.scope.closedSprintsById[oldSprintId];\n        if (sprint) {\n          movedFromClosedSprint = true;\n        }\n      }\n      newSprint = this.scope.sprintsById[newSprintId];\n      if (!newSprint && newSprintId) {\n        newSprint = this.scope.closedSprintsById[newSprintId];\n        if (newSprint) {\n          movedToClosedSprint = true;\n        }\n      }\n      if (newSprintId === oldSprintId) {\n        items = null;\n        userstories = null;\n        if (newSprintId === null) {\n          userstories = this.scope.userstories;\n        } else {\n          userstories = newSprint.user_stories;\n        }\n        this.scope.$apply(function() {\n          var args, j, key, len, r, us;\n          for (key = j = 0, len = usList.length; j < len; key = ++j) {\n            us = usList[key];\n            r = userstories.indexOf(us);\n            userstories.splice(r, 1);\n          }\n          args = [newUsIndex, 0].concat(usList);\n          return Array.prototype.splice.apply(userstories, args);\n        });\n        if (newSprintId === null) {\n          items = this.resortUserStories(userstories, \"backlog_order\");\n          data = this.prepareBulkUpdateData(items, \"backlog_order\");\n          this.rs.userstories.bulkUpdateBacklogOrder(project, data).then((function(_this) {\n            return function() {\n              var j, len, results, us;\n              results = [];\n              for (j = 0, len = usList.length; j < len; j++) {\n                us = usList[j];\n                results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n              }\n              return results;\n            };\n          })(this));\n        } else {\n          items = this.resortUserStories(userstories, \"sprint_order\");\n          data = this.prepareBulkUpdateData(items, \"sprint_order\");\n          this.rs.userstories.bulkUpdateSprintOrder(project, data).then((function(_this) {\n            return function() {\n              var j, len, results, us;\n              results = [];\n              for (j = 0, len = usList.length; j < len; j++) {\n                us = usList[j];\n                results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n              }\n              return results;\n            };\n          })(this));\n        }\n        return promise;\n      }\n      if (newSprintId === null) {\n        for (j = 0, len = usList.length; j < len; j++) {\n          us = usList[j];\n          us.milestone = null;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, l, len1, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(_this.scope.userstories, args);\n            results = [];\n            for (key = l = 0, len1 = usList.length; l < len1; key = ++l) {\n              us = usList[key];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n        promise = this.repo.save(us);\n        promise = promise.then((function(_this) {\n          return function() {\n            items = _this.resortUserStories(_this.scope.userstories, \"backlog_order\");\n            data = _this.prepareBulkUpdateData(items, \"backlog_order\");\n            return _this.rs.userstories.bulkUpdateBacklogOrder(us.project, data).then(function() {\n              _this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId);\n              if (movedFromClosedSprint) {\n                return _this.rootscope.$broadcast(\"backlog:load-closed-sprints\");\n              }\n            });\n          };\n        })(this));\n        promise.then(null, function() {\n          return console.log(\"FAIL\");\n        });\n        return promise;\n      }\n      if (oldSprintId === null) {\n        for (l = 0, len1 = usList.length; l < len1; l++) {\n          us = usList[l];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, len2, m, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (key = m = 0, len2 = usList.length; m < len2; key = ++m) {\n              us = usList[key];\n              r = _this.scope.userstories.indexOf(us);\n              results.push(_this.scope.userstories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      } else {\n        for (m = 0, len2 = usList.length; m < len2; m++) {\n          us = usList[m];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, len3, n, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (n = 0, len3 = usList.length; n < len3; n++) {\n              us = usList[n];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      }\n      promises = _.map(usList, (function(_this) {\n        return function(us) {\n          return _this.repo.save(us);\n        };\n      })(this));\n      promise = this.q.all(promises).then((function(_this) {\n        return function() {\n          items = _this.resortUserStories(newSprint.user_stories, \"sprint_order\");\n          data = _this.prepareBulkUpdateData(items, \"sprint_order\");\n          _this.rs.userstories.bulkUpdateSprintOrder(project, data).then(function(result) {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId);\n          });\n          _this.rs.userstories.bulkUpdateBacklogOrder(project, data).then(function() {\n            var len3, n, results;\n            results = [];\n            for (n = 0, len3 = usList.length; n < len3; n++) {\n              us = usList[n];\n              results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n            }\n            return results;\n          });\n          if (movedToClosedSprint || movedFromClosedSprint) {\n            return _this.scope.$broadcast(\"backlog:load-closed-sprints\");\n          }\n        };\n      })(this));\n      promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n      return promise;\n    };\n\n    BacklogController.prototype.isFilterSelected = function(type, id) {\n      if ((this.searchdata[type] != null) && this.searchdata[type][id]) {\n        return true;\n      }\n      return false;\n    };\n\n    BacklogController.prototype.setSearchDataFilters = function() {\n      var name, results, urlfilters, val, value;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = this.scope.filtersQ || urlfilters.q;\n      }\n      this.searchdata = {};\n      results = [];\n      for (name in urlfilters) {\n        value = urlfilters[name];\n        if (this.searchdata[name] == null) {\n          this.searchdata[name] = {};\n        }\n        results.push((function() {\n          var j, len, ref1, results1;\n          ref1 = taiga.toString(value).split(\",\");\n          results1 = [];\n          for (j = 0, len = ref1.length; j < len; j++) {\n            val = ref1[j];\n            results1.push(this.searchdata[name][val] = true);\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    BacklogController.prototype.getUrlFilters = function() {\n      return _.pick(this.location.search(), \"status\", \"tags\", \"q\");\n    };\n\n    BacklogController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      urlfilters = this.getUrlFilters();\n      this.scope.filters = {};\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.milestone = 'null';\n      return this.rs.userstories.filtersData(loadFilters).then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, selectedStatuses, selectedTags, tagsFilterFormat;\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.usStatusById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          selectedTags = _.filter(_this.scope.filters.tags, \"selected\");\n          selectedTags = _.map(selectedTags, \"id\");\n          selectedStatuses = _.filter(_this.scope.filters.status, \"selected\");\n          selectedStatuses = _.map(selectedStatuses, \"id\");\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rs.userstories.storeQueryParams(_this.scope.projectId, {\n            \"status\": selectedStatuses,\n            \"tags\": selectedTags,\n            \"project\": _this.scope.projectId,\n            \"milestone\": null\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref1, ref2, results, searchdata, val, value;\n      searchdata = {};\n      ref1 = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref1) {\n        value = ref1[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref2 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref2.length; j < len; j++) {\n          val = ref2[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var l, len1, results1;\n          results1 = [];\n          for (l = 0, len1 = value.length; l < len1; l++) {\n            obj = value[l];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    BacklogController.prototype.updateUserStoryStatus = function() {\n      this.setSearchDataFilters();\n      return this.generateFilters().then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.loadProjectStats();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.editUserStory = function(projectId, ref, $event) {\n      var currentLoading, target;\n      target = $($event.target);\n      currentLoading = this.loading().target(target).removeClasses(\"edit-story\").timeout(200).start();\n      return this.rs.userstories.getByRef(projectId, ref).then((function(_this) {\n        return function(us) {\n          return _this.rs2.attachments.list(\"us\", us.id, projectId).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", us, attachments.toJS());\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.deleteUserStory = function(us) {\n      var message, title;\n      title = this.translate.instant(\"US.TITLE_DELETE_ACTION\");\n      message = us.subject;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var promise;\n          _this.scope.userstories = _.without(_this.scope.userstories, us);\n          promise = _this.repo.remove(us);\n          promise.then(function() {\n            askResponse.finish();\n            return _this.loadBacklog();\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.addNewUs = function(type) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, this.scope.project.default_us_status, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, this.scope.project.default_us_status);\n      }\n    };\n\n    BacklogController.prototype.addNewSprint = function() {\n      return this.rootscope.$broadcast(\"sprintform:create\", this.scope.projectId);\n    };\n\n    BacklogController.prototype.findCurrentSprint = function() {\n      var currentDate;\n      currentDate = new Date().getTime();\n      return _.find(this.scope.sprints, function(sprint) {\n        var end, start;\n        start = moment(sprint.estimated_start, 'YYYY-MM-DD').format('x');\n        end = moment(sprint.estimated_finish, 'YYYY-MM-DD').format('x');\n        return currentDate >= start && currentDate <= end;\n      });\n    };\n\n    return BacklogController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BacklogController\", BacklogController);\n\n  BacklogDirective = function($repo, $rootscope, $translate) {\n    var doomLineTemplate, link, linkDoomLine, linkFilters, linkToolbar, showHideFilter, showHideTags;\n    doomLineTemplate = _.template(\"<div class=\\\"doom-line\\\"><span><%- text %></span></div>\");\n    linkDoomLine = function($scope, $el, $attrs, $ctrl) {\n      var addDoomLineDom, getUsItems, reloadDoomLine, removeDoomlineDom;\n      reloadDoomLine = function() {\n        var current_sum, domElement, i, j, len, ref1, results, stats, total_points, us;\n        if (($scope.stats != null) && ($scope.stats.total_points != null) && $scope.stats.total_points !== 0) {\n          removeDoomlineDom();\n          stats = $scope.stats;\n          total_points = stats.total_points;\n          current_sum = stats.assigned_points;\n          if (!$scope.userstories) {\n            return;\n          }\n          ref1 = $scope.userstories;\n          results = [];\n          for (i = j = 0, len = ref1.length; j < len; i = ++j) {\n            us = ref1[i];\n            current_sum += us.total_points;\n            if (current_sum > total_points) {\n              domElement = $el.find('.backlog-table-body .us-item-row')[i];\n              addDoomLineDom(domElement);\n              break;\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        }\n      };\n      removeDoomlineDom = function() {\n        return $el.find(\".doom-line\").remove();\n      };\n      addDoomLineDom = function(element) {\n        var text;\n        text = $translate.instant(\"BACKLOG.DOOMLINE\");\n        return $(element).before(doomLineTemplate({\n          \"text\": text\n        }));\n      };\n      getUsItems = function() {\n        var rowElements;\n        rowElements = $el.find('.backlog-table-body .us-item-row');\n        return _.map(rowElements, function(x) {\n          return angular.element(x);\n        });\n      };\n      $scope.$on(\"userstories:loaded\", reloadDoomLine);\n      return $scope.$watch(\"stats\", reloadDoomLine);\n    };\n    linkToolbar = function($scope, $el, $attrs, $ctrl) {\n      var checkSelected, getUsToMove, lastChecked, moveToCurrentSprint, moveToLatestSprint, moveUssToSprint, shiftPressed;\n      getUsToMove = function() {\n        var ussDom;\n        ussDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        return _.map(ussDom, function(item) {\n          var itemScope;\n          item = $(item).closest('.tg-scope');\n          itemScope = item.scope();\n          itemScope.us.milestone = $scope.sprints[0].id;\n          return itemScope.us;\n        });\n      };\n      moveUssToSprint = function(selectedUss, sprint) {\n        var extraPoints, totalExtraPoints, ussCurrent;\n        ussCurrent = _($scope.userstories);\n        $scope.userstories = ussCurrent.without.apply(ussCurrent, selectedUss).value();\n        extraPoints = _.map(selectedUss, function(v, k) {\n          return v.total_points;\n        });\n        totalExtraPoints = _.reduce(extraPoints, function(acc, num) {\n          return acc + num;\n        });\n        sprint.user_stories = _.union(sprint.user_stories, selectedUss);\n        sprint.total_points += totalExtraPoints;\n        $repo.saveAll(selectedUss).then(function() {\n          $ctrl.loadSprints();\n          return $ctrl.loadProjectStats();\n        });\n        return $el.find(\".move-to-sprint\").hide();\n      };\n      moveToCurrentSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.currentSprint);\n      };\n      moveToLatestSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.sprints[0]);\n      };\n      shiftPressed = false;\n      lastChecked = null;\n      checkSelected = function(target) {\n        var moveToSprintDom, selectedUsDom;\n        lastChecked = target.closest(\".us-item-row\");\n        target.closest('.us-item-row').toggleClass('ui-multisortable-multiple');\n        moveToSprintDom = $el.find(\".move-to-sprint\");\n        selectedUsDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        if (selectedUsDom.length > 0 && $scope.sprints.length > 0) {\n          return moveToSprintDom.show();\n        } else {\n          return moveToSprintDom.hide();\n        }\n      };\n      $(window).on(\"keydown.shift-pressed keyup.shift-pressed\", function(event) {\n        shiftPressed = !!event.shiftKey;\n        return true;\n      });\n      $el.on(\"change\", \".backlog-table-body input:checkbox\", function(event) {\n        var current, elements, nextAll, prevAll, target;\n        if (lastChecked && shiftPressed) {\n          elements = [];\n          current = $(event.currentTarget).closest(\".us-item-row\");\n          nextAll = lastChecked.nextAll();\n          prevAll = lastChecked.prevAll();\n          if (_.some(nextAll, function(next) {\n            return next === current[0];\n          })) {\n            elements = lastChecked.nextUntil(current);\n          } else if (_.some(prevAll, function(prev) {\n            return prev === current[0];\n          })) {\n            elements = lastChecked.prevUntil(current);\n          }\n          _.map(elements, function(elm) {\n            var input;\n            input = $(elm).find(\"input:checkbox\");\n            input.prop('checked', true);\n            return checkSelected(input);\n          });\n        }\n        target = angular.element(event.currentTarget);\n        target.closest(\".us-item-row\").toggleClass('is-checked');\n        return checkSelected(target);\n      });\n      $el.on(\"click\", \"#move-to-latest-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToLatestSprint, ussToMove));\n        };\n      })(this));\n      $el.on(\"click\", \"#move-to-current-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        };\n      })(this));\n      return $el.on(\"click\", \"#show-tags\", function(event) {\n        event.preventDefault();\n        $ctrl.toggleShowTags();\n        return showHideTags($ctrl);\n      });\n    };\n    showHideTags = function($ctrl) {\n      var elm, text;\n      elm = angular.element(\"#show-tags\");\n      if ($ctrl.showTags) {\n        elm.addClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.HIDE\");\n        return elm.text(text);\n      } else {\n        elm.removeClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.SHOW\");\n        return elm.text(text);\n      }\n    };\n    showHideFilter = function($scope, $el, $ctrl) {\n      var hideText, showText, sidebar, target;\n      sidebar = $el.find(\"sidebar.filters-bar\");\n      sidebar.one(\"transitionend\", function() {\n        return timeout(150, function() {\n          $rootscope.$broadcast(\"resize\");\n          return $('.burndown').css(\"visibility\", \"visible\");\n        });\n      });\n      target = angular.element(\"#show-filters-button\");\n      $('.burndown').css(\"visibility\", \"hidden\");\n      sidebar.toggleClass(\"active\");\n      target.toggleClass(\"active\");\n      hideText = $translate.instant(\"BACKLOG.FILTERS.HIDE\");\n      showText = $translate.instant(\"BACKLOG.FILTERS.SHOW\");\n      toggleText(target, [hideText, showText]);\n      if (!sidebar.hasClass(\"active\")) {\n        $ctrl.resetFilters();\n      } else {\n        $ctrl.restoreFilters();\n      }\n      return $ctrl.toggleActiveFilters();\n    };\n    linkFilters = function($scope, $el, $attrs, $ctrl) {\n      $scope.filtersSearch = {};\n      return $el.on(\"click\", \"#show-filters-button\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return showHideFilter($scope, $el, $ctrl);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs, $rootscope) {\n      var $ctrl, filters;\n      $ctrl = $el.controller();\n      linkToolbar($scope, $el, $attrs, $ctrl);\n      linkFilters($scope, $el, $attrs, $ctrl);\n      linkDoomLine($scope, $el, $attrs, $ctrl);\n      $el.find(\".backlog-table-body\").disableSelection();\n      filters = $ctrl.getUrlFilters();\n      if (filters.status || filters.tags || filters.q) {\n        showHideFilter($scope, $el, $ctrl);\n      }\n      $scope.$on(\"showTags\", function() {\n        return showHideTags($ctrl);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $(window).off(\".shift-pressed\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklog\", [\"$tgRepo\", \"$rootScope\", \"$translate\", BacklogDirective]);\n\n  UsRolePointsSelectorDirective = function($rootscope, $template, $compile, $translate) {\n    var link, selectionTemplate;\n    selectionTemplate = $template.get(\"backlog/us-role-points-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var numberOfRoles, roles;\n        roles = _.filter(project.roles, \"computable\");\n        numberOfRoles = _.size(roles);\n        if (numberOfRoles > 1) {\n          return $el.append($compile(selectionTemplate({\n            \"roles\": roles\n          }))($scope));\n        } else {\n          $el.find(\".icon-arrow-bottom\").remove();\n          return $el.find(\".header-points\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        $el.find(\".popover\").popover().close();\n        return $el.find(\".header-points\").html(roleName + \"/<span>Total</span>\");\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx, roleId) {\n        var text;\n        $el.find(\".popover\").popover().close();\n        text = $translate.instant(\"COMMON.FIELDS.POINTS\");\n        return $el.find(\".header-points\").text(text);\n      });\n      $el.on(\"click\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (target.is(\"span\") || target.is(\"div\")) {\n          event.stopPropagation();\n        }\n        return $el.find(\".popover\").popover().open();\n      });\n      $el.on(\"click\", \".clear-selection\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $rootscope.$broadcast(\"uspoints:clear-selection\");\n      });\n      $el.on(\"click\", \".role\", function(event) {\n        var rolScope, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        rolScope = target.scope();\n        return $rootscope.$broadcast(\"uspoints:select\", target.data(\"role-id\"), target.text());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsRolePointsSelector\", [\"$rootScope\", \"$tgTemplate\", \"$compile\", \"$translate\", UsRolePointsSelectorDirective]);\n\n  UsPointsDirective = function($tgEstimationsService, $repo, $tgTemplate) {\n    var link, rolesTemplate;\n    rolesTemplate = $tgTemplate.get(\"common/estimation/us-points-roles-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, bindClickElements, estimationProcess, filteringRoleId, renderRolesSelector, selectedRoleId, updatingSelectedRoleId;\n      $ctrl = $el.controller();\n      updatingSelectedRoleId = null;\n      selectedRoleId = null;\n      filteringRoleId = null;\n      estimationProcess = null;\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = roleId;\n        return estimationProcess.render();\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = null;\n        return estimationProcess.render();\n      });\n      $scope.$watch($attrs.tgBacklogUsPoints, function(us) {\n        var roles;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          roles = estimationProcess.calculateRoles();\n          if (roles.length === 0) {\n            $el.find(\".icon-arrow-bottom\").remove();\n            $el.find(\"a.us-points\").addClass(\"not-clickable\");\n          } else if (roles.length === 1) {\n            selectedRoleId = _.keys(us.points)[0];\n          }\n          if (estimationProcess.isEditable) {\n            bindClickElements();\n          }\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return this.save(roleId, pointId).then(function() {\n              return $ctrl.loadProjectStats();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, pointId, pointObj, template, text, title, totalPoints;\n            totalPoints = this.calculateTotalPoints();\n            if ((selectedRoleId == null) || roles.length === 1) {\n              text = totalPoints;\n              title = totalPoints;\n            } else {\n              pointId = this.us.points[selectedRoleId];\n              pointObj = this.pointsById[pointId];\n              text = pointObj.name + \" / <span>\" + totalPoints + \"</span>\";\n              title = pointObj.name + \" / \" + totalPoints;\n            }\n            ctx = {\n              totalPoints: totalPoints,\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              text: text,\n              title: title\n            };\n            mainTemplate = \"common/estimation/us-estimation-total.html\";\n            template = $tgTemplate.get(mainTemplate, true);\n            html = template(ctx);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      renderRolesSelector = function() {\n        var html, roles;\n        roles = estimationProcess.calculateRoles();\n        html = rolesTemplate({\n          \"roles\": roles\n        });\n        $el.append(html);\n        return $el.find(\".pop-role\").popover().open(function() {\n          return $(this).remove();\n        });\n      };\n      bindClickElements = function() {\n        $el.on(\"click\", \"a.us-points\", function(event) {\n          var us;\n          event.preventDefault();\n          event.stopPropagation();\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = selectedRoleId;\n          if (selectedRoleId != null) {\n            return estimationProcess.renderPointsSelector(selectedRoleId);\n          } else {\n            return renderRolesSelector();\n          }\n        });\n        return $el.on(\"click\", \".role\", function(event) {\n          var popRolesDom, target, us;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = target.data(\"role-id\");\n          popRolesDom = $el.find(\".pop-role\");\n          popRolesDom.find(\"a\").removeClass(\"active\");\n          popRolesDom.find(\"a[data-role-id='\" + updatingSelectedRoleId + \"']\").addClass(\"active\");\n          return estimationProcess.renderPointsSelector(updatingSelectedRoleId);\n        });\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogUsPoints\", [\"$tgEstimationsService\", \"$tgRepo\", \"$tgTemplate\", UsPointsDirective]);\n\n  ToggleBurndownVisibility = function($storage) {\n    var hide, link, show;\n    hide = function() {\n      $(\".js-burndown-graph\").removeClass(\"shown\");\n      $(\".js-toggle-burndown-visibility-button\").removeClass(\"active\");\n      return $(\".js-burndown-graph\").removeClass(\"open\");\n    };\n    show = function(firstLoad) {\n      $(\".js-toggle-burndown-visibility-button\").addClass(\"active\");\n      if (firstLoad) {\n        return $(\".js-burndown-graph\").addClass(\"shown\");\n      } else {\n        return $(\".js-burndown-graph\").addClass(\"open\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var firstLoad, hash, toggleGraph;\n      firstLoad = true;\n      hash = generateHash([\"is-burndown-grpahs-collapsed\"]);\n      $scope.isBurndownGraphCollapsed = $storage.get(hash) || false;\n      toggleGraph = function() {\n        if ($scope.isBurndownGraphCollapsed) {\n          hide(firstLoad);\n        } else {\n          show(firstLoad);\n        }\n        return firstLoad = false;\n      };\n      $scope.$watch(\"showGraphPlaceholder\", function() {\n        if ($scope.showGraphPlaceholder != null) {\n          $scope.isBurndownGraphCollapsed = $scope.isBurndownGraphCollapsed || $scope.showGraphPlaceholder;\n          return toggleGraph();\n        }\n      });\n      $el.on(\"click\", \".js-toggle-burndown-visibility-button\", function() {\n        $scope.isBurndownGraphCollapsed = !$scope.isBurndownGraphCollapsed;\n        $storage.set(hash, $scope.isBurndownGraphCollapsed);\n        return toggleGraph();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleBurndownVisibility\", [\"$tgStorage\", ToggleBurndownVisibility]);\n\n  BurndownBacklogGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var client_increment_line, colors, data, evolution_line, j, milestonesRange, optimal_line, options, ref1, results, team_increment_line, width, zero_line;\n      width = element.width();\n      element.height(width / 6);\n      milestonesRange = (function() {\n        results = [];\n        for (var j = 0, ref1 = dataToDraw.milestones.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; 0 <= ref1 ? j++ : j--){ results.push(j); }\n        return results;\n      }).apply(this);\n      data = [];\n      zero_line = _.map(dataToDraw.milestones, function(ml) {\n        return 0;\n      });\n      data.push({\n        data: _.zip(milestonesRange, zero_line),\n        lines: {\n          fillColor: \"rgba(0,0,0,0)\"\n        },\n        points: {\n          show: false\n        }\n      });\n      optimal_line = _.map(dataToDraw.milestones, function(ml) {\n        return ml.optimal;\n      });\n      data.push({\n        data: _.zip(milestonesRange, optimal_line),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      evolution_line = _.filter(_.map(dataToDraw.milestones, function(ml) {\n        return ml.evolution;\n      }), function(evolution) {\n        return evolution != null;\n      });\n      data.push({\n        data: _.zip(milestonesRange, evolution_line),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      client_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"] - ml[\"client-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, client_increment_line),\n        lines: {\n          fillColor: \"rgba(255,51,51,0.3)\"\n        }\n      });\n      team_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, team_increment_line),\n        lines: {\n          fillColor: \"rgba(153,51,51,0.3)\"\n        }\n      });\n      colors = [\"rgba(0,0,0,1)\", \"rgba(120,120,120,0.2)\", \"rgba(102,153,51,1)\", \"rgba(153,51,51,1)\", \"rgba(255,51,51,1)\"];\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: \"#ccc\",\n          hoverable: true\n        },\n        xaxis: {\n          ticks: dataToDraw.milestones.length,\n          axisLabel: $translate.instant(\"BACKLOG.CHART.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5,\n          tickFormatter: function(val, axis) {\n            return \"\";\n          }\n        },\n        yaxis: {\n          axisLabel: $translate.instant(\"BACKLOG.CHART.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: colors,\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var ctx;\n            if (flotItem.seriesIndex === 1) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.OPTIMAL\", ctx);\n            } else if (flotItem.seriesIndex === 2) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.REAL\", ctx);\n            } else if (flotItem.seriesIndex === 3) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_CLIENT\", ctx);\n            } else {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_TEAM\", ctx);\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch(\"stats\", function(value) {\n        if ($scope.stats != null) {\n          redrawChart(element, $scope.stats);\n          return $scope.$on(\"resize\", function() {\n            return redrawChart(element, $scope.stats);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBurndownBacklogGraph\", [\"$translate\", BurndownBacklogGraphDirective]);\n\n  TgBacklogProgressBarDirective = function($template, $compile) {\n    var adjustPercentaje, link, render, template;\n    template = $template.get(\"backlog/progress-bar.html\", true);\n    render = function(scope, el, projectPointsPercentaje, closedPointsPercentaje) {\n      var html;\n      html = template({\n        projectPointsPercentaje: projectPointsPercentaje,\n        closedPointsPercentaje: closedPointsPercentaje\n      });\n      html = $compile(html)(scope);\n      return el.html(html);\n    };\n    adjustPercentaje = function(percentage) {\n      var adjusted;\n      adjusted = _.max([0, percentage]);\n      adjusted = _.min([100, adjusted]);\n      return Math.round(adjusted);\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgBacklogProgressBar, function(stats) {\n        var closedPoints, closedPointsPercentaje, definedPoints, projectPointsPercentaje, totalPoints;\n        if (stats != null) {\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          definedPoints = stats.defined_points;\n          closedPoints = stats.closed_points;\n          if (definedPoints > totalPoints) {\n            projectPointsPercentaje = totalPoints * 100 / definedPoints;\n            closedPointsPercentaje = closedPoints * 100 / definedPoints;\n          } else {\n            projectPointsPercentaje = 100;\n            closedPointsPercentaje = closedPoints * 100 / totalPoints;\n          }\n          projectPointsPercentaje = adjustPercentaje(projectPointsPercentaje - 3);\n          closedPointsPercentaje = adjustPercentaje(closedPointsPercentaje - 3);\n          return render($scope, $el, projectPointsPercentaje, closedPointsPercentaje);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogProgressBar\", [\"$tgTemplate\", \"$compile\", TgBacklogProgressBarDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sortable.coffee\n */\n\n(function() {\n  var BacklogEmptySortableDirective, BacklogSortableDirective, SprintSortableDirective, bindOnce, deleteElement, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  deleteElement = function(el) {\n    el.scope().$destroy();\n    el.off();\n    return el.remove();\n  };\n\n  BacklogSortableDirective = function($repo, $rs, $rootscope, $tgConfirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var getUsIndex;\n      getUsIndex = (function(_this) {\n        return function(us) {\n          return $(us).index(\".backlog-table-body .row\");\n        };\n      })(this);\n      bindOnce($scope, \"project\", function(project) {\n        var filterError;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        filterError = function() {\n          var text;\n          text = $translate.instant(\"BACKLOG.SORTABLE_FILTER_ERROR\");\n          return $tgConfirm.notify(\"error\", text);\n        };\n        $el.sortable({\n          items: \".us-item-row\",\n          cancel: \".popover\",\n          connectWith: \".sprint\",\n          dropOnEmpty: true,\n          placeholder: \"row us-item-row us-item-drag sortable-placeholder\",\n          scroll: true,\n          disableHorizontalScroll: true,\n          tolerance: \"pointer\",\n          revert: false,\n          start: function() {\n            return $(document.body).addClass(\"drag-active\");\n          },\n          stop: function() {\n            $(document.body).removeClass(\"drag-active\");\n            if ($el.hasClass(\"active-filters\")) {\n              $el.sortable(\"cancel\");\n              return filterError();\n            }\n          }\n        });\n        $el.on(\"multiplesortreceive\", function(event, ui) {\n          var itemIndex, itemUs;\n          if ($el.hasClass(\"active-filters\")) {\n            ui.source.sortable(\"cancel\");\n            filterError();\n            return;\n          }\n          itemUs = ui.item.scope().us;\n          itemIndex = getUsIndex(ui.item);\n          deleteElement(ui.item);\n          $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, null);\n          return ui.item.find('a').removeClass('noclick');\n        });\n        $el.on(\"multiplesortstop\", function(event, ui) {\n          var index, items, us;\n          if ($(ui.items[0]).parent().length === 0) {\n            return;\n          }\n          if ($el.hasClass(\"active-filters\")) {\n            return;\n          }\n          items = _.sortBy(ui.items, function(item) {\n            return $(item).index();\n          });\n          index = _.min(_.map(items, function(item) {\n            return getUsIndex(item);\n          }));\n          us = _.map(items, function(item) {\n            var itemUs;\n            item = $(item);\n            itemUs = item.scope().us;\n            setTimeout(((function(_this) {\n              return function() {\n                return item.find('a').removeClass('noclick');\n              };\n            })(this)), 300);\n            return itemUs;\n          });\n          return $scope.$emit(\"sprint:us:move\", us, index, null);\n        });\n        return $el.on(\"sortstart\", function(event, ui) {\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BacklogEmptySortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          $el.sortable({\n            items: \".us-item-row\",\n            dropOnEmpty: true\n          });\n          return $el.on(\"sortreceive\", function(event, ui) {\n            var itemIndex, itemUs;\n            itemUs = ui.item.scope().us;\n            itemIndex = ui.item.index();\n            deleteElement(ui.item);\n            $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, null);\n            return ui.item.find('a').removeClass('noclick');\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  SprintSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          $el.sortable({\n            scroll: true,\n            dropOnEmpty: true,\n            items: \".sprint-table .milestone-us-item-row\",\n            disableHorizontalScroll: true,\n            connectWith: \".sprint,.backlog-table-body,.empty-backlog\",\n            placeholder: \"row us-item-row sortable-placeholder\",\n            forcePlaceholderSize: true\n          });\n          $el.on(\"multiplesortreceive\", function(event, ui) {\n            var index, items, us;\n            items = _.sortBy(ui.items, function(item) {\n              return $(item).index();\n            });\n            index = _.min(_.map(items, function(item) {\n              return $(item).index();\n            }));\n            us = _.map(items, function(item) {\n              var itemUs;\n              item = $(item);\n              itemUs = item.scope().us;\n              deleteElement(item);\n              return itemUs;\n            });\n            return $scope.$emit(\"sprint:us:move\", us, index, $scope.sprint.id);\n          });\n          $el.on(\"multiplesortstop\", function(event, ui) {\n            var itemIndex, itemUs;\n            if (ui.item.parent().length === 0) {\n              return;\n            }\n            itemUs = ui.item.scope().us;\n            itemIndex = ui.item.index();\n            setTimeout(((function(_this) {\n              return function() {\n                return ui.item.find('a').removeClass('noclick');\n              };\n            })(this)), 300);\n            return $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, $scope.sprint.id);\n          });\n          return $el.on(\"sortstart\", function(event, ui) {\n            return ui.item.find('a').addClass('noclick');\n          });\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgConfirm\", \"$translate\", BacklogSortableDirective]);\n\n  module.directive(\"tgBacklogEmptySortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", BacklogEmptySortableDirective]);\n\n  module.directive(\"tgSprintSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", SprintSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sprints.coffee\n */\n\n(function() {\n  var BacklogSprintDirective, BacklogSprintHeaderDirective, ToggleExcludeClosedSprintsVisualization, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogSprintDirective = function($repo, $rootscope) {\n    var link, slideOptions, sprintTableMinHeight, toggleSprint;\n    sprintTableMinHeight = 50;\n    slideOptions = {\n      duration: 500,\n      easing: 'linear'\n    };\n    toggleSprint = (function(_this) {\n      return function($el) {\n        var sprintArrow, sprintTable;\n        sprintTable = $el.find(\".sprint-table\");\n        sprintArrow = $el.find(\".compact-sprint\");\n        sprintArrow.toggleClass('active');\n        return sprintTable.toggleClass('open');\n      };\n    })(this);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch($attrs.tgBacklogSprint, function(sprint) {\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        if (sprint.closed) {\n          return $el.addClass(\"sprint-closed\");\n        } else {\n          return toggleSprint($el);\n        }\n      });\n      $el.on(\"click\", \".sprint-name > .compact-sprint\", function(event) {\n        event.preventDefault();\n        toggleSprint($el);\n        return $el.find(\".sprint-table\").slideToggle(slideOptions);\n      });\n      $el.on(\"click\", \".sprint-name > .icon-edit\", function(event) {\n        var sprint;\n        event.preventDefault();\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        return $rootscope.$broadcast(\"sprintform:edit\", sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSprint\", [\"$tgRepo\", \"$rootScope\", BacklogSprintDirective]);\n\n  BacklogSprintHeaderDirective = function($navUrls, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"backlog/sprint-header.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, isVisible, prettyDate, render;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_milestone\") !== -1;\n      };\n      isVisible = function() {\n        return $scope.project.my_permissions.indexOf(\"view_milestones\") !== -1;\n      };\n      render = function(sprint) {\n        var compiledTemplate, ctx, estimatedDateRange, finish, start, taskboardUrl, templateScope;\n        taskboardUrl = $navUrls.resolve(\"project-taskboard\", {\n          project: $scope.project.slug,\n          sprint: sprint.slug\n        });\n        start = moment(sprint.estimated_start).format(prettyDate);\n        finish = moment(sprint.estimated_finish).format(prettyDate);\n        estimatedDateRange = start + \"-\" + finish;\n        ctx = {\n          name: sprint.name,\n          taskboardUrl: taskboardUrl,\n          estimatedDateRange: estimatedDateRange,\n          closedPoints: sprint.closed_points || 0,\n          totalPoints: sprint.total_points || 0,\n          isVisible: isVisible(),\n          isEditable: isEditable()\n        };\n        templateScope = $scope.$new();\n        _.assign(templateScope, ctx);\n        compiledTemplate = $compile(template)(templateScope);\n        return $el.html(compiledTemplate);\n      };\n      $scope.$watch($attrs.ngModel, function(sprint) {\n        return render(sprint);\n      });\n      $scope.$on(\"sprintform:edit:success\", function() {\n        return render($model.$modelValue);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgBacklogSprintHeader\", [\"$tgNavUrls\", \"$tgTemplate\", \"$compile\", \"$translate\", BacklogSprintHeaderDirective]);\n\n  ToggleExcludeClosedSprintsVisualization = function($rootscope, $loading, $translate) {\n    var excludeClosedSprints, link;\n    excludeClosedSprints = true;\n    link = function($scope, $el, $attrs) {\n      var currentLoading, loadingElm;\n      loadingElm = $(\"<div>\");\n      $el.after(loadingElm);\n      currentLoading = null;\n      $el.on(\"click\", function(event) {\n        event.preventDefault();\n        excludeClosedSprints = !excludeClosedSprints;\n        currentLoading = $loading().target(loadingElm).start();\n        if (excludeClosedSprints) {\n          return $rootscope.$broadcast(\"backlog:unload-closed-sprints\");\n        } else {\n          return $rootscope.$broadcast(\"backlog:load-closed-sprints\");\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $scope.$on(\"closed-sprints:reloaded\", (function(_this) {\n        return function(ctx, sprints) {\n          var key, text;\n          currentLoading.finish();\n          if (sprints.length > 0) {\n            key = \"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS\";\n          } else {\n            key = \"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS\";\n          }\n          text = $translate.instant(key);\n          return $el.find(\".text\").text(text);\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogToggleClosedSprintsVisualization\", [\"$rootScope\", \"$tgLoading\", \"$translate\", ToggleExcludeClosedSprintsVisualization]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/charts.coffee\n */\n\n(function() {\n  var SprintGraphDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  SprintGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var data, days, options, width;\n      width = element.width();\n      element.height(240);\n      days = _.map(dataToDraw, function(x) {\n        return moment(x.day);\n      });\n      data = [];\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.optimal_points;\n        })),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.open_points;\n        })),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: '#ccc',\n          hoverable: true\n        },\n        xaxis: {\n          tickSize: [1, \"day\"],\n          min: days[0],\n          max: _.last(days),\n          mode: \"time\",\n          daysNames: days,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        yaxis: {\n          min: 0,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: [\"rgba(102,153,51,1)\", \"rgba(120,120,120,0.2)\"],\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var formattedDate, roundedValue;\n            formattedDate = moment(xval).format($translate.instant(\"TASKBOARD.CHARTS.DATE\"));\n            roundedValue = Math.round(yval);\n            if (flotItem.seriesIndex === 1) {\n              return $translate.instant(\"TASKBOARD.CHARTS.OPTIMAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            } else {\n              return $translate.instant(\"TASKBOARD.CHARTS.REAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$on(\"resize\", function() {\n        if ($scope.stats) {\n          return redrawChart(element, $scope.stats.days);\n        }\n      });\n      $scope.$on(\"taskboard:graph:toggle-visibility\", function() {\n        $el.parent().toggleClass('open');\n        return timeout(100, function() {\n          if ($scope.stats) {\n            return redrawChart(element, $scope.stats.days);\n          }\n        });\n      });\n      $scope.$watch('stats', function(value) {\n        if ($scope.stats == null) {\n          return;\n        }\n        return redrawChart(element, $scope.stats.days);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintGraph\", [\"$translate\", SprintGraphDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkTasksDirective, CreateEditTaskDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  CreateEditTaskDirective = function($repo, $model, $rs, $rootscope, $loading, lightboxService, $translate, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, resetAttachments, submit, submitButton;\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.task.project, 'task');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"task\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      $scope.$on(\"taskform:new\", function(ctx, sprintId, usId) {\n        var create, newTask;\n        $scope.task = {\n          project: $scope.projectId,\n          milestone: sprintId,\n          user_story: usId,\n          is_archived: false,\n          status: $scope.project.default_task_status,\n          assigned_to: null,\n          tags: []\n        };\n        $scope.isNew = true;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        create = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").html(create);\n        newTask = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.TITLE\");\n        $el.find(\".title\").html(newTask + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"taskform:edit\", function(ctx, task, attachments) {\n        var edit, save;\n        $scope.task = task;\n        $scope.isNew = false;\n        $scope.attachments = Immutable.fromJS(attachments);\n        resetAttachments();\n        save = $translate.instant(\"COMMON.SAVE\");\n        edit = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT\");\n        $el.find(\".button-green\").html(save);\n        $el.find(\".title\").html(edit + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      submitButton = $el.find(\".submit-button\");\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.isNew) {\n            promise = $repo.create(\"tasks\", $scope.task);\n            broadcastEvent = \"taskform:new:success\";\n          } else {\n            promise = $repo.save($scope.task);\n            broadcastEvent = \"taskform:edit:success\";\n          }\n          promise.then(function(data) {\n            createAttachments(data);\n            deleteAttachments(data);\n            return data;\n          });\n          currentLoading = $loading().target(submitButton).start();\n          return promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootscope.$broadcast(broadcastEvent, data);\n          });\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CreateBulkTasksDirective = function($repo, $rs, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.form = {\n        data: \"\",\n        usId: null\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise, sprintId, usId;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope.form.data;\n          projectId = $scope.projectId;\n          sprintId = $scope.form.sprintId;\n          usId = $scope.form.usId;\n          promise = $rs.tasks.bulkCreate(projectId, sprintId, usId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"taskform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n      $scope.$on(\"taskform:bulk\", function(ctx, sprintId, usId) {\n        lightboxService.open($el);\n        return $scope.form = {\n          data: \"\",\n          sprintId: sprintId,\n          usId: usId\n        };\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaTaskboard\");\n\n  module.directive(\"tgLbCreateEditTask\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$translate\", \"$q\", \"tgAttachmentsService\", CreateEditTaskDirective]);\n\n  module.directive(\"tgLbCreateBulkTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkTasksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var TaskboardController, TaskboardDirective, TaskboardSquishColumnDirective, TaskboardTaskDirective, TaskboardUserDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  toggleText = this.taiga.toggleText;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  TaskboardController = (function(superClass) {\n    extend(TaskboardController, superClass);\n\n    TaskboardController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"tgAppMetaService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskboardController(scope, rootscope, repo, confirm, rs1, params1, q, appMetaService, location, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.appMetaService = appMetaService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"TASKBOARD.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskboardController.prototype._setMeta = function() {\n      var description, prettyDate, title;\n      prettyDate = this.translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      title = this.translate.instant(\"TASKBOARD.PAGE_TITLE\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name\n      });\n      description = this.translate.instant(\"TASKBOARD.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name,\n        startDate: moment(this.scope.sprint.estimated_start).format(prettyDate),\n        endDate: moment(this.scope.sprint.estimated_finish).format(prettyDate),\n        completedPercentage: this.scope.stats.completedPercentage || \"0\",\n        completedPoints: this.scope.stats.completedPointsSum || \"--\",\n        totalPoints: this.scope.stats.totalPointsSum || \"--\",\n        openTasks: this.scope.stats.openTasks || \"--\",\n        totalTasks: this.scope.stats.total_tasks || \"--\"\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskboardController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"taskform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"bulk create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:new:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      this.scope.$on(\"taskboard:task:move\", this.taskMove);\n      return this.scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, task) {\n          var promise;\n          task.assigned_to = userId;\n          promise = _this.repo.save(task);\n          return promise.then(null, function() {\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.initializeSubscription = function() {\n      var routingKey, routingKey1;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".tasks\";\n      this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.refreshTagsColors();\n          _this.loadSprintStats();\n          return _this.loadSprint();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadProject = function() {\n      return this.rs.projects.get(this.scope.projectId).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(e) {\n            return e.id;\n          });\n          _this.scope.roleById = groupBy(project.roles, function(e) {\n            return e.id;\n          });\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(e) {\n            return e.id;\n          });\n          _this.scope.$emit('project:loaded', project);\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return project;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprintStats = function() {\n      return this.rs.sprints.stats(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(stats) {\n          var completedPointsSum, remainingPointsSum, remainingTasks, totalPointsSum;\n          totalPointsSum = _.reduce(_.values(stats.total_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          completedPointsSum = _.reduce(_.values(stats.completed_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          remainingPointsSum = totalPointsSum - completedPointsSum;\n          remainingTasks = stats.total_tasks - stats.completed_tasks;\n          _this.scope.stats = stats;\n          _this.scope.stats.totalPointsSum = totalPointsSum;\n          _this.scope.stats.completedPointsSum = completedPointsSum;\n          _this.scope.stats.remainingPointsSum = remainingPointsSum;\n          _this.scope.stats.remainingTasks = remainingTasks;\n          if (stats.totalPointsSum) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.completedPointsSum / stats.totalPointsSum);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.stats.openTasks = stats.total_tasks - stats.completed_tasks;\n          return stats;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprint = function() {\n      return this.rs.sprints.get(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(sprint) {\n          _this.scope.sprint = sprint;\n          _this.scope.userstories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          return sprint;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(tasks) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, task, us, usId;\n          _this.scope.tasks = _.sortBy(tasks, 'taskboard_order');\n          _this.scope.usTasks = {};\n          ref = _.union(_this.scope.userstories, [\n            {\n              id: null\n            }\n          ]);\n          for (i = 0, len = ref.length; i < len; i++) {\n            us = ref[i];\n            _this.scope.usTasks[us.id] = {};\n            ref1 = _this.scope.taskStatusList;\n            for (j = 0, len1 = ref1.length; j < len1; j++) {\n              status = ref1[j];\n              _this.scope.usTasks[us.id][status.id] = [];\n            }\n          }\n          ref2 = _this.scope.tasks;\n          for (k = 0, len2 = ref2.length; k < len2; k++) {\n            task = ref2[k];\n            if ((_this.scope.usTasks[task.user_story] != null) && (_this.scope.usTasks[task.user_story][task.status] != null)) {\n              _this.scope.usTasks[task.user_story][task.status].push(task);\n            }\n          }\n          if (tasks.length === 0) {\n            if (_this.scope.userstories.length > 0) {\n              usId = _this.scope.userstories[0].id;\n            } else {\n              usId = null;\n            }\n            _this.scope.usTasks[usId][_this.scope.taskStatusList[0].id].push({\n              isPlaceholder: true\n            });\n          }\n          return tasks;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTaskboard = function() {\n      return this.q.all([\n        this.refreshTagsColors(), this.loadSprintStats(), this.loadSprint().then((function(_this) {\n          return function() {\n            return _this.loadTasks();\n          };\n        })(this))\n      ]);\n    };\n\n    TaskboardController.prototype.loadInitialData = function() {\n      var params, promise;\n      params = {\n        pslug: this.params.pslug,\n        sslug: this.params.sslug\n      };\n      promise = this.repo.resolve(params).then((function(_this) {\n        return function(data) {\n          _this.scope.projectId = data.project;\n          _this.scope.sprintId = data.milestone;\n          _this.initializeSubscription();\n          return data;\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTasksOrder = function(tasks) {\n      var data, items;\n      items = this.resortTasks(tasks);\n      data = this.prepareBulkUpdateData(items);\n      return this.rs.tasks.bulkUpdateTaskTaskboardOrder(this.scope.project.id, data);\n    };\n\n    TaskboardController.prototype.resortTasks = function(tasks) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = tasks.length; i < len; index = ++i) {\n        item = tasks[index];\n        item[\"taskboard_order\"] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    TaskboardController.prototype.prepareBulkUpdateData = function(uses) {\n      return _.map(uses, function(x) {\n        return {\n          \"task_id\": x.id,\n          \"order\": x[\"taskboard_order\"]\n        };\n      });\n    };\n\n    TaskboardController.prototype.taskMove = function(ctx, task, usId, statusId, order) {\n      var promise, r, tasks;\n      r = this.scope.usTasks[task.user_story][task.status].indexOf(task);\n      this.scope.usTasks[task.user_story][task.status].splice(r, 1);\n      tasks = this.scope.usTasks[usId][statusId];\n      tasks.splice(order, 0, task);\n      task.user_story = usId;\n      task.status = statusId;\n      task.taskboard_order = order;\n      promise = this.repo.save(task);\n      this.rootscope.$broadcast(\"sprint:task:moved\", task);\n      promise.then((function(_this) {\n        return function() {\n          _this.refreshTasksOrder(tasks);\n          return _this.loadSprintStats();\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function() {\n          return console.log(\"FAIL TASK SAVE\");\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.addNewTask = function(type, us) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"taskform:new\", this.scope.sprintId, us != null ? us.id : void 0);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"taskform:bulk\", this.scope.sprintId, us != null ? us.id : void 0);\n      }\n    };\n\n    TaskboardController.prototype.editTaskAssignedTo = function(task) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", task);\n    };\n\n    return TaskboardController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskboardController\", TaskboardController);\n\n  TaskboardDirective = function($rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, tableBodyDom;\n      $ctrl = $el.controller();\n      $el.on(\"click\", \".toggle-analytics-visibility\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass('active');\n        return $rootscope.$broadcast(\"taskboard:graph:toggle-visibility\");\n      });\n      tableBodyDom = $el.find(\".taskboard-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".taskboard-table-header .taskboard-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboard\", [\"$rootScope\", TaskboardDirective]);\n\n  TaskboardTaskDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $el.disableSelection();\n      $scope.$watch(\"task\", function(task) {\n        if (task.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!task.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      return $el.find(\".icon-edit\").on(\"click\", function(event) {\n        if ($el.find('.icon-edit').hasClass('noclick')) {\n          return;\n        }\n        return $scope.$apply(function() {\n          var currentLoading, target, task;\n          target = $(event.target);\n          currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n          task = $scope.task;\n          return $rs.tasks.getByRef(task.project, task.ref).then((function(_this) {\n            return function(editingTask) {\n              return $rs2.attachments.list(\"task\", editingTask.id, editingTask.project).then(function(attachments) {\n                $rootscope.$broadcast(\"taskform:edit\", editingTask, attachments.toJS());\n                return currentLoading.finish();\n              });\n            };\n          })(this));\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardTask\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", TaskboardTaskDirective]);\n\n  TaskboardSquishColumnDirective = function(rs) {\n    var avatarWidth, link, maxColumnWidth;\n    avatarWidth = 40;\n    maxColumnWidth = 300;\n    link = function($scope, $el, $attrs) {\n      var getCeilWidth, recalculateStatusColumnWidth, recalculateTaskboardWidth, refreshTaskboardTableWidth, setStatusColumnWidth;\n      $scope.$on(\"sprint:task:moved\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      bindOnce($scope, \"usTasks\", function(project) {\n        $scope.statusesFolded = rs.tasks.getStatusColumnModes($scope.project.id);\n        $scope.usFolded = rs.tasks.getUsRowModes($scope.project.id, $scope.sprintId);\n        return recalculateTaskboardWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.statusesFolded[status.id] = !!!$scope.statusesFolded[status.id];\n        rs.tasks.storeStatusColumnModes($scope.projectId, $scope.statusesFolded);\n        return recalculateTaskboardWidth();\n      };\n      $scope.foldUs = function(us) {\n        if (!us) {\n          $scope.usFolded[null] = !!!$scope.usFolded[null];\n        } else {\n          $scope.usFolded[us.id] = !!!$scope.usFolded[us.id];\n        }\n        rs.tasks.storeUsRowModes($scope.projectId, $scope.sprintId, $scope.usFolded);\n        return recalculateTaskboardWidth();\n      };\n      getCeilWidth = (function(_this) {\n        return function(usId, statusId) {\n          var tasks, tasksMatrixSize, width;\n          tasks = $scope.usTasks[usId][statusId].length;\n          if ($scope.statusesFolded[statusId]) {\n            if (tasks && $scope.usFolded[usId]) {\n              tasksMatrixSize = Math.round(Math.sqrt(tasks));\n              width = avatarWidth * tasksMatrixSize;\n            } else {\n              width = avatarWidth;\n            }\n            return width;\n          }\n          return 0;\n        };\n      })(this);\n      setStatusColumnWidth = (function(_this) {\n        return function(statusId, width) {\n          var column;\n          column = $el.find(\".squish-status-\" + statusId);\n          if (width) {\n            return column.css('max-width', width);\n          } else {\n            return column.css(\"max-width\", maxColumnWidth);\n          }\n        };\n      })(this);\n      refreshTaskboardTableWidth = (function(_this) {\n        return function() {\n          var columnWidths, columns, totalWidth;\n          columnWidths = [];\n          columns = $el.find(\".task-colum-name\");\n          columnWidths = _.map(columns, function(column) {\n            return $(column).outerWidth(true);\n          });\n          totalWidth = _.reduce(columnWidths, function(total, width) {\n            return total + width;\n          });\n          return $el.find('.taskboard-table-inner').css(\"width\", totalWidth);\n        };\n      })(this);\n      recalculateStatusColumnWidth = (function(_this) {\n        return function(statusId) {\n          var statusFoldedWidth;\n          statusFoldedWidth = getCeilWidth(null, statusId);\n          _.forEach($scope.userstories, function(us) {\n            var width;\n            width = getCeilWidth(us.id, statusId);\n            if (width > statusFoldedWidth) {\n              return statusFoldedWidth = width;\n            }\n          });\n          return setStatusColumnWidth(statusId, statusFoldedWidth);\n        };\n      })(this);\n      return recalculateTaskboardWidth = (function(_this) {\n        return function() {\n          _.forEach($scope.taskStatusList, function(status) {\n            return recalculateStatusColumnWidth(status.id);\n          });\n          refreshTaskboardTableWidth();\n        };\n      })(this);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSquishColumn\", [\"$tgResources\", TaskboardSquishColumnDirective]);\n\n  TaskboardUserDirective = function($log, $translate) {\n    var clickable, link;\n    clickable = false;\n    link = function($scope, $el, $attrs) {\n      var username_label;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      $scope.$watch('task.assigned_to', function(assigned_to) {\n        var user;\n        user = $scope.usersById[assigned_to];\n        if (user === void 0) {\n          _.assign($scope, {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          });\n        } else {\n          _.assign($scope, {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          });\n        }\n        return username_label.text($scope.name);\n      });\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") > -1) {\n          clickable = true;\n          $el.find(\".avatar-assigned-to\").on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl;\n              if ($el.find('a').hasClass('noclick')) {\n                return;\n              }\n              $ctrl = $el.controller();\n              return $ctrl.editTaskAssignedTo($scope.task);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl;\n            if ($el.find('a').hasClass('noclick')) {\n              return;\n            }\n            $ctrl = $el.controller();\n            return $ctrl.editTaskAssignedTo($scope.task);\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"taskboard/taskboard-user.html\",\n      scope: {\n        \"usersById\": \"=users\",\n        \"project\": \"=\",\n        \"task\": \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgTaskboardUserAvatar\", [\"$log\", \"$translate\", TaskboardUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/sortable.coffee\n */\n\n(function() {\n  var TaskboardSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  TaskboardSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var deleteElement, itemEl, newParentScope, oldParentScope, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        tdom.sortable({\n          handle: \".taskboard-task-inner\",\n          dropOnEmpty: true,\n          connectWith: \".taskboard-tasks-box\",\n          revert: 400\n        });\n        tdom.on(\"sortstop\", function(event, ui) {\n          var itemIndex, itemTask, newStatusId, newUsId, oldStatusId, oldUsId, parentEl;\n          parentEl = ui.item.parent();\n          itemEl = ui.item;\n          itemTask = itemEl.scope().task;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          oldUsId = oldParentScope.us ? oldParentScope.us.id : null;\n          oldStatusId = oldParentScope.st.id;\n          newUsId = newParentScope.us ? newParentScope.us.id : null;\n          newStatusId = newParentScope.st.id;\n          if (newStatusId !== oldStatusId || newUsId !== oldUsId) {\n            deleteElement(itemEl);\n          }\n          $scope.$apply(function() {\n            return $rootscope.$broadcast(\"taskboard:task:move\", itemTask, newUsId, newStatusId, itemIndex);\n          });\n          return ui.item.find('a').removeClass('noclick');\n        });\n        return tdom.on(\"sortstart\", function(event, ui) {\n          oldParentScope = ui.item.parent().scope();\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", TaskboardSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/main.coffee\n */\n\n(function() {\n  var KanbanArchivedStatusHeaderDirective, KanbanArchivedStatusIntroDirective, KanbanController, KanbanDirective, KanbanSquishColumnDirective, KanbanUserDirective, KanbanUserstoryDirective, KanbanWipLimitDirective, bindMethods, bindOnce, defaultViewMode, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText, viewModes,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaKanban\");\n\n  defaultViewMode = \"maximized\";\n\n  viewModes = [\"maximized\", \"minimized\"];\n\n  KanbanController = (function(superClass) {\n    extend(KanbanController, superClass);\n\n    KanbanController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function KanbanController(scope, rootscope, repo, confirm, rs1, params1, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"KANBAN.SECTION_NAME\");\n      this.scope.statusViewModes = {};\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"KANBAN.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"KANBAN.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    KanbanController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.refreshTagsColors();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.refreshTagsColors();\n        };\n      })(this));\n      this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n      this.scope.$on(\"kanban:us:move\", this.moveUs);\n      this.scope.$on(\"kanban:show-userstories-for-status\", this.loadUserStoriesForStatus);\n      return this.scope.$on(\"kanban:hide-userstories-for-status\", this.hideUserStoriesForStatus);\n    };\n\n    KanbanController.prototype.addNewUs = function(type, statusId) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, statusId, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, statusId);\n      }\n    };\n\n    KanbanController.prototype.changeUsAssignedTo = function(us) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", us);\n    };\n\n    KanbanController.prototype.onAssignedToChanged = function(ctx, userid, us) {\n      var promise;\n      us.assigned_to = userid;\n      promise = this.repo.save(us);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    KanbanController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadUserstories = function() {\n      var params, promise;\n      params = {\n        status__is_archived: false\n      };\n      promise = this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, us, usByStatus, us_archived;\n          _this.scope.userstories = userstories;\n          usByStatus = _.groupBy(userstories, \"status\");\n          us_archived = [];\n          ref = _this.scope.usStatusList;\n          for (i = 0, len = ref.length; i < len; i++) {\n            status = ref[i];\n            if (usByStatus[status.id] == null) {\n              usByStatus[status.id] = [];\n            }\n            if (_this.scope.usByStatus != null) {\n              ref1 = _this.scope.usByStatus[status.id];\n              for (j = 0, len1 = ref1.length; j < len1; j++) {\n                us = ref1[j];\n                if (us.status !== status.id) {\n                  us_archived.push(us);\n                }\n              }\n            }\n            if (status.is_archived && (_this.scope.usByStatus != null) && _this.scope.usByStatus[status.id].length !== 0) {\n              ref2 = _this.scope.usByStatus[status.id].concat(us_archived);\n              for (k = 0, len2 = ref2.length; k < len2; k++) {\n                us = ref2[k];\n                if (us.status === status.id) {\n                  usByStatus[status.id].push(us);\n                }\n              }\n            }\n            usByStatus[status.id] = _.sortBy(usByStatus[status.id], \"kanban_order\");\n          }\n          if (userstories.length === 0) {\n            status = _this.scope.usStatusList[0];\n            usByStatus[status.id].push({\n              isPlaceholder: true\n            });\n          }\n          _this.scope.usByStatus = usByStatus;\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\", userstories);\n          });\n          return userstories;\n        };\n      })(this));\n      promise.then((function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    KanbanController.prototype.loadUserStoriesForStatus = function(ctx, statusId) {\n      var params;\n      params = {\n        status: statusId\n      };\n      return this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.scope.usByStatus[statusId] = _.sortBy(userstories, \"kanban_order\");\n          _this.scope.$broadcast(\"kanban:shown-userstories-for-status\", statusId, userstories);\n          return userstories;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.hideUserStoriesForStatus = function(ctx, statusId) {\n      this.scope.usByStatus[statusId] = [];\n      return this.scope.$broadcast(\"kanban:hidden-userstories-for-status\", statusId);\n    };\n\n    KanbanController.prototype.loadKanban = function() {\n      return this.q.all([this.refreshTagsColors(), this.loadUserstories()]);\n    };\n\n    KanbanController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_kanban_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.projectId = project.id;\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.generateStatusViewModes();\n          _this.scope.$emit(\"project:loaded\", project);\n          return project;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeSubscription = function() {\n      var routingKey1;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          return _this.loadKanban();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.generateStatusViewModes = function() {\n      var i, len, mode, ref, status, storedStatusViewModes;\n      storedStatusViewModes = this.rs.kanban.getStatusViewModes(this.scope.projectId);\n      this.scope.statusViewModes = {};\n      ref = this.scope.usStatusList;\n      for (i = 0, len = ref.length; i < len; i++) {\n        status = ref[i];\n        mode = storedStatusViewModes[status.id] || defaultViewMode;\n        this.scope.statusViewModes[status.id] = mode;\n      }\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.storeStatusViewModes = function() {\n      return this.rs.kanban.storeStatusViewModes(this.scope.projectId, this.scope.statusViewModes);\n    };\n\n    KanbanController.prototype.updateStatusViewMode = function(statusId, newViewMode) {\n      this.scope.statusViewModes[statusId] = newViewMode;\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.isMaximized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'maximized';\n    };\n\n    KanbanController.prototype.isMinimized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'minimized';\n    };\n\n    KanbanController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"kanban_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    KanbanController.prototype.resortUserStories = function(uses) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = uses.length; i < len; index = ++i) {\n        item = uses[index];\n        item.kanban_order = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    KanbanController.prototype.moveUs = function(ctx, us, oldStatusId, newStatusId, index) {\n      var itemsToSave, promise, r;\n      if (oldStatusId !== newStatusId) {\n        r = this.scope.usByStatus[oldStatusId].indexOf(us);\n        this.scope.usByStatus[oldStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n        us.status = newStatusId;\n      } else {\n        r = this.scope.usByStatus[newStatusId].indexOf(us);\n        this.scope.usByStatus[newStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n      }\n      itemsToSave = this.resortUserStories(this.scope.usByStatus[newStatusId]);\n      this.scope.usByStatus[newStatusId] = _.sortBy(this.scope.usByStatus[newStatusId], \"kanban_order\");\n      promise = this.repo.save(us);\n      promise = promise.then((function(_this) {\n        return function() {\n          var data;\n          itemsToSave = _.reject(itemsToSave, {\n            \"id\": us.id\n          });\n          data = _this.prepareBulkUpdateData(itemsToSave);\n          return _this.rs.userstories.bulkUpdateKanbanOrder(us.project, data).then(function() {\n            return itemsToSave;\n          });\n        };\n      })(this));\n      return promise;\n    };\n\n    return KanbanController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"KanbanController\", KanbanController);\n\n  KanbanDirective = function($repo, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var tableBodyDom;\n      tableBodyDom = $el.find(\".kanban-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".kanban-table-header .kanban-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanban\", [\"$tgRepo\", \"$rootScope\", KanbanDirective]);\n\n  KanbanArchivedStatusHeaderDirective = function($rootscope, $translate) {\n    var hideArchivedText, link, showArchivedText;\n    showArchivedText = $translate.instant(\"KANBAN.ACTION_SHOW_ARCHIVED\");\n    hideArchivedText = $translate.instant(\"KANBAN.ACTION_HIDE_ARCHIVED\");\n    link = function($scope, $el, $attrs) {\n      var hidden, status;\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusHeader);\n      hidden = true;\n      $scope[\"class\"] = \"icon-open-eye\";\n      $scope.title = showArchivedText;\n      $el.on(\"click\", function(event) {\n        hidden = !hidden;\n        return $scope.$apply(function() {\n          if (hidden) {\n            $scope[\"class\"] = \"icon-open-eye\";\n            $scope.title = showArchivedText;\n            return $rootscope.$broadcast(\"kanban:hide-userstories-for-status\", status.id);\n          } else {\n            $scope[\"class\"] = \"icon-closed-eye\";\n            $scope.title = hideArchivedText;\n            return $rootscope.$broadcast(\"kanban:show-userstories-for-status\", status.id);\n          }\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusHeader\", [\"$rootScope\", \"$translate\", KanbanArchivedStatusHeaderDirective]);\n\n  KanbanArchivedStatusIntroDirective = function($translate) {\n    var link, userStories;\n    userStories = [];\n    link = function($scope, $el, $attrs) {\n      var hiddenUserStoriexText, status, updateIntroText;\n      hiddenUserStoriexText = $translate.instant(\"KANBAN.HIDDEN_USER_STORIES\");\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusIntro);\n      $el.text(hiddenUserStoriexText);\n      updateIntroText = function() {\n        if (userStories.length > 0) {\n          return $el.text(\"\");\n        } else {\n          return $el.text(hiddenUserStoriexText);\n        }\n      };\n      $scope.$on(\"kanban:us:move\", function(ctx, itemUs, oldStatusId, newStatusId, itemIndex) {\n        var r;\n        if (status.id === newStatusId) {\n          if (status.id === oldStatusId) {\n            r = userStories.indexOf(itemUs);\n            userStories.splice(r, 1);\n            userStories.splice(itemIndex, 0, itemUs);\n          } else {\n            itemUs.isArchived = true;\n            userStories.splice(itemIndex, 0, itemUs);\n          }\n        } else if (status.id === oldStatusId) {\n          itemUs.isArchived = false;\n          r = userStories.indexOf(itemUs);\n          userStories.splice(r, 1);\n        }\n        return updateIntroText();\n      });\n      $scope.$on(\"kanban:shown-userstories-for-status\", function(ctx, statusId, userStoriesLoaded) {\n        if (statusId === status.id) {\n          userStories = _.filter(userStoriesLoaded, function(us) {\n            return us.status === status.id;\n          });\n          return updateIntroText();\n        }\n      });\n      $scope.$on(\"kanban:hidden-userstories-for-status\", function(ctx, statusId) {\n        if (statusId === status.id) {\n          userStories = [];\n          return updateIntroText();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusIntro\", [\"$translate\", KanbanArchivedStatusIntroDirective]);\n\n  KanbanUserstoryDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $el.disableSelection();\n      $scope.$watch(\"us\", function(us) {\n        if (us.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!us.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      $el.on('click', '.icon-edit', function(event) {\n        var currentLoading, target, us;\n        if ($el.find(\".icon-edit\").hasClass(\"noclick\")) {\n          return;\n        }\n        target = $(event.target);\n        currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n        us = $model.$modelValue;\n        return $rs.userstories.getByRef(us.project, us.ref).then((function(_this) {\n          return function(editingUserStory) {\n            return $rs2.attachments.list(\"us\", us.id, us.project).then(function(attachments) {\n              $rootscope.$broadcast(\"usform:edit\", editingUserStory, attachments.toJS());\n              return currentLoading.finish();\n            });\n          };\n        })(this));\n      });\n      $scope.getTemplateUrl = function() {\n        if ($scope.us.isPlaceholder) {\n          return \"common/components/kanban-placeholder.html\";\n        } else {\n          return \"kanban/kanban-task.html\";\n        }\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      template: '<ng-include src=\"getTemplateUrl()\"/>',\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserstory\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", KanbanUserstoryDirective]);\n\n  KanbanSquishColumnDirective = function(rs) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var updateTableWidth;\n      $scope.$on(\"project:loaded\", function(event, project) {\n        $scope.folds = rs.kanban.getStatusColumnModes(project.id);\n        return updateTableWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.folds[status.id] = !!!$scope.folds[status.id];\n        rs.kanban.storeStatusColumnModes($scope.projectId, $scope.folds);\n        updateTableWidth();\n      };\n      return updateTableWidth = function() {\n        var columnWidths, totalWidth;\n        columnWidths = _.map($scope.usStatusList, function(status) {\n          if ($scope.folds[status.id]) {\n            return 40;\n          } else {\n            return 310;\n          }\n        });\n        totalWidth = _.reduce(columnWidths, function(total, width) {\n          return total + width;\n        });\n        return $el.find('.kanban-table-inner').css(\"width\", totalWidth);\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSquishColumn\", [\"$tgResources\", KanbanSquishColumnDirective]);\n\n  KanbanWipLimitDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var redrawWipLimit, status;\n      $el.disableSelection();\n      status = $scope.$eval($attrs.tgKanbanWipLimit);\n      redrawWipLimit = (function(_this) {\n        return function() {\n          $el.find(\".kanban-wip-limit\").remove();\n          return timeout(200, function() {\n            var element;\n            element = $el.find(\".kanban-task\")[status.wip_limit];\n            if (element) {\n              return angular.element(element).before(\"<div class='kanban-wip-limit'></div>\");\n            }\n          });\n        };\n      })(this);\n      if (status && !status.is_archived) {\n        $scope.$on(\"redraw:wip\", redrawWipLimit);\n        $scope.$on(\"kanban:us:move\", redrawWipLimit);\n        $scope.$on(\"usform:new:success\", redrawWipLimit);\n        $scope.$on(\"usform:bulk:success\", redrawWipLimit);\n      }\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanWipLimit\", KanbanWipLimitDirective);\n\n  KanbanUserDirective = function($log, $compile, $translate) {\n    var clickable, link, template;\n    template = _.template(\"<figure class=\\\"avatar\\\">\\n    <a href=\\\"#\\\" title=\\\"{{'US.ASSIGN' | translate}}\\\" <% if (!clickable) {%>class=\\\"not-clickable\\\"<% } %>>\\n        <img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\" class=\\\"avatar\\\">\\n    </a>\\n</figure>\");\n    clickable = false;\n    link = function($scope, $el, $attrs, $model) {\n      var render, username_label, wtid;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      if (!$attrs.tgKanbanUserAvatar) {\n        return $log.error(\"KanbanUserDirective: no attr is defined\");\n      }\n      wtid = $scope.$watch($attrs.tgKanbanUserAvatar, function(v) {\n        var user;\n        if ($scope.usersById == null) {\n          $log.error(\"KanbanUserDirective requires userById set in scope.\");\n          return wtid();\n        } else {\n          user = $scope.usersById[v];\n          return render(user);\n        }\n      });\n      render = function(user) {\n        var ctx, html;\n        if (user === void 0) {\n          ctx = {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          };\n        } else {\n          ctx = {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          };\n        }\n        html = $compile(template(ctx))($scope);\n        $el.html(html);\n        return username_label.text(ctx.name);\n      };\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          clickable = true;\n          $el.on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl, us;\n              if ($el.find(\"a\").hasClass(\"noclick\")) {\n                return;\n              }\n              us = $model.$modelValue;\n              $ctrl = $el.controller();\n              return $ctrl.changeUsAssignedTo(us);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl, us;\n            if ($el.find(\"a\").hasClass(\"noclick\")) {\n              return;\n            }\n            us = $model.$modelValue;\n            $ctrl = $el.controller();\n            return $ctrl.changeUsAssignedTo(us);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserAvatar\", [\"$log\", \"$compile\", \"$translate\", KanbanUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/sortable.coffee\n */\n\n(function() {\n  var KanbanSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var deleteElement, itemEl, newParentScope, oldParentScope, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        tdom.sortable({\n          handle: \".kanban-task-inner\",\n          dropOnEmpty: true,\n          connectWith: \".kanban-uses-box\",\n          revert: 400\n        });\n        tdom.on(\"sortstop\", function(event, ui) {\n          var itemIndex, itemUs, newStatusId, oldStatusId, parentEl;\n          parentEl = ui.item.parent();\n          itemEl = ui.item;\n          itemUs = itemEl.scope().us;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          newStatusId = newParentScope.s.id;\n          oldStatusId = oldParentScope.s.id;\n          if (newStatusId !== oldStatusId) {\n            deleteElement(itemEl);\n          }\n          $scope.$apply(function() {\n            return $rootscope.$broadcast(\"kanban:us:move\", itemUs, itemUs.status, newStatusId, itemIndex);\n          });\n          return ui.item.find('a').removeClass('noclick');\n        });\n        return tdom.on(\"sortstart\", function(event, ui) {\n          oldParentScope = ui.item.parent().scope();\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", KanbanSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/detail.coffee\n */\n\n(function() {\n  var IssueDetailController, IssuePriorityButtonDirective, IssueSeverityButtonDirective, IssueStatusButtonDirective, IssueStatusDisplayDirective, IssueTriggerButtonDirective, IssueTypeButtonDirective, PromoteIssueToUsButtonDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssueDetailController = (function(superClass) {\n    extend(IssueDetailController, superClass);\n\n    IssueDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\"];\n\n    function IssueDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, analytics, navUrls, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.issueRef = this.params.issueref;\n      this.scope.sectionName = this.translate.instant(\"ISSUES.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    IssueDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, ref3, ref4, title;\n      title = this.translate.instant(\"ISSUE.PAGE_TITLE\", {\n        issueRef: \"#\" + this.scope.issue.ref,\n        issueSubject: this.scope.issue.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"ISSUE.PAGE_DESCRIPTION\", {\n        issueStatus: ((ref = this.scope.statusById[this.scope.issue.status]) != null ? ref.name : void 0) || \"--\",\n        issueType: ((ref1 = this.scope.typeById[this.scope.issue.type]) != null ? ref1.name : void 0) || \"--\",\n        issueSeverity: ((ref2 = this.scope.severityById[this.scope.issue.severity]) != null ? ref2.name : void 0) || \"--\",\n        issueTrigger: ((ref3 = this.scope.triggerById[this.scope.issue.trigger]) != null ? ref3.name : void 0) || \"--\",\n        issuePriority: ((ref4 = this.scope.priorityById[this.scope.issue.priority]) != null ? ref4.name : void 0) || \"--\",\n        issueDescription: angular.element(this.scope.issue.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    IssueDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on issue\", 1);\n        };\n      })(this));\n      this.scope.$on(\"promote-issue-to-us:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"promoteToUserstory\", \"promote issue to userstory\", 1);\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.loadIssue();\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadIssue();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      if (this.scope.project.is_issues_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-issues\", ctx);\n      } else {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      }\n    };\n\n    IssueDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.issue_statuses;\n          _this.scope.statusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.typeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          _this.scope.typeList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.severityList = project.severities;\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerList = project.triggers;\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = project.priorities;\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadIssue = function() {\n      return this.rs.issues.getByRef(this.scope.projectId, this.params.issueref).then((function(_this) {\n        return function(issue) {\n          var ctx, ref, ref1;\n          _this.scope.issue = issue;\n          _this.scope.issueId = issue.id;\n          _this.scope.commentModel = issue;\n          if (((ref = _this.scope.issue.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.issue.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadIssue();\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    IssueDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.upvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.downvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    IssueDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.watch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.unwatch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    return IssueDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"IssueDetailController\", IssueDetailController);\n\n  IssueStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issue) {\n        var html, status;\n        status = $scope.statusById[issue.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue != null) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusDisplay\", [\"$tgTemplate\", \"$compile\", IssueStatusDisplayDirective]);\n\n  IssueStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issues-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, status;\n          status = $scope.statusById[issue.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(statusId) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.status = statusId;\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueStatusButtonDirective]);\n\n  IssueTypeButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-type-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, type;\n          type = $scope.typeById[issue.type];\n          html = template({\n            type: type,\n            typees: $scope.typeList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(type) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.type = type;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".type-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-type\").popover().open();\n      });\n      $el.on(\"click\", \".type\", function(event) {\n        var target, type;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        type = target.data(\"type-id\");\n        return save(type);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTypeButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueTypeButtonDirective]);\n\n  IssueSeverityButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-severity-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, severity;\n          severity = $scope.severityById[issue.severity];\n          html = template({\n            severity: severity,\n            severityes: $scope.severityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(severity) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.severity = severity;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".severity-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-severity\").popover().open();\n      });\n      $el.on(\"click\", \".severity\", function(event) {\n        var severity, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        severity = target.data(\"severity-id\");\n        return save(severity);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueSeverityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueSeverityButtonDirective]);\n\n  IssueTriggerButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-trigger-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, trigger;\n          trigger = $scope.triggerById[issue.trigger];\n          html = template({\n            trigger: trigger,\n            triggeres: $scope.triggerList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(trigger) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.trigger = trigger;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $confirm.notify(\"success\");\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".trigger-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-trigger\").popover().open();\n      });\n      $el.on(\"click\", \".trigger\", function(event) {\n        var target, trigger;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        trigger = target.data(\"trigger-id\");\n        return save(trigger);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTriggerButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueTriggerButtonDirective]);\n\n  IssuePriorityButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-priority-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, priority;\n          priority = $scope.priorityById[issue.priority];\n          html = template({\n            priority: priority,\n            priorityes: $scope.priorityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(priority) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.priority = priority;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".priority-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-priority\").popover().open();\n      });\n      $el.on(\"click\", \".priority\", function(event) {\n        var priority, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        priority = target.data(\"priority-id\");\n        return save(priority);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssuePriorityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssuePriorityButtonDirective]);\n\n  PromoteIssueToUsButtonDirective = function($rootScope, $repo, $confirm, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = $qqueue.bindAdd((function(_this) {\n        return function(issue, askResponse) {\n          var data, onError, onSuccess;\n          data = {\n            generated_from_issue: issue.id,\n            project: issue.project,\n            subject: issue.subject,\n            description: issue.description,\n            tags: issue.tags,\n            is_blocked: issue.is_blocked,\n            blocked_note: issue.blocked_note\n          };\n          onSuccess = function() {\n            askResponse.finish();\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"promote-issue-to-us:success\");\n          };\n          onError = function() {\n            askResponse.finish();\n            return $confirm.notify(\"error\");\n          };\n          return $repo.create(\"userstories\", data).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \"a\", function(event) {\n        var issue, message, subtitle, title;\n        event.preventDefault();\n        issue = $model.$modelValue;\n        title = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.TITLE\");\n        message = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.MESSAGE\");\n        subtitle = issue.subject;\n        return $confirm.ask(title, subtitle, message).then((function(_this) {\n          return function(response) {\n            return save(issue, response);\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      restrict: \"AE\",\n      require: \"ngModel\",\n      templateUrl: \"issue/promote-issue-to-us-button.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgPromoteIssueToUsButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgQqueue\", \"$translate\", PromoteIssueToUsButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkIssuesDirective, CreateIssueDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaIssues\");\n\n  CreateIssueDirective = function($repo, $confirm, $rootscope, lightboxService, $loading, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var attachmentsToAdd, createAttachments, form, resetAttachments, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      $scope.issue = {};\n      $scope.attachments = Immutable.List();\n      $scope.$on(\"issueform:new\", function(ctx, project) {\n        form.reset();\n        resetAttachments();\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el);\n        return $scope.issue = {\n          project: project.id,\n          subject: \"\",\n          status: project.default_issue_status,\n          type: project.default_issue_type,\n          priority: project.default_priority,\n          severity: project.default_severity,\n          trigger: project.default_trigger,\n          tags: []\n        };\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.issue.project, 'issue');\n        });\n        return $q.all(promises);\n      };\n      attachmentsToAdd = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return $scope.attachments = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"issues\", $scope.issue);\n          promise.then(function(data) {\n            return createAttachments(data);\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", data);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateIssue\", [\"$tgRepo\", \"$tgConfirm\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$q\", \"tgAttachmentsService\", CreateIssueDirective]);\n\n  CreateBulkIssuesDirective = function($repo, $rs, $confirm, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"issueform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        lightboxService.open($el);\n        return $scope[\"new\"] = {\n          projectId: projectId,\n          bulk: \"\"\n        };\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, projectId, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope[\"new\"].bulk;\n          projectId = $scope[\"new\"].projectId;\n          promise = $rs.issues.bulkCreate(projectId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", result);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkIssues\", [\"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkIssuesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/list.coffee\n */\n\n(function() {\n  var IssueAssignedToInlineEditionDirective, IssueStatusInlineEditionDirective, IssueTriggerInlineEditionDirective, IssuesController, IssuesDirective, IssuesFiltersDirective, bindOnce, debounceLeading, groupBy, joinStr, mixOf, module, startswith, taiga, toString, trim,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  startswith = this.taiga.startswith;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssuesController = (function(superClass) {\n    extend(IssuesController, superClass);\n\n    IssuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgUrls\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function IssuesController(scope, rootscope, repo, confirm, rs, urls, params, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var filters, promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.urls = urls;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loadIssues = bind(this.loadIssues, this);\n      this.scope.sectionName = \"Issues\";\n      this.scope.filters = {};\n      if (_.isEmpty(this.location.search())) {\n        filters = this.rs.issues.getFilters(this.params.pslug);\n        filters.page = 1;\n        this.location.search(filters);\n        this.location.replace();\n        return;\n      }\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ISSUES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"ISSUES.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"issueform:new:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"create\", \"create issue on issues list\", 1);\n          return _this.loadIssues();\n        };\n      })(this));\n    }\n\n    IssuesController.prototype.initializeSubscription = function() {\n      var routingKey;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".issues\";\n      return this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.storeFilters = function() {\n      return this.rs.issues.storeFilters(this.params.pslug, this.location.search());\n    };\n\n    IssuesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_issues_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.severityList = _.sortBy(project.severities, \"order\");\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerList = _.sortBy(project.triggers, \"order\");\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = _.sortBy(project.priorities, \"order\");\n          _this.scope.issueTypes = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueTypeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\", \"tags\", \"status\", \"types\", \"q\", \"severities\", \"triggers\", \"priorities\", \"assignedTo\", \"createdBy\", \"orderBy\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    IssuesController.prototype.getUrlFilter = function(name) {\n      var filters;\n      filters = _.pick(this.location.search(), name);\n      return filters[name];\n    };\n\n    IssuesController.prototype.loadMyFilters = function() {\n      return this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          return _.map(filters, function(value, key) {\n            return {\n              id: key,\n              name: key,\n              type: \"myFilters\",\n              selected: false\n            };\n          });\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.removeNotExistingFiltersFromUrl = function() {\n      var currentSearch, existingValues, filterName, filterValue, splittedValues, urlfilters;\n      currentSearch = this.location.search();\n      urlfilters = this.getUrlFilters();\n      for (filterName in urlfilters) {\n        filterValue = urlfilters[filterName];\n        if (filterName === \"page\" || filterName === \"orderBy\" || filterName === \"q\") {\n          continue;\n        }\n        if (filterName === \"tags\") {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"));\n        } else {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"), function(x) {\n            if (x === \"null\") {\n              return null;\n            } else {\n              return parseInt(x);\n            }\n          });\n        }\n        existingValues = _.intersection(splittedValues, _.map(this.scope.filters[filterName], \"id\"));\n        if (splittedValues.length !== existingValues.length) {\n          this.location.search(filterName, existingValues.join());\n        }\n      }\n      if (currentSearch !== this.location.search()) {\n        return this.location.replace();\n      }\n    };\n\n    IssuesController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref, ref1, results, searchdata, val, value;\n      searchdata = {};\n      ref = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref) {\n        value = ref[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref1 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref1.length; j < len; j++) {\n          val = ref1[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var k, len1, results1;\n          results1 = [];\n          for (k = 0, len1 = value.length; k < len1; k++) {\n            obj = value[k];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    IssuesController.prototype.loadFilters = function() {\n      var loadFilters, promise, urlfilters;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = urlfilters.q;\n      }\n      promise = this.loadMyFilters().then((function(_this) {\n        return function(myFilters) {\n          _this.scope.filters.myFilters = myFilters;\n          return myFilters;\n        };\n      })(this));\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.types = urlfilters.types;\n      loadFilters.severities = urlfilters.severities;\n      loadFilters.triggers = urlfilters.triggers;\n      loadFilters.priorities = urlfilters.priorities;\n      loadFilters.assigned_to = urlfilters.assignedTo;\n      loadFilters.owner = urlfilters.createdBy;\n      promise = promise.then((function(_this) {\n        return function() {\n          return _this.rs.issues.filtersData(loadFilters);\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, tagsFilterFormat, usersFiltersFormat;\n          usersFiltersFormat = function(users, type, unknownOption) {\n            var reformatedUsers, unknownItem;\n            reformatedUsers = _.map(users, function(t) {\n              t.type = type;\n              t.name = t.full_name ? t.full_name : unknownOption;\n              return t;\n            });\n            unknownItem = _.remove(reformatedUsers, function(u) {\n              return !u.id;\n            });\n            reformatedUsers = _.sortBy(reformatedUsers, function(u) {\n              return u.name.toUpperCase();\n            });\n            if (unknownItem.length > 0) {\n              reformatedUsers.unshift(unknownItem[0]);\n            }\n            return reformatedUsers;\n          };\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.issueStatusById);\n          _this.scope.filters.severities = choicesFiltersFormat(data.severities, \"severities\", _this.scope.severityById);\n          _this.scope.filters.triggers = choicesFiltersFormat(data.triggers, \"triggers\", _this.scope.triggerById);\n          _this.scope.filters.priorities = choicesFiltersFormat(data.priorities, \"priorities\", _this.scope.priorityById);\n          _this.scope.filters.assignedTo = usersFiltersFormat(data.assigned_to, \"assignedTo\", \"Unassigned\");\n          _this.scope.filters.createdBy = usersFiltersFormat(data.owners, \"createdBy\", \"Unknown\");\n          _this.scope.filters.types = choicesFiltersFormat(data.types, \"types\", _this.scope.issueTypeById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          _this.removeNotExistingFiltersFromUrl();\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rootscope.$broadcast(\"filters:loaded\", _this.scope.filters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadIssuesRequests = 0;\n\n    IssuesController.prototype.loadIssues = function() {\n      var name, promise, ref, values;\n      this.scope.urlFilters = this.getUrlFilters();\n      this.scope.httpParams = {};\n      ref = this.scope.urlFilters;\n      for (name in ref) {\n        values = ref[name];\n        if (name === \"severities\") {\n          name = \"severity\";\n        } else if (name === \"orderBy\") {\n          name = \"order_by\";\n        } else if (name === \"priorities\") {\n          name = \"priority\";\n        } else if (name === \"triggers\") {\n          name = \"trigger\";\n        } else if (name === \"assignedTo\") {\n          name = \"assigned_to\";\n        } else if (name === \"createdBy\") {\n          name = \"owner\";\n        } else if (name === \"status\") {\n          name = \"status\";\n        } else if (name === \"types\") {\n          name = \"type\";\n        }\n        this.scope.httpParams[name] = values;\n      }\n      promise = this.rs.issues.list(this.scope.projectId, this.scope.httpParams);\n      this.loadIssuesRequests += 1;\n      promise.index = this.loadIssuesRequests;\n      promise.then((function(_this) {\n        return function(data) {\n          if (promise.index === _this.loadIssuesRequests) {\n            _this.scope.issues = data.models;\n            _this.scope.page = data.current;\n            _this.scope.count = data.count;\n            _this.scope.paginatedBy = data.paginatedBy;\n          }\n          return data;\n        };\n      })(this));\n      return promise;\n    };\n\n    IssuesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          _this.loadFilters();\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.saveCurrentFiltersTo = function(newFilter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          filters[newFilter] = _this.location.search();\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.deleteMyFilter = function(filter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          delete filters[filter];\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.addNewIssue = function() {\n      return this.rootscope.$broadcast(\"issueform:new\", this.scope.project);\n    };\n\n    IssuesController.prototype.addIssuesInBulk = function() {\n      return this.rootscope.$broadcast(\"issueform:bulk\", this.scope.projectId);\n    };\n\n    return IssuesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"IssuesController\", IssuesController);\n\n  IssuesDirective = function($log, $location, $template, $compile) {\n    var link, linkOrdering, linkPagination, template;\n    template = $template.get(\"issue/issue-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".issues-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        $pagEl.show();\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        return $pagEl.html(html);\n      };\n      $scope.$watch(\"issues\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".issues-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      $el.on(\"click\", \".issues-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      return $el.on(\"click\", \".issues-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadIssues();\n        });\n      });\n    };\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var colHeadElement, currentOrder, icon;\n      currentOrder = $ctrl.getUrlFilter(\"orderBy\") || \"created_date\";\n      if (currentOrder) {\n        icon = startswith(currentOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        colHeadElement.html((colHeadElement.html()) + \"<span class='icon \" + icon + \"'></span>\");\n      }\n      return $el.on(\"click\", \".row.title > div\", function(event) {\n        var finalOrder, newOrder, target;\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getUrlFilter(\"orderBy\");\n        newOrder = target.data(\"fieldname\");\n        finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        return $scope.$apply(function() {\n          $ctrl.replaceFilter(\"orderBy\", finalOrder);\n          $ctrl.storeFilters();\n          return $ctrl.loadIssues().then(function() {\n            $el.find(\".row.title > div > span.icon\").remove();\n            icon = startswith(finalOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n            return target.html((target.html()) + \"<span class='icon \" + icon + \"'></span>\");\n          });\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkOrdering($scope, $el, $attrs, $ctrl);\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssues\", [\"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", IssuesDirective]);\n\n  IssuesFiltersDirective = function($q, $log, $location, $rs, $confirm, $loading, $template, $translate, $compile, $auth) {\n    var link, template, templateSelected;\n    template = $template.get(\"issue/issues-filters.html\", true);\n    templateSelected = $template.get(\"issue/issues-filters-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, getFiltersType, initializeSelectedFilters, reloadIssues, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection, unwatchIssues;\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\".breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 .subfilter .title\").html(title);\n        return $el.find(\"h2 .subfilter .title\").prop(\"data-type\", type);\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\".breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function(filters) {\n        var j, len, name, val, values;\n        selectedFilters = [];\n        for (name in filters) {\n          values = filters[name];\n          for (j = 0, len = values.length; j < len; j++) {\n            val = values[j];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters(selectedFilters);\n      };\n      renderSelectedFilters = function(selectedFilters) {\n        var html;\n        _.filter(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        $el.find(\".filters-applied\").html(html);\n        if ($auth.isAuthenticated() && selectedFilters.length > 0) {\n          return $el.find(\".save-filters\").show();\n        } else {\n          return $el.find(\".save-filters\").hide();\n        }\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.filter(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\".subfilter .title\").prop('data-type');\n      };\n      reloadIssues = function() {\n        var currentFiltersType;\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadIssues(), $ctrl.loadFilters()]).then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(filters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var currentFiltersType, filter, filterId, filters;\n        if (type === \"myFilters\") {\n          $rs.issues.getMyFilters($scope.projectId).then(function(data) {\n            var filters, myFilters;\n            myFilters = data;\n            filters = myFilters[id];\n            filters.page = 1;\n            $ctrl.replaceAllFilters(filters);\n            $ctrl.storeFilters();\n            $ctrl.loadIssues();\n            $ctrl.markSelectedFilters($scope.filters, filters);\n            return initializeSelectedFilters($scope.filters);\n          });\n          return null;\n        }\n        filters = $scope.filters[type];\n        filterId = type === 'tags' ? taiga.toString(id) : id;\n        filter = _.find(filters, {\n          id: filterId\n        });\n        filter.selected = !filter.selected;\n        if (id === null) {\n          id = \"null\";\n        }\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $ctrl.selectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(f) {\n            return f.id === filter.id && f.type === filter.type;\n          });\n          $ctrl.unselectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        }\n        reloadIssues();\n        renderSelectedFilters(selectedFilters);\n        currentFiltersType = getFiltersType();\n        if (type === currentFiltersType) {\n          return renderFilters(_.reject(filters, \"selected\"));\n        }\n      };\n      $scope.$on(\"filters:loaded\", function(ctx, filters) {\n        return initializeSelectedFilters(filters);\n      });\n      $scope.$on(\"filters:issueupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.status\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      $scope.$on(\"filters:triggerupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.triggers\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      selectQFilter = debounceLeading(100, function(value, oldValue) {\n        if (value === void 0 || value === oldValue) {\n          return;\n        }\n        $ctrl.replaceFilter(\"page\", null, true);\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n          $ctrl.storeFilters();\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n          $ctrl.storeFilters();\n        }\n        return reloadIssues();\n      });\n      unwatchIssues = $scope.$watch(\"issues\", function(newValue) {\n        if (!_.isUndefined(newValue)) {\n          $scope.$watch(\"filtersQ\", selectQFilter);\n          return unwatchIssues();\n        }\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data(\"type\"));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories($el);\n      });\n      $el.on(\"click\", \".filters-applied a\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"active\");\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        if (type === \"myFilters\") {\n          target.removeClass(\"active\");\n        }\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter .remove-filter\", function(event) {\n        var customFilterName, message, target, title;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        customFilterName = target.parent().data('id');\n        title = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.TITLE\");\n        message = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.MESSAGE\", {\n          customFilterName: customFilterName\n        });\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var promise;\n          promise = $ctrl.deleteMyFilter(customFilterName);\n          promise.then(function() {\n            promise = $ctrl.loadMyFilters();\n            promise.then(function(filters) {\n              askResponse.finish();\n              $scope.filters.myFilters = filters;\n              return renderFilters($scope.filters.myFilters);\n            });\n            return promise.then(null, function() {\n              return askResponse.finish();\n            });\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return $confirm.notify(\"error\");\n          });\n        });\n      });\n      $el.on(\"click\", \".save-filters\", function(event) {\n        event.preventDefault();\n        renderFilters($scope.filters[\"myFilters\"]);\n        showFilters(\"My filters\", \"myFilters\");\n        $el.find('.save-filters').hide();\n        $el.find('.my-filter-name').removeClass(\"hidden\");\n        $el.find('.my-filter-name').focus();\n        return $scope.$apply();\n      });\n      return $el.on(\"keyup\", \".my-filter-name\", function(event) {\n        var currentLoading, newFilter, promise, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newFilter = target.val();\n          currentLoading = $loading().target($el.find(\".new\")).start();\n          promise = $ctrl.saveCurrentFiltersTo(newFilter);\n          promise.then(function() {\n            var loadPromise;\n            loadPromise = $ctrl.loadMyFilters();\n            loadPromise.then(function(filters) {\n              var currentfilterstype;\n              currentLoading.finish();\n              $scope.filters.myFilters = filters;\n              currentfilterstype = $el.find(\"h2 .subfilter .title\").prop('data-type');\n              if (currentfilterstype === \"myFilters\") {\n                renderFilters($scope.filters.myFilters);\n              }\n              $el.find('.my-filter-name').addClass(\"hidden\");\n              return $el.find('.save-filters').show();\n            });\n            return loadPromise.then(null, function() {\n              currentLoading.finish();\n              return $confirm.notify(\"error\", \"Error loading custom filters\");\n            });\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            $el.find(\".my-filter-name\").val(newFilter).focus().select();\n            return $confirm.notify(\"error\", \"Filter not saved\");\n          });\n        } else if (event.keyCode === 27) {\n          $el.find('.my-filter-name').val('');\n          $el.find('.my-filter-name').addClass(\"hidden\");\n          return $el.find('.save-filters').show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssuesFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", \"$compile\", \"$tgAuth\", IssuesFiltersDirective]);\n\n  IssueStatusInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the status of an Issue and a popover to change it.\n    - tg-issue-status-inline-edition: The issue\n    \n    Example:\n    \n      div.status(tg-issue-status-inline-edition=\"issue\")\n        a.issue-status(href=\"\")\n    \n    NOTE: This directive need 'issueStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueStatus;\n    selectionTemplate = $template.get(\"issue/issue-status-inline-edition-selection.html\", true);\n    updateIssueStatus = function($el, issue, issueStatusById) {\n      var issueStatusDom, issueStatusDomParent, status;\n      issueStatusDomParent = $el.find(\".issue-status\");\n      issueStatusDom = $el.find(\".issue-status .issue-status-bind\");\n      status = issueStatusById[issue.status];\n      if (status) {\n        issueStatusDom.text(status.name);\n        issueStatusDom.prop(\"title\", status.name);\n        return issueStatusDomParent.css('color', status.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueStatusInlineEdition);\n      $el.on(\"click\", \".issue-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.status;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.status) {\n            filter.count--;\n          }\n        }\n        issue.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.status;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.status) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:issueupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.issue_statuses\n        }));\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueStatusInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueStatus($el, val, $scope.issueStatusById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueStatusInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueStatusInlineEditionDirective]);\n\n  IssueTriggerInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the trigger of an Issue and a popover to change it.\n    - tg-issue-trigger-inline-edition: The issue\n    \n    Example:\n    \n      div.trigger(tg-issue-trigger-inline-edition=\"issue\")\n        a.issue-trigger(href=\"\")\n    \n    NOTE: This directive need 'triggerById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueTrigger;\n    selectionTemplate = $template.get(\"issue/issue-trigger-inline-edition-selection.html\", true);\n    updateIssueTrigger = function($el, issue, triggerById) {\n      var issueTriggerDom, issueTriggerDomParent, trigger;\n      issueTriggerDomParent = $el.find(\".issue-trigger\");\n      issueTriggerDom = $el.find(\".issue-trigger .issue-trigger-bind\");\n      trigger = triggerById[issue.trigger];\n      if (trigger) {\n        issueTriggerDom.text(trigger.name);\n        issueTriggerDom.prop(\"title\", trigger.name);\n        return issueTriggerDomParent.css('color', trigger.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueTriggerInlineEdition);\n      $el.on(\"click\", \".issue-trigger\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-trigger\").popover().open();\n      });\n      $el.on(\"click\", \".trigger\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.triggers;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.trigger) {\n            filter.count--;\n          }\n        }\n        issue.trigger = target.data(\"trigger-id\");\n        $el.find(\".pop-trigger\").popover().close();\n        updateIssueTrigger($el, issue, $scope.triggerById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.triggers;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.trigger) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:triggerupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'triggeres': project.triggers\n        }));\n        updateIssueTrigger($el, issue, $scope.triggerById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueTriggerInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueTrigger($el, val, $scope.triggerById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueTriggerInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueTriggerInlineEditionDirective]);\n\n  IssueAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue, updateIssue;\n      updateIssue = function(issue) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[issue.assigned_to];\n        if (member) {\n          ctx.name = member.full_name_display;\n          ctx.imgurl = member.photo;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".issue-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueAssignedToInlineEdition);\n      updateIssue(issue);\n      $el.on(\"click\", \".issue-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", issue);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, updatedIssue) {\n          if (updatedIssue.id === issue.id) {\n            updatedIssue.assigned_to = userId;\n            $repo.save(updatedIssue);\n            return updateIssue(updatedIssue);\n          }\n        };\n      })(this));\n      $scope.$watch($attrs.tgIssueAssignedToInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssue(val);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", IssueAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories/detail.coffee\n */\n\n(function() {\n  var UsClientRequirementButtonDirective, UsStatusButtonDirective, UsStatusDisplayDirective, UsTeamRequirementButtonDirective, UserStoryDetailController, bindMethods, bindOnce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaUserStories\");\n\n  UserStoryDetailController = (function(superClass) {\n    extend(UserStoryDetailController, superClass);\n\n    UserStoryDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function UserStoryDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.usRef = this.params.usref;\n      this.scope.sectionName = this.translate.instant(\"US.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserStoryDetailController.prototype._setMeta = function() {\n      var closedTasks, description, progressPercentage, ref, title, totalTasks;\n      totalTasks = this.scope.tasks.length;\n      closedTasks = _.filter(this.scope.tasks, (function(_this) {\n        return function(t) {\n          return _this.scope.taskStatusById[t.status].is_closed;\n        };\n      })(this)).length;\n      progressPercentage = totalTasks > 0 ? Math.round(100 * closedTasks / totalTasks) : 0;\n      title = this.translate.instant(\"US.PAGE_TITLE\", {\n        userStoryRef: \"#\" + this.scope.us.ref,\n        userStorySubject: this.scope.us.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"US.PAGE_DESCRIPTION\", {\n        userStoryStatus: ((ref = this.scope.statusById[this.scope.us.status]) != null ? ref.name : void 0) || \"--\",\n        userStoryPoints: this.scope.us.total_points,\n        userStoryDescription: angular.element(this.scope.us.description_html || \"\").text(),\n        userStoryClosedTasks: closedTasks,\n        userStoryTotalTasks: totalTasks,\n        userStoryProgressPercentage: progressPercentage\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    UserStoryDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"related-tasks:update\", (function(_this) {\n        return function() {\n          var allClosed;\n          _this.scope.tasks = _.clone(_this.scope.tasks, false);\n          allClosed = _.every(_this.scope.tasks, function(task) {\n            return task.is_closed;\n          });\n          if (_this.scope.us.is_closed !== allClosed) {\n            return _this.loadUs();\n          }\n        };\n      })(this));\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on userstory\", 1);\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadUs();\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.us.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else {\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-backlog\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-kanban\", ctx);\n      }\n    };\n\n    UserStoryDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.us_statuses;\n          _this.scope.statusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(_this.scope.pointsList, function(e) {\n            return e.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadUs = function() {\n      var httpParams, kanbanStaus, milestone, noMilestone;\n      httpParams = _.pick(this.location.search(), \"milestone\", \"no-milestone\", \"kanban-status\");\n      milestone = httpParams.milestone;\n      if (milestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: milestone,\n          order_by: \"sprint_order\"\n        });\n      }\n      noMilestone = httpParams[\"no-milestone\"];\n      if (noMilestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: \"null\",\n          order_by: \"backlog_order\"\n        });\n      }\n      kanbanStaus = httpParams[\"kanban-status\"];\n      if (kanbanStaus) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          status: kanbanStaus,\n          order_by: \"kanban_order\"\n        });\n      }\n      return this.rs.userstories.getByRef(this.scope.projectId, this.params.usref).then((function(_this) {\n        return function(us) {\n          var ctx, ref, ref1;\n          _this.scope.us = us;\n          _this.scope.usId = us.id;\n          _this.scope.commentModel = us;\n          if (((ref = _this.scope.us.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.us.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          return us;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadSprint = function() {\n      if (this.scope.us.milestone) {\n        return this.rs.sprints.get(this.scope.us.project, this.scope.us.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    UserStoryDetailController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, null, this.scope.usId).then((function(_this) {\n        return function(tasks) {\n          _this.scope.tasks = tasks;\n          return tasks;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadUs().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadTasks()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    UserStoryDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.upvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.downvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    UserStoryDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.watch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.unwatch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    return UserStoryDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserStoryDetailController\", UserStoryDetailController);\n\n  UsStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(us) {\n        var html, status;\n        status = $scope.statusById[us.status];\n        html = template({\n          is_closed: us.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us != null) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusDisplay\", [\"$tgTemplate\", \"$compile\", UsStatusDisplayDirective]);\n\n  UsStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template) {\n    var link, template;\n    template = $template.get(\"us/us-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = (function(_this) {\n        return function(us) {\n          var html, status;\n          status = $scope.statusById[us.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, us;\n          us = $model.$modelValue.clone();\n          us.status = status;\n          $.fn.popover().closeAll();\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(us);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return $repo.save(us).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var status, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        status = target.data(\"status-id\");\n        return save(status);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", UsStatusButtonDirective]);\n\n  UsTeamRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-team-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.team_requirement\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(team_requirement) {\n          var currentLoading, promise, us;\n          us = $model.$modelValue.clone();\n          us.team_requirement = team_requirement;\n          currentLoading = $loading().target($el.find(\"label\")).start();\n          promise = $tgrepo.save(us);\n          promise.then(function() {\n            $model.$setViewValue(us);\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".team-requirement\", function(event) {\n        var team_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        team_requirement = !$model.$modelValue.team_requirement;\n        return save(team_requirement);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsTeamRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsTeamRequirementButtonDirective]);\n\n  UsClientRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-client-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.client_requirement\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(client_requirement) {\n          var currentLoading, promise, us;\n          us = $model.$modelValue.clone();\n          us.client_requirement = client_requirement;\n          currentLoading = $loading().target($el.find(\"label\")).start();\n          promise = $tgrepo.save(us);\n          promise.then(function() {\n            $model.$setViewValue(us);\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".client-requirement\", function(event) {\n        var client_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        client_requirement = !$model.$modelValue.client_requirement;\n        return save(client_requirement);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsClientRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsClientRequirementButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks/detail.coffee\n */\n\n(function() {\n  var TaskDetailController, TaskIsIocaineButtonDirective, TaskStatusButtonDirective, TaskStatusDisplayDirective, bindMethods, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTasks\");\n\n  TaskDetailController = (function(superClass) {\n    extend(TaskDetailController, superClass);\n\n    TaskDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.taskRef = this.params.taskref;\n      this.scope.sectionName = this.translate.instant(\"TASK.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"TASK.PAGE_TITLE\", {\n        taskRef: \"#\" + this.scope.task.ref,\n        taskSubject: this.scope.task.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"TASK.PAGE_DESCRIPTION\", {\n        taskStatus: ((ref = this.scope.statusById[this.scope.task.status]) != null ? ref.name : void 0) || \"--\",\n        taskDescription: angular.element(this.scope.task.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on task\", 1);\n        };\n      })(this));\n      this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadTask();\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.task.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else if (this.scope.task.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        if (this.scope.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      }\n    };\n\n    TaskDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.task_statuses;\n          _this.scope.statusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadTask = function() {\n      return this.rs.tasks.getByRef(this.scope.projectId, this.params.taskref).then((function(_this) {\n        return function(task) {\n          var ctx, ref, ref1;\n          _this.scope.task = task;\n          _this.scope.taskId = task.id;\n          _this.scope.commentModel = task;\n          if (((ref = _this.scope.task.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.task.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          return task;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadSprint = function() {\n      if (this.scope.task.milestone) {\n        return this.rs.sprints.get(this.scope.task.project, this.scope.task.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadUserStory = function() {\n      if (this.scope.task.user_story) {\n        return this.rs.userstories.get(this.scope.task.project, this.scope.task.user_story).then((function(_this) {\n          return function(us) {\n            _this.scope.us = us;\n            return us;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadTask().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadUserStory()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    TaskDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.upvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.downvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    TaskDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.watch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    return TaskDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskDetailController\", TaskDetailController);\n\n  TaskStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(task) {\n        var html, status;\n        status = $scope.statusById[task.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task != null) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusDisplay\", [\"$tgTemplate\", \"$compile\", TaskStatusDisplayDirective]);\n\n  TaskStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"us/us-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = (function(_this) {\n        return function(task) {\n          var html, status;\n          status = $scope.statusById[task.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, task;\n          task = $model.$modelValue.clone();\n          task.status = status;\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(task);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return $repo.save(task).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$compile\", \"$translate\", \"$tgTemplate\", TaskStatusButtonDirective]);\n\n  TaskIsIocaineButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $compile, $template) {\n    var link, template;\n    template = $template.get(\"issue/iocaine-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = function(task) {\n        var ctx, html;\n        if (!isEditable() && !task.is_iocaine) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          isIocaine: task.is_iocaine,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(is_iocaine) {\n          var currentLoading, promise, task;\n          task = $model.$modelValue.clone();\n          task.is_iocaine = is_iocaine;\n          currentLoading = $loading().target($el.find('label')).start();\n          promise = $tgrepo.save(task);\n          promise.then(function() {\n            $model.$setViewValue(task);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          return promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".is-iocaine\", function(event) {\n        var is_iocaine;\n        if (!isEditable()) {\n          return;\n        }\n        is_iocaine = !$model.$modelValue.is_iocaine;\n        return save(is_iocaine);\n      });\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskIsIocaineButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$compile\", \"$tgTemplate\", TaskIsIocaineButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team/main.coffee\n */\n\n(function() {\n  var LeaveProjectDirective, TeamController, TeamFiltersDirective, TeamMemberCurrentUserDirective, TeamMemberStatsDirective, TeamMembersDirective, membersFilter, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaTeam\");\n\n  TeamController = (function(superClass) {\n    extend(TeamController, superClass);\n\n    TeamController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$location\", \"$tgNavUrls\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function TeamController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, auth, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.scope.sectionName = \"TEAM.SECTION_NAME\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"TEAM.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"TEAM.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TeamController.prototype.setRole = function(role) {\n      if (role) {\n        return this.scope.filtersRole = role;\n      } else {\n        return this.scope.filtersRole = null;\n      }\n    };\n\n    TeamController.prototype.loadMembers = function() {\n      var i, len, member, ref, user;\n      user = this.auth.getUser();\n      this.scope.totals = {};\n      ref = this.scope.activeUsers;\n      for (i = 0, len = ref.length; i < len; i++) {\n        member = ref[i];\n        this.scope.totals[member.id] = 0;\n      }\n      this.scope.currentUser = _.find(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n      return this.scope.memberships = _.reject(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n    };\n\n    TeamController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issuesEnabled = project.is_issues_activated;\n          _this.scope.tasksEnabled = project.is_kanban_activated || project.is_backlog_activated;\n          _this.scope.wikiEnabled = project.is_wiki_activated;\n          _this.scope.owner = project.owner.id;\n          return project;\n        };\n      })(this));\n    };\n\n    TeamController.prototype.loadMemberStats = function() {\n      return this.rs.projects.memberStats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totals;\n          totals = {};\n          _.forEach(_this.scope.totals, function(total, userId) {\n            var vals;\n            vals = _.map(stats, function(memberStats, statsKey) {\n              return memberStats[userId];\n            });\n            total = _.reduce(vals, function(sum, el) {\n              return sum + el;\n            });\n            return _this.scope.totals[userId] = total;\n          });\n          _this.scope.stats = _this._processStats(stats);\n          return _this.scope.stats.totals = _this.scope.totals;\n        };\n      })(this));\n    };\n\n    TeamController.prototype._processStat = function(stat) {\n      var key, max, min, singleStat, value;\n      max = _.max(_.toArray(stat));\n      min = _.min(_.toArray(stat));\n      singleStat = Object();\n      for (key in stat) {\n        if (!hasProp.call(stat, key)) continue;\n        value = stat[key];\n        if (value === min) {\n          singleStat[key] = 0.1;\n        } else if (value === max) {\n          singleStat[key] = 1;\n        } else {\n          singleStat[key] = (value * 0.5) / max;\n        }\n      }\n      return singleStat;\n    };\n\n    TeamController.prototype._processStats = function(stats) {\n      var key, value;\n      for (key in stats) {\n        value = stats[key];\n        stats[key] = this._processStat(value);\n      }\n      return stats;\n    };\n\n    TeamController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          var userRoles;\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.loadMembers();\n          userRoles = _.map(_this.scope.users, function(user) {\n            return user.role;\n          });\n          _this.scope.roles = _.filter(_this.scope.roles, function(role) {\n            return userRoles.indexOf(role.id) !== -1;\n          });\n          return _this.loadMemberStats();\n        };\n      })(this));\n    };\n\n    return TeamController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TeamController\", TeamController);\n\n  TeamFiltersDirective = function() {\n    return {\n      templateUrl: \"team/team-filter.html\"\n    };\n  };\n\n  module.directive(\"tgTeamFilters\", [TeamFiltersDirective]);\n\n  TeamMemberStatsDirective = function() {\n    return {\n      templateUrl: \"team/team-member-stats.html\",\n      scope: {\n        stats: \"=\",\n        userId: \"=user\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMemberStats\", TeamMemberStatsDirective);\n\n  TeamMemberCurrentUserDirective = function() {\n    return {\n      templateUrl: \"team/team-member-current-user.html\",\n      scope: {\n        project: \"=project\",\n        currentUser: \"=currentuser\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamCurrentUser\", TeamMemberCurrentUserDirective);\n\n  TeamMembersDirective = function() {\n    var template;\n    template = \"team/team-members.html\";\n    return {\n      templateUrl: template,\n      scope: {\n        memberships: \"=\",\n        filtersQ: \"=filtersq\",\n        filtersRole: \"=filtersrole\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMembers\", TeamMembersDirective);\n\n  LeaveProjectDirective = function($repo, $confirm, $location, $rs, $navurls, $translate, lightboxFactory, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var leaveConfirm;\n      leaveConfirm = function() {\n        var confirm_leave_project_text, leave_project_text;\n        leave_project_text = $translate.instant(\"TEAM.ACTION_LEAVE_PROJECT\");\n        confirm_leave_project_text = $translate.instant(\"TEAM.CONFIRM_LEAVE_PROJECT\");\n        return $confirm.ask(leave_project_text, confirm_leave_project_text).then((function(_this) {\n          return function(response) {\n            var promise;\n            promise = $rs.projects.leave($scope.project.id);\n            promise.then(function() {\n              return currentUserService.loadProjects().then(function() {\n                response.finish();\n                $confirm.notify(\"success\");\n                return $location.path($navurls.resolve(\"home\"));\n              });\n            });\n            return promise.then(null, function(response) {\n              response.finish();\n              return $confirm.notify('error', response.data._error_message);\n            });\n          };\n        })(this));\n      };\n      return $scope.leave = function() {\n        if ($scope.project.owner.id === $scope.user.id) {\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: true,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      };\n    };\n    return {\n      scope: {\n        user: \"=\",\n        project: \"=\"\n      },\n      templateUrl: \"team/leave-project.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLeaveProject\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgResources\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", LeaveProjectDirective]);\n\n  membersFilter = function() {\n    return function(members, filtersQ, filtersRole) {\n      return _.filter(members, function(m) {\n        return (!filtersRole || m.role === filtersRole.id) && (!filtersQ || m.full_name.search(new RegExp(filtersQ, \"i\")) >= 0);\n      });\n    };\n  };\n\n  module.filter('membersFilter', membersFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var EditableWikiContentDirective, WikiDetailController, WikiSummaryDirective, bindOnce, debounce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiDetailController = (function(superClass) {\n    extend(WikiDetailController, superClass);\n\n    WikiDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$filter\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function WikiDetailController(scope, rootscope, repo, model, confirm, rs, params, q, location, filter, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.filter = filter;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.wikiTitle = this.scope.wikiSlug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, title;\n      title = this.translate.instant(\"WIKI.PAGE_TITLE\", {\n        wikiPageName: this.scope.wikiTitle,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"WIKI.PAGE_DESCRIPTION\", {\n        wikiPageContent: angular.element(((ref = this.scope.wiki) != null ? ref.html : void 0) || \"\").text(),\n        totalEditions: ((ref1 = this.scope.wiki) != null ? ref1.editions : void 0) || 0,\n        lastModifiedDate: moment((ref2 = this.scope.wiki) != null ? ref2.modified_date : void 0).format(this.translate.instant(\"WIKI.DATETIME\"))\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    WikiDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_wiki_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWiki = function() {\n      var promise;\n      promise = this.rs.wiki.getBySlug(this.scope.projectId, this.params.slug);\n      promise.then((function(_this) {\n        return function(wiki) {\n          _this.scope.wiki = wiki;\n          _this.scope.wikiId = wiki.id;\n          return _this.scope.wiki;\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function(xhr) {\n          var data;\n          _this.scope.wikiId = null;\n          if (_this.scope.project.my_permissions.indexOf(\"add_wiki_page\") === -1) {\n            return null;\n          }\n          data = {\n            project: _this.scope.projectId,\n            slug: _this.scope.wikiSlug,\n            content: \"\"\n          };\n          _this.scope.wiki = _this.model.make_model(\"wiki\", data);\n          return _this.scope.wiki;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n          if (selectedWikiLink != null) {\n            return _this.scope.wikiTitle = selectedWikiLink.title;\n          }\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.q.all([_this.loadWikiLinks(), _this.loadWiki()]).then(_this.checkLinksPerms.bind(_this));\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"modify_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    WikiDetailController.prototype[\"delete\"] = function() {\n      var message, title;\n      title = this.translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n      message = this.scope.wikiTitle;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var ctx;\n            askResponse.finish();\n            ctx = {\n              project: _this.scope.projectSlug\n            };\n            _this.location.path(_this.navUrls.resolve(\"project-wiki\", ctx));\n            return _this.confirm.notify(\"success\");\n          };\n          onError = function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          };\n          return _this.repo.remove(_this.scope.wiki).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    return WikiDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiDetailController\", WikiDetailController);\n\n  WikiSummaryDirective = function($log, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-summary.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var render;\n      render = function(wiki) {\n        var ctx, html, user;\n        if ($scope.usersById == null) {\n          $log.error(\"WikiSummaryDirective requires userById set in scope.\");\n        } else {\n          user = $scope.usersById[wiki.last_modifier];\n        }\n        if (user === void 0) {\n          user = {\n            name: \"unknown\",\n            imgUrl: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n        } else {\n          user = {\n            name: user.full_name_display,\n            imgUrl: user.photo\n          };\n        }\n        ctx = {\n          totalEditions: wiki.editions,\n          lastModifiedDate: moment(wiki.modified_date).format($translate.instant(\"WIKI.DATETIME\")),\n          user: user\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        return render(wikiPage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWikiSummary\", [\"$log\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiSummaryDirective]);\n\n  EditableWikiContentDirective = function($window, $document, $repo, $confirm, $loading, $analytics, $qqueue) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, disableEdition, getSelectedText, isEditable, save, switchToEditMode, switchToReadMode;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_wiki_page\") !== -1;\n      };\n      switchToEditMode = function() {\n        $el.find('.edit-wiki-content').show();\n        $el.find('.view-wiki-content').hide();\n        return $el.find('textarea').focus();\n      };\n      switchToReadMode = function() {\n        $el.find('.edit-wiki-content').hide();\n        return $el.find('.view-wiki-content').show();\n      };\n      disableEdition = function() {\n        $el.find(\".view-wiki-content .edit\").remove();\n        return $el.find(\".edit-wiki-content\").remove();\n      };\n      cancelEdition = function() {\n        if (!$model.$modelValue.id) {\n          return;\n        }\n        $scope.$apply((function(_this) {\n          return function() {\n            return $model.$modelValue.revert();\n          };\n        })(this));\n        return switchToReadMode();\n      };\n      getSelectedText = function() {\n        if ($window.getSelection) {\n          return $window.getSelection().toString();\n        } else if ($document.selection) {\n          return $document.selection.createRange().text;\n        }\n        return null;\n      };\n      save = $qqueue.bindAdd(function(wiki) {\n        var currentLoading, onError, onSuccess, promise;\n        onSuccess = function(wikiPage) {\n          if (wiki.id == null) {\n            $analytics.trackEvent(\"wikipage\", \"create\", \"create wiki page\", 1);\n          }\n          $model.$setViewValue(wikiPage.clone());\n          $confirm.notify(\"success\");\n          return switchToReadMode();\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        currentLoading = $loading().removeClasses(\"icon-floppy\").target($el.find('.icon-floppy')).start();\n        if (wiki.id != null) {\n          promise = $repo.save(wiki).then(onSuccess, onError);\n        } else {\n          promise = $repo.create(\"wiki\", wiki).then(onSuccess, onError);\n        }\n        return promise[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"mousedown\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (event.button === 2) {\n\n        }\n      });\n      $el.on(\"mouseup\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (getSelectedText()) {\n          return;\n        }\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if (target.is('pre')) {\n          return;\n        }\n        return switchToEditMode();\n      });\n      $el.on(\"click\", \".save\", debounce(2000, function() {\n        return save($scope.wiki);\n      }));\n      $el.on(\"click\", \".cancel\", function() {\n        return cancelEdition();\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode === 27) {\n          return cancelEdition();\n        }\n      });\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        if (isEditable()) {\n          $el.addClass('editable');\n          if ((wikiPage.id == null) || $.trim(wikiPage.content).length === 0) {\n            return switchToEditMode();\n          }\n        } else {\n          return disableEdition();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      templateUrl: \"wiki/editable-wiki-content.html\"\n    };\n  };\n\n  module.directive(\"tgEditableWikiContent\", [\"$window\", \"$document\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", \"$tgQqueue\", EditableWikiContentDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiNavDirective, bindOnce, groupBy, mixOf, module, taiga;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiNavDirective = function($tgrepo, $log, $location, $confirm, $navUrls, $analytics, $loading, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-nav.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render;\n      $ctrl = $el.controller();\n      if ($attrs.ngModel == null) {\n        return $log.error(\"WikiNavDirective: no ng-model attr is defined\");\n      }\n      render = function(wikiLinks) {\n        var addWikiLinkPermission, deleteWikiLinkPermission, html;\n        addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n        deleteWikiLinkPermission = $scope.project.my_permissions.indexOf(\"delete_wiki_link\") > -1;\n        html = template({\n          wikiLinks: wikiLinks,\n          projectSlug: $scope.projectSlug,\n          addWikiLinkPermission: addWikiLinkPermission,\n          deleteWikiLinkPermission: deleteWikiLinkPermission\n        });\n        html = $compile(html)($scope);\n        $el.off();\n        $el.html(html);\n        $el.on(\"click\", \".wiki-link .link-title\", function(event) {\n          var linkId, linkSlug, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          linkSlug = $scope.wikiLinks[linkId].href;\n          return $scope.$apply(function() {\n            var ctx;\n            ctx = {\n              project: $scope.projectSlug,\n              slug: linkSlug\n            };\n            return $location.path($navUrls.resolve(\"project-wiki-page\", ctx));\n          });\n        });\n        $el.on(\"click\", \".add-button\", function(event) {\n          event.preventDefault();\n          $el.find(\".new\").removeClass(\"hidden\");\n          $el.find(\".new input\").focus();\n          return $el.find(\".add-button\").hide();\n        });\n        $el.on(\"click\", \".wiki-link .icon-delete\", function(event) {\n          var linkId, message, target, title;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          title = $translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n          message = $scope.wikiLinks[linkId].title;\n          return $confirm.askOnDelete(title, message).then((function(_this) {\n            return function(askResponse) {\n              var promise;\n              promise = $tgrepo.remove($scope.wikiLinks[linkId]);\n              promise.then(function() {\n                promise = $ctrl.loadWikiLinks();\n                promise.then(function() {\n                  askResponse.finish();\n                  return render($scope.wikiLinks);\n                });\n                return promise.then(null, function() {\n                  return askResponse.finish();\n                });\n              });\n              return promise.then(null, function() {\n                askResponse.finish(false);\n                return $confirm.notify(\"error\");\n              });\n            };\n          })(this));\n        });\n        return $el.on(\"keyup\", \".new input\", function(event) {\n          var currentLoading, newLink, promise, target;\n          event.preventDefault();\n          if (event.keyCode === 13) {\n            target = angular.element(event.currentTarget);\n            newLink = target.val();\n            currentLoading = $loading().target($el.find(\".new\")).start();\n            promise = $tgrepo.create(\"wiki-links\", {\n              project: $scope.projectId,\n              title: newLink\n            });\n            promise.then(function() {\n              var loadPromise;\n              $analytics.trackEvent(\"wikilink\", \"create\", \"create wiki link\", 1);\n              loadPromise = $ctrl.loadWikiLinks();\n              loadPromise.then(function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return render($scope.wikiLinks);\n              });\n              return loadPromise.then(null, function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return $confirm.notify(\"error\", \"Error loading wiki links\");\n              });\n            });\n            return promise.then(null, function(error) {\n              var ref;\n              currentLoading.finish();\n              $el.find(\".new input\").val(newLink);\n              $el.find(\".new input\").focus().select();\n              if ((error != null ? (ref = error.__all__) != null ? ref[0] : void 0 : void 0) != null) {\n                return $confirm.notify(\"error\", \"The link already exists\");\n              } else {\n                return $confirm.notify(\"error\");\n              }\n            });\n          } else if (event.keyCode === 27) {\n            target = angular.element(event.currentTarget);\n            $el.find(\".new\").addClass(\"hidden\");\n            $el.find(\".new input\").val('');\n            return $el.find(\".add-button\").show();\n          }\n        });\n      };\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiNav\", [\"$tgRepo\", \"$log\", \"$tgLocation\", \"$tgConfirm\", \"$tgNavUrls\", \"$tgAnalytics\", \"$tgLoading\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiNavDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/lightboxes.coffee\n */\n\n(function() {\n  var ChangeOwnerLightboxController, ChangeOwnerLightboxDirective, LbRequestOwnershipDirective, LightboxAddMembersController, LightboxAddMembersDirective, LightboxAddMembersWarningMessageDirective, TransferProjectStartSuccessDirective, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaKanban\");\n\n  LightboxAddMembersController = (function() {\n    LightboxAddMembersController.$inject = [\"$scope\", \"lightboxService\", \"tgLoader\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\"];\n\n    function LightboxAddMembersController(scope1, lightboxService1, tgLoader, confirm, rs1, rootScope) {\n      var pendingMembersCount;\n      this.scope = scope1;\n      this.lightboxService = lightboxService1;\n      this.tgLoader = tgLoader;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rootScope = rootScope;\n      this._defaultMaxInvites = 4;\n      this._defaultRole = this.project.roles[0].id;\n      this.form = null;\n      this.submitInvites = false;\n      this.canAddUsers = true;\n      this.memberInvites = [];\n      if (this.project.max_memberships === null) {\n        this.membersLimit = this._defaultMaxInvites;\n      } else {\n        pendingMembersCount = Math.max(this.project.max_memberships - this.project.total_memberships, 0);\n        this.membersLimit = Math.min(pendingMembersCount, this._defaultMaxInvites);\n      }\n      this.addSingleMember();\n    }\n\n    LightboxAddMembersController.prototype.addSingleMember = function() {\n      this.memberInvites.push({\n        email: '',\n        role_id: this._defaultRole\n      });\n      if (this.memberInvites.length >= this.membersLimit) {\n        this.canAddUsers = false;\n      }\n      return this.showWarningMessage = !this.canAddUsers && this.project.total_memberships + this.memberInvites.length === this.project.max_memberships;\n    };\n\n    LightboxAddMembersController.prototype.removeSingleMember = function(index) {\n      this.memberInvites.splice(index, 1);\n      this.canAddUsers = true;\n      return this.showWarningMessage = this.membersLimit === 1;\n    };\n\n    LightboxAddMembersController.prototype.submit = function() {\n      var promise;\n      this.form.initializeFields();\n      this.form.reset();\n      if (!this.form.validate()) {\n        return;\n      }\n      this.memberInvites = _.filter(this.memberInvites, function(invites) {\n        return invites.email !== \"\";\n      });\n      this.submitInvites = true;\n      promise = this.rs.memberships.bulkCreateMemberships(this.project.id, this.memberInvites, this.invitationText);\n      return promise.then(this._onSuccessInvite.bind(this), this._onErrorInvite.bind(this));\n    };\n\n    LightboxAddMembersController.prototype._onSuccessInvite = function() {\n      this.submitInvites = false;\n      this.rootScope.$broadcast(\"membersform:new:success\");\n      this.lightboxService.closeAll();\n      return this.confirm.notify(\"success\");\n    };\n\n    LightboxAddMembersController.prototype._onErrorInvite = function(response) {\n      this.submitInvites = false;\n      this.form.setErrors(response.data);\n      if (response.data._error_message) {\n        return this.confirm.notify(\"error\", response.data._error_message);\n      }\n    };\n\n    return LightboxAddMembersController;\n\n  })();\n\n  module.controller(\"LbAddMembersController\", LightboxAddMembersController);\n\n  LightboxAddMembersDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      lightboxService.open(el);\n      return ctrl.form = el.find(\"form\").checksley();\n    };\n    return {\n      scope: {},\n      bindToController: {\n        project: '='\n      },\n      controller: 'LbAddMembersController',\n      controllerAs: 'vm',\n      templateUrl: 'admin/lightbox-add-members.html',\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAddMembers\", [\"lightboxService\", LightboxAddMembersDirective]);\n\n  LightboxAddMembersWarningMessageDirective = function() {\n    return {\n      templateUrl: \"admin/lightbox-add-members-no-more=memberships-warning-message.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgLightboxAddMembersWarningMessage\", [LightboxAddMembersWarningMessageDirective]);\n\n  LbRequestOwnershipDirective = function(lightboxService, rs, confirmService, $translate) {\n    return {\n      link: function(scope, el) {\n        lightboxService.open(el);\n        return scope.request = function() {\n          scope.loading = true;\n          return rs.projects.transferRequest(scope.projectId).then(function() {\n            scope.loading = false;\n            lightboxService.close(el);\n            return confirmService.notify(\"success\", $translate.instant(\"ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS\"));\n          });\n        };\n      },\n      templateUrl: \"common/lightbox/lightbox-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgLbRequestOwnership', [\"lightboxService\", \"tgResources\", \"$tgConfirm\", \"$translate\", LbRequestOwnershipDirective]);\n\n  ChangeOwnerLightboxController = (function() {\n    function ChangeOwnerLightboxController(rs1, lightboxService1, confirm, translate) {\n      this.rs = rs1;\n      this.lightboxService = lightboxService1;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.users = [];\n      this.q = \"\";\n      this.commentOpen = false;\n    }\n\n    ChangeOwnerLightboxController.prototype.limit = 3;\n\n    ChangeOwnerLightboxController.prototype.normalizeString = function(normalizedString) {\n      normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n      normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n      normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n      normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n      normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n      return normalizedString;\n    };\n\n    ChangeOwnerLightboxController.prototype.filterUsers = function(user) {\n      var text, username;\n      username = user.full_name_display.toUpperCase();\n      username = this.normalizeString(username);\n      text = this.q.toUpperCase();\n      text = this.normalizeString(text);\n      return _.includes(username, text);\n    };\n\n    ChangeOwnerLightboxController.prototype.getUsers = function() {\n      var users;\n      if (!this.users.length && !this.q.length) {\n        users = this.activeUsers;\n      } else {\n        users = this.users;\n      }\n      users = users.slice(0, this.limit);\n      users = _.reject(users, {\n        \"selected\": true\n      });\n      return _.reject(users, {\n        \"id\": this.currentOwnerId\n      });\n    };\n\n    ChangeOwnerLightboxController.prototype.userSearch = function() {\n      this.users = this.activeUsers;\n      this.selected = _.find(this.users, {\n        \"selected\": true\n      });\n      if (this.q) {\n        return this.users = _.filter(this.users, this.filterUsers.bind(this));\n      }\n    };\n\n    ChangeOwnerLightboxController.prototype.selectUser = function(user) {\n      this.activeUsers = _.map(this.activeUsers, function(user) {\n        user.selected = false;\n        return user;\n      });\n      user.selected = true;\n      return this.userSearch();\n    };\n\n    ChangeOwnerLightboxController.prototype.submit = function() {\n      this.loading = true;\n      return this.rs.projects.transferStart(this.projectId, this.selected.id, this.comment).then((function(_this) {\n        return function() {\n          var desc, title;\n          _this.loading = false;\n          _this.lightboxService.closeAll();\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE\");\n          desc = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC\");\n          return _this.confirm.success(title, desc, {\n            type: \"svg\",\n            name: \"icon-speak-up\"\n          });\n        };\n      })(this));\n    };\n\n    return ChangeOwnerLightboxController;\n\n  })();\n\n  ChangeOwnerLightboxController.$inject = [\"tgResources\", \"lightboxService\", \"$tgConfirm\", \"$translate\"];\n\n  module.controller('ChangeOwnerLightbox', ChangeOwnerLightboxController);\n\n  ChangeOwnerLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function(scope, el) {\n      return lightboxService.open(el);\n    };\n    return {\n      scope: true,\n      controller: \"ChangeOwnerLightbox\",\n      controllerAs: \"vm\",\n      bindToController: {\n        currentOwnerId: \"=\",\n        projectId: \"=\",\n        activeUsers: \"=\"\n      },\n      templateUrl: \"common/lightbox/lightbox-change-owner.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbChangeOwner\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", ChangeOwnerLightboxDirective]);\n\n  TransferProjectStartSuccessDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el) {\n      scope.close = function() {\n        return lightboxService.close(el);\n      };\n      return lightboxService.open(el);\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-transfer-project-start-success.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbTransferProjectStartSuccess\", [\"lightboxService\", TransferProjectStartSuccessDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var MembershipsController, MembershipsDirective, MembershipsRowActionsDirective, MembershipsRowAdminCheckboxDirective, MembershipsRowAvatarDirective, MembershipsRowRoleSelectorDirective, NoMoreMembershipsExplanationDirective, bindMethods, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  MembershipsController = (function(superClass) {\n    extend(MembershipsController, superClass);\n\n    MembershipsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAnalytics\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgLightboxFactory\"];\n\n    function MembershipsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, analytics, appMetaService, translate, auth, lightboxFactory1) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.auth = auth;\n      this.lightboxFactory = lightboxFactory1;\n      bindMethods(this);\n      this.scope.project = {};\n      this.scope.filters = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.MEMBERSHIPS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"membersform:new:success\", (function(_this) {\n        return function() {\n          _this.loadInitialData();\n          return _this.analytics.trackEvent(\"membership\", \"create\", \"create memberships on admin\", 1);\n        };\n      })(this));\n    }\n\n    MembershipsController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.canAddUsers = project.max_memberships === null || project.max_memberships > project.total_memberships;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadMembers = function() {\n      var httpFilters;\n      httpFilters = this.getUrlFilters();\n      return this.rs.memberships.list(this.scope.projectId, httpFilters).then((function(_this) {\n        return function(data) {\n          _this.scope.memberships = _.filter(data.models, function(membership) {\n            return membership.user === null || membership.is_user_active;\n          });\n          _this.scope.page = data.current;\n          _this.scope.count = data.count;\n          _this.scope.paginatedBy = data.paginatedBy;\n          return data;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function() {\n          return _this.q.all([_this.loadMembers(), _this.auth.refresh()]);\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    MembershipsController.prototype.addNewMembers = function() {\n      return this.lightboxFactory.create('tg-lb-add-members', {\n        \"class\": \"lightbox lightbox-add-member\",\n        \"project\": \"project\"\n      }, {\n        \"project\": this.scope.project\n      });\n    };\n\n    MembershipsController.prototype.showLimitUsersWarningMessage = function() {\n      var icon, message, title;\n      title = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING\");\n      message = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE\", {\n        members: this.scope.project.max_memberships\n      });\n      icon = \"/\" + window._version + \"/svg/icons/team-question.svg\";\n      return this.confirm.success(title, message, {\n        name: icon,\n        type: \"img\"\n      });\n    };\n\n    return MembershipsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"MembershipsController\", MembershipsController);\n\n  MembershipsDirective = function($template, $compile) {\n    var link, linkPagination, template;\n    template = $template.get(\"admin/admin-membership-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".memberships-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        $pagEl.html(html);\n        return $pagEl.show();\n      };\n      $scope.$watch(\"memberships\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".memberships-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      $el.on(\"click\", \".memberships-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      return $el.on(\"click\", \".memberships-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadMembers();\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMemberships\", [\"$tgTemplate\", \"$compile\", MembershipsDirective]);\n\n  MembershipsRowAvatarDirective = function($log, $template, $translate) {\n    var link, template;\n    template = $template.get(\"admin/memberships-row-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      var member, pending, render;\n      pending = $translate.instant(\"ADMIN.MEMBERSHIP.STATUS_PENDING\");\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          full_name: member.full_name ? member.full_name : \"\",\n          email: member.user_email ? member.user_email : member.email,\n          imgurl: member.photo ? member.photo : \"/\" + window._version + \"/images/unnamed.png\",\n          pending: !member.is_user_active ? pending : \"\",\n          isOwner: member.is_owner\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAvatar == null) {\n        return $log.error(\"MembershipsRowAvatarDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAvatar);\n      render(member);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAvatar\", [\"$log\", \"$tgTemplate\", '$translate', MembershipsRowAvatarDirective]);\n\n  MembershipsRowAdminCheckboxDirective = function($log, $repo, $confirm, $template, $compile) {\n    var link, template;\n    template = $template.get(\"admin/admin-memberships-row-checkbox.html\", true);\n    link = function($scope, $el, $attrs) {\n      var html, member, render;\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      if ($attrs.tgMembershipsRowAdminCheckbox == null) {\n        return $log.error(\"MembershipsRowAdminCheckboxDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAdminCheckbox);\n      if (member.is_owner) {\n        $el.find(\".js-check\").remove();\n        return;\n      }\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          inputId: \"is-admin-\" + member.id\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \":checkbox\", (function(_this) {\n        return function(event) {\n          var onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function(data) {\n            member.revert();\n            $el.find(\":checkbox\").prop(\"checked\", member.is_admin);\n            return $confirm.notify(\"error\", data.is_admin[0]);\n          };\n          target = angular.element(event.currentTarget);\n          member.is_admin = target.prop(\"checked\");\n          return $repo.save(member).then(onSuccess, onError);\n        };\n      })(this));\n      html = render(member);\n      if (member.is_admin) {\n        return $el.find(\":checkbox\").prop(\"checked\", true);\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAdminCheckbox\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", MembershipsRowAdminCheckboxDirective]);\n\n  MembershipsRowRoleSelectorDirective = function($log, $repo, $confirm) {\n    var link, template;\n    template = _.template(\"<select>\\n    <% _.each(roleList, function(role) { %>\\n    <option value=\\\"<%- role.id %>\\\" <% if(selectedRole === role.id){ %>selected=\\\"selected\\\"<% } %>>\\n        <%- role.name %>\\n    </option>\\n    <% }); %>\\n</select>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          roleList: $scope.project.roles,\n          selectedRole: member.role\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowRoleSelector == null) {\n        return $log.error(\"MembershipsRowRoleSelectorDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowRoleSelector);\n      html = render(member);\n      $el.on(\"change\", \"select\", (function(_this) {\n        return function(event) {\n          var newRole, onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          target = angular.element(event.currentTarget);\n          newRole = parseInt(target.val(), 10);\n          if (member.role !== newRole) {\n            member.role = newRole;\n            return $repo.save(member).then(onSuccess, onError);\n          }\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowRoleSelector\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", MembershipsRowRoleSelectorDirective]);\n\n  MembershipsRowActionsDirective = function($log, $repo, $rs, $confirm, $compile, $translate, $location, $navUrls, lightboxFactory) {\n    var activedTemplate, link, pendingTemplate;\n    activedTemplate = \"<div class=\\\"active\\\"\\n     translate=\\\"ADMIN.MEMBERSHIP.STATUS_ACTIVE\\\">\\n</div>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <svg class=\\\"icon icon-trash\\\">\\n        <use xlink:href=\\\"#icon-trash\\\">\\n    </svg>\\n</a>\";\n    pendingTemplate = \"<a class=\\\"resend js-resend\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.RESEND' | translate }}\\\"\\n   translate=\\\"ADMIN.MEMBERSHIP.RESEND\\\">\\n</a>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <svg class=\\\"icon icon-trash\\\">\\n        <use xlink:href=\\\"#icon-trash\\\">\\n    </svg>\\n</a>\";\n    link = function($scope, $el, $attrs) {\n      var $ctrl, leaveConfirm, member, render;\n      render = function(member) {\n        var html;\n        if (member.user) {\n          html = $compile(activedTemplate)($scope);\n        } else {\n          html = $compile(pendingTemplate)($scope);\n        }\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowActions == null) {\n        return $log.error(\"MembershipsRowActionsDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowActions);\n      render(member);\n      $el.on(\"click\", \".js-resend\", function(event) {\n        var onError, onSuccess;\n        event.preventDefault();\n        onSuccess = function() {\n          var text;\n          text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION\", {\n            email: $scope.member.email\n          });\n          return $confirm.notify(\"success\", text);\n        };\n        onError = function() {\n          var text;\n          text = $translate.instant(\"ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION\");\n          return $confirm.notify(\"error\", text);\n        };\n        return $rs.memberships.resendInvitation($scope.member.id).then(onSuccess, onError);\n      });\n      leaveConfirm = function() {\n        var defaultMsg, message, title;\n        title = $translate.instant(\"ADMIN.MEMBERSHIP.DELETE_MEMBER\");\n        defaultMsg = $translate.instant(\"ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE\", {\n          email: member.email\n        });\n        message = member.user ? member.full_name : defaultMsg;\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish();\n              if (member.user !== $scope.user.id) {\n                if ($scope.page > 1 && ($scope.count - 1) <= $scope.paginatedBy) {\n                  $ctrl.selectFilter(\"page\", $scope.page - 1);\n                }\n                $ctrl.loadInitialData();\n              } else {\n                $location.path($navUrls.resolve(\"home\"));\n              }\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"success\", text, null, 5000);\n            };\n          })(this);\n          onError = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish(false);\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.ERROR_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"error\", text);\n            };\n          })(this);\n          return $repo.remove(member).then(onSuccess, onError);\n        });\n      };\n      $el.on(\"click\", \".delete\", function(event) {\n        var isCurrentUser;\n        event.preventDefault();\n        if ($scope.project.owner.id === member.user) {\n          isCurrentUser = $scope.user.id === member.user;\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: isCurrentUser,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowActions\", [\"$log\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$compile\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgLightboxFactory\", MembershipsRowActionsDirective]);\n\n  NoMoreMembershipsExplanationDirective = function() {\n    return {\n      templateUrl: \"admin/no-more-memberships-explanation.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgNoMoreMembershipsExplanation\", [NoMoreMembershipsExplanationDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/nav.coffee\n */\n\n(function() {\n  var AdminNavigationDirective, module;\n\n  AdminNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgAdminNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#adminmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaAdmin\");\n\n  module.directive(\"tgAdminNavigation\", AdminNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var AdminProjectChangeOwnerDirective, AdminProjectRequestOwnershipDirective, AdminProjectRestrictionsDirective, CsvExporterController, CsvExporterIssuesController, CsvExporterTasksController, CsvExporterUserstoriesController, CsvIssueDirective, CsvTaskDirective, CsvUsDirective, ProjectDefaultValuesDirective, ProjectExportDirective, ProjectLogoDirective, ProjectLogoModelDirective, ProjectModulesDirective, ProjectProfileController, ProjectProfileDirective, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectProfileController = (function(superClass) {\n    extend(ProjectProfileController, superClass);\n\n    ProjectProfileController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgCurrentUserService\"];\n\n    function ProjectProfileController(scope1, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, tgAuth, currentUserService1) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.tgAuth = tgAuth;\n      this.currentUserService = currentUserService1;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          _this.appMetaService.setAll(title, description);\n          return _this.fillUsersAndRoles(_this.scope.project.members, _this.scope.project.roles);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectProfileController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.prioritiesList = _.sortBy(project.priorities, \"order\");\n          _this.scope.severitiesList = _.sortBy(project.severities, \"order\");\n          _this.scope.triggersList = _.sortBy(project.triggers, \"order\");\n          _this.scope.issueTypesList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectProfileController.prototype.loadInitialData = function() {\n      return this.q.all([this.loadProject(), this.tgAuth.refresh()]);\n    };\n\n    ProjectProfileController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.project);\n    };\n\n    return ProjectProfileController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectProfileController\", ProjectProfileController);\n\n  ProjectProfileDirective = function($repo, $confirm, $loading, $navurls, $location, projectService, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, form, submit, submitButton;\n      $ctrl = $el.controller();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            var newUrl;\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            newUrl = $navurls.resolve(\"project-admin-project-profile-details\", {\n              project: $scope.project.slug\n            });\n            $location.path(newUrl);\n            $ctrl.loadInitialData();\n            projectService.fetchProject();\n            return currentUserService.loadProjects();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectProfile\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgNavUrls\", \"$tgLocation\", \"tgProjectService\", \"tgCurrentUserService\", ProjectProfileDirective]);\n\n  ProjectDefaultValuesDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectDefaultValues\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", ProjectDefaultValuesDirective]);\n\n  ProjectModulesDirective = function($repo, $confirm, $loading, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = (function(_this) {\n        return function() {\n          var form, promise;\n          form = $el.find(\"form\").checksley();\n          form.initializeFields();\n          form.reset();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            $scope.$emit(\"project:loaded\", $scope.project);\n            $confirm.notify(\"success\");\n            return projectService.fetchProject();\n          });\n          return promise.then(null, function(data) {\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this);\n      $el.on(\"change\", \".module-activation.module-direct-active input\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"submit\", \"form\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \".icon-save\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"keydown\", \".videoconference-attributes input\", function(e) {\n        return e.which !== 32;\n      });\n      $scope.$watch(\"project.videoconferences\", function(newVal, oldVal) {\n        if ((newVal != null) && (oldVal != null) && newVal !== oldVal) {\n          return $scope.project.videoconferences_extra_data = \"\";\n        }\n      });\n      $scope.$watch(\"isVideoconferenceActivated\", function(newValue, oldValue) {\n        if (newValue === false) {\n          $scope.project.videoconferences = null;\n          $scope.project.videoconferences_extra_data = \"\";\n          if (oldValue === true) {\n            return submit();\n          }\n        }\n      });\n      return $scope.$watch(\"project\", function(project) {\n        if (project.videoconferences != null) {\n          return $scope.isVideoconferenceActivated = true;\n        } else {\n          return $scope.isVideoconferenceActivated = false;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectModules\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgProjectService\", ProjectModulesDirective]);\n\n  ProjectExportDirective = function($window, $rs, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var asyn_message, buttonsEl, dump_ready_text, hideButtons, hideResult, hideSpinner, loading_msg, loading_title, resultEl, resultMessageEl, resultTitleEl, setAsyncMessage, setAsyncTitle, setLoadingMessage, setLoadingTitle, setSyncMessage, setSyncTitle, showButtons, showErrorMode, showExportResultAsyncMode, showExportResultSyncMode, showLoadingMode, showResult, showSpinner, spinnerEl, syn_message;\n      buttonsEl = $el.find(\".admin-project-export-buttons\");\n      showButtons = function() {\n        return buttonsEl.removeClass(\"hidden\");\n      };\n      hideButtons = function() {\n        return buttonsEl.addClass(\"hidden\");\n      };\n      resultEl = $el.find(\".admin-project-export-result\");\n      showResult = function() {\n        return resultEl.removeClass(\"hidden\");\n      };\n      hideResult = function() {\n        return resultEl.addClass(\"hidden\");\n      };\n      spinnerEl = $el.find(\".spin\");\n      showSpinner = function() {\n        return spinnerEl.removeClass(\"hidden\");\n      };\n      hideSpinner = function() {\n        return spinnerEl.addClass(\"hidden\");\n      };\n      resultTitleEl = $el.find(\".result-title\");\n      loading_title = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_TITLE\");\n      loading_msg = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_MESSAGE\");\n      dump_ready_text = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.DUMP_READY\"));\n      };\n      asyn_message = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE\"));\n      };\n      syn_message = function(url) {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.SYNC_MESSAGE\", {\n          url: url\n        }));\n      };\n      setLoadingTitle = function() {\n        return resultTitleEl.html(loading_title);\n      };\n      setAsyncTitle = function() {\n        return resultTitleEl.html(loading_msg);\n      };\n      setSyncTitle = function() {\n        return resultTitleEl.html(dump_ready_text);\n      };\n      resultMessageEl = $el.find(\".result-message \");\n      setLoadingMessage = function() {\n        return resultMessageEl.html(loading_msg);\n      };\n      setAsyncMessage = function() {\n        return resultMessageEl.html(asyn_message);\n      };\n      setSyncMessage = function(url) {\n        return resultMessageEl.html(syn_message(url));\n      };\n      showLoadingMode = function() {\n        showSpinner();\n        setLoadingTitle();\n        setLoadingMessage();\n        hideButtons();\n        return showResult();\n      };\n      showExportResultAsyncMode = function() {\n        hideSpinner();\n        setAsyncTitle();\n        return setAsyncMessage();\n      };\n      showExportResultSyncMode = function(url) {\n        hideSpinner();\n        setSyncTitle();\n        return setSyncMessage(url);\n      };\n      showErrorMode = function() {\n        hideSpinner();\n        hideResult();\n        return showButtons();\n      };\n      return $el.on(\"click\", \"a.button-export\", debounce(2000, (function(_this) {\n        return function(event) {\n          var onError, onSuccess;\n          event.preventDefault();\n          onSuccess = function(result) {\n            var dumpUrl;\n            if (result.status === 202) {\n              return showExportResultAsyncMode();\n            } else {\n              dumpUrl = result.data.url;\n              showExportResultSyncMode(dumpUrl);\n              return $window.open(dumpUrl, \"_blank\");\n            }\n          };\n          onError = function(result) {\n            var errorMsg, ref;\n            showErrorMode();\n            errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\", {\n                message: result.data._error_message\n              });\n            }\n            return $confirm.notify(\"error\", errorMsg);\n          };\n          showLoadingMode();\n          return $rs.projects[\"export\"]($scope.projectId).then(onSuccess, onError);\n        };\n      })(this)));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectExport\", [\"$window\", \"$tgResources\", \"$tgConfirm\", \"$translate\", ProjectExportDirective]);\n\n  CsvExporterController = (function(superClass) {\n    extend(CsvExporterController, superClass);\n\n    CsvExporterController.$inject = [\"$scope\", \"$rootScope\", \"$tgUrls\", \"$tgConfirm\", \"$tgResources\", \"$translate\"];\n\n    function CsvExporterController(scope1, rootscope, urls, confirm, rs, translate) {\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.urls = urls;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.translate = translate;\n      this._generateUuid = bind(this._generateUuid, this);\n      this.setCsvUuid = bind(this.setCsvUuid, this);\n      this.rootscope.$on(\"project:loaded\", this.setCsvUuid);\n      this.scope.$watch(\"csvUuid\", (function(_this) {\n        return function(value) {\n          if (value) {\n            return _this.scope.csvUrl = _this.urls.resolveAbsolute(_this.type + \"-csv\", value);\n          } else {\n            return _this.scope.csvUrl = \"\";\n          }\n        };\n      })(this));\n    }\n\n    CsvExporterController.prototype.setCsvUuid = function() {\n      return this.scope.csvUuid = this.scope.project[this.type + \"_csv_uuid\"];\n    };\n\n    CsvExporterController.prototype._generateUuid = function(response) {\n      var promise;\n      if (response == null) {\n        response = null;\n      }\n      promise = this.rs.projects[\"regenerate_\" + this.type + \"_csv_uuid\"](this.scope.projectId);\n      promise.then((function(_this) {\n        return function(data) {\n          var ref;\n          return _this.scope.csvUuid = (ref = data.data) != null ? ref.uuid : void 0;\n        };\n      })(this));\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n      promise[\"finally\"](function() {\n        if (response) {\n          return response.finish();\n        }\n      });\n      return promise;\n    };\n\n    CsvExporterController.prototype.regenerateUuid = function() {\n      var subtitle, title;\n      if (this.scope.csvUuid) {\n        title = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_TITLE\");\n        subtitle = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_SUBTITLE\");\n        return this.confirm.ask(title, subtitle).then(this._generateUuid);\n      } else {\n        return this._generateUuid();\n      }\n    };\n\n    return CsvExporterController;\n\n  })(taiga.Controller);\n\n  CsvExporterUserstoriesController = (function(superClass) {\n    extend(CsvExporterUserstoriesController, superClass);\n\n    function CsvExporterUserstoriesController() {\n      return CsvExporterUserstoriesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterUserstoriesController.prototype.type = \"userstories\";\n\n    return CsvExporterUserstoriesController;\n\n  })(CsvExporterController);\n\n  CsvExporterTasksController = (function(superClass) {\n    extend(CsvExporterTasksController, superClass);\n\n    function CsvExporterTasksController() {\n      return CsvExporterTasksController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterTasksController.prototype.type = \"tasks\";\n\n    return CsvExporterTasksController;\n\n  })(CsvExporterController);\n\n  CsvExporterIssuesController = (function(superClass) {\n    extend(CsvExporterIssuesController, superClass);\n\n    function CsvExporterIssuesController() {\n      return CsvExporterIssuesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterIssuesController.prototype.type = \"issues\";\n\n    return CsvExporterIssuesController;\n\n  })(CsvExporterController);\n\n  module.controller(\"CsvExporterUserstoriesController\", CsvExporterUserstoriesController);\n\n  module.controller(\"CsvExporterTasksController\", CsvExporterTasksController);\n\n  module.controller(\"CsvExporterIssuesController\", CsvExporterIssuesController);\n\n  CsvUsDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_US\";\n    };\n    return {\n      controller: \"CsvExporterUserstoriesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvUs\", [\"$translate\", CsvUsDirective]);\n\n  CsvTaskDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_TASK\";\n    };\n    return {\n      controller: \"CsvExporterTasksController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvTask\", [\"$translate\", CsvTaskDirective]);\n\n  CsvIssueDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_ISSUE\";\n    };\n    return {\n      controller: \"CsvExporterIssuesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvIssue\", [\"$translate\", CsvIssueDirective]);\n\n  ProjectLogoDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").addClass(\"active\");\n      };\n      onSuccess = function(response) {\n        var project;\n        project = $model.make_model(\"projects\", response.data);\n        $scope.project = project;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-logo\", function() {\n        return $el.find(\"#logo-field\").click();\n      });\n      $el.on(\"change\", \"#logo-field\", function(event) {\n        if ($scope.logoAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.projects.changeLogo($scope.project.id, $scope.logoAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-default-logo\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.projects.removeLogo($scope.project.id).then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectLogo\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", ProjectLogoDirective]);\n\n  ProjectLogoModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgProjectLogoModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgProjectLogoModel', ['$parse', ProjectLogoModelDirective]);\n\n  AdminProjectRestrictionsDirective = function() {\n    return {\n      scope: {\n        \"project\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-restrictions.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRestrictions', [AdminProjectRestrictionsDirective]);\n\n  AdminProjectRequestOwnershipDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.requestOwnership = function() {\n          return lightboxFactory.create(\"tg-lb-request-ownership\", {\n            \"class\": \"lightbox lightbox-request-ownership\"\n          }, {\n            projectId: scope.projectId\n          });\n        };\n      },\n      scope: {\n        \"projectId\": \"=\",\n        \"owner\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRequestOwnership', [\"tgLightboxFactory\", AdminProjectRequestOwnershipDirective]);\n\n  AdminProjectChangeOwnerDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.changeOwner = function() {\n          return lightboxFactory.create(\"tg-lb-change-owner\", {\n            \"class\": \"lightbox lightbox-select-user\",\n            \"project-id\": \"projectId\",\n            \"active-users\": \"activeUsers\",\n            \"current-owner-id\": \"currentOwnerId\"\n          }, {\n            projectId: scope.projectId,\n            activeUsers: scope.activeUsers,\n            currentOwnerId: scope.owner.id,\n            members: scope.members\n          });\n        };\n      },\n      scope: {\n        \"activeUsers\": \"=\",\n        \"projectId\": \"=\",\n        \"owner\": \"=\",\n        \"members\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-change-owner.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectChangeOwner', [\"tgLightboxFactory\", AdminProjectChangeOwnerDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var ColorSelectionDirective, DATE_TYPE, MULTILINE_TYPE, ProjectCustomAttributesController, ProjectCustomAttributesDirective, ProjectValuesController, ProjectValuesDirective, ProjectValuesSectionController, SELECT_TYPE, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectValuesSectionController = (function(superClass) {\n    extend(ProjectValuesSectionController, superClass);\n\n    ProjectValuesSectionController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectValuesSectionController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_VALUES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    ProjectValuesSectionController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectValuesSectionController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    return ProjectValuesSectionController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectValuesSectionController\", ProjectValuesSectionController);\n\n  ProjectValuesController = (function(superClass) {\n    extend(ProjectValuesController, superClass);\n\n    ProjectValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\"];\n\n    function ProjectValuesController(scope, rootscope, repo, confirm, rs) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.moveValue = bind(this.moveValue, this);\n      this.loadValues = bind(this.loadValues, this);\n      this.scope.$on(\"admin:project-values:move\", this.moveValue);\n      this.rootscope.$on(\"project:loaded\", this.loadValues);\n    }\n\n    ProjectValuesController.prototype.loadValues = function() {\n      return this.rs[this.scope.resource].listValues(this.scope.projectId, this.scope.type).then((function(_this) {\n        return function(values) {\n          _this.scope.values = values;\n          _this.scope.maxValueOrder = _.maxBy(values, \"order\").order;\n          return values;\n        };\n      })(this));\n    };\n\n    ProjectValuesController.prototype.moveValue = function(ctx, itemValue, itemIndex) {\n      var r, values;\n      values = this.scope.values;\n      r = values.indexOf(itemValue);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, itemValue);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return ProjectValuesController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectValuesController\", ProjectValuesController);\n\n  ProjectValuesDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link, linkDragAndDrop, linkValue;\n    linkDragAndDrop = function($scope, $el, $attrs) {\n      var itemEl, newParentScope, oldParentScope, tdom;\n      oldParentScope = null;\n      newParentScope = null;\n      itemEl = null;\n      tdom = $el.find(\".sortable\");\n      tdom.sortable({\n        handle: \".row.table-main.visualization\",\n        dropOnEmpty: true,\n        connectWith: \".project-values-body\",\n        revert: 400,\n        axis: \"y\"\n      });\n      tdom.on(\"sortstop\", function(event, ui) {\n        var itemIndex, itemValue;\n        itemEl = ui.item;\n        itemValue = itemEl.scope().value;\n        itemIndex = itemEl.index();\n        return $scope.$broadcast(\"admin:project-values:move\", itemValue, itemIndex);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    linkValue = function($scope, $el, $attrs) {\n      var $ctrl, cancel, goToBottomList, initializeNewValue, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"is_closed\": false,\n          \"is_archived\": false\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_\" + (objName.toUpperCase()) + \".ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = function(target) {\n        var form, formEl, promise, value;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        value = formEl.scope().value;\n        promise = $repo.save(value);\n        promise.then((function(_this) {\n          return function() {\n            var row;\n            row = target.parents(\".row.table-main\");\n            row.addClass(\"hidden\");\n            return row.siblings(\".visualization\").removeClass('hidden');\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      saveNewValue = function(target) {\n        var form, formEl, promise;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        $scope.newValue.order = $scope.maxValueOrder ? $scope.maxValueOrder + 1 : 1;\n        promise = $repo.create(valueType, $scope.newValue);\n        promise.then((function(_this) {\n          return function(data) {\n            target.addClass(\"hidden\");\n            $scope.values.push(data);\n            $scope.maxValueOrder = data.order;\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      cancel = function(target) {\n        var formEl, row, value;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          value.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").removeClass('hidden');\n        return goToBottomList(true);\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".edition input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return saveValue(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      return $el.on(\"click\", \".delete-value\", function(event) {\n        var choices, formEl, subtitle, target, text, title, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        choices = {};\n        _.each($scope.values, function(option) {\n          if (value.id !== option.id) {\n            return choices[option.id] = option.name;\n          }\n        });\n        subtitle = value.name;\n        if (_.keys(choices).length === 0) {\n          return $confirm.error($translate.instant(\"ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL\"));\n        }\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\");\n        text = $translate.instant(\"ADMIN.PROJECT_VALUES.REPLACEMENT\");\n        return $confirm.askChoice(title, subtitle, choices, text).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadValues()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $repo.remove(value, {\n            \"moveTo\": response.selected\n          }).then(onSucces, onError);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      linkDragAndDrop($scope, $el, $attrs);\n      linkValue($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectValues\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectValuesDirective]);\n\n  ColorSelectionDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$watch($attrs.ngModel, function(element) {\n        return $scope.color = element.color;\n      });\n      $el.on(\"click\", \".current-color\", function(event) {\n        var body, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        $el.find(\".select-color\").hide();\n        target.siblings(\".select-color\").show();\n        body = angular.element(\"body\");\n        return body.on(\"click\", (function(_this) {\n          return function(event) {\n            if (angular.element(event.target).parent(\".select-color\").length === 0) {\n              $el.find(\".select-color\").hide();\n              return body.unbind(\"click\");\n            }\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".select-color .color\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $model.$modelValue.color = target.data(\"color\");\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"click\", \".select-color .selected-color\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $model.$modelValue.color = $scope.color;\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgColorSelection\", ColorSelectionDirective);\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  SELECT_TYPE = \"select\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: SELECT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_SELECT\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  ProjectCustomAttributesController = (function(superClass) {\n    extend(ProjectCustomAttributesController, superClass);\n\n    ProjectCustomAttributesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectCustomAttributesController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.moveCustomAttributes = bind(this.moveCustomAttributes, this);\n      this.deleteCustomAttribute = bind(this.deleteCustomAttribute, this);\n      this.saveCustomAttribute = bind(this.saveCustomAttribute, this);\n      this.createCustomAttribute = bind(this.createCustomAttribute, this);\n      this.loadCustomAttributes = bind(this.loadCustomAttributes, this);\n      this.scope.TYPE_CHOICES = TYPE_CHOICES;\n      this.scope.project = {};\n      this.rootscope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          _this.loadCustomAttributes();\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectCustomAttributesController.prototype.loadCustomAttributes = function() {\n      return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((function(_this) {\n        return function(customAttributes) {\n          _this.scope.customAttributes = customAttributes;\n          _this.scope.maxOrder = _.maxBy(customAttributes, \"order\").order;\n          return customAttributes;\n        };\n      })(this));\n    };\n\n    ProjectCustomAttributesController.prototype.createCustomAttribute = function(attrValues) {\n      return this.repo.create(\"custom-attributes/\" + this.scope.type, attrValues);\n    };\n\n    ProjectCustomAttributesController.prototype.saveCustomAttribute = function(attrModel) {\n      return this.repo.save(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.deleteCustomAttribute = function(attrModel) {\n      return this.repo.remove(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.moveCustomAttributes = function(attrModel, newIndex) {\n      var customAttributes, r;\n      customAttributes = this.scope.customAttributes;\n      r = customAttributes.indexOf(attrModel);\n      customAttributes.splice(r, 1);\n      customAttributes.splice(newIndex, 0, attrModel);\n      _.each(customAttributes, function(val, idx) {\n        return val.order = idx;\n      });\n      return this.repo.saveAll(customAttributes);\n    };\n\n    return ProjectCustomAttributesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectCustomAttributesController\", ProjectCustomAttributesController);\n\n  ProjectCustomAttributesDirective = function($log, $confirm, animationFrame, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, cancelCreate, cancelUpdate, create, deleteCustomAttribute, hideAddButton, hideCancelButton, hideCreateForm, hideEditForm, resetNewAttr, revertChangesInCustomAttribute, showAddButton, showCancelButton, showCreateForm, showEditForm, sortableEl, update;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      sortableEl = $el.find(\".js-sortable\");\n      sortableEl.sortable({\n        handle: \".js-view-custom-field\",\n        dropOnEmpty: true,\n        revert: 400,\n        axis: \"y\"\n      });\n      sortableEl.on(\"sortstop\", function(event, ui) {\n        var itemAttr, itemEl, itemIndex;\n        itemEl = ui.item;\n        itemAttr = itemEl.scope().attr;\n        itemIndex = itemEl.index();\n        return $ctrl.moveCustomAttributes(itemAttr, itemIndex);\n      });\n      showCreateForm = function() {\n        $el.find(\".js-new-custom-field\").removeClass(\"hidden\");\n        return $el.find(\".js-new-custom-field input:visible\").first().focus();\n      };\n      hideCreateForm = function() {\n        return $el.find(\".js-new-custom-field\").addClass(\"hidden\");\n      };\n      showAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").addClass(\"hidden\");\n      };\n      showCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").addClass(\"hidden\");\n      };\n      resetNewAttr = function() {\n        return $scope.newAttr = {};\n      };\n      create = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideCreateForm();\n            resetNewAttr();\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = $scope.newAttr;\n        attr.project = $scope.projectId;\n        attr.order = $scope.maxOrder ? $scope.maxOrder + 1 : 1;\n        return $ctrl.createCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelCreate = function() {\n        hideCreateForm();\n        return resetNewAttr();\n      };\n      $scope.$watch(\"customAttributes\", function(customAttributes) {\n        if (!customAttributes) {\n          return;\n        }\n        if (customAttributes.length === 0) {\n          hideCancelButton();\n          hideAddButton();\n          return showCreateForm();\n        } else {\n          hideCreateForm();\n          showAddButton();\n          return showCancelButton();\n        }\n      });\n      $el.on(\"click\", \".js-add-custom-field-button\", function(event) {\n        event.preventDefault();\n        return showCreateForm();\n      });\n      $el.on(\"click\", \".js-create-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return create(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-new-custom-field-button\", function(event) {\n        event.preventDefault();\n        return cancelCreate();\n      });\n      $el.on(\"keyup\", \".js-new-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return create(formEl);\n        } else if (event.keyCode === 27) {\n          return cancelCreate();\n        }\n      });\n      showEditForm = function(formEl) {\n        formEl.find(\".js-view-custom-field\").addClass(\"hidden\");\n        formEl.find(\".js-edit-custom-field\").removeClass(\"hidden\");\n        return formEl.find(\".js-edit-custom-field input:visible\").first().focus().select();\n      };\n      hideEditForm = function(formEl) {\n        formEl.find(\".js-edit-custom-field\").addClass(\"hidden\");\n        return formEl.find(\".js-view-custom-field\").removeClass(\"hidden\");\n      };\n      revertChangesInCustomAttribute = function(formEl) {\n        return $scope.$apply(function() {\n          return formEl.scope().attr.revert();\n        });\n      };\n      update = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideEditForm(formEl);\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = formEl.scope().attr;\n        return $ctrl.saveCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelUpdate = function(formEl) {\n        hideEditForm(formEl);\n        return revertChangesInCustomAttribute(formEl);\n      };\n      $el.on(\"click\", \".js-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return showEditForm(formEl);\n      });\n      $el.on(\"click\", \".js-update-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return update(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return cancelUpdate(formEl);\n      });\n      $el.on(\"keyup\", \".js-edit-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return update(formEl);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return cancelUpdate(formEl);\n        }\n      });\n      deleteCustomAttribute = function(formEl) {\n        var attr, message, text, title;\n        attr = formEl.scope().attr;\n        message = attr.name;\n        title = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.DELETE\");\n        text = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE\");\n        return $confirm.ask(title, text, message).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadCustomAttributes()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\", null, \"We have not been able to delete '\" + message + \"'.\");\n          };\n          return $ctrl.deleteCustomAttribute(attr).then(onSucces, onError);\n        });\n      };\n      return $el.on(\"click\", \".js-delete-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return deleteCustomAttribute(formEl);\n      }));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectCustomAttributes\", [\"$log\", \"$tgConfirm\", \"animationFrame\", \"$translate\", ProjectCustomAttributesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var EditRoleDirective, NewRoleDirective, RolePermissionsDirective, RolesController, RolesDirective, bindMethods, bindOnce, debounce, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  RolesController = (function(superClass) {\n    extend(RolesController, superClass);\n\n    RolesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function RolesController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this._disableComputable = bind(this._disableComputable, this);\n      this._enableComputable = bind(this._enableComputable, this);\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.MENU.PERMISSIONS\";\n      this.scope.project = {};\n      this.scope.anyComputableRole = true;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.ROLES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    RolesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.anyComputableRole = _.some(_.map(project.roles, function(point) {\n            return point.computable;\n          }));\n          return project;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadRoles = function() {\n      return this.rs.roles.list(this.scope.projectId).then((function(_this) {\n        return function(roles) {\n          var public_permission;\n          roles = roles.map(function(role) {\n            role.external_user = false;\n            return role;\n          });\n          public_permission = {\n            \"name\": _this.translate.instant(\"ADMIN.ROLES.EXTERNAL_USER\"),\n            \"permissions\": _this.scope.project.public_permissions,\n            \"external_user\": true\n          };\n          roles.push(public_permission);\n          _this.scope.roles = roles;\n          _this.scope.role = _this.scope.roles[0];\n          return roles;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadRoles();\n        };\n      })(this));\n      return promise;\n    };\n\n    RolesController.prototype.setRole = function(role) {\n      this.scope.role = role;\n      return this.scope.$broadcast(\"role:changed\", this.scope.role);\n    };\n\n    RolesController.prototype[\"delete\"] = function() {\n      var choices, i, len, ref, replacement, role, subtitle, title, warning;\n      choices = {};\n      ref = this.scope.roles;\n      for (i = 0, len = ref.length; i < len; i++) {\n        role = ref[i];\n        if (role.id !== this.scope.role.id) {\n          choices[role.id] = role.name;\n        }\n      }\n      if (_.keys(choices).length === 0) {\n        return this.confirm.error(this.translate.instant(\"ADMIN.ROLES.ERROR_DELETE_ALL\"));\n      }\n      title = this.translate.instant(\"ADMIN.ROLES.TITLE_DELETE_ROLE\");\n      subtitle = this.scope.role.name;\n      replacement = this.translate.instant(\"ADMIN.ROLES.REPLACEMENT_ROLE\");\n      warning = this.translate.instant(\"ADMIN.ROLES.WARNING_DELETE_ROLE\");\n      return this.confirm.askChoice(title, subtitle, choices, replacement, warning).then((function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            _this.loadProject();\n            return _this.loadRoles()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return _this.confirm.notify('error');\n          };\n          return _this.repo.remove(_this.scope.role, {\n            moveTo: response.selected\n          }).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    RolesController.prototype._enableComputable = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"success\");\n          return _this.loadProject();\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.scope.role.revert();\n        };\n      })(this);\n      return this.repo.save(this.scope.role).then(onSuccess, onError);\n    };\n\n    RolesController.prototype._disableComputable = function() {\n      var askOnError, askOnSuccess, message, subtitle, title;\n      askOnSuccess = (function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            response.finish();\n            _this.confirm.notify(\"success\");\n            return _this.loadProject();\n          };\n          onError = function() {\n            response.finish();\n            _this.confirm.notify(\"error\");\n            return _this.scope.role.revert();\n          };\n          return _this.repo.save(_this.scope.role).then(onSuccess, onError);\n        };\n      })(this);\n      askOnError = (function(_this) {\n        return function(response) {\n          return _this.scope.role.revert();\n        };\n      })(this);\n      title = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE\");\n      subtitle = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE\", {\n        roleName: this.scope.role.name\n      });\n      message = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_MESSAGE\");\n      return this.confirm.ask(title, subtitle, message).then(askOnSuccess, askOnError);\n    };\n\n    RolesController.prototype.toggleComputable = debounce(2000, function() {\n      if (!this.scope.role.computable) {\n        return this._disableComputable();\n      } else {\n        return this._enableComputable();\n      }\n    });\n\n    return RolesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"RolesController\", RolesController);\n\n  EditRoleDirective = function($repo, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, toggleView;\n      toggleView = function() {\n        $el.find('.total').toggle();\n        return $el.find('.edit-role').toggle();\n      };\n      submit = function() {\n        var promise;\n        $scope.role.name = $el.find(\"input\").val();\n        promise = $repo.save($scope.role);\n        promise.then(function() {\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function(data) {\n          return $confirm.notify(\"error\");\n        });\n        return toggleView();\n      };\n      $el.on(\"click\", \".edit-value\", function() {\n        toggleView();\n        $el.find(\"input\").focus();\n        return $el.find(\"input\").val($scope.role.name);\n      });\n      $el.on(\"click\", \"a.save\", submit);\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return submit();\n        } else if (event.keyCode === 27) {\n          return toggleView();\n        }\n      });\n      $scope.$on(\"role:changed\", function() {\n        if ($el.find('.edit-role').is(\":visible\")) {\n          return toggleView();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgEditRole\", [\"$tgRepo\", \"$tgConfirm\", EditRoleDirective]);\n\n  RolesDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRoles\", RolesDirective);\n\n  NewRoleDirective = function($tgrepo, $confirm) {\n    var DEFAULT_PERMISSIONS, link;\n    DEFAULT_PERMISSIONS = [\"view_project\", \"view_milestones\", \"view_us\", \"view_tasks\", \"view_issues\"];\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \"a.add-button\", function(event) {\n        event.preventDefault();\n        $el.find(\".new\").removeClass(\"hidden\");\n        $el.find(\".new\").focus();\n        return $el.find(\".add-button\").hide();\n      });\n      return $el.on(\"keyup\", \".new\", function(event) {\n        var newRole, onError, onSuccess, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newRole = {\n            project: $scope.projectId,\n            name: target.val(),\n            permissions: DEFAULT_PERMISSIONS,\n            order: _.maxBy($scope.roles, function(r) {\n              return r.order;\n            }).order + 1,\n            computable: false\n          };\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          onSuccess = function(role) {\n            var insertPosition;\n            insertPosition = $scope.roles.length - 1;\n            $scope.roles.splice(insertPosition, 0, role);\n            $ctrl.setRole(role);\n            $el.find(\".add-button\").show();\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $tgrepo.create(\"roles\", newRole).then(onSuccess, onError);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          return $el.find(\".add-button\").show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewRole\", [\"$tgRepo\", \"$tgConfirm\", NewRoleDirective]);\n\n  RolePermissionsDirective = function($rootscope, $repo, $confirm, $compile) {\n    var baseTemplate, categoryTemplate, link, resumeTemplate;\n    resumeTemplate = _.template(\"<div class=\\\"resume-title\\\" translate=\\\"<%- category.name %>\\\"></div>\\n<div class=\\\"summary-role\\\">\\n    <div class=\\\"count\\\"><%- category.activePermissions %>/<%- category.permissions.length %></div>\\n    <% _.each(category.permissions, function(permission) { %>\\n        <div class=\\\"role-summary-single <% if(permission.active) { %>active<% } %>\\\"\\n             title=\\\"{{ '<%- permission.name %>' | translate }}\\\"></div>\\n    <% }) %>\\n</div>\\n<svg class=\\\"icon icon-arrow-right\\\">\\n    <use xlink:href=\\\"#icon-arrow-right\\\">\\n</svg>\");\n    categoryTemplate = _.template(\"<div class=\\\"category-config\\\" data-id=\\\"<%- index %>\\\">\\n    <div class=\\\"resume\\\">\\n    </div>\\n    <div class=\\\"category-items\\\">\\n        <div class=\\\"items-container\\\">\\n        <% _.each(category.permissions, function(permission) { %>\\n            <div class=\\\"category-item\\\" data-id=\\\"<%- permission.key %>\\\">\\n                <span translate=\\\"<%- permission.name %>\\\"></span>\\n                <div class=\\\"check\\\">\\n                    <input type=\\\"checkbox\\\"\\n                           <% if(!permission.editable) { %> disabled=\\\"disabled\\\" <% } %>\\n                           <% if(permission.active) { %> checked=\\\"checked\\\" <% } %>/>\\n                    <div></div>\\n                    <span class=\\\"check-text check-yes\\\" translate=\\\"COMMON.YES\\\"></span>\\n                    <span class=\\\"check-text check-no\\\" translate=\\\"COMMON.NO\\\"></span>\\n                </div>\\n            </div>\\n        <% }) %>\\n        </div>\\n    </div>\\n</div>\");\n    baseTemplate = _.template(\"<div class=\\\"category-config-list\\\"></div>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, generateCategoriesFromRole, renderCategory, renderPermissions, renderResume;\n      $ctrl = $el.controller();\n      generateCategoriesFromRole = function(role) {\n        var categories, isPermissionEditable, issuePermissions, milestonePermissions, setActivePermissions, setActivePermissionsPerCategory, taskPermissions, userStoryPermissions, wikiPermissions;\n        setActivePermissions = function(permissions) {\n          return _.map(permissions, function(x) {\n            var ref;\n            return _.extend({}, x, {\n              active: (ref = x[\"key\"], indexOf.call(role.permissions, ref) >= 0)\n            });\n          });\n        };\n        isPermissionEditable = function(permission, role, project) {\n          if (role.external_user && !project.is_private && permission.key.indexOf(\"view_\") === 0) {\n            return false;\n          } else {\n            return true;\n          }\n        };\n        setActivePermissionsPerCategory = function(category) {\n          return _.map(category, function(cat) {\n            cat.permissions = cat.permissions.map(function(permission) {\n              permission.editable = isPermissionEditable(permission, role, $scope.project);\n              return permission;\n            });\n            return _.extend({}, cat, {\n              activePermissions: _.filter(cat[\"permissions\"], \"active\").length\n            });\n          });\n        };\n        categories = [];\n        milestonePermissions = [\n          {\n            key: \"view_milestones\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS\"\n          }, {\n            key: \"add_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS\"\n          }, {\n            key: \"modify_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS\"\n          }, {\n            key: \"delete_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME\",\n          permissions: setActivePermissions(milestonePermissions)\n        });\n        userStoryPermissions = [\n          {\n            key: \"view_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES\"\n          }, {\n            key: \"add_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES\"\n          }, {\n            key: \"modify_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES\"\n          }, {\n            key: \"delete_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME\",\n          permissions: setActivePermissions(userStoryPermissions)\n        });\n        taskPermissions = [\n          {\n            key: \"view_tasks\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS\"\n          }, {\n            key: \"add_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS\"\n          }, {\n            key: \"modify_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS\"\n          }, {\n            key: \"delete_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME\",\n          permissions: setActivePermissions(taskPermissions)\n        });\n        issuePermissions = [\n          {\n            key: \"view_issues\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES\"\n          }, {\n            key: \"add_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES\"\n          }, {\n            key: \"modify_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES\"\n          }, {\n            key: \"delete_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME\",\n          permissions: setActivePermissions(issuePermissions)\n        });\n        wikiPermissions = [\n          {\n            key: \"view_wiki_pages\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES\"\n          }, {\n            key: \"add_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES\"\n          }, {\n            key: \"modify_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES\"\n          }, {\n            key: \"delete_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES\"\n          }, {\n            key: \"view_wiki_links\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS\"\n          }, {\n            key: \"add_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS\"\n          }, {\n            key: \"delete_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME\",\n          permissions: setActivePermissions(wikiPermissions)\n        });\n        return setActivePermissionsPerCategory(categories);\n      };\n      renderResume = function(element, category) {\n        return element.find(\".resume\").html($compile(resumeTemplate({\n          category: category\n        }))($scope));\n      };\n      renderCategory = function(category, index) {\n        var html;\n        html = categoryTemplate({\n          category: category,\n          index: index\n        });\n        html = angular.element(html);\n        renderResume(html, category);\n        return $compile(html)($scope);\n      };\n      renderPermissions = function() {\n        var html;\n        $el.off();\n        html = baseTemplate();\n        _.each(generateCategoriesFromRole($scope.role), function(category, index) {\n          return html = angular.element(html).append(renderCategory(category, index));\n        });\n        $el.html(html);\n        $el.on(\"click\", \".resume\", function(event) {\n          var target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          target.toggleClass(\"open-drawer\");\n          return target.next().toggleClass(\"open\");\n        });\n        return $el.on(\"change\", \".category-item input\", function(event) {\n          var getActivePermissions, onError, onSuccess, target;\n          getActivePermissions = function() {\n            var activePermissions;\n            activePermissions = _.filter($el.find(\".category-item input\"), function(t) {\n              return angular.element(t).is(\":checked\");\n            });\n            activePermissions = _.sortBy(_.map(activePermissions, function(t) {\n              var permission;\n              return permission = angular.element(t).parents(\".category-item\").data(\"id\");\n            }));\n            if (activePermissions.length) {\n              activePermissions.push(\"view_project\");\n            }\n            return activePermissions;\n          };\n          target = angular.element(event.currentTarget);\n          $scope.role.permissions = getActivePermissions();\n          onSuccess = function() {\n            var categories, categoryId;\n            categories = generateCategoriesFromRole($scope.role);\n            categoryId = target.parents(\".category-config\").data(\"id\");\n            renderResume(target.parents(\".category-config\"), categories[categoryId]);\n            $rootscope.$broadcast(\"projects:reload\");\n            $confirm.notify(\"success\");\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            target.prop(\"checked\", !target.prop(\"checked\"));\n            return $scope.role.permissions = getActivePermissions();\n          };\n          if ($scope.role.external_user) {\n            $scope.project.public_permissions = $scope.role.permissions;\n            $scope.project.anon_permissions = $scope.role.permissions.filter(function(permission) {\n              return permission.indexOf(\"view_\") === 0;\n            });\n            return $repo.save($scope.project).then(onSuccess, onError);\n          } else {\n            return $repo.save($scope.role).then(onSuccess, onError);\n          }\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $scope.$on(\"role:changed\", function() {\n        return renderPermissions();\n      });\n      return bindOnce($scope, $attrs.ngModel, renderPermissions);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRolePermissions\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", RolePermissionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/third-parties.coffee\n */\n\n(function() {\n  var BitbucketController, BitbucketWebhooksDirective, GithubController, GithubWebhooksDirective, GitlabController, GitlabWebhooksDirective, NewWebhookDirective, SelectInputText, ValidOriginIpsDirective, WebhookDirective, WebhooksController, bindMethods, debounce, mixOf, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  debounce = this.taiga.debounce;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaAdmin\");\n\n  WebhooksController = (function(superClass) {\n    extend(WebhooksController, superClass);\n\n    WebhooksController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function WebhooksController(scope, repo, rs, params, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.WEBHOOKS.SECTION_NAME\";\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.WEBHOOKS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"webhooks:reload\", this.loadWebhooks);\n    }\n\n    WebhooksController.prototype.loadWebhooks = function() {\n      return this.rs.webhooks.list(this.scope.projectId).then((function(_this) {\n        return function(webhooks) {\n          return _this.scope.webhooks = webhooks;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadWebhooks();\n        };\n      })(this));\n      return promise;\n    };\n\n    return WebhooksController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"WebhooksController\", WebhooksController);\n\n  WebhookDirective = function($rs, $repo, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var cancel, openHistory, save, showEditMode, showVisualizationMode, updateLogs, updateShowHideHistoryText, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      updateLogs = function() {\n        var prettyDate;\n        prettyDate = $translate.instant(\"ADMIN.WEBHOOKS.DATE\");\n        return $rs.webhooklogs.list(webhook.id).then((function(_this) {\n          return function(webhooklogs) {\n            var i, len, log, ref;\n            for (i = 0, len = webhooklogs.length; i < len; i++) {\n              log = webhooklogs[i];\n              log.validStatus = (200 <= (ref = log.status) && ref < 300);\n              log.prettySentHeaders = _.map(_.toPairs(log.request_headers), function(arg) {\n                var header, value;\n                header = arg[0], value = arg[1];\n                return header + \": \" + value;\n              }).join(\"\\n\");\n              log.prettySentData = JSON.stringify(log.request_data);\n              log.prettyDate = moment(log.created).format(prettyDate);\n            }\n            webhook.logs_counter = webhooklogs.length;\n            webhook.logs = webhooklogs;\n            return updateShowHideHistoryText();\n          };\n        })(this));\n      };\n      updateShowHideHistoryText = function() {\n        var historyElement, text, textElement, title;\n        textElement = $el.find(\".toggle-history\");\n        historyElement = textElement.parents(\".single-webhook-wrapper\").find(\".webhooks-history\");\n        if (historyElement.hasClass(\"open\")) {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE\");\n        } else {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE\");\n        }\n        textElement.text(text);\n        return textElement.prop(\"title\", title);\n      };\n      showVisualizationMode = function() {\n        $el.find(\".edition-mode\").addClass(\"hidden\");\n        return $el.find(\".visualization-mode\").removeClass(\"hidden\");\n      };\n      showEditMode = function() {\n        $el.find(\".visualization-mode\").addClass(\"hidden\");\n        return $el.find(\".edition-mode\").removeClass(\"hidden\");\n      };\n      openHistory = function() {\n        return $el.find(\".webhooks-history\").addClass(\"open\");\n      };\n      cancel = function() {\n        showVisualizationMode();\n        return $scope.$apply(function() {\n          return webhook.revert();\n        });\n      };\n      save = debounce(2000, function(target) {\n        var form, promise;\n        form = target.parents(\"form\").checksley();\n        if (!form.validate()) {\n          return;\n        }\n        promise = $repo.save(webhook);\n        promise.then((function(_this) {\n          return function() {\n            return showVisualizationMode();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      $el.on(\"click\", \".test-webhook\", function() {\n        openHistory();\n        return $rs.webhooks.test(webhook.id).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".edit-webhook\", function() {\n        return showEditMode();\n      });\n      $el.on(\"click\", \".cancel-existing\", function() {\n        return cancel();\n      });\n      $el.on(\"click\", \".edit-existing\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      });\n      $el.on(\"keyup\", \".edition-mode input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return save(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".delete-webhook\", function() {\n        var message, title;\n        title = $translate.instant(\"ADMIN.WEBHOOKS.DELETE\");\n        message = $translate.instant(\"ADMIN.WEBHOOKS.WEBHOOK_NAME\", {\n          name: webhook.name\n        });\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSucces;\n            onSucces = function() {\n              askResponse.finish();\n              return $scope.$emit(\"webhooks:reload\");\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove(webhook).then(onSucces, onError);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".toggle-history\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if ((webhook.logs == null) || webhook.logs.length === 0) {\n          return updateLogs().then(function() {\n            return timeout(0, function() {\n              $el.find(\".webhooks-history\").toggleClass(\"open\");\n              return updateShowHideHistoryText();\n            });\n          });\n        } else {\n          $el.find(\".webhooks-history\").toggleClass(\"open\");\n          return $scope.$apply(function() {\n            return updateShowHideHistoryText();\n          });\n        }\n      });\n      $el.on(\"click\", \".history-single\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"history-single-open\");\n        return target.siblings(\".history-single-response\").toggleClass(\"open\");\n      });\n      return $el.on(\"click\", \".resend-request\", function(event) {\n        var log, target;\n        target = angular.element(event.currentTarget);\n        log = target.data(\"log\");\n        return $rs.webhooklogs.resend(log).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", WebhookDirective]);\n\n  NewWebhookDirective = function($rs, $repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var addWebhookDOMNode, formDOMNode, initializeNewValue, save, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      formDOMNode = $el.find(\".new-webhook-form\");\n      addWebhookDOMNode = $el.find(\".add-webhook\");\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"url\": \"\",\n          \"key\": \"\"\n        };\n      };\n      initializeNewValue();\n      $scope.$watch(\"webhooks\", function(webhooks) {\n        if (webhooks != null) {\n          if (webhooks.length === 0) {\n            formDOMNode.removeClass(\"hidden\");\n            addWebhookDOMNode.addClass(\"hidden\");\n            return formDOMNode.find(\"input\")[0].focus();\n          } else {\n            formDOMNode.addClass(\"hidden\");\n            return addWebhookDOMNode.removeClass(\"hidden\");\n          }\n        }\n      });\n      save = debounce(2000, function() {\n        var form, promise;\n        form = formDOMNode.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        promise = $repo.create(\"webhooks\", $scope.newValue);\n        promise.then((function(_this) {\n          return function() {\n            $scope.$emit(\"webhooks:reload\");\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      formDOMNode.on(\"click\", \".add-new\", function(event) {\n        event.preventDefault();\n        return save();\n      });\n      formDOMNode.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return save();\n        }\n      });\n      formDOMNode.on(\"click\", \".cancel-new\", function(event) {\n        return $scope.$apply(function() {\n          initializeNewValue();\n          if ($scope.webhooks.length >= 1) {\n            return formDOMNode.addClass(\"hidden\");\n          }\n        });\n      });\n      return addWebhookDOMNode.on(\"click\", function(event) {\n        formDOMNode.removeClass(\"hidden\");\n        return formDOMNode.find(\"input\")[0].focus();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", NewWebhookDirective]);\n\n  GithubController = (function(superClass) {\n    extend(GithubController, superClass);\n\n    GithubController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GithubController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITHUB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITHUB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GithubController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"github\").then((function(_this) {\n        return function(github) {\n          return _this.scope.github = github;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GithubController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GithubController\", GithubController);\n\n  GitlabController = (function(superClass) {\n    extend(GitlabController, superClass);\n\n    GitlabController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GitlabController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITLAB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITLAB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    GitlabController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gitlab\").then((function(_this) {\n        return function(gitlab) {\n          return _this.scope.gitlab = gitlab;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GitlabController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GitlabController\", GitlabController);\n\n  BitbucketController = (function(superClass) {\n    extend(BitbucketController, superClass);\n\n    BitbucketController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function BitbucketController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.BITBUCKET.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.BITBUCKET.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    BitbucketController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"bitbucket\").then((function(_this) {\n        return function(bitbucket) {\n          return _this.scope.bitbucket = bitbucket;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return BitbucketController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BitbucketController\", BitbucketController);\n\n  SelectInputText = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".select-input-content\", function() {\n        $el.find(\"input\").select();\n        return $el.find(\".help-copy\").addClass(\"visible\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSelectInputText\", SelectInputText);\n\n  GithubWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.github, \"github\");\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGithubWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GithubWebhooksDirective]);\n\n  GitlabWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gitlab, \"gitlab\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGitlabWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GitlabWebhooksDirective]);\n\n  BitbucketWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.bitbucket, \"bitbucket\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBitbucketWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", BitbucketWebhooksDirective]);\n\n  ValidOriginIpsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $ngModel) {\n      return $ngModel.$parsers.push(function(value) {\n        value = $.trim(value);\n        if (value === \"\") {\n          return [];\n        }\n        return value.split(\",\");\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgValidOriginIps\", ValidOriginIpsDirective);\n\n}).call(this);\n\n(function() {\n  var createProjectRestrictionDirective, module;\n\n  module = angular.module(\"taigaProject\");\n\n  createProjectRestrictionDirective = function() {\n    return {\n      templateUrl: \"project/wizard-restrictions.html\"\n    };\n  };\n\n  module.directive('tgCreateProjectRestriction', [createProjectRestrictionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var CreateProject, DeleteProjectDirective, bindOnce, debounce, module, taiga, timeout;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaProject\");\n\n  CreateProject = function($rootscope, $repo, $confirm, $location, $navurls, $rs, $projectUrl, $loading, lightboxService, $cacheFactory, $translate, currentUserService, $auth) {\n    var directive, link;\n    link = function($scope, $el, attrs) {\n      var currentLoading, form, onErrorSubmit, onSuccessSubmit, openLightbox, submit, submitButton;\n      $scope.data = {};\n      $scope.templates = [];\n      currentLoading = null;\n      $auth.refresh();\n      $scope.canCreatePrivateProjects = currentUserService.canCreatePrivateProjects();\n      $scope.canCreatePublicProjects = currentUserService.canCreatePublicProjects();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      onSuccessSubmit = function(response) {\n        $cacheFactory.get('$http').removeAll();\n        currentLoading.finish();\n        $rootscope.$broadcast(\"projects:reload\");\n        $confirm.notify(\"success\", $translate.instant(\"COMMON.SAVE\"));\n        $location.url($projectUrl.get(response));\n        lightboxService.close($el);\n        return currentUserService.loadProjects();\n      };\n      onErrorSubmit = function(response) {\n        var error_field, i, len, ref, results, selectors;\n        currentLoading.finish();\n        form.setErrors(response);\n        selectors = [];\n        ref = _.keys(response);\n        results = [];\n        for (i = 0, len = ref.length; i < len; i++) {\n          error_field = ref[i];\n          results.push(selectors.push(\"[name=\" + error_field + \"]\"));\n        }\n        return results;\n      };\n      submit = (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"projects\", $scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this);\n      openLightbox = function() {\n        $scope.data = {\n          is_private: false\n        };\n        if (!$scope.templates.length) {\n          $rs.projects.templates().then((function(_this) {\n            return function(result) {\n              $scope.templates = result;\n              return $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n                return x.slug === \"scrum\";\n              })).id;\n            };\n          })(this));\n        } else {\n          $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n            return x.slug === \"scrum\";\n          })).id;\n        }\n        return lightboxService.open($el);\n      };\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"project/wizard-create-project.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbCreateProject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$tgResources\", \"$projectUrl\", \"$tgLoading\", \"lightboxService\", \"$cacheFactory\", \"$translate\", \"tgCurrentUserService\", \"$tgAuth\", CreateProject]);\n\n  DeleteProjectDirective = function($repo, $rootscope, $auth, $location, $navUrls, $confirm, lightboxService, tgLoader, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var projectToDelete, submit;\n      projectToDelete = null;\n      $scope.$on(\"deletelightbox:new\", function(ctx, project) {\n        lightboxService.open($el);\n        return projectToDelete = project;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        tgLoader.start();\n        lightboxService.close($el);\n        promise = $repo.remove(projectToDelete);\n        promise.then(function(data) {\n          tgLoader.pageLoaded();\n          $rootscope.$broadcast(\"projects:reload\");\n          $location.path($navUrls.resolve(\"home\"));\n          $confirm.notify(\"success\");\n          return currentUserService.loadProjects();\n        });\n        return promise.then(null, function() {\n          $confirm.notify(\"error\");\n          return lightboxService.close($el);\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDeleteProject\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfirm\", \"lightboxService\", \"tgLoader\", \"tgCurrentUserService\", DeleteProjectDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/bind.coffee\n */\n\n(function() {\n  var BindHtmlDirective, BindOnceAltDirective, BindOnceBindDirective, BindOnceHrefDirective, BindOnceHtmlDirective, BindOnceRefDirective, BindOnceSrcDirective, BindOnceTitleDirective, BindTitleDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  BindOnceBindDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoBind, function(val) {\n        return $el.text(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHtml, function(val) {\n        return $el.html(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceRefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoRef, function(val) {\n        return $el.html(\"#\" + val + \" \");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceSrcDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoSrc, function(val) {\n        return $el.attr(\"src\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHrefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHref, function(val) {\n        return $el.attr(\"href\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceAltDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoAlt, function(val) {\n        return $el.attr(\"alt\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoTitle, function(val) {\n        return $el.attr(\"title\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgTitleHtml, function(val) {\n        if (val != null) {\n          return $el.attr(\"title\", val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgBindHtml, function(val) {\n        if (val != null) {\n          return $el.html(val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.directive(\"tgBoBind\", BindOnceBindDirective);\n\n  module.directive(\"tgBoHtml\", BindOnceHtmlDirective);\n\n  module.directive(\"tgBoRef\", BindOnceRefDirective);\n\n  module.directive(\"tgBoSrc\", BindOnceSrcDirective);\n\n  module.directive(\"tgBoHref\", BindOnceHrefDirective);\n\n  module.directive(\"tgBoAlt\", BindOnceAltDirective);\n\n  module.directive(\"tgBoTitle\", BindOnceTitleDirective);\n\n  module.directive(\"tgBindTitle\", BindTitleDirective);\n\n  module.directive(\"tgBindHtml\", BindHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/conf.coffee\n */\n\n(function() {\n  var ConfigurationService, module;\n\n  ConfigurationService = (function() {\n    function ConfigurationService() {\n      this.config = window.taigaConfig;\n    }\n\n    ConfigurationService.prototype.get = function(key, defaultValue) {\n      if (defaultValue == null) {\n        defaultValue = null;\n      }\n      if (_.has(this.config, key)) {\n        return this.config[key];\n      }\n      return defaultValue;\n    };\n\n    return ConfigurationService;\n\n  })();\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgConfig\", ConfigurationService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/contrib.coffee\n */\n\n(function() {\n  var ContribController, ContribUserSettingsController, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaBase\");\n\n  ContribController = (function(superClass) {\n    extend(ContribController, superClass);\n\n    ContribController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\"];\n\n    function ContribController(rootScope, scope, params, repo, rs, confirm) {\n      var promise;\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.adminPlugins, {\n        \"slug\": this.params.plugin\n      }));\n      this.scope.projectSlug = this.params.pslug;\n      promise = this.loadInitialData();\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    }\n\n    ContribController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.$broadcast('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ContribController.prototype.loadInitialData = function() {\n      return this.loadProject();\n    };\n\n    return ContribController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribController\", ContribController);\n\n  ContribUserSettingsController = (function(superClass) {\n    extend(ContribUserSettingsController, superClass);\n\n    ContribUserSettingsController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\"];\n\n    function ContribUserSettingsController(rootScope, scope, params) {\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.userSettingsPlugins, {\n        \"slug\": this.params.plugin\n      }));\n    }\n\n    return ContribUserSettingsController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribUserSettingsController\", ContribUserSettingsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/filters.coffee\n */\n\n(function() {\n  var FiltersStorageService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  FiltersStorageService = (function(superClass) {\n    extend(FiltersStorageService, superClass);\n\n    FiltersStorageService.$inject = [\"$tgStorage\", \"$routeParams\"];\n\n    function FiltersStorageService(storage, params) {\n      this.storage = storage;\n      this.params = params;\n    }\n\n    FiltersStorageService.prototype.generateHash = function(components) {\n      if (components == null) {\n        components = [];\n      }\n      components = _.map(components, function(x) {\n        return JSON.stringify(x);\n      });\n      return hex_sha1(components.join(\":\"));\n    };\n\n    return FiltersStorageService;\n\n  })(taiga.Service);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var HttpService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  HttpService = (function(superClass) {\n    extend(HttpService, superClass);\n\n    HttpService.$inject = [\"$http\", \"$q\", \"$tgStorage\", \"$rootScope\", \"$cacheFactory\", \"$translate\"];\n\n    function HttpService(http, q, storage, rootScope, cacheFactory, translate) {\n      this.http = http;\n      this.q = q;\n      this.storage = storage;\n      this.rootScope = rootScope;\n      this.cacheFactory = cacheFactory;\n      this.translate = translate;\n      HttpService.__super__.constructor.call(this);\n      this.cache = this.cacheFactory(\"httpget\");\n    }\n\n    HttpService.prototype.headers = function() {\n      var headers, lang, token;\n      headers = {};\n      token = this.storage.get('token');\n      if (token) {\n        headers[\"Authorization\"] = \"Bearer \" + token;\n      }\n      lang = this.translate.preferredLanguage();\n      if (lang) {\n        headers[\"Accept-Language\"] = lang;\n      }\n      return headers;\n    };\n\n    HttpService.prototype.request = function(options) {\n      options.headers = _.assign({}, options.headers || {}, this.headers());\n      return this.http(options);\n    };\n\n    HttpService.prototype.get = function(url, params, options) {\n      options = _.assign({\n        method: \"GET\",\n        url: url\n      }, options);\n      if (params) {\n        options.params = params;\n      }\n      options.cache = this.cache;\n      return this.request(options)[\"finally\"]((function(_this) {\n        return function(data) {\n          return _this.cache.removeAll();\n        };\n      })(this));\n    };\n\n    HttpService.prototype.post = function(url, data, params, options) {\n      options = _.assign({\n        method: \"POST\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.put = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PUT\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.patch = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PATCH\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype[\"delete\"] = function(url, data, params, options) {\n      options = _.assign({\n        method: \"DELETE\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    return HttpService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgHttp\", HttpService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/location.coffee\n */\n\n(function() {\n  var locationFactory, module;\n\n  locationFactory = function($location, $route, $rootscope) {\n    $location.noreload = function(scope) {\n      var lastRoute, un;\n      lastRoute = $route.current;\n      un = scope.$on(\"$locationChangeSuccess\", function() {\n        $route.current = lastRoute;\n        return un();\n      });\n      return $location;\n    };\n    $location.isInCurrentRouteParams = function(name, value) {\n      var params;\n      params = $location.search() || {};\n      return params[name] === value;\n    };\n    return $location;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgLocation\", [\"$location\", \"$route\", \"$rootScope\", locationFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/model.coffee\n */\n\n(function() {\n  var Model, ModelService, module, provider, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    function Model(name, data, dataTypes) {\n      this._attrs = data;\n      this._name = name;\n      this._dataTypes = dataTypes;\n      this.setAttrs(data);\n      this.initialize();\n    }\n\n    Model.prototype.clone = function() {\n      var instance;\n      instance = new Model(this._name, this._attrs, this._dataTypes);\n      instance._modifiedAttrs = this._modifiedAttrs;\n      instance._isModified = this._isModified;\n      return instance;\n    };\n\n    Model.prototype.applyCasts = function() {\n      var attrName, castMethod, castName, ref, results;\n      ref = this._dataTypes;\n      results = [];\n      for (attrName in ref) {\n        castName = ref[attrName];\n        castMethod = service.casts[castName];\n        if (!castMethod) {\n          continue;\n        }\n        results.push(this._attrs[attrName] = castMethod(this._attrs[attrName]));\n      }\n      return results;\n    };\n\n    Model.prototype.getIdAttrName = function() {\n      return \"id\";\n    };\n\n    Model.prototype.getName = function() {\n      return this._name;\n    };\n\n    Model.prototype.getAttrs = function(patch) {\n      if (patch == null) {\n        patch = false;\n      }\n      if (this._attrs.version != null) {\n        this._modifiedAttrs.version = this._attrs.version;\n      }\n      if (patch) {\n        return _.extend({}, this._modifiedAttrs);\n      }\n      return _.extend({}, this._attrs, this._modifiedAttrs);\n    };\n\n    Model.prototype.setAttrs = function(attrs) {\n      this._attrs = attrs;\n      this._modifiedAttrs = {};\n      this.applyCasts();\n      return this._isModified = false;\n    };\n\n    Model.prototype.setAttr = function(name, value) {\n      this._modifiedAttrs[name] = value;\n      return this._isModified = true;\n    };\n\n    Model.prototype.initialize = function() {\n      var getter, self, setter;\n      self = this;\n      getter = function(name) {\n        return function() {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            return self[name];\n          }\n          if (indexOf.call(_.keys(self._modifiedAttrs), name) < 0) {\n            return self._attrs[name];\n          }\n          return self._modifiedAttrs[name];\n        };\n      };\n      setter = function(name) {\n        return function(value) {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            self[name] = value;\n            return;\n          }\n          if (self._attrs[name] !== value) {\n            self._modifiedAttrs[name] = value;\n            self._isModified = true;\n          } else {\n            delete self._modifiedAttrs[name];\n          }\n        };\n      };\n      return _.each(this._attrs, function(value, name) {\n        var options;\n        options = {\n          get: getter(name),\n          set: setter(name),\n          enumerable: true,\n          configurable: true\n        };\n        return Object.defineProperty(self, name, options);\n      });\n    };\n\n    Model.prototype.serialize = function() {\n      var data;\n      data = {\n        \"data\": _.clone(this._attrs),\n        \"name\": this._name\n      };\n      return JSON.stringify(data);\n    };\n\n    Model.prototype.isModified = function() {\n      return this._isModified;\n    };\n\n    Model.prototype.isAttributeModified = function(attribute) {\n      return this._modifiedAttrs[attribute] != null;\n    };\n\n    Model.prototype.markSaved = function() {\n      this._isModified = false;\n      this._attrs = this.getAttrs();\n      return this._modifiedAttrs = {};\n    };\n\n    Model.prototype.revert = function() {\n      this._modifiedAttrs = {};\n      return this._isModified = false;\n    };\n\n    Model.desSerialize = function(sdata) {\n      var ddata, model;\n      ddata = JSON.parse(sdata);\n      model = new Model(ddata.url, ddata.data);\n      return model;\n    };\n\n    return Model;\n\n  })();\n\n  taiga = this.taiga;\n\n  ModelService = (function(superClass) {\n    extend(ModelService, superClass);\n\n    ModelService.$inject = [\"$q\", \"$tgUrls\", \"$tgStorage\", \"$tgHttp\"];\n\n    function ModelService(q, urls, storage, http) {\n      this.q = q;\n      this.urls = urls;\n      this.storage = storage;\n      this.http = http;\n      ModelService.__super__.constructor.call(this);\n    }\n\n    return ModelService;\n\n  })(taiga.Service);\n\n  provider = function($q, $http, $gmUrls, $gmStorage) {\n    var service;\n    service = {};\n    service.make_model = function(name, data, cls, dataTypes) {\n      if (cls == null) {\n        cls = Model;\n      }\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      return new cls(name, data, dataTypes);\n    };\n    service.cls = Model;\n    service.casts = {\n      int: function(value) {\n        return parseInt(value, 10);\n      },\n      float: function(value) {\n        return parseFloat(value, 10);\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgModel\", [\"$q\", \"$http\", \"$tgUrls\", \"$tgStorage\", provider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/navurl.coffee\n */\n\n(function() {\n  var NavigationUrlsDirective, NavigationUrlsService, bindOnce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\");\n\n  NavigationUrlsService = (function(superClass) {\n    extend(NavigationUrlsService, superClass);\n\n    function NavigationUrlsService() {\n      this.urls = {};\n    }\n\n    NavigationUrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge({}, this.urls, urls || {});\n    };\n\n    NavigationUrlsService.prototype.formatUrl = function(url, ctx) {\n      var replacer;\n      if (ctx == null) {\n        ctx = {};\n      }\n      replacer = function(match) {\n        match = trim(match, \":\");\n        return ctx[match] || \"undefined\";\n      };\n      return url.replace(/(:\\w+)/g, replacer);\n    };\n\n    NavigationUrlsService.prototype.resolve = function(name, ctx) {\n      var url;\n      url = this.urls[name];\n      if (!url) {\n        return \"\";\n      }\n      if (ctx) {\n        return this.formatUrl(url, ctx);\n      }\n      return url;\n    };\n\n    return NavigationUrlsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgNavUrls\", NavigationUrlsService);\n\n  NavigationUrlsDirective = function($navurls, $auth, $q, $location, lightboxService) {\n    var bindOnceP, link, parseNav;\n    bindOnceP = function($scope, attr) {\n      var defered;\n      defered = $q.defer();\n      bindOnce($scope, attr, function(v) {\n        return defered.resolve(v);\n      });\n      return defered.promise;\n    };\n    parseNav = function(data, $scope) {\n      var index, name, obj, params, promises, ref, result, values;\n      ref = _.map(data.split(\":\"), trim), name = ref[0], params = ref[1];\n      if (params) {\n        result = params.split(/(\\w+)=/);\n        result = _.filter(result, function(str) {\n          return str.length;\n        });\n        result = _.map(result, function(str) {\n          return trim(str.replace(/,$/g, ''));\n        });\n        params = [];\n        index = 0;\n        while (index < result.length) {\n          obj = {};\n          obj[result[index]] = result[index + 1];\n          params.push(obj);\n          index = index + 2;\n        }\n      } else {\n        params = [];\n      }\n      values = _.map(params, function(param) {\n        return _.values(param)[0];\n      });\n      promises = _.map(values, function(x) {\n        return bindOnceP($scope, x);\n      });\n      return $q.all(promises).then(function() {\n        var i, key, len, options, param, value;\n        options = {};\n        for (i = 0, len = params.length; i < len; i++) {\n          param = params[i];\n          key = Object.keys(param)[0];\n          value = param[key];\n          options[key] = $scope.$eval(value);\n        }\n        return [name, options];\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      if ($el.is(\"a\")) {\n        $el.attr(\"href\", \"#\");\n      }\n      $el.on(\"mouseenter\", function(event) {\n        var target;\n        target = $(event.currentTarget);\n        if (!target.data(\"fullUrl\") || $attrs.tgNavGetParams !== target.data(\"params\")) {\n          return parseNav($attrs.tgNav, $scope).then(function(result) {\n            var fullUrl, getURLParams, getURLParamsStr, name, options, url, user;\n            name = result[0], options = result[1];\n            user = $auth.getUser();\n            if (user) {\n              options.user = user.username;\n            }\n            url = $navurls.resolve(name);\n            fullUrl = $navurls.formatUrl(url, options);\n            if ($attrs.tgNavGetParams) {\n              getURLParams = JSON.parse($attrs.tgNavGetParams);\n              getURLParamsStr = $.param(getURLParams);\n              fullUrl = fullUrl + \"?\" + getURLParamsStr;\n              target.data(\"params\", $attrs.tgNavGetParams);\n            }\n            target.data(\"fullUrl\", fullUrl);\n            if (target.is(\"a\")) {\n              target.attr(\"href\", fullUrl);\n            }\n            return $el.on(\"click\", function(event) {\n              if (event.metaKey || event.ctrlKey) {\n                return;\n              }\n              event.preventDefault();\n              target = $(event.currentTarget);\n              if (target.hasClass('noclick')) {\n                return;\n              }\n              fullUrl = target.data(\"fullUrl\");\n              switch (event.which) {\n                case 1:\n                  $location.url(fullUrl);\n                  $scope.$apply();\n                  break;\n                case 2:\n                  window.open(fullUrl);\n              }\n              return lightboxService.closeAll();\n            });\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNav\", [\"$tgNavUrls\", \"$tgAuth\", \"$q\", \"$tgLocation\", \"lightboxService\", NavigationUrlsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/repository.coffee\n */\n\n(function() {\n  var RepositoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  RepositoryService = (function(superClass) {\n    extend(RepositoryService, superClass);\n\n    RepositoryService.$inject = [\"$q\", \"$tgModel\", \"$tgStorage\", \"$tgHttp\", \"$tgUrls\"];\n\n    function RepositoryService(q, model1, storage, http, urls) {\n      this.q = q;\n      this.model = model1;\n      this.storage = storage;\n      this.http = http;\n      this.urls = urls;\n      RepositoryService.__super__.constructor.call(this);\n    }\n\n    RepositoryService.prototype.resolveUrlForModel = function(model) {\n      var idAttrName;\n      idAttrName = model.getIdAttrName();\n      return (this.urls.resolve(model.getName())) + \"/\" + model[idAttrName];\n    };\n\n    RepositoryService.prototype.resolveUrlForAttributeModel = function(model) {\n      return this.urls.resolve(model.getName(), model.parent);\n    };\n\n    RepositoryService.prototype.create = function(name, data, dataTypes, extraParams) {\n      var defered, promise, url;\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      defered = this.q.defer();\n      url = this.urls.resolve(name);\n      promise = this.http.post(url, JSON.stringify(data));\n      promise.success((function(_this) {\n        return function(_data, _status) {\n          return defered.resolve(_this.model.make_model(name, _data, null, dataTypes));\n        };\n      })(this));\n      promise.error((function(_this) {\n        return function(data, status) {\n          return defered.reject(data);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.remove = function(model, params) {\n      var defered, promise, url;\n      if (params == null) {\n        params = {};\n      }\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http[\"delete\"](url, {}, params);\n      promise.success(function(data, status) {\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(model);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAll = function(models, patch) {\n      var promises;\n      if (patch == null) {\n        patch = true;\n      }\n      promises = _.map(models, (function(_this) {\n        return function(x) {\n          return _this.save(x, true);\n        };\n      })(this));\n      return this.q.all(promises);\n    };\n\n    RepositoryService.prototype.save = function(model, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForModel(model);\n      data = JSON.stringify(model.getAttrs(patch));\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAttribute = function(model, attribute, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForAttributeModel(model);\n      data = {};\n      data[attribute] = model.getAttrs();\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.refresh = function(model) {\n      var defered, promise, url;\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http.get(url);\n      promise.success(function(data, status) {\n        model._modifiedAttrs = {};\n        model._attrs = data;\n        model._isModified = false;\n        model.applyCasts();\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.queryMany = function(name, params, options, headers) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      if (headers == null) {\n        headers = false;\n      }\n      url = this.urls.resolve(name);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var result;\n          result = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          if (headers) {\n            return [result, data.headers];\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneAttribute = function(name, id, attribute, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name, id);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var model;\n          model = _this.model.make_model(name, data.data[attribute]);\n          model.parent = id;\n          return model;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOne = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return _this.model.make_model(name, data.data);\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryPaginated = function(name, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.models = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOnePaginatedRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.data = data.data;\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.resolve = function(options) {\n      var cache, params;\n      params = {};\n      if (options.pslug != null) {\n        params.project = options.pslug;\n      }\n      if (options.usref != null) {\n        params.us = options.usref;\n      }\n      if (options.taskref != null) {\n        params.task = options.taskref;\n      }\n      if (options.issueref != null) {\n        params.issue = options.issueref;\n      }\n      if (options.sslug != null) {\n        params.milestone = options.sslug;\n      }\n      if (options.wikipage != null) {\n        params.wikipage = options.wikipage;\n      }\n      cache = !(options.wikipage || options.sslug);\n      return this.queryOneRaw(\"resolver\", null, params, {\n        cache: cache\n      });\n    };\n\n    return RepositoryService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgRepo\", RepositoryService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/storage.coffee\n */\n\n(function() {\n  var StorageService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  StorageService = (function(superClass) {\n    extend(StorageService, superClass);\n\n    StorageService.$inject = [\"$rootScope\"];\n\n    function StorageService($rootScope) {\n      StorageService.__super__.constructor.call(this);\n    }\n\n    StorageService.prototype.get = function(key, _default) {\n      var serializedValue;\n      serializedValue = localStorage.getItem(key);\n      if (serializedValue === null) {\n        return _default || null;\n      }\n      return JSON.parse(serializedValue);\n    };\n\n    StorageService.prototype.set = function(key, val) {\n      if (_.isObject(key)) {\n        return _.each(key, (function(_this) {\n          return function(val, key) {\n            return _this.set(key, val);\n          };\n        })(this));\n      } else {\n        return localStorage.setItem(key, JSON.stringify(val));\n      }\n    };\n\n    StorageService.prototype.contains = function(key) {\n      var value;\n      value = this.get(key);\n      return value !== null;\n    };\n\n    StorageService.prototype.remove = function(key) {\n      return localStorage.removeItem(key);\n    };\n\n    StorageService.prototype.clear = function() {\n      return localStorage.clear();\n    };\n\n    return StorageService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgStorage\", StorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var UrlsService, format, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  format = function(fmt, obj) {\n    obj = _.clone(obj);\n    return fmt.replace(/%s/g, function(match) {\n      return String(obj.shift());\n    });\n  };\n\n  taiga = this.taiga;\n\n  UrlsService = (function(superClass) {\n    extend(UrlsService, superClass);\n\n    UrlsService.$inject = [\"$tgConfig\"];\n\n    function UrlsService(config) {\n      this.config = config;\n      this.urls = {};\n      this.mainUrl = this.config.get(\"api\");\n    }\n\n    UrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge(this.urls, urls);\n    };\n\n    UrlsService.prototype.resolve = function() {\n      var args, name, url;\n      args = _.toArray(arguments);\n      if (args.length === 0) {\n        throw Error(\"wrong arguments to setUrls\");\n      }\n      name = args.slice(0, 1)[0];\n      url = format(this.urls[name], args.slice(1));\n      return format(\"%s/%s\", [_.trimEnd(this.mainUrl, \"/\"), _.trimStart(url, \"/\")]);\n    };\n\n    UrlsService.prototype.resolveAbsolute = function() {\n      var url;\n      url = this.resolve.apply(this, arguments);\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n      if (/^\\//.test(url)) {\n        return window.location.protocol + \"//\" + window.location.host + url;\n      }\n      return window.location.protocol + \"//\" + window.location.host + \"/\" + url;\n    };\n\n    return UrlsService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service('$tgUrls', UrlsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/custom-field-values.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var _get, service;\n    _get = function(objectId, resource) {\n      return $repo.queryOne(resource, objectId);\n    };\n    service = {\n      userstory: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/userstory\");\n        }\n      },\n      task: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/task\");\n        }\n      },\n      issue: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributesValues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesValuesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var _list, service;\n    _list = function(projectId, resource) {\n      return $repo.queryMany(resource, {\n        project: projectId\n      });\n    };\n    service = {\n      userstory: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/userstory\");\n        }\n      },\n      task: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/task\");\n        }\n      },\n      issue: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributes = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/history.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(type, objectId) {\n      return $repo.queryOneRaw(\"history/\" + type, objectId);\n    };\n    service.deleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/delete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.undeleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/undelete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.history = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgHistoryResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.get = function(token) {\n      return $repo.queryOne(\"invitations\", token);\n    };\n    return function(instance) {\n      return instance.invitations = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgInvitationsResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/issues.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var filtersHashSuffix, hashSuffix, myFiltersHashSuffix, service;\n    service = {};\n    hashSuffix = \"issues-queryparams\";\n    filtersHashSuffix = \"issues-filters\";\n    myFiltersHashSuffix = \"issues-my-filters\";\n    service.get = function(projectId, issueId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"issues\", issueId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"issues\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"issues\", filters);\n    };\n    service.list = function(projectId, filters, options) {\n      var params;\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryPaginated(\"issues\", params, options);\n    };\n    service.bulkCreate = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-issues\");\n      params = {\n        project_id: projectId,\n        bulk_issues: data\n      };\n      return $http.post(url, params);\n    };\n    service.upvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-upvote\", issueId);\n      return $http.post(url);\n    };\n    service.downvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-downvote\", issueId);\n      return $http.post(url);\n    };\n    service.watch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-watch\", issueId);\n      return $http.post(url);\n    };\n    service.unwatch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-unwatch\", issueId);\n      return $http.post(url);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/issues_stats\");\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"issues-filters\", null, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeFilters = function(projectSlug, params) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getFilters = function(projectSlug) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeMyFilters = function(projectId, myFilters) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      if (_.isEmpty(myFilters)) {\n        promise = $http[\"delete\"](url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function() {\n          return deferred.resolve();\n        });\n        promise.then(null, function() {\n          return deferred.reject();\n        });\n      } else {\n        promise = $http.put(url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function(data) {\n          return deferred.resolve();\n        });\n        promise.then(null, function(data) {\n          var innerPromise;\n          innerPromise = $http.post(\"\" + url, {\n            key: hash,\n            value: myFilters\n          });\n          innerPromise.then(function() {\n            return deferred.resolve();\n          });\n          return innerPromise.then(null, function() {\n            return deferred.reject();\n          });\n        });\n      }\n      return deferred.promise;\n    };\n    service.getMyFilters = function(projectId) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      promise = $http.get(url + \"/\" + hash);\n      promise.then(function(data) {\n        return deferred.resolve(data.data.value);\n      });\n      promise.then(null, function(data) {\n        return deferred.resolve({});\n      });\n      return deferred.promise;\n    };\n    return function(instance) {\n      return instance.issues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgIssuesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/kanban.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($storage) {\n    var hashSuffixStatusColumnModes, hashSuffixStatusViewModes, service;\n    service = {};\n    hashSuffixStatusViewModes = \"kanban-statusviewmodels\";\n    hashSuffixStatusColumnModes = \"kanban-statuscolumnmodels\";\n    service.storeStatusViewModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusViewModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.kanban = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgKanbanResourcesProvider\", [\"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/locales.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {\n      list: function() {\n        return $repo.queryMany(\"locales\");\n      }\n    };\n    return function(instance) {\n      return instance.locales = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgLocalesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/mdrender.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.render = function(projectId, content) {\n      var params, url;\n      if ((content == null) || content === \"\") {\n        content = ' ';\n      }\n      params = {\n        project_id: projectId,\n        content: content\n      };\n      url = $urls.resolve(\"wiki\");\n      return $http.post(url + \"/render\", params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.mdrender = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMdRenderResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"memberships\", id);\n    };\n    service.list = function(projectId, filters, enablePagination) {\n      var options, params;\n      if (enablePagination == null) {\n        enablePagination = true;\n      }\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      if (enablePagination) {\n        return $repo.queryPaginated(\"memberships\", params);\n      }\n      return $repo.queryMany(\"memberships\", params, options = {\n        enablePagination: enablePagination\n      });\n    };\n    service.listByUser = function(userId, filters) {\n      var params;\n      params = {\n        user: userId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryPaginated(\"memberships\", params);\n    };\n    service.resendInvitation = function(id) {\n      var url;\n      url = $urls.resolve(\"memberships\");\n      return $http.post(url + \"/\" + id + \"/resend_invitation\", {});\n    };\n    service.bulkCreateMemberships = function(projectId, data, invitation_extra_text) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-memberships\");\n      params = {\n        project_id: projectId,\n        bulk_memberships: data,\n        invitation_extra_text: invitation_extra_text\n      };\n      return $http.post(url, params);\n    };\n    return function(instance) {\n      return instance.memberships = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMembershipsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.list = function(projectId, module) {\n      return $repo.queryOneAttribute(\"project-modules\", projectId, module);\n    };\n    return function(instance) {\n      return instance.modules = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgModulesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"notify-policies\", id);\n    };\n    service.list = function(filters) {\n      var params;\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"notify-policies\", params);\n    };\n    return function(instance) {\n      return instance.notifyPolicies = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgNotifyPoliciesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $auth, $q, $translate) {\n    var service;\n    service = {};\n    service.get = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId);\n    };\n    service.getBySlug = function(projectSlug) {\n      return $repo.queryOne(\"projects\", \"by_slug?slug=\" + projectSlug);\n    };\n    service.list = function() {\n      return $repo.queryMany(\"projects\");\n    };\n    service.listByMember = function(memberId) {\n      var params;\n      params = {\n        \"member\": memberId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return $repo.queryMany(\"projects\", params);\n    };\n    service.templates = function() {\n      return $repo.queryMany(\"project-templates\");\n    };\n    service.usersList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"users\", params);\n    };\n    service.rolesList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"roles\", params);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/stats\");\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = $urls.resolve(\"bulk-update-projects-order\");\n      return $http.post(url, bulkData);\n    };\n    service.regenerate_userstories_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_userstories_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_issues_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_issues_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_tasks_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_tasks_csv_uuid\";\n      return $http.post(url);\n    };\n    service.leave = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/leave\";\n      return $http.post(url);\n    };\n    service.memberStats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/member_stats\");\n    };\n    service.tagsColors = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId + \"/tags_colors\");\n    };\n    service[\"export\"] = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"exporter\")) + \"/\" + projectId;\n      return $http.get(url);\n    };\n    service[\"import\"] = function(file, statusUpdater) {\n      var complete, data, defered, errorMsg, failed, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED\", {\n          fileName: file.name,\n          fileSize: sizeFormat(file.size),\n          maxFileSize: sizeFormat(maxFileSize)\n        });\n        response = {\n          status: 413,\n          data: {\n            _error_message: errorMsg\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          var message, percent;\n          percent = Math.round((evt.loaded / evt.total) * 100);\n          message = $translate.instant(\"PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE\", {\n            uploadedSize: sizeFormat(evt.loaded),\n            totalSize: sizeFormat(evt.total)\n          });\n          return statusUpdater(\"in-progress\", null, message, percent);\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"done\", $translate.instant(\"PROJECT.IMPORT.TITLE\"), $translate.instant(\"PROJECT.IMPORT.DESCRIPTION\"));\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"error\");\n        };\n      })(this);\n      complete = (function(_this) {\n        return function(evt) {\n          var error, ref;\n          response = {};\n          try {\n            response.data = JSON.parse(evt.target.responseText);\n          } catch (error) {\n            response.data = {};\n          }\n          response.status = evt.target.status;\n          if (evt.target.getResponseHeader('Taiga-Info-Project-Is-Private')) {\n            response.headers = {\n              isPrivate: evt.target.getResponseHeader('Taiga-Info-Project-Is-Private') === 'True',\n              memberships: parseInt(evt.target.getResponseHeader('Taiga-Info-Project-Memberships'))\n            };\n          }\n          if ((ref = response.status) === 201 || ref === 202) {\n            defered.resolve(response);\n          }\n          return defered.reject(response);\n        };\n      })(this);\n      failed = (function(_this) {\n        return function(evt) {\n          return defered.reject(\"fail\");\n        };\n      })(this);\n      data = new FormData();\n      data.append('dump', file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.upload.addEventListener(\"load\", uploadComplete, false);\n      xhr.upload.addEventListener(\"error\", uploadFailed, false);\n      xhr.upload.addEventListener(\"abort\", uploadFailed, false);\n      xhr.addEventListener(\"load\", complete, false);\n      xhr.addEventListener(\"error\", failed, false);\n      xhr.open(\"POST\", $urls.resolve(\"importer\"));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    service.changeLogo = function(projectId, file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('logo', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/change_logo\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeLogo = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/remove_logo\";\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.projects = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgProjectsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgAuth\", \"$q\", \"$translate\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"roles\", id);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"roles\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.roles = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgRolesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/search.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http, $q) {\n    var service;\n    service = {};\n    service[\"do\"] = function(projectId, term) {\n      var deferredAbort, params, request, url;\n      deferredAbort = $q.defer();\n      url = $urls.resolve(\"search\");\n      params = {\n        url: url,\n        method: \"GET\",\n        timeout: deferredAbort.promise,\n        cancelable: true,\n        params: {\n          project: projectId,\n          text: term,\n          get_all: false\n        }\n      };\n      request = $http.request(params).then(function(data) {\n        return data.data;\n      });\n      request.abort = function() {\n        return deferredAbort.resolve();\n      };\n      request[\"finally\"] = function() {\n        request.abort = angular.noop;\n        return deferredAbort = request = null;\n      };\n      return request;\n    };\n    return function(instance) {\n      return instance.search = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSearchResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/sprints.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $model, $storage) {\n    var service;\n    service = {};\n    service.get = function(projectId, sprintId) {\n      return $repo.queryOne(\"milestones\", sprintId).then(function(sprint) {\n        var uses;\n        uses = sprint.user_stories;\n        uses = _.map(uses, function(u) {\n          return $model.make_model(\"userstories\", u);\n        });\n        sprint._attrs.user_stories = uses;\n        return sprint;\n      });\n    };\n    service.stats = function(projectId, sprintId) {\n      return $repo.queryOneRaw(\"milestones\", sprintId + \"/stats\");\n    };\n    service.list = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"milestones\", params, {}, true).then((function(_this) {\n        return function(result) {\n          var headers, i, len, m, milestones, uses;\n          milestones = result[0];\n          headers = result[1];\n          for (i = 0, len = milestones.length; i < len; i++) {\n            m = milestones[i];\n            uses = m.user_stories;\n            uses = _.map(uses, function(u) {\n              return $model.make_model(\"userstories\", u);\n            });\n            m._attrs.user_stories = uses;\n          }\n          return {\n            milestones: milestones,\n            closed: parseInt(headers(\"Taiga-Info-Total-Closed-Milestones\"), 10),\n            open: parseInt(headers(\"Taiga-Info-Total-Opened-Milestones\"), 10)\n          };\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.sprints = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSprintsResourcesProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/tasks.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, hashSuffixStatusColumnModes, hashSuffixUsRowModes, service;\n    service = {};\n    hashSuffix = \"tasks-queryparams\";\n    hashSuffixStatusColumnModes = \"tasks-statuscolumnmodels\";\n    hashSuffixUsRowModes = \"tasks-usrowmodels\";\n    service.get = function(projectId, taskId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"tasks\", taskId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"tasks\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"tasks\", filters);\n    };\n    service.list = function(projectId, sprintId, userStoryId) {\n      var params;\n      if (sprintId == null) {\n        sprintId = null;\n      }\n      if (userStoryId == null) {\n        userStoryId = null;\n      }\n      params = {\n        project: projectId\n      };\n      if (sprintId) {\n        params.milestone = sprintId;\n      }\n      if (userStoryId) {\n        params.user_story = userStoryId;\n      }\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"tasks\", params);\n    };\n    service.bulkCreate = function(projectId, sprintId, usId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-tasks\");\n      params = {\n        project_id: projectId,\n        sprint_id: sprintId,\n        us_id: usId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params).then(function(result) {\n        return result.data;\n      });\n    };\n    service.upvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-upvote\", taskId);\n      return $http.post(url);\n    };\n    service.downvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-downvote\", taskId);\n      return $http.post(url);\n    };\n    service.watch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-watch\", taskId);\n      return $http.post(url);\n    };\n    service.unwatch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-unwatch\", taskId);\n      return $http.post(url);\n    };\n    service.bulkUpdateTaskTaskboardOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-task-taskboard-order\");\n      params = {\n        project_id: projectId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeUsRowModes = function(projectId, sprintId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getUsRowModes = function(projectId, sprintId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.tasks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgTasksResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $q) {\n    var service;\n    service = {};\n    service.changeAvatar = function(file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('avatar', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"users\")) + \"/change_avatar\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeAvatar = function() {\n      var url;\n      url = ($urls.resolve(\"users\")) + \"/remove_avatar\";\n      return $http.post(url);\n    };\n    service.changePassword = function(currentPassword, newPassword) {\n      var data, url;\n      url = ($urls.resolve(\"users\")) + \"/change_password\";\n      data = {\n        current_password: currentPassword,\n        password: newPassword\n      };\n      return $http.post(url, data);\n    };\n    return function(instance) {\n      return instance.userSettings = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserSettingsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/user.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($http, $urls) {\n    var service;\n    service = {};\n    service.contacts = function(userId, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = $urls.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return $http.get(url, {}, httpOptions).then(function(result) {\n        return result.data;\n      });\n    };\n    return function(instance) {\n      return instance.users = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUsersResourcesProvider\", [\"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/userstories.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"userstories-queryparams\";\n    service.get = function(projectId, usId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"userstories\", usId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"userstories\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"userstories\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"userstories-filters\", null, params);\n    };\n    service.listUnassigned = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId,\n        \"milestone\": \"null\"\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.listAll = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.bulkCreate = function(projectId, status, bulk) {\n      var data, url;\n      data = {\n        project_id: projectId,\n        status_id: status,\n        bulk_stories: bulk\n      };\n      url = $urls.resolve(\"bulk-create-us\");\n      return $http.post(url, data);\n    };\n    service.upvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-upvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.downvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-downvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.watch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-watch\", userStoryId);\n      return $http.post(url);\n    };\n    service.unwatch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-unwatch\", userStoryId);\n      return $http.post(url);\n    };\n    service.bulkUpdateBacklogOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-backlog-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateSprintOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-sprint-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateKanbanOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-kanban-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeShowTags = function(projectId, showTags) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.set(hash, showTags);\n    };\n    service.getShowTags = function(projectId) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.get(hash) || null;\n    };\n    return function(instance) {\n      return instance.userstories = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserstoriesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooklogs.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(webhookId) {\n      var params;\n      params = {\n        webhook: webhookId\n      };\n      return $repo.queryMany(\"webhooklogs\", params);\n    };\n    service.resend = function(webhooklogId) {\n      var url;\n      url = $urls.resolve(\"webhooklogs-resend\", webhooklogId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooklogs = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhookLogsResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooks.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(projectId) {\n      var params;\n      params = {\n        project: projectId\n      };\n      return $repo.queryMany(\"webhooks\", params);\n    };\n    service.test = function(webhookId) {\n      var url;\n      url = $urls.resolve(\"webhooks-test\", webhookId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhooksResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/wikis.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(wikiId) {\n      return $repo.queryOne(\"wiki\", wikiId);\n    };\n    service.getBySlug = function(projectId, slug) {\n      return $repo.queryOne(\"wiki\", \"by_slug?project=\" + projectId + \"&slug=\" + slug);\n    };\n    service.listLinks = function(projectId) {\n      return $repo.queryMany(\"wiki-links\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.wiki = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWikiResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var UserChangePasswordController, UserChangePasswordDirective, debounce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserChangePasswordController = (function(superClass) {\n    extend(UserChangePasswordController, superClass);\n\n    UserChangePasswordController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserChangePasswordController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = this.translate.instant(\"CHANGE_PASSWORD.SECTION_NAME\");\n      this.scope.user = this.auth.getUser();\n    }\n\n    return UserChangePasswordController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserChangePasswordController\", UserChangePasswordController);\n\n  UserChangePasswordDirective = function($rs, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, ctrl) {\n      var form, submit, submitButton;\n      form = new checksley.Form($el.find(\"form\"));\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.newPassword1 !== $scope.newPassword2) {\n            $confirm.notify('error', $translate.instant(\"CHANGE_PASSWORD.ERROR_PASSWORD_MATCH\"));\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userSettings.changePassword($scope.currentPassword, $scope.newPassword1);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify('success');\n          });\n          return promise.then(null, function(response) {\n            currentLoading.finish();\n            return $confirm.notify('error', response.data._error_message);\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserChangePassword\", [\"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", UserChangePasswordDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var DeleteUserDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  DeleteUserDirective = function($repo, $rootscope, $auth, $location, $navUrls, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, submitButton;\n      $scope.$on(\"deletelightbox:new\", function(ctx, user) {\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var currentLoading, promise;\n        currentLoading = $loading().target(submitButton).start();\n        promise = $repo.remove($scope.user);\n        promise.then(function(data) {\n          currentLoading.finish();\n          lightboxService.close($el);\n          $auth.logout();\n          return $location.path($navUrls.resolve(\"login\"));\n        });\n        return promise.then(null, function() {\n          currentLoading.finish();\n          return console.log(\"FAIL\");\n        });\n      };\n      $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $el.on(\"click\", \".button-red\", debounce(2000, function(event) {\n        event.preventDefault();\n        return submit();\n      }));\n      return submitButton = $el.find(\".button-red\");\n    };\n    return {\n      link: link,\n      templateUrl: \"user/lightbox/lightbox-delete-account.html\"\n    };\n  };\n\n  module.directive(\"tgLbDeleteUser\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"lightboxService\", \"$tgLoading\", DeleteUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var TaigaAvatarModelDirective, UserAvatarDirective, UserProfileDirective, UserSettingsController, debounce, mixOf, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  debounce = this.taiga.debounce;\n\n  UserSettingsController = (function(superClass) {\n    extend(UserSettingsController, superClass);\n\n    UserSettingsController.$inject = [\"$scope\", \"$rootScope\", \"$tgConfig\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserSettingsController(scope, rootscope, config, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      var maxFileSize, promise, text;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.config = config;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = \"USER_SETTINGS.MENU.SECTION_TITLE\";\n      this.scope.project = {};\n      this.scope.user = this.auth.getUser();\n      if (!this.scope.user) {\n        this.location.path(this.navUrls.resolve(\"permission-denied\"));\n        this.location.replace();\n      }\n      this.scope.lang = this.getLan();\n      this.scope.theme = this.getTheme();\n      maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        text = this.translate.instant(\"USER_SETTINGS.AVATAR_MAX_SIZE\", {\n          \"maxFileSize\": sizeFormat(maxFileSize)\n        });\n        this.scope.maxFileSizeMsg = text;\n      }\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserSettingsController.prototype.loadInitialData = function() {\n      this.scope.availableThemes = this.config.get(\"themes\", []);\n      return this.rs.locales.list().then((function(_this) {\n        return function(locales) {\n          _this.scope.locales = locales;\n          return locales;\n        };\n      })(this));\n    };\n\n    UserSettingsController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.user);\n    };\n\n    UserSettingsController.prototype.getLan = function() {\n      return this.scope.user.lang || this.translate.preferredLanguage();\n    };\n\n    UserSettingsController.prototype.getTheme = function() {\n      return this.scope.user.theme || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    return UserSettingsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserSettingsController\", UserSettingsController);\n\n  UserProfileDirective = function($confirm, $auth, $repo, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var changeEmail, form, onError, onSuccess;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          changeEmail = $scope.user.isAttributeModified(\"email\");\n          $scope.user.lang = $scope.lang;\n          $scope.user.theme = $scope.theme;\n          onSuccess = function(data) {\n            var text;\n            $auth.setUser(data);\n            if (changeEmail) {\n              text = $translate.instant(\"USER_PROFILE.CHANGE_EMAIL_SUCCESS\");\n              return $confirm.success(text);\n            } else {\n              return $confirm.notify('success');\n            }\n          };\n          onError = function(data) {\n            form.setErrors(data);\n            return $confirm.notify('error', data._error_message);\n          };\n          return $repo.save($scope.user).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserProfile\", [\"$tgConfirm\", \"$tgAuth\", \"$tgRepo\", \"$translate\", UserProfileDirective]);\n\n  UserAvatarDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      onSuccess = function(response) {\n        var user;\n        user = $model.make_model(\"users\", response.data);\n        $auth.setUser(user);\n        $scope.user = user;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-avatar\", function() {\n        return $el.find(\"#avatar-field\").click();\n      });\n      $el.on(\"change\", \"#avatar-field\", function(event) {\n        if ($scope.avatarAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-gravatar\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.userSettings.removeAvatar().then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserAvatar\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", UserAvatarDirective]);\n\n  TaigaAvatarModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgAvatarModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgAvatarModel', ['$parse', TaigaAvatarModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/nav.coffee\n */\n\n(function() {\n  var UserSettingsNavigationDirective, module;\n\n  UserSettingsNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgUserSettingsNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#usersettingsmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaUserSettings\");\n\n  module.directive(\"tgUserSettingsNavigation\", UserSettingsNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/notifications.coffee\n */\n\n(function() {\n  var UserNotificationsController, UserNotificationsDirective, UserNotificationsListDirective, bindOnce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserNotificationsController = (function(superClass) {\n    extend(UserNotificationsController, superClass);\n\n    UserNotificationsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\"];\n\n    function UserNotificationsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.scope.sectionName = \"USER_SETTINGS.NOTIFICATIONS.SECTION_NAME\";\n      this.scope.user = this.auth.getUser();\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserNotificationsController.prototype.loadInitialData = function() {\n      return this.rs.notifyPolicies.list().then((function(_this) {\n        return function(notifyPolicies) {\n          _this.scope.notifyPolicies = notifyPolicies;\n          return notifyPolicies;\n        };\n      })(this));\n    };\n\n    return UserNotificationsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserNotificationsController\", UserNotificationsController);\n\n  UserNotificationsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotifications\", UserNotificationsDirective);\n\n  UserNotificationsListDirective = function($repo, $confirm, $compile) {\n    var link, template;\n    template = _.template(\"<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\\n<div class=\\\"policy-table-row\\\" data-index=\\\"<%- index %>\\\">\\n  <div class=\\\"policy-table-project\\\"><span><%- notifyPolicy.project_name %></span></div>\\n  <div class=\\\"policy-table-all\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             value=\\\"2\\\" <% if (notifyPolicy.notify_level == 2) { %>checked=\\\"checked\\\"<% } %>/>\\n      <label for=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_ALL\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-involved\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             value=\\\"1\\\" <% if (notifyPolicy.notify_level == 1) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-none\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             value=\\\"3\\\" <% if (notifyPolicy.notify_level == 3) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_NONE\\\"></label>\\n    </fieldset>\\n  </div>\\n</div>\\n<% }) %>\");\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function() {\n        var ctx, html;\n        $el.off();\n        ctx = {\n          notifyPolicies: $scope.notifyPolicies\n        };\n        html = template(ctx);\n        $el.html($compile(html)($scope));\n        return $el.on(\"change\", \"input[type=radio]\", function(event) {\n          var onError, onSuccess, policy, policyIndex, prev_level, target;\n          target = angular.element(event.currentTarget);\n          policyIndex = target.parents(\".policy-table-row\").data('index');\n          policy = $scope.notifyPolicies[policyIndex];\n          prev_level = policy.notify_level;\n          policy.notify_level = parseInt(target.val(), 10);\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return target.parents(\".policy-table-row\").find(\"input[value=\" + prev_level + \"]\").prop(\"checked\", true);\n          };\n          return $repo.save(policy).then(onSuccess, onError);\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotificationsList\", [\"$tgRepo\", \"$tgConfirm\", \"$compile\", UserNotificationsListDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: components.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaComponents\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaDiscover\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaExternalApps\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaHome\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaNavigationBar\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProfile\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaProjects\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaResources2\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaUserTimeline\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-link.directive.coffee\n */\n\n(function() {\n  var AttachmentLinkDirective;\n\n  AttachmentLinkDirective = function($parse, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attachment;\n      attachment = $parse(attrs.tgAttachmentLink)(scope);\n      el.on(\"click\", function(event) {\n        if (taiga.isImage(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return scope.$apply(function() {\n            return lightboxFactory.create('tg-lb-attachment-preview', {\n              \"class\": 'lightbox lightbox-block'\n            }, {\n              file: attachment.get('file')\n            });\n          });\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentLinkDirective.$inject = [\"$parse\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentLink\", AttachmentLinkDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-gallery.directive.coffee\n */\n\n(function() {\n  var AttachmentGalleryDirective;\n\n  AttachmentGalleryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment-gallery.html\",\n      link: link\n    };\n  };\n\n  AttachmentGalleryDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentGallery\", AttachmentGalleryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchment.controller.coffee\n */\n\n(function() {\n  var AttachmentController;\n\n  AttachmentController = (function() {\n    AttachmentController.$inject = ['tgAttachmentsService', '$translate'];\n\n    function AttachmentController(attachmentsService, translate) {\n      this.attachmentsService = attachmentsService;\n      this.translate = translate;\n      this.form = {};\n      this.form.description = this.attachment.getIn(['file', 'description']);\n      this.form.is_deprecated = this.attachment.get(['file', 'is_deprecated']);\n      this.title = this.translate.instant(\"ATTACHMENT.TITLE\", {\n        fileName: this.attachment.get('name'),\n        date: moment(this.attachment.get('created_date')).format(this.translate.instant(\"ATTACHMENT.DATE\"))\n      });\n    }\n\n    AttachmentController.prototype.editMode = function(mode) {\n      var attachment;\n      attachment = this.attachment.set('editable', mode);\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    AttachmentController.prototype[\"delete\"] = function() {\n      return this.onDelete({\n        attachment: this.attachment\n      });\n    };\n\n    AttachmentController.prototype.save = function() {\n      var attachment;\n      attachment = this.attachment.set('loading', true);\n      this.onUpdate({\n        attachment: attachment\n      });\n      attachment = this.attachment.merge({\n        editable: false,\n        loading: false\n      });\n      attachment = attachment.mergeIn(['file'], {\n        description: this.form.description,\n        is_deprecated: !!this.form.is_deprecated\n      });\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    return AttachmentController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Attachment', AttachmentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment.directive.coffee\n */\n\n(function() {\n  var AttachmentDirective;\n\n  AttachmentDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment.html\",\n      link: link\n    };\n  };\n\n  AttachmentDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachment\", AttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-drop.directive.coffee\n */\n\n(function() {\n  var AttachmentsDropDirective;\n\n  AttachmentsDropDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgAttachmentsDrop);\n      el.on('dragover', function(e) {\n        e.preventDefault();\n        return false;\n      });\n      el.on('drop', function(e) {\n        var dataTransfer;\n        e.stopPropagation();\n        e.preventDefault();\n        dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: dataTransfer.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentsDropDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsDrop\", AttachmentsDropDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.controller.coffee\n */\n\n(function() {\n  var AttachmentsFullController, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsFullController = (function() {\n    AttachmentsFullController.$inject = [\"$translate\", \"$tgConfirm\", \"$tgConfig\", \"$tgStorage\", \"tgAttachmentsFullService\", \"tgProjectService\"];\n\n    function AttachmentsFullController(translate, confirm, config, storage, attachmentsFullService, projectService) {\n      this.translate = translate;\n      this.confirm = confirm;\n      this.config = config;\n      this.storage = storage;\n      this.attachmentsFullService = attachmentsFullService;\n      this.projectService = projectService;\n      this.mode = this.storage.get('attachment-mode', 'list');\n      this.maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (this.maxFileSize) {\n        this.maxFileSize = sizeFormat(this.maxFileSize);\n      }\n      this.maxFileSizeMsg = this.maxFileSize ? this.translate.instant(\"ATTACHMENT.MAX_UPLOAD_SIZE\", {\n        maxFileSize: this.maxFileSize\n      }) : \"\";\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullController.prototype.uploadingAttachments = function() {\n      return this.attachmentsFullService.uploadingAttachments;\n    };\n\n    AttachmentsFullController.prototype.addAttachment = function(file) {\n      var editable;\n      editable = this.mode === 'list';\n      return this.attachmentsFullService.addAttachment(this.projectId, this.objId, this.type, file, editable);\n    };\n\n    AttachmentsFullController.prototype.setMode = function(mode) {\n      this.mode = mode;\n      return this.storage.set('attachment-mode', mode);\n    };\n\n    AttachmentsFullController.prototype.toggleDeprecatedsVisible = function() {\n      return this.attachmentsFullService.toggleDeprecatedsVisible();\n    };\n\n    AttachmentsFullController.prototype.addAttachments = function(files) {\n      return _.forEach(files, (function(_this) {\n        return function(file) {\n          return _this.addAttachment(file);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.loadAttachments = function() {\n      return this.attachmentsFullService.loadAttachments(this.type, this.objId, this.projectId);\n    };\n\n    AttachmentsFullController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      var message, title;\n      title = this.translate.instant(\"ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT\");\n      message = this.translate.instant(\"ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT\", {\n        fileName: toDeleteAttachment.getIn(['file', 'name'])\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onError = function() {\n            message = _this.translate.instant(\"ATTACHMENT.ERROR_DELETE_ATTACHMENT\", {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            return askResponse.finish();\n          };\n          return _this.attachmentsFullService.deleteAttachment(toDeleteAttachment, _this.type).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.reorderAttachment = function(attachment, newIndex) {\n      return this.attachmentsFullService.reorderAttachment(this.type, attachment, newIndex);\n    };\n\n    AttachmentsFullController.prototype.updateAttachment = function(toUpdateAttachment) {\n      return this.attachmentsFullService.updateAttachment(toUpdateAttachment, this.type);\n    };\n\n    AttachmentsFullController.prototype._isEditable = function() {\n      if (this.projectService.project) {\n        return this.projectService.hasPermission(this.editPermission);\n      }\n      return false;\n    };\n\n    AttachmentsFullController.prototype.showAttachments = function() {\n      return this._isEditable() || this.attachmentsFullService.attachments.size;\n    };\n\n    return AttachmentsFullController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsFull\", AttachmentsFullController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.directive.coffee\n */\n\n(function() {\n  var AttachmentsFullDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  AttachmentsFullDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.objId', function(value) {\n        return ctrl.loadAttachments();\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        type: \"@\",\n        objId: \"=\",\n        projectId: \"=\",\n        editPermission: \"@\"\n      },\n      controller: \"AttachmentsFull\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-full/attachments-full.html\",\n      link: link\n    };\n  };\n\n  AttachmentsFullDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsFull\", AttachmentsFullDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-full.service.coffee\n */\n\n(function() {\n  var AttachmentsFullService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsFullService = (function(superClass) {\n    extend(AttachmentsFullService, superClass);\n\n    AttachmentsFullService.$inject = [\"tgAttachmentsService\", \"$rootScope\"];\n\n    function AttachmentsFullService(attachmentsService, rootScope) {\n      this.attachmentsService = attachmentsService;\n      this.rootScope = rootScope;\n      this._attachments = Immutable.List();\n      this._deprecatedsCount = 0;\n      this._attachmentsVisible = Immutable.List();\n      this._deprecatedsVisible = false;\n      this.uploadingAttachments = [];\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this._attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this._deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this._attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this._deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullService.prototype.toggleDeprecatedsVisible = function() {\n      this._deprecatedsVisible = !this._deprecatedsVisible;\n      return this.regenerate();\n    };\n\n    AttachmentsFullService.prototype.regenerate = function() {\n      this._deprecatedsCount = this._attachments.count(function(it) {\n        return it.getIn(['file', 'is_deprecated']);\n      });\n      if (this._deprecatedsVisible) {\n        return this._attachmentsVisible = this._attachments;\n      } else {\n        return this._attachmentsVisible = this._attachments.filter(function(it) {\n          return !it.getIn(['file', 'is_deprecated']);\n        });\n      }\n    };\n\n    AttachmentsFullService.prototype.addAttachment = function(projectId, objId, type, file, editable) {\n      if (editable == null) {\n        editable = true;\n      }\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          var promise;\n          if (_this.attachmentsService.validate(file)) {\n            _this.uploadingAttachments.push(file);\n            promise = _this.attachmentsService.upload(file, objId, projectId, type);\n            return promise.then(function(file) {\n              var attachment;\n              _this.uploadingAttachments = _this.uploadingAttachments.filter(function(uploading) {\n                return uploading.name !== file.get('name');\n              });\n              attachment = Immutable.Map();\n              attachment = attachment.merge({\n                file: file,\n                editable: editable,\n                loading: false\n              });\n              _this._attachments = _this._attachments.push(attachment);\n              _this.regenerate();\n              _this.rootScope.$broadcast(\"attachment:create\");\n              return resolve(attachment);\n            });\n          } else {\n            return reject(file);\n          }\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.loadAttachments = function(type, objId, projectId) {\n      return this.attachmentsService.list(type, objId, projectId).then((function(_this) {\n        return function(files) {\n          _this._attachments = files.map(function(file) {\n            var attachment;\n            attachment = Immutable.Map();\n            return attachment.merge({\n              loading: false,\n              editable: false,\n              file: file\n            });\n          });\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.deleteAttachment = function(toDeleteAttachment, type) {\n      var onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this._attachments = _this._attachments.filter(function(attachment) {\n            return attachment !== toDeleteAttachment;\n          });\n          return _this.regenerate();\n        };\n      })(this);\n      return this.attachmentsService[\"delete\"](type, toDeleteAttachment.getIn(['file', 'id'])).then(onSuccess);\n    };\n\n    AttachmentsFullService.prototype.reorderAttachment = function(type, attachment, newIndex) {\n      var attachments, oldIndex, promises;\n      oldIndex = this.attachments.findIndex(function(it) {\n        return it === attachment;\n      });\n      if (oldIndex === newIndex) {\n        return;\n      }\n      attachments = this.attachments.remove(oldIndex);\n      attachments = attachments.splice(newIndex, 0, attachment);\n      attachments = attachments.map(function(x, i) {\n        return x.setIn(['file', 'order'], i + 1);\n      });\n      promises = [];\n      attachments.forEach((function(_this) {\n        return function(attachment) {\n          var patch;\n          patch = {\n            order: attachment.getIn(['file', 'order'])\n          };\n          return promises.push(_this.attachmentsService.patch(attachment.getIn(['file', 'id']), type, patch));\n        };\n      })(this));\n      return Promise.all(promises).then((function(_this) {\n        return function() {\n          _this._attachments = attachments;\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.updateAttachment = function(toUpdateAttachment, type) {\n      var index, oldAttachment, patch;\n      index = this._attachments.findIndex(function(attachment) {\n        return attachment.getIn(['file', 'id']) === toUpdateAttachment.getIn(['file', 'id']);\n      });\n      oldAttachment = this._attachments.get(index);\n      patch = taiga.patch(oldAttachment.get('file'), toUpdateAttachment.get('file'));\n      if (toUpdateAttachment.get('loading')) {\n        this._attachments = this._attachments.set(index, toUpdateAttachment);\n        return this.regenerate();\n      } else {\n        return this.attachmentsService.patch(toUpdateAttachment.getIn(['file', 'id']), type, patch).then((function(_this) {\n          return function() {\n            _this._attachments = _this._attachments.set(index, toUpdateAttachment);\n            return _this.regenerate();\n          };\n        })(this));\n      }\n    };\n\n    return AttachmentsFullService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsFullService\", AttachmentsFullService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.controller.coffee\n */\n\n(function() {\n  var AttachmentsSimpleController;\n\n  AttachmentsSimpleController = (function() {\n    AttachmentsSimpleController.$inject = [\"tgAttachmentsService\"];\n\n    function AttachmentsSimpleController(attachmentsService) {\n      this.attachmentsService = attachmentsService;\n    }\n\n    AttachmentsSimpleController.prototype.addAttachment = function(file) {\n      var attachment;\n      attachment = Immutable.fromJS({\n        file: file,\n        name: file.name,\n        size: file.size\n      });\n      if (this.attachmentsService.validate(file)) {\n        this.attachments = this.attachments.push(attachment);\n        if (this.onAdd) {\n          return this.onAdd({\n            attachment: attachment\n          });\n        }\n      }\n    };\n\n    AttachmentsSimpleController.prototype.addAttachments = function(files) {\n      return _.forEach(files, this.addAttachment.bind(this));\n    };\n\n    AttachmentsSimpleController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      this.attachments = this.attachments.filter(function(attachment) {\n        return attachment !== toDeleteAttachment;\n      });\n      if (this.onDelete) {\n        return this.onDelete({\n          attachment: toDeleteAttachment\n        });\n      }\n    };\n\n    return AttachmentsSimpleController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsSimple\", AttachmentsSimpleController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.directive.coffee\n */\n\n(function() {\n  var AttachmentsSimpleDirective;\n\n  AttachmentsSimpleDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachments: \"=\",\n        onAdd: \"&\",\n        onDelete: \"&\"\n      },\n      controller: \"AttachmentsSimple\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-simple/attachments-simple.html\",\n      link: link\n    };\n  };\n\n  AttachmentsSimpleDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSimple\", AttachmentsSimpleDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-sortable.directive.coffee\n */\n\n(function() {\n  var AttachmentSortableDirective;\n\n  AttachmentSortableDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback;\n      callback = $parse(attrs.tgAttachmentsSortable);\n      el.sortable({\n        items: \"div[tg-bind-scope]\",\n        handle: \".settings .icon\",\n        containment: \".attachments\",\n        dropOnEmpty: true,\n        helper: 'clone',\n        scroll: false,\n        tolerance: \"pointer\",\n        placeholder: \"sortable-placeholder single-attachment\"\n      });\n      el.on(\"sortstop\", function(event, ui) {\n        var attachment, newIndex;\n        attachment = ui.item.scope().attachment;\n        newIndex = ui.item.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            attachment: attachment,\n            index: newIndex\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentSortableDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSortable\", AttachmentSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: auto-select.directive.coffee\n */\n\n(function() {\n  var AutoSelectDirective;\n\n  AutoSelectDirective = function($timeout) {\n    return {\n      link: function(scope, elm) {\n        return $timeout(function() {\n          return elm[0].select();\n        });\n      }\n    };\n  };\n\n  AutoSelectDirective.$inject = ['$timeout'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAutoSelect\", AutoSelectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: file-change.directive.coffee\n */\n\n(function() {\n  var FileChangeDirective;\n\n  FileChangeDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgFileChange);\n      el.on('change', function(event) {\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: event.currentTarget.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      restrict: \"A\",\n      link: link\n    };\n  };\n\n  FileChangeDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgFileChange\", FileChangeDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.directive.coffee\n */\n\n(function() {\n  var JoyRideDirective, taiga;\n\n  taiga = this.taiga;\n\n  JoyRideDirective = function($rootScope, currentUserService, joyRideService, $location, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var initJoyrRide, intro, unsuscribe;\n      unsuscribe = null;\n      intro = introJs();\n      intro.oncomplete(function() {\n        return $('html,body').scrollTop(0);\n      });\n      intro.onexit(function() {\n        return currentUserService.disableJoyRide();\n      });\n      initJoyrRide = function(next, config) {\n        if (!config[next.joyride]) {\n          return;\n        }\n        intro.setOptions({\n          exitOnEsc: false,\n          exitOnOverlayClick: false,\n          showStepNumbers: false,\n          nextLabel: $translate.instant('JOYRIDE.NAV.NEXT') + ' &rarr;',\n          prevLabel: '&larr; ' + $translate.instant('JOYRIDE.NAV.BACK'),\n          skipLabel: $translate.instant('JOYRIDE.NAV.SKIP'),\n          doneLabel: $translate.instant('JOYRIDE.NAV.DONE'),\n          disableInteraction: true\n        });\n        intro.setOption('steps', joyRideService.get(next.joyride));\n        return intro.start();\n      };\n      return $rootScope.$on('$routeChangeSuccess', function(event, next) {\n        if (!next.joyride || !currentUserService.isAuthenticated()) {\n          intro.exit();\n          if (unsuscribe) {\n            unsuscribe();\n          }\n          return;\n        }\n        intro.oncomplete(function() {\n          return currentUserService.disableJoyRide(next.joyride);\n        });\n        if (next.loader) {\n          return unsuscribe = $rootScope.$on('loader:end', function() {\n            currentUserService.loadJoyRideConfig().then(function(config) {\n              return initJoyrRide(next, config);\n            });\n            return unsuscribe();\n          });\n        } else {\n          return currentUserService.loadJoyRideConfig().then(function(config) {\n            return initJoyrRide(next, config);\n          });\n        }\n      });\n    };\n    return {\n      scope: {},\n      link: link\n    };\n  };\n\n  JoyRideDirective.$inject = [\"$rootScope\", \"tgCurrentUserService\", \"tgJoyRideService\", \"$location\", \"$translate\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgJoyRide\", JoyRideDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.service.coffee\n */\n\n(function() {\n  var JoyRideService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JoyRideService = (function(superClass) {\n    extend(JoyRideService, superClass);\n\n    JoyRideService.$inject = ['$translate', 'tgCheckPermissionsService'];\n\n    function JoyRideService(translate, checkPermissionsService) {\n      this.translate = translate;\n      this.checkPermissionsService = checkPermissionsService;\n    }\n\n    JoyRideService.prototype.getConfig = function() {\n      return {\n        dashboard: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.project-list > section:not(.ng-hide)',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TEXT')\n                }\n              }, {\n                element: '.working-on-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TEXT')\n                }\n              }, {\n                element: '.watching-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT2')]\n                }\n              }\n            ];\n            if (!$('.project-list .create-project-button').is(':hidden')) {\n              steps.push({\n                element: '.project-list .create-project-button',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        backlog: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.summary',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT1'), _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT2')]\n                }\n              }, {\n                element: '.backlog-table-empty',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TEXT')\n                }\n              }, {\n                element: '.sprints',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.new-us',\n                position: 'rigth',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TEXT')\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        kanban: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.kanban-table-inner',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TEXT')\n                }\n              }, {\n                element: '.card-placeholder',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.icon-plus',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this)\n      };\n    };\n\n    JoyRideService.prototype.get = function(name) {\n      var joyRide, joyRides;\n      joyRides = this.getConfig();\n      joyRide = joyRides[name].call(this);\n      return _.map(joyRide, function(item) {\n        var html;\n        html = \"\";\n        if (item.joyride.title) {\n          html += \"<h3>\" + item.joyride.title + \"</h3>\";\n        }\n        if (_.isArray(item.joyride.text)) {\n          _.forEach(item.joyride.text, function(text) {\n            return html += \"<p>\" + text + \"</p>\";\n          });\n        } else {\n          html += \"<p>\" + item.joyride.text + \"</p>\";\n        }\n        item.intro = html;\n        return item;\n      });\n    };\n\n    return JoyRideService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgJoyRideService\", JoyRideService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2015 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2015 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: live-announcement.directive.coffee\n */\n\n(function() {\n  var LiveAnnouncementDirective;\n\n  LiveAnnouncementDirective = function(liveAnnouncementService) {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      restrict: \"AE\",\n      scope: {},\n      controllerAs: 'vm',\n      controller: function() {\n        this.close = function() {\n          return liveAnnouncementService.open = false;\n        };\n        return Object.defineProperties(this, {\n          open: {\n            get: function() {\n              return liveAnnouncementService.open;\n            }\n          },\n          title: {\n            get: function() {\n              return liveAnnouncementService.title;\n            }\n          },\n          desc: {\n            get: function() {\n              return liveAnnouncementService.desc;\n            }\n          }\n        });\n      },\n      link: link,\n      templateUrl: \"components/live-announcement/live-announcement.html\"\n    };\n  };\n\n  LiveAnnouncementDirective.$inject = [\"tgLiveAnnouncementService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgLiveAnnouncement\", LiveAnnouncementDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: notification.service.coffee\n */\n\n(function() {\n  var LiveAnnouncementService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  LiveAnnouncementService = (function(superClass) {\n    extend(LiveAnnouncementService, superClass);\n\n    function LiveAnnouncementService() {\n      this.open = false;\n      this.title = \"\";\n      this.desc = \"\";\n    }\n\n    LiveAnnouncementService.prototype.show = function(title, desc) {\n      this.open = true;\n      this.title = title;\n      return this.desc = desc;\n    };\n\n    return LiveAnnouncementService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgLiveAnnouncementService\", LiveAnnouncementService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-big-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoBigSrcDirective;\n\n  ProjectLogoBigSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_big_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoBigSrc\"\n      }\n    };\n  };\n\n  ProjectLogoBigSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoBigSrc\", ProjectLogoBigSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-small-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoSmallSrcDirective;\n\n  ProjectLogoSmallSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_small_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoSmallSrc\"\n      }\n    };\n  };\n\n  ProjectLogoSmallSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoSmallSrc\", ProjectLogoSmallSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.controller.coffee\n */\n\n(function() {\n  var ProjectMenuController;\n\n  ProjectMenuController = (function() {\n    ProjectMenuController.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n    function ProjectMenuController(projectService, lightboxFactory) {\n      this.projectService = projectService;\n      this.lightboxFactory = lightboxFactory;\n      this.project = null;\n      this.menu = Immutable.Map();\n    }\n\n    ProjectMenuController.prototype.show = function() {\n      this.project = this.projectService.project;\n      this.active = this._getActiveSection();\n      this._setVideoConference();\n      return this._setMenuPermissions();\n    };\n\n    ProjectMenuController.prototype.hide = function() {\n      this.project = null;\n      return this.menu = {};\n    };\n\n    ProjectMenuController.prototype.search = function() {\n      return this.lightboxFactory.create(\"tg-search-box\", {\n        \"class\": \"lightbox lightbox-search\"\n      });\n    };\n\n    ProjectMenuController.prototype._setVideoConference = function() {\n      var videoconferenceUrl;\n      videoconferenceUrl = this._videoConferenceUrl();\n      if (videoconferenceUrl) {\n        return this.project = this.project.set(\"videoconferenceUrl\", videoconferenceUrl);\n      }\n    };\n\n    ProjectMenuController.prototype._setMenuPermissions = function() {\n      this.menu = Immutable.Map({\n        backlog: false,\n        kanban: false,\n        issues: false,\n        wiki: false\n      });\n      if (this.project.get(\"is_backlog_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"backlog\", true);\n      }\n      if (this.project.get(\"is_kanban_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"kanban\", true);\n      }\n      if (this.project.get(\"is_issues_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_issues\") !== -1) {\n        this.menu = this.menu.set(\"issues\", true);\n      }\n      if (this.project.get(\"is_wiki_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_wiki_pages\") !== -1) {\n        return this.menu = this.menu.set(\"wiki\", true);\n      }\n    };\n\n    ProjectMenuController.prototype._getActiveSection = function() {\n      var indexBacklog, indexKanban, oldSectionName, sectionName, sectionsBreadcrumb;\n      sectionName = this.projectService.section;\n      sectionsBreadcrumb = this.projectService.sectionsBreadcrumb;\n      indexBacklog = sectionsBreadcrumb.lastIndexOf(\"backlog\");\n      indexKanban = sectionsBreadcrumb.lastIndexOf(\"kanban\");\n      if (indexBacklog !== -1 || indexKanban !== -1) {\n        if (indexKanban === -1 || indexBacklog > indexKanban) {\n          oldSectionName = \"backlog\";\n        } else {\n          oldSectionName = \"kanban\";\n        }\n      }\n      if (sectionName === \"backlog-kanban\") {\n        if (oldSectionName === \"backlog\" || oldSectionName === \"kanban\") {\n          sectionName = oldSectionName;\n        } else if (this.project.get(\"is_backlog_activated\") && !this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"backlog\";\n        } else if (!this.project.get(\"is_backlog_activated\") && this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"kanban\";\n        }\n      }\n      return sectionName;\n    };\n\n    ProjectMenuController.prototype._videoConferenceUrl = function() {\n      var baseUrl, url;\n      if (this.project.get(\"videoconferences\") === \"appear-in\") {\n        baseUrl = \"https://appear.in/\";\n      } else if (this.project.get(\"videoconferences\") === \"talky\") {\n        baseUrl = \"https://talky.io/\";\n      } else if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        baseUrl = \"https://meet.jit.si/\";\n      } else if (this.project.get(\"videoconferences\") === \"custom\") {\n        return this.project.get(\"videoconferences_extra_data\");\n      } else {\n        return \"\";\n      }\n      if (this.project.get(\"videoconferences_extra_data\")) {\n        url = this.project.get(\"slug\") + \"-\" + taiga.slugify(this.project.get(\"videoconferences_extra_data\"));\n      } else {\n        url = this.project.get(\"slug\");\n      }\n      if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        url = url.replace(/-/g, \"\");\n      }\n      return baseUrl + url;\n    };\n\n    return ProjectMenuController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"ProjectMenu\", ProjectMenuController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.directive.coffee\n */\n\n(function() {\n  var ProjectMenuDirective, taiga;\n\n  taiga = this.taiga;\n\n  ProjectMenuDirective = function(projectService, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var projectChange;\n      projectChange = function() {\n        if (projectService.project) {\n          return ctrl.show();\n        } else {\n          return ctrl.hide();\n        }\n      };\n      scope.$watch((function() {\n        return projectService.project;\n      }), projectChange);\n      scope.vm.fixed = false;\n      return $(window).on(\"scroll\", function() {\n        var position;\n        position = $(window).scrollTop();\n        if (position > 100 && scope.vm.fixed === false) {\n          scope.vm.fixed = true;\n          return scope.$digest();\n        } else if (position < 100 && scope.vm.fixed === true) {\n          scope.vm.fixed = false;\n          return scope.$digest();\n        }\n      });\n    };\n    return {\n      scope: {},\n      controller: \"ProjectMenu\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/project-menu/project-menu.html\",\n      link: link\n    };\n  };\n\n  ProjectMenuDirective.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectMenu\", ProjectMenuDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.directive.coffee\n */\n\n(function() {\n  var TermsOfServiceAndPrivacyPolicyNoticeDirective;\n\n  TermsOfServiceAndPrivacyPolicyNoticeDirective = function($config) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.privacyPolicyUrl = $config.get(\"privacyPolicyUrl\");\n      return scope.termsOfServiceUrl = $config.get(\"termsOfServiceUrl\");\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      link: link,\n      templateUrl: \"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgTermsOfServiceAndPrivacyPolicyNotice\", [\"$tgConfig\", TermsOfServiceAndPrivacyPolicyNoticeDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.controller.coffee\n */\n\n(function() {\n  var VoteButtonController;\n\n  VoteButtonController = (function() {\n    VoteButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function VoteButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    VoteButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    VoteButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    VoteButtonController.prototype.toggleVote = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_voter) {\n        promise = this._upvote();\n      } else {\n        promise = this._downvote();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    VoteButtonController.prototype._upvote = function() {\n      return this.onUpvote().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    VoteButtonController.prototype._downvote = function() {\n      return this.onDownvote();\n    };\n\n    return VoteButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"VoteButton\", VoteButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.directive.coffee\n */\n\n(function() {\n  var VoteButtonDirective;\n\n  VoteButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"VoteButton\",\n      bindToController: {\n        item: \"=\",\n        onUpvote: \"=\",\n        onDownvote: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/vote-button/vote-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgVoteButton\", VoteButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.controller.coffee\n */\n\n(function() {\n  var WatchButtonController;\n\n  WatchButtonController = (function() {\n    WatchButtonController.$inject = [\"tgCurrentUserService\", \"$rootScope\"];\n\n    function WatchButtonController(currentUserService, rootScope) {\n      this.currentUserService = currentUserService;\n      this.rootScope = rootScope;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    WatchButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    WatchButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    WatchButtonController.prototype.openWatchers = function() {\n      return this.rootScope.$broadcast(\"watcher:add\", this.item);\n    };\n\n    WatchButtonController.prototype.getPerms = function() {\n      var name, perms;\n      if (!this.item) {\n        return \"\";\n      }\n      name = this.item._name;\n      perms = {\n        userstories: 'modify_us',\n        issues: 'modify_issue',\n        tasks: 'modify_task'\n      };\n      return perms[name];\n    };\n\n    WatchButtonController.prototype.toggleWatch = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_watcher) {\n        promise = this._watch();\n      } else {\n        promise = this._unwatch();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    WatchButtonController.prototype._watch = function() {\n      return this.onWatch().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    WatchButtonController.prototype._unwatch = function() {\n      return this.onUnwatch();\n    };\n\n    return WatchButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"WatchButton\", WatchButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.directive.coffee\n */\n\n(function() {\n  var WatchButtonDirective;\n\n  WatchButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchButton\",\n      bindToController: {\n        item: \"=\",\n        onWatch: \"=\",\n        onUnwatch: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: function(item, attributes) {\n        return \"components/watch-button/watch-button-\" + attributes.environment + \".html\";\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWatchButton\", WatchButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByController;\n\n  DiscoverHomeOrderByController = (function() {\n    DiscoverHomeOrderByController.$inject = ['$translate'];\n\n    function DiscoverHomeOrderByController(translate) {\n      this.translate = translate;\n      this.is_open = false;\n      this.texts = {\n        week: this.translate.instant('DISCOVER.FILTERS.WEEK'),\n        month: this.translate.instant('DISCOVER.FILTERS.MONTH'),\n        year: this.translate.instant('DISCOVER.FILTERS.YEAR'),\n        all: this.translate.instant('DISCOVER.FILTERS.ALL_TIME')\n      };\n    }\n\n    DiscoverHomeOrderByController.prototype.currentText = function() {\n      return this.texts[this.currentOrderBy];\n    };\n\n    DiscoverHomeOrderByController.prototype.open = function() {\n      return this.is_open = true;\n    };\n\n    DiscoverHomeOrderByController.prototype.close = function() {\n      return this.is_open = false;\n    };\n\n    DiscoverHomeOrderByController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      this.is_open = false;\n      return this.onChange({\n        orderBy: this.currentOrderBy\n      });\n    };\n\n    return DiscoverHomeOrderByController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHomeOrderBy\", DiscoverHomeOrderByController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.directive.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByDirective;\n\n  DiscoverHomeOrderByDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverHomeOrderBy\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-home-order-by/discover-home-order-by.html\",\n      scope: {\n        currentOrderBy: \"=orderBy\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverHomeOrderByDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverHomeOrderBy\", DiscoverHomeOrderByDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-bar.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchBarController;\n\n  DiscoverSearchBarController = (function() {\n    DiscoverSearchBarController.$inject = ['tgDiscoverProjectsService'];\n\n    function DiscoverSearchBarController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.projectsCount;\n        };\n      })(this));\n      this.discoverProjectsService.fetchStats();\n    }\n\n    DiscoverSearchBarController.prototype.selectFilter = function(filter) {\n      return this.onChange({\n        filter: filter,\n        q: this.q\n      });\n    };\n\n    DiscoverSearchBarController.prototype.submitFilter = function() {\n      return this.onChange({\n        filter: this.filter,\n        q: this.q\n      });\n    };\n\n    return DiscoverSearchBarController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchBar\", DiscoverSearchBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchBarDirective;\n\n  DiscoverSearchBarDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"DiscoverSearchBar\",\n      controllerAs: \"vm\",\n      templateUrl: 'discover/components/discover-search-bar/discover-search-bar.html',\n      bindToController: true,\n      scope: {\n        q: \"=\",\n        filter: \"=\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchBarDirective.$inject = [];\n\n  angular.module('taigaDiscover').directive('tgDiscoverSearchBar', DiscoverSearchBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderController;\n\n  DiscoverSearchListHeaderController = (function() {\n    DiscoverSearchListHeaderController.$inject = [];\n\n    function DiscoverSearchListHeaderController() {\n      this.like_is_open = this.orderBy.indexOf('-total_fans') === 0;\n      this.activity_is_open = this.orderBy.indexOf('-total_activity') === 0;\n    }\n\n    DiscoverSearchListHeaderController.prototype.openLike = function() {\n      this.like_is_open = true;\n      this.activity_is_open = false;\n      return this.setOrderBy('-total_fans_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.openActivity = function() {\n      this.activity_is_open = true;\n      this.like_is_open = false;\n      return this.setOrderBy('-total_activity_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.setOrderBy = function(type) {\n      if (type == null) {\n        type = '';\n      }\n      if (!type) {\n        this.like_is_open = false;\n        this.activity_is_open = false;\n      }\n      return this.onChange({\n        orderBy: type\n      });\n    };\n\n    return DiscoverSearchListHeaderController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchListHeader\", DiscoverSearchListHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderDirective;\n\n  DiscoverSearchListHeaderDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverSearchListHeader\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-search-list-header/discover-search-list-header.html\",\n      scope: {\n        onChange: \"&\",\n        orderBy: \"=\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchListHeaderDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearchListHeader\", DiscoverSearchListHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.controller.coffee\n */\n\n(function() {\n  var FeaturedProjectsController;\n\n  FeaturedProjectsController = (function() {\n    FeaturedProjectsController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function FeaturedProjectsController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.featured;\n        };\n      })(this));\n      this.discoverProjectsService.fetchFeatured();\n    }\n\n    return FeaturedProjectsController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"FeaturedProjects\", FeaturedProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.directive.coffee\n */\n\n(function() {\n  var FeaturedProjectsDirective;\n\n  FeaturedProjectsDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"FeaturedProjects\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/featured-projects/featured-projects.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  FeaturedProjectsDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgFeaturedProjects\", FeaturedProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: highlighted.directive.coffee\n */\n\n(function() {\n  var HighlightedDirective;\n\n  HighlightedDirective = function() {\n    return {\n      templateUrl: \"discover/components/highlighted/highlighted.html\",\n      scope: {\n        loading: \"=\",\n        highlighted: \"=\",\n        orderBy: \"=\"\n      }\n    };\n  };\n\n  HighlightedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgHighlighted\", HighlightedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.controller.coffee\n */\n\n(function() {\n  var MostActiveController;\n\n  MostActiveController = (function() {\n    MostActiveController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostActiveController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostActive;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostActiveController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostActive({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostActiveController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostActiveController.prototype.getOrderBy = function(type) {\n      if (this.currentOrderBy === 'all') {\n        return '-total_activity';\n      } else {\n        return '-total_activity_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostActiveController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostActive\", MostActiveController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.directive.coffee\n */\n\n(function() {\n  var MostActiveDirective;\n\n  MostActiveDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostActive\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-active/most-active.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostActiveDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostActive\", MostActiveDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: msot-liked.controller.coffee\n */\n\n(function() {\n  var MostLikedController;\n\n  MostLikedController = (function() {\n    MostLikedController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostLikedController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostLiked;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostLikedController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostLiked({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostLikedController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostLikedController.prototype.getOrderBy = function() {\n      if (this.currentOrderBy === 'all') {\n        return '-total_fans';\n      } else {\n        return '-total_fans_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostLikedController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostLiked\", MostLikedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-liked.directive.coffee\n */\n\n(function() {\n  var MostLikedDirective;\n\n  MostLikedDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostLiked\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-liked/most-liked.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostLikedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostLiked\", MostLikedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeController;\n\n  DiscoverHomeController = (function() {\n    DiscoverHomeController.$inject = ['$tgLocation', '$tgNavUrls', 'tgAppMetaService', '$translate'];\n\n    function DiscoverHomeController(location, navUrls, appMetaService, translate) {\n      var description, title;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      title = this.translate.instant(\"DISCOVER.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverHomeController.prototype.onSubmit = function(q) {\n      var url;\n      url = this.navUrls.resolve('discover-search');\n      return this.location.search('text', q).path(url);\n    };\n\n    return DiscoverHomeController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHome\", DiscoverHomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchController;\n\n  DiscoverSearchController = (function() {\n    DiscoverSearchController.$inject = ['$routeParams', 'tgDiscoverProjectsService', '$route', 'tgAppMetaService', '$translate'];\n\n    function DiscoverSearchController(routeParams, discoverProjectsService, route, appMetaService, translate) {\n      var description, title;\n      this.routeParams = routeParams;\n      this.discoverProjectsService = discoverProjectsService;\n      this.route = route;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.page = 1;\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.nextSearchPage;\n        };\n      })(this));\n      this.q = this.routeParams.text;\n      this.filter = this.routeParams.filter || 'all';\n      this.orderBy = this.routeParams['order_by'] || '';\n      this.loadingGlobal = false;\n      this.loadingList = false;\n      this.loadingPagination = false;\n      title = this.translate.instant(\"DISCOVER.SEARCH.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.SEARCH.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverSearchController.prototype.fetch = function() {\n      this.page = 1;\n      this.discoverProjectsService.resetSearchList();\n      return this.search();\n    };\n\n    DiscoverSearchController.prototype.fetchByGlobalSearch = function() {\n      if (this.loadingGlobal) {\n        return;\n      }\n      this.loadingGlobal = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingGlobal = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.fetchByOrderBy = function() {\n      if (this.loadingList) {\n        return;\n      }\n      this.loadingList = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingList = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.showMore = function() {\n      if (this.loadingPagination) {\n        return;\n      }\n      this.loadingPagination = true;\n      this.page++;\n      return this.search().then((function(_this) {\n        return function() {\n          return _this.loadingPagination = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.search = function() {\n      var filter, params;\n      filter = this.getFilter();\n      params = {\n        page: this.page,\n        q: this.q,\n        order_by: this.orderBy\n      };\n      _.assign(params, filter);\n      return this.discoverProjectsService.fetchSearch(params);\n    };\n\n    DiscoverSearchController.prototype.getFilter = function() {\n      if (this.filter === 'people') {\n        return {\n          is_looking_for_people: true\n        };\n      } else if (this.filter === 'scrum') {\n        return {\n          is_backlog_activated: true\n        };\n      } else if (this.filter === 'kanban') {\n        return {\n          is_kanban_activated: true\n        };\n      }\n      return {};\n    };\n\n    DiscoverSearchController.prototype.onChangeFilter = function(filter, q) {\n      this.filter = filter;\n      this.q = q;\n      this.route.updateParams({\n        filter: this.filter,\n        text: this.q\n      });\n      return this.fetchByGlobalSearch();\n    };\n\n    DiscoverSearchController.prototype.onChangeOrder = function(orderBy) {\n      this.orderBy = orderBy;\n      this.route.updateParams({\n        order_by: orderBy\n      });\n      return this.fetchByOrderBy();\n    };\n\n    return DiscoverSearchController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearch\", DiscoverSearchController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchDirective;\n\n  DiscoverSearchDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  DiscoverSearchDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearch\", DiscoverSearchDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-projects.service.coffee\n */\n\n(function() {\n  var DiscoverProjectsService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  DiscoverProjectsService = (function(superClass) {\n    var _discoverParams;\n\n    extend(DiscoverProjectsService, superClass);\n\n    DiscoverProjectsService.$inject = [\"tgResources\", \"tgProjectsService\"];\n\n    _discoverParams = {\n      discover_mode: true\n    };\n\n    function DiscoverProjectsService(rs, projectsService) {\n      this.rs = rs;\n      this.projectsService = projectsService;\n      this._mostLiked = Immutable.List();\n      this._mostActive = Immutable.List();\n      this._featured = Immutable.List();\n      this._searchResult = Immutable.List();\n      this._projectsCount = 0;\n      this.decorate = this.projectsService._decorate.bind(this.projectsService);\n      taiga.defineImmutableProperty(this, \"mostLiked\", (function(_this) {\n        return function() {\n          return _this._mostLiked;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"mostActive\", (function(_this) {\n        return function() {\n          return _this._mostActive;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this._featured;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this._searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this._nextSearchPage;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsCount\", (function(_this) {\n        return function() {\n          return _this._projectsCount;\n        };\n      })(this));\n    }\n\n    DiscoverProjectsService.prototype.fetchMostLiked = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostLiked = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchMostActive = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostActive = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchFeatured = function() {\n      var _params;\n      _params = _.extend({}, _discoverParams);\n      _params.is_featured = true;\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 4);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._featured = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.resetSearchList = function() {\n      return this._searchResult = Immutable.List();\n    };\n\n    DiscoverProjectsService.prototype.fetchStats = function() {\n      return this.rs.stats.discover().then((function(_this) {\n        return function(discover) {\n          return _this._projectsCount = discover.getIn(['projects', 'total']);\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchSearch = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params).then((function(_this) {\n        return function(result) {\n          var projects;\n          _this._nextSearchPage = !!result.headers('X-Pagination-Next');\n          projects = Immutable.fromJS(result.data);\n          projects = projects.map(_this.decorate);\n          return _this._searchResult = _this._searchResult.concat(projects);\n        };\n      })(this));\n    };\n\n    return DiscoverProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaDiscover\").service(\"tgDiscoverProjectsService\", DiscoverProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.controller.coffee\n */\n\n(function() {\n  var ExternalAppController, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ExternalAppController = (function(superClass) {\n    extend(ExternalAppController, superClass);\n\n    ExternalAppController.$inject = [\"$routeParams\", \"tgExternalAppsService\", \"$window\", \"tgCurrentUserService\", \"$location\", \"$tgNavUrls\", \"tgXhrErrorService\", \"tgLoader\"];\n\n    function ExternalAppController(routeParams, externalAppsService, window, currentUserService, location, navUrls, xhrError, loader) {\n      var loginUrl, nextUrl;\n      this.routeParams = routeParams;\n      this.externalAppsService = externalAppsService;\n      this.window = window;\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.xhrError = xhrError;\n      this.loader = loader;\n      this.createApplicationToken = bind(this.createApplicationToken, this);\n      this._getApplicationToken = bind(this._getApplicationToken, this);\n      this._redirect = bind(this._redirect, this);\n      this.loader.start(false);\n      this._applicationId = this.routeParams.application;\n      this._state = this.routeParams.state;\n      this._getApplicationToken();\n      this._user = this.currentUserService.getUser();\n      this._application = null;\n      nextUrl = encodeURIComponent(this.location.url());\n      loginUrl = this.navUrls.resolve(\"login\");\n      this.loginWithAnotherUserUrl = loginUrl + \"?next=\" + nextUrl;\n      taiga.defineImmutableProperty(this, \"user\", (function(_this) {\n        return function() {\n          return _this._user;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"application\", (function(_this) {\n        return function() {\n          return _this._application;\n        };\n      })(this));\n    }\n\n    ExternalAppController.prototype._redirect = function(applicationToken) {\n      var nextUrl;\n      nextUrl = applicationToken.get(\"next_url\");\n      return this.window.open(nextUrl, \"_self\");\n    };\n\n    ExternalAppController.prototype._getApplicationToken = function() {\n      return this.externalAppsService.getApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          _this._application = data.get(\"application\");\n          if (data.get(\"auth_code\")) {\n            return _this._redirect(data);\n          } else {\n            return _this.loader.pageLoaded();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          _this.loader.pageLoaded();\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    ExternalAppController.prototype.cancel = function() {\n      return this.window.history.back();\n    };\n\n    ExternalAppController.prototype.createApplicationToken = function() {\n      return this.externalAppsService.authorizeApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          return _this._redirect(data);\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    return ExternalAppController;\n\n  })(taiga.Controller);\n\n  angular.module(\"taigaExternalApps\").controller(\"ExternalApp\", ExternalAppController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.service.coffee\n */\n\n(function() {\n  var ExternalAppsService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ExternalAppsService = (function(superClass) {\n    extend(ExternalAppsService, superClass);\n\n    ExternalAppsService.$inject = [\"tgResources\"];\n\n    function ExternalAppsService(rs) {\n      this.rs = rs;\n    }\n\n    ExternalAppsService.prototype.getApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.getApplicationToken(applicationId, state);\n    };\n\n    ExternalAppsService.prototype.authorizeApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.authorizeApplicationToken(applicationId, state);\n    };\n\n    return ExternalAppsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaExternalApps\").service(\"tgExternalAppsService\", ExternalAppsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: feedback.service.coffee\n */\n\n(function() {\n  var FeedbackService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FeedbackService = (function(superClass) {\n    extend(FeedbackService, superClass);\n\n    FeedbackService.$inject = [\"tgLightboxFactory\"];\n\n    function FeedbackService(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    FeedbackService.prototype.sendFeedback = function() {\n      return this.lightboxFactory.create(\"tg-lb-feedback\", {\n        \"class\": \"lightbox lightbox-feedback lightbox-generic-form\"\n      });\n    };\n\n    return FeedbackService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaFeedback\").service(\"tgFeedbackService\", FeedbackService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duty.directive.coffee\n */\n\n(function() {\n  var DutyDirective;\n\n  DutyDirective = function(navurls, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.duty = scope.duty;\n      return scope.vm.getDutyType = function() {\n        if (scope.vm.duty) {\n          if (scope.vm.duty.get('_name') === \"userstories\") {\n            return $translate.instant(\"COMMON.USER_STORY\");\n          }\n          if (scope.vm.duty.get('_name') === \"tasks\") {\n            return $translate.instant(\"COMMON.TASK\");\n          }\n          if (scope.vm.duty.get('_name') === \"issues\") {\n            return $translate.instant(\"COMMON.ISSUE\");\n          }\n        }\n      };\n    };\n    return {\n      templateUrl: \"home/duties/duty.html\",\n      scope: {\n        \"duty\": \"=tgDuty\"\n      },\n      link: link\n    };\n  };\n\n  DutyDirective.$inject = [\"$tgNavUrls\", \"$translate\"];\n\n  angular.module(\"taigaHome\").directive(\"tgDuty\", DutyDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.controller.coffee\n */\n\n(function() {\n  var HomeController;\n\n  HomeController = (function() {\n    HomeController.$inject = [\"tgCurrentUserService\", \"$location\", \"$tgNavUrls\"];\n\n    function HomeController(currentUserService, location, navUrls) {\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      if (!this.currentUserService.getUser()) {\n        this.location.path(this.navUrls.resolve(\"discover\"));\n      } else if (this.currentUserService.getUser().get('email') === 'olatunde@dealdey.com') {\n        this.location.path(this.navUrls.resolve(\"projects\"));\n      }\n    }\n\n    return HomeController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"Home\", HomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var HomeService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  HomeService = (function(superClass) {\n    extend(HomeService, superClass);\n\n    HomeService.$inject = [\"$tgNavUrls\", \"tgResources\", \"tgProjectsService\"];\n\n    function HomeService(navurls, rs, projectsService) {\n      this.navurls = navurls;\n      this.rs = rs;\n      this.projectsService = projectsService;\n    }\n\n    HomeService.prototype._attachProjectInfoToWorkInProgress = function(workInProgress, projectsById) {\n      var _attachProjectInfoToDuty, _duties, assignedTo, watching;\n      _attachProjectInfoToDuty = (function(_this) {\n        return function(duty, objType) {\n          var ctx, project, url;\n          project = projectsById.get(String(duty.get('project')));\n          ctx = {\n            project: project.get('slug'),\n            ref: duty.get('ref')\n          };\n          url = _this.navurls.resolve(\"project-\" + objType + \"-detail\", ctx);\n          duty = duty.set('url', url);\n          duty = duty.set('projectName', project.get('name'));\n          duty = duty.set('blockedProject', project.get('blocked_code'));\n          duty = duty.set(\"_name\", objType);\n          return duty;\n        };\n      })(this);\n      assignedTo = workInProgress.get(\"assignedTo\");\n      if (assignedTo.get(\"userStories\")) {\n        _duties = assignedTo.get(\"userStories\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"userstories\");\n        });\n        assignedTo = assignedTo.set(\"userStories\", _duties);\n      }\n      if (assignedTo.get(\"tasks\")) {\n        _duties = assignedTo.get(\"tasks\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"tasks\");\n        });\n        assignedTo = assignedTo.set(\"tasks\", _duties);\n      }\n      if (assignedTo.get(\"issues\")) {\n        _duties = assignedTo.get(\"issues\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"issues\");\n        });\n        assignedTo = assignedTo.set(\"issues\", _duties);\n      }\n      watching = workInProgress.get(\"watching\");\n      if (watching.get(\"userStories\")) {\n        _duties = watching.get(\"userStories\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"userstories\");\n        });\n        watching = watching.set(\"userStories\", _duties);\n      }\n      if (watching.get(\"tasks\")) {\n        _duties = watching.get(\"tasks\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"tasks\");\n        });\n        watching = watching.set(\"tasks\", _duties);\n      }\n      if (watching.get(\"issues\")) {\n        _duties = watching.get(\"issues\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"issues\");\n        });\n        watching = watching.set(\"issues\", _duties);\n      }\n      workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n      return workInProgress = workInProgress.set(\"watching\", watching);\n    };\n\n    HomeService.prototype.getWorkInProgress = function(userId) {\n      var assignedIssuesPromise, assignedTasksPromise, assignedTo, assignedUserStoriesPromise, params, params_us, projectsById, projectsPromise, watching, watchingIssuesPromise, watchingTasksPromise, watchingUserStoriesPromise, workInProgress;\n      projectsById = Immutable.Map();\n      projectsPromise = this.projectsService.getProjectsByUserId(userId).then(function(projects) {\n        return projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n          return p.id;\n        }));\n      });\n      assignedTo = Immutable.Map();\n      params = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_us = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      assignedUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return assignedTo = assignedTo.set(\"userStories\", userstories);\n      });\n      assignedTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return assignedTo = assignedTo.set(\"tasks\", tasks);\n      });\n      assignedIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return assignedTo = assignedTo.set(\"issues\", issues);\n      });\n      params = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_us = {\n        is_closed: false,\n        watchers: userId\n      };\n      watching = Immutable.Map();\n      watchingUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return watching = watching.set(\"userStories\", userstories);\n      });\n      watchingTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return watching = watching.set(\"tasks\", tasks);\n      });\n      watchingIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return watching = watching.set(\"issues\", issues);\n      });\n      workInProgress = Immutable.Map();\n      return Promise.all([projectsPromise, assignedUserStoriesPromise, assignedTasksPromise, assignedIssuesPromise, watchingUserStoriesPromise, watchingTasksPromise, watchingIssuesPromise]).then((function(_this) {\n        return function() {\n          workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n          workInProgress = workInProgress.set(\"watching\", watching);\n          workInProgress = _this._attachProjectInfoToWorkInProgress(workInProgress, projectsById);\n          return workInProgress;\n        };\n      })(this));\n    };\n\n    return HomeService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaHome\").service(\"tgHomeService\", HomeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home-project-list.directive.coffee\n */\n\n(function() {\n  var HomeProjectListDirective;\n\n  HomeProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"home/projects/home-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  HomeProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgHomeProjectList\", HomeProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var WorkingOnController;\n\n  WorkingOnController = (function() {\n    WorkingOnController.$inject = [\"tgHomeService\"];\n\n    function WorkingOnController(homeService) {\n      this.homeService = homeService;\n      this.assignedTo = Immutable.Map();\n      this.watching = Immutable.Map();\n    }\n\n    WorkingOnController.prototype._setAssignedTo = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"assignedTo\").get(\"userStories\");\n      tasks = workInProgress.get(\"assignedTo\").get(\"tasks\");\n      issues = workInProgress.get(\"assignedTo\").get(\"issues\");\n      this.assignedTo = userStories.concat(tasks).concat(issues);\n      if (this.assignedTo.size > 0) {\n        return this.assignedTo = this.assignedTo.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype._setWatching = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"watching\").get(\"userStories\");\n      tasks = workInProgress.get(\"watching\").get(\"tasks\");\n      issues = workInProgress.get(\"watching\").get(\"issues\");\n      this.watching = userStories.concat(tasks).concat(issues);\n      if (this.watching.size > 0) {\n        return this.watching = this.watching.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype.getWorkInProgress = function(userId) {\n      return this.homeService.getWorkInProgress(userId).then((function(_this) {\n        return function(workInProgress) {\n          _this._setAssignedTo(workInProgress);\n          return _this._setWatching(workInProgress);\n        };\n      })(this));\n    };\n\n    return WorkingOnController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"WorkingOn\", WorkingOnController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.directive.coffee\n */\n\n(function() {\n  var WorkingOnDirective;\n\n  WorkingOnDirective = function(homeService, currentUserService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var user, userId;\n      user = currentUserService.getUser();\n      if (user) {\n        userId = user.get(\"id\");\n        return ctrl.getWorkInProgress(userId);\n      }\n    };\n    return {\n      controller: \"WorkingOn\",\n      controllerAs: \"vm\",\n      templateUrl: \"home/working-on/working-on.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  WorkingOnDirective.$inject = [\"tgHomeService\", \"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgWorkingOn\", WorkingOnDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-project-list.directive.coffee\n */\n\n(function() {\n  var DropdownProjectListDirective;\n\n  DropdownProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-project-list/dropdown-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownProjectList\", DropdownProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-user.directive.coffee\n */\n\n(function() {\n  var DropdownUserDirective;\n\n  DropdownUserDirective = function(authService, configService, locationService, navUrlsService, feedbackService, $rootScope) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.isFeedbackEnabled = configService.get(\"feedbackEnabled\");\n      taiga.defineImmutableProperty(scope.vm, \"user\", function() {\n        return authService.userData;\n      });\n      scope.vm.logout = function() {\n        authService.logout();\n        locationService.url(navUrlsService.resolve(\"discover\"));\n        return locationService.search({});\n      };\n      scope.vm.sendFeedback = function() {\n        return feedbackService.sendFeedback();\n      };\n      return scope.vm.userSettingsPlugins = _.filter($rootScope.userSettingsPlugins, {\n        userMenu: true\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-user/dropdown-user.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownUserDirective.$inject = [\"$tgAuth\", \"$tgConfig\", \"$tgLocation\", \"$tgNavUrls\", \"tgFeedbackService\", \"$rootScope\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownUser\", DropdownUserDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.directive.coffee\n */\n\n(function() {\n  var NavigationBarDirective;\n\n  NavigationBarDirective = function(currentUserService, navigationBarService, locationService, navUrlsService, config) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isAuthenticated\", function() {\n        return currentUserService.isAuthenticated();\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isEnabledHeader\", function() {\n        return navigationBarService.isEnabledHeader();\n      });\n      scope.vm.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      scope.vm.login = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"login\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      scope.vm.register = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"register\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      return scope.$on(\"$routeChangeSuccess\", function() {\n        if (locationService.path() === \"/\") {\n          return scope.vm.active = true;\n        } else {\n          return scope.vm.active = false;\n        }\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/navigation-bar.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  NavigationBarDirective.$inject = [\"tgCurrentUserService\", \"tgNavigationBarService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgNavigationBar\", NavigationBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.service.coffee\n */\n\n(function() {\n  var NavigationBarService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  NavigationBarService = (function(superClass) {\n    extend(NavigationBarService, superClass);\n\n    function NavigationBarService() {\n      this.disableHeader();\n    }\n\n    NavigationBarService.prototype.enableHeader = function() {\n      return this.enabledHeader = true;\n    };\n\n    NavigationBarService.prototype.disableHeader = function() {\n      return this.enabledHeader = false;\n    };\n\n    NavigationBarService.prototype.isEnabledHeader = function() {\n      return this.enabledHeader;\n    };\n\n    return NavigationBarService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaNavigationBar\").service(\"tgNavigationBarService\", NavigationBarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.controller.coffee\n */\n\n(function() {\n  var ProfileBarController;\n\n  ProfileBarController = (function() {\n    ProfileBarController.$inject = [\"tgUserService\"];\n\n    function ProfileBarController(userService) {\n      this.userService = userService;\n      this.loadStats();\n    }\n\n    ProfileBarController.prototype.loadStats = function() {\n      return this.userService.getStats(this.user.get(\"id\")).then((function(_this) {\n        return function(stats) {\n          return _this.stats = stats;\n        };\n      })(this));\n    };\n\n    return ProfileBarController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileBar\", ProfileBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.directive.coffee\n */\n\n(function() {\n  var ProfileBarDirective;\n\n  ProfileBarDirective = function() {\n    return {\n      templateUrl: \"profile/profile-bar/profile-bar.html\",\n      controller: \"ProfileBar\",\n      controllerAs: \"vm\",\n      scope: {\n        user: \"=user\",\n        isCurrentUser: \"=iscurrentuser\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileBar\", ProfileBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.controller.coffee\n */\n\n(function() {\n  var ProfileContactsController;\n\n  ProfileContactsController = (function() {\n    ProfileContactsController.$inject = [\"tgUserService\", \"tgCurrentUserService\"];\n\n    function ProfileContactsController(userService, currentUserService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.currentUser = this.currentUserService.getUser();\n      this.isCurrentUser = false;\n      if (this.currentUser && this.currentUser.get(\"id\") === this.user.get(\"id\")) {\n        this.isCurrentUser = true;\n      }\n    }\n\n    ProfileContactsController.prototype.loadContacts = function() {\n      return this.userService.getContacts(this.user.get(\"id\")).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    return ProfileContactsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileContacts\", ProfileContactsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.directive.coffee\n */\n\n(function() {\n  var ProfileContactsDirective;\n\n  ProfileContactsDirective = function() {\n    var link;\n    link = function(scope, elm, attrs, ctrl) {\n      return ctrl.loadContacts();\n    };\n    return {\n      templateUrl: \"profile/profile-contacts/profile-contacts.html\",\n      scope: {\n        user: \"=\"\n      },\n      controllerAs: \"vm\",\n      controller: \"ProfileContacts\",\n      link: link,\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileContacts\", ProfileContactsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: items.directive.coffee\n */\n\n(function() {\n  var FavItemDirective;\n\n  FavItemDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.vm = {\n        item: scope.item\n      };\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.itemType === \"project\") {\n        return \"profile/profile-favs/items/project.html\";\n      } else {\n        return \"profile/profile-favs/items/ticket.html\";\n      }\n    };\n    return {\n      scope: {\n        \"item\": \"=tgFavItem\"\n      },\n      link: link,\n      templateUrl: templateUrl\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgFavItem\", FavItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.controller.coffee\n */\n\n(function() {\n  var FavsBaseController, ProfileLikedController, ProfileVotedController, ProfileWatchedController, debounceLeading,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  FavsBaseController = (function() {\n    function FavsBaseController() {\n      this._init();\n    }\n\n    FavsBaseController.prototype._init = function() {\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._resetList();\n      this.q = null;\n      return this.type = null;\n    };\n\n    FavsBaseController.prototype._resetList = function() {\n      this.items = Immutable.List();\n      this.scrollDisabled = false;\n      return this._page = 1;\n    };\n\n    FavsBaseController.prototype._enableLoadingSpinner = function() {\n      return this.isLoading = true;\n    };\n\n    FavsBaseController.prototype._disableLoadingSpinner = function() {\n      return this.isLoading = false;\n    };\n\n    FavsBaseController.prototype._enableScroll = function() {\n      return this.scrollDisabled = false;\n    };\n\n    FavsBaseController.prototype._disableScroll = function() {\n      return this.scrollDisabled = true;\n    };\n\n    FavsBaseController.prototype._checkIfHasMorePages = function(hasNext) {\n      if (hasNext) {\n        this._page += 1;\n        return this._enableScroll();\n      } else {\n        return this._disableScroll();\n      }\n    };\n\n    FavsBaseController.prototype._checkIfHasNoResults = function() {\n      return this.hasNoResults = this.items.size === 0;\n    };\n\n    FavsBaseController.prototype.loadItems = function() {\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      return this._getItems(this.user.get(\"id\"), this._page, this.type, this.q).then((function(_this) {\n        return function(response) {\n          _this.items = _this.items.concat(response.get(\"data\"));\n          _this._checkIfHasMorePages(response.get(\"next\"));\n          _this._checkIfHasNoResults();\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this));\n    };\n\n    FavsBaseController.prototype.filterByTextQuery = debounceLeading(500, function() {\n      this._resetList();\n      return this.loadItems();\n    });\n\n    FavsBaseController.prototype.showAll = function() {\n      if (this.type !== null) {\n        this.type = null;\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showProjectsOnly = function() {\n      if (this.type !== \"project\") {\n        this.type = \"project\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showUserStoriesOnly = function() {\n      if (this.type !== \"userstory\") {\n        this.type = \"userstory\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showTasksOnly = function() {\n      if (this.type !== \"task\") {\n        this.type = \"task\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showIssuesOnly = function() {\n      if (this.type !== \"issue\") {\n        this.type = \"issue\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    return FavsBaseController;\n\n  })();\n\n  ProfileLikedController = (function(superClass) {\n    extend(ProfileLikedController, superClass);\n\n    ProfileLikedController.$inject = [\"tgUserService\"];\n\n    function ProfileLikedController(userService) {\n      this.userService = userService;\n      ProfileLikedController.__super__.constructor.call(this);\n      this.enableFilterByAll = false;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = false;\n      this.enableFilterByTasks = false;\n      this.enableFilterByIssues = false;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getLiked;\n    }\n\n    return ProfileLikedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileLiked\", ProfileLikedController);\n\n  ProfileVotedController = (function(superClass) {\n    extend(ProfileVotedController, superClass);\n\n    ProfileVotedController.$inject = [\"tgUserService\"];\n\n    function ProfileVotedController(userService) {\n      this.userService = userService;\n      ProfileVotedController.__super__.constructor.call(this);\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getVoted;\n    }\n\n    return ProfileVotedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileVoted\", ProfileVotedController);\n\n  ProfileWatchedController = (function(superClass) {\n    extend(ProfileWatchedController, superClass);\n\n    ProfileWatchedController.$inject = [\"tgUserService\"];\n\n    function ProfileWatchedController(userService) {\n      this.userService = userService;\n      ProfileWatchedController.__super__.constructor.call(this);\n      this._getItems = this.userService.getWatched;\n    }\n\n    return ProfileWatchedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWatched\", ProfileWatchedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.directive.coffee\n */\n\n(function() {\n  var ProfileLikedDirective, ProfileVotedDirective, ProfileWatchedDirective, base;\n\n  base = {\n    scope: {},\n    bindToController: {\n      user: \"=\",\n      type: \"@\",\n      q: \"@\",\n      scrollDisabled: \"@\",\n      isLoading: \"@\",\n      hasNoResults: \"@\"\n    },\n    controller: null,\n    controllerAs: \"vm\",\n    templateUrl: \"profile/profile-favs/profile-favs.html\"\n  };\n\n  ProfileLikedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileLiked\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileLiked\", ProfileLikedDirective);\n\n  ProfileVotedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileVoted\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileVoted\", ProfileVotedDirective);\n\n  ProfileWatchedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileWatched\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWatched\", ProfileWatchedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.controller.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = (function() {\n    ProfileHints.prototype.HINTS = [\n      {\n        url: \"https://taiga.io/support/import-export-projects/\"\n      }, {\n        url: \"https://taiga.io/support/custom-fields/\"\n      }, {}, {}\n    ];\n\n    function ProfileHints(translate) {\n      var hintKey;\n      this.translate = translate;\n      hintKey = Math.floor(Math.random() * this.HINTS.length) + 1;\n      this.hint = this.HINTS[hintKey - 1];\n      this.hint.linkText = this.hint.linkText || 'HINTS.LINK';\n      this.hint.title = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TITLE\");\n      this.hint.text = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TEXT\");\n    }\n\n    return ProfileHints;\n\n  })();\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").controller(\"ProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.directive.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = function($translate) {\n    return {\n      scope: {},\n      controller: \"ProfileHints\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-hints/profile-hints.html\"\n    };\n  };\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.controller.coffee\n */\n\n(function() {\n  var ProfileProjectsController;\n\n  ProfileProjectsController = (function() {\n    ProfileProjectsController.$inject = [\"tgProjectsService\", \"tgUserService\"];\n\n    function ProfileProjectsController(projectsService, userService) {\n      this.projectsService = projectsService;\n      this.userService = userService;\n    }\n\n    ProfileProjectsController.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this.user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.userService.attachUserContactsToProjects(_this.user.get(\"id\"), projects);\n        };\n      })(this)).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    return ProfileProjectsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileProjects\", ProfileProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.directive.coffee\n */\n\n(function() {\n  var ProfileProjectsDirective;\n\n  ProfileProjectsDirective = function() {\n    var link;\n    link = function(scope, elm, attr, ctrl) {\n      return ctrl.loadProjects();\n    };\n    return {\n      templateUrl: \"profile/profile-projects/profile-projects.html\",\n      scope: {\n        user: \"=\"\n      },\n      link: link,\n      bindToController: true,\n      controllerAs: \"vm\",\n      controller: \"ProfileProjects\"\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileProjects\", ProfileProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tab.directive.coffee\n */\n\n(function() {\n  var ProfileTabDirective;\n\n  ProfileTabDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl, transclude) {\n      scope.tab = {};\n      attrs.$observe(\"tgProfileTab\", function(name) {\n        return scope.tab.name = name;\n      });\n      attrs.$observe(\"tabTitle\", function(title) {\n        return scope.tab.title = title;\n      });\n      scope.tab.icon = attrs.tabIcon;\n      scope.tab.iconName = '#' + attrs.tabIcon;\n      scope.tab.active = !!attrs.tabActive;\n      if (scope.$eval(attrs.tabDisabled) !== true) {\n        return ctrl.addTab(scope.tab);\n      }\n    };\n    return {\n      templateUrl: \"profile/profile-tab/profile-tab.html\",\n      scope: {},\n      require: \"^tgProfileTabs\",\n      link: link,\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTab\", ProfileTabDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.controller.coffee\n */\n\n(function() {\n  var ProfileTabsController;\n\n  ProfileTabsController = (function() {\n    function ProfileTabsController() {\n      this.tabs = [];\n    }\n\n    ProfileTabsController.prototype.addTab = function(tab) {\n      return this.tabs.push(tab);\n    };\n\n    ProfileTabsController.prototype.toggleTab = function(tab) {\n      _.map(this.tabs, function(tab) {\n        return tab.active = false;\n      });\n      return tab.active = true;\n    };\n\n    return ProfileTabsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileTabs\", ProfileTabsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.directive.coffee\n */\n\n(function() {\n  var ProfileTabsDirective;\n\n  ProfileTabsDirective = function() {\n    return {\n      scope: {},\n      controller: \"ProfileTabs\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-tabs/profile-tabs.html\",\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTabs\", ProfileTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.controller.coffee\n */\n\n(function() {\n  var ProfileController;\n\n  ProfileController = (function() {\n    ProfileController.$inject = [\"tgAppMetaService\", \"tgCurrentUserService\", \"$routeParams\", \"tgUserService\", \"tgXhrErrorService\", \"$translate\"];\n\n    function ProfileController(appMetaService, currentUserService, routeParams, userService, xhrError, translate) {\n      this.appMetaService = appMetaService;\n      this.currentUserService = currentUserService;\n      this.routeParams = routeParams;\n      this.userService = userService;\n      this.xhrError = xhrError;\n      this.translate = translate;\n      this.isCurrentUser = false;\n      if (this.routeParams.slug) {\n        this.userService.getUserByUserName(this.routeParams.slug).then((function(_this) {\n          return function(user) {\n            if (!user.get('is_active')) {\n              return _this.xhrError.notFound();\n            } else {\n              _this.user = user;\n              _this.isCurrentUser = false;\n              _this._setMeta(_this.user);\n              return user;\n            }\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function(xhr) {\n            return _this.xhrError.response(xhr);\n          };\n        })(this));\n      } else {\n        this.user = this.currentUserService.getUser();\n        this.isCurrentUser = true;\n        this._setMeta(this.user);\n      }\n    }\n\n    ProfileController.prototype._setMeta = function(user) {\n      var ctx, description, title;\n      ctx = {\n        userFullName: user.get(\"full_name_display\"),\n        userUsername: user.get(\"username\")\n      };\n      title = this.translate.instant(\"USER.PROFILE.PAGE_TITLE\", ctx);\n      description = user.get(\"bio\");\n      return this.appMetaService.setAll(title, description);\n    };\n\n    return ProfileController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"Profile\", ProfileController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: blocked-project-explanation.directive.coffee\n */\n\n(function() {\n  var BlockedProjectExplanationDirective;\n\n  BlockedProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/project/blocked-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgBlockedProjectExplanation\", BlockedProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var LikeProjectButtonController;\n\n  LikeProjectButtonController = (function() {\n    LikeProjectButtonController.$inject = [\"$tgConfirm\", \"tgLikeProjectButtonService\"];\n\n    function LikeProjectButtonController(confirm, likeButtonService) {\n      this.confirm = confirm;\n      this.likeButtonService = likeButtonService;\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    LikeProjectButtonController.prototype.toggleLike = function() {\n      var promise;\n      this.loading = true;\n      if (!this.project.get(\"is_fan\")) {\n        promise = this._like();\n      } else {\n        promise = this._unlike();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    LikeProjectButtonController.prototype._like = function() {\n      return this.likeButtonService.like(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    LikeProjectButtonController.prototype._unlike = function() {\n      return this.likeButtonService.unlike(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"LikeProjectButton\", LikeProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.directive.coffee\n */\n\n(function() {\n  var LikeProjectButtonDirective;\n\n  LikeProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"LikeProjectButton\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/like-project-button/like-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLikeProjectButton\", LikeProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.service.coffee\n */\n\n(function() {\n  var LikeProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  LikeProjectButtonService = (function(superClass) {\n    extend(LikeProjectButtonService, superClass);\n\n    LikeProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function LikeProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    LikeProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    LikeProjectButtonService.prototype._updateProjects = function(projectId, isFan) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, function(project) {\n        var totalFans;\n        totalFans = project.get(\"total_fans\");\n        if (isFan) {\n          totalFans++;\n        } else {\n          totalFans--;\n        }\n        return project.merge({\n          is_fan: isFan,\n          total_fans: totalFans\n        });\n      });\n      return this.currentUserService.setProjects(projects);\n    };\n\n    LikeProjectButtonService.prototype._updateCurrentProject = function(isFan) {\n      var project, totalFans;\n      totalFans = this.projectService.project.get(\"total_fans\");\n      if (isFan) {\n        totalFans++;\n      } else {\n        totalFans--;\n      }\n      project = this.projectService.project.merge({\n        is_fan: isFan,\n        total_fans: totalFans\n      });\n      return this.projectService.setProject(project);\n    };\n\n    LikeProjectButtonService.prototype.like = function(projectId) {\n      return this.rs.projects.likeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, true);\n          return _this._updateCurrentProject(true);\n        };\n      })(this));\n    };\n\n    LikeProjectButtonService.prototype.unlike = function(projectId) {\n      return this.rs.projects.unlikeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, false);\n          return _this._updateCurrentProject(false);\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgLikeProjectButtonService\", LikeProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: sort-projects.directive.coffee\n */\n\n(function() {\n  var SortProjectsDirective;\n\n  SortProjectsDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      var itemEl;\n      itemEl = null;\n      el.sortable({\n        dropOnEmpty: true,\n        revert: 200,\n        axis: \"y\",\n        opacity: .95,\n        placeholder: 'placeholder',\n        cancel: '.project-name'\n      });\n      return el.on(\"sortstop\", function(event, ui) {\n        var i, index, len, project, sortData, sorted_project_ids, value;\n        itemEl = ui.item;\n        project = itemEl.scope().project;\n        index = itemEl.index();\n        sorted_project_ids = _.map(scope.projects.toJS(), function(p) {\n          return p.id;\n        });\n        sorted_project_ids = _.without(sorted_project_ids, project.get(\"id\"));\n        sorted_project_ids.splice(index, 0, project.get('id'));\n        sortData = [];\n        for (index = i = 0, len = sorted_project_ids.length; i < len; index = ++i) {\n          value = sorted_project_ids[index];\n          sortData.push({\n            \"project_id\": value,\n            \"order\": index\n          });\n        }\n        return currentUserService.bulkUpdateProjectsOrder(sortData);\n      });\n    };\n    directive = {\n      scope: {\n        projects: \"=tgSortProjects\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgSortProjects\", [\"tgCurrentUserService\", SortProjectsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.controller.coffee\n */\n\n(function() {\n  var WatchProjectButtonController;\n\n  WatchProjectButtonController = (function() {\n    WatchProjectButtonController.$inject = [\"$tgConfirm\", \"tgWatchProjectButtonService\"];\n\n    function WatchProjectButtonController(confirm, watchButtonService) {\n      this.confirm = confirm;\n      this.watchButtonService = watchButtonService;\n      this.showWatchOptions = false;\n      this.loading = false;\n    }\n\n    WatchProjectButtonController.prototype.toggleWatcherOptions = function() {\n      return this.showWatchOptions = !this.showWatchOptions;\n    };\n\n    WatchProjectButtonController.prototype.closeWatcherOptions = function() {\n      return this.showWatchOptions = false;\n    };\n\n    WatchProjectButtonController.prototype.watch = function(notifyLevel) {\n      if (notifyLevel === this.project.get('notify_level')) {\n        return;\n      }\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.watch(this.project.get('id'), notifyLevel)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    WatchProjectButtonController.prototype.unwatch = function() {\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.unwatch(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"WatchProjectButton\", WatchProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.directive.coffee\n */\n\n(function() {\n  var WatchProjectButtonDirective;\n\n  WatchProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchProjectButton\",\n      bindToController: {\n        project: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/watch-project-button/watch-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgWatchProjectButton\", WatchProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.service.coffee\n */\n\n(function() {\n  var WatchProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  WatchProjectButtonService = (function(superClass) {\n    extend(WatchProjectButtonService, superClass);\n\n    WatchProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function WatchProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    WatchProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    WatchProjectButtonService.prototype._updateProjects = function(projectId, notifyLevel, isWatcher) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, (function(_this) {\n        return function(project) {\n          var totalWatchers;\n          totalWatchers = project.get('total_watchers');\n          if (!_this.projectService.project.get('is_watcher') && isWatcher) {\n            totalWatchers++;\n          } else if (_this.projectService.project.get('is_watcher') && !isWatcher) {\n            totalWatchers--;\n          }\n          return project.merge({\n            is_watcher: isWatcher,\n            total_watchers: totalWatchers,\n            notify_level: notifyLevel\n          });\n        };\n      })(this));\n      return this.currentUserService.setProjects(projects);\n    };\n\n    WatchProjectButtonService.prototype._updateCurrentProject = function(notifyLevel, isWatcher) {\n      var project, totalWatchers;\n      totalWatchers = this.projectService.project.get(\"total_watchers\");\n      if (!this.projectService.project.get('is_watcher') && isWatcher) {\n        totalWatchers++;\n      } else if (this.projectService.project.get('is_watcher') && !isWatcher) {\n        totalWatchers--;\n      }\n      project = this.projectService.project.merge({\n        is_watcher: isWatcher,\n        notify_level: notifyLevel,\n        total_watchers: totalWatchers\n      });\n      return this.projectService.setProject(project);\n    };\n\n    WatchProjectButtonService.prototype.watch = function(projectId, notifyLevel) {\n      return this.rs.projects.watchProject(projectId, notifyLevel).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, notifyLevel, true);\n          return _this._updateCurrentProject(notifyLevel, true);\n        };\n      })(this));\n    };\n\n    WatchProjectButtonService.prototype.unwatch = function(projectId) {\n      return this.rs.projects.unwatchProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, null, false);\n          return _this._updateCurrentProject(null, false);\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgWatchProjectButtonService\", WatchProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-listing.controller.coffee\n */\n\n(function() {\n  var ProjectsListingController;\n\n  ProjectsListingController = (function() {\n    ProjectsListingController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n    function ProjectsListingController(currentUserService, projectsService) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n    }\n\n    ProjectsListingController.prototype.newProject = function() {\n      return this.projectsService.newProject();\n    };\n\n    return ProjectsListingController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ProjectsListing\", ProjectsListingController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var ProjectController;\n\n  ProjectController = (function() {\n    ProjectController.$inject = [\"$routeParams\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectController(routeParams, appMetaService, auth, translate, projectService) {\n      var projectSlug;\n      this.routeParams = routeParams;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      projectSlug = this.routeParams.pslug;\n      this.user = this.auth.userData;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"members\", (function(_this) {\n        return function() {\n          return _this.projectService.activeMembers;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    ProjectController.prototype._setMeta = function(project) {\n      var ctx, metas;\n      if (!this.project) {\n        return null;\n      }\n      metas = {};\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      metas.title = this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx);\n      metas.description = this.project.get(\"description\");\n      return metas;\n    };\n\n    return ProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"Project\", ProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.service.coffee\n */\n\n(function() {\n  var ProjectsService, groupBy, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  ProjectsService = (function(superClass) {\n    extend(ProjectsService, superClass);\n\n    ProjectsService.$inject = [\"tgResources\", \"$projectUrl\", \"tgLightboxFactory\"];\n\n    function ProjectsService(rs, projectUrl, lightboxFactory) {\n      this.rs = rs;\n      this.projectUrl = projectUrl;\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    ProjectsService.prototype.getProjectBySlug = function(projectSlug) {\n      return this.rs.projects.getProjectBySlug(projectSlug).then((function(_this) {\n        return function(project) {\n          return _this._decorate(project);\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype.getProjectStats = function(projectId) {\n      return this.rs.projects.getProjectStats(projectId);\n    };\n\n    ProjectsService.prototype.getProjectsByUserId = function(userId, paginate) {\n      return this.rs.projects.getProjectsByUserId(userId, paginate).then((function(_this) {\n        return function(projects) {\n          return projects.map(_this._decorate.bind(_this));\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype._decorate = function(project) {\n      var colorized_tags, tags, url;\n      url = this.projectUrl.get(project.toJS());\n      project = project.set(\"url\", url);\n      colorized_tags = [];\n      if (project.get(\"tags\")) {\n        tags = project.get(\"tags\").sort();\n        colorized_tags = tags.map(function(tag) {\n          var color;\n          color = project.get(\"tags_colors\").get(tag);\n          return Immutable.fromJS({\n            name: tag,\n            color: color\n          });\n        });\n        project = project.set(\"colorized_tags\", colorized_tags);\n      }\n      return project;\n    };\n\n    ProjectsService.prototype.newProject = function() {\n      return this.lightboxFactory.create(\"tg-lb-create-project\", {\n        \"class\": \"wizard-create-project lightbox\"\n      });\n    };\n\n    ProjectsService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.rs.projects.bulkUpdateOrder(sortData);\n    };\n\n    ProjectsService.prototype.transferValidateToken = function(projectId, token) {\n      return this.rs.projects.transferValidateToken(projectId, token);\n    };\n\n    ProjectsService.prototype.transferAccept = function(projectId, token, reason) {\n      return this.rs.projects.transferAccept(projectId, token, reason);\n    };\n\n    ProjectsService.prototype.transferReject = function(projectId, token, reason) {\n      return this.rs.projects.transferReject(projectId, token, reason);\n    };\n\n    return ProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgProjectsService\", ProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: cant-own-project-explanation.directive.coffee\n */\n\n(function() {\n  var CantOwnProjectExplanationDirective;\n\n  CantOwnProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/transfer/cant-own-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgCantOwnProjectExplanation\", CantOwnProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProject, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProject = (function() {\n    TransferProject.$inject = [\"$routeParams\", \"tgProjectsService\", \"$location\", \"$tgAuth\", \"tgCurrentUserService\", \"$tgNavUrls\", \"$translate\", \"$tgConfirm\"];\n\n    function TransferProject(routeParams, projectService, location, authService, currentUserService, navUrls, translate, confirmService) {\n      this.routeParams = routeParams;\n      this.projectService = projectService;\n      this.location = location;\n      this.authService = authService;\n      this.currentUserService = currentUserService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.confirmService = confirmService;\n    }\n\n    TransferProject.prototype.initialize = function() {\n      this.projectId = this.project.get(\"id\");\n      this.token = this.routeParams.token;\n      this.showAddComment = false;\n      return this._refreshUserData();\n    };\n\n    TransferProject.prototype._validateToken = function() {\n      return this.projectService.transferValidateToken(this.projectId, this.token).then(null, (function(_this) {\n        return function(data, status) {\n          return _this.location.path(_this.navUrls.resolve(\"not-found\"));\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._refreshUserData = function() {\n      return this.authService.refresh().then((function(_this) {\n        return function() {\n          _this._validateToken();\n          _this._setProjectData();\n          return _this._checkOwnerData();\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._setProjectData = function() {\n      return this.canBeOwnedByUser = this.currentUserService.canOwnProject(this.project);\n    };\n\n    TransferProject.prototype._checkOwnerData = function() {\n      var currentUser, maxMemberships;\n      currentUser = this.currentUserService.getUser();\n      if (this.project.get('is_private')) {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE';\n        this.maxProjects = currentUser.get('max_private_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_private_projects');\n        maxMemberships = currentUser.get('max_memberships_private_projects');\n      } else {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC';\n        this.maxProjects = currentUser.get('max_public_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_public_projects');\n        maxMemberships = currentUser.get('max_memberships_public_projects');\n      }\n      return this.validNumberOfMemberships = maxMemberships === null || this.project.get('total_memberships') <= maxMemberships;\n    };\n\n    TransferProject.prototype.transferAccept = function(token, reason) {\n      return this.projectService.transferAccept(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"project-admin-project-profile-details\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.transferReject = function(token, reason) {\n      return this.projectService.transferReject(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"project-admin-project-profile-details\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.addComment = function() {\n      return this.showAddComment = true;\n    };\n\n    TransferProject.prototype.hideComment = function() {\n      this.showAddComment = false;\n      return this.reason = '';\n    };\n\n    return TransferProject;\n\n  })();\n\n  module.controller(\"TransferProjectController\", TransferProject);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProjectDirective, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProjectDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.initialize();\n    };\n    return {\n      link: link,\n      scope: {},\n      bindToController: {\n        project: \"=\"\n      },\n      templateUrl: \"projects/transfer/transfer-project.html\",\n      controller: 'TransferProjectController',\n      controllerAs: 'vm'\n    };\n  };\n\n  module.directive('tgTransferProject', TransferProjectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  Resource = function(urlsService, http, config, $rootScope, $q, storage) {\n    var service;\n    service = {};\n    service.list = function(type, objectId, projectId) {\n      var httpOptions, params, url, urlname;\n      urlname = \"attachments/\" + type;\n      params = {\n        object_id: objectId,\n        project: projectId\n      };\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      url = urlsService.resolve(urlname);\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service[\"delete\"] = function(type, id) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http[\"delete\"](url);\n    };\n    service.patch = function(type, id, patch) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http.patch(url, patch);\n    };\n    service.create = function(type, projectId, objectId, file) {\n      var data, defered, maxFileSize, response, token, uploadComplete, uploadFailed, uploadProgress, url, urlname, xhr;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname);\n      defered = $q.defer();\n      if (file === void 0) {\n        defered.reject(null);\n        return defered.promise;\n      }\n      maxFileSize = config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"in-progress\";\n            file.size = sizeFormat(evt.total);\n            file.progressMessage = \"upload \" + (sizeFormat(evt.loaded)) + \" of \" + (sizeFormat(evt.total));\n            return file.progressPercent = (Math.round((evt.loaded / evt.total) * 100)) + \"%\";\n          });\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            var attachment, error, ref, status;\n            file.status = \"done\";\n            status = evt.target.status;\n            try {\n              attachment = JSON.parse(evt.target.responseText);\n            } catch (error) {\n              attachment = {};\n            }\n            if (status >= 200 && status < 400) {\n              attachment = Immutable.fromJS(attachment);\n              return defered.resolve(attachment);\n            } else {\n              response = {\n                status: status,\n                data: {\n                  _error_message: (ref = data['attached_file']) != null ? ref[0] : void 0\n                }\n              };\n              return defered.reject(response);\n            }\n          });\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"error\";\n            return defered.reject(\"fail\");\n          });\n        };\n      })(this);\n      data = new FormData();\n      data.append(\"project\", projectId);\n      data.append(\"object_id\", objectId);\n      data.append(\"attached_file\", file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.addEventListener(\"load\", uploadComplete, false);\n      xhr.addEventListener(\"error\", uploadFailed, false);\n      token = storage.get('token');\n      xhr.open(\"POST\", url);\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function() {\n      return {\n        \"attachments\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"$tgConfig\", \"$rootScope\", \"$q\", \"$tgStorage\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgAttachmentsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getApplicationToken = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"applications\");\n      url = url + \"/\" + applicationId + \"/token?state=\" + state;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.authorizeApplicationToken = function(applicationId, state) {\n      var data, url;\n      url = urlsService.resolve(\"application-tokens\");\n      url = url + \"/authorize\";\n      data = {\n        \"state\": state,\n        \"application\": applicationId\n      };\n      return http.post(url, data).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"externalapps\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgExternalAppsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: issues-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"issues\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"issues\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgIssuesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, pagination;\n\n  pagination = function() {};\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getProjects = function(params, pagination) {\n      var httpOptions, url;\n      if (params == null) {\n        params = {};\n      }\n      if (pagination == null) {\n        pagination = true;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!pagination) {\n        httpOptions = {\n          headers: {\n            \"x-lazy-pagination\": true\n          }\n        };\n      }\n      return http.get(url, params, httpOptions);\n    };\n    service.getProjectBySlug = function(projectSlug) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/by_slug?slug=\" + projectSlug;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectsByUserId = function(userId, paginate) {\n      var httpOptions, params, url;\n      if (paginate == null) {\n        paginate = false;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!paginate) {\n        httpOptions.headers = {\n          \"x-disable-pagination\": \"1\"\n        };\n      }\n      params = {\n        \"member\": userId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectStats = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = urlsService.resolve(\"bulk-update-projects-order\");\n      return http.post(url, bulkData);\n    };\n    service.getTimeline = function(projectId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-project\");\n      url = url + \"/\" + projectId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.likeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-like\", projectId);\n      return http.post(url);\n    };\n    service.unlikeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unlike\", projectId);\n      return http.post(url);\n    };\n    service.watchProject = function(projectId, notifyLevel) {\n      var data, url;\n      data = {\n        notify_level: notifyLevel\n      };\n      url = urlsService.resolve(\"project-watch\", projectId);\n      return http.post(url, data);\n    };\n    service.unwatchProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unwatch\", projectId);\n      return http.post(url);\n    };\n    service.transferValidateToken = function(projectId, token) {\n      var data, url;\n      data = {\n        token: token\n      };\n      url = urlsService.resolve(\"project-transfer-validate-token\", projectId);\n      return http.post(url, data);\n    };\n    service.transferAccept = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-accept\", projectId);\n      return http.post(url, data);\n    };\n    service.transferReject = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-reject\", projectId);\n      return http.post(url, data);\n    };\n    service.transferRequest = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-transfer-request\", projectId);\n      return http.post(url);\n    };\n    service.transferStart = function(projectId, userId, reason) {\n      var data, url;\n      data = {\n        user: userId,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-start\", projectId);\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"projects\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgProjectsResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.coffee\n */\n\n(function() {\n  var Resources, services;\n\n  services = [\"tgProjectsResources\", \"tgUserResources\", \"tgUsersResources\", \"tgUserstoriesResource\", \"tgTasksResource\", \"tgIssuesResource\", \"tgExternalAppsResource\", \"tgAttachmentsResource\", \"tgStatsResource\"];\n\n  Resources = function($injector) {\n    var i, j, len, len1, ref, service, serviceFn, serviceName, serviceProperty;\n    for (i = 0, len = services.length; i < len; i++) {\n      serviceName = services[i];\n      serviceFn = $injector.get(serviceName);\n      service = $injector.invoke(serviceFn);\n      ref = Object.keys(service);\n      for (j = 0, len1 = ref.length; j < len1; j++) {\n        serviceProperty = ref[j];\n        if (this[serviceProperty]) {\n          console.warm(\"repeated resource \" + serviceProperty);\n        }\n        this[serviceProperty] = service[serviceProperty];\n      }\n    }\n    return this;\n  };\n\n  Resources.$inject = [\"$injector\"];\n\n  angular.module(\"taigaResources2\").service(\"tgResources\", Resources);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: stats-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.discover = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"stats-discover\");\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"stats\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgStatsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tasks-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"tasks\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"tasks\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTasksResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserStorage = function(key) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-storage\");\n      if (key) {\n        url += '/' + key;\n      }\n      httpOptions = {};\n      return http.get(url, {}).then(function(response) {\n        return response.data.value;\n      });\n    };\n    service.setUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\") + '/' + key;\n      params = {\n        key: key,\n        value: value\n      };\n      return http.put(url, params);\n    };\n    service.createUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\");\n      params = {\n        key: key,\n        value: value\n      };\n      return http.post(url, params);\n    };\n    return function() {\n      return {\n        \"user\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: users-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserByUsername = function(username) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"by_username\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        username: username\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getStats = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-stats\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getContacts = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getLiked = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-liked\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      params.only_relevant = true;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getVoted = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-voted\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWatched = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-watched\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getProfileTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page\n      };\n      url = urlsService.resolve(\"timeline-profile\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getUserTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-user\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    return function() {\n      return {\n        \"users\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUsersResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: userstories-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"userstories\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserstoriesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app-meta.service.coffee\n */\n\n(function() {\n  var AppMetaService, taiga, truncate;\n\n  taiga = this.taiga;\n\n  truncate = taiga.truncate;\n\n  AppMetaService = (function() {\n    AppMetaService.$inject = [\"$rootScope\"];\n\n    function AppMetaService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    AppMetaService.prototype._set = function(key, value) {\n      var meta;\n      if (!key) {\n        return;\n      }\n      if (key === \"title\") {\n        meta = $(\"head title\");\n        if (meta.length === 0) {\n          meta = $(\"<title></title>\");\n          $(\"head\").append(meta);\n        }\n        return meta.text(value || \"\");\n      } else if (key.indexOf(\"og:\") === 0) {\n        meta = $(\"head meta[property='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta property='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      } else {\n        meta = $(\"head meta[name='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta name='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      }\n    };\n\n    AppMetaService.prototype.setTitle = function(title) {\n      return this._set('title', title);\n    };\n\n    AppMetaService.prototype.setDescription = function(description) {\n      return this._set(\"description\", truncate(description, 250));\n    };\n\n    AppMetaService.prototype.setTwitterMetas = function(title, description) {\n      this._set(\"twitter:card\", \"summary\");\n      this._set(\"twitter:site\", \"@taigaio\");\n      this._set(\"twitter:title\", title);\n      this._set(\"twitter:description\", truncate(description, 300));\n      return this._set(\"twitter:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n    };\n\n    AppMetaService.prototype.setOpenGraphMetas = function(title, description) {\n      this._set(\"og:type\", \"object\");\n      this._set(\"og:site_name\", \"Taiga - Love your projects\");\n      this._set(\"og:title\", title);\n      this._set(\"og:description\", truncate(description, 300));\n      this._set(\"og:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n      return this._set(\"og:url\", window.location.href);\n    };\n\n    AppMetaService.prototype.setAll = function(title, description) {\n      this.setTitle(title);\n      this.setDescription(description);\n      this.setTwitterMetas(title, description);\n      return this.setOpenGraphMetas(title, description);\n    };\n\n    AppMetaService.prototype.addMobileViewport = function() {\n      return $(\"head\").append(\"<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\\\">\");\n    };\n\n    AppMetaService.prototype.removeMobileViewport = function() {\n      return $(\"head meta[name=\\\"viewport\\\"]\").remove();\n    };\n\n    AppMetaService.prototype.setfn = function(fn) {\n      if (this.listener) {\n        this._listener();\n      }\n      return this._listener = this.rootScope.$watchCollection(fn, (function(_this) {\n        return function(metas) {\n          if (metas) {\n            _this.setAll(metas.title, metas.description);\n            return _this._listener();\n          }\n        };\n      })(this));\n    };\n\n    return AppMetaService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAppMetaService\", AppMetaService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments.service.coffee\n */\n\n(function() {\n  var AttachmentsService, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsService = (function() {\n    AttachmentsService.$inject = [\"$tgConfirm\", \"$tgConfig\", \"$translate\", \"tgResources\"];\n\n    function AttachmentsService(confirm, config, translate, rs) {\n      this.confirm = confirm;\n      this.config = config;\n      this.translate = translate;\n      this.rs = rs;\n      this.maxFileSize = this.getMaxFileSize();\n      if (this.maxFileSize) {\n        this.maxFileSizeFormated = sizeFormat(this.maxFileSize);\n      }\n    }\n\n    AttachmentsService.prototype.sizeError = function(file) {\n      var message;\n      message = this.translate.instant(\"ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED\", {\n        fileName: file.name,\n        fileSize: sizeFormat(file.size),\n        maxFileSize: this.maxFileSizeFormated\n      });\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.validate = function(file) {\n      if (this.maxFileSize && file.size > this.maxFileSize) {\n        this.sizeError(file);\n        return false;\n      }\n      return true;\n    };\n\n    AttachmentsService.prototype.getMaxFileSize = function() {\n      return this.config.get(\"maxUploadFileSize\", null);\n    };\n\n    AttachmentsService.prototype.list = function(type, objId, projectId) {\n      return this.rs.attachments.list(type, objId, projectId).then((function(_this) {\n        return function(attachments) {\n          return attachments.sortBy(function(attachment) {\n            return attachment.get('order');\n          });\n        };\n      })(this));\n    };\n\n    AttachmentsService.prototype[\"delete\"] = function(type, id) {\n      return this.rs.attachments[\"delete\"](type, id);\n    };\n\n    AttachmentsService.prototype.saveError = function(file, data) {\n      var message;\n      message = \"\";\n      if (file) {\n        message = this.translate.instant(\"ATTACHMENT.ERROR_UPLOAD_ATTACHMENT\", {\n          fileName: file.name,\n          errorMessage: data.data._error_message\n        });\n      }\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.upload = function(file, objId, projectId, type) {\n      var promise;\n      promise = this.rs.attachments.create(type, projectId, objId, file);\n      promise.then(null, this.saveError.bind(this, file));\n      return promise;\n    };\n\n    AttachmentsService.prototype.patch = function(id, type, patch) {\n      var promise;\n      promise = this.rs.attachments.patch(type, id, patch);\n      promise.then(null, this.saveError.bind(this, null));\n      return promise;\n    };\n\n    return AttachmentsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAttachmentsService\", AttachmentsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: check-permissions.service.coffee\n */\n\n(function() {\n  var ChekcPermissionsService, taiga;\n\n  taiga = this.taiga;\n\n  ChekcPermissionsService = (function() {\n    ChekcPermissionsService.$inject = [\"tgProjectService\"];\n\n    function ChekcPermissionsService(projectService) {\n      this.projectService = projectService;\n    }\n\n    ChekcPermissionsService.prototype.check = function(permission) {\n      if (!this.projectService.project) {\n        return false;\n      }\n      return this.projectService.project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    return ChekcPermissionsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCheckPermissionsService\", ChekcPermissionsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: current-user.service.coffee\n */\n\n(function() {\n  var CurrentUserService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  CurrentUserService = (function() {\n    CurrentUserService.$inject = [\"tgProjectsService\", \"$tgStorage\", \"tgResources\"];\n\n    function CurrentUserService(projectsService, storageService, rs) {\n      this.projectsService = projectsService;\n      this.storageService = storageService;\n      this.rs = rs;\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      this._joyride = null;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this._projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsById\", (function(_this) {\n        return function() {\n          return _this._projectsById;\n        };\n      })(this));\n    }\n\n    CurrentUserService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    CurrentUserService.prototype.getUser = function() {\n      var userData;\n      if (!this._user) {\n        userData = this.storageService.get(\"userInfo\");\n        if (userData) {\n          userData = Immutable.fromJS(userData);\n          this.setUser(userData);\n        }\n      }\n      return this._user;\n    };\n\n    CurrentUserService.prototype.removeUser = function() {\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      return this._joyride = null;\n    };\n\n    CurrentUserService.prototype.setUser = function(user) {\n      this._user = user;\n      return this._loadUserInfo();\n    };\n\n    CurrentUserService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.projectsService.bulkUpdateProjectsOrder(sortData).then((function(_this) {\n        return function() {\n          return _this.loadProjects();\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this._user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.setProjects(projects);\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.disableJoyRide = function(section) {\n      if (section) {\n        this._joyride[section] = false;\n      } else {\n        this._joyride = {\n          backlog: false,\n          kanban: false,\n          dashboard: false\n        };\n      }\n      return this.rs.user.setUserStorage('joyride', this._joyride);\n    };\n\n    CurrentUserService.prototype.loadJoyRideConfig = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if (_this._joyride !== null) {\n            resolve(_this._joyride);\n            return;\n          }\n          return _this.rs.user.getUserStorage('joyride').then(function(config) {\n            _this._joyride = config;\n            return resolve(_this._joyride);\n          })[\"catch\"](function() {\n            _this._joyride = {\n              backlog: true,\n              kanban: true,\n              dashboard: true\n            };\n            _this.rs.user.createUserStorage('joyride', _this._joyride);\n            return resolve(_this._joyride);\n          });\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype._loadUserInfo = function() {\n      return Promise.all([this.loadProjects()]);\n    };\n\n    CurrentUserService.prototype.setProjects = function(projects) {\n      this._projects = this._projects.set(\"all\", projects);\n      this._projects = this._projects.set(\"recents\", projects.slice(0, 10));\n      this._projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n        return p.id;\n      }));\n      return this.projects;\n    };\n\n    CurrentUserService.prototype.canCreatePrivateProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_private_projects') !== null && user.get('total_private_projects') >= user.get('max_private_projects')) {\n        return {\n          valid: false,\n          reason: 'max_private_projects',\n          type: 'private_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canCreatePublicProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_public_projects') !== null && user.get('total_public_projects') >= user.get('max_public_projects')) {\n        return {\n          valid: false,\n          reason: 'max_public_projects',\n          type: 'public_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canOwnProject = function(project) {\n      var result, user;\n      user = this.getUser();\n      if (project.get('is_private')) {\n        result = this.canCreatePrivateProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_private_projects') !== null && project.get('total_memberships') > user.get('max_memberships_private_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_private_projects',\n            type: 'private_project'\n          };\n        }\n      } else {\n        result = this.canCreatePublicProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_public_projects') !== null && project.get('total_memberships') > user.get('max_memberships_public_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_public_projects',\n            type: 'public_project'\n          };\n        }\n      }\n      return {\n        valid: true\n      };\n    };\n\n    return CurrentUserService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCurrentUserService\", CurrentUserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lightbox-factory.service.coffee\n */\n\n(function() {\n  var LightboxFactory;\n\n  LightboxFactory = (function() {\n    LightboxFactory.$inject = [\"$rootScope\", \"$compile\"];\n\n    function LightboxFactory(rootScope, compile) {\n      this.rootScope = rootScope;\n      this.compile = compile;\n    }\n\n    LightboxFactory.prototype.create = function(name, attrs, scopeAttrs) {\n      var elm, html, scope;\n      scope = this.rootScope.$new();\n      scope = _.merge(scope, scopeAttrs);\n      elm = $(\"<div>\").attr(name, true).attr(\"tg-bind-scope\", true);\n      if (attrs) {\n        elm.attr(attrs);\n      }\n      elm.addClass(\"remove-on-close\");\n      html = this.compile(elm)(scope);\n      $(document.body).append(html);\n    };\n\n    return LightboxFactory;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgLightboxFactory\", LightboxFactory);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: paginate-response.service.coffee\n */\n\n(function() {\n  var PaginateResponse;\n\n  PaginateResponse = function() {\n    return function(result) {\n      var paginateResponse;\n      paginateResponse = Immutable.Map({\n        \"data\": result.get(\"data\"),\n        \"next\": !!result.get(\"headers\")(\"x-pagination-next\"),\n        \"prev\": !!result.get(\"headers\")(\"x-pagination-prev\"),\n        \"current\": result.get(\"headers\")(\"x-pagination-current\"),\n        \"count\": result.get(\"headers\")(\"x-pagination-count\")\n      });\n      return paginateResponse;\n    };\n  };\n\n  angular.module(\"taigaCommon\").factory(\"tgPaginateResponseService\", PaginateResponse);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo.service.coffee\n */\n\n(function() {\n  var ProjectLogoService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  ProjectLogoService = (function() {\n    function ProjectLogoService() {\n      var COLORS, IMAGES;\n      IMAGES = [\"/\" + window._version + \"/images/project-logos/project-logo-01.png\", \"/\" + window._version + \"/images/project-logos/project-logo-02.png\", \"/\" + window._version + \"/images/project-logos/project-logo-03.png\", \"/\" + window._version + \"/images/project-logos/project-logo-04.png\", \"/\" + window._version + \"/images/project-logos/project-logo-05.png\"];\n      COLORS = [\"rgba( 153,  214, 220, 1 )\", \"rgba( 213,  156,  156, 1 )\", \"rgba( 214, 161, 212,  1 )\", \"rgba( 164, 162, 219, 1 )\", \"rgba( 152, 224, 168,  1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    ProjectLogoService.prototype.getDefaultProjectLogo = function(slug, id) {\n      var idx, key, logo;\n      key = slug + \"-\" + id;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    return ProjectLogoService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectLogoService\", ProjectLogoService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.service.coffee\n */\n\n(function() {\n  var ProjectService, taiga;\n\n  taiga = this.taiga;\n\n  ProjectService = (function() {\n    ProjectService.$inject = [\"tgProjectsService\", \"tgXhrErrorService\"];\n\n    function ProjectService(projectsService, xhrError) {\n      this.projectsService = projectsService;\n      this.xhrError = xhrError;\n      this._project = null;\n      this._section = null;\n      this._sectionsBreadcrumb = Immutable.List();\n      this._activeMembers = Immutable.List();\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this._project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"section\", (function(_this) {\n        return function() {\n          return _this._section;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"sectionsBreadcrumb\", (function(_this) {\n        return function() {\n          return _this._sectionsBreadcrumb;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"activeMembers\", (function(_this) {\n        return function() {\n          return _this._activeMembers;\n        };\n      })(this));\n    }\n\n    ProjectService.prototype.setSection = function(section) {\n      this._section = section;\n      if (section) {\n        return this._sectionsBreadcrumb = this._sectionsBreadcrumb.push(this._section);\n      } else {\n        return this._sectionsBreadcrumb = Immutable.List();\n      }\n    };\n\n    ProjectService.prototype.setProjectBySlug = function(pslug) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (!_this.project || _this.project.get('slug') !== pslug) {\n            return _this.projectsService.getProjectBySlug(pslug).then(function(project) {\n              _this.setProject(project);\n              return resolve();\n            })[\"catch\"](function(xhr) {\n              return _this.xhrError.response(xhr);\n            });\n          } else {\n            return resolve();\n          }\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.setProject = function(project) {\n      this._project = project;\n      return this._activeMembers = this._project.get('members').filter(function(member) {\n        return member.get('is_active');\n      });\n    };\n\n    ProjectService.prototype.cleanProject = function() {\n      this._project = null;\n      this._activeMembers = Immutable.List();\n      this._section = null;\n      return this._sectionsBreadcrumb = Immutable.List();\n    };\n\n    ProjectService.prototype.hasPermission = function(permission) {\n      return this._project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    ProjectService.prototype.fetchProject = function() {\n      var pslug;\n      pslug = this.project.get('slug');\n      return this.projectsService.getProjectBySlug(pslug).then((function(_this) {\n        return function(project) {\n          return _this.setProject(project);\n        };\n      })(this));\n    };\n\n    return ProjectService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectService\", ProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: scope-event.service.coffee\n */\n\n(function() {\n  var ScopeEvent;\n\n  ScopeEvent = (function() {\n    function ScopeEvent() {}\n\n    ScopeEvent.prototype.scopes = {};\n\n    ScopeEvent.prototype._searchDuplicatedScopes = function(id) {\n      return _.find(Object.keys(this.scopes), (function(_this) {\n        return function(key) {\n          return _this.scopes[key].$id === id;\n        };\n      })(this));\n    };\n\n    ScopeEvent.prototype._create = function(name, scope) {\n      var duplicatedScopeName;\n      duplicatedScopeName = this._searchDuplicatedScopes(scope.$id);\n      if (duplicatedScopeName) {\n        throw new Error(\"scopeEvent: this scope is already register with the name \\\"\" + duplicatedScopeName + \"\\\"\");\n      }\n      if (this.scopes[name]) {\n        throw new Error(\"scopeEvent: \\\"\" + name + \"\\\" already in use\");\n      } else {\n        scope._tgEmitter = new EventEmitter2();\n        scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            scope._tgEmitter.removeAllListeners();\n            return delete _this.scopes[name];\n          };\n        })(this));\n        return this.scopes[name] = scope;\n      }\n    };\n\n    ScopeEvent.prototype.emitter = function(name, scope) {\n      if (scope) {\n        scope = this._create(name, scope);\n      } else if (this.scopes[name]) {\n        scope = this.scopes[name];\n      } else {\n        throw new Error(\"scopeEvent: \\\"\" + name + \"\\\" scope doesn't exist'\");\n      }\n      return scope._tgEmitter;\n    };\n\n    return ScopeEvent;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgScopeEvent\", ScopeEvent);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: theme.service.coffee\n */\n\n(function() {\n  var ThemeService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ThemeService = (function(superClass) {\n    extend(ThemeService, superClass);\n\n    function ThemeService() {\n      return ThemeService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ThemeService;\n\n  })(taiga.Service = function() {\n    return {\n      use: function(themeName) {\n        var stylesheetEl;\n        stylesheetEl = $(\"link[rel='stylesheet']:first\");\n        if (stylesheetEl.length === 0) {\n          stylesheetEl = $(\"<link rel='stylesheet' href='' type='text/css'>\");\n          $(\"head\").append(stylesheetEl);\n        }\n        return stylesheetEl.attr(\"href\", \"/\" + window._version + \"/styles/theme-\" + themeName + \".css\");\n      }\n    };\n  });\n\n  angular.module(\"taigaCommon\").service(\"tgThemeService\", ThemeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user.service.coffee\n */\n\n(function() {\n  var UserService, bindMethods, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = taiga.bindMethods;\n\n  UserService = (function(superClass) {\n    extend(UserService, superClass);\n\n    UserService.$inject = [\"tgResources\"];\n\n    function UserService(rs) {\n      this.rs = rs;\n      bindMethods(this);\n    }\n\n    UserService.prototype.getUserByUserName = function(username) {\n      return this.rs.users.getUserByUsername(username);\n    };\n\n    UserService.prototype.getContacts = function(userId) {\n      return this.rs.users.getContacts(userId);\n    };\n\n    UserService.prototype.getLiked = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getLiked(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getVoted = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getVoted(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getWatched = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getWatched(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getStats = function(userId) {\n      return this.rs.users.getStats(userId);\n    };\n\n    UserService.prototype.attachUserContactsToProjects = function(userId, projects) {\n      return this.getContacts(userId).then(function(contacts) {\n        projects = projects.map(function(project) {\n          var contactsFiltered;\n          contactsFiltered = contacts.filter(function(contact) {\n            var contactId;\n            contactId = contact.get(\"id\");\n            return project.get('members').indexOf(contactId) !== -1;\n          });\n          project = project.set(\"contacts\", contactsFiltered);\n          return project;\n        });\n        return projects;\n      });\n    };\n\n    return UserService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgUserService\", UserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: xhrError.service.coffee\n */\n\n(function() {\n  var xhrError,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  xhrError = (function(superClass) {\n    extend(xhrError, superClass);\n\n    xhrError.$inject = [\"$q\", \"$location\", \"$tgNavUrls\"];\n\n    function xhrError(q, location, navUrls) {\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n    }\n\n    xhrError.prototype.notFound = function() {\n      this.location.path(this.navUrls.resolve(\"not-found\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.permissionDenied = function() {\n      this.location.path(this.navUrls.resolve(\"permission-denied\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.response = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.notFound();\n        } else if (xhr.status === 403) {\n          this.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return xhrError;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgXhrErrorService\", xhrError);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-attachment.directive.coffee\n */\n\n(function() {\n  var UserTimelineAttachmentDirective;\n\n  UserTimelineAttachmentDirective = function(template, $compile) {\n    var isImage, link, validFileExtensions;\n    validFileExtensions = [\".jpg\", \".jpeg\", \".bmp\", \".gif\", \".png\"];\n    isImage = function(url) {\n      url = url.toLowerCase();\n      return _.some(validFileExtensions, function(extension) {\n        return url.indexOf(extension, url - extension.length) !== -1;\n      });\n    };\n    link = function(scope, el) {\n      var is_image, templateHtml;\n      is_image = isImage(scope.attachment.get('url'));\n      if (is_image) {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment-image.html\");\n      } else {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment.html\");\n      }\n      el.html(templateHtml);\n      $compile(el.contents())(scope);\n      return el.find(\"img\").error(function() {\n        return this.remove();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        attachment: \"=tgUserTimelineAttachment\"\n      }\n    };\n  };\n\n  UserTimelineAttachmentDirective.$inject = [\"$tgTemplate\", \"$compile\"];\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineAttachment\", UserTimelineAttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-title.service.coffee\n */\n\n(function() {\n  var UserTimelineItemTitle, unslugify;\n\n  unslugify = this.taiga.unslugify;\n\n  UserTimelineItemTitle = (function() {\n    UserTimelineItemTitle.$inject = [\"$translate\", \"$sce\"];\n\n    UserTimelineItemTitle.prototype._fieldTranslationKey = {\n      'status': 'COMMON.FIELDS.STATUS',\n      'subject': 'COMMON.FIELDS.SUBJECT',\n      'description_diff': 'COMMON.FIELDS.DESCRIPTION',\n      'points': 'COMMON.FIELDS.POINTS',\n      'assigned_to': 'COMMON.FIELDS.ASSIGNED_TO',\n      'severity': 'ISSUES.FIELDS.SEVERITY',\n      'trigger': 'ISSUES.FIELDS.TRIGGER',\n      'priority': 'ISSUES.FIELDS.PRIORITY',\n      'type': 'ISSUES.FIELDS.TYPE',\n      'is_iocaine': 'TASK.FIELDS.IS_IOCAINE',\n      'is_blocked': 'COMMON.FIELDS.IS_BLOCKED'\n    };\n\n    UserTimelineItemTitle.prototype._params = {\n      username: function(timeline, event) {\n        var title_attr, url, user;\n        user = timeline.getIn(['data', 'user']);\n        if (user.get('is_profile_visible')) {\n          title_attr = this.translate.instant('COMMON.SEE_USER_PROFILE', {\n            username: user.get('username')\n          });\n          url = \"user-profile:username=timeline.getIn(['data', 'user', 'username'])\";\n          return this._getLink(url, user.get('name'), title_attr);\n        } else {\n          return this._getUsernameSpan(user.get('name'));\n        }\n      },\n      field_name: function(timeline, event) {\n        var field_name;\n        field_name = timeline.getIn(['data', 'value_diff', 'key']);\n        return this.translate.instant(this._fieldTranslationKey[field_name]);\n      },\n      project_name: function(timeline, event) {\n        var url;\n        url = \"project:project=timeline.getIn(['data', 'project', 'slug'])\";\n        return this._getLink(url, timeline.getIn([\"data\", \"project\", \"name\"]));\n      },\n      new_value: function(timeline, event) {\n        var new_value, value;\n        if (_.isArray(timeline.getIn([\"data\", \"value_diff\", \"value\"]).toJS())) {\n          value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).get(1);\n          if (value === null && timeline.getIn([\"data\", \"value_diff\", \"key\"]) === 'assigned_to') {\n            value = this.translate.instant('ACTIVITY.VALUES.UNASSIGNED');\n          }\n          new_value = value;\n        } else {\n          new_value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).first().get(1);\n        }\n        return _.escape(new_value);\n      },\n      sprint_name: function(timeline, event) {\n        var url;\n        url = \"project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])\";\n        return this._getLink(url, timeline.getIn(['data', 'milestone', 'name']));\n      },\n      us_name: function(timeline, event) {\n        var event_us, obj, text, url;\n        obj = this._getTimelineObj(timeline, event).get('userstory');\n        event_us = {\n          obj: 'parent_userstory'\n        };\n        url = this._getDetailObjUrl(event_us);\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      obj_name: function(timeline, event) {\n        var obj, text, url;\n        obj = this._getTimelineObj(timeline, event);\n        url = this._getDetailObjUrl(event);\n        if (event.obj === 'wikipage') {\n          text = unslugify(obj.get('slug'));\n        } else if (event.obj === 'milestone') {\n          text = obj.get('name');\n        } else {\n          text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        }\n        return this._getLink(url, text);\n      },\n      role_name: function(timeline, event) {\n        return _.escape(timeline.getIn(['data', 'value_diff', 'value']).keySeq().first());\n      }\n    };\n\n    function UserTimelineItemTitle(translate, sce) {\n      this.translate = translate;\n      this.sce = sce;\n    }\n\n    UserTimelineItemTitle.prototype._translateTitleParams = function(param, timeline, event) {\n      return this._params[param].call(this, timeline, event);\n    };\n\n    UserTimelineItemTitle.prototype._getTimelineObj = function(timeline, event) {\n      return timeline.getIn(['data', event.obj]);\n    };\n\n    UserTimelineItemTitle.prototype._getDetailObjUrl = function(event) {\n      var url;\n      url = {\n        \"issue\": [\"project-issues-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"wikipage\": [\"project-wiki-page\", \":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])\"],\n        \"task\": [\"project-tasks-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"parent_userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])\"],\n        \"milestone\": [\"project-taskboard\", \":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])\"]\n      };\n      return url[event.obj][0] + url[event.obj][1];\n    };\n\n    UserTimelineItemTitle.prototype._getLink = function(url, text, title) {\n      title = title || text;\n      return $('<a>').attr('tg-nav', url).text(text).attr('title', title).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getUsernameSpan = function(text) {\n      var title;\n      title = title || text;\n      return $('<span>').addClass('username').text(text).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getParams = function(timeline, event, timeline_type) {\n      var params;\n      params = {};\n      timeline_type.translate_params.forEach((function(_this) {\n        return function(param) {\n          return params[param] = _this._translateTitleParams(param, timeline, event);\n        };\n      })(this));\n      return params;\n    };\n\n    UserTimelineItemTitle.prototype.getTitle = function(timeline, event, type) {\n      var params, paramsKeys, translation;\n      params = this._getParams(timeline, event, type);\n      paramsKeys = {};\n      Object.keys(params).forEach(function(key) {\n        return paramsKeys[key] = '{{' + key + '}}';\n      });\n      translation = this.translate.instant(type.key, paramsKeys);\n      Object.keys(params).forEach(function(key) {\n        var find;\n        find = '{{' + key + '}}';\n        return translation = translation.replace(new RegExp(find, 'g'), params[key]);\n      });\n      return translation;\n    };\n\n    return UserTimelineItemTitle;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemTitle\", UserTimelineItemTitle);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-type.service.coffee\n */\n\n(function() {\n  var UserTimelineType, timelineType;\n\n  timelineType = function(timeline, event) {\n    var types;\n    types = [\n      {\n        check: function(timeline, event) {\n          return event.obj === 'membership';\n        },\n        key: 'TIMELINE.NEW_MEMBER',\n        translate_params: ['project_name'],\n        member: function(timeline) {\n          return Immutable.Map({\n            user: timeline.getIn(['data', 'user']),\n            role: timeline.getIn(['data', 'role'])\n          });\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'project' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_PROJECT',\n        translate_params: ['username', 'project_name'],\n        description: function(timeline) {\n          return timeline.getIn(['data', 'project', 'description']);\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'attachments';\n        },\n        key: 'TIMELINE.UPLOAD_ATTACHMENT',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.US_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'create';\n        },\n        key: 'TIMELINE.ISSUE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'create';\n        },\n        key: 'TIMELINE.WIKI_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED_WITH_US',\n        translate_params: ['username', 'project_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'create';\n        },\n        key: 'TIMELINE.MILESTONE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.NEW_COMMENT_US',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'issue';\n        },\n        key: 'TIMELINE.NEW_COMMENT_ISSUE',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'task';\n        },\n        key: 'TIMELINE.NEW_COMMENT_TASK',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && timeline.hasIn(['data', 'value_diff', 'value', 'backlog_order']) && event.type === 'change';\n        },\n        key: 'TIMELINE.US_MOVED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'milestone']).get(1) === null;\n          }\n          return false;\n        },\n        key: 'TIMELINE.US_REMOVED_FROM_MILESTONE',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.US_ADDED_MILESTONE',\n        translate_params: ['username', 'obj_name', 'sprint_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === true;\n          }\n          return false;\n        },\n        key: 'TIMELINE.BLOCKED',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          if (timeline.hasIn(['data', 'value_diff', 'value', 'blocked_note_html'])) {\n            text = timeline.getIn(['data', 'value_diff', 'value', 'blocked_note_html']).get(1);\n            return $($.parseHTML(text)).text();\n          } else {\n            return false;\n          }\n        }\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === false;\n          }\n          return false;\n        },\n        key: 'TIMELINE.UNBLOCKED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'change';\n        },\n        key: 'TIMELINE.MILESTONE_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'change';\n        },\n        key: 'TIMELINE.WIKI_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'points';\n        },\n        key: 'TIMELINE.US_UPDATED_POINTS',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value', 'role_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.US_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'user' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_USER',\n        translate_params: ['username']\n      }\n    ];\n    return _.find(types, function(obj) {\n      return obj.check(timeline, event);\n    });\n  };\n\n  UserTimelineType = (function() {\n    function UserTimelineType() {}\n\n    UserTimelineType.prototype.getType = function(timeline, event) {\n      return timelineType(timeline, event);\n    };\n\n    return UserTimelineType;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemType\", UserTimelineType);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item.directive.coffee\n */\n\n(function() {\n  var UserTimelineItemDirective;\n\n  UserTimelineItemDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline-item/user-timeline-item.html\",\n      scope: {\n        timeline: \"=tgUserTimelineItem\"\n      }\n    };\n  };\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineItem\", UserTimelineItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-pagination-sequence.service.coffee\n */\n\n(function() {\n  var UserTimelinePaginationSequence;\n\n  UserTimelinePaginationSequence = function() {\n    var obj;\n    obj = {};\n    obj.generate = function(config) {\n      var getContent, items, next, page;\n      page = 1;\n      items = Immutable.List();\n      config.minItems = config.minItems || 20;\n      next = function() {\n        items = Immutable.List();\n        return getContent();\n      };\n      getContent = function() {\n        return config.fetch(page).then(function(response) {\n          var data;\n          page++;\n          data = response.get(\"data\");\n          if (config.filter) {\n            data = config.filter(data);\n          }\n          if (config.map) {\n            data = data.map(config.map);\n          }\n          items = items.concat(data);\n          if (items.size < config.minItems && response.get(\"next\")) {\n            return getContent();\n          }\n          return Immutable.Map({\n            items: items,\n            next: response.get(\"next\")\n          });\n        });\n      };\n      return {\n        next: function() {\n          return next();\n        }\n      };\n    };\n    return obj;\n  };\n\n  angular.module(\"taigaUserTimeline\").factory(\"tgUserTimelinePaginationSequenceService\", UserTimelinePaginationSequence);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/profile/profile-timeline/profile-timeline.controller.coffee\n */\n\n(function() {\n  var UserTimelineController, mixOf, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  UserTimelineController = (function(superClass) {\n    extend(UserTimelineController, superClass);\n\n    UserTimelineController.$inject = [\"tgUserTimelineService\"];\n\n    function UserTimelineController(userTimelineService) {\n      this.userTimelineService = userTimelineService;\n      this.timelineList = Immutable.List();\n      this.scrollDisabled = false;\n      this.timeline = null;\n      if (this.projectId) {\n        this.timeline = this.userTimelineService.getProjectTimeline(this.projectId);\n      } else if (this.currentUser) {\n        this.timeline = this.userTimelineService.getProfileTimeline(this.user.get(\"id\"));\n      } else {\n        this.timeline = this.userTimelineService.getUserTimeline(this.user.get(\"id\"));\n      }\n    }\n\n    UserTimelineController.prototype.loadTimeline = function() {\n      this.scrollDisabled = true;\n      return this.timeline.next().then((function(_this) {\n        return function(response) {\n          _this.timelineList = _this.timelineList.concat(response.get(\"items\"));\n          if (response.get(\"next\")) {\n            _this.scrollDisabled = false;\n          }\n          return _this.timelineList;\n        };\n      })(this));\n    };\n\n    return UserTimelineController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  angular.module(\"taigaUserTimeline\").controller(\"UserTimeline\", UserTimelineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.directive.coffee\n */\n\n(function() {\n  var UserTimelineDirective;\n\n  UserTimelineDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline/user-timeline.html\",\n      controller: \"UserTimeline\",\n      controllerAs: \"vm\",\n      scope: {\n        projectId: \"=projectid\",\n        user: \"=\",\n        currentUser: \"=\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgUserTimeline\", UserTimelineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.service.coffee\n */\n\n(function() {\n  var UserTimelineService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  UserTimelineService = (function(superClass) {\n    extend(UserTimelineService, superClass);\n\n    UserTimelineService.$inject = [\"tgResources\", \"tgUserTimelinePaginationSequenceService\", \"tgUserTimelineItemType\", \"tgUserTimelineItemTitle\"];\n\n    function UserTimelineService(rs, userTimelinePaginationSequenceService, userTimelineItemType, userTimelineItemTitle) {\n      this.rs = rs;\n      this.userTimelinePaginationSequenceService = userTimelinePaginationSequenceService;\n      this.userTimelineItemType = userTimelineItemType;\n      this.userTimelineItemTitle = userTimelineItemTitle;\n    }\n\n    UserTimelineService.prototype._valid_fields = ['status', 'subject', 'description_diff', 'assigned_to', 'points', 'severity', 'trigger', 'priority', 'type', 'attachments', 'is_iocaine', 'content_diff', 'name', 'estimated_finish', 'estimated_start', 'blocked', 'moveInBacklog', 'milestone'];\n\n    UserTimelineService.prototype._invalid = [\n      {\n        check: function(timeline) {\n          var fieldKey, value_diff;\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff) {\n            fieldKey = value_diff.get('key');\n            if (this._valid_fields.indexOf(fieldKey) === -1) {\n              return true;\n            } else if (fieldKey === 'attachments' && value_diff.get('value').get('new').size === 0) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          return event[2] === 'change' && value_diff === void 0;\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[2] === 'delete';\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[1] === 'project' && event[2] === 'change';\n        }\n      }, {\n        check: function(timeline) {\n          return !!timeline.get(\"data\").get(\"comment_deleted\");\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff && event[1] === \"task\" && event[2] === \"change\" && value_diff.get(\"key\") === \"milestone\") {\n            return timeline.get(\"data\").get(\"value_diff\").get(\"value\");\n          }\n          return false;\n        }\n      }\n    ];\n\n    UserTimelineService.prototype._isInValidTimeline = function(timeline) {\n      return _.some(this._invalid, (function(_this) {\n        return function(invalid) {\n          return invalid.check.call(_this, timeline);\n        };\n      })(this));\n    };\n\n    UserTimelineService.prototype._parseEventType = function(event_type) {\n      event_type = event_type.split(\".\");\n      return {\n        section: event_type[0],\n        obj: event_type[1],\n        type: event_type[2]\n      };\n    };\n\n    UserTimelineService.prototype._getTimelineObject = function(timeline, event) {\n      if (timeline.get('data').get(event.obj)) {\n        return timeline.get('data').get(event.obj);\n      }\n    };\n\n    UserTimelineService.prototype._attachExtraInfoToTimelineEntry = function(timeline, event, type) {\n      var title;\n      title = this.userTimelineItemTitle.getTitle(timeline, event, type);\n      timeline = timeline.set('title_html', title);\n      timeline = timeline.set('obj', this._getTimelineObject(timeline, event));\n      if (type.description) {\n        timeline = timeline.set('description', type.description(timeline));\n      }\n      if (type.member) {\n        timeline = timeline.set('member', type.member(timeline));\n      }\n      if (timeline.getIn(['data', 'value_diff', 'key']) === 'attachments' && timeline.hasIn(['data', 'value_diff', 'value', 'new'])) {\n        timeline = timeline.set('attachments', timeline.getIn(['data', 'value_diff', 'value', 'new']));\n      }\n      return timeline;\n    };\n\n    UserTimelineService.prototype._parseTimeline = function(response) {\n      var newdata;\n      newdata = Immutable.List();\n      response.get('data').forEach((function(_this) {\n        return function(item) {\n          var data, event, newItem, values_diff;\n          event = _this._parseEventType(item.get('event_type'));\n          data = item.get('data');\n          values_diff = data.get('values_diff');\n          if (values_diff && values_diff.count()) {\n            if (values_diff.has('is_blocked')) {\n              values_diff = Immutable.Map({\n                'blocked': values_diff\n              });\n            }\n            if (values_diff.has('milestone')) {\n              if (event.obj === 'userstory') {\n                values_diff = Immutable.Map({\n                  'moveInBacklog': values_diff\n                });\n              } else {\n                values_diff = values_diff.deleteIn(['values_diff', 'milestone']);\n              }\n            } else if (event.obj === 'milestone') {\n              values_diff = Immutable.Map({\n                'milestone': values_diff\n              });\n            }\n            return values_diff.forEach(function(value, key) {\n              var newItem, obj;\n              obj = Immutable.Map({\n                key: key,\n                value: value\n              });\n              newItem = item.setIn(['data', 'value_diff'], obj);\n              newItem = newItem.deleteIn(['data', 'values_diff']);\n              return newdata = newdata.push(newItem);\n            });\n          } else {\n            newItem = item.deleteIn(['data', 'values_diff']);\n            return newdata = newdata.push(newItem);\n          }\n        };\n      })(this));\n      return response.set('data', newdata);\n    };\n\n    UserTimelineService.prototype._addEntyAttributes = function(item) {\n      var event, type;\n      event = this._parseEventType(item.get('event_type'));\n      type = this.userTimelineItemType.getType(item, event);\n      return this._attachExtraInfoToTimelineEntry(item, event, type);\n    };\n\n    UserTimelineService.prototype.getProfileTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getProfileTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getUserTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getUserTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getProjectTimeline = function(projectId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.projects.getTimeline(projectId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    return UserTimelineService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineService\", UserTimelineService);\n\n}).call(this);\n\n//# sourceMappingURL=maps/app.js.map\n"]}