{"version":3,"sources":["app.js"],"names":["configure","i18nInit","init","module","modules","pluginsWithModule","taiga","this","taigaContribPlugins","window","generateHash","components","_","map","x","JSON","stringify","hex_sha1","join","generateUniqueSessionIdentifier","date","randomNumber","Date","getTime","Math","floor","random","sessionId","$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","authHttpIntercept","decorators","defaultHeaders","loaderIntercept","originalWhen","preferedLangCode","userInfo","versionCheckHttpIntercept","classNameFilter","when","path","route","resolve","angular","extend","languageLoad","$q","$translate","deferred","defer","then","promise","call","templateUrl","controller","controllerAs","loader","title","description","joyride","reloadOnSearch","access","requiresLogin","section","redirectTo","params","pslug","disableHeader","mobileViewport","otherwise","html5Mode","enabled","requireBase","Content-Type","Accept-Language","taigaConfig","defaultLanguage","X-Session-Id","defaults","headers","patch","post","put","get","useApplyAsync","setSessionId","$location","$navUrls","$lightboxService","httpResponseError","response","nextUrl","status","config","cancelable","closeAll","replace","url","indexOf","encodeURIComponent","search","reject","responseError","factory","interceptors","push","loaderService","request","logRequest","requestError","rejection","logResponse","$injector","data","version","element","injector","invoke","_this","$confirm","versionErrorMsg","instant","notify","checksley","updateValidators","linewidth","val","width","lines","valid","nl2br","split","every","line","length","debugInfoEnabled","debugInfo","localStorage","parse","lang","addPart","useLoader","urlTemplate","_version","useSanitizeValueStrategy","addInterpolation","preferredLanguage","fallbackLanguage","getDecorators","each","decorator","provider","messages","moment","locale","defaultMessage","type","email","urlstrict","number","digits","dateIso","alphanum","phone","notnull","notblank","required","regexp","min","max","range","minlength","maxlength","rangelength","mincheck","maxcheck","rangecheck","equalto","updateMessages","$log","$rootscope","$auth","$events","$analytics","appMetaService","projectService","navigationBarService","un","user","debug","contribPlugins","adminPlugins","where","$on","e","ctx","language","Promise","setScheduler","cb","$evalAsync","setupConnection","isAuthenticated","getUser","initialize","event","next","start","setSection","setProjectBySlug","cleanProject","setAll","addMobileViewport","removeMobileViewport","enableHeader","filter","plugin","value","concat","run","TaigaBase","TaigaController","TaigaService","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","bind","fn","me","apply","arguments","superClass","onInitialDataError","xhr","location","navUrls","q","Base","Service","Controller","bindMethods","bindOnce","cancelTimeout","debounce","debounceLeading","defineImmutableProperty","groupBy","isImage","joinStr","mixOf","replaceTags","scopeDefer","sizeFormat","slugify","startswith","stripTags","timeout","toString","toggleText","trim","truncate","unslugify","item","i","l","slice","str","breakTag","object","dependencies","methods","keys","forIn","bindAll","scope","attr","continuation","delBind","$eval","$watch","Mixed","base","method","mixin","mixins","name","ref","char","capitalize","texts","nextTextPosition","text","coll","pred","len","result","wait","setTimeout","timeoutVar","clearTimeout","func","$apply","isNumber","isString","isPlainObject","isUndefined","leading","trailing","str1","str2","startsWith","maxLength","suffix","out","String","substring","lastIndexOf","input","precision","size","units","isNaN","parseFloat","isFinite","log","pow","toFixed","exception","pattern","RegExp","tags","obj","Object","defineProperty","fn_result","isFunction","isObject","removeKeys","chain","flatten","reduce","cartesianProduct","reduceRight","a","b","y","match","oldImmutable","newImmutable","pathObj","forEach","newValue","toJS","FiltersMixin","PageMixin","fillUsersAndRoles","users","roles","activeUsers","computableRoles","is_active","sortBy","activeUsersById","id","usersById","project","members","uniq","contains","loadUsersAndRoles","all","rs","projects","usersList","projectId","rolesList","results","selectFilter","load","existing","compact","isInCurrentRouteParams","noreload","replaceFilter","replaceAllFilters","filters","unselectFilter","newValues","parsedValues","isEmpty","AuthService","CancelAccountDirective","ChangeEmailDirective","ChangePasswordFromRecoveryDirective","ForgotPasswordDirective","InvitationDirective","LoginDirective","PublicRegisterMessageDirective","RegisterDirective","rootscope","storage","model","http","urls","translate","currentUserService","themeService","userModel","_currentTheme","_getUserTheme","setUserdata","$inject","userData","Immutable","fromJS","getAttrs","setUser","theme","_setTheme","newTheme","use","_setLocales","make_model","auth","set","clear","remove","setToken","token","getToken","removeToken","login","clone","auth_token","logout","removeUser","register","getInvitation","invitations","acceptInvitiationWithNewUser","acceptInvitiationWithExistingUser","forgotPassword","changePasswordFromRecovery","changeEmail","cancelAccount","service","$config","$routeParams","templates","template","templateFn","publicRegisterEnabled","console","restrict","directive","link","$scope","$el","$attrs","form","onError","onSuccess","submit","Form","find","decodeURIComponent","loginFormType","preventDefault","validate","username","password","on","prerenderReady","off","onErrorSubmit","onSuccessSubmit","onlyOneErrorElement","trackEvent","_error_message","error","setErrors","success","$params","tokenInParams","loginForm","onErrorSubmitLogin","onErrorSubmitRegister","onSuccessSubmitLogin","onSuccessSubmitRegister","registerForm","submitLogin","submitRegister","invitation","dataLogin","project_slug","project_name","dataRegister","escape","$repo","$model","email_token","queryOne","cancel_token","TaigaMainDirective","$window","onresize","$broadcast","home","not-found","permission-denied","discover","discover-search","forgot-password","change-password","change-email","cancel-account","create-project","profile","user-profile","project-backlog","project-taskboard","project-kanban","project-issues","project-search","project-userstories-detail","project-tasks-detail","project-issues-detail","project-wiki","project-wiki-page","project-team","project-admin-home","project-admin-project-profile-details","project-admin-project-profile-default-values","project-admin-project-profile-modules","project-admin-project-profile-export","project-admin-project-profile-reports","project-admin-project-values-status","project-admin-project-values-points","project-admin-project-values-priorities","project-admin-project-values-severities","project-admin-project-values-triggers","project-admin-project-values-types","project-admin-project-values-custom-fields","project-admin-memberships","project-admin-roles","project-admin-third-parties-webhooks","project-admin-third-parties-github","project-admin-third-parties-gitlab","project-admin-third-parties-bitbucket","project-admin-contrib","user-settings-user-profile","user-settings-user-change-password","user-settings-user-avatar","user-settings-mail-notifications","$navurls","update","AnimationFrame","Capslock","CheckPermissionDirective","ClassPermissionDirective","DataPickerConfig","LimitLineLengthDirective","ProjectUrl","Qqueue","SelectedText","Template","ToggleCommentDirective","i18n","previousMonth","nextMonth","months","weekdays","weekdaysShort","isRTL","firstDay","parseInt","format","$document","getSelection","selection","createRange","render","permission","removeClass","unObserve","unwatch","addClass","tgCheckPermission","$observe","checkPermissions","tgClassPermissionWatchAction","unbindWatcher","className","negation","my_permissions","classes","add","animationFrame","performAnimation","tail","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","time","shift","slug","is_backlog_activated","is_kanban_activated","is_wiki_activated","is_issues_activated","maxColsPerLine","code","keyCode","index","lastPromise","qqueue","bindAdd","args","$templateCache","lodash","tmp","hideIcon","open","showIcon","warningIcon","$","fadeOut","currentTarget","append","fadeIn","toLowerCase","EventsProvider","EventsService","win","liveAnnouncementService1","rootScope","liveAnnouncementService","processMessage","subscriptions","connected","pendingMessages","missedHeartbeats","heartbeatInterval","WebSocket","info","loc","scheme","stopExistingConnection","protocol","ltrim","host","ws","addEventListener","onOpen","onMessage","onClose","removeEventListener","stopHeartBeatMessages","close","notifications","subscribe","show","desc","$digest","startHeartBeatMessages","heartbeatIntervalTime","maxMissedHeartbeats","setInterval","error1","Error","sendMessage","cmd","message","clearInterval","processHeartBeatPongMessage","serialize","msg","send","routingKey","subscription","routing_key","callback","unsubscribe","$get","$win","$conf","$rootScope","FeedbackDirective","$loading","feedbackService","openLightbox","submitButton","currentLoading","target","create","feedback","finish","focus","RelatedTaskAssignedToInlineEditionDirective","RelatedTaskCreateButtonDirective","RelatedTaskCreateFormDirective","RelatedTaskRowDirective","RelatedTasksDirective","$compile","$template","templateEdit","templateView","renderEdit","renderView","saveTask","task","subject","save","html","$modelValue","perms","modify_task","delete_task","select","askOnDelete","askResponse","$emit","ngModel","require","$tgmodel","newTask","assigned_to","createTask","default_task_status","newRelatedTaskFormOpen","us","$rs","loadTasks","tasks","list","usId","$ctrl","autoSave","notAutoSave","updateRelatedTask","member","imgurl","photo","full_name_display","tgRelatedTaskAssignedToInlineEdition","unbind","userId","updatedRelatedTask","ResourcesService","initResources","initUrls","auth-register","by_username","users-password-recovery","users-change-password-from-recovery","users-change-password","users-change-email","users-cancel-account","user-stats","user-liked","user-voted","user-watched","user-contacts","permissions","notify-policies","user-storage","memberships","bulk-create-memberships","resolver","project-templates","project-modules","bulk-update-projects-order","project-like","project-unlike","project-watch","project-unwatch","userstory-statuses","points","task-statuses","issue-statuses","issue-types","priorities","severities","triggers","milestones","userstories","bulk-create-us","bulk-update-us-backlog-order","bulk-update-us-sprint-order","bulk-update-us-kanban-order","userstories-filters","userstory-upvote","userstory-downvote","userstory-watch","userstory-unwatch","bulk-create-tasks","bulk-update-task-taskboard-order","task-upvote","task-downvote","task-watch","task-unwatch","issues","bulk-create-issues","issues-filters","issue-upvote","issue-downvote","issue-watch","issue-unwatch","wiki","wiki-restore","wiki-links","history/us","history/issue","history/task","history/wiki","attachments/us","attachments/issue","attachments/task","attachments/wiki_page","custom-attributes/userstory","custom-attributes/issue","custom-attributes/task","custom-attributes-values/userstory","custom-attributes-values/issue","custom-attributes-values/task","webhooks","webhooks-test","webhooklogs","webhooklogs-resend","userstories-csv","tasks-csv","issues-csv","timeline-profile","timeline-user","timeline-project","exporter","importer","locales","applications","application-tokens","stats-discover","$urls","providers","toArray","SearchBoxDirective","SearchController","SearchDirective","scope1","repo","loadSearchData","sectionName","loadInitialData","projectName","projectDescription","searchTerm","t","searchResults","term","loadFilters","defered","loadProject","getBySlug","issueStatusById","issue_statuses","taskStatusById","task_statuses","severityById","triggerById","priorityById","usStatusById","us_statuses","loading","_loadSearchData","_promise","abort","$route","reload","$templatecache","$routeparams","linkTable","activeSectionName","applyAutoTab","getActiveSection","lastSearchResults","markSectionTabActive","renderFilterTabs","renderTableContent","tabsDom","maxVal","selectedSection","wikipages","oldElements","oldScope","children","$destroy","$new","parseHTML","activeSection","sectionData","searchText","AnalyticsService","doc","conf","initialized","accountId","pageEvent","trackRoutes","ignoreFirstPageLoad","injectAnalytics","ga","getUrl","trackPage","s","o","g","r","m","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","page","category","action","label","BindScope","jQuery","CompileHtmlDirective","attrs","tgCompileHtml","oldValue","contents","AssignedToDirective","BlockButtonDirective","CreatedByDisplayDirective","DateRangeDirective","DateSelectorDirective","DeleteButtonDirective","EditableDescriptionDirective","EditableSubjectDirective","EditableWysiwyg","ListItemAssignedtoDirective","ListItemIssueStatusDirective","ListItemPriorityDirective","ListItemSeverityDirective","ListItemTaskStatusDirective","ListItemTriggerDirective","ListItemTypeDirective","ListItemUsStatusDirective","SprintProgressBarDirective","TgMainTitleDirective","TgProgressBarDirective","WatchersDirective","renderRange","first","second","endDate","initDate","prettyDate","tgDateRange","valFirst","valSecond","datePickerConfigService","selectedDate","datePickerConfig","merge","field","onSelect","picker","setDate","Pikaday","renderProgress","percentage","visual_percentage","hasClass","css","tgSprintProgressbar","sprint","closedPoints","totalPoints","closed_points","total_points","round","owner","owner_extra_info","created_date","$qqueue","deleteWatcher","isEditable","renderWatchers","ref1","requiredPerm","watchers","$setViewValue","watcherId","revert","watcherIds","pull","$currentUserService","renderAssignedTo","assignedObject","fullName","isIocaine","isUnassigned","assigned_to_extra_info","is_iocaine","fullNameVisible","ask","instance","is_blocked","onDeleteGoToUrl","onDeleteTitle","subtitle","hide","click","$selectedText","noDescriptionMegEditMode","noDescriptionMegReadMode","is","href","scrollTop","offset","top","noDescriptionMsg","attachmentsService","attachmentsFullService","isInEditMode","uploadFile","file","addAttachment","getIn","textarea","dataTransfer","promises","stopPropagation","originalEvent","files","markItUp","replaceWith","tgListitemUsStatus","tgListitemTaskStatus","tgListitemAssignedto","issue","tgListitemIssueStatus","issueTypeById","domNode","color","tgListitemType","priority","tgListitemPriority","severity","tgListitemSeverity","tgListitemTrigger","trigger","el","tgProgressBar","i18nSectionName","ConfirmService","NOTIFICATION_MSG","light-error","lightboxService","lightboxSelector","ok","askChoice","choices","replacement","warning","choicesField","selected","stop","percent","body","selector","tsem","CustomAttributeValueDirective","CustomAttributesValuesController","CustomAttributesValuesDirective","DATE_TYPE","MULTILINE_TYPE","SELECT_TYPE","TEXT_TYPE","TYPE_CHOICES","confirm","objectId","customAttributes","customAttributesValues","loadCustomAttributesValues","getAttributeValue","attribute","attributeValue","attributes_values","updateAttributeValue","attributesValues","$templates","$storage","collapsedHash","$ctrls","collapsed","hash","requiredEditionPerm","setFocusAndSelectOnInputField","edit","editable","isValid","tgCustomAttributeValue","EstimationsService","LbUsEstimationDirective","UsEstimationDirective","$tgEstimationsService","estimationProcess","onSelectedPointForRole","roleId","pointId","mainTemplate","calculateTotalPoints","calculateRoles","EstimationProcess","pointsTemplate","$el1","us1","project1","bindClickEvents","pointsById","notNullValues","values","v","k","acc","num","role","pointObj","renderPointsSelector","siblings","popover","horizontalList","maxPointLength","pop","point","some","horizontal","closest","height","clientHeight","defaultFilter","momentFormat","momentFromNow","yesNoFilter","defaultValue","without_suffix","fromNow","HistoryController","HistoryDirective","IGNORED_FIELDS","userstories.userstory","tasks.task","issues.issue","loadHistory","history","changeModel","historyEntry","historyResult","j","len1","values_diff","description_diff","description_html","blocked_note_diff","blocked_note","blocked_note_html","comments","comment","deleteComment","activityId","undeleteComment","checkPermissionsService","templateActivity","templateBase","templateBaseEntries","templateChangeAttachment","templateChangeDiff","templateChangeGeneric","templateChangeList","templateChangePoints","templateDeletedComment","countChanges","formatChange","getHumanizedFieldName","getPrettyDateFormat","renderActivity","renderAttachmentEntry","renderBase","renderChange","renderChangeEntries","renderChangeEntry","renderChangesHelperText","renderComment","renderComments","renderCustomAttributesEntry","renderHistory","rerender","showAllActivity","showAllComments","humanizedFieldNames","content","is_closed","finish_date","milestone","user_story","client_requirement","team_requirement","attachments","is_deprecated","order","backlog_order","sprint_order","kanban_order","taskboard_order","us_order","change","isArray","changes","diff","filename","from","to","outerHTML","customAttrsChanges","added","removed","difference","ref2","delete_comment_date","delete_comment_user","deleteCommentDate","deleteCommentUser","comment_html","canRestoreComment","pk","avatar","userFullName","userProfileUrl","creationDate","created_at","changesText","mode","deleteCommentActionTitle","canDeleteComment","entries","totalEntries","showMore","commentsVisible","historyVisible","check","ngmodel","totalComments","last","totalChanges","parents","toggleClass","ImportProjectButtonDirective","errorMsg","error_message","AssignedToLightboxDirective","AttachmentPreviewLightboxDirective","BlockLightboxDirective","BlockingMessageInputDirective","CreateBulkUserstoriesDirective","CreateEditUserstoryDirective","LightboxDirective","LightboxKeyboardNavigationService","LightboxService","WatchersLightboxDirective","docEl","lightboxContent","not","one","which","removeAttr","lightboxEl","dispatch","activeElement","prev","$tgrepo","block","unblock","finishCallback","watch","attachmentsToAdd","attachmentsToDelete","createAttachments","deleteAttachments","resetAttachments","createEditUs","isNew","List","attachment","deleteAttachment","statusList","usStatusList","is_archived","upload","broadcastEvent","keydown","statusId","bulk","bulkCreate","lightboxKeyboardNavigationService","closeLightbox","filterUsers","normalizeString","selectedItem","selectedUser","usersTemplate","string","normalizedString","toUpperCase","partial","assignedToId","searchingText","usersSearch","getFilteredUsers","_filterUsers","Loader","LoaderDirective","tgLoader","onStart","onEnd","autoClose","lastResponseDate","pageLoaded","requestCount","startLoadTime","minTime","force","endTime","timeoutValue","intervalAuto","auto","LoadingDirective","TgLoadingService","spinner","settings","removeClasses","classess","timeoutId","tgLoading","showLoading","RelatedTaskStatusDirective","UsStatusDirective","usStatusDom","usStatusDomParent","tgUsStatus","onUpdate","statuses","selectionTemplate","updateTaskStatus","taskStatusDom","taskStatusDomParent","tgRelatedTaskStatus","closePopover","isVisible","docViewBottom","docViewLeft","docViewRight","docViewTop","docViewWidth","elemBottom","elemLeft","elemRight","elemTop","elemWidth","display","visibility","left","ExceptionHandlerFactory","ravenConfig","Raven","install","cause","captureException","ColorizeTagsDirective","LbTagLineDirective","TagLineDirective","TagsDirective","formatter","parser","$formatters","$parsers","backlog","kanban","taskboard","srcTags","tgColorizeTagsType","sort","tag","tags_colors","tgColorizeTags","COMMA_KEY","ENTER_KEY","templateTags","addValue","deleteValue","hideSaveButton","renderTags","resetInput","saveInputTag","showSaveButton","tagsColors","style","autocomplete","fromCharCode","positioningFunction","position","elements","menu","source","my","using","ui","ESC_KEY","hideAddTagButton","hideAddTagButtonText","hideInput","renderInReadModeOnly","showAddTagButton","showAddTagButtonText","showInput","blur","MarkitupDirective","previewTemplate","addLine","cancelablePromise","closePreviewMode","markdownTitle","prepareUrlFormatting","preview","previewDomNode","renderMarkItUp","setCaretPosition","urlFormatting","class","markItUpDomNode","markdownDomNode","mdrender","markdown","caretPosition","scrollRelation","totalLines","createTextRange","move","selectionStart","setSelectionRange","scrollHeight","nline","cursorPosition","indices","regex","exec","donotparse","endIndex","startIndex","heading","n","placeHolder","markdownSettings","nameSpace","onShiftEnter","keepDefault","openWith","onEnter","afterInsert","cursorLine","emptyListItem","lastLine","markdownCaretPositon","newLineContent","markupSet","closeWith","separator","beforeInsert","markItUpRemove","textcomplete","cache","searchProps","searchTypes","prop","res","count","BacklogFiltersDirective","templateSelected","currentFiltersType","getFiltersType","initializeSelectedFilters","reloadUserstories","renderFilters","renderSelectedFilters","selectQFilter","selectedFilters","showCategories","showFilters","toggleFilterSelection","f","loadUserstories","generateFilters","currentFilters","CreateEditSprint","createSprint","getLastSprint","hasErrors","resetSprint","estimated_start","estimated_finish","newSprint","copy","setAttr","sprintsCounter","__all__","milestonesCounter","openSprints","sortedSprints","sprints","closed","estimatedFinish","estimatedStart","lastSprint","lastSprintNameDom","reset","editSprint","BacklogController","BacklogDirective","BurndownBacklogGraphDirective","TgBacklogProgressBarDirective","ToggleBurndownVisibility","UsPointsDirective","UsRolePointsSelectorDirective","params1","events","analytics","rs2","showTags","activeFilters","showGraphPlaceholder","initializeEventHandlers","getShowTags","loadProjectStats","loadSprints","loadClosedSprints","moveUs","unloadClosedSprints","initializeSubscription","routingKey1","routingKey2","toggleShowTags","storeShowTags","toggleActiveFilters","stats","defined_points","completedPercentage","total_milestones","closedSprints","totalClosedMilestones","user_stories","closedSprintsById","totalMilestones","totalOpenMilestones","reverse","sprintsById","currentSprint","findCurrentSprint","restoreFilters","selectedStatuses","selectedTags","oldSelectedTags","oldSelectedStatuses","filtersQ","filtersQOld","filterGrp","resetFilters","httpParams","getUrlFilters","storeQueryParams","listUnassigned","setSearchDataFilters","loadBacklog","closedMilestones","total_closed_milestones","prepareBulkUpdateData","uses","us_id","resortUserStories","items","isModified","usList","newUsIndex","newSprintId","len2","movedFromClosedSprint","movedToClosedSprint","oldSprintId","splice","Array","bulkUpdateBacklogOrder","bulkUpdateSprintOrder","len3","isFilterSelected","searchdata","urlfilters","results1","pick","filtersData","choicesFiltersFormat","tagsFilterFormat","byIdObject","markSelectedFilters","isSelected","omit","updateUserStoryStatus","editUserStory","$event","getByRef","deleteUserStory","without","addNewUs","default_us_status","addNewSprint","currentDate","end","doomLineTemplate","linkDoomLine","linkFilters","linkToolbar","showHideFilter","showHideTags","addDoomLineDom","getUsItems","reloadDoomLine","removeDoomlineDom","current_sum","domElement","assigned_points","before","rowElements","checkSelected","getUsToMove","lastChecked","moveToCurrentSprint","moveToLatestSprint","moveUssToSprint","shiftPressed","ussDom","itemScope","selectedUss","extraPoints","totalExtraPoints","ussCurrent","union","saveAll","moveToSprintDom","selectedUsDom","shiftKey","current","nextAll","prevAll","nextUntil","prevUntil","elm","ussToMove","hideText","showText","sidebar","filtersSearch","disableSelection","numberOfRoles","roleName","rolScope","$tgTemplate","rolesTemplate","bindClickElements","filteringRoleId","renderRolesSelector","selectedRoleId","updatingSelectedRoleId","tgBacklogUsPoints","popRolesDom","firstLoad","toggleGraph","isBurndownGraphCollapsed","redrawChart","dataToDraw","client_increment_line","colors","evolution_line","milestonesRange","optimal_line","options","team_increment_line","zero_line","ml","zip","fillColor","optimal","evolution","grid","borderWidth","right","bottom","borderColor","hoverable","xaxis","ticks","axisLabel","axisLabelUseCanvas","axisLabelFontSizePixels","axisLabelFontFamily","axisLabelPadding","tickFormatter","axis","yaxis","series","shadowSize","fill","radius","lineWidth","tooltip","tooltipOpts","xval","yval","flotItem","seriesIndex","sprintName","abs","empty","plot","adjustPercentaje","projectPointsPercentaje","closedPointsPercentaje","adjusted","tgBacklogProgressBar","definedPoints","BacklogEmptySortableDirective","BacklogSortableDirective","SprintSortableDirective","deleteElement","$tgConfirm","getUsIndex","filterError","sortable","cancel","connectWith","dropOnEmpty","placeholder","scroll","disableHorizontalScroll","tolerance","itemIndex","itemUs","forcePlaceholderSize","BacklogSprintDirective","BacklogSprintHeaderDirective","ToggleExcludeClosedSprintsVisualization","slideOptions","sprintTableMinHeight","toggleSprint","duration","easing","sprintArrow","sprintTable","tgBacklogSprint","slideToggle","compiledTemplate","estimatedDateRange","taskboardUrl","templateScope","assign","excludeClosedSprints","loadingElm","after","SprintGraphDirective","days","day","unshift","d","optimal_points","open_points","tickSize","daysNames","formattedDate","roundedValue","CreateBulkTasksDirective","CreateEditTaskDirective","sprintId","TaskboardController","TaskboardDirective","TaskboardSquishColumnDirective","TaskboardTaskDirective","TaskboardUserDirective","rs1","_setMeta","startDate","completedPoints","completedPointsSum","totalPointsSum","openTasks","totalTasks","total_tasks","loadTaskboard","taskMove","refreshTagsColors","loadSprintStats","loadSprint","pointsList","roleById","taskStatusList","remainingPointsSum","remainingTasks","completed_points","completed_tasks","usTasks","isPlaceholder","sslug","refreshTasksOrder","resortTasks","bulkUpdateTaskTaskboardOrder","task_id","addNewTask","editTaskAssignedTo","tableBodyDom","tableHeaderDom","scrollLeft","$rs2","editingTask","avatarWidth","maxColumnWidth","getCeilWidth","recalculateStatusColumnWidth","recalculateTaskboardWidth","refreshTaskboardTableWidth","setStatusColumnWidth","statusesFolded","getStatusColumnModes","usFolded","getUsRowModes","foldStatus","storeStatusColumnModes","foldUs","storeUsRowModes","tasksMatrixSize","sqrt","column","columnWidths","columns","totalWidth","outerWidth","total","statusFoldedWidth","clickable","username_label","TaskboardSortableDirective","itemEl","newParentScope","oldParentScope","tdom","handle","itemTask","newStatusId","newUsId","oldStatusId","oldUsId","parentEl","st","KanbanArchivedStatusHeaderDirective","KanbanArchivedStatusIntroDirective","KanbanController","KanbanDirective","KanbanSquishColumnDirective","KanbanUserDirective","KanbanUserstoryDirective","KanbanWipLimitDirective","defaultViewMode","viewModes","statusViewModes","onAssignedToChanged","loadUserStoriesForStatus","hideUserStoriesForStatus","changeUsAssignedTo","userid","status__is_archived","listAll","usByStatus","us_archived","loadKanban","generateStatusViewModes","storedStatusViewModes","getStatusViewModes","storeStatusViewModes","updateStatusViewMode","newViewMode","isMaximized","isMinimized","itemsToSave","bulkUpdateKanbanOrder","hideArchivedText","showArchivedText","hidden","tgKanbanArchivedStatusHeader","userStories","hiddenUserStoriexText","updateIntroText","tgKanbanArchivedStatusIntro","isArchived","userStoriesLoaded","editingUserStory","getTemplateUrl","updateTableWidth","folds","redrawWipLimit","tgKanbanWipLimit","wip_limit","wtid","tgKanbanUserAvatar","KanbanSortableDirective","IssueDetailController","IssuePriorityButtonDirective","IssueSeverityButtonDirective","IssueStatusButtonDirective","IssueStatusDisplayDirective","IssueTriggerButtonDirective","IssueTypeButtonDirective","PromoteIssueToUsButtonDirective","issueRef","issueref","initializeOnDeleteGoToUrl","ref3","ref4","issueSubject","issueStatus","statusById","issueType","typeById","issueSeverity","issueTrigger","issuePriority","issueDescription","loadIssue","issue_types","typeList","severityList","triggerList","priorityList","issueId","commentModel","neighbors","previous","previousUrl","onUpvote","upvote","onDownvote","downvote","onWatch","onUnwatch","typees","severityes","triggeres","priorityes","generated_from_issue","CreateBulkIssuesDirective","CreateIssueDirective","default_issue_status","default_issue_type","default_priority","default_severity","default_trigger","IssueAssignedToInlineEditionDirective","IssueStatusInlineEditionDirective","IssueTriggerInlineEditionDirective","IssuesController","IssuesDirective","IssuesFiltersDirective","loadIssues","getFilters","storeFilters","issueStatusList","issueTypes","getUrlFilter","loadMyFilters","getMyFilters","removeNotExistingFiltersFromUrl","currentSearch","existingValues","filterName","filterValue","splittedValues","intersection","myFilters","types","assignedTo","createdBy","usersFiltersFormat","unknownOption","reformatedUsers","unknownItem","full_name","u","owners","loadIssuesRequests","urlFilters","models","paginatedBy","saveCurrentFiltersTo","newFilter","storeMyFilters","deleteMyFilter","addNewIssue","addIssuesInBulk","linkOrdering","linkPagination","$pagEl","afterCurrent","atBegin","atEnd","beforeCurrent","getNumPages","renderPagination","numPages","cpage","pages","showPrevious","showNext","pagenum","colHeadElement","currentOrder","icon","finalOrder","newOrder","reloadIssues","unwatchIssues","filterId","customFilterName","loadPromise","currentfilterstype","updateIssueStatus","issueStatusDom","issueStatusDomParent","tgIssueStatusInlineEdition","updateIssueTrigger","issueTriggerDom","issueTriggerDomParent","tgIssueTriggerInlineEdition","updateIssue","tgIssueAssignedToInlineEdition","updatedIssue","UsClientRequirementButtonDirective","UsStatusButtonDirective","UsStatusDisplayDirective","UsTeamRequirementButtonDirective","UserStoryDetailController","usRef","usref","closedTasks","progressPercentage","userStoryRef","userStorySubject","userStoryStatus","userStoryPoints","userStoryDescription","userStoryClosedTasks","userStoryTotalTasks","userStoryProgressPercentage","allClosed","loadUs","kanbanStaus","noMilestone","order_by","canEdit","isRequired","TaskDetailController","TaskIsIocaineButtonDirective","TaskStatusButtonDirective","TaskStatusDisplayDirective","taskRef","taskref","taskSubject","taskStatus","taskDescription","loadTask","taskId","loadUserStory","LeaveProjectDirective","TeamController","TeamFiltersDirective","TeamMemberCurrentUserDirective","TeamMemberStatsDirective","TeamMembersDirective","membersFilter","setRole","filtersRole","loadMembers","totals","currentUser","issuesEnabled","tasksEnabled","wikiEnabled","loadMemberStats","memberStats","vals","statsKey","sum","_processStats","_processStat","stat","singleStat","leave","confirm_leave_project_text","leave_project_text","projectid","EditableWikiContentDirective","WikiDetailController","WikiSummaryDirective","projectSlug","wikiSlug","wikiTitle","linksVisible","wikiPageName","wikiPageContent","totalEditions","editions","lastModifiedDate","modified_date","loadWiki","wikiId","loadWikiLinks","listLinks","wikiLinks","selectedWikiLink","checkLinksPerms","last_modifier","imgUrl","wikiPage","cancelEdition","disableEdition","getSelectedText","switchToEditMode","switchToReadMode","button","WikiNavDirective","addWikiLinkPermission","deleteWikiLinkPermission","linkId","linkSlug","newLink","CreateMembersDirective","MAX_MEMBERSHIP_FIELDSETS","extraTextTemplate","createFieldSet","resetForm","roleList","fieldSet","prepend","lastActionButton","newFieldSet","invitation_extra_text","memberWrappers","destroy","mw","memberWrapper","role_id","bulkCreateMemberships","MembershipsController","MembershipsDirective","MembershipsRowActionsDirective","MembershipsRowAdminCheckboxDirective","MembershipsRowAvatarDirective","MembershipsRowRoleSelectorDirective","i_am_owner","httpFilters","membership","is_user_active","addNewMembers","pending","user_email","tgMembershipsRowAvatar","inputId","tgMembershipsRowAdminCheckbox","is_owner","selectedRole","tgMembershipsRowRoleSelector","newRole","activedTemplate","pendingTemplate","tgMembershipsRowActions","resendInvitation","defaultMsg","AdminNavigationDirective","tgAdminNavigation","CsvExporterController","CsvExporterIssuesController","CsvExporterTasksController","CsvExporterUserstoriesController","CsvIssueDirective","CsvTaskDirective","CsvUsDirective","ProjectDefaultValuesDirective","ProjectExportDirective","ProjectLogoDirective","ProjectLogoModelDirective","ProjectModulesDirective","ProjectProfileController","ProjectProfileDirective","prioritiesList","severitiesList","triggersList","issueTypesList","openDeleteLightbox","newUrl","fetchProject","loadProjects","isVideoconferenceActivated","videoconferences","videoconferences_extra_data","asyn_message","buttonsEl","dump_ready_text","hideButtons","hideResult","hideSpinner","loading_msg","loading_title","resultEl","resultMessageEl","resultTitleEl","setAsyncMessage","setAsyncTitle","setLoadingMessage","setLoadingTitle","setSyncMessage","setSyncTitle","showButtons","showErrorMode","showExportResultAsyncMode","showExportResultSyncMode","showLoadingMode","showResult","showSpinner","spinnerEl","syn_message","dumpUrl","_generateUuid","setCsvUuid","csvUrl","resolveAbsolute","csvUuid","uuid","regenerateUuid","sectionTitle","showSizeInfo","logoAttachment","changeLogo","removeLogo","$parse","modelSetter","tgProjectLogoModel","ColorSelectionDirective","ProjectCustomAttributesController","ProjectCustomAttributesDirective","ProjectValuesController","ProjectValuesDirective","ProjectValuesSectionController","moveValue","loadValues","resource","listValues","maxValueOrder","itemValue","linkDragAndDrop","linkValue","goToBottomList","initializeNewValue","initializeTextTranslations","objName","saveNewValue","saveValue","valueType","objname","addNewElementText","table","formEl","row","editionRow","option","onSucces","moveTo","moveCustomAttributes","deleteCustomAttribute","saveCustomAttribute","createCustomAttribute","loadCustomAttributes","maxOrder","attrValues","attrModel","newIndex","idx","cancelCreate","cancelUpdate","hideAddButton","hideCancelButton","hideCreateForm","hideEditForm","resetNewAttr","revertChangesInCustomAttribute","showAddButton","showCancelButton","showCreateForm","showEditForm","sortableEl","itemAttr","newAttr","EditRoleDirective","NewRoleDirective","RolePermissionsDirective","RolesController","RolesDirective","_disableComputable","_enableComputable","anyComputableRole","computable","loadRoles","public_permission","external_user","public_permissions","askOnError","askOnSuccess","toggleComputable","toggleView","toggle","DEFAULT_PERMISSIONS","insertPosition","baseTemplate","categoryTemplate","resumeTemplate","generateCategoriesFromRole","renderCategory","renderPermissions","renderResume","categories","isPermissionEditable","issuePermissions","milestonePermissions","setActivePermissions","setActivePermissionsPerCategory","taskPermissions","userStoryPermissions","wikiPermissions","active","is_private","cat","activePermissions","getActivePermissions","categoryId","anon_permissions","BitbucketController","BitbucketWebhooksDirective","GithubController","GithubWebhooksDirective","GitlabController","GitlabWebhooksDirective","NewWebhookDirective","SelectInputText","ValidOriginIpsDirective","WebhookDirective","WebhooksController","loadWebhooks","openHistory","showEditMode","showVisualizationMode","updateLogs","updateShowHideHistoryText","webhook","tgWebhook","validStatus","prettySentHeaders","pairs","request_headers","arg","header","prettySentData","request_data","created","logs_counter","logs","historyElement","textElement","test","resend","addWebhookDOMNode","formDOMNode","loadModules","github","gitlab","bitbucket","saveAttribute","$ngModel","CreateProject","DeleteProjectDirective","$projectUrl","$cacheFactory","removeAll","error_field","error_step","selectors","creation_template","head","step","fields","projectToDelete","BindHtmlDirective","BindOnceAltDirective","BindOnceBindDirective","BindOnceHrefDirective","BindOnceHtmlDirective","BindOnceRefDirective","BindOnceSrcDirective","BindOnceTitleDirective","BindTitleDirective","tgBoBind","tgBoHtml","tgBoRef","tgBoSrc","tgBoHref","tgBoAlt","tgBoTitle","tgTitleHtml","tgBindHtml","ConfigurationService","has","ContribController","currentPlugin","FiltersStorageService","HttpService","cacheFactory","locationFactory","lastRoute","Model","ModelService","dataTypes","_attrs","_name","_dataTypes","setAttrs","_modifiedAttrs","_isModified","applyCasts","attrName","castMethod","castName","casts","getIdAttrName","getName","getter","self","setter","substr","enumerable","configurable","isAttributeModified","markSaved","desSerialize","sdata","ddata","$http","$gmUrls","$gmStorage","cls","int","float","NavigationUrlsDirective","NavigationUrlsService","formatUrl","replacer","bindOnceP","parseNav","param","tgNavGetParams","tgNav","fullUrl","getURLParams","getURLParamsStr","metaKey","ctrlKey","RepositoryService","model1","resolveUrlForModel","idAttrName","resolveUrlForAttributeModel","extraParams","_data","_status","refresh","queryMany","httpOptions","enablePagination","queryOneAttribute","queryOneRaw","queryPaginated","queryOnePaginatedRaw","wikipage","StorageService","_default","serializedValue","getItem","setItem","removeItem","UrlsService","fmt","mainUrl","rtrim","resourceProvider","_get","userstory","_list","filtersHashSuffix","hashSuffix","myFiltersHashSuffix","getQueryParams","listInAllProjects","project_id","bulk_issues","ns","innerPromise","hashSuffixStatusColumnModes","hashSuffixStatusViewModes","listByUser","bulk_memberships","notifyPolicies","listByMember","memberId","bulkUpdateOrder","bulkData","regenerate_userstories_csv_uuid","regenerate_issues_csv_uuid","regenerate_tasks_csv_uuid","statusUpdater","complete","failed","maxFileSize","uploadComplete","uploadFailed","uploadProgress","fileName","fileSize","evt","loaded","uploadedSize","totalSize","responseText","FormData","XMLHttpRequest","setRequestHeader","transformRequest","identity","deferredAbort","get_all","noop","hashSuffixUsRowModes","userStoryId","sprint_id","bulk_tasks","changeAvatar","removeAvatar","changePassword","currentPassword","newPassword","current_password","userSettings","contacts","status_id","bulk_stories","webhookId","webhooklogId","UserChangePasswordController","UserChangePasswordDirective","ctrl","newPassword1","newPassword2","DeleteUserDirective","TaigaAvatarModelDirective","UserAvatarDirective","UserProfileDirective","UserSettingsController","getLan","getTheme","maxFileSizeMsg","availableThemes","avatarAttachment","tgAvatarModel","UserSettingsNavigationDirective","tgUserSettingsNavigation","UserNotificationsController","UserNotificationsDirective","UserNotificationsListDirective","policy","policyIndex","prev_level","notify_level","AttachmentLinkDirective","lightboxFactory","tgAttachmentLink","AttachmentGalleryDirective","bindToController","onDelete","AttachmentController","editMode","mergeIn","AttachmentDirective","AttachmentsDropDirective","eventAttr","tgAttachmentsDrop","AttachmentsFullController","deprecatedsCount","attachmentsVisible","deprecatedsVisible","uploadingAttachments","objId","setMode","toggleDeprecatedsVisible","addAttachments","loadAttachments","toDeleteAttachment","errorMessage","reorderAttachment","updateAttachment","toUpdateAttachment","AttachmentsFullDirective","AttachmentsFullService","_attachments","_deprecatedsCount","_attachmentsVisible","_deprecatedsVisible","regenerate","it","uploading","Map","oldIndex","findIndex","setIn","oldAttachment","AttachmentsSimpleController","onAdd","AttachmentsSimpleDirective","AttachmentSortableDirective","tgAttachmentsSortable","containment","helper","AutoSelectDirective","$timeout","FileChangeDirective","tgFileChange","JoyRideDirective","joyRideService","initJoyrRide","intro","unsuscribe","introJs","oncomplete","onexit","disableJoyRide","setOptions","exitOnEsc","exitOnOverlayClick","showStepNumbers","nextLabel","prevLabel","skipLabel","doneLabel","disableInteraction","setOption","loadJoyRideConfig","exit","JoyRideService","getConfig","dashboard","steps","joyRide","joyRides","LiveAnnouncementDirective","defineProperties","LiveAnnouncementService","ProjectLogoBigSrcDirective","projectLogoService","logo","projectLogo","getDefaultProjectLogo","ProjectLogoSmallSrcDirective","ProjectMenuController","_getActiveSection","_setVideoConference","_setMenuPermissions","videoconferenceUrl","_videoConferenceUrl","indexBacklog","indexKanban","oldSectionName","sectionsBreadcrumb","baseUrl","ProjectMenuDirective","projectChange","vm","fixed","TermsOfServiceAndPrivacyPolicyNoticeDirective","privacyPolicyUrl","termsOfServiceUrl","VoteButtonController","isMouseOver","showTextWhenMouseIsOver","showTextWhenMouseIsLeave","toggleVote","is_voter","_downvote","_upvote","VoteButtonDirective","WatchButtonController","openWatchers","getPerms","toggleWatch","is_watcher","_unwatch","_watch","WatchButtonDirective","attributes","environment","DiscoverHomeOrderByController","is_open","week","month","year","currentText","currentOrderBy","orderBy","onChange","DiscoverHomeOrderByDirective","DiscoverSearchBarController","discoverProjectsService","projectsCount","fetchStats","submitFilter","DiscoverSearchBarDirective","DiscoverSearchListHeaderController","like_is_open","activity_is_open","openLike","setOrderBy","openActivity","DiscoverSearchListHeaderDirective","FeaturedProjectsController","featured","fetchFeatured","FeaturedProjectsDirective","HighlightedDirective","highlighted","MostActiveController","mostActive","getOrderBy","fetch","fetchMostActive","MostActiveDirective","MostLikedController","mostLiked","fetchMostLiked","MostLikedDirective","DiscoverHomeController","onSubmit","DiscoverSearchController","routeParams","searchResult","nextSearchPage","loadingGlobal","loadingList","loadingPagination","resetSearchList","fetchByGlobalSearch","fetchByOrderBy","getFilter","fetchSearch","is_looking_for_people","onChangeFilter","updateParams","onChangeOrder","DiscoverSearchDirective","DiscoverProjectsService","projectsService","_mostLiked","_mostActive","_featured","_searchResult","_projectsCount","decorate","_decorate","_nextSearchPage","_discoverParams","discover_mode","_params","getProjects","is_featured","ExternalAppController","externalAppsService","xhrError","loginUrl","createApplicationToken","_getApplicationToken","_redirect","_applicationId","application","_state","state","_user","_application","loginWithAnotherUserUrl","applicationToken","getApplicationToken","back","authorizeApplicationToken","ExternalAppsService","applicationId","externalapps","FeedbackService","sendFeedback","DutyDirective","navurls","duty","getDutyType","HomeController","HomeService","_attachProjectInfoToWorkInProgress","workInProgress","projectsById","_attachProjectInfoToDuty","_duties","watching","objType","getWorkInProgress","assignedIssuesPromise","assignedTasksPromise","assignedUserStoriesPromise","params_us","projectsPromise","watchingIssuesPromise","watchingTasksPromise","watchingUserStoriesPromise","getProjectsByUserId","p","status__is_closed","HomeProjectListDirective","newProject","WorkingOnController","homeService","_setAssignedTo","elem","_setWatching","WorkingOnDirective","DropdownProjectListDirective","DropdownUserDirective","authService","configService","locationService","navUrlsService","isFeedbackEnabled","NavigationBarDirective","isEnabledHeader","NavigationBarService","enabledHeader","ProfileBarController","userService","loadStats","getStats","ProfileBarDirective","isCurrentUser","ProfileContactsController","loadContacts","getContacts","ProfileContactsDirective","FavItemDirective","itemType","FavsBaseController","ProfileLikedController","ProfileVotedController","ProfileWatchedController","_init","enableFilterByAll","enableFilterByProjects","enableFilterByUserStories","enableFilterByTasks","enableFilterByIssues","enableFilterByTextQuery","_resetList","scrollDisabled","_page","_enableLoadingSpinner","isLoading","_disableLoadingSpinner","_enableScroll","_disableScroll","_checkIfHasMorePages","hasNext","_checkIfHasNoResults","hasNoResults","loadItems","_getItems","filterByTextQuery","showAll","showProjectsOnly","showUserStoriesOnly","showTasksOnly","showIssuesOnly","getLiked","getVoted","getWatched","ProfileLikedDirective","ProfileVotedDirective","ProfileWatchedDirective","ProfileHints","hintKey","HINTS","hint","linkText","ProfileProjectsController","attachUserContactsToProjects","ProfileProjectsDirective","ProfileTabDirective","transclude","tab","tabIcon","tabActive","tabDisabled","addTab","ProfileTabsController","tabs","toggleTab","ProfileTabsDirective","ProfileController","getUserByUserName","notFound","userUsername","LikeProjectButtonController","likeButtonService","toggleLike","_unlike","_like","like","unlike","LikeProjectButtonDirective","LikeProjectButtonService","_getProjectIndex","_updateProjects","isFan","projectIndex","totalFans","is_fan","total_fans","setProjects","_updateCurrentProject","setProject","likeProject","unlikeProject","SortProjectsDirective","opacity","sortData","sorted_project_ids","bulkUpdateProjectsOrder","WatchProjectButtonController","watchButtonService","showWatchOptions","toggleWatcherOptions","closeWatcherOptions","notifyLevel","WatchProjectButtonDirective","WatchProjectButtonService","isWatcher","totalWatchers","total_watchers","watchProject","unwatchProject","ProjectsListingController","ProjectController","activeMembers","setfn","metas","ProjectsService","projectUrl","getProjectBySlug","getProjectStats","paginate","colorized_tags","Resource","urlsService","urlname","object_id","x-disable-pagination","progressMessage","progressPercent","pagination","paginateResponseService","x-lazy-pagination","getTimeline","only_relevant","Resources","services","serviceFn","serviceName","serviceProperty","warm","getUserStorage","setUserStorage","createUserStorage","getUserByUsername","getProfileTimeline","getUserTimeline","AppMetaService","_set","meta","setTitle","setDescription","setTwitterMetas","origin","setOpenGraphMetas","listener","_listener","$watchCollection","AttachmentsService","getMaxFileSize","maxFileSizeFormated","sizeError","saveError","ChekcPermissionsService","CurrentUserService","storageService","_projects","_projectsById","_joyride","_loadUserInfo","LightboxFactory","compile","scopeAttrs","PaginateResponse","paginateResponse","ProjectLogoService","modulo","COLORS","IMAGES","logos","murmurhash3_32_gc","ProjectService","_project","_section","_sectionsBreadcrumb","_activeMembers","hasPermission","ScopeEvent","scopes","_searchDuplicatedScopes","$id","_create","duplicatedScopeName","_tgEmitter","EventEmitter2","removeAllListeners","emitter","ThemeService","themeName","stylesheetEl","UserService","pageNumber","objectType","textQuery","contactsFiltered","contact","contactId","permissionDenied","UserTimelineAttachmentDirective","validFileExtensions","extension","is_image","templateHtml","UserTimelineItemTitle","sce","_fieldTranslationKey","timeline","title_attr","_getLink","_getUsernameSpan","field_name","new_value","sprint_name","us_name","event_us","_getTimelineObj","_getDetailObjUrl","obj_name","role_name","keySeq","_translateTitleParams","parent_userstory","_getParams","timeline_type","translate_params","getTitle","paramsKeys","translation","UserTimelineType","timelineType","hasIn","getType","UserTimelineItemDirective","UserTimelinePaginationSequence","generate","getContent","minItems","UserTimelineController","userTimelineService","timelineList","getProjectTimeline","loadTimeline","UserTimelineDirective","UserTimelineService","userTimelinePaginationSequenceService","userTimelineItemType","userTimelineItemTitle","_valid_fields","_invalid","fieldKey","value_diff","_isInValidTimeline","invalid","_parseEventType","event_type","_getTimelineObject","_attachExtraInfoToTimelineEntry","_parseTimeline","newdata","newItem","blocked","moveInBacklog","deleteIn","_addEntyAttributes","filterNot"],"mappings":"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","file":"app.js","sourceRoot":"/source/","sourcesContent":["\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app.coffee\n */\n\n(function() {\n  var configure, i18nInit, init, module, modules, pluginsWithModule, taiga;\n\n  this.taiga = taiga = {};\n\n  this.taigaContribPlugins = this.taigaContribPlugins || window.taigaContribPlugins || [];\n\n  taiga.generateHash = function(components) {\n    if (components == null) {\n      components = [];\n    }\n    components = _.map(components, function(x) {\n      return JSON.stringify(x);\n    });\n    return hex_sha1(components.join(\":\"));\n  };\n\n  taiga.generateUniqueSessionIdentifier = function() {\n    var date, randomNumber;\n    date = (new Date()).getTime();\n    randomNumber = Math.floor(Math.random() * 0x9000000);\n    return taiga.generateHash([date, randomNumber]);\n  };\n\n  taiga.sessionId = taiga.generateUniqueSessionIdentifier();\n\n  configure = function($routeProvider, $locationProvider, $httpProvider, $provide, $tgEventsProvider, $compileProvider, $translateProvider, $translatePartialLoaderProvider, $animateProvider) {\n    var authHttpIntercept, decorators, defaultHeaders, loaderIntercept, originalWhen, preferedLangCode, userInfo, versionCheckHttpIntercept;\n    $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);\n    originalWhen = $routeProvider.when;\n    $routeProvider.when = function(path, route) {\n      route.resolve || (route.resolve = {});\n      angular.extend(route.resolve, {\n        languageLoad: [\n          \"$q\", \"$translate\", function($q, $translate) {\n            var deferred;\n            deferred = $q.defer();\n            $translate().then(function() {\n              return deferred.resolve();\n            });\n            return deferred.promise;\n          }\n        ]\n      });\n      return originalWhen.call($routeProvider, path, route);\n    };\n    $routeProvider.when(\"/\", {\n      templateUrl: \"home/home.html\",\n      controller: \"Home\",\n      controllerAs: \"vm\",\n      loader: true,\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/discover\", {\n      templateUrl: \"discover/discover-home/discover-home.html\",\n      controller: \"DiscoverHome\",\n      controllerAs: \"vm\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true\n    });\n    $routeProvider.when(\"/discover/search\", {\n      templateUrl: \"discover/discover-search/discover-search.html\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true,\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      reloadOnSearch: false\n    });\n    $routeProvider.when(\"/projects/\", {\n      templateUrl: \"projects/listing/projects-listing.html\",\n      access: {\n        requiresLogin: true\n      },\n      title: \"PROJECTS.PAGE_TITLE\",\n      description: \"PROJECTS.PAGE_DESCRIPTION\",\n      loader: true,\n      controller: \"ProjectsListing\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/\", {\n      templateUrl: \"projects/project/project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\",\n      section: \"project-timeline\"\n    });\n    $routeProvider.when(\"/project/:pslug/search\", {\n      templateUrl: \"search/search.html\",\n      reloadOnSearch: false,\n      section: \"search\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/backlog\", {\n      templateUrl: \"backlog/backlog.html\",\n      loader: true,\n      section: \"backlog\",\n      joyride: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/kanban\", {\n      templateUrl: \"kanban/kanban.html\",\n      loader: true,\n      section: \"kanban\",\n      joyride: \"kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/taskboard/:sslug\", {\n      templateUrl: \"taskboard/taskboard.html\",\n      loader: true,\n      section: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/us/:usref\", {\n      templateUrl: \"us/us-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/task/:taskref\", {\n      templateUrl: \"task/task-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki\", {\n      redirectTo: function(params) {\n        return \"/project/\" + params.pslug + \"/wiki/home\";\n      }\n    });\n    $routeProvider.when(\"/project/:pslug/wiki/:slug\", {\n      templateUrl: \"wiki/wiki.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/team\", {\n      templateUrl: \"team/team.html\",\n      loader: true,\n      section: \"team\"\n    });\n    $routeProvider.when(\"/project/:pslug/issues\", {\n      templateUrl: \"issue/issues.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/issue/:issueref\", {\n      templateUrl: \"issue/issues-detail.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/details\", {\n      templateUrl: \"admin/admin-project-profile.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/default-values\", {\n      templateUrl: \"admin/admin-project-default-values.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/modules\", {\n      templateUrl: \"admin/admin-project-modules.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/export\", {\n      templateUrl: \"admin/admin-project-export.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/reports\", {\n      templateUrl: \"admin/admin-project-reports.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/status\", {\n      templateUrl: \"admin/admin-project-values-status.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/points\", {\n      templateUrl: \"admin/admin-project-values-points.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/priorities\", {\n      templateUrl: \"admin/admin-project-values-priorities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/severities\", {\n      templateUrl: \"admin/admin-project-values-severities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/triggers\", {\n      templateUrl: \"admin/admin-project-values-triggers.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/types\", {\n      templateUrl: \"admin/admin-project-values-types.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/custom-fields\", {\n      templateUrl: \"admin/admin-project-values-custom-fields.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/memberships\", {\n      templateUrl: \"admin/admin-memberships.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/roles\", {\n      templateUrl: \"admin/admin-roles.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/webhooks\", {\n      templateUrl: \"admin/admin-third-parties-webhooks.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/github\", {\n      templateUrl: \"admin/admin-third-parties-github.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gitlab\", {\n      templateUrl: \"admin/admin-third-parties-gitlab.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/bitbucket\", {\n      templateUrl: \"admin/admin-third-parties-bitbucket.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/contrib/:plugin\", {\n      templateUrl: \"contrib/main.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-profile\", {\n      templateUrl: \"user/user-profile.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-change-password\", {\n      templateUrl: \"user/user-change-password.html\"\n    });\n    $routeProvider.when(\"/user-settings/mail-notifications\", {\n      templateUrl: \"user/mail-notifications.html\"\n    });\n    $routeProvider.when(\"/change-email/:email_token\", {\n      templateUrl: \"user/change-email.html\"\n    });\n    $routeProvider.when(\"/cancel-account/:cancel_token\", {\n      templateUrl: \"user/cancel-account.html\"\n    });\n    $routeProvider.when(\"/profile\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      access: {\n        requiresLogin: true\n      },\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/profile/:slug\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/login\", {\n      templateUrl: \"auth/login.html\",\n      title: \"LOGIN.PAGE_TITLE\",\n      description: \"LOGIN.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/register\", {\n      templateUrl: \"auth/register.html\",\n      title: \"REGISTER.PAGE_TITLE\",\n      description: \"REGISTER.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/forgot-password\", {\n      templateUrl: \"auth/forgot-password.html\",\n      title: \"FORGOT_PASSWORD.PAGE_TITLE\",\n      description: \"FORGOT_PASSWORD.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/change-password/:token\", {\n      templateUrl: \"auth/change-password-from-recovery.html\",\n      title: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      description: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/invitation/:token\", {\n      templateUrl: \"auth/invitation.html\",\n      title: \"INVITATION.PAGE_TITLE\",\n      description: \"INVITATION.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/external-apps\", {\n      templateUrl: \"external-apps/external-app.html\",\n      title: \"EXTERNAL_APP.PAGE_TITLE\",\n      description: \"EXTERNAL_APP.PAGE_DESCRIPTION\",\n      controller: \"ExternalApp\",\n      controllerAs: \"vm\",\n      disableHeader: true,\n      mobileViewport: true\n    });\n    $routeProvider.when(\"/error\", {\n      templateUrl: \"error/error.html\"\n    });\n    $routeProvider.when(\"/not-found\", {\n      templateUrl: \"error/not-found.html\"\n    });\n    $routeProvider.when(\"/permission-denied\", {\n      templateUrl: \"error/permission-denied.html\"\n    });\n    $routeProvider.otherwise({\n      redirectTo: \"/not-found\"\n    });\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n    defaultHeaders = {\n      \"Content-Type\": \"application/json\",\n      \"Accept-Language\": window.taigaConfig.defaultLanguage || \"en\",\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.defaults.headers[\"delete\"] = defaultHeaders;\n    $httpProvider.defaults.headers.patch = defaultHeaders;\n    $httpProvider.defaults.headers.post = defaultHeaders;\n    $httpProvider.defaults.headers.put = defaultHeaders;\n    $httpProvider.defaults.headers.get = {\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.useApplyAsync(true);\n    $tgEventsProvider.setSessionId(taiga.sessionId);\n    authHttpIntercept = function($q, $location, $navUrls, $lightboxService) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var nextUrl;\n        if (response.status === 0 || (response.status === -1 && !response.config.cancelable)) {\n          $lightboxService.closeAll();\n          $location.path($navUrls.resolve(\"error\"));\n          $location.replace();\n        } else if (response.status === 401 && $location.url().indexOf('/login') === -1) {\n          nextUrl = encodeURIComponent($location.url());\n          $location.url($navUrls.resolve(\"login\")).search(\"next=\" + nextUrl);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"authHttpIntercept\", [\"$q\", \"$location\", \"$tgNavUrls\", \"lightboxService\", authHttpIntercept]);\n    $httpProvider.interceptors.push(\"authHttpIntercept\");\n    loaderIntercept = function($q, loaderService) {\n      return {\n        request: function(config) {\n          loaderService.logRequest();\n          return config;\n        },\n        requestError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        responseError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        response: function(response) {\n          loaderService.logResponse();\n          return response;\n        }\n      };\n    };\n    $provide.factory(\"loaderIntercept\", [\"$q\", \"tgLoader\", loaderIntercept]);\n    $httpProvider.interceptors.push(\"loaderIntercept\");\n    versionCheckHttpIntercept = function($q) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var $injector;\n        if (response.status === 400 && response.data.version) {\n          $injector = angular.element(\"body\").injector();\n          $injector.invoke([\n            \"$tgConfirm\", \"$translate\", (function(_this) {\n              return function($confirm, $translate) {\n                var versionErrorMsg;\n                versionErrorMsg = $translate.instant(\"ERROR.VERSION_ERROR\");\n                return $confirm.notify(\"error\", versionErrorMsg, null, 10000);\n              };\n            })(this)\n          ]);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"versionCheckHttpIntercept\", [\"$q\", versionCheckHttpIntercept]);\n    $httpProvider.interceptors.push(\"versionCheckHttpIntercept\");\n    window.checksley.updateValidators({\n      linewidth: function(val, width) {\n        var lines, valid;\n        lines = taiga.nl2br(val).split(\"<br />\");\n        valid = _.every(lines, function(line) {\n          return line.length < width;\n        });\n        return valid;\n      }\n    });\n    $compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo || false);\n    if (localStorage.userInfo) {\n      userInfo = JSON.parse(localStorage.userInfo);\n    }\n    preferedLangCode = (userInfo != null ? userInfo.lang : void 0) || window.taigaConfig.defaultLanguage || \"en\";\n    $translatePartialLoaderProvider.addPart('taiga');\n    $translateProvider.useLoader('$translatePartialLoader', {\n      urlTemplate: '/' + window._version + '/locales/{part}/locale-{lang}.json'\n    }).useSanitizeValueStrategy('escapeParameters').addInterpolation('$translateMessageFormatInterpolation').preferredLanguage(preferedLangCode);\n    $translateProvider.fallbackLanguage(preferedLangCode);\n    decorators = window.getDecorators();\n    return _.each(decorators, function(decorator) {\n      return $provide.decorator(decorator.provider, decorator.decorator);\n    });\n  };\n\n  i18nInit = function(lang, $translate) {\n    var messages;\n    moment.locale(lang);\n    messages = {\n      defaultMessage: $translate.instant(\"COMMON.FORM_ERRORS.DEFAULT_MESSAGE\"),\n      type: {\n        email: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_EMAIL\"),\n        url: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URL\"),\n        urlstrict: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URLSTRICT\"),\n        number: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_NUMBER\"),\n        digits: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DIGITS\"),\n        dateIso: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DATEISO\"),\n        alphanum: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_ALPHANUM\"),\n        phone: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_PHONE\")\n      },\n      notnull: $translate.instant(\"COMMON.FORM_ERRORS.NOTNULL\"),\n      notblank: $translate.instant(\"COMMON.FORM_ERRORS.NOT_BLANK\"),\n      required: $translate.instant(\"COMMON.FORM_ERRORS.REQUIRED\"),\n      regexp: $translate.instant(\"COMMON.FORM_ERRORS.REGEXP\"),\n      min: $translate.instant(\"COMMON.FORM_ERRORS.MIN\"),\n      max: $translate.instant(\"COMMON.FORM_ERRORS.MAX\"),\n      range: $translate.instant(\"COMMON.FORM_ERRORS.RANGE\"),\n      minlength: $translate.instant(\"COMMON.FORM_ERRORS.MIN_LENGTH\"),\n      maxlength: $translate.instant(\"COMMON.FORM_ERRORS.MAX_LENGTH\"),\n      rangelength: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_LENGTH\"),\n      mincheck: $translate.instant(\"COMMON.FORM_ERRORS.MIN_CHECK\"),\n      maxcheck: $translate.instant(\"COMMON.FORM_ERRORS.MAX_CHECK\"),\n      rangecheck: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_CHECK\"),\n      equalto: $translate.instant(\"COMMON.FORM_ERRORS.EQUAL_TO\")\n    };\n    return checksley.updateMessages('default', messages);\n  };\n\n  init = function($log, $rootscope, $auth, $events, $analytics, $translate, $location, $navUrls, appMetaService, projectService, loaderService, navigationBarService) {\n    var un, user;\n    $log.debug(\"Initialize application\");\n    $rootscope.contribPlugins = this.taigaContribPlugins;\n    $rootscope.adminPlugins = _.where(this.taigaContribPlugins, {\n      \"type\": \"admin\"\n    });\n    $rootscope.$on(\"$translateChangeEnd\", function(e, ctx) {\n      var lang;\n      lang = ctx.language;\n      return i18nInit(lang, $translate);\n    });\n    Promise.setScheduler(function(cb) {\n      return $rootscope.$evalAsync(cb);\n    });\n    $events.setupConnection();\n    if ($auth.isAuthenticated()) {\n      user = $auth.getUser();\n    }\n    $analytics.initialize();\n    un = $rootscope.$on('$routeChangeStart', function(event, next) {\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      return un();\n    });\n    return $rootscope.$on('$routeChangeSuccess', function(event, next) {\n      var description, title;\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      if (next.access && next.access.requiresLogin) {\n        if (!$auth.isAuthenticated()) {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n      }\n      projectService.setSection(next.section);\n      if (next.params.pslug) {\n        projectService.setProjectBySlug(next.params.pslug);\n      } else {\n        projectService.cleanProject();\n      }\n      if (next.title || next.description) {\n        title = $translate.instant(next.title || \"\");\n        description = $translate.instant(next.description || \"\");\n        appMetaService.setAll(title, description);\n      }\n      if (next.mobileViewport) {\n        appMetaService.addMobileViewport();\n      } else {\n        appMetaService.removeMobileViewport();\n      }\n      if (next.disableHeader) {\n        return navigationBarService.disableHeader();\n      } else {\n        return navigationBarService.enableHeader();\n      }\n    });\n  };\n\n  pluginsWithModule = _.filter(this.taigaContribPlugins, function(plugin) {\n    return plugin.module;\n  });\n\n  angular.module('infinite-scroll').value('THROTTLE_MILLISECONDS', 500);\n\n  modules = [\"taigaBase\", \"taigaCommon\", \"taigaResources\", \"taigaResources2\", \"taigaAuth\", \"taigaEvents\", \"taigaHome\", \"taigaNavigationBar\", \"taigaProjects\", \"taigaRelatedTasks\", \"taigaBacklog\", \"taigaTaskboard\", \"taigaKanban\", \"taigaIssues\", \"taigaUserStories\", \"taigaTasks\", \"taigaTeam\", \"taigaWiki\", \"taigaSearch\", \"taigaAdmin\", \"taigaProject\", \"taigaUserSettings\", \"taigaFeedback\", \"taigaPlugins\", \"taigaIntegrations\", \"taigaComponents\", \"taigaProfile\", \"taigaHome\", \"taigaUserTimeline\", \"taigaExternalApps\", \"taigaDiscover\", \"templates\", \"ngSanitize\", \"ngRoute\", \"ngAnimate\", \"ngAria\", \"pascalprecht.translate\", \"infinite-scroll\", \"tgRepeat\"].concat(_.map(pluginsWithModule, function(plugin) {\n    return plugin.module;\n  }));\n\n  module = angular.module(\"taiga\", modules);\n\n  module.config([\"$routeProvider\", \"$locationProvider\", \"$httpProvider\", \"$provide\", \"$tgEventsProvider\", \"$compileProvider\", \"$translateProvider\", \"$translatePartialLoaderProvider\", \"$animateProvider\", configure]);\n\n  module.run([\"$log\", \"$rootScope\", \"$tgAuth\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"tgProjectService\", \"tgLoader\", \"tgNavigationBarService\", \"$route\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: classes.coffee\n */\n\n(function() {\n  var TaigaBase, TaigaController, TaigaService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  TaigaBase = (function() {\n    function TaigaBase() {}\n\n    return TaigaBase;\n\n  })();\n\n  TaigaService = (function(superClass) {\n    extend(TaigaService, superClass);\n\n    function TaigaService() {\n      return TaigaService.__super__.constructor.apply(this, arguments);\n    }\n\n    return TaigaService;\n\n  })(TaigaBase);\n\n  TaigaController = (function(superClass) {\n    extend(TaigaController, superClass);\n\n    function TaigaController() {\n      this.onInitialDataError = bind(this.onInitialDataError, this);\n      return TaigaController.__super__.constructor.apply(this, arguments);\n    }\n\n    TaigaController.prototype.onInitialDataError = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.location.path(this.navUrls.resolve(\"not-found\"));\n          this.location.replace();\n        } else if (xhr.status === 403) {\n          this.location.path(this.navUrls.resolve(\"permission-denied\"));\n          this.location.replace();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return TaigaController;\n\n  })(TaigaBase);\n\n  this.taiga.Base = TaigaBase;\n\n  this.taiga.Service = TaigaService;\n\n  this.taiga.Controller = TaigaController;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.coffee\n */\n\n(function() {\n  var bindMethods, bindOnce, cancelTimeout, debounce, debounceLeading, defineImmutableProperty, groupBy, isImage, joinStr, mixOf, nl2br, patch, replaceTags, scopeDefer, sizeFormat, slugify, startswith, stripTags, taiga, timeout, toString, toggleText, trim, truncate, unslugify,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  nl2br = (function(_this) {\n    return function(str) {\n      var breakTag;\n      breakTag = '<br />';\n      return (str + '').replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + breakTag + '$2');\n    };\n  })(this);\n\n  bindMethods = (function(_this) {\n    return function(object) {\n      var dependencies, methods;\n      dependencies = _.keys(object);\n      methods = [];\n      _.forIn(object, function(value, key) {\n        if (indexOf.call(dependencies, key) < 0) {\n          return methods.push(key);\n        }\n      });\n      return _.bindAll(object, methods);\n    };\n  })(this);\n\n  bindOnce = (function(_this) {\n    return function(scope, attr, continuation) {\n      var delBind, val;\n      val = scope.$eval(attr);\n      if (val !== void 0) {\n        return continuation(val);\n      }\n      delBind = null;\n      return delBind = scope.$watch(attr, function(val) {\n        if (val === void 0) {\n          return;\n        }\n        continuation(val);\n        if (delBind) {\n          return delBind();\n        }\n      });\n    };\n  })(this);\n\n  mixOf = function() {\n    var Mixed, base, i, method, mixin, mixins, name, ref;\n    base = arguments[0], mixins = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    Mixed = (function(superClass) {\n      extend(Mixed, superClass);\n\n      function Mixed() {\n        return Mixed.__super__.constructor.apply(this, arguments);\n      }\n\n      return Mixed;\n\n    })(base);\n    for (i = mixins.length - 1; i >= 0; i += -1) {\n      mixin = mixins[i];\n      ref = mixin.prototype;\n      for (name in ref) {\n        method = ref[name];\n        Mixed.prototype[name] = method;\n      }\n    }\n    return Mixed;\n  };\n\n  trim = function(data, char) {\n    return _.str.trim(data, char);\n  };\n\n  slugify = function(data) {\n    return _.str.slugify(data);\n  };\n\n  unslugify = function(data) {\n    if (data) {\n      return _.str.capitalize(data.replace(/-/g, ' '));\n    }\n    return data;\n  };\n\n  toggleText = function(element, texts) {\n    var nextTextPosition, text;\n    nextTextPosition = element.data('nextTextPosition');\n    if ((nextTextPosition == null) || nextTextPosition >= texts.length) {\n      nextTextPosition = 0;\n    }\n    text = texts[nextTextPosition];\n    element.data('nextTextPosition', nextTextPosition + 1);\n    return element.text(text);\n  };\n\n  groupBy = function(coll, pred) {\n    var i, item, len, result;\n    result = {};\n    for (i = 0, len = coll.length; i < len; i++) {\n      item = coll[i];\n      result[pred(item)] = item;\n    }\n    return result;\n  };\n\n  timeout = function(wait, continuation) {\n    return window.setTimeout(continuation, wait);\n  };\n\n  cancelTimeout = function(timeoutVar) {\n    return window.clearTimeout(timeoutVar);\n  };\n\n  scopeDefer = function(scope, func) {\n    return _.defer((function(_this) {\n      return function() {\n        return scope.$apply(func);\n      };\n    })(this));\n  };\n\n  toString = function(value) {\n    if (_.isNumber(value)) {\n      return value + \"\";\n    } else if (_.isString(value)) {\n      return value;\n    } else if (_.isPlainObject(value)) {\n      return JSON.stringify(value);\n    } else if (_.isUndefined(value)) {\n      return \"\";\n    }\n    return value.toString();\n  };\n\n  joinStr = function(str, coll) {\n    return _.str.join(str, coll);\n  };\n\n  debounce = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: true,\n      trailing: false\n    });\n  };\n\n  debounceLeading = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: false,\n      trailing: true\n    });\n  };\n\n  startswith = function(str1, str2) {\n    return _.str.startsWith(str1, str2);\n  };\n\n  truncate = function(str, maxLength, suffix) {\n    var out;\n    if (suffix == null) {\n      suffix = \"...\";\n    }\n    if ((typeof str !== \"string\") && !(str instanceof String)) {\n      return str;\n    }\n    out = str.slice(0);\n    if (out.length > maxLength) {\n      out = out.substring(0, maxLength + 1);\n      out = out.substring(0, Math.min(out.length, out.lastIndexOf(\" \")));\n      out = out + suffix;\n    }\n    return out;\n  };\n\n  sizeFormat = function(input, precision) {\n    var number, size, units;\n    if (precision == null) {\n      precision = 1;\n    }\n    if (isNaN(parseFloat(input)) || !isFinite(input)) {\n      return \"-\";\n    }\n    if (input === 0) {\n      return \"0 bytes\";\n    }\n    units = [\"bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n    number = Math.floor(Math.log(input) / Math.log(1024));\n    if (number > 5) {\n      number = 5;\n    }\n    size = (input / Math.pow(1024, number)).toFixed(precision);\n    return size + \" \" + units[number];\n  };\n\n  stripTags = function(str, exception) {\n    var pattern;\n    if (exception) {\n      pattern = new RegExp('<(?!' + exception + '\\s*\\/?)[^>]+>', 'gi');\n      return String(str).replace(pattern, '');\n    } else {\n      return String(str).replace(/<\\/?[^>]+>/g, '');\n    }\n  };\n\n  replaceTags = function(str, tags, replace) {\n    var pattern;\n    pattern = new RegExp('<(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '<' + replace + '>');\n    pattern = new RegExp('<\\/(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '</' + replace + '>');\n    return str;\n  };\n\n  defineImmutableProperty = (function(_this) {\n    return function(obj, name, fn) {\n      return Object.defineProperty(obj, name, {\n        get: function() {\n          var fn_result;\n          if (!_.isFunction(fn)) {\n            throw \"defineImmutableProperty third param must be a function\";\n          }\n          fn_result = fn();\n          if (fn_result && _.isObject(fn_result)) {\n            if (fn_result.size === void 0) {\n              throw \"defineImmutableProperty must return immutable data\";\n            }\n          }\n          return fn_result;\n        }\n      });\n    };\n  })(this);\n\n  _.mixin({\n    removeKeys: function(obj, keys) {\n      return _.chain([keys]).flatten().reduce(function(obj, key) {\n        delete obj[key];\n        return obj;\n      }, obj).value();\n    },\n    cartesianProduct: function() {\n      return _.reduceRight(arguments, function(a, b) {\n        return _.flatten(_.map(a, function(x) {\n          return _.map(b, function(y) {\n            return [y].concat(x);\n          });\n        }), true);\n      }, [[]]);\n    }\n  });\n\n  isImage = function(name) {\n    return name.match(/\\.(jpe?g|png|gif|gifv|webm)/i) !== null;\n  };\n\n  patch = function(oldImmutable, newImmutable) {\n    var pathObj;\n    pathObj = {};\n    newImmutable.forEach(function(newValue, key) {\n      if (newValue !== oldImmutable.get(key)) {\n        if (newValue.toJS) {\n          return pathObj[key] = newValue.toJS();\n        } else {\n          return pathObj[key] = newValue;\n        }\n      }\n    });\n    return pathObj;\n  };\n\n  taiga = this.taiga;\n\n  taiga.nl2br = nl2br;\n\n  taiga.bindMethods = bindMethods;\n\n  taiga.bindOnce = bindOnce;\n\n  taiga.mixOf = mixOf;\n\n  taiga.trim = trim;\n\n  taiga.slugify = slugify;\n\n  taiga.unslugify = unslugify;\n\n  taiga.toggleText = toggleText;\n\n  taiga.groupBy = groupBy;\n\n  taiga.timeout = timeout;\n\n  taiga.cancelTimeout = cancelTimeout;\n\n  taiga.scopeDefer = scopeDefer;\n\n  taiga.toString = toString;\n\n  taiga.joinStr = joinStr;\n\n  taiga.truncate = truncate;\n\n  taiga.debounce = debounce;\n\n  taiga.debounceLeading = debounceLeading;\n\n  taiga.startswith = startswith;\n\n  taiga.sizeFormat = sizeFormat;\n\n  taiga.stripTags = stripTags;\n\n  taiga.replaceTags = replaceTags;\n\n  taiga.defineImmutableProperty = defineImmutableProperty;\n\n  taiga.isImage = isImage;\n\n  taiga.patch = patch;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/controllerMixins.coffee\n */\n\n(function() {\n  var FiltersMixin, PageMixin, groupBy, joinStr, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  joinStr = this.taiga.joinStr;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  PageMixin = (function() {\n    function PageMixin() {}\n\n    PageMixin.prototype.fillUsersAndRoles = function(users, roles) {\n      var activeUsers, computableRoles;\n      activeUsers = _.filter(users, (function(_this) {\n        return function(user) {\n          return user.is_active;\n        };\n      })(this));\n      this.scope.activeUsers = _.sortBy(activeUsers, \"full_name_display\");\n      this.scope.activeUsersById = groupBy(this.scope.activeUsers, function(e) {\n        return e.id;\n      });\n      this.scope.users = _.sortBy(users, \"full_name_display\");\n      this.scope.usersById = groupBy(this.scope.users, function(e) {\n        return e.id;\n      });\n      this.scope.roles = _.sortBy(roles, \"order\");\n      computableRoles = _(this.scope.project.members).map(\"role\").uniq().value();\n      return this.scope.computableRoles = _(roles).filter(\"computable\").filter(function(x) {\n        return _.contains(computableRoles, x.id);\n      }).value();\n    };\n\n    PageMixin.prototype.loadUsersAndRoles = function() {\n      var promise;\n      promise = this.q.all([this.rs.projects.usersList(this.scope.projectId), this.rs.projects.rolesList(this.scope.projectId)]);\n      return promise.then((function(_this) {\n        return function(results) {\n          var roles, users;\n          users = results[0], roles = results[1];\n          _this.fillUsersAndRoles(users, roles);\n          return results;\n        };\n      })(this));\n    };\n\n    return PageMixin;\n\n  })();\n\n  taiga.PageMixin = PageMixin;\n\n  FiltersMixin = (function() {\n    function FiltersMixin() {}\n\n    FiltersMixin.prototype.selectFilter = function(name, value, load) {\n      var existing, location, params;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] !== void 0 && name !== \"page\") {\n        existing = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n          return trim(x);\n        });\n        existing.push(taiga.toString(value));\n        existing = _.compact(existing);\n        value = joinStr(\",\", _.uniq(existing));\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceFilter = function(name, value, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceAllFilters = function(filters, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(filters);\n    };\n\n    FiltersMixin.prototype.unselectFilter = function(name, value, load) {\n      var location, newValues, params, parsedValues;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] === void 0) {\n        return;\n      }\n      if (value === void 0 || value === null) {\n        delete params[name];\n      }\n      parsedValues = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n        return trim(x);\n      });\n      newValues = _.reject(parsedValues, function(x) {\n        return x === taiga.toString(value);\n      });\n      newValues = _.compact(newValues);\n      if (_.isEmpty(newValues)) {\n        value = null;\n      } else {\n        value = joinStr(\",\", _.uniq(newValues));\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(name, value);\n    };\n\n    return FiltersMixin;\n\n  })();\n\n  taiga.FiltersMixin = FiltersMixin;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaAdmin\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/auth.coffee\n */\n\n(function() {\n  var AuthService, CancelAccountDirective, ChangeEmailDirective, ChangePasswordFromRecoveryDirective, ForgotPasswordDirective, InvitationDirective, LoginDirective, PublicRegisterMessageDirective, RegisterDirective, debounce, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAuth\", [\"taigaResources\"]);\n\n  AuthService = (function(superClass) {\n    extend(AuthService, superClass);\n\n    AuthService.$inject = [\"$rootScope\", \"$tgStorage\", \"$tgModel\", \"$tgResources\", \"$tgHttp\", \"$tgUrls\", \"$tgConfig\", \"$translate\", \"tgCurrentUserService\", \"tgThemeService\"];\n\n    function AuthService(rootscope, storage, model, rs, http, urls, config, translate, currentUserService, themeService) {\n      var userModel;\n      this.rootscope = rootscope;\n      this.storage = storage;\n      this.model = model;\n      this.rs = rs;\n      this.http = http;\n      this.urls = urls;\n      this.config = config;\n      this.translate = translate;\n      this.currentUserService = currentUserService;\n      this.themeService = themeService;\n      AuthService.__super__.constructor.call(this);\n      userModel = this.getUser();\n      this._currentTheme = this._getUserTheme();\n      this.setUserdata(userModel);\n    }\n\n    AuthService.prototype.setUserdata = function(userModel) {\n      if (userModel) {\n        this.userData = Immutable.fromJS(userModel.getAttrs());\n        return this.currentUserService.setUser(this.userData);\n      } else {\n        return this.userData = null;\n      }\n    };\n\n    AuthService.prototype._getUserTheme = function() {\n      var ref;\n      return ((ref = this.rootscope.user) != null ? ref.theme : void 0) || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    AuthService.prototype._setTheme = function() {\n      var newTheme;\n      newTheme = this._getUserTheme();\n      if (this._currentTheme !== newTheme) {\n        this._currentTheme = newTheme;\n        return this.themeService.use(this._currentTheme);\n      }\n    };\n\n    AuthService.prototype._setLocales = function() {\n      var lang, ref;\n      lang = ((ref = this.rootscope.user) != null ? ref.lang : void 0) || this.config.get(\"defaultLanguage\") || \"en\";\n      this.translate.preferredLanguage(lang);\n      return this.translate.use(lang);\n    };\n\n    AuthService.prototype.getUser = function() {\n      var user, userData;\n      if (this.rootscope.user) {\n        return this.rootscope.user;\n      }\n      userData = this.storage.get(\"userInfo\");\n      if (userData) {\n        user = this.model.make_model(\"users\", userData);\n        this.rootscope.user = user;\n        this._setLocales();\n        this._setTheme();\n        return user;\n      } else {\n        this._setTheme();\n      }\n      return null;\n    };\n\n    AuthService.prototype.setUser = function(user) {\n      this.rootscope.auth = user;\n      this.storage.set(\"userInfo\", user.getAttrs());\n      this.rootscope.user = user;\n      this.setUserdata(user);\n      this._setLocales();\n      return this._setTheme();\n    };\n\n    AuthService.prototype.clear = function() {\n      this.rootscope.auth = null;\n      this.rootscope.user = null;\n      return this.storage.remove(\"userInfo\");\n    };\n\n    AuthService.prototype.setToken = function(token) {\n      return this.storage.set(\"token\", token);\n    };\n\n    AuthService.prototype.getToken = function() {\n      return this.storage.get(\"token\");\n    };\n\n    AuthService.prototype.removeToken = function() {\n      return this.storage.remove(\"token\");\n    };\n\n    AuthService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    AuthService.prototype.login = function(data, type) {\n      var url;\n      url = this.urls.resolve(\"auth\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"normal\";\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = _this.model.make_model(\"users\", data.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.logout = function() {\n      this.removeToken();\n      this.clear();\n      this.currentUserService.removeUser();\n      this._setTheme();\n      return this._setLocales();\n    };\n\n    AuthService.prototype.register = function(data, type, existing) {\n      var url;\n      url = this.urls.resolve(\"auth-register\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"public\";\n      if (type === \"private\") {\n        data.existing = existing ? existing : false;\n      }\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(response) {\n          var user;\n          user = _this.model.make_model(\"users\", response.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.getInvitation = function(token) {\n      return this.rs.invitations.get(token);\n    };\n\n    AuthService.prototype.acceptInvitiationWithNewUser = function(data) {\n      return this.register(data, \"private\", false);\n    };\n\n    AuthService.prototype.acceptInvitiationWithExistingUser = function(data) {\n      return this.register(data, \"private\", true);\n    };\n\n    AuthService.prototype.forgotPassword = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-password-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changePasswordFromRecovery = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-password-from-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changeEmail = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-email\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.cancelAccount = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-cancel-account\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    return AuthService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAuth\", AuthService);\n\n  PublicRegisterMessageDirective = function($config, $navUrls, $routeParams, templates) {\n    var template, templateFn;\n    template = templates.get(\"auth/login-text.html\", true);\n    templateFn = function() {\n      var nextUrl, publicRegisterEnabled, url;\n      publicRegisterEnabled = $config.get(\"publicRegisterEnabled\");\n      if (!publicRegisterEnabled) {\n        return \"\";\n      }\n      url = $navUrls.resolve(\"register\");\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"register\")) {\n        nextUrl = encodeURIComponent($routeParams['next']);\n        console.log(\"-----\", nextUrl);\n        url += \"?next=\" + nextUrl;\n      }\n      return template({\n        url: url\n      });\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgPublicRegisterMessage\", [\"$tgConfig\", \"$tgNavUrls\", \"$routeParams\", \"$tgTemplate\", PublicRegisterMessageDirective]);\n\n  LoginDirective = function($auth, $confirm, $location, $config, $routeParams, $navUrls, $events, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onError, onSuccess, submit;\n      form = new checksley.Form($el.find(\"form.login-form\"));\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      onSuccess = function(response) {\n        $events.setupConnection();\n        return $location.url($scope.nextUrl);\n      };\n      onError = function(response) {\n        return $confirm.notify(\"light-error\", $translate.instant(\"LOGIN_FORM.ERROR_AUTH_INCORRECT\"));\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          data = {\n            \"username\": $el.find(\"form.login-form input[name=username]\").val(),\n            \"password\": $el.find(\"form.login-form input[name=password]\").val()\n          };\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          promise = $auth.login(data, loginFormType);\n          return promise.then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      window.prerenderReady = true;\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLogin\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgEvents\", \"$translate\", LoginDirective]);\n\n  RegisterDirective = function($auth, $confirm, $location, $navUrls, $config, $routeParams, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      if (!$config.get(\"publicRegisterEnabled\")) {\n        $location.path($navUrls.resolve(\"not-found\"));\n        $location.replace();\n      }\n      $scope.data = {};\n      form = $el.find(\"form\").checksley({\n        onlyOneErrorElement: true\n      });\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"register\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      onSuccessSubmit = function(response) {\n        $analytics.trackEvent(\"auth\", \"register\", \"user registration\", 1);\n        $confirm.notify(\"success\", $translate.instant(\"LOGIN_FORM.SUCCESS\"));\n        return $location.url($scope.nextUrl);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return form.setErrors(response.data);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.register($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRegister\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\", \"$routeParams\", \"$tgAnalytics\", \"$translate\", RegisterDirective]);\n\n  ForgotPasswordDirective = function($auth, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.forgotPassword($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgForgotPassword\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$translate\", ForgotPasswordDirective]);\n\n  ChangePasswordFromRecoveryDirective = function($auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit, text;\n      $scope.data = {};\n      if ($params.token != null) {\n        $scope.tokenInParams = true;\n        $scope.data.token = $params.token;\n      } else {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        $confirm.notify(\"light-error\", text);\n      }\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.changePasswordFromRecovery($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangePasswordFromRecovery\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangePasswordFromRecoveryDirective]);\n\n  InvitationDirective = function($auth, $confirm, $location, $params, $navUrls, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loginForm, onErrorSubmitLogin, onErrorSubmitRegister, onSuccessSubmitLogin, onSuccessSubmitRegister, promise, registerForm, submitLogin, submitRegister, token;\n      token = $params.token;\n      promise = $auth.getInvitation(token);\n      promise.then(function(invitation) {\n        return $scope.invitation = invitation;\n      });\n      promise.then(null, function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.NOT_FOUND\");\n        return $confirm.notify(\"light-error\", text);\n      });\n      $scope.dataLogin = {\n        token: token\n      };\n      loginForm = $el.find(\"form.login-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitLogin = function(response) {\n        var text;\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with existing user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.SUCCESS\", {\n          \"project_name\": $scope.invitation.project_name\n        });\n        return $confirm.notify(\"success\", text);\n      };\n      onErrorSubmitLogin = function(response) {\n        return $confirm.notify(\"light-error\", response.data._error_message);\n      };\n      submitLogin = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!loginForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithExistingUser($scope.dataLogin);\n          return promise.then(onSuccessSubmitLogin, onErrorSubmitLogin);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.login-form\", submitLogin);\n      $el.on(\"click\", \".button-login\", submitLogin);\n      $scope.dataRegister = {\n        token: token\n      };\n      registerForm = $el.find(\"form.register-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitRegister = function(response) {\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with new user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        return $confirm.notify(\"success\", \"You've successfully joined this project\", \"Welcome to \" + (_.escape($scope.invitation.project_name)));\n      };\n      onErrorSubmitRegister = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return registerForm.setErrors(response.data);\n      };\n      submitRegister = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!registerForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithNewUser($scope.dataRegister);\n          return promise.then(onSuccessSubmitRegister, onErrorSubmitRegister);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.register-form\", submitRegister);\n      $el.on(\"click\", \".button-register\", submitRegister);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgInvitation\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", InvitationDirective]);\n\n  ChangeEmailDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.email_token = $params.email_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        if ($auth.isAuthenticated()) {\n          $repo.queryOne(\"users\", $auth.getUser().id).then((function(_this) {\n            return function(data) {\n              $auth.setUser(data);\n              return $location.path($navUrls.resolve(\"home\"));\n            };\n          })(this));\n        } else {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n        text = $translate.instant(\"CHANGE_EMAIL_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = function() {\n        var promise;\n        if (!form.validate()) {\n          return;\n        }\n        promise = $auth.changeEmail($scope.data);\n        return promise.then(onSuccessSubmit, onErrorSubmit);\n      };\n      $el.on(\"submit\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \"a.button-change-email\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangeEmail\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangeEmailDirective]);\n\n  CancelAccountDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.cancel_token = $params.cancel_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $auth.logout();\n        $location.path($navUrls.resolve(\"home\"));\n        text = $translate.instant(\"CANCEL_ACCOUNT.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.cancelAccount($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCancelAccount\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", CancelAccountDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaBacklog\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base.coffee\n */\n\n(function() {\n  var TaigaMainDirective, bindOnce, groupBy, init, module, taiga, urls;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\", []);\n\n  TaigaMainDirective = function($rootscope, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $window.onresize = function() {\n        return $rootscope.$broadcast(\"resize\");\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMain\", [\"$rootScope\", \"$window\", TaigaMainDirective]);\n\n  urls = {\n    \"home\": \"/\",\n    \"projects\": \"/projects\",\n    \"error\": \"/error\",\n    \"not-found\": \"/not-found\",\n    \"permission-denied\": \"/permission-denied\",\n    \"discover\": \"/discover\",\n    \"discover-search\": \"/discover/search\",\n    \"login\": \"/login\",\n    \"forgot-password\": \"/forgot-password\",\n    \"change-password\": \"/change-password/:token\",\n    \"change-email\": \"/change-email/:token\",\n    \"cancel-account\": \"/cancel-account/:token\",\n    \"register\": \"/register\",\n    \"invitation\": \"/invitation/:token\",\n    \"create-project\": \"/create-project\",\n    \"profile\": \"/profile\",\n    \"user-profile\": \"/profile/:username\",\n    \"project\": \"/project/:project\",\n    \"project-backlog\": \"/project/:project/backlog\",\n    \"project-taskboard\": \"/project/:project/taskboard/:sprint\",\n    \"project-kanban\": \"/project/:project/kanban\",\n    \"project-issues\": \"/project/:project/issues\",\n    \"project-search\": \"/project/:project/search\",\n    \"project-userstories-detail\": \"/project/:project/us/:ref\",\n    \"project-tasks-detail\": \"/project/:project/task/:ref\",\n    \"project-issues-detail\": \"/project/:project/issue/:ref\",\n    \"project-wiki\": \"/project/:project/wiki\",\n    \"project-wiki-page\": \"/project/:project/wiki/:slug\",\n    \"project-team\": \"/project/:project/team\",\n    \"project-admin-home\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-details\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-default-values\": \"/project/:project/admin/project-profile/default-values\",\n    \"project-admin-project-profile-modules\": \"/project/:project/admin/project-profile/modules\",\n    \"project-admin-project-profile-export\": \"/project/:project/admin/project-profile/export\",\n    \"project-admin-project-profile-reports\": \"/project/:project/admin/project-profile/reports\",\n    \"project-admin-project-values-status\": \"/project/:project/admin/project-values/status\",\n    \"project-admin-project-values-points\": \"/project/:project/admin/project-values/points\",\n    \"project-admin-project-values-priorities\": \"/project/:project/admin/project-values/priorities\",\n    \"project-admin-project-values-severities\": \"/project/:project/admin/project-values/severities\",\n    \"project-admin-project-values-triggers\": \"/project/:project/admin/project-values/triggers\",\n    \"project-admin-project-values-types\": \"/project/:project/admin/project-values/types\",\n    \"project-admin-project-values-custom-fields\": \"/project/:project/admin/project-values/custom-fields\",\n    \"project-admin-memberships\": \"/project/:project/admin/memberships\",\n    \"project-admin-roles\": \"/project/:project/admin/roles\",\n    \"project-admin-third-parties-webhooks\": \"/project/:project/admin/third-parties/webhooks\",\n    \"project-admin-third-parties-github\": \"/project/:project/admin/third-parties/github\",\n    \"project-admin-third-parties-gitlab\": \"/project/:project/admin/third-parties/gitlab\",\n    \"project-admin-third-parties-bitbucket\": \"/project/:project/admin/third-parties/bitbucket\",\n    \"project-admin-contrib\": \"/project/:project/admin/contrib/:plugin\",\n    \"user-settings-user-profile\": \"/user-settings/user-profile\",\n    \"user-settings-user-change-password\": \"/user-settings/user-change-password\",\n    \"user-settings-user-avatar\": \"/user-settings/user-avatar\",\n    \"user-settings-mail-notifications\": \"/user-settings/mail-notifications\"\n  };\n\n  init = function($log, $navurls) {\n    $log.debug(\"Initialize navigation urls\");\n    return $navurls.update(urls);\n  };\n\n  module.run([\"$log\", \"$tgNavUrls\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common.coffee\n */\n\n(function() {\n  var AnimationFrame, Capslock, CheckPermissionDirective, ClassPermissionDirective, DataPickerConfig, LimitLineLengthDirective, ProjectUrl, Qqueue, SelectedText, Template, ToggleCommentDirective, module, taiga,\n    slice = [].slice;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\", []);\n\n  DataPickerConfig = function($translate) {\n    return {\n      get: function() {\n        return {\n          i18n: {\n            previousMonth: $translate.instant(\"COMMON.PICKERDATE.PREV_MONTH\"),\n            nextMonth: $translate.instant(\"COMMON.PICKERDATE.NEXT_MONTH\"),\n            months: [$translate.instant(\"COMMON.PICKERDATE.MONTHS.JAN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.FEB\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.APR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAY\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUL\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.AUG\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.SEP\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.OCT\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.NOV\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.DEC\")],\n            weekdays: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SAT\")],\n            weekdaysShort: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT\")]\n          },\n          isRTL: $translate.instant(\"COMMON.PICKERDATE.IS_RTL\") === \"true\",\n          firstDay: parseInt($translate.instant(\"COMMON.PICKERDATE.FIRST_DAY_OF_WEEK\"), 10),\n          format: $translate.instant(\"COMMON.PICKERDATE.FORMAT\")\n        };\n      }\n    };\n  };\n\n  module.factory(\"tgDatePickerConfigService\", [\"$translate\", DataPickerConfig]);\n\n  SelectedText = function($window, $document) {\n    var get;\n    get = function() {\n      if ($window.getSelection) {\n        return $window.getSelection().toString();\n      } else if ($document.selection) {\n        return $document.selection.createRange().text;\n      }\n      return \"\";\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$selectedText\", [\"$window\", \"$document\", SelectedText]);\n\n  CheckPermissionDirective = function(projectService) {\n    var link, render;\n    render = function($el, project, permission) {\n      if (project && permission) {\n        if (project.get('my_permissions').indexOf(permission) > -1) {\n          return $el.removeClass('hidden');\n        }\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var permission, unObserve, unwatch;\n      $el.addClass('hidden');\n      permission = $attrs.tgCheckPermission;\n      unwatch = $scope.$watch(function() {\n        return projectService.project;\n      }, function() {\n        if (!projectService.project) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unwatch();\n      });\n      unObserve = $attrs.$observe(\"tgCheckPermission\", function(permission) {\n        if (!permission) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unObserve();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CheckPermissionDirective.$inject = [\"tgProjectService\"];\n\n  module.directive(\"tgCheckPermission\", CheckPermissionDirective);\n\n  ClassPermissionDirective = function() {\n    var link, name;\n    name = \"tgClassPermission\";\n    link = function($scope, $el, $attrs) {\n      var checkPermissions, tgClassPermissionWatchAction, unbindWatcher;\n      checkPermissions = function(project, className, permission) {\n        var negation;\n        negation = permission[0] === \"!\";\n        if (negation) {\n          permission = permission.slice(1);\n        }\n        if (negation && project.my_permissions.indexOf(permission) === -1) {\n          return $el.addClass(className);\n        } else if (!negation && project.my_permissions.indexOf(permission) !== -1) {\n          return $el.addClass(className);\n        } else {\n          return $el.removeClass(className);\n        }\n      };\n      tgClassPermissionWatchAction = function(project) {\n        var className, classes, permission, results;\n        if (project) {\n          unbindWatcher();\n          classes = $scope.$eval($attrs[name]);\n          results = [];\n          for (className in classes) {\n            permission = classes[className];\n            results.push(checkPermissions(project, className, permission));\n          }\n          return results;\n        }\n      };\n      return unbindWatcher = $scope.$watch(\"project\", tgClassPermissionWatchAction);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgClassPermission\", ClassPermissionDirective);\n\n  AnimationFrame = function() {\n    var add, animationFrame, performAnimation, tail;\n    animationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;\n    performAnimation = (function(_this) {\n      return function(time) {\n        var fn;\n        fn = tail.shift();\n        fn();\n        if (tail.length) {\n          return animationFrame(performAnimation);\n        }\n      };\n    })(this);\n    tail = [];\n    add = function() {\n      var fn, i, len, results;\n      results = [];\n      for (i = 0, len = arguments.length; i < len; i++) {\n        fn = arguments[i];\n        tail.push(fn);\n        if (tail.length === 1) {\n          results.push(animationFrame(performAnimation));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    return {\n      add: add\n    };\n  };\n\n  module.factory(\"animationFrame\", AnimationFrame);\n\n  ToggleCommentDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.find(\"textarea\").on(\"focus\", function() {\n        return $el.addClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleComment\", ToggleCommentDirective);\n\n  ProjectUrl = function($navurls) {\n    var get;\n    get = function(project) {\n      var ctx;\n      ctx = {\n        project: project.slug\n      };\n      if (project.is_backlog_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-backlog\", ctx);\n      }\n      if (project.is_kanban_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-kanban\", ctx);\n      }\n      if (project.is_wiki_activated && project.my_permissions.indexOf(\"view_wiki_pages\") > -1) {\n        return $navurls.resolve(\"project-wiki\", ctx);\n      }\n      if (project.is_issues_activated && project.my_permissions.indexOf(\"view_issues\") > -1) {\n        return $navurls.resolve(\"project-issues\", ctx);\n      }\n      return $navurls.resolve(\"project\", ctx);\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$projectUrl\", [\"$tgNavUrls\", ProjectUrl]);\n\n  LimitLineLengthDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var maxColsPerLine;\n      maxColsPerLine = parseInt($el.attr(\"cols\"));\n      return $el.on(\"keyup\", function(event) {\n        var code, lines;\n        code = event.keyCode;\n        lines = $el.val().split(\"\\n\");\n        _.each(lines, function(line, index) {\n          return lines[index] = line.substring(0, maxColsPerLine - 2);\n        });\n        return $el.val(lines.join(\"\\n\"));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLimitLineLength\", LimitLineLengthDirective);\n\n  Qqueue = function($q) {\n    var deferred, lastPromise, qqueue;\n    deferred = $q.defer();\n    deferred.resolve();\n    lastPromise = deferred.promise;\n    qqueue = {\n      bindAdd: (function(_this) {\n        return function(fn) {\n          return function() {\n            var args;\n            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n            return lastPromise = lastPromise.then(function() {\n              return fn.apply(_this, args);\n            });\n          };\n          return qqueue;\n        };\n      })(this),\n      add: (function(_this) {\n        return function(fn) {\n          if (!lastPromise) {\n            lastPromise = fn();\n          } else {\n            lastPromise = lastPromise.then(fn);\n          }\n          return qqueue;\n        };\n      })(this)\n    };\n    return qqueue;\n  };\n\n  module.factory(\"$tgQqueue\", [\"$q\", Qqueue]);\n\n  Template = function($templateCache) {\n    return {\n      get: (function(_this) {\n        return function(name, lodash) {\n          var tmp;\n          if (lodash == null) {\n            lodash = false;\n          }\n          tmp = $templateCache.get(name);\n          if (lodash) {\n            tmp = _.template(tmp);\n          }\n          return tmp;\n        };\n      })(this)\n    };\n  };\n\n  module.factory(\"$tgTemplate\", [\"$templateCache\", Template]);\n\n  Capslock = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var hideIcon, open, showIcon, warningIcon;\n      open = false;\n      warningIcon = $('<div>').addClass('icon').addClass('icon-capslock').attr('title', $translate.instant('COMMON.CAPSLOCK_WARNING'));\n      hideIcon = function() {\n        return warningIcon.fadeOut(function() {\n          open = false;\n          return $(this).remove();\n        });\n      };\n      showIcon = function(e) {\n        var element;\n        if (open) {\n          return;\n        }\n        element = e.currentTarget;\n        $(element).parent().append(warningIcon);\n        $('.icon-capslock').fadeIn();\n        return open = true;\n      };\n      $el.on('blur', function(e) {\n        return hideIcon();\n      });\n      $el.on('keyup.capslock, focus', function(e) {\n        if ($el.val() === $el.val().toLowerCase()) {\n          return hideIcon(e);\n        } else {\n          return showIcon(e);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off('.capslock');\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCapslock\", [\"$translate\", Capslock]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/events.coffee\n */\n\n(function() {\n  var EventsProvider, EventsService, bindMethods, module, startswith, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEvents\", []);\n\n  EventsService = (function() {\n    function EventsService(win, log, config, auth, liveAnnouncementService1, rootScope) {\n      this.win = win;\n      this.log = log;\n      this.config = config;\n      this.auth = auth;\n      this.liveAnnouncementService = liveAnnouncementService1;\n      this.rootScope = rootScope;\n      this.processMessage = bind(this.processMessage, this);\n      bindMethods(this);\n    }\n\n    EventsService.prototype.initialize = function(sessionId) {\n      this.sessionId = sessionId;\n      this.subscriptions = {};\n      this.connected = false;\n      this.error = false;\n      this.pendingMessages = [];\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = null;\n      if (this.win.WebSocket === void 0) {\n        return this.log.info(\"WebSockets not supported on your browser\");\n      }\n    };\n\n    EventsService.prototype.setupConnection = function() {\n      var loc, path, scheme, url;\n      this.stopExistingConnection();\n      url = this.config.get(\"eventsUrl\");\n      if (!url) {\n        return;\n      }\n      if (!startswith(url, \"ws:\") && !startswith(url, \"wss:\")) {\n        loc = this.win.location;\n        scheme = loc.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        path = _.str.ltrim(url, \"/\");\n        url = scheme + \"//\" + loc.host + \"/\" + path;\n      }\n      this.ws = new this.win.WebSocket(url);\n      this.ws.addEventListener(\"open\", this.onOpen);\n      this.ws.addEventListener(\"message\", this.onMessage);\n      this.ws.addEventListener(\"error\", this.onError);\n      return this.ws.addEventListener(\"close\", this.onClose);\n    };\n\n    EventsService.prototype.stopExistingConnection = function() {\n      if (this.ws === void 0) {\n        return;\n      }\n      this.ws.removeEventListener(\"open\", this.onOpen);\n      this.ws.removeEventListener(\"close\", this.onClose);\n      this.ws.removeEventListener(\"error\", this.onError);\n      this.ws.removeEventListener(\"message\", this.onMessage);\n      this.stopHeartBeatMessages();\n      this.ws.close();\n      return delete this.ws;\n    };\n\n    EventsService.prototype.notifications = function() {\n      return this.subscribe(null, 'notifications', (function(_this) {\n        return function(data) {\n          _this.liveAnnouncementService.show(data.title, data.desc);\n          return _this.rootScope.$digest();\n        };\n      })(this));\n    };\n\n    EventsService.prototype.startHeartBeatMessages = function() {\n      var heartbeatIntervalTime, maxMissedHeartbeats;\n      if (this.heartbeatInterval) {\n        return;\n      }\n      maxMissedHeartbeats = this.config.get(\"eventsMaxMissedHeartbeats\", 5);\n      heartbeatIntervalTime = this.config.get(\"eventsHeartbeatIntervalTime\", 60000);\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = setInterval((function(_this) {\n        return function() {\n          var e, error1;\n          try {\n            if (_this.missedHeartbeats >= maxMissedHeartbeats) {\n              throw new Error(\"Too many missed heartbeats PINGs.\");\n            }\n            _this.missedHeartbeats++;\n            _this.sendMessage({\n              cmd: \"ping\"\n            });\n            return _this.log.debug(\"HeartBeat send PING\");\n          } catch (error1) {\n            e = error1;\n            _this.log.error(\"HeartBeat error: \" + e.message);\n            return _this.stopHeartBeatMessages();\n          }\n        };\n      })(this), heartbeatIntervalTime);\n      return this.log.debug(\"HeartBeat enabled\");\n    };\n\n    EventsService.prototype.stopHeartBeatMessages = function() {\n      if (!this.heartbeatInterval) {\n        return;\n      }\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n      return this.log.debug(\"HeartBeat disabled\");\n    };\n\n    EventsService.prototype.processHeartBeatPongMessage = function(data) {\n      this.missedHeartbeats = 0;\n      return this.log.debug(\"HeartBeat recived PONG\");\n    };\n\n    EventsService.prototype.serialize = function(message) {\n      if (_.isObject(message)) {\n        return JSON.stringify(message);\n      }\n      return message;\n    };\n\n    EventsService.prototype.sendMessage = function(message) {\n      var i, len, messages, msg, results;\n      this.pendingMessages.push(message);\n      if (!this.connected) {\n        return;\n      }\n      messages = _.map(this.pendingMessages, this.serialize);\n      this.pendingMessages = [];\n      results = [];\n      for (i = 0, len = messages.length; i < len; i++) {\n        msg = messages[i];\n        results.push(this.ws.send(msg));\n      }\n      return results;\n    };\n\n    EventsService.prototype.processMessage = function(data) {\n      var routingKey, subscription;\n      routingKey = data.routing_key;\n      if (this.subscriptions[routingKey] == null) {\n        return;\n      }\n      subscription = this.subscriptions[routingKey];\n      if (subscription.scope) {\n        return subscription.scope.$apply(function() {\n          return subscription.callback(data.data);\n        });\n      } else {\n        return subscription.callback(data.data);\n      }\n    };\n\n    EventsService.prototype.subscribe = function(scope, routingKey, callback) {\n      var message, subscription;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Subscribe to: \" + routingKey);\n      subscription = {\n        scope: scope,\n        routingKey: routingKey,\n        callback: _.debounce(callback, 500, {\n          \"leading\": true,\n          \"trailing\": false\n        })\n      };\n      message = {\n        \"cmd\": \"subscribe\",\n        \"routing_key\": routingKey\n      };\n      this.subscriptions[routingKey] = subscription;\n      this.sendMessage(message);\n      if (scope) {\n        return scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            return _this.unsubscribe(routingKey);\n          };\n        })(this));\n      }\n    };\n\n    EventsService.prototype.unsubscribe = function(routingKey) {\n      var message;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Unsubscribe from: \" + routingKey);\n      message = {\n        \"cmd\": \"unsubscribe\",\n        \"routing_key\": routingKey\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onOpen = function() {\n      var message, token;\n      this.connected = true;\n      this.startHeartBeatMessages();\n      this.notifications();\n      this.log.debug(\"WebSocket connection opened\");\n      token = this.auth.getToken();\n      message = {\n        cmd: \"auth\",\n        data: {\n          token: token,\n          sessionId: this.sessionId\n        }\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onMessage = function(event) {\n      var data;\n      this.log.debug(\"WebSocket message received: \" + event.data);\n      data = JSON.parse(event.data);\n      if (data.cmd === \"pong\") {\n        return this.processHeartBeatPongMessage(data);\n      } else {\n        return this.processMessage(data);\n      }\n    };\n\n    EventsService.prototype.onError = function(error) {\n      this.log.error(\"WebSocket error: \" + error);\n      return this.error = true;\n    };\n\n    EventsService.prototype.onClose = function() {\n      this.log.debug(\"WebSocket closed.\");\n      this.connected = false;\n      return this.stopHeartBeatMessages();\n    };\n\n    return EventsService;\n\n  })();\n\n  EventsProvider = (function() {\n    function EventsProvider() {}\n\n    EventsProvider.prototype.setSessionId = function(sessionId) {\n      return this.sessionId = sessionId;\n    };\n\n    EventsProvider.prototype.$get = function($win, $log, $conf, $auth, liveAnnouncementService, $rootScope) {\n      var service;\n      service = new EventsService($win, $log, $conf, $auth, liveAnnouncementService, $rootScope);\n      service.initialize(this.sessionId);\n      return service;\n    };\n\n    EventsProvider.prototype.$get.$inject = [\"$window\", \"$log\", \"$tgConfig\", \"$tgAuth\", \"tgLiveAnnouncementService\", \"$rootScope\"];\n\n    return EventsProvider;\n\n  })();\n\n  module.provider(\"$tgEvents\", EventsProvider);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/feedback.coffee\n */\n\n(function() {\n  var FeedbackDirective, bindOnce, debounce, groupBy, mixOf, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaFeedback\", []);\n\n  FeedbackDirective = function($lightboxService, $repo, $confirm, $loading, feedbackService) {\n    var directive, link;\n    link = function($scope, $el, $attrs) {\n      var form, openLightbox, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"feedback\", $scope.feedback);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $lightboxService.close($el);\n            return $confirm.notify(\"success\", \"\\\\o/ we'll be happy to read your\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      openLightbox = function() {\n        $scope.feedback = {};\n        $lightboxService.open($el);\n        return $el.find(\"textarea\").focus();\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"common/lightbox-feedback.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbFeedback\", [\"lightboxService\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgFeedbackService\", FeedbackDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/integrations.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIntegrations\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIssues\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaKanban\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaPlugins\", [\"ngRoute\"]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/projects.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProject\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/related-tasks.coffee\n */\n\n(function() {\n  var RelatedTaskAssignedToInlineEditionDirective, RelatedTaskCreateButtonDirective, RelatedTaskCreateFormDirective, RelatedTaskRowDirective, RelatedTasksDirective, debounce, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaRelatedTasks\", []);\n\n  RelatedTaskRowDirective = function($repo, $compile, $confirm, $rootscope, $loading, $template, $translate) {\n    var link, templateEdit, templateView;\n    templateView = $template.get(\"task/related-task-row.html\", true);\n    templateEdit = $template.get(\"task/related-task-row-edit.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var renderEdit, renderView, saveTask;\n      saveTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.save(task);\n        promise.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"related-tasks:update\");\n          };\n        })(this));\n        promise.then(null, (function(_this) {\n          return function() {\n            currentLoading.finish();\n            $el.find('input').val(task.subject);\n            return $confirm.notify(\"error\");\n          };\n        })(this));\n        return promise;\n      });\n      renderEdit = function(task) {\n        $el.html($compile(templateEdit({\n          task: task\n        }))($scope));\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return saveTask($model.$modelValue).then(function() {\n              return renderView($model.$modelValue);\n            });\n          } else if (event.keyCode === 27) {\n            return renderView($model.$modelValue);\n          }\n        });\n        $el.on(\"click\", \".icon-floppy\", function(event) {\n          return saveTask($model.$modelValue).then(function() {\n            return renderView($model.$modelValue);\n          });\n        });\n        return $el.on(\"click\", \".cancel-edit\", function(event) {\n          return renderView($model.$modelValue);\n        });\n      };\n      renderView = function(task) {\n        var perms;\n        $el.off();\n        perms = {\n          modify_task: $scope.project.my_permissions.indexOf(\"modify_task\") !== -1,\n          delete_task: $scope.project.my_permissions.indexOf(\"delete_task\") !== -1\n        };\n        $el.html($compile(templateView({\n          task: task,\n          perms: perms\n        }))($scope));\n        $el.on(\"click\", \".icon-edit\", function() {\n          renderEdit($model.$modelValue);\n          return $el.find('input').focus().select();\n        });\n        return $el.on(\"click\", \".delete-task\", function(event) {\n          var message, title;\n          title = $translate.instant(\"TASK.TITLE_DELETE_ACTION\");\n          task = $model.$modelValue;\n          message = task.subject;\n          return $confirm.askOnDelete(title, message).then(function(askResponse) {\n            var promise;\n            promise = $repo.remove(task);\n            promise.then(function() {\n              askResponse.finish();\n              return $scope.$emit(\"related-tasks:delete\");\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          });\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(val) {\n        if (!val) {\n          return;\n        }\n        return renderView(val);\n      });\n      $scope.$on(\"related-tasks:assigned-to-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      $scope.$on(\"related-tasks:status-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgRelatedTaskRow\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", RelatedTaskRowDirective]);\n\n  RelatedTaskCreateFormDirective = function($repo, $compile, $confirm, $tgmodel, $loading, $analytics, $template) {\n    var link, newTask, template;\n    template = $template.get(\"task/related-task-create-form.html\", true);\n    newTask = {\n      subject: \"\",\n      assigned_to: null\n    };\n    link = function($scope, $el, $attrs) {\n      var close, createTask, render;\n      createTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        task.assigned_to = $scope.newTask.assigned_to;\n        task.status = $scope.newTask.status;\n        $scope.newTask.status = $scope.project.default_task_status;\n        $scope.newTask.assigned_to = null;\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.create(\"tasks\", task);\n        promise.then(function() {\n          $analytics.trackEvent(\"task\", \"create\", \"create task on userstory\", 1);\n          currentLoading.finish();\n          return $scope.$emit(\"related-tasks:add\");\n        });\n        promise.then(null, function() {\n          $el.find('input').val(task.subject);\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n        return promise;\n      });\n      close = function() {\n        $el.off();\n        $el.html(\"\");\n        return $scope.newRelatedTaskFormOpen = false;\n      };\n      render = function() {\n        $scope.newRelatedTaskFormOpen = true;\n        $el.html($compile(template())($scope));\n        $el.find('input').focus().select();\n        $el.addClass('active');\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return createTask(newTask).then(function() {\n              return render();\n            });\n          } else if (event.keyCode === 27) {\n            return $scope.$apply(function() {\n              return close();\n            });\n          }\n        });\n        $el.on(\"click\", \".icon-delete\", function(event) {\n          return $scope.$apply(function() {\n            return close();\n          });\n        });\n        return $el.on(\"click\", \".icon-floppy\", function(event) {\n          return createTask(newTask).then(function() {\n            return close();\n          });\n        });\n      };\n      taiga.bindOnce($scope, \"us\", function(val) {\n        newTask[\"status\"] = $scope.project.default_task_status;\n        newTask[\"project\"] = $scope.project.id;\n        newTask[\"user_story\"] = $scope.us.id;\n        $scope.newTask = $tgmodel.make_model(\"tasks\", newTask);\n        return $el.html(\"\");\n      });\n      $scope.$on(\"related-tasks:show-form\", function() {\n        return render();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateForm\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgLoading\", \"$tgAnalytics\", \"$tgTemplate\", RelatedTaskCreateFormDirective]);\n\n  RelatedTaskCreateButtonDirective = function($repo, $compile, $confirm, $tgmodel, $template) {\n    var link, template;\n    template = $template.get(\"common/components/add-button.html\", true);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch(\"project\", function(val) {\n        if (!val) {\n          return;\n        }\n        $el.off();\n        if ($scope.project.my_permissions.indexOf(\"add_task\") !== -1) {\n          $el.html($compile(template())($scope));\n        } else {\n          $el.html(\"\");\n        }\n        return $el.on(\"click\", \".add-button\", function(event) {\n          return $scope.$emit(\"related-tasks:add-new-clicked\");\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateButton\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgTemplate\", RelatedTaskCreateButtonDirective]);\n\n  RelatedTasksDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loadTasks;\n      loadTasks = function() {\n        return $rs.tasks.list($scope.projectId, null, $scope.usId).then((function(_this) {\n          return function(tasks) {\n            $scope.tasks = _.sortBy(tasks, 'ref');\n            return tasks;\n          };\n        })(this));\n      };\n      $scope.$on(\"related-tasks:add\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:delete\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:add-new-clicked\", function() {\n        return $scope.$broadcast(\"related-tasks:show-form\");\n      });\n      taiga.bindOnce($scope, \"us\", function(val) {\n        return loadTasks();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", RelatedTasksDirective]);\n\n  RelatedTaskAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task, updateRelatedTask;\n      updateRelatedTask = function(task) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[task.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".task-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      updateRelatedTask(task);\n      $el.on(\"click\", \".task-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", task);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", debounce(2000, (function(_this) {\n        return function(ctx, userId, updatedRelatedTask) {\n          if (updatedRelatedTask.id === task.id) {\n            updatedRelatedTask.assigned_to = userId;\n            if (autoSave) {\n              $repo.save(updatedRelatedTask).then(function() {\n                return $scope.$emit(\"related-tasks:assigned-to-changed\");\n              });\n            }\n            return updateRelatedTask(updatedRelatedTask);\n          }\n        };\n      })(this)));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", RelatedTaskAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources.coffee\n */\n\n(function() {\n  var ResourcesService, initResources, initUrls, module, taiga, urls,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ResourcesService = (function(superClass) {\n    extend(ResourcesService, superClass);\n\n    function ResourcesService() {\n      return ResourcesService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ResourcesService;\n\n  })(taiga.Service);\n\n  urls = {\n    \"auth\": \"/auth\",\n    \"auth-register\": \"/auth/register\",\n    \"invitations\": \"/invitations\",\n    \"users\": \"/users\",\n    \"by_username\": \"/users/by_username\",\n    \"users-password-recovery\": \"/users/password_recovery\",\n    \"users-change-password-from-recovery\": \"/users/change_password_from_recovery\",\n    \"users-change-password\": \"/users/change_password\",\n    \"users-change-email\": \"/users/change_email\",\n    \"users-cancel-account\": \"/users/cancel\",\n    \"user-stats\": \"/users/%s/stats\",\n    \"user-liked\": \"/users/%s/liked\",\n    \"user-voted\": \"/users/%s/voted\",\n    \"user-watched\": \"/users/%s/watched\",\n    \"user-contacts\": \"/users/%s/contacts\",\n    \"permissions\": \"/permissions\",\n    \"notify-policies\": \"/notify-policies\",\n    \"user-storage\": \"/user-storage\",\n    \"memberships\": \"/memberships\",\n    \"bulk-create-memberships\": \"/memberships/bulk_create\",\n    \"roles\": \"/roles\",\n    \"permissions\": \"/permissions\",\n    \"resolver\": \"/resolver\",\n    \"projects\": \"/projects\",\n    \"project-templates\": \"/project-templates\",\n    \"project-modules\": \"/projects/%s/modules\",\n    \"bulk-update-projects-order\": \"/projects/bulk_update_order\",\n    \"project-like\": \"/projects/%s/like\",\n    \"project-unlike\": \"/projects/%s/unlike\",\n    \"project-watch\": \"/projects/%s/watch\",\n    \"project-unwatch\": \"/projects/%s/unwatch\",\n    \"userstory-statuses\": \"/userstory-statuses\",\n    \"points\": \"/points\",\n    \"task-statuses\": \"/task-statuses\",\n    \"issue-statuses\": \"/issue-statuses\",\n    \"issue-types\": \"/issue-types\",\n    \"priorities\": \"/priorities\",\n    \"severities\": \"/severities\",\n    \"triggers\": \"/triggers\",\n    \"milestones\": \"/milestones\",\n    \"userstories\": \"/userstories\",\n    \"bulk-create-us\": \"/userstories/bulk_create\",\n    \"bulk-update-us-backlog-order\": \"/userstories/bulk_update_backlog_order\",\n    \"bulk-update-us-sprint-order\": \"/userstories/bulk_update_sprint_order\",\n    \"bulk-update-us-kanban-order\": \"/userstories/bulk_update_kanban_order\",\n    \"userstories-filters\": \"/userstories/filters_data\",\n    \"userstory-upvote\": \"/userstories/%s/upvote\",\n    \"userstory-downvote\": \"/userstories/%s/downvote\",\n    \"userstory-watch\": \"/userstories/%s/watch\",\n    \"userstory-unwatch\": \"/userstories/%s/unwatch\",\n    \"tasks\": \"/tasks\",\n    \"bulk-create-tasks\": \"/tasks/bulk_create\",\n    \"bulk-update-task-taskboard-order\": \"/tasks/bulk_update_taskboard_order\",\n    \"task-upvote\": \"/tasks/%s/upvote\",\n    \"task-downvote\": \"/tasks/%s/downvote\",\n    \"task-watch\": \"/tasks/%s/watch\",\n    \"task-unwatch\": \"/tasks/%s/unwatch\",\n    \"issues\": \"/issues\",\n    \"bulk-create-issues\": \"/issues/bulk_create\",\n    \"issues-filters\": \"/issues/filters_data\",\n    \"issue-upvote\": \"/issues/%s/upvote\",\n    \"issue-downvote\": \"/issues/%s/downvote\",\n    \"issue-watch\": \"/issues/%s/watch\",\n    \"issue-unwatch\": \"/issues/%s/unwatch\",\n    \"wiki\": \"/wiki\",\n    \"wiki-restore\": \"/wiki/%s/restore\",\n    \"wiki-links\": \"/wiki-links\",\n    \"history/us\": \"/history/userstory\",\n    \"history/issue\": \"/history/issue\",\n    \"history/task\": \"/history/task\",\n    \"history/wiki\": \"/history/wiki\",\n    \"attachments/us\": \"/userstories/attachments\",\n    \"attachments/issue\": \"/issues/attachments\",\n    \"attachments/task\": \"/tasks/attachments\",\n    \"attachments/wiki_page\": \"/wiki/attachments\",\n    \"custom-attributes/userstory\": \"/userstory-custom-attributes\",\n    \"custom-attributes/issue\": \"/issue-custom-attributes\",\n    \"custom-attributes/task\": \"/task-custom-attributes\",\n    \"custom-attributes-values/userstory\": \"/userstories/custom-attributes-values\",\n    \"custom-attributes-values/issue\": \"/issues/custom-attributes-values\",\n    \"custom-attributes-values/task\": \"/tasks/custom-attributes-values\",\n    \"webhooks\": \"/webhooks\",\n    \"webhooks-test\": \"/webhooks/%s/test\",\n    \"webhooklogs\": \"/webhooklogs\",\n    \"webhooklogs-resend\": \"/webhooklogs/%s/resend\",\n    \"userstories-csv\": \"/userstories/csv?uuid=%s\",\n    \"tasks-csv\": \"/tasks/csv?uuid=%s\",\n    \"issues-csv\": \"/issues/csv?uuid=%s\",\n    \"timeline-profile\": \"/timeline/profile\",\n    \"timeline-user\": \"/timeline/user\",\n    \"timeline-project\": \"/timeline/project\",\n    \"search\": \"/search\",\n    \"exporter\": \"/exporter\",\n    \"importer\": \"/importer/load_dump\",\n    \"feedback\": \"/feedback\",\n    \"locales\": \"/locales\",\n    \"applications\": \"/applications\",\n    \"application-tokens\": \"/application-tokens\",\n    \"stats-discover\": \"/stats/discover\"\n  };\n\n  initUrls = function($log, $urls) {\n    $log.debug(\"Initialize api urls\");\n    return $urls.update(urls);\n  };\n\n  initResources = function($log, $rs) {\n    var i, len, provider, providers, results;\n    $log.debug(\"Initialize resources\");\n    providers = _.toArray(arguments).slice(2);\n    results = [];\n    for (i = 0, len = providers.length; i < len; i++) {\n      provider = providers[i];\n      results.push(provider($rs));\n    }\n    return results;\n  };\n\n  module = angular.module(\"taigaResources\", [\"taigaBase\"]);\n\n  module.service(\"$tgResources\", ResourcesService);\n\n  module.run([\"$log\", \"$tgUrls\", initUrls]);\n\n  module.run([\"$log\", \"$tgResources\", \"$tgProjectsResourcesProvider\", \"$tgCustomAttributesResourcesProvider\", \"$tgCustomAttributesValuesResourcesProvider\", \"$tgMembershipsResourcesProvider\", \"$tgNotifyPoliciesResourcesProvider\", \"$tgInvitationsResourcesProvider\", \"$tgRolesResourcesProvider\", \"$tgUserSettingsResourcesProvider\", \"$tgSprintsResourcesProvider\", \"$tgUserstoriesResourcesProvider\", \"$tgTasksResourcesProvider\", \"$tgIssuesResourcesProvider\", \"$tgWikiResourcesProvider\", \"$tgSearchResourcesProvider\", \"$tgMdRenderResourcesProvider\", \"$tgHistoryResourcesProvider\", \"$tgKanbanResourcesProvider\", \"$tgModulesResourcesProvider\", \"$tgWebhooksResourcesProvider\", \"$tgWebhookLogsResourcesProvider\", \"$tgLocalesResourcesProvider\", \"$tgUsersResourcesProvider\", initResources]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/search.coffee\n */\n\n(function() {\n  var SearchBoxDirective, SearchController, SearchDirective, bindOnce, debounce, debounceLeading, groupBy, mixOf, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaSearch\", []);\n\n  SearchController = (function(superClass) {\n    extend(SearchController, superClass);\n\n    SearchController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$translate\"];\n\n    function SearchController(scope1, repo, rs, params, q, location, appMetaService, navUrls, translate) {\n      var loadSearchData, promise;\n      this.scope = scope1;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.scope.sectionName = \"Search\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"SEARCH.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"SEARCH.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.searchTerm = null;\n      loadSearchData = debounceLeading(100, (function(_this) {\n        return function(t) {\n          return _this.loadSearchData(t);\n        };\n      })(this));\n      bindOnce(this.scope, \"projectId\", (function(_this) {\n        return function(projectId) {\n          if (!_this.scope.searchResults && _this.scope.searchTerm) {\n            return _this.loadSearchData();\n          }\n        };\n      })(this));\n      this.scope.$watch(\"searchTerm\", (function(_this) {\n        return function(term) {\n          if (term !== void 0 && _this.scope.projectId) {\n            return _this.loadSearchData(term);\n          }\n        };\n      })(this));\n    }\n\n    SearchController.prototype.loadFilters = function() {\n      var defered;\n      defered = this.q.defer();\n      defered.resolve();\n      return defered.promise;\n    };\n\n    SearchController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    SearchController.prototype.loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      this.scope.loading = true;\n      return this._loadSearchData(term).then((function(_this) {\n        return function(data) {\n          _this.scope.searchResults = data;\n          return _this.scope.loading = false;\n        };\n      })(this));\n    };\n\n    SearchController.prototype._loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      if (this._promise) {\n        this._promise.abort();\n      }\n      this._promise = this.rs.search[\"do\"](this.scope.projectId, term);\n      return this._promise;\n    };\n\n    SearchController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          return _this.fillUsersAndRoles(project.members, project.roles);\n        };\n      })(this));\n    };\n\n    return SearchController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"SearchController\", SearchController);\n\n  SearchBoxDirective = function(projectService, $lightboxService, $navurls, $location, $route) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var openLightbox, project, submit;\n      project = null;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, text, url;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          text = $el.find(\"#search-text\").val();\n          url = $navurls.resolve(\"project-search\", {\n            project: project.get(\"slug\")\n          });\n          return $scope.$apply(function() {\n            $lightboxService.close($el);\n            $location.path(url);\n            $location.search(\"text\", text).path(url);\n            return $route.reload();\n          });\n        };\n      })(this));\n      openLightbox = function() {\n        project = projectService.project;\n        return $lightboxService.open($el).then(function() {\n          return $el.find(\"#search-text\").focus();\n        });\n      };\n      $el.on(\"submit\", \"form\", submit);\n      return openLightbox();\n    };\n    return {\n      templateUrl: \"search/lightbox-search.html\",\n      link: link\n    };\n  };\n\n  SearchBoxDirective.$inject = [\"tgProjectService\", \"lightboxService\", \"$tgNavUrls\", \"$tgLocation\", \"$route\"];\n\n  module.directive(\"tgSearchBox\", SearchBoxDirective);\n\n  SearchDirective = function($log, $compile, $templatecache, $routeparams, $location) {\n    var link, linkTable;\n    linkTable = function($scope, $el, $attrs, $ctrl) {\n      var activeSectionName, applyAutoTab, getActiveSection, lastSearchResults, markSectionTabActive, renderFilterTabs, renderTableContent, tabsDom, templates;\n      applyAutoTab = true;\n      activeSectionName = \"userstories\";\n      tabsDom = $el.find(\".search-filter\");\n      lastSearchResults = null;\n      getActiveSection = function(data) {\n        var i, len, maxVal, name, ref, selectedSection, value;\n        maxVal = 0;\n        selectedSection = {};\n        selectedSection.name = \"userstories\";\n        selectedSection.value = [];\n        if (!applyAutoTab) {\n          selectedSection.name = activeSectionName;\n          selectedSection.value = data[activeSectionName];\n          return selectedSection;\n        }\n        if (data) {\n          ref = [\"userstories\", \"issues\", \"tasks\", \"wikipages\"];\n          for (i = 0, len = ref.length; i < len; i++) {\n            name = ref[i];\n            value = data[name];\n            if (value.length > maxVal) {\n              maxVal = value.length;\n              selectedSection.name = name;\n              selectedSection.value = value;\n              break;\n            }\n          }\n        }\n        if (maxVal === 0) {\n          return selectedSection;\n        }\n        return selectedSection;\n      };\n      renderFilterTabs = function(data) {\n        var name, results, value;\n        results = [];\n        for (name in data) {\n          value = data[name];\n          tabsDom.find(\"li.\" + name).show();\n          results.push(tabsDom.find(\"li.\" + name + \" .num\").html(value.length));\n        }\n        return results;\n      };\n      markSectionTabActive = function(section) {\n        tabsDom.find(\"a.active\").removeClass(\"active\");\n        tabsDom.find(\"li.\" + section.name + \" a\").addClass(\"active\");\n        applyAutoTab = false;\n        return activeSectionName = section.name;\n      };\n      templates = {\n        issues: $templatecache.get(\"search-issues\"),\n        tasks: $templatecache.get(\"search-tasks\"),\n        userstories: $templatecache.get(\"search-userstories\"),\n        wikipages: $templatecache.get(\"search-wikipages\")\n      };\n      renderTableContent = function(section) {\n        var element, oldElements, oldScope, scope, template;\n        oldElements = $el.find(\".search-result-table\").children();\n        oldScope = oldElements.scope();\n        if (oldScope) {\n          oldScope.$destroy();\n          oldElements.remove();\n        }\n        scope = $scope.$new();\n        scope[section.name] = section.value;\n        template = angular.element.parseHTML(trim(templates[section.name]));\n        element = $compile(template)(scope);\n        return $el.find(\".search-result-table\").html(element);\n      };\n      $scope.$watch(\"searchResults\", function(data) {\n        var activeSection;\n        lastSearchResults = data;\n        if (!lastSearchResults) {\n          return;\n        }\n        activeSection = getActiveSection(data);\n        renderFilterTabs(data);\n        renderTableContent(activeSection);\n        return markSectionTabActive(activeSection);\n      });\n      $scope.$watch(\"searchTerm\", function(searchTerm) {\n        if (searchTerm !== void 0) {\n          return $location.search(\"text\", searchTerm);\n        }\n      });\n      return $el.on(\"click\", \".search-filter li > a\", function(event) {\n        var section, sectionData, sectionName, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        sectionName = target.parent().data(\"name\");\n        sectionData = !lastSearchResults ? [] : lastSearchResults[sectionName];\n        section = {\n          name: sectionName,\n          value: sectionData\n        };\n        return $scope.$apply(function() {\n          renderTableContent(section);\n          return markSectionTabActive(section);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, searchText;\n      $ctrl = $el.controller();\n      linkTable($scope, $el, $attrs, $ctrl);\n      searchText = $routeparams.text;\n      return $scope.$watch(\"projectId\", function(projectId) {\n        if (projectId != null) {\n          return $scope.searchTerm = searchText;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSearch\", [\"$log\", \"$compile\", \"$templateCache\", \"$routeParams\", \"$tgLocation\", SearchDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTaskboard\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTasks\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTeam\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserSettings\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserStories\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaWiki\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/analytics.coffee\n */\n\n(function() {\n  var AnalyticsService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  AnalyticsService = (function(superClass) {\n    extend(AnalyticsService, superClass);\n\n    AnalyticsService.$inject = [\"$rootScope\", \"$log\", \"$tgConfig\", \"$window\", \"$document\", \"$location\"];\n\n    function AnalyticsService(rootscope, log, config, win, doc, location) {\n      var conf;\n      this.rootscope = rootscope;\n      this.log = log;\n      this.config = config;\n      this.win = win;\n      this.doc = doc;\n      this.location = location;\n      this.initialized = false;\n      conf = this.config.get(\"analytics\", {});\n      this.accountId = conf.accountId;\n      this.pageEvent = conf.pageEvent || \"$routeChangeSuccess\";\n      this.trackRoutes = conf.trackRoutes || true;\n      this.ignoreFirstPageLoad = conf.ignoreFirstPageLoad || false;\n    }\n\n    AnalyticsService.prototype.initialize = function() {\n      if (!this.accountId) {\n        this.log.debug(\"Analytics: no acount id provided. Disabling.\");\n        return;\n      }\n      this.injectAnalytics();\n      this.win.ga(\"create\", this.accountId, \"auto\");\n      this.win.ga(\"require\", \"displayfeatures\");\n      if (this.trackRoutes && (!this.ignoreFirstPageLoad)) {\n        this.win.ga(\"send\", \"pageview\", this.getUrl());\n      }\n      if (this.trackRoutes) {\n        this.rootscope.$on(this.pageEvent, (function(_this) {\n          return function() {\n            return _this.trackPage(_this.getUrl(), \"Taiga\");\n          };\n        })(this));\n      }\n      return this.initialized = true;\n    };\n\n    AnalyticsService.prototype.getUrl = function() {\n      return this.location.path();\n    };\n\n    AnalyticsService.prototype.injectAnalytics = function() {\n      var fn;\n      fn = (function(i,s,o,g,r,a,m){i[\"GoogleAnalyticsObject\"]=r;i[r]=i[r]||function(){\n              (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);});\n      return fn(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n    };\n\n    AnalyticsService.prototype.trackPage = function(url, title) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      title = title || this.doc[0].title;\n      return this.win.ga(\"send\", \"pageview\", {\n        \"page\": url,\n        \"title\": title\n      });\n    };\n\n    AnalyticsService.prototype.trackEvent = function(category, action, label, value) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga(\"send\", \"event\", category, action, label, value);\n    };\n\n    return AnalyticsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAnalytics\", AnalyticsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: bind-scope.coffee\n */\n\n(function() {\n  var BindScope, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  BindScope = function(config) {\n    var link;\n    if (!config.debugInfo) {\n      jQuery.fn.scope = function() {\n        return this.data('scope');\n      };\n    }\n    link = function($scope, $el) {\n      if (!config.debugInfo) {\n        return $el.data('scope', $scope).addClass('tg-scope');\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBindScope\", [\"$tgConfig\", BindScope]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: compile-html.directive.coffee\n */\n\n(function() {\n  var CompileHtmlDirective;\n\n  CompileHtmlDirective = function($compile) {\n    var link;\n    link = function(scope, element, attrs) {\n      return scope.$watch(attrs.tgCompileHtml, function(newValue, oldValue) {\n        element.html(newValue);\n        return $compile(element.contents())(scope);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CompileHtmlDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaCommon\").directive(\"tgCompileHtml\", CompileHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/components.coffee\n */\n\n(function() {\n  var AssignedToDirective, BlockButtonDirective, CreatedByDisplayDirective, DateRangeDirective, DateSelectorDirective, DeleteButtonDirective, EditableDescriptionDirective, EditableSubjectDirective, EditableWysiwyg, ListItemAssignedtoDirective, ListItemIssueStatusDirective, ListItemPriorityDirective, ListItemSeverityDirective, ListItemTaskStatusDirective, ListItemTriggerDirective, ListItemTypeDirective, ListItemUsStatusDirective, SprintProgressBarDirective, TgMainTitleDirective, TgProgressBarDirective, WatchersDirective, bindOnce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  DateRangeDirective = function($translate) {\n    var link, renderRange;\n    renderRange = function($el, first, second) {\n      var endDate, initDate, prettyDate;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      initDate = moment(first).format(prettyDate);\n      endDate = moment(second).format(prettyDate);\n      return $el.html(initDate + \"-\" + endDate);\n    };\n    link = function($scope, $el, $attrs) {\n      var first, ref, second;\n      ref = $attrs.tgDateRange.split(\",\"), first = ref[0], second = ref[1];\n      return bindOnce($scope, first, function(valFirst) {\n        return bindOnce($scope, second, function(valSecond) {\n          return renderRange($el, valFirst, valSecond);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateRange\", [\"$translate\", DateRangeDirective]);\n\n  DateSelectorDirective = function($rootscope, datePickerConfigService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var initialize, selectedDate, unbind;\n      selectedDate = null;\n      initialize = function() {\n        var datePickerConfig;\n        datePickerConfig = datePickerConfigService.get();\n        _.merge(datePickerConfig, {\n          field: $el[0],\n          onSelect: (function(_this) {\n            return function(date) {\n              return selectedDate = date;\n            };\n          })(this),\n          onOpen: (function(_this) {\n            return function() {\n              if (selectedDate != null) {\n                return $el.picker.setDate(selectedDate);\n              }\n            };\n          })(this)\n        });\n        return $el.picker = new Pikaday(datePickerConfig);\n      };\n      unbind = $rootscope.$on(\"$translateChangeEnd\", (function(_this) {\n        return function(ctx) {\n          return initialize();\n        };\n      })(this));\n      $scope.$watch($attrs.ngModel, function(val) {\n        if ((val != null) && !$el.picker) {\n          initialize();\n        }\n        if (val != null) {\n          return $el.picker.setDate(val);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgDateSelector\", [\"$rootScope\", \"tgDatePickerConfigService\", DateSelectorDirective]);\n\n  SprintProgressBarDirective = function() {\n    var link, renderProgress;\n    renderProgress = function($el, percentage, visual_percentage) {\n      if ($el.hasClass(\".current-progress\")) {\n        return $el.css(\"width\", percentage + \"%\");\n      } else {\n        $el.find(\".current-progress\").css(\"width\", visual_percentage + \"%\");\n        return $el.find(\".number\").html(percentage + \" %\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.tgSprintProgressbar, function(sprint) {\n        var closedPoints, percentage, totalPoints, visual_percentage;\n        closedPoints = sprint.closed_points;\n        totalPoints = sprint.total_points;\n        percentage = 0;\n        if (totalPoints !== 0) {\n          percentage = Math.round(100 * (closedPoints / totalPoints));\n        }\n        visual_percentage = 0;\n        if (totalPoints !== 0) {\n          visual_percentage = Math.round(98 * (closedPoints / totalPoints));\n        }\n        return renderProgress($el, percentage, visual_percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintProgressbar\", SprintProgressBarDirective);\n\n  CreatedByDisplayDirective = function($template, $compile, $translate, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        var ref;\n        if (model != null) {\n          $scope.owner = model.owner_extra_info || {\n            full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\"),\n            photo: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n          $scope.url = ((ref = $scope.owner) != null ? ref.is_active : void 0) ? $navUrls.resolve(\"user-profile\", {\n            username: $scope.owner.username\n          }) : \"\";\n          return $scope.date = moment(model.created_date).format($translate.instant(\"COMMON.DATETIME\"));\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true,\n      templateUrl: \"common/components/created-by.html\"\n    };\n  };\n\n  module.directive(\"tgCreatedByDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", CreatedByDisplayDirective]);\n\n  WatchersDirective = function($rootscope, $confirm, $repo, $qqueue, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/watchers.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var deleteWatcher, isEditable, renderWatchers, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(watchers) {\n          var item, promise;\n          item = $model.$modelValue.clone();\n          item.watchers = watchers;\n          $model.$setViewValue(item);\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            watchers = _.map(watchers, function(watcherId) {\n              return $scope.usersById[watcherId];\n            });\n            renderWatchers(watchers);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            $model.$modelValue.revert();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      deleteWatcher = $qqueue.bindAdd((function(_this) {\n        return function(watcherIds) {\n          var item, promise;\n          item = $model.$modelValue.clone();\n          item.watchers = watcherIds;\n          $model.$setViewValue(item);\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            var watchers;\n            watchers = _.map(item.watchers, function(watcherId) {\n              return $scope.usersById[watcherId];\n            });\n            renderWatchers(watchers);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            item.revert();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      renderWatchers = function(watchers) {\n        var ctx, html;\n        ctx = {\n          watchers: watchers,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".js-delete-watcher\", function(event) {\n        var message, target, title, watcherId;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        watcherId = target.data(\"watcher-id\");\n        title = $translate.instant(\"COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER\");\n        message = $scope.usersById[watcherId].full_name_display;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var watcherIds;\n            askResponse.finish();\n            watcherIds = _.clone($model.$modelValue.watchers, false);\n            watcherIds = _.pull(watcherIds, watcherId);\n            return deleteWatcher(watcherIds);\n          };\n        })(this));\n      });\n      $scope.$on(\"watcher:added\", function(ctx, watcherId) {\n        var watchers;\n        watchers = _.clone($model.$modelValue.watchers, false);\n        watchers.push(watcherId);\n        watchers = _.uniq(watchers);\n        return save(watchers);\n      });\n      $scope.$watch($attrs.ngModel, function(item) {\n        var watchers;\n        if (item == null) {\n          return;\n        }\n        watchers = _.map(item.watchers, function(watcherId) {\n          return $scope.usersById[watcherId];\n        });\n        return renderWatchers(watchers);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWatchers\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", \"$translate\", WatchersDirective]);\n\n  AssignedToDirective = function($rootscope, $confirm, $repo, $loading, $qqueue, $template, $translate, $compile, $currentUserService) {\n    var link, template;\n    template = $template.get(\"common/components/assigned-to.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, renderAssignedTo, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(userId) {\n          var currentLoading, promise;\n          $model.$modelValue.assigned_to = userId;\n          currentLoading = $loading().target($el).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            currentLoading.finish();\n            renderAssignedTo($model.$modelValue);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            $model.$modelValue.revert();\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          });\n          return promise;\n        };\n      })(this));\n      renderAssignedTo = function(assignedObject) {\n        var ctx, fullName, html, isIocaine, isUnassigned, photo;\n        if ((assignedObject != null ? assignedObject.assigned_to : void 0) != null) {\n          fullName = assignedObject.assigned_to_extra_info.full_name_display;\n          photo = assignedObject.assigned_to_extra_info.photo;\n          isUnassigned = false;\n        } else {\n          fullName = $translate.instant(\"COMMON.ASSIGNED_TO.ASSIGN\");\n          photo = \"/\" + window._version + \"/images/unnamed.png\";\n          isUnassigned = true;\n        }\n        isIocaine = assignedObject != null ? assignedObject.is_iocaine : void 0;\n        ctx = {\n          fullName: fullName,\n          photo: photo,\n          isUnassigned: isUnassigned,\n          isEditable: isEditable(),\n          isIocaine: isIocaine,\n          fullNameVisible: !(isUnassigned && !$currentUserService.isAuthenticated())\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".user-assigned\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"assigned-to:add\", $model.$modelValue);\n        });\n      });\n      $el.on(\"click\", \".assign-to-me\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        $model.$modelValue.assigned_to = $currentUserService.getUser().get('id');\n        return save($currentUserService.getUser().get('id'));\n      });\n      $el.on(\"click\", \".icon-delete\", function(event) {\n        var title;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        title = $translate.instant(\"COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED\");\n        return $confirm.ask(title).then((function(_this) {\n          return function(response) {\n            response.finish();\n            $model.$modelValue.assigned_to = null;\n            return save(null);\n          };\n        })(this));\n      });\n      $scope.$on(\"assigned-to:added\", function(ctx, userId, item) {\n        if (item.id !== $model.$modelValue.id) {\n          return;\n        }\n        return save(userId);\n      });\n      $scope.$watch($attrs.ngModel, function(instance) {\n        return renderAssignedTo(instance);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgAssignedTo\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$translate\", \"$compile\", \"tgCurrentUserService\", AssignedToDirective]);\n\n  BlockButtonDirective = function($rootscope, $loading, $template) {\n    var link, template;\n    template = $template.get(\"common/components/block-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      $scope.$watch($attrs.ngModel, function(item) {\n        if (!item) {\n          return;\n        }\n        if (isEditable()) {\n          $el.find('.item-block').addClass('editable');\n        }\n        if (item.is_blocked) {\n          $el.find('.item-block').removeClass('is-active');\n          return $el.find('.item-unblock').addClass('is-active');\n        } else {\n          $el.find('.item-block').addClass('is-active');\n          return $el.find('.item-unblock').removeClass('is-active');\n        }\n      });\n      $el.on(\"click\", \".item-block\", function(event) {\n        event.preventDefault();\n        return $rootscope.$broadcast(\"block\", $model.$modelValue);\n      });\n      $el.on(\"click\", \".item-unblock\", function(event) {\n        var currentLoading, finish;\n        event.preventDefault();\n        currentLoading = $loading().target($el.find(\".item-unblock\")).start();\n        finish = function() {\n          return currentLoading.finish();\n        };\n        return $rootscope.$broadcast(\"unblock\", $model.$modelValue, finish);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgBlockButton\", [\"$rootScope\", \"$tgLoading\", \"$tgTemplate\", BlockButtonDirective]);\n\n  DeleteButtonDirective = function($log, $repo, $confirm, $location, $template) {\n    var link, template;\n    template = $template.get(\"common/components/delete-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.onDeleteGoToUrl) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-go-to-url set in scope.\");\n      }\n      if (!$attrs.onDeleteTitle) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-title set in scope.\");\n      }\n      $el.on(\"click\", \".button-delete\", function(event) {\n        var subtitle, title;\n        title = $attrs.onDeleteTitle;\n        subtitle = $model.$modelValue.subject;\n        return $confirm.askOnDelete(title, subtitle).then((function(_this) {\n          return function(askResponse) {\n            var promise;\n            promise = $repo.remove($model.$modelValue);\n            promise.then(function() {\n              var url;\n              askResponse.finish();\n              url = $scope.$eval($attrs.onDeleteGoToUrl);\n              return $location.path(url);\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgDeleteButton\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgTemplate\", DeleteButtonDirective]);\n\n  EditableSubjectDirective = function($rootscope, $repo, $confirm, $loading, $qqueue, $template) {\n    var link, template;\n    template = $template.get(\"common/components/editable-subject.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-subject').hide();\n        return $el.find('.view-subject').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(subject) {\n          var currentLoading, promise;\n          $model.$modelValue.subject = subject;\n          currentLoading = $loading().target($el.find('.save-container')).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-subject').hide();\n            return $el.find('.view-subject').show();\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n          return promise;\n        };\n      })(this));\n      $el.click(function() {\n        if (!isEditable()) {\n          return;\n        }\n        $el.find('.edit-subject').show();\n        $el.find('.view-subject').hide();\n        return $el.find('input').focus();\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var subject;\n        e.preventDefault();\n        subject = $scope.item.subject;\n        return save(subject);\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var subject;\n        if (event.keyCode === 13) {\n          subject = $scope.item.subject;\n          return save(subject);\n        } else if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $model.$modelValue.revert();\n            };\n          })(this));\n          $el.find('div.edit-subject').hide();\n          return $el.find('div.view-subject').show();\n        }\n      });\n      $el.find('div.edit-subject').hide();\n      $el.find('div.view-subject span.edit').hide();\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (!isEditable()) {\n          return $el.find('.view-subject .edit').remove();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableSubject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", EditableSubjectDirective]);\n\n  EditableDescriptionDirective = function($rootscope, $repo, $confirm, $compile, $loading, $selectedText, $qqueue, $template) {\n    var link, noDescriptionMegEditMode, noDescriptionMegReadMode, template;\n    template = $template.get(\"common/components/editable-description.html\");\n    noDescriptionMegEditMode = $template.get(\"common/components/editable-description-msg-edit-mode.html\");\n    noDescriptionMegReadMode = $template.get(\"common/components/editable-description-msg-read-mode.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $el.find('.edit-description').hide();\n      $el.find('.view-description .edit').hide();\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(description) {\n          var currentLoading, promise;\n          $model.$modelValue.description = description;\n          currentLoading = $loading().target($el.find('.save-container')).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-description').hide();\n            return $el.find('.view-description').show();\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          return promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n      $el.on(\"mouseup\", \".view-description\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        $el.find('.edit-description').show();\n        $el.find('.view-description').hide();\n        return $el.find('textarea').focus();\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var description;\n        e.preventDefault();\n        description = $scope.item.description;\n        return save(description);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $scope.item.revert();\n            };\n          })(this));\n          $el.find('.edit-description').hide();\n          return $el.find('.view-description').show();\n        }\n      });\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (isEditable()) {\n          $el.find('.view-description .edit').show();\n          $el.find('.view-description .us-content').addClass('editable');\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegEditMode)($scope);\n        } else {\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegReadMode)($scope);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableDescription\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", \"$tgLoading\", \"$selectedText\", \"$tgQqueue\", \"$tgTemplate\", EditableDescriptionDirective]);\n\n  EditableWysiwyg = function(attachmentsService, attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var isInEditMode, uploadFile;\n      isInEditMode = function() {\n        return $el.find('textarea').is(':visible');\n      };\n      uploadFile = function(file, type) {\n        if (!attachmentsService.validate(file)) {\n          return;\n        }\n        return attachmentsFullService.addAttachment($model.$modelValue.project, $model.$modelValue.id, type, file).then(function(result) {\n          if (taiga.isImage(result.getIn(['file', 'name']))) {\n            return '![' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          } else {\n            return '[' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          }\n        });\n      };\n      $el.on('dragover', function(e) {\n        var textarea;\n        textarea = $el.find('textarea').focus();\n        return false;\n      });\n      return $el.on('drop', function(e) {\n        var dataTransfer, promises, textarea, type;\n        e.stopPropagation();\n        e.preventDefault();\n        if (isInEditMode()) {\n          dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n          textarea = $el.find('textarea');\n          textarea.addClass('in-progress');\n          type = $model.$modelValue['_name'];\n          if (type === \"userstories\") {\n            type = \"us\";\n          } else if (type === \"tasks\") {\n            type = \"task\";\n          } else if (type === \"issues\") {\n            type = \"issue\";\n          } else if (type === \"wiki\") {\n            type = \"wiki_page\";\n          }\n          promises = _.map(dataTransfer.files, function(file) {\n            return uploadFile(file, type);\n          });\n          return Promise.all(promises).then(function(result) {\n            textarea = $el.find('textarea');\n            $.markItUp({\n              replaceWith: result.join(' ')\n            });\n            return textarea.removeClass('in-progress');\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEditableWysiwyg\", [\"tgAttachmentsService\", \"tgAttachmentsFullService\", EditableWysiwyg]);\n\n  ListItemUsStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var us;\n      us = $scope.$eval($attrs.tgListitemUsStatus);\n      return bindOnce($scope, \"usStatusById\", function(usStatusById) {\n        return $el.html(usStatusById[us.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemUsStatus\", ListItemUsStatusDirective);\n\n  ListItemTaskStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var task;\n      task = $scope.$eval($attrs.tgListitemTaskStatus);\n      return bindOnce($scope, \"taskStatusById\", function(taskStatusById) {\n        return $el.html(taskStatusById[task.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTaskStatus\", ListItemTaskStatusDirective);\n\n  ListItemAssignedtoDirective = function($template, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/list-item-assigned-to-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"usersById\", function(usersById) {\n        var ctx, item, member;\n        item = $scope.$eval($attrs.tgListitemAssignedto);\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = usersById[item.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        return $el.html(template(ctx));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemAssignedto\", [\"$tgTemplate\", \"$translate\", ListItemAssignedtoDirective]);\n\n  ListItemIssueStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemIssueStatus);\n      return bindOnce($scope, \"issueStatusById\", function(issueStatusById) {\n        return $el.html(issueStatusById[issue.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemIssueStatus\", ListItemIssueStatusDirective);\n\n  ListItemTypeDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issueTypeById, issue) {\n        var domNode, type;\n        type = issueTypeById[issue.type];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", type.color);\n        return domNode.attr(\"title\", type.name);\n      };\n      bindOnce($scope, \"issueTypeById\", function(issueTypeById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemType);\n        return render(issueTypeById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemType, function(issue) {\n        return render($scope.issueTypeById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemType\", ListItemTypeDirective);\n\n  ListItemPriorityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(priorityById, issue) {\n        var domNode, priority;\n        priority = priorityById[issue.priority];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", priority.color);\n        return domNode.attr(\"title\", priority.name);\n      };\n      bindOnce($scope, \"priorityById\", function(priorityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemPriority);\n        return render(priorityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemPriority, function(issue) {\n        return render($scope.priorityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemPriority\", ListItemPriorityDirective);\n\n  ListItemSeverityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(severityById, issue) {\n        var domNode, severity;\n        severity = severityById[issue.severity];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", severity.color);\n        return domNode.attr(\"title\", severity.name);\n      };\n      bindOnce($scope, \"severityById\", function(severityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemSeverity);\n        return render(severityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemSeverity, function(issue) {\n        return render($scope.severityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemSeverity\", ListItemSeverityDirective);\n\n  ListItemTriggerDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemTrigger);\n      return bindOnce($scope, \"triggerById\", function(triggerById) {\n        return $el.html(triggerById[issue.trigger].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTrigger\", ListItemTriggerDirective);\n\n  TgProgressBarDirective = function($template) {\n    var link, render, template;\n    template = $template.get(\"common/components/progress-bar.html\", true);\n    render = function(el, percentage) {\n      return el.html(template({\n        percentage: percentage\n      }));\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgProgressBar, function(percentage) {\n        percentage = _.max([0, percentage]);\n        percentage = _.min([100, percentage]);\n        return render($el, percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProgressBar\", [\"$tgTemplate\", TgProgressBarDirective]);\n\n  TgMainTitleDirective = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $attrs.$observe(\"i18nSectionName\", function(i18nSectionName) {\n        return $scope.sectionName = i18nSectionName;\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/main-title.html\",\n      scope: {\n        projectName: \"=projectName\"\n      }\n    };\n  };\n\n  module.directive(\"tgMainTitle\", [\"$translate\", TgMainTitleDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/confirm.coffee\n */\n\n(function() {\n  var ConfirmService, NOTIFICATION_MSG, bindMethods, cancelTimeout, debounce, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  timeout = this.taiga.timeout;\n\n  cancelTimeout = this.taiga.cancelTimeout;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  NOTIFICATION_MSG = {\n    \"success\": {\n      title: \"NOTIFICATION.OK\",\n      message: \"NOTIFICATION.SAVED\"\n    },\n    \"error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    },\n    \"light-error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    }\n  };\n\n  ConfirmService = (function(superClass) {\n    extend(ConfirmService, superClass);\n\n    ConfirmService.$inject = [\"$q\", \"lightboxService\", \"$tgLoading\", \"$translate\"];\n\n    function ConfirmService(q, lightboxService, loading, translate) {\n      this.q = q;\n      this.lightboxService = lightboxService;\n      this.loading = loading;\n      this.translate = translate;\n      bindMethods(this);\n    }\n\n    ConfirmService.prototype.hide = function(el) {\n      if (el) {\n        this.lightboxService.close(el);\n        return el.off(\".confirm-dialog\");\n      }\n    };\n\n    ConfirmService.prototype.ask = function(title, subtitle, message, lightboxSelector) {\n      var defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-generic-ask\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\"h2.title\").text(title);\n      el.find(\"span.subtitle\").text(subtitle);\n      el.find(\"span.message\").text(message);\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \"a.button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.askOnDelete = function(title, message) {\n      return this.ask(title, this.translate.instant(\"NOTIFICATION.ASK_DELETE\"), message);\n    };\n\n    ConfirmService.prototype.askChoice = function(title, subtitle, choices, replacement, warning, lightboxSelector) {\n      var choicesField, defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-ask-choice\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      if (replacement) {\n        el.find(\".replacement\").text(replacement);\n      } else {\n        el.find(\".replacement\").remove();\n      }\n      if (warning) {\n        el.find(\".warning\").text(warning);\n      } else {\n        el.find(\".warning\").remove();\n      }\n      choicesField = el.find(\".choices\");\n      choicesField.html('');\n      _.each(choices, function(value, key) {\n        value = _.escape(value);\n        return choicesField.append(angular.element(\"<option value='\" + key + \"'>\" + value + \"</option>\"));\n      });\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            selected: choicesField.val(),\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \"a.button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.error = function(message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-error\");\n      el.find(\"h2.title\").html(message);\n      el.on(\"click.confirm-dialog\", \"a.button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \"a.close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.success = function(title, message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-success\");\n      if (title) {\n        el.find(\"h2.title\").html(title);\n      }\n      if (message) {\n        el.find(\"p.message\").html(message);\n      }\n      el.on(\"click.confirm-dialog\", \"a.button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \"a.close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.loader = function(title, message) {\n      var el;\n      el = angular.element(\".lightbox-generic-loading\");\n      if (title) {\n        el.find(\"h2.title\").html(title);\n      }\n      if (message) {\n        el.find(\"p.message\").html(message);\n      }\n      return {\n        start: (function(_this) {\n          return function() {\n            return _this.lightboxService.open(el);\n          };\n        })(this),\n        stop: (function(_this) {\n          return function() {\n            return _this.lightboxService.close(el);\n          };\n        })(this),\n        update: (function(_this) {\n          return function(status, title, message, percent) {\n            if (title) {\n              el.find(\"h2.title\").html(title);\n            }\n            if (message) {\n              el.find(\"p.message\").html(message);\n            }\n            if (percent) {\n              el.find(\".spin\").addClass(\"hidden\");\n              el.find(\".progress-bar-wrapper\").removeClass(\"hidden\");\n              el.find(\".progress-bar-wrapper > .bar\").width(percent + '%');\n              return el.find(\".progress-bar-wrapper > span\").html(percent + '%').css('left', (percent - 9) + '%');\n            } else {\n              el.find(\".spin\").removeClass(\"hidden\");\n              return el.find(\".progress-bar-wrapper\").addClass(\"hidden\");\n            }\n          };\n        })(this)\n      };\n    };\n\n    ConfirmService.prototype.notify = function(type, message, title, time) {\n      var body, el, selector;\n      selector = \".notification-message-\" + type;\n      el = angular.element(selector);\n      if (el.hasClass(\"active\")) {\n        return;\n      }\n      if (title) {\n        el.find(\"h4\").html(title);\n      } else {\n        el.find(\"h4\").html(this.translate.instant(NOTIFICATION_MSG[type].title));\n      }\n      if (message) {\n        el.find(\"p\").html(message);\n      } else {\n        el.find(\"p\").html(this.translate.instant(NOTIFICATION_MSG[type].message));\n      }\n      body = angular.element(\"body\");\n      body.find(\".notification-message .notification-light\").removeClass('active').addClass('inactive');\n      body.find(selector).removeClass('inactive').addClass('active');\n      if (this.tsem) {\n        cancelTimeout(this.tsem);\n      }\n      if (!time) {\n        time = type === 'error' || type === 'light-error' ? 3500 : 1500;\n      }\n      this.tsem = timeout(time, (function(_this) {\n        return function() {\n          body.find(selector).removeClass('active').addClass('inactive');\n          return delete _this.tsem;\n        };\n      })(this));\n      return el.on(\"click\", \".icon-delete, .close\", (function(_this) {\n        return function(event) {\n          return body.find(selector).removeClass('active').addClass('inactive');\n        };\n      })(this));\n    };\n\n    return ConfirmService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaCommon\");\n\n  module.service(\"$tgConfirm\", ConfirmService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/custom-field-values.coffee\n */\n\n(function() {\n  var CustomAttributeValueDirective, CustomAttributesValuesController, CustomAttributesValuesDirective, DATE_TYPE, MULTILINE_TYPE, SELECT_TYPE, TEXT_TYPE, TYPE_CHOICES, bindMethods, bindOnce, debounce, generateHash, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = this.taiga.bindMethods;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  generateHash = taiga.generateHash;\n\n  module = angular.module(\"taigaCommon\");\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  SELECT_TYPE = \"select\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: SELECT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_SELECT\"\n    }\n  ];\n\n  CustomAttributesValuesController = (function(superClass) {\n    extend(CustomAttributesValuesController, superClass);\n\n    CustomAttributesValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\"];\n\n    function CustomAttributesValuesController(scope, rootscope, repo, rs, confirm, q) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.customAttributes = [];\n      this.customAttributesValues = null;\n    }\n\n    CustomAttributesValuesController.prototype.initialize = function(type, objectId) {\n      this.project = this.scope.project;\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    CustomAttributesValuesController.prototype.loadCustomAttributesValues = function() {\n      if (!this.objectId) {\n        return this.customAttributesValues;\n      }\n      return this.rs.customAttributesValues[this.type].get(this.objectId).then((function(_this) {\n        return function(customAttributesValues) {\n          _this.customAttributes = _this.project[_this.type + \"_custom_attributes\"];\n          _this.customAttributesValues = customAttributesValues;\n          return customAttributesValues;\n        };\n      })(this));\n    };\n\n    CustomAttributesValuesController.prototype.getAttributeValue = function(attribute) {\n      var attributeValue;\n      attributeValue = _.clone(attribute, false);\n      attributeValue.value = this.customAttributesValues.attributes_values[attribute.id];\n      return attributeValue;\n    };\n\n    CustomAttributesValuesController.prototype.updateAttributeValue = function(attributeValue) {\n      var attributesValues, onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"custom-attributes-values:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      attributesValues = _.clone(this.customAttributesValues.attributes_values, true);\n      attributesValues[attributeValue.id] = attributeValue.value;\n      this.customAttributesValues.attributes_values = attributesValues;\n      this.customAttributesValues.id = this.objectId;\n      return this.repo.save(this.customAttributesValues).then(onSuccess, onError);\n    };\n\n    return CustomAttributesValuesController;\n\n  })(taiga.Controller);\n\n  CustomAttributesValuesDirective = function($templates, $storage) {\n    var collapsedHash, link, template, templateFn;\n    template = $templates.get(\"custom-attributes/custom-attributes-values.html\", true);\n    collapsedHash = function(type) {\n      return generateHash([\"custom-attributes-collapsed\", type]);\n    };\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadCustomAttributesValues();\n      });\n      $el.on(\"click\", \".custom-fields-header a\", function() {\n        var collapsed, hash;\n        hash = collapsedHash($attrs.type);\n        collapsed = !($storage.get(hash) || false);\n        $storage.set(hash, collapsed);\n        if (collapsed) {\n          $el.find(\".custom-fields-header a\").removeClass(\"open\");\n          return $el.find(\".custom-fields-body\").removeClass(\"open\");\n        } else {\n          $el.find(\".custom-fields-header a\").addClass(\"open\");\n          return $el.find(\".custom-fields-body\").addClass(\"open\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      var collapsed;\n      collapsed = $storage.get(collapsedHash($attrs.type)) || false;\n      return template({\n        requiredEditionPerm: $attrs.requiredEditionPerm,\n        collapsed: collapsed\n      });\n    };\n    return {\n      require: [\"tgCustomAttributesValues\", \"ngModel\"],\n      controller: CustomAttributesValuesController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgCustomAttributesValues\", [\"$tgTemplate\", \"$tgStorage\", \"$translate\", CustomAttributesValuesDirective]);\n\n  CustomAttributeValueDirective = function($template, $selectedText, $compile, $translate, datePickerConfigService) {\n    var link, template, templateEdit;\n    template = $template.get(\"custom-attributes/custom-attribute-value.html\", true);\n    templateEdit = $template.get(\"custom-attributes/custom-attribute-value-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attributeValue, isEditable, prettyDate, render, setFocusAndSelectOnInputField, submit;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      render = function(attributeValue, edit) {\n        var ctx, datePickerConfig, editable, html, value;\n        if (edit == null) {\n          edit = false;\n        }\n        if (attributeValue.type === DATE_TYPE && attributeValue.value) {\n          value = moment(attributeValue.value, \"YYYY-MM-DD\").format(prettyDate);\n        } else {\n          value = attributeValue.value;\n        }\n        editable = isEditable();\n        ctx = {\n          id: attributeValue.id,\n          name: attributeValue.name,\n          description: attributeValue.description,\n          value: value,\n          isEditable: editable,\n          type: attributeValue.type\n        };\n        if (editable && (edit || !value)) {\n          html = templateEdit(ctx);\n          html = $compile(html)($scope);\n          $el.html(html);\n          if (attributeValue.type === DATE_TYPE) {\n            datePickerConfig = datePickerConfigService.get();\n            _.merge(datePickerConfig, {\n              field: $el.find(\"input[name=value]\")[0],\n              onSelect: (function(_this) {\n                return function(date) {\n                  var selectedDate;\n                  return selectedDate = date;\n                };\n              })(this),\n              onOpen: (function(_this) {\n                return function() {\n                  if (typeof selectedDate !== \"undefined\" && selectedDate !== null) {\n                    return $el.picker.setDate(selectedDate);\n                  }\n                };\n              })(this)\n            });\n            return $el.picker = new Pikaday(datePickerConfig);\n          }\n        } else {\n          html = template(ctx);\n          html = $compile(html)($scope);\n          return $el.html(html);\n        }\n      };\n      isEditable = function() {\n        var permissions, requiredEditionPerm;\n        permissions = $scope.project.my_permissions;\n        requiredEditionPerm = $attrs.requiredEditionPerm;\n        return permissions.indexOf(requiredEditionPerm) > -1;\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          attributeValue.value = $el.find(\"input[name=value], textarea[name='value'], select[name='value']\").val();\n          if (attributeValue.type === DATE_TYPE) {\n            if (moment(attributeValue.value, prettyDate).isValid()) {\n              attributeValue.value = moment(attributeValue.value, prettyDate).format(\"YYYY-MM-DD\");\n            } else {\n              attributeValue.value = \"\";\n            }\n          }\n          return $scope.$apply(function() {\n            return $ctrl.updateAttributeValue(attributeValue).then(function() {\n              return render(attributeValue, false);\n            });\n          });\n        };\n      })(this));\n      setFocusAndSelectOnInputField = function() {\n        return $el.find(\"input[name='value'], textarea[name='value'], select[name='value']\").focus().select();\n      };\n      attributeValue = $scope.$eval($attrs.tgCustomAttributeValue);\n      render(attributeValue);\n      $el.on(\"click\", \".js-value-view-mode\", function() {\n        if (!isEditable()) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"click\", \"a.icon-edit\", function(event) {\n        event.preventDefault();\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"keyup\", \"input[name=value], textarea[name='value'], select[name='value']\", function(event) {\n        if (event.keyCode === 13 && event.currentTarget.type !== \"textarea\" && event.currentTarget.type !== \"select\") {\n          return submit(event);\n        } else if (event.keyCode === 27) {\n          return render(attributeValue, false);\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \"a.icon-floppy\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"^tgCustomAttributesValues\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgCustomAttributeValue\", [\"$tgTemplate\", \"$selectedText\", \"$compile\", \"$translate\", \"tgDatePickerConfigService\", CustomAttributeValueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/estimation.coffee\n */\n\n(function() {\n  var EstimationsService, LbUsEstimationDirective, UsEstimationDirective, groupBy, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaCommon\");\n\n  LbUsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return $scope.$apply(function() {\n              return $model.$setViewValue(us);\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", LbUsEstimationDirective]);\n\n  UsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $qqueue, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return this.save(roleId, pointId).then(function() {\n              return $rootScope.$broadcast(\"object:updated\");\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsEstimationDirective]);\n\n  EstimationsService = function($template, $qqueue, $repo, $confirm, $q) {\n    var EstimationProcess, create, pointsTemplate;\n    pointsTemplate = $template.get(\"common/estimation/us-estimation-points.html\", true);\n    EstimationProcess = (function() {\n      function EstimationProcess($el1, us1, project1) {\n        this.$el = $el1;\n        this.us = us1;\n        this.project = project1;\n        this.bindClickEvents = bind(this.bindClickEvents, this);\n        this.isEditable = this.project.my_permissions.indexOf(\"modify_us\") !== -1;\n        this.roles = this.project.roles;\n        this.points = this.project.points;\n        this.pointsById = groupBy(this.points, function(x) {\n          return x.id;\n        });\n        this.onSelectedPointForRole = function(roleId, pointId) {};\n        this.render = function() {};\n      }\n\n      EstimationProcess.prototype.save = function(roleId, pointId) {\n        var deferred;\n        deferred = $q.defer();\n        $qqueue.add((function(_this) {\n          return function() {\n            var onError, onSuccess;\n            onSuccess = function() {\n              return deferred.resolve();\n            };\n            onError = function() {\n              $confirm.notify(\"error\");\n              _this.us.revert();\n              _this.render();\n              return deferred.reject();\n            };\n            return $repo.save(_this.us).then(onSuccess, onError);\n          };\n        })(this));\n        return deferred.promise;\n      };\n\n      EstimationProcess.prototype.calculateTotalPoints = function() {\n        var notNullValues, values;\n        values = _.map(this.us.points, (function(_this) {\n          return function(v, k) {\n            var ref;\n            return (ref = _this.pointsById[v]) != null ? ref.value : void 0;\n          };\n        })(this));\n        if (values.length === 0) {\n          return \"?\";\n        }\n        notNullValues = _.filter(values, function(v) {\n          return v != null;\n        });\n        if (notNullValues.length === 0) {\n          return \"?\";\n        }\n        return _.reduce(notNullValues, function(acc, num) {\n          return acc + num;\n        });\n      };\n\n      EstimationProcess.prototype.calculateRoles = function() {\n        var computableRoles, roles;\n        computableRoles = _.filter(this.project.roles, \"computable\");\n        roles = _.map(computableRoles, (function(_this) {\n          return function(role) {\n            var pointId, pointObj;\n            pointId = _this.us.points[role.id];\n            pointObj = _this.pointsById[pointId];\n            role = _.clone(role, true);\n            role.points = (pointObj != null) && (pointObj.name != null) ? pointObj.name : \"?\";\n            return role;\n          };\n        })(this));\n        return roles;\n      };\n\n      EstimationProcess.prototype.bindClickEvents = function() {\n        this.$el.on(\"click\", \".total.clickable\", (function(_this) {\n          return function(event) {\n            var roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            _this.renderPointsSelector(roleId, target);\n            target.siblings().removeClass('active');\n            return target.addClass('active');\n          };\n        })(this));\n        return this.$el.on(\"click\", \".point\", (function(_this) {\n          return function(event) {\n            var pointId, points, roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            pointId = target.data(\"point-id\");\n            _this.$el.find(\".popover\").popover().close();\n            points = _.clone(_this.us.points, true);\n            points[roleId] = pointId;\n            _this.us.points = points;\n            _this.render();\n            return _this.onSelectedPointForRole(roleId, pointId);\n          };\n        })(this));\n      };\n\n      EstimationProcess.prototype.renderPointsSelector = function(roleId, target) {\n        var horizontalList, html, maxPointLength, points, pop;\n        points = _.map(this.points, (function(_this) {\n          return function(point) {\n            point = _.clone(point, true);\n            point.selected = _this.us.points[roleId] === point.id ? false : true;\n            return point;\n          };\n        })(this));\n        maxPointLength = 5;\n        horizontalList = _.some(points, (function(_this) {\n          return function(point) {\n            return point.name.length > maxPointLength;\n          };\n        })(this));\n        html = pointsTemplate({\n          \"points\": points,\n          roleId: roleId,\n          horizontal: horizontalList\n        });\n        this.$el.find(\".popover\").popover().close();\n        this.$el.find(\".pop-points-open\").remove();\n        if (target != null) {\n          this.$el.find(target).append(html);\n        } else {\n          this.$el.append(html);\n        }\n        this.$el.find(\".pop-points-open\").popover().open(function() {\n          return $(this).removeClass(\"active\").closest(\"li\").removeClass(\"active\");\n        });\n        this.$el.find(\".pop-points-open\").show();\n        pop = this.$el.find(\".pop-points-open\");\n        if (pop.offset().top + pop.height() > document.body.clientHeight) {\n          return pop.addClass('pop-bottom');\n        }\n      };\n\n      return EstimationProcess;\n\n    })();\n    create = function($el, us, project) {\n      var estimationProcess;\n      $el.unbind(\"click\");\n      estimationProcess = new EstimationProcess($el, us, project);\n      if (estimationProcess.isEditable) {\n        estimationProcess.bindClickEvents();\n      }\n      return estimationProcess;\n    };\n    return {\n      create: create\n    };\n  };\n\n  module.factory(\"$tgEstimationsService\", [\"$tgTemplate\", \"$tgQqueue\", \"$tgRepo\", \"$tgConfirm\", \"$q\", EstimationsService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/filters.coffee\n */\n\n(function() {\n  var defaultFilter, module, momentFormat, momentFromNow, sizeFormat, taiga, unslugify, yesNoFilter;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  defaultFilter = function() {\n    return function(value, defaultValue) {\n      if (value === [null, void 0]) {\n        return defaultValue;\n      }\n      return value;\n    };\n  };\n\n  module.filter(\"default\", defaultFilter);\n\n  yesNoFilter = function($translate) {\n    return function(value) {\n      if (value) {\n        return $translate.instant(\"COMMON.YES\");\n      }\n      return $translate.instant(\"COMMON.NO\");\n    };\n  };\n\n  module.filter(\"yesNo\", [\"$translate\", yesNoFilter]);\n\n  unslugify = function() {\n    return taiga.unslugify;\n  };\n\n  module.filter(\"unslugify\", unslugify);\n\n  momentFormat = function() {\n    return function(input, format) {\n      if (input) {\n        return moment(input).format(format);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFormat\", momentFormat);\n\n  momentFromNow = function() {\n    return function(input, without_suffix) {\n      if (input) {\n        return moment(input).fromNow(without_suffix || false);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFromNow\", momentFromNow);\n\n  sizeFormat = (function(_this) {\n    return function() {\n      return _this.taiga.sizeFormat;\n    };\n  })(this);\n\n  module.filter(\"sizeFormat\", sizeFormat);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/history.coffee\n */\n\n(function() {\n  var HistoryController, HistoryDirective, IGNORED_FIELDS, bindOnce, debounce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  IGNORED_FIELDS = {\n    \"userstories.userstory\": [\"watchers\", \"kanban_order\", \"backlog_order\", \"sprint_order\", \"finish_date\", \"tribe_gig\"],\n    \"tasks.task\": [\"watchers\", \"us_order\", \"taskboard_order\"],\n    \"issues.issue\": [\"watchers\"]\n  };\n\n  HistoryController = (function(superClass) {\n    extend(HistoryController, superClass);\n\n    HistoryController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\"];\n\n    function HistoryController(scope, repo, rs) {\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n    }\n\n    HistoryController.prototype.initialize = function(type, objectId) {\n      this.type = type;\n      return this.objectId = objectId;\n    };\n\n    HistoryController.prototype.loadHistory = function(type, objectId) {\n      return this.rs.history.get(type, objectId).then((function(_this) {\n        return function(history) {\n          var changeModel, historyEntry, historyResult, i, j, len, len1;\n          for (i = 0, len = history.length; i < len; i++) {\n            historyResult = history[i];\n            if (historyResult.values_diff.description_diff != null) {\n              historyResult.values_diff.description = historyResult.values_diff.description_diff;\n            }\n            delete historyResult.values_diff.description_html;\n            delete historyResult.values_diff.description_diff;\n            if (historyResult.values_diff.blocked_note_diff != null) {\n              historyResult.values_diff.blocked_note = historyResult.values_diff.blocked_note_diff;\n            }\n            delete historyResult.values_diff.blocked_note_html;\n            delete historyResult.values_diff.blocked_note_diff;\n          }\n          for (j = 0, len1 = history.length; j < len1; j++) {\n            historyEntry = history[j];\n            changeModel = historyEntry.key.split(\":\")[0];\n            if (IGNORED_FIELDS[changeModel] != null) {\n              historyEntry.values_diff = _.removeKeys(historyEntry.values_diff, IGNORED_FIELDS[changeModel]);\n            }\n          }\n          _this.scope.history = _.filter(history, function(item) {\n            return Object.keys(item.values_diff).length > 0;\n          });\n          return _this.scope.comments = _.filter(history, function(item) {\n            return item.comment !== \"\";\n          });\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.deleteComment = function(type, objectId, activityId) {\n      return this.rs.history.deleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.undeleteComment = function(type, objectId, activityId) {\n      return this.rs.history.undeleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    return HistoryController;\n\n  })(taiga.Controller);\n\n  HistoryDirective = function($log, $loading, $qqueue, $template, $confirm, $translate, $compile, $navUrls, $rootScope, checkPermissionsService) {\n    var link, templateActivity, templateBase, templateBaseEntries, templateChangeAttachment, templateChangeDiff, templateChangeGeneric, templateChangeList, templateChangePoints, templateDeletedComment;\n    templateChangeDiff = $template.get(\"common/history/history-change-diff.html\", true);\n    templateChangePoints = $template.get(\"common/history/history-change-points.html\", true);\n    templateChangeGeneric = $template.get(\"common/history/history-change-generic.html\", true);\n    templateChangeAttachment = $template.get(\"common/history/history-change-attachment.html\", true);\n    templateChangeList = $template.get(\"common/history/history-change-list.html\", true);\n    templateDeletedComment = $template.get(\"common/history/history-deleted-comment.html\", true);\n    templateActivity = $template.get(\"common/history/history-activity.html\", true);\n    templateBaseEntries = $template.get(\"common/history/history-base-entries.html\", true);\n    templateBase = $template.get(\"common/history/history-base.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var countChanges, formatChange, getHumanizedFieldName, getPrettyDateFormat, objectId, renderActivity, renderAttachmentEntry, renderBase, renderChange, renderChangeEntries, renderChangeEntry, renderChangesHelperText, renderComment, renderComments, renderCustomAttributesEntry, renderHistory, rerender, save, showAllActivity, showAllComments, type;\n      type = $attrs.type;\n      objectId = null;\n      showAllComments = false;\n      showAllActivity = false;\n      getPrettyDateFormat = function() {\n        return $translate.instant(\"ACTIVITY.DATETIME\");\n      };\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        type = $attrs.type;\n        objectId = model.id;\n        $ctrl.initialize(type, objectId);\n        return $ctrl.loadHistory(type, objectId);\n      });\n      getHumanizedFieldName = function(field) {\n        var humanizedFieldNames;\n        humanizedFieldNames = {\n          subject: $translate.instant(\"ACTIVITY.FIELDS.SUBJECT\"),\n          name: $translate.instant(\"ACTIVITY.FIELDS.NAME\"),\n          description: $translate.instant(\"ACTIVITY.FIELDS.DESCRIPTION\"),\n          content: $translate.instant(\"ACTIVITY.FIELDS.CONTENT\"),\n          status: $translate.instant(\"ACTIVITY.FIELDS.STATUS\"),\n          is_closed: $translate.instant(\"ACTIVITY.FIELDS.IS_CLOSED\"),\n          finish_date: $translate.instant(\"ACTIVITY.FIELDS.FINISH_DATE\"),\n          type: $translate.instant(\"ACTIVITY.FIELDS.TYPE\"),\n          priority: $translate.instant(\"ACTIVITY.FIELDS.PRIORITY\"),\n          severity: $translate.instant(\"ACTIVITY.FIELDS.SEVERITY\"),\n          trigger: $translate.instant(\"ACTIVITY.FIELDS.TRIGGER\"),\n          assigned_to: $translate.instant(\"ACTIVITY.FIELDS.ASSIGNED_TO\"),\n          watchers: $translate.instant(\"ACTIVITY.FIELDS.WATCHERS\"),\n          milestone: $translate.instant(\"ACTIVITY.FIELDS.MILESTONE\"),\n          user_story: $translate.instant(\"ACTIVITY.FIELDS.USER_STORY\"),\n          project: $translate.instant(\"ACTIVITY.FIELDS.PROJECT\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          points: $translate.instant(\"ACTIVITY.FIELDS.POINTS\"),\n          client_requirement: $translate.instant(\"ACTIVITY.FIELDS.CLIENT_REQUIREMENT\"),\n          team_requirement: $translate.instant(\"ACTIVITY.FIELDS.TEAM_REQUIREMENT\"),\n          is_iocaine: $translate.instant(\"ACTIVITY.FIELDS.IS_IOCAINE\"),\n          tags: $translate.instant(\"ACTIVITY.FIELDS.TAGS\"),\n          attachments: $translate.instant(\"ACTIVITY.FIELDS.ATTACHMENTS\"),\n          is_deprecated: $translate.instant(\"ACTIVITY.FIELDS.IS_DEPRECATED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          order: $translate.instant(\"ACTIVITY.FIELDS.ORDER\"),\n          backlog_order: $translate.instant(\"ACTIVITY.FIELDS.BACKLOG_ORDER\"),\n          sprint_order: $translate.instant(\"ACTIVITY.FIELDS.SPRINT_ORDER\"),\n          kanban_order: $translate.instant(\"ACTIVITY.FIELDS.KANBAN_ORDER\"),\n          taskboard_order: $translate.instant(\"ACTIVITY.FIELDS.TASKBOARD_ORDER\"),\n          us_order: $translate.instant(\"ACTIVITY.FIELDS.US_ORDER\")\n        };\n        return humanizedFieldNames[field] || field;\n      };\n      countChanges = function(comment) {\n        return _.keys(comment.values_diff).length;\n      };\n      formatChange = function(change) {\n        if (_.isArray(change)) {\n          if (change.length === 0) {\n            return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n          }\n          return change.join(\", \");\n        }\n        if (change === \"\") {\n          return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n        }\n        if ((change == null) || change === false) {\n          return $translate.instant(\"ACTIVITY.VALUES.NO\");\n        }\n        if (change === true) {\n          return $translate.instant(\"ACTIVITY.VALUES.YES\");\n        }\n        return change;\n      };\n      renderAttachmentEntry = function(value) {\n        var attachments;\n        attachments = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.NEW_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var diff, name;\n              name = $translate.instant(\"ACTIVITY.UPDATED_ATTACHMENT\", {\n                filename: change.filename\n              });\n              diff = _.map(change.changes, function(values, name) {\n                return {\n                  name: getHumanizedFieldName(name),\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                };\n              });\n              return templateChangeAttachment({\n                name: name,\n                diff: diff\n              });\n            });\n          }\n        });\n        return _.flatten(attachments).join(\"\\n\");\n      };\n      renderCustomAttributesEntry = function(value) {\n        var customAttributes;\n        customAttributes = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              var html;\n              html = templateChangeGeneric({\n                name: change.name,\n                from: formatChange(\"\"),\n                to: formatChange(change.value)\n              });\n              html = $compile(html)($scope);\n              return html[0].outerHTML;\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_CUSTOM_ATTRIBUTE\"),\n                diff: change.name\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var customAttrsChanges;\n              customAttrsChanges = _.map(change.changes, function(values) {\n                return templateChangeGeneric({\n                  name: change.name,\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                });\n              });\n              return _.flatten(customAttrsChanges).join(\"\\n\");\n            });\n          }\n        });\n        return _.flatten(customAttributes).join(\"\\n\");\n      };\n      renderChangeEntry = function(field, value) {\n        var added, from, html, name, removed, to;\n        if (field === \"description\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"description\"),\n            diff: value[1]\n          });\n        } else if (field === \"blocked_note\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"blocked_note\"),\n            diff: value[1]\n          });\n        } else if (field === \"points\") {\n          html = templateChangePoints({\n            points: value\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"attachments\") {\n          return renderAttachmentEntry(value);\n        } else if (field === \"custom_attributes\") {\n          return renderCustomAttributesEntry(value);\n        } else if (field === \"tags\" || field === \"watchers\") {\n          name = getHumanizedFieldName(field);\n          removed = _.difference(value[0], value[1]);\n          added = _.difference(value[1], value[0]);\n          html = templateChangeList({\n            name: name,\n            removed: removed,\n            added: added\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"assigned_to\") {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          to = formatChange(value[1] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        } else {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0]);\n          to = formatChange(value[1]);\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        }\n      };\n      renderChangeEntries = function(change) {\n        return _.map(change.values_diff, function(value, field) {\n          return renderChangeEntry(field, value);\n        });\n      };\n      renderChangesHelperText = function(change) {\n        var size;\n        size = countChanges(change);\n        return $translate.instant(\"ACTIVITY.SIZE_CHANGE\", {\n          size: size\n        }, 'messageformat');\n      };\n      renderComment = function(comment) {\n        var html, ref, ref1, ref2;\n        if (comment.delete_comment_date || ((ref = comment.delete_comment_user) != null ? ref.name : void 0)) {\n          html = templateDeletedComment({\n            deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n            deleteCommentUser: comment.delete_comment_user.name,\n            deleteComment: comment.comment_html,\n            activityId: comment.id,\n            canRestoreComment: $scope.user && (comment.delete_comment_user.pk === $scope.user.id || $scope.project.my_permissions.indexOf(\"modify_project\") > -1)\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        }\n        html = templateActivity({\n          avatar: comment.user.photo,\n          userFullName: comment.user.name,\n          userProfileUrl: comment.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: comment.user.username\n          }) : \"\",\n          creationDate: moment(comment.created_at).format(getPrettyDateFormat()),\n          comment: comment.comment_html,\n          changesText: renderChangesHelperText(comment),\n          changes: renderChangeEntries(comment),\n          mode: \"comment\",\n          deleteCommentActionTitle: $translate.instant(\"COMMENTS.DELETE\"),\n          deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref1 = comment.delete_comment_user) != null ? ref1.name : void 0) ? comment.delete_comment_user.name : void 0,\n          activityId: comment.id,\n          canDeleteComment: comment.user.pk === ((ref2 = $scope.user) != null ? ref2.id : void 0) || $scope.project.my_permissions.indexOf(\"modify_project\") > -1\n        });\n        html = $compile(html)($scope);\n        return html[0].outerHTML;\n      };\n      renderChange = function(change) {\n        var ref;\n        return templateActivity({\n          avatar: change.user.photo,\n          userFullName: change.user.name,\n          userProfileUrl: change.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: change.user.username\n          }) : \"\",\n          creationDate: moment(change.created_at).format(getPrettyDateFormat()),\n          comment: change.comment_html,\n          changes: renderChangeEntries(change),\n          changesText: \"\",\n          mode: \"activity\",\n          deleteCommentDate: change.delete_comment_date ? moment(change.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref = change.delete_comment_user) != null ? ref.name : void 0) ? change.delete_comment_user.name : void 0,\n          activityId: change.id\n        });\n      };\n      renderHistory = function(entries, totalEntries) {\n        var html, showMore;\n        if (entries.length === totalEntries) {\n          showMore = 0;\n        } else {\n          showMore = totalEntries - entries.length;\n        }\n        html = templateBaseEntries({\n          entries: entries,\n          showMore: showMore\n        });\n        html = $compile(html)($scope);\n        return html;\n      };\n      renderBase = function() {\n        var changes, comments, commentsVisible, historyVisible, html;\n        comments = $scope.comments || [];\n        changes = $scope.history || [];\n        historyVisible = !!changes.length;\n        commentsVisible = (!!comments.length) || checkPermissionsService.check('modify_' + $attrs.type);\n        html = templateBase({\n          ngmodel: $attrs.ngModel,\n          type: $attrs.type,\n          mode: $attrs.mode,\n          historyVisible: historyVisible,\n          commentsVisible: commentsVisible\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      rerender = function() {\n        renderBase();\n        renderComments();\n        return renderActivity();\n      };\n      renderComments = function() {\n        var comments, html, totalComments;\n        comments = $scope.comments || [];\n        totalComments = comments.length;\n        if (!showAllComments) {\n          comments = _.last(comments, 4);\n        }\n        comments = _.map(comments, function(x) {\n          return renderComment(x);\n        });\n        html = renderHistory(comments, totalComments);\n        return $el.find(\".comments-list\").html(html);\n      };\n      renderActivity = function() {\n        var changes, html, totalChanges;\n        changes = $scope.history || [];\n        totalChanges = changes.length;\n        if (!showAllActivity) {\n          changes = _.last(changes, 4);\n        }\n        changes = _.map(changes, function(x) {\n          return renderChange(x);\n        });\n        html = renderHistory(changes, totalChanges);\n        return $el.find(\".changes-list\").html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(target) {\n          var currentLoading, model, onError, onSuccess;\n          $scope.$broadcast(\"markdown-editor:submit\");\n          $el.find(\".comment-list\").addClass(\"activeanimation\");\n          currentLoading = $loading().target(target).start();\n          onSuccess = function() {\n            $rootScope.$broadcast(\"comment:new\");\n            return $ctrl.loadHistory(type, objectId)[\"finally\"](function() {\n              return currentLoading.finish();\n            });\n          };\n          onError = function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          };\n          model = $scope.$eval($attrs.ngModel);\n          return $ctrl.repo.save(model).then(onSuccess, onError);\n        };\n      })(this));\n      $scope.$watch(\"comments\", rerender);\n      $scope.$watch(\"history\", rerender);\n      $scope.$on(\"object:updated\", function() {\n        return $ctrl.loadHistory(type, objectId);\n      });\n      $el.on(\"click\", \".add-comment button.button-green\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      }));\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href && href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".show-more\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.parent().is(\".changes-list\")) {\n          showAllActivity = !showAllActivity;\n          return renderActivity();\n        } else {\n          showAllComments = !showAllComments;\n          return renderComments();\n        }\n      });\n      $el.on(\"click\", \".show-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').show();\n        target.parents('.activity-single').find('.show-deleted-comment').hide();\n        return target.parents('.activity-single').find('.comment-body').show();\n      });\n      $el.on(\"click\", \".hide-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').hide();\n        target.parents('.activity-single').find('.show-deleted-comment').show();\n        return target.parents('.activity-single').find('.comment-body').hide();\n      });\n      $el.on(\"click\", \".changes-title\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return target.parent().find(\".change-entry\").toggleClass(\"active\");\n      });\n      $el.on(\"focus\", \".add-comment textarea\", function(event) {\n        return $(this).addClass('active');\n      });\n      $el.on(\"click\", \".history-tabs li a\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        $el.find(\".history-tabs li a\").removeClass(\"active\");\n        target.addClass(\"active\");\n        $el.find(\".history section\").addClass(\"hidden\");\n        return $el.find(\".history section.\" + (target.data('section-class'))).removeClass(\"hidden\");\n      });\n      $el.on(\"click\", \".comment-delete\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.deleteComment(type, objectId, activityId);\n      }));\n      $el.on(\"click\", \".comment-restore\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.undeleteComment(type, objectId, activityId);\n      }));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return renderBase();\n    };\n    return {\n      controller: HistoryController,\n      restrict: \"AE\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistory\", [\"$log\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$tgConfirm\", \"$translate\", \"$compile\", \"$tgNavUrls\", \"$rootScope\", \"tgCheckPermissionsService\", HistoryDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/importer.coffee\n */\n\n(function() {\n  var ImportProjectButtonDirective, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  ImportProjectButtonDirective = function($rs, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $el.on(\"click\", \".import-project-button\", function(event) {\n        event.preventDefault();\n        $el.find(\"input.import-file\").val(\"\");\n        return $el.find(\"input.import-file\").trigger(\"click\");\n      });\n      return $el.on(\"change\", \"input.import-file\", function(event) {\n        var file, loader, onError, onSuccess;\n        event.preventDefault();\n        file = event.target.files[0];\n        if (!file) {\n          return;\n        }\n        loader = $confirm.loader($translate.instant(\"PROJECT.IMPORT.UPLOADING_FILE\"));\n        onSuccess = function(result) {\n          var ctx, message, msg, title;\n          loader.stop();\n          if (result.status === 202) {\n            title = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE\");\n            message = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE\");\n            return $confirm.success(title, message);\n          } else {\n            ctx = {\n              project: result.data.slug\n            };\n            $location.path($navUrls.resolve(\"project-admin-project-profile-details\", ctx));\n            msg = $translate.instant(\"PROJECT.IMPORT.SYNC_SUCCESS\");\n            return $confirm.notify(\"success\", msg);\n          }\n        };\n        onError = function(result) {\n          var errorMsg, ref;\n          loader.stop();\n          errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR\");\n          if (result.status === 429) {\n            errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST\");\n          } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n            errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MESSAGE\", {\n              error_message: result.data._error_message\n            });\n          }\n          return $confirm.notify(\"error\", errorMsg);\n        };\n        loader.start();\n        return $rs.projects[\"import\"](file, loader.update).then(onSuccess, onError);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgImportProjectButton\", [\"$tgResources\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$translate\", ImportProjectButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/lightboxes.coffee\n */\n\n(function() {\n  var AssignedToLightboxDirective, AttachmentPreviewLightboxDirective, BlockLightboxDirective, BlockingMessageInputDirective, CreateBulkUserstoriesDirective, CreateEditUserstoryDirective, LightboxDirective, LightboxKeyboardNavigationService, LightboxService, WatchersLightboxDirective, bindOnce, debounce, module, sizeFormat, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaCommon\");\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  LightboxService = (function(superClass) {\n    extend(LightboxService, superClass);\n\n    function LightboxService(animationFrame, q) {\n      this.animationFrame = animationFrame;\n      this.q = q;\n    }\n\n    LightboxService.prototype.open = function($el) {\n      var defered, docEl, lightboxContent;\n      defered = this.q.defer();\n      lightboxContent = $el.children().not(\".close\");\n      lightboxContent.hide();\n      this.animationFrame.add(function() {\n        return $el.css('display', 'flex');\n      });\n      this.animationFrame.add(function() {\n        $el.addClass(\"open\");\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            return $el.find('input,textarea').first().focus();\n          };\n        })(this));\n      });\n      this.animationFrame.add((function(_this) {\n        return function() {\n          lightboxContent.show();\n          return defered.resolve();\n        };\n      })(this));\n      docEl = angular.element(document);\n      docEl.on(\"keydown.lightbox\", (function(_this) {\n        return function(e) {\n          var code;\n          code = e.keyCode ? e.keyCode : e.which;\n          if (code === 27) {\n            return _this.close($el);\n          }\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    LightboxService.prototype.close = function($el) {\n      var docEl, scope;\n      docEl = angular.element(document);\n      docEl.off(\".lightbox\");\n      docEl.off(\".keyboard-navigation\");\n      $el.one(\"transitionend\", (function(_this) {\n        return function() {\n          $el.removeAttr('style');\n          return $el.removeClass(\"open\").removeClass('close');\n        };\n      })(this));\n      $el.addClass('close');\n      if ($el.hasClass(\"remove-on-close\")) {\n        scope = $el.data(\"scope\");\n        scope.$destroy();\n        return $el.remove();\n      }\n    };\n\n    LightboxService.prototype.closeAll = function() {\n      var docEl, i, len, lightboxEl, ref, results;\n      docEl = angular.element(document);\n      ref = docEl.find(\".lightbox.open\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lightboxEl = ref[i];\n        results.push(this.close($(lightboxEl)));\n      }\n      return results;\n    };\n\n    return LightboxService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxService\", [\"animationFrame\", \"$q\", LightboxService]);\n\n  LightboxKeyboardNavigationService = (function(superClass) {\n    extend(LightboxKeyboardNavigationService, superClass);\n\n    function LightboxKeyboardNavigationService() {\n      return LightboxKeyboardNavigationService.__super__.constructor.apply(this, arguments);\n    }\n\n    LightboxKeyboardNavigationService.prototype.stop = function() {\n      var docEl;\n      docEl = angular.element(document);\n      return docEl.off(\".keyboard-navigation\");\n    };\n\n    LightboxKeyboardNavigationService.prototype.dispatch = function($el, code) {\n      var activeElement, next, prev;\n      activeElement = $el.find(\".selected\");\n      if (code === 13) {\n        if ($el.find(\".user-list-single\").length === 1) {\n          return $el.find('.user-list-single:first').trigger(\"click\");\n        } else {\n          return activeElement.trigger(\"click\");\n        }\n      } else if (code === 40) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:not(\".is-active\"):first').addClass('selected');\n        } else {\n          next = activeElement.next('.user-list-single');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return next.addClass('selected');\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:last').addClass('selected');\n        } else {\n          prev = activeElement.prev('.user-list-single:not(\".is-active\")');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return prev.addClass('selected');\n          }\n        }\n      }\n    };\n\n    LightboxKeyboardNavigationService.prototype.init = function($el) {\n      var docEl;\n      this.stop();\n      docEl = angular.element(document);\n      return docEl.on(\"keydown.keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38 || code === 13) {\n            event.preventDefault();\n            return _this.dispatch($el, code);\n          }\n        };\n      })(this));\n    };\n\n    return LightboxKeyboardNavigationService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxKeyboardNavigationService\", LightboxKeyboardNavigationService);\n\n  LightboxDirective = function(lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n    };\n    return {\n      restrict: \"C\",\n      link: link\n    };\n  };\n\n  module.directive(\"lightbox\", [\"lightboxService\", LightboxDirective]);\n\n  BlockLightboxDirective = function($rootscope, $tgrepo, $confirm, lightboxService, $loading, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var block, title, unblock;\n      title = $translate.instant($attrs.title);\n      $el.find(\"h2.title\").text(title);\n      unblock = $qqueue.bindAdd((function(_this) {\n        return function(item, finishCallback) {\n          var promise;\n          promise = $tgrepo.save(item);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $model.$setViewValue(item);\n            return finishCallback();\n          });\n          promise.then(null, function() {\n            $confirm.notify(\"error\");\n            item.revert();\n            return $model.$setViewValue(item);\n          });\n          promise[\"finally\"](function() {\n            return finishCallback();\n          });\n          return promise;\n        };\n      })(this));\n      block = $qqueue.bindAdd((function(_this) {\n        return function(item) {\n          var currentLoading, promise;\n          $model.$setViewValue(item);\n          currentLoading = $loading().target($el.find(\".button-green\")).start();\n          promise = $tgrepo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            $confirm.notify(\"error\");\n            item.revert();\n            return $model.$setViewValue(item);\n          });\n          return promise[\"finally\"](function() {\n            currentLoading.finish();\n            return lightboxService.close($el);\n          });\n        };\n      })(this));\n      $scope.$on(\"block\", function() {\n        $el.find(\".reason\").val($model.$modelValue.blocked_note);\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"unblock\", (function(_this) {\n        return function(event, model, finishCallback) {\n          var item;\n          item = $model.$modelValue.clone();\n          item.is_blocked = false;\n          item.blocked_note = \"\";\n          return unblock(item, finishCallback);\n        };\n      })(this));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        var item;\n        event.preventDefault();\n        item = $model.$modelValue.clone();\n        item.is_blocked = true;\n        item.blocked_note = $el.find(\".reason\").val();\n        return block(item);\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-block.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbBlock\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"lightboxService\", \"$tgLoading\", \"$tgQqueue\", \"$translate\", BlockLightboxDirective]);\n\n  BlockingMessageInputDirective = function($log, $template, $compile) {\n    var link, template, templateFn;\n    template = $template.get(\"common/lightbox/lightbox-blocking-message-input.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.watch) {\n        return $log.error(\"No watch attribute on tg-blocking-message-input directive\");\n      }\n      return $scope.$watch($attrs.watch, function(value) {\n        if (value === !void 0 && value === true) {\n          return $el.find(\".blocked-note\").removeClass(\"hidden\");\n        } else {\n          return $el.find(\".blocked-note\").addClass(\"hidden\");\n        }\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        ngmodel: $attrs.ngModel\n      });\n    };\n    return {\n      template: templateFn,\n      link: link,\n      require: \"ngModel\",\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBlockingMessageInput\", [\"$log\", \"$tgTemplate\", \"$compile\", BlockingMessageInputDirective]);\n\n  CreateEditUserstoryDirective = function($repo, $model, $rs, $rootScope, lightboxService, $loading, $translate, $confirm, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, resetAttachments, submit, submitButton;\n      $scope.createEditUs = {};\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      $scope.$on(\"usform:new\", function(ctx, projectId, status, statusList) {\n        $scope.isNew = true;\n        $scope.usStatusList = statusList;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        $scope.us = $model.make_model(\"userstories\", {\n          project: projectId,\n          points: {},\n          status: status,\n          is_archived: false,\n          tags: []\n        });\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.CREATE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.NEW_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        $el.find(\".blocked-note\").addClass(\"hidden\");\n        $el.find(\"label.blocked\").removeClass(\"selected\");\n        $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"usform:edit\", function(ctx, us, attachments) {\n        $scope.us = us;\n        $scope.attachments = Immutable.fromJS(attachments);\n        $scope.isNew = false;\n        resetAttachments();\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.SAVE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.EDIT_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        if (us.is_blocked) {\n          $el.find(\".blocked-note\").removeClass(\"hidden\");\n          $el.find(\"label.blocked\").addClass(\"selected\");\n        } else {\n          $el.find(\".blocked-note\").addClass(\"hidden\");\n          $el.find(\"label.blocked\").removeClass(\"selected\");\n        }\n        if (us.team_requirement) {\n          $el.find(\"label.team-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        }\n        if (us.client_requirement) {\n          $el.find(\"label.client-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        }\n        return lightboxService.open($el);\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.us.project, 'us');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"us\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          if ($scope.isNew) {\n            promise = $repo.create(\"userstories\", $scope.us);\n            broadcastEvent = \"usform:new:success\";\n          } else {\n            promise = $repo.save($scope.us);\n            broadcastEvent = \"usform:edit:success\";\n          }\n          promise.then(function(data) {\n            deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this));\n            return data;\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootScope.$broadcast(broadcastEvent, data);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $scope.us.revert();\n        });\n        return lightboxService.close($el);\n      });\n      $el.keydown(function(event) {\n        var code;\n        code = event.keyCode ? event.keyCode : event.which;\n        if (code === 27) {\n          lightboxService.close($el);\n          return $scope.$apply(function() {\n            return $scope.us.revert();\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditUserstory\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", \"$tgConfirm\", \"$q\", \"tgAttachmentsService\", CreateEditUserstoryDirective]);\n\n  CreateBulkUserstoriesDirective = function($repo, $rs, $rootscope, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.$on(\"usform:bulk\", function(ctx, projectId, status) {\n        $scope[\"new\"] = {\n          projectId: projectId,\n          statusId: status,\n          bulk: \"\"\n        };\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley({\n            onlyOneErrorElement: true\n          });\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userstories.bulkCreate($scope[\"new\"].projectId, $scope[\"new\"].statusId, $scope[\"new\"].bulk);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"usform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkUserstories\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", CreateBulkUserstoriesDirective]);\n\n  AssignedToLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, filterUsers, normalizeString, render, selectedItem, selectedUser, usersTemplate;\n      selectedUser = null;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      normalizeString = function(string) {\n        var normalizedString;\n        normalizedString = string;\n        normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n        normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n        normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n        normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n        normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n        return normalizedString;\n      };\n      filterUsers = function(text, user) {\n        var username;\n        username = user.full_name_display.toUpperCase();\n        username = normalizeString(username);\n        text = text.toUpperCase();\n        text = normalizeString(text);\n        return _.contains(username, text);\n      };\n      render = function(selected, text) {\n        var ctx, html, users;\n        users = _.clone($scope.activeUsers, true);\n        if (selected != null) {\n          users = _.reject(users, {\n            \"id\": selected.id\n          });\n        }\n        if (text != null) {\n          users = _.filter(users, _.partial(filterUsers, text));\n        }\n        ctx = {\n          selected: selected,\n          users: _.first(users, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".assigned-to-list\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"assigned-to:add\", function(ctx, item) {\n        var assignedToId;\n        selectedItem = item;\n        assignedToId = item.assigned_to;\n        selectedUser = $scope.usersById[assignedToId];\n        render(selectedUser);\n        return lightboxService.open($el).then(function() {\n          $el.find('input').focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        if (searchingText != null) {\n          render(selectedUser, searchingText);\n          return $el.find('input').focus();\n        }\n      });\n      $el.on(\"click\", \".user-list-single\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.$broadcast(\"assigned-to:added\", target.data(\"user-id\"), selectedItem);\n          return $scope.usersSearch = null;\n        });\n      });\n      $el.on(\"click\", \".remove-assigned-to\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"assigned-to:added\", null, selectedItem);\n        });\n      });\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-assigned-to.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAssignedto\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", AssignedToLightboxDirective]);\n\n  WatchersLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, getFilteredUsers, render, selectedItem, usersTemplate;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      getFilteredUsers = function(text) {\n        var _filterUsers, users;\n        if (text == null) {\n          text = \"\";\n        }\n        _filterUsers = function(text, user) {\n          var username;\n          if (selectedItem && _.find(selectedItem.watchers, function(x) {\n            return x === user.id;\n          })) {\n            return false;\n          }\n          username = user.full_name_display.toUpperCase();\n          text = text.toUpperCase();\n          return _.contains(username, text);\n        };\n        users = _.clone($scope.activeUsers, true);\n        users = _.filter(users, _.partial(_filterUsers, text));\n        return users;\n      };\n      render = function(users) {\n        var ctx, html;\n        ctx = {\n          selected: false,\n          users: _.first(users, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".ticket-watchers\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"watcher:add\", function(ctx, item) {\n        var users;\n        selectedItem = item;\n        users = getFilteredUsers();\n        render(users);\n        return lightboxService.open($el).then(function() {\n          $el.find(\"input\").focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        var users;\n        if (searchingText == null) {\n          return;\n        }\n        users = getFilteredUsers(searchingText);\n        render(users);\n        return $el.find(\"input\").focus();\n      });\n      $el.on(\"click\", \".user-list-single\", debounce(2000, function(event) {\n        var target;\n        closeLightbox();\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"watcher:added\", target.data(\"user-id\"));\n        });\n      }));\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-users.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbWatchers\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", WatchersLightboxDirective]);\n\n  AttachmentPreviewLightboxDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-attachment-preview.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLbAttachmentPreview\", [\"lightboxService\", \"$tgTemplate\", \"$compile\", AttachmentPreviewLightboxDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/loader.coffee\n */\n\n(function() {\n  var Loader, LoaderDirective, module, sizeFormat, taiga, timeout;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaCommon\");\n\n  LoaderDirective = function(tgLoader, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      tgLoader.onStart(function() {\n        $(document.body).addClass(\"loader-active\");\n        return $el.addClass(\"active\");\n      });\n      return tgLoader.onEnd(function() {\n        $(document.body).removeClass(\"loader-active\");\n        return $el.removeClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoader\", [\"tgLoader\", \"$rootScope\", LoaderDirective]);\n\n  Loader = function($rootscope) {\n    var autoClose, config, lastResponseDate, open, pageLoaded, requestCount, start, startLoadTime;\n    config = {\n      minTime: 300\n    };\n    open = false;\n    startLoadTime = 0;\n    requestCount = 0;\n    lastResponseDate = 0;\n    pageLoaded = function(force) {\n      var diff, endTime, timeoutValue;\n      if (force == null) {\n        force = false;\n      }\n      if (startLoadTime) {\n        timeoutValue = 0;\n        if (!force) {\n          endTime = new Date().getTime();\n          diff = endTime - startLoadTime;\n          if (diff < config.minTime) {\n            timeoutValue = config.minTime - diff;\n          }\n        }\n        timeout(timeoutValue, function() {\n          $rootscope.$broadcast(\"loader:end\");\n          open = false;\n          return window.prerenderReady = true;\n        });\n      }\n      startLoadTime = 0;\n      requestCount = 0;\n      return lastResponseDate = 0;\n    };\n    autoClose = function() {\n      var intervalAuto;\n      return intervalAuto = setInterval((function() {\n        if (lastResponseDate && requestCount === 0) {\n          pageLoaded();\n          return clearInterval(intervalAuto);\n        }\n      }), 50);\n    };\n    start = function() {\n      startLoadTime = new Date().getTime();\n      $rootscope.$broadcast(\"loader:start\");\n      return open = true;\n    };\n    return {\n      pageLoaded: pageLoaded,\n      start: function(auto) {\n        if (auto == null) {\n          auto = false;\n        }\n        if (!open) {\n          start();\n          if (auto) {\n            return autoClose();\n          }\n        }\n      },\n      onStart: function(fn) {\n        return $rootscope.$on(\"loader:start\", fn);\n      },\n      onEnd: function(fn) {\n        return $rootscope.$on(\"loader:end\", fn);\n      },\n      logRequest: function() {\n        return requestCount++;\n      },\n      logResponse: function() {\n        requestCount--;\n        return lastResponseDate = new Date().getTime();\n      }\n    };\n  };\n\n  Loader.$inject = [\"$rootScope\"];\n\n  module.factory(\"tgLoader\", Loader);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/lightboxes.coffee\n */\n\n(function() {\n  var LoadingDirective, TgLoadingService, module,\n    slice = [].slice;\n\n  module = angular.module(\"taigaCommon\");\n\n  TgLoadingService = function($compile) {\n    var spinner;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    return function() {\n      var service;\n      service = {\n        settings: {\n          target: null,\n          scope: null,\n          classes: [],\n          timeout: 0,\n          template: null\n        },\n        target: function(target) {\n          service.settings.target = target;\n          return service;\n        },\n        scope: function(scope) {\n          service.settings.scope = scope;\n          return service;\n        },\n        template: function(template) {\n          service.settings.template = template;\n          return service;\n        },\n        removeClasses: function() {\n          var classess;\n          classess = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          service.settings.classes = classess;\n          return service;\n        },\n        timeout: function(timeout) {\n          service.settings.timeout = timeout;\n          return service;\n        },\n        start: function() {\n          var target, timeoutId;\n          target = service.settings.target;\n          service.settings.classes.map(function(className) {\n            return target.removeClass(className);\n          });\n          if (!target.hasClass('loading') && !service.settings.template) {\n            service.settings.template = target.html();\n          }\n          timeoutId = setTimeout((function() {\n            if (!target.hasClass('loading')) {\n              target.addClass('loading');\n              return target.html(spinner);\n            }\n          }), service.settings.timeout);\n          service.settings.timeoutId = timeoutId;\n          return service;\n        },\n        finish: function() {\n          var removeClasses, target, timeoutId;\n          target = service.settings.target;\n          timeoutId = service.settings.timeoutId;\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n            removeClasses = service.settings.classes;\n            removeClasses.map(function(className) {\n              return service.settings.target.addClass(className);\n            });\n            target.html(service.settings.template);\n            target.removeClass('loading');\n            if (service.settings.scope) {\n              $compile(target.contents())(service.settings.scope);\n            }\n          }\n          return service;\n        }\n      };\n      return service;\n    };\n  };\n\n  TgLoadingService.$inject = [\"$compile\"];\n\n  module.factory(\"$tgLoading\", TgLoadingService);\n\n  LoadingDirective = function($loading) {\n    var link;\n    link = function($scope, $el, attr) {\n      var currentLoading, template;\n      currentLoading = null;\n      template = $el.html();\n      return $scope.$watch(attr.tgLoading, (function(_this) {\n        return function(showLoading) {\n          if (showLoading) {\n            return currentLoading = $loading().target($el).timeout(100).template(template).scope($scope).start();\n          } else if (currentLoading) {\n            return currentLoading.finish();\n          }\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoading\", [\"$tgLoading\", LoadingDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/popovers.coffee\n */\n\n(function() {\n  var RelatedTaskStatusDirective, UsStatusDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  UsStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a US and a popover to change it.\n    - tg-us-status: The user story\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-us-status=\"us\" on-update=\"ctrl.loadSprintState()\")\n        a.us-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'usStatusById' and 'project'.\n     */\n    var link, template;\n    template = $template.get(\"common/popover/popover-us-status.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render, us;\n      $ctrl = $el.controller();\n      render = function(us) {\n        var usStatusById, usStatusDom, usStatusDomParent;\n        usStatusDomParent = $el.find(\".us-status\");\n        usStatusDom = $el.find(\".us-status .us-status-bind\");\n        usStatusById = $scope.usStatusById;\n        if (usStatusById[us.status]) {\n          usStatusDom.text(usStatusById[us.status].name);\n          return usStatusDomParent.css(\"color\", usStatusById[us.status].color);\n        }\n      };\n      $el.on(\"click\", \".us-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target, us;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        us = $scope.$eval($attrs.tgUsStatus);\n        us.status = target.data(\"status-id\");\n        render(us);\n        $el.find(\".pop-status\").popover().close();\n        return $scope.$apply(function() {\n          return $repo.save(us).then(function() {\n            return $scope.$eval($attrs.onUpdate);\n          });\n        });\n      }));\n      $scope.$on(\"userstories:loaded\", function() {\n        return render($scope.$eval($attrs.tgUsStatus));\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      us = $scope.$eval($attrs.tgUsStatus);\n      render(us);\n      return bindOnce($scope, \"project\", function(project) {\n        var html;\n        html = template({\n          \"statuses\": project.us_statuses\n        });\n        $el.append(html);\n        if ($scope.project.my_permissions.indexOf(\"modify_us\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsStatus\", [\"$tgRepo\", \"$tgTemplate\", UsStatusDirective]);\n\n  RelatedTaskStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a related task and a popover to change it.\n    - tg-related-task-status: The related task\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-related-task-status=\"task\" on-update=\"ctrl.loadSprintState()\")\n        a.task-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'taskStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateTaskStatus;\n    selectionTemplate = $template.get(\"common/popover/popover-related-task-status.html\", true);\n    updateTaskStatus = function($el, task, taskStatusById) {\n      var taskStatusDom, taskStatusDomParent;\n      taskStatusDomParent = $el.find(\".us-status\");\n      taskStatusDom = $el.find(\".task-status .task-status-bind\");\n      if (taskStatusById[task.status]) {\n        taskStatusDom.text(taskStatusById[task.status].name);\n        return taskStatusDomParent.css('color', taskStatusById[task.status].color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task;\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskStatus);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $el.on(\"click\", \".task-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        task.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (autoSave) {\n          return $scope.$apply(function() {\n            return $repo.save(task).then(function() {\n              $scope.$eval($attrs.onUpdate);\n              return $scope.$emit(\"related-tasks:status-changed\");\n            });\n          });\n        }\n      }));\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.task_statuses\n        }));\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskStatus\", [\"$tgRepo\", \"$tgTemplate\", RelatedTaskStatusDirective]);\n\n  $.fn.popover = function() {\n    var $el, close, closeAll, closePopover, isVisible, open;\n    $el = this;\n    isVisible = (function(_this) {\n      return function() {\n        var docViewBottom, docViewLeft, docViewRight, docViewTop, docViewWidth, elemBottom, elemLeft, elemRight, elemTop, elemWidth;\n        $el.css({\n          \"display\": \"block\",\n          \"visibility\": \"hidden\"\n        });\n        docViewTop = $(window).scrollTop();\n        docViewBottom = docViewTop + $(window).height();\n        docViewWidth = $(window).width();\n        docViewRight = docViewWidth;\n        docViewLeft = 0;\n        elemTop = $el.offset().top;\n        elemBottom = elemTop + $el.height();\n        elemWidth = $el.width();\n        elemLeft = $el.offset().left;\n        elemRight = $el.offset().left + elemWidth;\n        $el.css({\n          \"display\": \"none\",\n          \"visibility\": \"visible\"\n        });\n        return (elemBottom <= docViewBottom) && (elemTop >= docViewTop) && (elemLeft >= docViewLeft) && (elemRight <= docViewRight);\n      };\n    })(this);\n    closePopover = (function(_this) {\n      return function(onClose) {\n        if (onClose) {\n          onClose.call($el);\n        }\n        $el.fadeOut(function() {\n          return $el.removeClass(\"active\").removeClass(\"fix\");\n        });\n        return $el.off(\"popup:close\");\n      };\n    })(this);\n    closeAll = (function(_this) {\n      return function() {\n        return $(\".popover.active\").each(function() {\n          return $(this).trigger(\"popup:close\");\n        });\n      };\n    })(this);\n    open = (function(_this) {\n      return function(onClose) {\n        if ($el.hasClass(\"active\")) {\n          return close();\n        } else {\n          closeAll();\n          if (!isVisible()) {\n            $el.addClass(\"fix\");\n          }\n          $el.fadeIn(function() {\n            $el.addClass(\"active\");\n            $(document.body).off(\"popover\");\n            return $(document.body).one(\"click.popover\", function() {\n              return closeAll();\n            });\n          });\n          return $el.on(\"popup:close\", function(e) {\n            return closePopover(onClose);\n          });\n        }\n      };\n    })(this);\n    close = (function(_this) {\n      return function() {\n        return $el.trigger(\"popup:close\");\n      };\n    })(this);\n    return {\n      open: open,\n      close: close,\n      closeAll: closeAll\n    };\n  };\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/raven-logger.coffee\n */\n\n(function() {\n  var ExceptionHandlerFactory, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  ExceptionHandlerFactory = function($log, config) {\n    var ravenConfig;\n    this.config = config;\n    ravenConfig = this.config.get(\"ravenConfig\", null);\n    if (ravenConfig) {\n      $log.debug(\"Using the RavenJS exception handler.\");\n      Raven.config(ravenConfig).install();\n      return function(exception, cause) {\n        $log.error.apply($log, arguments);\n        return Raven.captureException(exception);\n      };\n    } else {\n      $log.debug(\"Using the default logging exception handler.\");\n      return function(exception, cause) {\n        return $log.error.apply($log, arguments);\n      };\n    }\n  };\n\n  module.factory(\"$exceptionHandler\", [\"$log\", \"$tgConfig\", ExceptionHandlerFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/tags.coffee\n */\n\n(function() {\n  var ColorizeTagsDirective, LbTagLineDirective, TagLineDirective, TagsDirective, bindOnce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  TagsDirective = function() {\n    var formatter, link, parser;\n    formatter = function(v) {\n      if (_.isArray(v)) {\n        return v.join(\", \");\n      }\n      return \"\";\n    };\n    parser = function(v) {\n      var result;\n      if (!v) {\n        return [];\n      }\n      result = _(v.split(\",\")).map(function(x) {\n        return _.str.trim(x);\n      });\n      return result.value();\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      $ctrl.$formatters.push(formatter);\n      $ctrl.$parsers.push(parser);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgTags\", TagsDirective);\n\n  ColorizeTagsDirective = function() {\n    var link, templates;\n    templates = {\n      backlog: _.template(\"<% _.each(tags, function(tag) { %>\\n    <span class=\\\"tag\\\" style=\\\"border-left: 5px solid <%- tag.color %>\\\"><%- tag.name %></span>\\n<% }) %>\"),\n      kanban: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"kanban-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\"),\n      taskboard: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"taskboard-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\")\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      var render;\n      render = function(srcTags) {\n        var html, tags, template;\n        template = templates[$attrs.tgColorizeTagsType];\n        srcTags.sort();\n        tags = _.map(srcTags, function(tag) {\n          var color;\n          color = $scope.project.tags_colors[tag];\n          return {\n            name: tag,\n            color: color\n          };\n        });\n        html = template({\n          tags: tags\n        });\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.tgColorizeTags, function(tags) {\n        if (tags != null) {\n          return render(tags);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgColorizeTags\", ColorizeTagsDirective);\n\n  LbTagLineDirective = function($rs, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/lb-tag-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideSaveButton, renderTags, resetInput, saveInputTag, showSaveButton;\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          })\n        };\n        _.map(ctx.tags, (function(_this) {\n          return function(tag) {\n            if (tag.color) {\n              return tag.style = \"border-left: 5px solid \" + tag.color;\n            }\n          };\n        })(this));\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\"div.tags-container\").html(html);\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return $el.find(\"input\").autocomplete(\"close\");\n      };\n      addValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n        return hideSaveButton();\n      };\n      deleteValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        tags = _.pull(tags, value);\n        return $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          event.preventDefault();\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".icon-delete\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project\", function(project) {\n        var positioningFunction;\n        positioningFunction = function(position, elements) {\n          var menu;\n          menu = elements.element.element;\n          menu.css(\"width\", elements.target.width);\n          menu.css(\"top\", position.top);\n          return menu.css(\"left\", position.left);\n        };\n        return $el.find(\"input\").autocomplete({\n          source: _.keys(project.tags_colors),\n          position: {\n            my: \"left top\",\n            using: positioningFunction\n          },\n          select: function(event, ui) {\n            addValue(ui.item.value);\n            return ui.item.value = \"\";\n          }\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(tags) {\n        var ref, tagsColors;\n        tagsColors = ((ref = $scope.project) != null ? ref.tags_colors : void 0) || [];\n        return renderTags(tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/lb-tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgLbTagLine\", [\"$tgResources\", \"$tgTemplate\", \"$compile\", LbTagLineDirective]);\n\n  TagLineDirective = function($rootScope, $repo, $rs, $confirm, $qqueue, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, ESC_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    ESC_KEY = 27;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/tags-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideAddTagButton, hideAddTagButtonText, hideInput, hideSaveButton, isEditable, renderInReadModeOnly, renderTags, resetInput, saveInputTag, showAddTagButton, showAddTagButtonText, showInput, showSaveButton;\n      isEditable = function() {\n        if ($attrs.requiredPerm != null) {\n          return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n        }\n        return true;\n      };\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          }),\n          isEditable: isEditable()\n        };\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\"div.tags-container\").html(html);\n      };\n      renderInReadModeOnly = function() {\n        $el.find(\".add-tag\").remove();\n        $el.find(\"input\").remove();\n        return $el.find(\".save\").remove();\n      };\n      showAddTagButton = function() {\n        return $el.find(\".add-tag\").removeClass(\"hidden\");\n      };\n      hideAddTagButton = function() {\n        return $el.find(\".add-tag\").addClass(\"hidden\");\n      };\n      showAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").removeClass(\"hidden\");\n      };\n      hideAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").addClass(\"hidden\");\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      showInput = function() {\n        return $el.find(\"input\").removeClass(\"hidden\").focus();\n      };\n      hideInput = function() {\n        return $el.find(\"input\").addClass(\"hidden\").blur();\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return $el.find(\"input\").autocomplete(\"close\");\n      };\n      addValue = $qqueue.bindAdd(function(value) {\n        var model, onError, onSuccess, tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue.tags, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        model = $model.$modelValue.clone();\n        model.tags = tags;\n        $model.$setViewValue(model);\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          model.revert();\n          return $model.$setViewValue(model);\n        };\n        hideSaveButton();\n        return $repo.save(model).then(onSuccess, onError);\n      });\n      deleteValue = $qqueue.bindAdd(function(value) {\n        var model, onError, onSuccess, tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue.tags, false);\n        tags = _.pull(tags, value);\n        model = $model.$modelValue.clone();\n        model.tags = tags;\n        $model.$setViewValue(model);\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          model.revert();\n          return $model.$setViewValue(model);\n        };\n        return $repo.save(model).then(onSuccess, onError);\n      });\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === ESC_KEY) {\n          resetInput();\n          hideInput();\n          hideSaveButton();\n          return showAddTagButton();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".add-tag\", function(event) {\n        event.preventDefault();\n        hideAddTagButton();\n        return showInput();\n      });\n      $el.on(\"click\", \".icon-delete\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project.tags_colors\", function(tags_colors) {\n        var positioningFunction;\n        if (!isEditable()) {\n          renderInReadModeOnly();\n          return;\n        }\n        showAddTagButton();\n        positioningFunction = function(position, elements) {\n          var menu;\n          menu = elements.element.element;\n          menu.css(\"width\", elements.target.width);\n          menu.css(\"top\", position.top);\n          return menu.css(\"left\", position.left);\n        };\n        return $el.find(\"input\").autocomplete({\n          source: _.keys(tags_colors),\n          position: {\n            my: \"left top\",\n            using: positioningFunction\n          },\n          select: function(event, ui) {\n            addValue(ui.item.value);\n            return ui.item.value = \"\";\n          }\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(model) {\n        var ref, ref1, tagsColors;\n        if (!model) {\n          return;\n        }\n        if ((ref = model.tags) != null ? ref.length : void 0) {\n          hideAddTagButtonText();\n        } else {\n          showAddTagButtonText();\n        }\n        tagsColors = ((ref1 = $scope.project) != null ? ref1.tags_colors : void 0) || [];\n        return renderTags(model.tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgTagLine\", [\"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", TagLineDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/wisiwyg.coffee\n */\n\n(function() {\n  var MarkitupDirective, bindOnce, module, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  MarkitupDirective = function($rootscope, $rs, $selectedText, $template, $compile, $translate) {\n    var link, previewTemplate;\n    previewTemplate = $template.get(\"common/wysiwyg/wysiwyg-markitup-preview.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addLine, cancelablePromise, closePreviewMode, element, markdownTitle, prepareUrlFormatting, preview, previewDomNode, renderMarkItUp, setCaretPosition, unbind, urlFormatting;\n      element = angular.element($el);\n      previewDomNode = $(\"<div/>\", {\n        \"class\": \"preview\"\n      });\n      closePreviewMode = function() {\n        element.parents(\".markdown\").find(\".preview\").remove();\n        return element.parents(\".markItUp\").show();\n      };\n      $scope.$on(\"markdown-editor:submit\", function() {\n        return closePreviewMode();\n      });\n      cancelablePromise = null;\n      preview = function() {\n        var markItUpDomNode, markdownDomNode;\n        markdownDomNode = element.parents(\".markdown\");\n        markItUpDomNode = element.parents(\".markItUp\");\n        return $rs.mdrender.render($scope.projectId, $model.$modelValue).then(function(data) {\n          var html, markdown;\n          html = previewTemplate({\n            data: data.data\n          });\n          html = $compile(html)($scope);\n          markdownDomNode.append(html);\n          markItUpDomNode.hide();\n          markdown = element.closest(\".markdown\");\n          return markdown.on(\"mouseup.preview\", \".preview\", function(event) {\n            var target;\n            event.preventDefault();\n            target = angular.element(event.target);\n            if (!target.is('a') && $selectedText.get().length) {\n              return;\n            }\n            markdown.off(\".preview\");\n            return closePreviewMode();\n          });\n        });\n      };\n      setCaretPosition = function(textarea, caretPosition) {\n        var line, range, scrollRelation, totalLines;\n        if (textarea.createTextRange) {\n          range = textarea.createTextRange();\n          range.move(\"character\", caretPosition);\n          range.select();\n        } else if (textarea.selectionStart) {\n          textarea.focus();\n          textarea.setSelectionRange(caretPosition, caretPosition);\n        }\n        totalLines = textarea.value.split(\"\\n\").length;\n        line = textarea.value.slice(0, +(caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n        scrollRelation = line / totalLines;\n        return $el.scrollTop((scrollRelation * $el[0].scrollHeight) - ($el.height() / 2));\n      };\n      addLine = function(textarea, nline, replace) {\n        var cursorPosition, j, key, len, line, lines;\n        lines = textarea.value.split(\"\\n\");\n        if (replace) {\n          lines[nline] = replace + lines[nline];\n        } else {\n          lines[nline] = \"\";\n        }\n        cursorPosition = 0;\n        for (key = j = 0, len = lines.length; j < len; key = ++j) {\n          line = lines[key];\n          cursorPosition += line.length + 1 || 1;\n          if (key === nline) {\n            break;\n          }\n        }\n        textarea.value = lines.join(\"\\n\");\n        if (replace) {\n          return cursorPosition - lines[nline].length + replace.length - 1;\n        } else {\n          return cursorPosition;\n        }\n      };\n      prepareUrlFormatting = function(markItUp) {\n        var indices, regex, result;\n        regex = /(<<<|>>>)/gi;\n        result = 0;\n        indices = [];\n        while ((result = regex.exec(markItUp.textarea.value))) {\n          indices.push(result.index);\n        }\n        return markItUp.donotparse = indices;\n      };\n      urlFormatting = function(markItUp) {\n        var endIndex, ref, ref1, regex, result, startIndex, url, value;\n        regex = /<<</gi;\n        result = 0;\n        startIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref = result.index, indexOf.call(markItUp.donotparse, ref) < 0) {\n            startIndex = result.index;\n            break;\n          }\n        }\n        if (!result) {\n          return;\n        }\n        regex = />>>/gi;\n        endIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref1 = result.index, indexOf.call(markItUp.donotparse, ref1) < 0) {\n            endIndex = result.index;\n            break;\n          }\n        }\n        value = markItUp.textarea.value;\n        url = value.substring(startIndex, endIndex).replace('<<<', '').replace('>>>', '');\n        url = url.replace('(', '%28').replace(')', '%29');\n        url = url.replace('[', '%5B').replace(']', '%5D');\n        value = value.substring(0, startIndex) + url + value.substring(endIndex + 3, value.length);\n        markItUp.textarea.value = value;\n        return markItUp.donotparse = void 0;\n      };\n      markdownTitle = function(markItUp, char) {\n        var heading, i, j, n, ref;\n        heading = \"\";\n        n = $.trim(markItUp.selection || markItUp.placeHolder).length;\n        for (i = j = 0, ref = n - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n          heading += char;\n        }\n        return \"\\n\" + heading + \"\\n\";\n      };\n      renderMarkItUp = function() {\n        var markdownSettings;\n        markdownSettings = {\n          nameSpace: \"markdown\",\n          onShiftEnter: {\n            keepDefault: false,\n            openWith: \"\\n\\n\"\n          },\n          onEnter: {\n            keepDefault: false,\n            replaceWith: function() {\n              if (!$('.textcomplete-dropdown').is(':visible')) {\n                return \"\\n\";\n              }\n            },\n            afterInsert: function(data) {\n              var cursorLine, emptyListItem, lastLine, lines, markdownCaretPositon, match, newLineContent, nline, replace;\n              lines = data.textarea.value.split(\"\\n\");\n              if (data.caretPosition > 0) {\n                cursorLine = data.textarea.value.slice(0, +(data.caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n              } else {\n                cursorLine = 1;\n              }\n              newLineContent = data.textarea.value.slice(data.caretPosition).split(\"\\n\")[0];\n              lastLine = lines[cursorLine - 1];\n              match = lastLine.match(/^(\\s*- ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)\\-\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*\\* ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*\\* )$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*)(\\d+)\\.\\s/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)(\\d+)\\.\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = (match[1] + (parseInt(match[2], 10) + 1)) + \". \";\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              if (markdownCaretPositon) {\n                return setCaretPosition(data.textarea, markdownCaretPositon);\n              }\n            }\n          },\n          markupSet: [\n            {\n              name: $translate.instant(\"COMMON.WYSIWYG.H1_BUTTON\"),\n              key: \"1\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H1_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"=\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H2_BUTTON\"),\n              key: \"2\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H2_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"-\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H3_BUTTON\"),\n              key: \"3\",\n              openWith: \"### \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H3_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON\"),\n              key: \"B\",\n              openWith: \"**\",\n              closeWith: \"**\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\"),\n              key: \"I\",\n              openWith: \"_\",\n              closeWith: \"_\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.STRIKE_BUTTON\"),\n              key: \"S\",\n              openWith: \"~~\",\n              closeWith: \"~~\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_BUTTON\"),\n              openWith: \"- \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_BUTTON\"),\n              openWith: function(markItUp) {\n                return markItUp.line + \". \";\n              },\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PICTURE_BUTTON\"),\n              key: \"P\",\n              openWith: \"![\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.LINK_BUTTON\"),\n              key: \"L\",\n              openWith: \"[\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.LINK_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON\"),\n              openWith: \"> \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_BUTTON\"),\n              openWith: \"```\\n\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT\"),\n              closeWith: \"\\n```\"\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PREVIEW_BUTTON\"),\n              call: preview,\n              className: \"preview-icon\"\n            }\n          ],\n          afterInsert: function(event) {\n            var target;\n            target = angular.element(event.textarea);\n            return $model.$setViewValue(target.val());\n          }\n        };\n        return element.markItUpRemove().markItUp(markdownSettings).textcomplete([\n          {\n            cache: true,\n            match: /(^|\\s)#([a-z0-9]+)$/i,\n            search: function(term, callback) {\n              var filter, searchProps, searchTypes;\n              term = taiga.slugify(term);\n              searchTypes = ['issues', 'tasks', 'userstories'];\n              searchProps = ['ref', 'subject'];\n              filter = (function(_this) {\n                return function(item) {\n                  var j, len, prop;\n                  for (j = 0, len = searchProps.length; j < len; j++) {\n                    prop = searchProps[j];\n                    if (taiga.slugify(item[prop]).indexOf(term) >= 0) {\n                      return true;\n                    }\n                  }\n                  return false;\n                };\n              })(this);\n              if (cancelablePromise) {\n                cancelablePromise.abort();\n              }\n              cancelablePromise = $rs.search[\"do\"]($scope.projectId, term);\n              cancelablePromise.then((function(_this) {\n                return function(res) {\n                  var j, len, results, type;\n                  if (res.count < 1 || res.count === res.wikipages.length) {\n                    return callback([]);\n                  } else {\n                    results = [];\n                    for (j = 0, len = searchTypes.length; j < len; j++) {\n                      type = searchTypes[j];\n                      if (res[type] && res[type].length > 0) {\n                        results.push(callback(res[type].filter(filter), true));\n                      } else {\n                        results.push(void 0);\n                      }\n                    }\n                    return results;\n                  }\n                };\n              })(this));\n              return callback([]);\n            },\n            replace: function(res) {\n              return \"$1\\#\" + res.ref + \" \";\n            },\n            template: function(res, term) {\n              return \"\\#\" + res.ref + \" - \" + res.subject;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)@([a-z0-9\\-\\._]{2,})$/i,\n            search: function(term, callback) {\n              var searchProps, username;\n              username = taiga.slugify(term);\n              searchProps = ['username', 'full_name', 'full_name_display'];\n              if ($scope.project.members.length < 1) {\n                return callback([]);\n              } else {\n                return callback($scope.project.members.filter((function(_this) {\n                  return function(user) {\n                    var j, len, prop;\n                    for (j = 0, len = searchProps.length; j < len; j++) {\n                      prop = searchProps[j];\n                      if (taiga.slugify(user[prop]).indexOf(username) >= 0) {\n                        return true;\n                      }\n                    }\n                    return false;\n                  };\n                })(this)));\n              }\n            },\n            replace: function(user) {\n              return \"$1@\" + user.username + \" \";\n            },\n            template: function(user) {\n              return user.username + \" - \" + user.full_name_display;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)\\[\\[([a-z0-9\\-]+)$/i,\n            search: function(term, callback) {\n              term = taiga.slugify(term);\n              return $rs.search[\"do\"]($scope.projectId, term).then((function(_this) {\n                return function(res) {\n                  if (res.count < 1) {\n                    callback([]);\n                  }\n                  if (res.count < 1 || !res.wikipages || res.wikipages.length <= 0) {\n                    callback([]);\n                  } else {\n                    callback(res.wikipages.filter(function(page) {\n                      return taiga.slugify(page['slug']).indexOf(term) >= 0;\n                    }), true);\n                  }\n                  return callback([]);\n                };\n              })(this));\n            },\n            replace: function(res) {\n              return \"$1[[\" + res.slug + \"]]\";\n            },\n            template: function(res, term) {\n              return res.slug;\n            }\n          }\n        ], {\n          debounce: 200\n        });\n      };\n      renderMarkItUp();\n      unbind = $rootscope.$on(\"$translateChangeEnd\", renderMarkItUp);\n      element.on(\"keypress\", function(event) {\n        return $scope.$apply();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgMarkitup\", [\"$rootScope\", \"$tgResources\", \"$selectedText\", \"$tgTemplate\", \"$compile\", \"$translate\", MarkitupDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogFiltersDirective, bindOnce, debounceLeading, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogFiltersDirective = function($q, $log, $location, $templates) {\n    var link, template, templateSelected;\n    template = $templates.get(\"backlog/filters.html\", true);\n    templateSelected = $templates.get(\"backlog/filter-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, currentFiltersType, getFiltersType, initializeSelectedFilters, reloadUserstories, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection;\n      currentFiltersType = '';\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\"h2.breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 a.subfilter span.title\").html(title);\n        $el.find(\"h2 a.subfilter span.title\").prop(\"data-type\", type);\n        return currentFiltersType = getFiltersType();\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\"h2.breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function() {\n        var i, len, name, ref, val, values;\n        showCategories();\n        selectedFilters = [];\n        ref = $scope.filters;\n        for (name in ref) {\n          values = ref[name];\n          for (i = 0, len = values.length; i < len; i++) {\n            val = values[i];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters();\n      };\n      renderSelectedFilters = function() {\n        var html;\n        _.map(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        return $el.find(\".filters-applied\").html(html);\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.map(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n      };\n      reloadUserstories = function() {\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadUserstories(), $ctrl.generateFilters()]).then(function() {\n          var currentFilters;\n          currentFilters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(currentFilters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var filter, filters;\n        currentFiltersType = getFiltersType();\n        filters = $scope.filters[type];\n        filter = _.find(filters, {\n          id: id\n        });\n        filter.selected = !filter.selected;\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $scope.$apply(function() {\n            return $ctrl.selectFilter(type, id);\n          });\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(selected) {\n            return filter.type === selected.type && filter.id === selected.id;\n          });\n          $ctrl.unselectFilter(type, id);\n        }\n        renderSelectedFilters(selectedFilters);\n        if (type === currentFiltersType) {\n          renderFilters(_.reject(filters, \"selected\"));\n        }\n        return reloadUserstories();\n      };\n      selectQFilter = debounceLeading(100, function(value) {\n        if (value === void 0) {\n          return;\n        }\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n        }\n        return reloadUserstories();\n      });\n      $scope.$watch(\"filtersQ\", selectQFilter);\n      $scope.$on(\"backlog:loaded\", function(ctx) {\n        return initializeSelectedFilters();\n      });\n      $scope.$on(\"filters:update\", function(ctx) {\n        return $ctrl.generateFilters().then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          if (currentFiltersType) {\n            return renderFilters(_.reject(filters, \"selected\"));\n          }\n        });\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data('type'));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories();\n      });\n      $el.on(\"click\", \".filters-applied a\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      return $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.hasClass(\"active\")) {\n          target.removeClass(\"active\");\n        } else {\n          target.addClass(\"active\");\n        }\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgTemplate\", BacklogFiltersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/lightboxes.coffee\n */\n\n(function() {\n  var CreateEditSprint, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  CreateEditSprint = function($repo, $confirm, $rs, $rootscope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var createSprint, getLastSprint, hasErrors, remove, resetSprint, submit;\n      hasErrors = false;\n      createSprint = true;\n      resetSprint = function() {\n        return $scope.sprint = {\n          project: null,\n          name: null,\n          estimated_start: null,\n          estimated_finish: null\n        };\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, newSprint, prettyDate, promise, submitButton, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          submitButton = $el.find(\".submit-button\");\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            hasErrors = true;\n            $el.find(\".last-sprint-name\").addClass(\"disappear\");\n            return;\n          }\n          hasErrors = false;\n          newSprint = angular.copy($scope.sprint);\n          broadcastEvent = null;\n          if (createSprint) {\n            newSprint.estimated_start = moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.create(\"milestones\", newSprint);\n            broadcastEvent = \"sprintform:create:success\";\n          } else {\n            newSprint.setAttr(\"estimated_start\", moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\"));\n            newSprint.setAttr(\"estimated_finish\", moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\"));\n            promise = $repo.save(newSprint);\n            broadcastEvent = \"sprintform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise.then(function(data) {\n            currentLoading.finish();\n            if (createSprint) {\n              $scope.sprintsCounter += 1;\n            }\n            $rootscope.$broadcast(broadcastEvent, data);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"light-error\", data._error_message);\n            } else if (data.__all__) {\n              return $confirm.notify(\"light-error\", data.__all__[0]);\n            }\n          });\n        };\n      })(this));\n      remove = function() {\n        var message, title;\n        title = $translate.instant(\"LIGHTBOX.DELETE_SPRINT.TITLE\");\n        message = $scope.sprint.name;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSuccess;\n            onSuccess = function() {\n              askResponse.finish();\n              $scope.milestonesCounter -= 1;\n              lightboxService.close($el);\n              return $rootscope.$broadcast(\"sprintform:remove:success\", $scope.sprint);\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove($scope.sprint).then(onSuccess, onError);\n          };\n        })(this));\n      };\n      getLastSprint = function() {\n        var openSprints, sortedSprints;\n        openSprints = _.filter($scope.sprints, function(sprint) {\n          return !sprint.closed;\n        });\n        sortedSprints = _.sortBy(openSprints, function(sprint) {\n          return moment(sprint.estimated_finish, 'YYYY-MM-DD').format('X');\n        });\n        return sortedSprints[sortedSprints.length - 1];\n      };\n      $scope.$on(\"sprintform:create\", function(event, projectId) {\n        var estimatedFinish, estimatedStart, form, lastSprint, lastSprintNameDom, prettyDate, text;\n        resetSprint();\n        form = $el.find(\"form\").checksley();\n        form.reset();\n        createSprint = true;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.sprint.project = projectId;\n        $scope.sprint.name = null;\n        $scope.sprint.slug = null;\n        lastSprint = getLastSprint();\n        estimatedStart = moment();\n        if (lastSprint) {\n          estimatedStart = moment(lastSprint.estimated_finish);\n        } else if ($scope.sprint.estimated_start) {\n          estimatedStart = moment($scope.sprint.estimated_start);\n        }\n        $scope.sprint.estimated_start = estimatedStart.format(prettyDate);\n        estimatedFinish = moment().add(2, \"weeks\");\n        if (lastSprint) {\n          estimatedFinish = moment(lastSprint.estimated_finish).add(2, \"weeks\");\n        } else if ($scope.sprint.estimated_finish) {\n          estimatedFinish = moment($scope.sprint.estimated_finish);\n        }\n        $scope.sprint.estimated_finish = estimatedFinish.format(prettyDate);\n        lastSprintNameDom = $el.find(\".last-sprint-name\");\n        if ((lastSprint != null ? lastSprint.name : void 0) != null) {\n          text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME\", {\n            lastSprint: lastSprint.name\n          });\n          lastSprintNameDom.html(text);\n        }\n        $el.find(\".delete-sprint\").addClass(\"hidden\");\n        text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.TITLE\");\n        $el.find(\".title\").text(text);\n        text = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").text(text);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus();\n        return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n      });\n      $scope.$on(\"sprintform:edit\", function(ctx, sprint) {\n        var editSprint, prettyDate, save;\n        resetSprint();\n        createSprint = false;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.$apply(function() {\n          $scope.sprint = sprint;\n          $scope.sprint.estimated_start = moment($scope.sprint.estimated_start).format(prettyDate);\n          return $scope.sprint.estimated_finish = moment($scope.sprint.estimated_finish).format(prettyDate);\n        });\n        $el.find(\".delete-sprint\").removeClass(\"hidden\");\n        editSprint = $translate.instant(\"BACKLOG.EDIT_SPRINT\");\n        $el.find(\".title\").text(editSprint);\n        save = $translate.instant(\"COMMON.SAVE\");\n        $el.find(\".button-green\").text(save);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus().select();\n        return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n      });\n      $el.on(\"keyup\", \".sprint-name\", function(event) {\n        if ($el.find(\".sprint-name\").val().length > 0 || hasErrors) {\n          return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n        } else {\n          return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".delete-sprint .icon-delete\", function(event) {\n        event.preventDefault();\n        return remove();\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return resetSprint();\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditSprint\", [\"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditSprint]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogController, BacklogDirective, BurndownBacklogGraphDirective, TgBacklogProgressBarDirective, ToggleBurndownVisibility, UsPointsDirective, UsRolePointsSelectorDirective, bindMethods, bindOnce, generateHash, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  generateHash = this.taiga.generateHash;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogController = (function(superClass) {\n    extend(BacklogController, superClass);\n\n    BacklogController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLoading\", \"tgResources\"];\n\n    function BacklogController(scope1, rootscope, repo, confirm, rs, params1, q, location, appMetaService, navUrls, events, analytics, translate, loading, rs2) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loading = loading;\n      this.rs2 = rs2;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"BACKLOG.SECTION_NAME\");\n      this.showTags = false;\n      this.activeFilters = false;\n      this.scope.showGraphPlaceholder = null;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"BACKLOG.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"BACKLOG.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          _this.appMetaService.setAll(title, description);\n          if (_this.rs.userstories.getShowTags(_this.scope.projectId)) {\n            _this.showTags = true;\n            return _this.scope.$broadcast(\"showTags\", _this.showTags);\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    BacklogController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:create:success\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"sprint\", \"create\", \"create sprint on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.loadProjectStats();\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"sprintform:remove:success\", (function(_this) {\n        return function(event, sprint) {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.loadUserstories();\n          if (sprint.closed) {\n            _this.loadClosedSprints();\n          }\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"sprint:us:move\", this.moveUs);\n      this.scope.$on(\"sprint:us:moved\", this.loadSprints);\n      this.scope.$on(\"sprint:us:moved\", this.loadProjectStats);\n      this.scope.$on(\"backlog:load-closed-sprints\", this.loadClosedSprints);\n      return this.scope.$on(\"backlog:unload-closed-sprints\", this.unloadClosedSprints);\n    };\n\n    BacklogController.prototype.initializeSubscription = function() {\n      var routingKey1, routingKey2;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.loadUserstories();\n          return _this.loadSprints();\n        };\n      })(this));\n      routingKey2 = \"changes.project.\" + this.scope.projectId + \".milestones\";\n      return this.events.subscribe(this.scope, routingKey2, (function(_this) {\n        return function(message) {\n          return _this.loadSprints();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleShowTags = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.showTags = !_this.showTags;\n          return _this.rs.userstories.storeShowTags(_this.scope.projectId, _this.showTags);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleActiveFilters = function() {\n      return this.activeFilters = !this.activeFilters;\n    };\n\n    BacklogController.prototype.loadProjectStats = function() {\n      return this.rs.projects.stats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totalPoints;\n          _this.scope.stats = stats;\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          if (totalPoints) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.closed_points / totalPoints);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.showGraphPlaceholder = !((stats.total_points != null) && (stats.total_milestones != null));\n          return stats;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.unloadClosedSprints = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.scope.closedSprints = [];\n          return _this.rootscope.$broadcast(\"closed-sprints:reloaded\", []);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadClosedSprints = function() {\n      var params;\n      params = {\n        closed: true\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalClosedMilestones = result.closed;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.closedSprints = sprints;\n          _this.scope.closedSprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"closed-sprints:reloaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadSprints = function() {\n      var params;\n      params = {\n        closed: false\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalMilestones = sprints;\n          _this.scope.totalClosedMilestones = result.closed;\n          _this.scope.totalOpenMilestones = result.open;\n          _this.scope.totalMilestones = _this.scope.totalOpenMilestones + _this.scope.totalClosedMilestones;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.sprints = sprints;\n          _this.scope.openSprints = _.filter(sprints, function(sprint) {\n            return !sprint.closed;\n          }).reverse();\n          if (!_this.scope.closedSprints) {\n            _this.scope.closedSprints = [];\n          }\n          _this.scope.sprintsCounter = sprints.length;\n          _this.scope.sprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"sprints:loaded\", sprints);\n          _this.scope.currentSprint = _this.findCurrentSprint();\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.restoreFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = this.scope.oldSelectedTags;\n      selectedStatuses = this.scope.oldSelectedStatuses;\n      if (!selectedStatuses && !selectedStatuses) {\n        return;\n      }\n      this.scope.filtersQ = this.scope.filtersQOld;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = true;\n            return _this.selectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.resetFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = _.filter(this.scope.filters.tags, \"selected\");\n      selectedStatuses = _.filter(this.scope.filters.status, \"selected\");\n      this.scope.oldSelectedTags = selectedTags;\n      this.scope.oldSelectedStatuses = selectedStatuses;\n      this.scope.filtersQOld = this.scope.filtersQ;\n      this.scope.filtersQ = void 0;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = false;\n            return _this.unselectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.loadUserstories = function() {\n      var promise;\n      this.scope.httpParams = this.getUrlFilters();\n      this.rs.userstories.storeQueryParams(this.scope.projectId, this.scope.httpParams);\n      promise = this.rs.userstories.listUnassigned(this.scope.projectId, this.scope.httpParams);\n      return promise.then((function(_this) {\n        return function(userstories) {\n          _this.scope.userstories = _.sortBy(userstories, \"backlog_order\");\n          _this.setSearchDataFilters();\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\");\n          });\n          return userstories;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadBacklog = function() {\n      return this.q.all([this.loadProjectStats(), this.loadSprints(), this.loadUserstories()]);\n    };\n\n    BacklogController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.closedMilestones = !!project.total_closed_milestones;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"id\");\n          return project;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.initializeSubscription();\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadBacklog();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.generateFilters();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.scope.$emit(\"backlog:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    BacklogController.prototype.resortUserStories = function(uses, field) {\n      var index, item, items, j, len;\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      items = [];\n      for (index = j = 0, len = uses.length; j < len; index = ++j) {\n        item = uses[index];\n        item[field] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    BacklogController.prototype.moveUs = function(ctx, usList, newUsIndex, newSprintId) {\n      var data, items, j, l, len, len1, len2, m, movedFromClosedSprint, movedToClosedSprint, newSprint, oldSprintId, project, promise, promises, sprint, us, userstories;\n      oldSprintId = usList[0].milestone;\n      project = usList[0].project;\n      movedFromClosedSprint = false;\n      movedToClosedSprint = false;\n      sprint = this.scope.sprintsById[oldSprintId];\n      if (!sprint && this.scope.closedSprintsById) {\n        sprint = this.scope.closedSprintsById[oldSprintId];\n        if (sprint) {\n          movedFromClosedSprint = true;\n        }\n      }\n      newSprint = this.scope.sprintsById[newSprintId];\n      if (!newSprint && newSprintId) {\n        newSprint = this.scope.closedSprintsById[newSprintId];\n        if (newSprint) {\n          movedToClosedSprint = true;\n        }\n      }\n      if (newSprintId === oldSprintId) {\n        items = null;\n        userstories = null;\n        if (newSprintId === null) {\n          userstories = this.scope.userstories;\n        } else {\n          userstories = newSprint.user_stories;\n        }\n        this.scope.$apply(function() {\n          var args, j, key, len, r, us;\n          for (key = j = 0, len = usList.length; j < len; key = ++j) {\n            us = usList[key];\n            r = userstories.indexOf(us);\n            userstories.splice(r, 1);\n          }\n          args = [newUsIndex, 0].concat(usList);\n          return Array.prototype.splice.apply(userstories, args);\n        });\n        if (newSprintId === null) {\n          items = this.resortUserStories(userstories, \"backlog_order\");\n          data = this.prepareBulkUpdateData(items, \"backlog_order\");\n          this.rs.userstories.bulkUpdateBacklogOrder(project, data).then((function(_this) {\n            return function() {\n              var j, len, results, us;\n              results = [];\n              for (j = 0, len = usList.length; j < len; j++) {\n                us = usList[j];\n                results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n              }\n              return results;\n            };\n          })(this));\n        } else {\n          items = this.resortUserStories(userstories, \"sprint_order\");\n          data = this.prepareBulkUpdateData(items, \"sprint_order\");\n          this.rs.userstories.bulkUpdateSprintOrder(project, data).then((function(_this) {\n            return function() {\n              var j, len, results, us;\n              results = [];\n              for (j = 0, len = usList.length; j < len; j++) {\n                us = usList[j];\n                results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n              }\n              return results;\n            };\n          })(this));\n        }\n        return promise;\n      }\n      if (newSprintId === null) {\n        for (j = 0, len = usList.length; j < len; j++) {\n          us = usList[j];\n          us.milestone = null;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, l, len1, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(_this.scope.userstories, args);\n            results = [];\n            for (key = l = 0, len1 = usList.length; l < len1; key = ++l) {\n              us = usList[key];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n        promise = this.repo.save(us);\n        promise = promise.then((function(_this) {\n          return function() {\n            items = _this.resortUserStories(_this.scope.userstories, \"backlog_order\");\n            data = _this.prepareBulkUpdateData(items, \"backlog_order\");\n            return _this.rs.userstories.bulkUpdateBacklogOrder(us.project, data).then(function() {\n              _this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId);\n              if (movedFromClosedSprint) {\n                return _this.rootscope.$broadcast(\"backlog:load-closed-sprints\");\n              }\n            });\n          };\n        })(this));\n        promise.then(null, function() {\n          return console.log(\"FAIL\");\n        });\n        return promise;\n      }\n      if (oldSprintId === null) {\n        for (l = 0, len1 = usList.length; l < len1; l++) {\n          us = usList[l];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, len2, m, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (key = m = 0, len2 = usList.length; m < len2; key = ++m) {\n              us = usList[key];\n              r = _this.scope.userstories.indexOf(us);\n              results.push(_this.scope.userstories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      } else {\n        for (m = 0, len2 = usList.length; m < len2; m++) {\n          us = usList[m];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, len3, n, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (n = 0, len3 = usList.length; n < len3; n++) {\n              us = usList[n];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      }\n      promises = _.map(usList, (function(_this) {\n        return function(us) {\n          return _this.repo.save(us);\n        };\n      })(this));\n      promise = this.q.all(promises).then((function(_this) {\n        return function() {\n          items = _this.resortUserStories(newSprint.user_stories, \"sprint_order\");\n          data = _this.prepareBulkUpdateData(items, \"sprint_order\");\n          _this.rs.userstories.bulkUpdateSprintOrder(project, data).then(function(result) {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId);\n          });\n          _this.rs.userstories.bulkUpdateBacklogOrder(project, data).then(function() {\n            var len3, n, results;\n            results = [];\n            for (n = 0, len3 = usList.length; n < len3; n++) {\n              us = usList[n];\n              results.push(_this.rootscope.$broadcast(\"sprint:us:moved\", us, oldSprintId, newSprintId));\n            }\n            return results;\n          });\n          if (movedToClosedSprint || movedFromClosedSprint) {\n            return _this.scope.$broadcast(\"backlog:load-closed-sprints\");\n          }\n        };\n      })(this));\n      promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n      return promise;\n    };\n\n    BacklogController.prototype.isFilterSelected = function(type, id) {\n      if ((this.searchdata[type] != null) && this.searchdata[type][id]) {\n        return true;\n      }\n      return false;\n    };\n\n    BacklogController.prototype.setSearchDataFilters = function() {\n      var name, results, urlfilters, val, value;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = this.scope.filtersQ || urlfilters.q;\n      }\n      this.searchdata = {};\n      results = [];\n      for (name in urlfilters) {\n        value = urlfilters[name];\n        if (this.searchdata[name] == null) {\n          this.searchdata[name] = {};\n        }\n        results.push((function() {\n          var j, len, ref1, results1;\n          ref1 = taiga.toString(value).split(\",\");\n          results1 = [];\n          for (j = 0, len = ref1.length; j < len; j++) {\n            val = ref1[j];\n            results1.push(this.searchdata[name][val] = true);\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    BacklogController.prototype.getUrlFilters = function() {\n      return _.pick(this.location.search(), \"status\", \"tags\", \"q\");\n    };\n\n    BacklogController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      urlfilters = this.getUrlFilters();\n      this.scope.filters = {};\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.milestone = 'null';\n      return this.rs.userstories.filtersData(loadFilters).then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, selectedStatuses, selectedTags, tagsFilterFormat;\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.usStatusById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          selectedTags = _.filter(_this.scope.filters.tags, \"selected\");\n          selectedTags = _.map(selectedTags, \"id\");\n          selectedStatuses = _.filter(_this.scope.filters.status, \"selected\");\n          selectedStatuses = _.map(selectedStatuses, \"id\");\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rs.userstories.storeQueryParams(_this.scope.projectId, {\n            \"status\": selectedStatuses,\n            \"tags\": selectedTags,\n            \"project\": _this.scope.projectId,\n            \"milestone\": null\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref1, ref2, results, searchdata, val, value;\n      searchdata = {};\n      ref1 = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref1) {\n        value = ref1[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref2 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref2.length; j < len; j++) {\n          val = ref2[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var l, len1, results1;\n          results1 = [];\n          for (l = 0, len1 = value.length; l < len1; l++) {\n            obj = value[l];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    BacklogController.prototype.updateUserStoryStatus = function() {\n      this.setSearchDataFilters();\n      return this.generateFilters().then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.loadProjectStats();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.editUserStory = function(projectId, ref, $event) {\n      var currentLoading, target;\n      target = $($event.target);\n      currentLoading = this.loading().target(target).removeClasses(\"icon-edit\").timeout(200).start();\n      return this.rs.userstories.getByRef(projectId, ref).then((function(_this) {\n        return function(us) {\n          return _this.rs2.attachments.list(\"us\", us.id, projectId).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", us, attachments.toJS());\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.deleteUserStory = function(us) {\n      var message, title;\n      title = this.translate.instant(\"US.TITLE_DELETE_ACTION\");\n      message = us.subject;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var promise;\n          _this.scope.userstories = _.without(_this.scope.userstories, us);\n          promise = _this.repo.remove(us);\n          promise.then(function() {\n            askResponse.finish();\n            return _this.loadBacklog();\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.addNewUs = function(type) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, this.scope.project.default_us_status, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, this.scope.project.default_us_status);\n      }\n    };\n\n    BacklogController.prototype.addNewSprint = function() {\n      return this.rootscope.$broadcast(\"sprintform:create\", this.scope.projectId);\n    };\n\n    BacklogController.prototype.findCurrentSprint = function() {\n      var currentDate;\n      currentDate = new Date().getTime();\n      return _.find(this.scope.sprints, function(sprint) {\n        var end, start;\n        start = moment(sprint.estimated_start, 'YYYY-MM-DD').format('x');\n        end = moment(sprint.estimated_finish, 'YYYY-MM-DD').format('x');\n        return currentDate >= start && currentDate <= end;\n      });\n    };\n\n    return BacklogController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BacklogController\", BacklogController);\n\n  BacklogDirective = function($repo, $rootscope, $translate) {\n    var doomLineTemplate, link, linkDoomLine, linkFilters, linkToolbar, showHideFilter, showHideTags;\n    doomLineTemplate = _.template(\"<div class=\\\"doom-line\\\"><span><%- text %></span></div>\");\n    linkDoomLine = function($scope, $el, $attrs, $ctrl) {\n      var addDoomLineDom, getUsItems, reloadDoomLine, removeDoomlineDom;\n      reloadDoomLine = function() {\n        var current_sum, domElement, i, j, len, ref1, results, stats, total_points, us;\n        if (($scope.stats != null) && ($scope.stats.total_points != null) && $scope.stats.total_points !== 0) {\n          removeDoomlineDom();\n          stats = $scope.stats;\n          total_points = stats.total_points;\n          current_sum = stats.assigned_points;\n          if (!$scope.userstories) {\n            return;\n          }\n          ref1 = $scope.userstories;\n          results = [];\n          for (i = j = 0, len = ref1.length; j < len; i = ++j) {\n            us = ref1[i];\n            current_sum += us.total_points;\n            if (current_sum > total_points) {\n              domElement = $el.find('.backlog-table-body .us-item-row')[i];\n              addDoomLineDom(domElement);\n              break;\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        }\n      };\n      removeDoomlineDom = function() {\n        return $el.find(\".doom-line\").remove();\n      };\n      addDoomLineDom = function(element) {\n        var text;\n        text = $translate.instant(\"BACKLOG.DOOMLINE\");\n        return $(element).before(doomLineTemplate({\n          \"text\": text\n        }));\n      };\n      getUsItems = function() {\n        var rowElements;\n        rowElements = $el.find('.backlog-table-body .us-item-row');\n        return _.map(rowElements, function(x) {\n          return angular.element(x);\n        });\n      };\n      $scope.$on(\"userstories:loaded\", reloadDoomLine);\n      return $scope.$watch(\"stats\", reloadDoomLine);\n    };\n    linkToolbar = function($scope, $el, $attrs, $ctrl) {\n      var checkSelected, getUsToMove, lastChecked, moveToCurrentSprint, moveToLatestSprint, moveUssToSprint, shiftPressed;\n      getUsToMove = function() {\n        var ussDom;\n        ussDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        return _.map(ussDom, function(item) {\n          var itemScope;\n          item = $(item).closest('.tg-scope');\n          itemScope = item.scope();\n          itemScope.us.milestone = $scope.sprints[0].id;\n          return itemScope.us;\n        });\n      };\n      moveUssToSprint = function(selectedUss, sprint) {\n        var extraPoints, totalExtraPoints, ussCurrent;\n        ussCurrent = _($scope.userstories);\n        $scope.userstories = ussCurrent.without.apply(ussCurrent, selectedUss).value();\n        extraPoints = _.map(selectedUss, function(v, k) {\n          return v.total_points;\n        });\n        totalExtraPoints = _.reduce(extraPoints, function(acc, num) {\n          return acc + num;\n        });\n        sprint.user_stories = _.union(sprint.user_stories, selectedUss);\n        sprint.total_points += totalExtraPoints;\n        $repo.saveAll(selectedUss).then(function() {\n          $ctrl.loadSprints();\n          return $ctrl.loadProjectStats();\n        });\n        return $el.find(\".move-to-sprint\").hide();\n      };\n      moveToCurrentSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.currentSprint);\n      };\n      moveToLatestSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.sprints[0]);\n      };\n      shiftPressed = false;\n      lastChecked = null;\n      checkSelected = function(target) {\n        var moveToSprintDom, selectedUsDom;\n        lastChecked = target.closest(\".us-item-row\");\n        target.closest('.us-item-row').toggleClass('ui-multisortable-multiple');\n        moveToSprintDom = $el.find(\".move-to-sprint\");\n        selectedUsDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        if (selectedUsDom.length > 0 && $scope.sprints.length > 0) {\n          return moveToSprintDom.show();\n        } else {\n          return moveToSprintDom.hide();\n        }\n      };\n      $(window).on(\"keydown.shift-pressed keyup.shift-pressed\", function(event) {\n        shiftPressed = !!event.shiftKey;\n        return true;\n      });\n      $el.on(\"change\", \".backlog-table-body input:checkbox\", function(event) {\n        var current, elements, nextAll, prevAll, target;\n        if (lastChecked && shiftPressed) {\n          elements = [];\n          current = $(event.currentTarget).closest(\".us-item-row\");\n          nextAll = lastChecked.nextAll();\n          prevAll = lastChecked.prevAll();\n          if (_.some(nextAll, function(next) {\n            return next === current[0];\n          })) {\n            elements = lastChecked.nextUntil(current);\n          } else if (_.some(prevAll, function(prev) {\n            return prev === current[0];\n          })) {\n            elements = lastChecked.prevUntil(current);\n          }\n          _.map(elements, function(elm) {\n            var input;\n            input = $(elm).find(\"input:checkbox\");\n            input.prop('checked', true);\n            return checkSelected(input);\n          });\n        }\n        target = angular.element(event.currentTarget);\n        target.closest(\".us-item-row\").toggleClass('is-checked');\n        return checkSelected(target);\n      });\n      $el.on(\"click\", \"#move-to-latest-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToLatestSprint, ussToMove));\n        };\n      })(this));\n      $el.on(\"click\", \"#move-to-current-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        };\n      })(this));\n      return $el.on(\"click\", \"#show-tags\", function(event) {\n        event.preventDefault();\n        $ctrl.toggleShowTags();\n        return showHideTags($ctrl);\n      });\n    };\n    showHideTags = function($ctrl) {\n      var elm, text;\n      elm = angular.element(\"#show-tags\");\n      if ($ctrl.showTags) {\n        elm.addClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.HIDE\");\n        return elm.text(text);\n      } else {\n        elm.removeClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.SHOW\");\n        return elm.text(text);\n      }\n    };\n    showHideFilter = function($scope, $el, $ctrl) {\n      var hideText, showText, sidebar, target;\n      sidebar = $el.find(\"sidebar.filters-bar\");\n      sidebar.one(\"transitionend\", function() {\n        return timeout(150, function() {\n          $rootscope.$broadcast(\"resize\");\n          return $('.burndown').css(\"visibility\", \"visible\");\n        });\n      });\n      target = angular.element(\"#show-filters-button\");\n      $('.burndown').css(\"visibility\", \"hidden\");\n      sidebar.toggleClass(\"active\");\n      target.toggleClass(\"active\");\n      hideText = $translate.instant(\"BACKLOG.FILTERS.HIDE\");\n      showText = $translate.instant(\"BACKLOG.FILTERS.SHOW\");\n      toggleText(target, [hideText, showText]);\n      if (!sidebar.hasClass(\"active\")) {\n        $ctrl.resetFilters();\n      } else {\n        $ctrl.restoreFilters();\n      }\n      return $ctrl.toggleActiveFilters();\n    };\n    linkFilters = function($scope, $el, $attrs, $ctrl) {\n      $scope.filtersSearch = {};\n      return $el.on(\"click\", \"#show-filters-button\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return showHideFilter($scope, $el, $ctrl);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs, $rootscope) {\n      var $ctrl, filters;\n      $ctrl = $el.controller();\n      linkToolbar($scope, $el, $attrs, $ctrl);\n      linkFilters($scope, $el, $attrs, $ctrl);\n      linkDoomLine($scope, $el, $attrs, $ctrl);\n      $el.find(\".backlog-table-body\").disableSelection();\n      filters = $ctrl.getUrlFilters();\n      if (filters.status || filters.tags || filters.q) {\n        showHideFilter($scope, $el, $ctrl);\n      }\n      $scope.$on(\"showTags\", function() {\n        return showHideTags($ctrl);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $(window).off(\".shift-pressed\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklog\", [\"$tgRepo\", \"$rootScope\", \"$translate\", BacklogDirective]);\n\n  UsRolePointsSelectorDirective = function($rootscope, $template, $compile, $translate) {\n    var link, selectionTemplate;\n    selectionTemplate = $template.get(\"backlog/us-role-points-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var numberOfRoles, roles;\n        roles = _.filter(project.roles, \"computable\");\n        numberOfRoles = _.size(roles);\n        if (numberOfRoles > 1) {\n          return $el.append($compile(selectionTemplate({\n            \"roles\": roles\n          }))($scope));\n        } else {\n          $el.find(\".icon-arrow-bottom\").remove();\n          return $el.find(\".header-points\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        $el.find(\".popover\").popover().close();\n        return $el.find(\".header-points\").html(roleName + \"/<span>Total</span>\");\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx, roleId) {\n        var text;\n        $el.find(\".popover\").popover().close();\n        text = $translate.instant(\"COMMON.FIELDS.POINTS\");\n        return $el.find(\".header-points\").text(text);\n      });\n      $el.on(\"click\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (target.is(\"span\") || target.is(\"div\")) {\n          event.stopPropagation();\n        }\n        return $el.find(\".popover\").popover().open();\n      });\n      $el.on(\"click\", \".clear-selection\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $rootscope.$broadcast(\"uspoints:clear-selection\");\n      });\n      $el.on(\"click\", \".role\", function(event) {\n        var rolScope, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        rolScope = target.scope();\n        return $rootscope.$broadcast(\"uspoints:select\", target.data(\"role-id\"), target.text());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsRolePointsSelector\", [\"$rootScope\", \"$tgTemplate\", \"$compile\", \"$translate\", UsRolePointsSelectorDirective]);\n\n  UsPointsDirective = function($tgEstimationsService, $repo, $tgTemplate) {\n    var link, rolesTemplate;\n    rolesTemplate = $tgTemplate.get(\"common/estimation/us-points-roles-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, bindClickElements, estimationProcess, filteringRoleId, renderRolesSelector, selectedRoleId, updatingSelectedRoleId;\n      $ctrl = $el.controller();\n      updatingSelectedRoleId = null;\n      selectedRoleId = null;\n      filteringRoleId = null;\n      estimationProcess = null;\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = roleId;\n        return estimationProcess.render();\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = null;\n        return estimationProcess.render();\n      });\n      $scope.$watch($attrs.tgBacklogUsPoints, function(us) {\n        var roles;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          roles = estimationProcess.calculateRoles();\n          if (roles.length === 0) {\n            $el.find(\".icon-arrow-bottom\").remove();\n            $el.find(\"a.us-points\").addClass(\"not-clickable\");\n          } else if (roles.length === 1) {\n            selectedRoleId = _.keys(us.points)[0];\n          }\n          if (estimationProcess.isEditable) {\n            bindClickElements();\n          }\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return this.save(roleId, pointId).then(function() {\n              return $ctrl.loadProjectStats();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, pointId, pointObj, template, text, title, totalPoints;\n            totalPoints = this.calculateTotalPoints();\n            if ((selectedRoleId == null) || roles.length === 1) {\n              text = totalPoints;\n              title = totalPoints;\n            } else {\n              pointId = this.us.points[selectedRoleId];\n              pointObj = this.pointsById[pointId];\n              text = pointObj.name + \" / <span>\" + totalPoints + \"</span>\";\n              title = pointObj.name + \" / \" + totalPoints;\n            }\n            ctx = {\n              totalPoints: totalPoints,\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              text: text,\n              title: title\n            };\n            mainTemplate = \"common/estimation/us-estimation-total.html\";\n            template = $tgTemplate.get(mainTemplate, true);\n            html = template(ctx);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      renderRolesSelector = function() {\n        var html, roles;\n        roles = estimationProcess.calculateRoles();\n        html = rolesTemplate({\n          \"roles\": roles\n        });\n        $el.append(html);\n        return $el.find(\".pop-role\").popover().open(function() {\n          return $(this).remove();\n        });\n      };\n      bindClickElements = function() {\n        $el.on(\"click\", \"a.us-points span\", function(event) {\n          var us;\n          event.preventDefault();\n          event.stopPropagation();\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = selectedRoleId;\n          if (selectedRoleId != null) {\n            return estimationProcess.renderPointsSelector(selectedRoleId);\n          } else {\n            return renderRolesSelector();\n          }\n        });\n        return $el.on(\"click\", \".role\", function(event) {\n          var popRolesDom, target, us;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = target.data(\"role-id\");\n          popRolesDom = $el.find(\".pop-role\");\n          popRolesDom.find(\"a\").removeClass(\"active\");\n          popRolesDom.find(\"a[data-role-id='\" + updatingSelectedRoleId + \"']\").addClass(\"active\");\n          return estimationProcess.renderPointsSelector(updatingSelectedRoleId);\n        });\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogUsPoints\", [\"$tgEstimationsService\", \"$tgRepo\", \"$tgTemplate\", UsPointsDirective]);\n\n  ToggleBurndownVisibility = function($storage) {\n    var hide, link, show;\n    hide = function() {\n      $(\".js-burndown-graph\").removeClass(\"shown\");\n      $(\".js-toggle-burndown-visibility-button\").removeClass(\"active\");\n      return $(\".js-burndown-graph\").removeClass(\"open\");\n    };\n    show = function(firstLoad) {\n      $(\".js-toggle-burndown-visibility-button\").addClass(\"active\");\n      if (firstLoad) {\n        return $(\".js-burndown-graph\").addClass(\"shown\");\n      } else {\n        return $(\".js-burndown-graph\").addClass(\"open\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var firstLoad, hash, toggleGraph;\n      firstLoad = true;\n      hash = generateHash([\"is-burndown-grpahs-collapsed\"]);\n      $scope.isBurndownGraphCollapsed = $storage.get(hash) || false;\n      toggleGraph = function() {\n        if ($scope.isBurndownGraphCollapsed) {\n          hide(firstLoad);\n        } else {\n          show(firstLoad);\n        }\n        return firstLoad = false;\n      };\n      $scope.$watch(\"showGraphPlaceholder\", function() {\n        if ($scope.showGraphPlaceholder != null) {\n          $scope.isBurndownGraphCollapsed = $scope.isBurndownGraphCollapsed || $scope.showGraphPlaceholder;\n          return toggleGraph();\n        }\n      });\n      $el.on(\"click\", \".js-toggle-burndown-visibility-button\", function() {\n        $scope.isBurndownGraphCollapsed = !$scope.isBurndownGraphCollapsed;\n        $storage.set(hash, $scope.isBurndownGraphCollapsed);\n        return toggleGraph();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleBurndownVisibility\", [\"$tgStorage\", ToggleBurndownVisibility]);\n\n  BurndownBacklogGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var client_increment_line, colors, data, evolution_line, j, milestonesRange, optimal_line, options, ref1, results, team_increment_line, width, zero_line;\n      width = element.width();\n      element.height(width / 6);\n      milestonesRange = (function() {\n        results = [];\n        for (var j = 0, ref1 = dataToDraw.milestones.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; 0 <= ref1 ? j++ : j--){ results.push(j); }\n        return results;\n      }).apply(this);\n      data = [];\n      zero_line = _.map(dataToDraw.milestones, function(ml) {\n        return 0;\n      });\n      data.push({\n        data: _.zip(milestonesRange, zero_line),\n        lines: {\n          fillColor: \"rgba(0,0,0,0)\"\n        },\n        points: {\n          show: false\n        }\n      });\n      optimal_line = _.map(dataToDraw.milestones, function(ml) {\n        return ml.optimal;\n      });\n      data.push({\n        data: _.zip(milestonesRange, optimal_line),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      evolution_line = _.filter(_.map(dataToDraw.milestones, function(ml) {\n        return ml.evolution;\n      }), function(evolution) {\n        return evolution != null;\n      });\n      data.push({\n        data: _.zip(milestonesRange, evolution_line),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      client_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"] - ml[\"client-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, client_increment_line),\n        lines: {\n          fillColor: \"rgba(255,51,51,0.3)\"\n        }\n      });\n      team_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, team_increment_line),\n        lines: {\n          fillColor: \"rgba(153,51,51,0.3)\"\n        }\n      });\n      colors = [\"rgba(0,0,0,1)\", \"rgba(120,120,120,0.2)\", \"rgba(102,153,51,1)\", \"rgba(153,51,51,1)\", \"rgba(255,51,51,1)\"];\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: \"#ccc\",\n          hoverable: true\n        },\n        xaxis: {\n          ticks: dataToDraw.milestones.length,\n          axisLabel: $translate.instant(\"BACKLOG.CHART.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5,\n          tickFormatter: function(val, axis) {\n            return \"\";\n          }\n        },\n        yaxis: {\n          axisLabel: $translate.instant(\"BACKLOG.CHART.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: colors,\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var ctx;\n            if (flotItem.seriesIndex === 1) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.OPTIMAL\", ctx);\n            } else if (flotItem.seriesIndex === 2) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.REAL\", ctx);\n            } else if (flotItem.seriesIndex === 3) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_CLIENT\", ctx);\n            } else {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_TEAM\", ctx);\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch(\"stats\", function(value) {\n        if ($scope.stats != null) {\n          redrawChart(element, $scope.stats);\n          return $scope.$on(\"resize\", function() {\n            return redrawChart(element, $scope.stats);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBurndownBacklogGraph\", [\"$translate\", BurndownBacklogGraphDirective]);\n\n  TgBacklogProgressBarDirective = function($template, $compile) {\n    var adjustPercentaje, link, render, template;\n    template = $template.get(\"backlog/progress-bar.html\", true);\n    render = function(scope, el, projectPointsPercentaje, closedPointsPercentaje) {\n      var html;\n      html = template({\n        projectPointsPercentaje: projectPointsPercentaje,\n        closedPointsPercentaje: closedPointsPercentaje\n      });\n      html = $compile(html)(scope);\n      return el.html(html);\n    };\n    adjustPercentaje = function(percentage) {\n      var adjusted;\n      adjusted = _.max([0, percentage]);\n      adjusted = _.min([100, adjusted]);\n      return Math.round(adjusted);\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgBacklogProgressBar, function(stats) {\n        var closedPoints, closedPointsPercentaje, definedPoints, projectPointsPercentaje, totalPoints;\n        if (stats != null) {\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          definedPoints = stats.defined_points;\n          closedPoints = stats.closed_points;\n          if (definedPoints > totalPoints) {\n            projectPointsPercentaje = totalPoints * 100 / definedPoints;\n            closedPointsPercentaje = closedPoints * 100 / definedPoints;\n          } else {\n            projectPointsPercentaje = 100;\n            closedPointsPercentaje = closedPoints * 100 / totalPoints;\n          }\n          projectPointsPercentaje = adjustPercentaje(projectPointsPercentaje - 3);\n          closedPointsPercentaje = adjustPercentaje(closedPointsPercentaje - 3);\n          return render($scope, $el, projectPointsPercentaje, closedPointsPercentaje);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogProgressBar\", [\"$tgTemplate\", \"$compile\", TgBacklogProgressBarDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sortable.coffee\n */\n\n(function() {\n  var BacklogEmptySortableDirective, BacklogSortableDirective, SprintSortableDirective, bindOnce, deleteElement, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  deleteElement = function(el) {\n    el.scope().$destroy();\n    el.off();\n    return el.remove();\n  };\n\n  BacklogSortableDirective = function($repo, $rs, $rootscope, $tgConfirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var getUsIndex;\n      getUsIndex = (function(_this) {\n        return function(us) {\n          return $(us).index(\".backlog-table-body .row\");\n        };\n      })(this);\n      bindOnce($scope, \"project\", function(project) {\n        var filterError;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        filterError = function() {\n          var text;\n          text = $translate.instant(\"BACKLOG.SORTABLE_FILTER_ERROR\");\n          return $tgConfirm.notify(\"error\", text);\n        };\n        $el.sortable({\n          items: \".us-item-row\",\n          cancel: \".popover\",\n          connectWith: \".sprint\",\n          dropOnEmpty: true,\n          placeholder: \"row us-item-row us-item-drag sortable-placeholder\",\n          scroll: true,\n          disableHorizontalScroll: true,\n          tolerance: \"pointer\",\n          revert: false,\n          start: function() {\n            return $(document.body).addClass(\"drag-active\");\n          },\n          stop: function() {\n            $(document.body).removeClass(\"drag-active\");\n            if ($el.hasClass(\"active-filters\")) {\n              $el.sortable(\"cancel\");\n              return filterError();\n            }\n          }\n        });\n        $el.on(\"multiplesortreceive\", function(event, ui) {\n          var itemIndex, itemUs;\n          if ($el.hasClass(\"active-filters\")) {\n            ui.source.sortable(\"cancel\");\n            filterError();\n            return;\n          }\n          itemUs = ui.item.scope().us;\n          itemIndex = getUsIndex(ui.item);\n          deleteElement(ui.item);\n          $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, null);\n          return ui.item.find('a').removeClass('noclick');\n        });\n        $el.on(\"multiplesortstop\", function(event, ui) {\n          var index, items, us;\n          if ($(ui.items[0]).parent().length === 0) {\n            return;\n          }\n          if ($el.hasClass(\"active-filters\")) {\n            return;\n          }\n          items = _.sortBy(ui.items, function(item) {\n            return $(item).index();\n          });\n          index = _.min(_.map(items, function(item) {\n            return getUsIndex(item);\n          }));\n          us = _.map(items, function(item) {\n            var itemUs;\n            item = $(item);\n            itemUs = item.scope().us;\n            setTimeout(((function(_this) {\n              return function() {\n                return item.find('a').removeClass('noclick');\n              };\n            })(this)), 300);\n            return itemUs;\n          });\n          return $scope.$emit(\"sprint:us:move\", us, index, null);\n        });\n        return $el.on(\"sortstart\", function(event, ui) {\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BacklogEmptySortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          $el.sortable({\n            items: \".us-item-row\",\n            dropOnEmpty: true\n          });\n          return $el.on(\"sortreceive\", function(event, ui) {\n            var itemIndex, itemUs;\n            itemUs = ui.item.scope().us;\n            itemIndex = ui.item.index();\n            deleteElement(ui.item);\n            $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, null);\n            return ui.item.find('a').removeClass('noclick');\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  SprintSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          $el.sortable({\n            scroll: true,\n            dropOnEmpty: true,\n            items: \".sprint-table .milestone-us-item-row\",\n            disableHorizontalScroll: true,\n            connectWith: \".sprint,.backlog-table-body,.empty-backlog\",\n            placeholder: \"row us-item-row sortable-placeholder\",\n            forcePlaceholderSize: true\n          });\n          $el.on(\"multiplesortreceive\", function(event, ui) {\n            var index, items, us;\n            items = _.sortBy(ui.items, function(item) {\n              return $(item).index();\n            });\n            index = _.min(_.map(items, function(item) {\n              return $(item).index();\n            }));\n            us = _.map(items, function(item) {\n              var itemUs;\n              item = $(item);\n              itemUs = item.scope().us;\n              deleteElement(item);\n              return itemUs;\n            });\n            return $scope.$emit(\"sprint:us:move\", us, index, $scope.sprint.id);\n          });\n          $el.on(\"multiplesortstop\", function(event, ui) {\n            var itemIndex, itemUs;\n            if (ui.item.parent().length === 0) {\n              return;\n            }\n            itemUs = ui.item.scope().us;\n            itemIndex = ui.item.index();\n            setTimeout(((function(_this) {\n              return function() {\n                return ui.item.find('a').removeClass('noclick');\n              };\n            })(this)), 300);\n            return $scope.$emit(\"sprint:us:move\", [itemUs], itemIndex, $scope.sprint.id);\n          });\n          return $el.on(\"sortstart\", function(event, ui) {\n            return ui.item.find('a').addClass('noclick');\n          });\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgConfirm\", \"$translate\", BacklogSortableDirective]);\n\n  module.directive(\"tgBacklogEmptySortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", BacklogEmptySortableDirective]);\n\n  module.directive(\"tgSprintSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", SprintSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sprints.coffee\n */\n\n(function() {\n  var BacklogSprintDirective, BacklogSprintHeaderDirective, ToggleExcludeClosedSprintsVisualization, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogSprintDirective = function($repo, $rootscope) {\n    var link, slideOptions, sprintTableMinHeight, toggleSprint;\n    sprintTableMinHeight = 50;\n    slideOptions = {\n      duration: 500,\n      easing: 'linear'\n    };\n    toggleSprint = (function(_this) {\n      return function($el) {\n        var sprintArrow, sprintTable;\n        sprintTable = $el.find(\".sprint-table\");\n        sprintArrow = $el.find(\".icon-arrow-up\");\n        sprintArrow.toggleClass('active');\n        return sprintTable.toggleClass('open');\n      };\n    })(this);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch($attrs.tgBacklogSprint, function(sprint) {\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        if (sprint.closed) {\n          return $el.addClass(\"sprint-closed\");\n        } else {\n          return toggleSprint($el);\n        }\n      });\n      $el.on(\"click\", \".sprint-name > .icon-arrow-up\", function(event) {\n        event.preventDefault();\n        toggleSprint($el);\n        return $el.find(\".sprint-table\").slideToggle(slideOptions);\n      });\n      $el.on(\"click\", \".sprint-name > .icon-edit\", function(event) {\n        var sprint;\n        event.preventDefault();\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        return $rootscope.$broadcast(\"sprintform:edit\", sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSprint\", [\"$tgRepo\", \"$rootScope\", BacklogSprintDirective]);\n\n  BacklogSprintHeaderDirective = function($navUrls, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"backlog/sprint-header.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, isVisible, prettyDate, render;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_milestone\") !== -1;\n      };\n      isVisible = function() {\n        return $scope.project.my_permissions.indexOf(\"view_milestones\") !== -1;\n      };\n      render = function(sprint) {\n        var compiledTemplate, ctx, estimatedDateRange, finish, start, taskboardUrl, templateScope;\n        taskboardUrl = $navUrls.resolve(\"project-taskboard\", {\n          project: $scope.project.slug,\n          sprint: sprint.slug\n        });\n        start = moment(sprint.estimated_start).format(prettyDate);\n        finish = moment(sprint.estimated_finish).format(prettyDate);\n        estimatedDateRange = start + \"-\" + finish;\n        ctx = {\n          name: sprint.name,\n          taskboardUrl: taskboardUrl,\n          estimatedDateRange: estimatedDateRange,\n          closedPoints: sprint.closed_points || 0,\n          totalPoints: sprint.total_points || 0,\n          isVisible: isVisible(),\n          isEditable: isEditable()\n        };\n        templateScope = $scope.$new();\n        _.assign(templateScope, ctx);\n        compiledTemplate = $compile(template)(templateScope);\n        return $el.html(compiledTemplate);\n      };\n      $scope.$watch($attrs.ngModel, function(sprint) {\n        return render(sprint);\n      });\n      $scope.$on(\"sprintform:edit:success\", function() {\n        return render($model.$modelValue);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgBacklogSprintHeader\", [\"$tgNavUrls\", \"$tgTemplate\", \"$compile\", \"$translate\", BacklogSprintHeaderDirective]);\n\n  ToggleExcludeClosedSprintsVisualization = function($rootscope, $loading, $translate) {\n    var excludeClosedSprints, link;\n    excludeClosedSprints = true;\n    link = function($scope, $el, $attrs) {\n      var currentLoading, loadingElm;\n      loadingElm = $(\"<div>\");\n      $el.after(loadingElm);\n      currentLoading = null;\n      $el.on(\"click\", function(event) {\n        event.preventDefault();\n        excludeClosedSprints = !excludeClosedSprints;\n        currentLoading = $loading().target(loadingElm).start();\n        if (excludeClosedSprints) {\n          return $rootscope.$broadcast(\"backlog:unload-closed-sprints\");\n        } else {\n          return $rootscope.$broadcast(\"backlog:load-closed-sprints\");\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $scope.$on(\"closed-sprints:reloaded\", (function(_this) {\n        return function(ctx, sprints) {\n          var key, text;\n          currentLoading.finish();\n          if (sprints.length > 0) {\n            key = \"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS\";\n          } else {\n            key = \"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS\";\n          }\n          text = $translate.instant(key);\n          return $el.find(\".text\").text(text);\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogToggleClosedSprintsVisualization\", [\"$rootScope\", \"$tgLoading\", \"$translate\", ToggleExcludeClosedSprintsVisualization]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/charts.coffee\n */\n\n(function() {\n  var SprintGraphDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  SprintGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var data, days, options, width;\n      width = element.width();\n      element.height(240);\n      days = _.map(dataToDraw, function(x) {\n        return moment(x.day);\n      });\n      data = [];\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.optimal_points;\n        })),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.open_points;\n        })),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: '#ccc',\n          hoverable: true\n        },\n        xaxis: {\n          tickSize: [1, \"day\"],\n          min: days[0],\n          max: _.last(days),\n          mode: \"time\",\n          daysNames: days,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        yaxis: {\n          min: 0,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: [\"rgba(102,153,51,1)\", \"rgba(120,120,120,0.2)\"],\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var formattedDate, roundedValue;\n            formattedDate = moment(xval).format($translate.instant(\"TASKBOARD.CHARTS.DATE\"));\n            roundedValue = Math.round(yval);\n            if (flotItem.seriesIndex === 1) {\n              return $translate.instant(\"TASKBOARD.CHARTS.OPTIMAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            } else {\n              return $translate.instant(\"TASKBOARD.CHARTS.REAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$on(\"resize\", function() {\n        if ($scope.stats) {\n          return redrawChart(element, $scope.stats.days);\n        }\n      });\n      $scope.$on(\"taskboard:graph:toggle-visibility\", function() {\n        $el.parent().toggleClass('open');\n        return timeout(100, function() {\n          if ($scope.stats) {\n            return redrawChart(element, $scope.stats.days);\n          }\n        });\n      });\n      $scope.$watch('stats', function(value) {\n        if ($scope.stats == null) {\n          return;\n        }\n        return redrawChart(element, $scope.stats.days);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintGraph\", [\"$translate\", SprintGraphDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkTasksDirective, CreateEditTaskDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  CreateEditTaskDirective = function($repo, $model, $rs, $rootscope, $loading, lightboxService, $translate, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, resetAttachments, submit, submitButton;\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.task.project, 'task');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        console.log(attachmentsToDelete.toJS());\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"task\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      $scope.$on(\"taskform:new\", function(ctx, sprintId, usId) {\n        var create, newTask;\n        $scope.task = {\n          project: $scope.projectId,\n          milestone: sprintId,\n          user_story: usId,\n          is_archived: false,\n          status: $scope.project.default_task_status,\n          assigned_to: null,\n          tags: []\n        };\n        $scope.isNew = true;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        create = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").html(create);\n        newTask = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.TITLE\");\n        $el.find(\".title\").html(newTask + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"taskform:edit\", function(ctx, task, attachments) {\n        var edit, save;\n        $scope.task = task;\n        $scope.isNew = false;\n        $scope.attachments = Immutable.fromJS(attachments);\n        resetAttachments();\n        save = $translate.instant(\"COMMON.SAVE\");\n        edit = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT\");\n        $el.find(\".button-green\").html(save);\n        $el.find(\".title\").html(edit + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      submitButton = $el.find(\".submit-button\");\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.isNew) {\n            promise = $repo.create(\"tasks\", $scope.task);\n            broadcastEvent = \"taskform:new:success\";\n          } else {\n            promise = $repo.save($scope.task);\n            broadcastEvent = \"taskform:edit:success\";\n          }\n          promise.then(function(data) {\n            createAttachments(data);\n            deleteAttachments(data);\n            return data;\n          });\n          currentLoading = $loading().target(submitButton).start();\n          return promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootscope.$broadcast(broadcastEvent, data);\n          });\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CreateBulkTasksDirective = function($repo, $rs, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.form = {\n        data: \"\",\n        usId: null\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise, sprintId, usId;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope.form.data;\n          projectId = $scope.projectId;\n          sprintId = $scope.form.sprintId;\n          usId = $scope.form.usId;\n          promise = $rs.tasks.bulkCreate(projectId, sprintId, usId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"taskform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n      $scope.$on(\"taskform:bulk\", function(ctx, sprintId, usId) {\n        lightboxService.open($el);\n        return $scope.form = {\n          data: \"\",\n          sprintId: sprintId,\n          usId: usId\n        };\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaTaskboard\");\n\n  module.directive(\"tgLbCreateEditTask\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$translate\", \"$q\", \"tgAttachmentsService\", CreateEditTaskDirective]);\n\n  module.directive(\"tgLbCreateBulkTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkTasksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var TaskboardController, TaskboardDirective, TaskboardSquishColumnDirective, TaskboardTaskDirective, TaskboardUserDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  toggleText = this.taiga.toggleText;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  TaskboardController = (function(superClass) {\n    extend(TaskboardController, superClass);\n\n    TaskboardController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"tgAppMetaService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskboardController(scope, rootscope, repo, confirm, rs1, params1, q, appMetaService, location, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.appMetaService = appMetaService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"TASKBOARD.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskboardController.prototype._setMeta = function() {\n      var description, prettyDate, title;\n      prettyDate = this.translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      title = this.translate.instant(\"TASKBOARD.PAGE_TITLE\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name\n      });\n      description = this.translate.instant(\"TASKBOARD.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name,\n        startDate: moment(this.scope.sprint.estimated_start).format(prettyDate),\n        endDate: moment(this.scope.sprint.estimated_finish).format(prettyDate),\n        completedPercentage: this.scope.stats.completedPercentage || \"0\",\n        completedPoints: this.scope.stats.completedPointsSum || \"--\",\n        totalPoints: this.scope.stats.totalPointsSum || \"--\",\n        openTasks: this.scope.stats.openTasks || \"--\",\n        totalTasks: this.scope.stats.total_tasks || \"--\"\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskboardController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"taskform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"bulk create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:new:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      this.scope.$on(\"taskboard:task:move\", this.taskMove);\n      return this.scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, task) {\n          var promise;\n          task.assigned_to = userId;\n          promise = _this.repo.save(task);\n          return promise.then(null, function() {\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.initializeSubscription = function() {\n      var routingKey, routingKey1;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".tasks\";\n      this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.refreshTagsColors();\n          _this.loadSprintStats();\n          return _this.loadSprint();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadProject = function() {\n      return this.rs.projects.get(this.scope.projectId).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(e) {\n            return e.id;\n          });\n          _this.scope.roleById = groupBy(project.roles, function(e) {\n            return e.id;\n          });\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(e) {\n            return e.id;\n          });\n          _this.scope.$emit('project:loaded', project);\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return project;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprintStats = function() {\n      return this.rs.sprints.stats(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(stats) {\n          var completedPointsSum, remainingPointsSum, remainingTasks, totalPointsSum;\n          totalPointsSum = _.reduce(_.values(stats.total_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          completedPointsSum = _.reduce(_.values(stats.completed_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          remainingPointsSum = totalPointsSum - completedPointsSum;\n          remainingTasks = stats.total_tasks - stats.completed_tasks;\n          _this.scope.stats = stats;\n          _this.scope.stats.totalPointsSum = totalPointsSum;\n          _this.scope.stats.completedPointsSum = completedPointsSum;\n          _this.scope.stats.remainingPointsSum = remainingPointsSum;\n          _this.scope.stats.remainingTasks = remainingTasks;\n          if (stats.totalPointsSum) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.completedPointsSum / stats.totalPointsSum);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.stats.openTasks = stats.total_tasks - stats.completed_tasks;\n          return stats;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprint = function() {\n      return this.rs.sprints.get(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(sprint) {\n          _this.scope.sprint = sprint;\n          _this.scope.userstories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          return sprint;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(tasks) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, task, us, usId;\n          _this.scope.tasks = _.sortBy(tasks, 'taskboard_order');\n          _this.scope.usTasks = {};\n          ref = _.union(_this.scope.userstories, [\n            {\n              id: null\n            }\n          ]);\n          for (i = 0, len = ref.length; i < len; i++) {\n            us = ref[i];\n            _this.scope.usTasks[us.id] = {};\n            ref1 = _this.scope.taskStatusList;\n            for (j = 0, len1 = ref1.length; j < len1; j++) {\n              status = ref1[j];\n              _this.scope.usTasks[us.id][status.id] = [];\n            }\n          }\n          ref2 = _this.scope.tasks;\n          for (k = 0, len2 = ref2.length; k < len2; k++) {\n            task = ref2[k];\n            if ((_this.scope.usTasks[task.user_story] != null) && (_this.scope.usTasks[task.user_story][task.status] != null)) {\n              _this.scope.usTasks[task.user_story][task.status].push(task);\n            }\n          }\n          if (tasks.length === 0) {\n            if (_this.scope.userstories.length > 0) {\n              usId = _this.scope.userstories[0].id;\n            } else {\n              usId = null;\n            }\n            _this.scope.usTasks[usId][_this.scope.taskStatusList[0].id].push({\n              isPlaceholder: true\n            });\n          }\n          return tasks;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTaskboard = function() {\n      return this.q.all([\n        this.refreshTagsColors(), this.loadSprintStats(), this.loadSprint().then((function(_this) {\n          return function() {\n            return _this.loadTasks();\n          };\n        })(this))\n      ]);\n    };\n\n    TaskboardController.prototype.loadInitialData = function() {\n      var params, promise;\n      params = {\n        pslug: this.params.pslug,\n        sslug: this.params.sslug\n      };\n      promise = this.repo.resolve(params).then((function(_this) {\n        return function(data) {\n          _this.scope.projectId = data.project;\n          _this.scope.sprintId = data.milestone;\n          _this.initializeSubscription();\n          return data;\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTasksOrder = function(tasks) {\n      var data, items;\n      items = this.resortTasks(tasks);\n      data = this.prepareBulkUpdateData(items);\n      return this.rs.tasks.bulkUpdateTaskTaskboardOrder(this.scope.project.id, data);\n    };\n\n    TaskboardController.prototype.resortTasks = function(tasks) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = tasks.length; i < len; index = ++i) {\n        item = tasks[index];\n        item[\"taskboard_order\"] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    TaskboardController.prototype.prepareBulkUpdateData = function(uses) {\n      return _.map(uses, function(x) {\n        return {\n          \"task_id\": x.id,\n          \"order\": x[\"taskboard_order\"]\n        };\n      });\n    };\n\n    TaskboardController.prototype.taskMove = function(ctx, task, usId, statusId, order) {\n      var promise, r, tasks;\n      r = this.scope.usTasks[task.user_story][task.status].indexOf(task);\n      this.scope.usTasks[task.user_story][task.status].splice(r, 1);\n      tasks = this.scope.usTasks[usId][statusId];\n      tasks.splice(order, 0, task);\n      task.user_story = usId;\n      task.status = statusId;\n      task.taskboard_order = order;\n      promise = this.repo.save(task);\n      this.rootscope.$broadcast(\"sprint:task:moved\", task);\n      promise.then((function(_this) {\n        return function() {\n          _this.refreshTasksOrder(tasks);\n          return _this.loadSprintStats();\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function() {\n          return console.log(\"FAIL TASK SAVE\");\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.addNewTask = function(type, us) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"taskform:new\", this.scope.sprintId, us != null ? us.id : void 0);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"taskform:bulk\", this.scope.sprintId, us != null ? us.id : void 0);\n      }\n    };\n\n    TaskboardController.prototype.editTaskAssignedTo = function(task) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", task);\n    };\n\n    return TaskboardController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskboardController\", TaskboardController);\n\n  TaskboardDirective = function($rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, tableBodyDom;\n      $ctrl = $el.controller();\n      $el.on(\"click\", \".toggle-analytics-visibility\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass('active');\n        return $rootscope.$broadcast(\"taskboard:graph:toggle-visibility\");\n      });\n      tableBodyDom = $el.find(\".taskboard-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".taskboard-table-header .taskboard-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboard\", [\"$rootScope\", TaskboardDirective]);\n\n  TaskboardTaskDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $el.disableSelection();\n      $scope.$watch(\"task\", function(task) {\n        if (task.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!task.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      return $el.find(\".icon-edit\").on(\"click\", function(event) {\n        if ($el.find('.icon-edit').hasClass('noclick')) {\n          return;\n        }\n        return $scope.$apply(function() {\n          var currentLoading, target, task;\n          target = $(event.target);\n          currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n          task = $scope.task;\n          return $rs.tasks.getByRef(task.project, task.ref).then((function(_this) {\n            return function(editingTask) {\n              return $rs2.attachments.list(\"task\", editingTask.id, editingTask.project).then(function(attachments) {\n                $rootscope.$broadcast(\"taskform:edit\", editingTask, attachments.toJS());\n                return currentLoading.finish();\n              });\n            };\n          })(this));\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardTask\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", TaskboardTaskDirective]);\n\n  TaskboardSquishColumnDirective = function(rs) {\n    var avatarWidth, link, maxColumnWidth;\n    avatarWidth = 40;\n    maxColumnWidth = 300;\n    link = function($scope, $el, $attrs) {\n      var getCeilWidth, recalculateStatusColumnWidth, recalculateTaskboardWidth, refreshTaskboardTableWidth, setStatusColumnWidth;\n      $scope.$on(\"sprint:task:moved\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      bindOnce($scope, \"usTasks\", function(project) {\n        $scope.statusesFolded = rs.tasks.getStatusColumnModes($scope.project.id);\n        $scope.usFolded = rs.tasks.getUsRowModes($scope.project.id, $scope.sprintId);\n        return recalculateTaskboardWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.statusesFolded[status.id] = !!!$scope.statusesFolded[status.id];\n        rs.tasks.storeStatusColumnModes($scope.projectId, $scope.statusesFolded);\n        return recalculateTaskboardWidth();\n      };\n      $scope.foldUs = function(us) {\n        if (!us) {\n          $scope.usFolded[null] = !!!$scope.usFolded[null];\n        } else {\n          $scope.usFolded[us.id] = !!!$scope.usFolded[us.id];\n        }\n        rs.tasks.storeUsRowModes($scope.projectId, $scope.sprintId, $scope.usFolded);\n        return recalculateTaskboardWidth();\n      };\n      getCeilWidth = (function(_this) {\n        return function(usId, statusId) {\n          var tasks, tasksMatrixSize, width;\n          tasks = $scope.usTasks[usId][statusId].length;\n          if ($scope.statusesFolded[statusId]) {\n            if (tasks && $scope.usFolded[usId]) {\n              tasksMatrixSize = Math.round(Math.sqrt(tasks));\n              width = avatarWidth * tasksMatrixSize;\n            } else {\n              width = avatarWidth;\n            }\n            return width;\n          }\n          return 0;\n        };\n      })(this);\n      setStatusColumnWidth = (function(_this) {\n        return function(statusId, width) {\n          var column;\n          column = $el.find(\".squish-status-\" + statusId);\n          if (width) {\n            return column.css('max-width', width);\n          } else {\n            return column.css(\"max-width\", maxColumnWidth);\n          }\n        };\n      })(this);\n      refreshTaskboardTableWidth = (function(_this) {\n        return function() {\n          var columnWidths, columns, totalWidth;\n          columnWidths = [];\n          columns = $el.find(\".task-colum-name\");\n          columnWidths = _.map(columns, function(column) {\n            return $(column).outerWidth(true);\n          });\n          totalWidth = _.reduce(columnWidths, function(total, width) {\n            return total + width;\n          });\n          return $el.find('.taskboard-table-inner').css(\"width\", totalWidth);\n        };\n      })(this);\n      recalculateStatusColumnWidth = (function(_this) {\n        return function(statusId) {\n          var statusFoldedWidth;\n          statusFoldedWidth = getCeilWidth(null, statusId);\n          _.forEach($scope.userstories, function(us) {\n            var width;\n            width = getCeilWidth(us.id, statusId);\n            if (width > statusFoldedWidth) {\n              return statusFoldedWidth = width;\n            }\n          });\n          return setStatusColumnWidth(statusId, statusFoldedWidth);\n        };\n      })(this);\n      return recalculateTaskboardWidth = (function(_this) {\n        return function() {\n          _.forEach($scope.taskStatusList, function(status) {\n            return recalculateStatusColumnWidth(status.id);\n          });\n          refreshTaskboardTableWidth();\n        };\n      })(this);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSquishColumn\", [\"$tgResources\", TaskboardSquishColumnDirective]);\n\n  TaskboardUserDirective = function($log, $translate) {\n    var clickable, link;\n    clickable = false;\n    link = function($scope, $el, $attrs) {\n      var username_label;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      $scope.$watch('task.assigned_to', function(assigned_to) {\n        var user;\n        user = $scope.usersById[assigned_to];\n        if (user === void 0) {\n          _.assign($scope, {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          });\n        } else {\n          _.assign($scope, {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          });\n        }\n        return username_label.text($scope.name);\n      });\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") > -1) {\n          clickable = true;\n          $el.find(\".avatar-assigned-to\").on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl;\n              if ($el.find('a').hasClass('noclick')) {\n                return;\n              }\n              $ctrl = $el.controller();\n              return $ctrl.editTaskAssignedTo($scope.task);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl;\n            if ($el.find('a').hasClass('noclick')) {\n              return;\n            }\n            $ctrl = $el.controller();\n            return $ctrl.editTaskAssignedTo($scope.task);\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"taskboard/taskboard-user.html\",\n      scope: {\n        \"usersById\": \"=users\",\n        \"project\": \"=\",\n        \"task\": \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgTaskboardUserAvatar\", [\"$log\", \"$translate\", TaskboardUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/sortable.coffee\n */\n\n(function() {\n  var TaskboardSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  TaskboardSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var deleteElement, itemEl, newParentScope, oldParentScope, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        tdom.sortable({\n          handle: \".taskboard-task-inner\",\n          dropOnEmpty: true,\n          connectWith: \".taskboard-tasks-box\",\n          revert: 400\n        });\n        tdom.on(\"sortstop\", function(event, ui) {\n          var itemIndex, itemTask, newStatusId, newUsId, oldStatusId, oldUsId, parentEl;\n          parentEl = ui.item.parent();\n          itemEl = ui.item;\n          itemTask = itemEl.scope().task;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          oldUsId = oldParentScope.us ? oldParentScope.us.id : null;\n          oldStatusId = oldParentScope.st.id;\n          newUsId = newParentScope.us ? newParentScope.us.id : null;\n          newStatusId = newParentScope.st.id;\n          if (newStatusId !== oldStatusId || newUsId !== oldUsId) {\n            deleteElement(itemEl);\n          }\n          $scope.$apply(function() {\n            return $rootscope.$broadcast(\"taskboard:task:move\", itemTask, newUsId, newStatusId, itemIndex);\n          });\n          return ui.item.find('a').removeClass('noclick');\n        });\n        return tdom.on(\"sortstart\", function(event, ui) {\n          oldParentScope = ui.item.parent().scope();\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", TaskboardSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/main.coffee\n */\n\n(function() {\n  var KanbanArchivedStatusHeaderDirective, KanbanArchivedStatusIntroDirective, KanbanController, KanbanDirective, KanbanSquishColumnDirective, KanbanUserDirective, KanbanUserstoryDirective, KanbanWipLimitDirective, bindMethods, bindOnce, defaultViewMode, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText, viewModes,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaKanban\");\n\n  defaultViewMode = \"maximized\";\n\n  viewModes = [\"maximized\", \"minimized\"];\n\n  KanbanController = (function(superClass) {\n    extend(KanbanController, superClass);\n\n    KanbanController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function KanbanController(scope, rootscope, repo, confirm, rs1, params1, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"KANBAN.SECTION_NAME\");\n      this.scope.statusViewModes = {};\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"KANBAN.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"KANBAN.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    KanbanController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.refreshTagsColors();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.refreshTagsColors();\n        };\n      })(this));\n      this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n      this.scope.$on(\"kanban:us:move\", this.moveUs);\n      this.scope.$on(\"kanban:show-userstories-for-status\", this.loadUserStoriesForStatus);\n      return this.scope.$on(\"kanban:hide-userstories-for-status\", this.hideUserStoriesForStatus);\n    };\n\n    KanbanController.prototype.addNewUs = function(type, statusId) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, statusId, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, statusId);\n      }\n    };\n\n    KanbanController.prototype.changeUsAssignedTo = function(us) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", us);\n    };\n\n    KanbanController.prototype.onAssignedToChanged = function(ctx, userid, us) {\n      var promise;\n      us.assigned_to = userid;\n      promise = this.repo.save(us);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    KanbanController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadUserstories = function() {\n      var params, promise;\n      params = {\n        status__is_archived: false\n      };\n      promise = this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, us, usByStatus, us_archived;\n          _this.scope.userstories = userstories;\n          usByStatus = _.groupBy(userstories, \"status\");\n          us_archived = [];\n          ref = _this.scope.usStatusList;\n          for (i = 0, len = ref.length; i < len; i++) {\n            status = ref[i];\n            if (usByStatus[status.id] == null) {\n              usByStatus[status.id] = [];\n            }\n            if (_this.scope.usByStatus != null) {\n              ref1 = _this.scope.usByStatus[status.id];\n              for (j = 0, len1 = ref1.length; j < len1; j++) {\n                us = ref1[j];\n                if (us.status !== status.id) {\n                  us_archived.push(us);\n                }\n              }\n            }\n            if (status.is_archived && (_this.scope.usByStatus != null) && _this.scope.usByStatus[status.id].length !== 0) {\n              ref2 = _this.scope.usByStatus[status.id].concat(us_archived);\n              for (k = 0, len2 = ref2.length; k < len2; k++) {\n                us = ref2[k];\n                if (us.status === status.id) {\n                  usByStatus[status.id].push(us);\n                }\n              }\n            }\n            usByStatus[status.id] = _.sortBy(usByStatus[status.id], \"kanban_order\");\n          }\n          if (userstories.length === 0) {\n            status = _this.scope.usStatusList[0];\n            usByStatus[status.id].push({\n              isPlaceholder: true\n            });\n          }\n          _this.scope.usByStatus = usByStatus;\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\", userstories);\n          });\n          return userstories;\n        };\n      })(this));\n      promise.then((function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    KanbanController.prototype.loadUserStoriesForStatus = function(ctx, statusId) {\n      var params;\n      params = {\n        status: statusId\n      };\n      return this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.scope.usByStatus[statusId] = _.sortBy(userstories, \"kanban_order\");\n          _this.scope.$broadcast(\"kanban:shown-userstories-for-status\", statusId, userstories);\n          return userstories;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.hideUserStoriesForStatus = function(ctx, statusId) {\n      this.scope.usByStatus[statusId] = [];\n      return this.scope.$broadcast(\"kanban:hidden-userstories-for-status\", statusId);\n    };\n\n    KanbanController.prototype.loadKanban = function() {\n      return this.q.all([this.refreshTagsColors(), this.loadUserstories()]);\n    };\n\n    KanbanController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_kanban_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.projectId = project.id;\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.generateStatusViewModes();\n          _this.scope.$emit(\"project:loaded\", project);\n          return project;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeSubscription = function() {\n      var routingKey1;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          return _this.loadKanban();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.generateStatusViewModes = function() {\n      var i, len, mode, ref, status, storedStatusViewModes;\n      storedStatusViewModes = this.rs.kanban.getStatusViewModes(this.scope.projectId);\n      this.scope.statusViewModes = {};\n      ref = this.scope.usStatusList;\n      for (i = 0, len = ref.length; i < len; i++) {\n        status = ref[i];\n        mode = storedStatusViewModes[status.id] || defaultViewMode;\n        this.scope.statusViewModes[status.id] = mode;\n      }\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.storeStatusViewModes = function() {\n      return this.rs.kanban.storeStatusViewModes(this.scope.projectId, this.scope.statusViewModes);\n    };\n\n    KanbanController.prototype.updateStatusViewMode = function(statusId, newViewMode) {\n      this.scope.statusViewModes[statusId] = newViewMode;\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.isMaximized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'maximized';\n    };\n\n    KanbanController.prototype.isMinimized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'minimized';\n    };\n\n    KanbanController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"kanban_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    KanbanController.prototype.resortUserStories = function(uses) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = uses.length; i < len; index = ++i) {\n        item = uses[index];\n        item.kanban_order = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    KanbanController.prototype.moveUs = function(ctx, us, oldStatusId, newStatusId, index) {\n      var itemsToSave, promise, r;\n      if (oldStatusId !== newStatusId) {\n        r = this.scope.usByStatus[oldStatusId].indexOf(us);\n        this.scope.usByStatus[oldStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n        us.status = newStatusId;\n      } else {\n        r = this.scope.usByStatus[newStatusId].indexOf(us);\n        this.scope.usByStatus[newStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n      }\n      itemsToSave = this.resortUserStories(this.scope.usByStatus[newStatusId]);\n      this.scope.usByStatus[newStatusId] = _.sortBy(this.scope.usByStatus[newStatusId], \"kanban_order\");\n      promise = this.repo.save(us);\n      promise = promise.then((function(_this) {\n        return function() {\n          var data;\n          itemsToSave = _.reject(itemsToSave, {\n            \"id\": us.id\n          });\n          data = _this.prepareBulkUpdateData(itemsToSave);\n          return _this.rs.userstories.bulkUpdateKanbanOrder(us.project, data).then(function() {\n            return itemsToSave;\n          });\n        };\n      })(this));\n      return promise;\n    };\n\n    return KanbanController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"KanbanController\", KanbanController);\n\n  KanbanDirective = function($repo, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var tableBodyDom;\n      tableBodyDom = $el.find(\".kanban-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".kanban-table-header .kanban-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanban\", [\"$tgRepo\", \"$rootScope\", KanbanDirective]);\n\n  KanbanArchivedStatusHeaderDirective = function($rootscope, $translate) {\n    var hideArchivedText, link, showArchivedText;\n    showArchivedText = $translate.instant(\"KANBAN.ACTION_SHOW_ARCHIVED\");\n    hideArchivedText = $translate.instant(\"KANBAN.ACTION_HIDE_ARCHIVED\");\n    link = function($scope, $el, $attrs) {\n      var hidden, status;\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusHeader);\n      hidden = true;\n      $scope[\"class\"] = \"icon-open-eye\";\n      $scope.title = showArchivedText;\n      $el.on(\"click\", function(event) {\n        hidden = !hidden;\n        return $scope.$apply(function() {\n          if (hidden) {\n            $scope[\"class\"] = \"icon-open-eye\";\n            $scope.title = showArchivedText;\n            return $rootscope.$broadcast(\"kanban:hide-userstories-for-status\", status.id);\n          } else {\n            $scope[\"class\"] = \"icon-closed-eye\";\n            $scope.title = hideArchivedText;\n            return $rootscope.$broadcast(\"kanban:show-userstories-for-status\", status.id);\n          }\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusHeader\", [\"$rootScope\", \"$translate\", KanbanArchivedStatusHeaderDirective]);\n\n  KanbanArchivedStatusIntroDirective = function($translate) {\n    var link, userStories;\n    userStories = [];\n    link = function($scope, $el, $attrs) {\n      var hiddenUserStoriexText, status, updateIntroText;\n      hiddenUserStoriexText = $translate.instant(\"KANBAN.HIDDEN_USER_STORIES\");\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusIntro);\n      $el.text(hiddenUserStoriexText);\n      updateIntroText = function() {\n        if (userStories.length > 0) {\n          return $el.text(\"\");\n        } else {\n          return $el.text(hiddenUserStoriexText);\n        }\n      };\n      $scope.$on(\"kanban:us:move\", function(ctx, itemUs, oldStatusId, newStatusId, itemIndex) {\n        var r;\n        if (status.id === newStatusId) {\n          if (status.id === oldStatusId) {\n            r = userStories.indexOf(itemUs);\n            userStories.splice(r, 1);\n            userStories.splice(itemIndex, 0, itemUs);\n          } else {\n            itemUs.isArchived = true;\n            userStories.splice(itemIndex, 0, itemUs);\n          }\n        } else if (status.id === oldStatusId) {\n          itemUs.isArchived = false;\n          r = userStories.indexOf(itemUs);\n          userStories.splice(r, 1);\n        }\n        return updateIntroText();\n      });\n      $scope.$on(\"kanban:shown-userstories-for-status\", function(ctx, statusId, userStoriesLoaded) {\n        if (statusId === status.id) {\n          userStories = _.filter(userStoriesLoaded, function(us) {\n            return us.status === status.id;\n          });\n          return updateIntroText();\n        }\n      });\n      $scope.$on(\"kanban:hidden-userstories-for-status\", function(ctx, statusId) {\n        if (statusId === status.id) {\n          userStories = [];\n          return updateIntroText();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusIntro\", [\"$translate\", KanbanArchivedStatusIntroDirective]);\n\n  KanbanUserstoryDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $el.disableSelection();\n      $scope.$watch(\"us\", function(us) {\n        if (us.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!us.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      $el.on('click', '.icon-edit', function(event) {\n        var currentLoading, target, us;\n        if ($el.find(\".icon-edit\").hasClass(\"noclick\")) {\n          return;\n        }\n        target = $(event.target);\n        currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n        us = $model.$modelValue;\n        return $rs.userstories.getByRef(us.project, us.ref).then((function(_this) {\n          return function(editingUserStory) {\n            return $rs2.attachments.list(\"us\", us.id, us.project).then(function(attachments) {\n              $rootscope.$broadcast(\"usform:edit\", editingUserStory, attachments.toJS());\n              return currentLoading.finish();\n            });\n          };\n        })(this));\n      });\n      $scope.getTemplateUrl = function() {\n        if ($scope.us.isPlaceholder) {\n          return \"common/components/kanban-placeholder.html\";\n        } else {\n          return \"kanban/kanban-task.html\";\n        }\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      template: '<ng-include src=\"getTemplateUrl()\"/>',\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserstory\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", KanbanUserstoryDirective]);\n\n  KanbanSquishColumnDirective = function(rs) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var updateTableWidth;\n      $scope.$on(\"project:loaded\", function(event, project) {\n        $scope.folds = rs.kanban.getStatusColumnModes(project.id);\n        return updateTableWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.folds[status.id] = !!!$scope.folds[status.id];\n        rs.kanban.storeStatusColumnModes($scope.projectId, $scope.folds);\n        updateTableWidth();\n      };\n      return updateTableWidth = function() {\n        var columnWidths, totalWidth;\n        columnWidths = _.map($scope.usStatusList, function(status) {\n          if ($scope.folds[status.id]) {\n            return 40;\n          } else {\n            return 310;\n          }\n        });\n        totalWidth = _.reduce(columnWidths, function(total, width) {\n          return total + width;\n        });\n        return $el.find('.kanban-table-inner').css(\"width\", totalWidth);\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSquishColumn\", [\"$tgResources\", KanbanSquishColumnDirective]);\n\n  KanbanWipLimitDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var redrawWipLimit, status;\n      $el.disableSelection();\n      status = $scope.$eval($attrs.tgKanbanWipLimit);\n      redrawWipLimit = (function(_this) {\n        return function() {\n          $el.find(\".kanban-wip-limit\").remove();\n          return timeout(200, function() {\n            var element;\n            element = $el.find(\".kanban-task\")[status.wip_limit];\n            if (element) {\n              return angular.element(element).before(\"<div class='kanban-wip-limit'></div>\");\n            }\n          });\n        };\n      })(this);\n      if (status && !status.is_archived) {\n        $scope.$on(\"redraw:wip\", redrawWipLimit);\n        $scope.$on(\"kanban:us:move\", redrawWipLimit);\n        $scope.$on(\"usform:new:success\", redrawWipLimit);\n        $scope.$on(\"usform:bulk:success\", redrawWipLimit);\n      }\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanWipLimit\", KanbanWipLimitDirective);\n\n  KanbanUserDirective = function($log, $compile, $translate) {\n    var clickable, link, template;\n    template = _.template(\"<figure class=\\\"avatar\\\">\\n    <a href=\\\"#\\\" title=\\\"{{'US.ASSIGN' | translate}}\\\" <% if (!clickable) {%>class=\\\"not-clickable\\\"<% } %>>\\n        <img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\" class=\\\"avatar\\\">\\n    </a>\\n</figure>\");\n    clickable = false;\n    link = function($scope, $el, $attrs, $model) {\n      var render, username_label, wtid;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      if (!$attrs.tgKanbanUserAvatar) {\n        return $log.error(\"KanbanUserDirective: no attr is defined\");\n      }\n      wtid = $scope.$watch($attrs.tgKanbanUserAvatar, function(v) {\n        var user;\n        if ($scope.usersById == null) {\n          $log.error(\"KanbanUserDirective requires userById set in scope.\");\n          return wtid();\n        } else {\n          user = $scope.usersById[v];\n          return render(user);\n        }\n      });\n      render = function(user) {\n        var ctx, html;\n        if (user === void 0) {\n          ctx = {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          };\n        } else {\n          ctx = {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          };\n        }\n        html = $compile(template(ctx))($scope);\n        $el.html(html);\n        return username_label.text(ctx.name);\n      };\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          clickable = true;\n          $el.on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl, us;\n              if ($el.find(\"a\").hasClass(\"noclick\")) {\n                return;\n              }\n              us = $model.$modelValue;\n              $ctrl = $el.controller();\n              return $ctrl.changeUsAssignedTo(us);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl, us;\n            if ($el.find(\"a\").hasClass(\"noclick\")) {\n              return;\n            }\n            us = $model.$modelValue;\n            $ctrl = $el.controller();\n            return $ctrl.changeUsAssignedTo(us);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserAvatar\", [\"$log\", \"$compile\", \"$translate\", KanbanUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/sortable.coffee\n */\n\n(function() {\n  var KanbanSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var deleteElement, itemEl, newParentScope, oldParentScope, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        tdom.sortable({\n          handle: \".kanban-task-inner\",\n          dropOnEmpty: true,\n          connectWith: \".kanban-uses-box\",\n          revert: 400\n        });\n        tdom.on(\"sortstop\", function(event, ui) {\n          var itemIndex, itemUs, newStatusId, oldStatusId, parentEl;\n          parentEl = ui.item.parent();\n          itemEl = ui.item;\n          itemUs = itemEl.scope().us;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          newStatusId = newParentScope.s.id;\n          oldStatusId = oldParentScope.s.id;\n          if (newStatusId !== oldStatusId) {\n            deleteElement(itemEl);\n          }\n          $scope.$apply(function() {\n            return $rootscope.$broadcast(\"kanban:us:move\", itemUs, itemUs.status, newStatusId, itemIndex);\n          });\n          return ui.item.find('a').removeClass('noclick');\n        });\n        return tdom.on(\"sortstart\", function(event, ui) {\n          oldParentScope = ui.item.parent().scope();\n          return ui.item.find('a').addClass('noclick');\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", KanbanSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/detail.coffee\n */\n\n(function() {\n  var IssueDetailController, IssuePriorityButtonDirective, IssueSeverityButtonDirective, IssueStatusButtonDirective, IssueStatusDisplayDirective, IssueTriggerButtonDirective, IssueTypeButtonDirective, PromoteIssueToUsButtonDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssueDetailController = (function(superClass) {\n    extend(IssueDetailController, superClass);\n\n    IssueDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\"];\n\n    function IssueDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, analytics, navUrls, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.issueRef = this.params.issueref;\n      this.scope.sectionName = this.translate.instant(\"ISSUES.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    IssueDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, ref3, ref4, title;\n      title = this.translate.instant(\"ISSUE.PAGE_TITLE\", {\n        issueRef: \"#\" + this.scope.issue.ref,\n        issueSubject: this.scope.issue.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"ISSUE.PAGE_DESCRIPTION\", {\n        issueStatus: ((ref = this.scope.statusById[this.scope.issue.status]) != null ? ref.name : void 0) || \"--\",\n        issueType: ((ref1 = this.scope.typeById[this.scope.issue.type]) != null ? ref1.name : void 0) || \"--\",\n        issueSeverity: ((ref2 = this.scope.severityById[this.scope.issue.severity]) != null ? ref2.name : void 0) || \"--\",\n        issueTrigger: ((ref3 = this.scope.triggerById[this.scope.issue.trigger]) != null ? ref3.name : void 0) || \"--\",\n        issuePriority: ((ref4 = this.scope.priorityById[this.scope.issue.priority]) != null ? ref4.name : void 0) || \"--\",\n        issueDescription: angular.element(this.scope.issue.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    IssueDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on issue\", 1);\n        };\n      })(this));\n      this.scope.$on(\"promote-issue-to-us:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"promoteToUserstory\", \"promote issue to userstory\", 1);\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.loadIssue();\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadIssue();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      if (this.scope.project.is_issues_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-issues\", ctx);\n      } else {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      }\n    };\n\n    IssueDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.issue_statuses;\n          _this.scope.statusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.typeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          _this.scope.typeList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.severityList = project.severities;\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerList = project.triggers;\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = project.priorities;\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadIssue = function() {\n      return this.rs.issues.getByRef(this.scope.projectId, this.params.issueref).then((function(_this) {\n        return function(issue) {\n          var ctx, ref, ref1;\n          _this.scope.issue = issue;\n          _this.scope.issueId = issue.id;\n          _this.scope.commentModel = issue;\n          if (((ref = _this.scope.issue.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.issue.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadIssue();\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    IssueDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.upvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.downvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    IssueDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.watch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.unwatch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    return IssueDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"IssueDetailController\", IssueDetailController);\n\n  IssueStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issue) {\n        var html, status;\n        status = $scope.statusById[issue.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue != null) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusDisplay\", [\"$tgTemplate\", \"$compile\", IssueStatusDisplayDirective]);\n\n  IssueStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issues-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, status;\n          status = $scope.statusById[issue.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(statusId) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.status = statusId;\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueStatusButtonDirective]);\n\n  IssueTypeButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-type-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, type;\n          type = $scope.typeById[issue.type];\n          html = template({\n            type: type,\n            typees: $scope.typeList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(type) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.type = type;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".type-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-type\").popover().open();\n      });\n      $el.on(\"click\", \".type\", function(event) {\n        var target, type;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        type = target.data(\"type-id\");\n        return save(type);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTypeButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueTypeButtonDirective]);\n\n  IssueSeverityButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-severity-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, severity;\n          severity = $scope.severityById[issue.severity];\n          html = template({\n            severity: severity,\n            severityes: $scope.severityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(severity) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.severity = severity;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".severity-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-severity\").popover().open();\n      });\n      $el.on(\"click\", \".severity\", function(event) {\n        var severity, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        severity = target.data(\"severity-id\");\n        return save(severity);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueSeverityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueSeverityButtonDirective]);\n\n  IssueTriggerButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-trigger-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, trigger;\n          trigger = $scope.triggerById[issue.trigger];\n          html = template({\n            trigger: trigger,\n            triggeres: $scope.triggerList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(trigger) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.trigger = trigger;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $confirm.notify(\"success\");\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".trigger-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-trigger\").popover().open();\n      });\n      $el.on(\"click\", \".trigger\", function(event) {\n        var target, trigger;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        trigger = target.data(\"trigger-id\");\n        return save(trigger);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTriggerButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueTriggerButtonDirective]);\n\n  IssuePriorityButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-priority-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, priority;\n          priority = $scope.priorityById[issue.priority];\n          html = template({\n            priority: priority,\n            priorityes: $scope.priorityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(priority) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.priority = priority;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".priority-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-priority\").popover().open();\n      });\n      $el.on(\"click\", \".priority\", function(event) {\n        var priority, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        priority = target.data(\"priority-id\");\n        return save(priority);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssuePriorityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssuePriorityButtonDirective]);\n\n  PromoteIssueToUsButtonDirective = function($rootScope, $repo, $confirm, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = $qqueue.bindAdd((function(_this) {\n        return function(issue, askResponse) {\n          var data, onError, onSuccess;\n          data = {\n            generated_from_issue: issue.id,\n            project: issue.project,\n            subject: issue.subject,\n            description: issue.description,\n            tags: issue.tags,\n            is_blocked: issue.is_blocked,\n            blocked_note: issue.blocked_note\n          };\n          onSuccess = function() {\n            askResponse.finish();\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"promote-issue-to-us:success\");\n          };\n          onError = function() {\n            askResponse.finish();\n            return $confirm.notify(\"error\");\n          };\n          return $repo.create(\"userstories\", data).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \"a\", function(event) {\n        var issue, message, subtitle, title;\n        event.preventDefault();\n        issue = $model.$modelValue;\n        title = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.TITLE\");\n        message = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.MESSAGE\");\n        subtitle = issue.subject;\n        return $confirm.ask(title, subtitle, message).then((function(_this) {\n          return function(response) {\n            return save(issue, response);\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      restrict: \"AE\",\n      require: \"ngModel\",\n      templateUrl: \"issue/promote-issue-to-us-button.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgPromoteIssueToUsButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgQqueue\", \"$translate\", PromoteIssueToUsButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkIssuesDirective, CreateIssueDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaIssues\");\n\n  CreateIssueDirective = function($repo, $confirm, $rootscope, lightboxService, $loading, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var attachmentsToAdd, createAttachments, form, resetAttachments, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      $scope.issue = {};\n      $scope.attachments = Immutable.List();\n      $scope.$on(\"issueform:new\", function(ctx, project) {\n        form.reset();\n        resetAttachments();\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el);\n        return $scope.issue = {\n          project: project.id,\n          subject: \"\",\n          status: project.default_issue_status,\n          type: project.default_issue_type,\n          priority: project.default_priority,\n          severity: project.default_severity,\n          trigger: project.default_trigger,\n          tags: []\n        };\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.issue.project, 'issue');\n        });\n        return $q.all(promises);\n      };\n      attachmentsToAdd = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return $scope.attachments = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"issues\", $scope.issue);\n          promise.then(function(data) {\n            return createAttachments(data);\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", data);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateIssue\", [\"$tgRepo\", \"$tgConfirm\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$q\", \"tgAttachmentsService\", CreateIssueDirective]);\n\n  CreateBulkIssuesDirective = function($repo, $rs, $confirm, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.$on(\"issueform:bulk\", function(ctx, projectId, status) {\n        lightboxService.open($el);\n        return $scope[\"new\"] = {\n          projectId: projectId,\n          bulk: \"\"\n        };\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope[\"new\"].bulk;\n          projectId = $scope[\"new\"].projectId;\n          promise = $rs.issues.bulkCreate(projectId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", result);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkIssues\", [\"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkIssuesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/list.coffee\n */\n\n(function() {\n  var IssueAssignedToInlineEditionDirective, IssueStatusInlineEditionDirective, IssueTriggerInlineEditionDirective, IssuesController, IssuesDirective, IssuesFiltersDirective, bindOnce, debounceLeading, groupBy, joinStr, mixOf, module, startswith, taiga, toString, trim,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  startswith = this.taiga.startswith;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssuesController = (function(superClass) {\n    extend(IssuesController, superClass);\n\n    IssuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgUrls\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function IssuesController(scope, rootscope, repo, confirm, rs, urls, params, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var filters, promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.urls = urls;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loadIssues = bind(this.loadIssues, this);\n      this.scope.sectionName = \"Issues\";\n      this.scope.filters = {};\n      if (_.isEmpty(this.location.search())) {\n        filters = this.rs.issues.getFilters(this.params.pslug);\n        filters.page = 1;\n        this.location.search(filters);\n        this.location.replace();\n        return;\n      }\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ISSUES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"ISSUES.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"issueform:new:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"create\", \"create issue on issues list\", 1);\n          return _this.loadIssues();\n        };\n      })(this));\n    }\n\n    IssuesController.prototype.initializeSubscription = function() {\n      var routingKey;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".issues\";\n      return this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.storeFilters = function() {\n      return this.rs.issues.storeFilters(this.params.pslug, this.location.search());\n    };\n\n    IssuesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_issues_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.severityList = _.sortBy(project.severities, \"order\");\n          _this.scope.triggerById = groupBy(project.triggers, function(x) {\n            return x.id;\n          });\n          _this.scope.triggerList = _.sortBy(project.triggers, \"order\");\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = _.sortBy(project.priorities, \"order\");\n          _this.scope.issueTypes = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueTypeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\", \"tags\", \"status\", \"types\", \"q\", \"severities\", \"triggers\", \"priorities\", \"assignedTo\", \"createdBy\", \"orderBy\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    IssuesController.prototype.getUrlFilter = function(name) {\n      var filters;\n      filters = _.pick(this.location.search(), name);\n      return filters[name];\n    };\n\n    IssuesController.prototype.loadMyFilters = function() {\n      return this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          return _.map(filters, function(value, key) {\n            return {\n              id: key,\n              name: key,\n              type: \"myFilters\",\n              selected: false\n            };\n          });\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.removeNotExistingFiltersFromUrl = function() {\n      var currentSearch, existingValues, filterName, filterValue, splittedValues, urlfilters;\n      currentSearch = this.location.search();\n      urlfilters = this.getUrlFilters();\n      for (filterName in urlfilters) {\n        filterValue = urlfilters[filterName];\n        if (filterName === \"page\" || filterName === \"orderBy\" || filterName === \"q\") {\n          continue;\n        }\n        if (filterName === \"tags\") {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"));\n        } else {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"), function(x) {\n            if (x === \"null\") {\n              return null;\n            } else {\n              return parseInt(x);\n            }\n          });\n        }\n        existingValues = _.intersection(splittedValues, _.map(this.scope.filters[filterName], \"id\"));\n        if (splittedValues.length !== existingValues.length) {\n          this.location.search(filterName, existingValues.join());\n        }\n      }\n      if (currentSearch !== this.location.search()) {\n        return this.location.replace();\n      }\n    };\n\n    IssuesController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref, ref1, results, searchdata, val, value;\n      searchdata = {};\n      ref = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref) {\n        value = ref[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref1 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref1.length; j < len; j++) {\n          val = ref1[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var k, len1, results1;\n          results1 = [];\n          for (k = 0, len1 = value.length; k < len1; k++) {\n            obj = value[k];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    IssuesController.prototype.loadFilters = function() {\n      var loadFilters, promise, urlfilters;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = urlfilters.q;\n      }\n      promise = this.loadMyFilters().then((function(_this) {\n        return function(myFilters) {\n          _this.scope.filters.myFilters = myFilters;\n          return myFilters;\n        };\n      })(this));\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.types = urlfilters.types;\n      loadFilters.severities = urlfilters.severities;\n      loadFilters.triggers = urlfilters.triggers;\n      loadFilters.priorities = urlfilters.priorities;\n      loadFilters.assigned_to = urlfilters.assignedTo;\n      loadFilters.owner = urlfilters.createdBy;\n      promise = promise.then((function(_this) {\n        return function() {\n          return _this.rs.issues.filtersData(loadFilters);\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, tagsFilterFormat, usersFiltersFormat;\n          usersFiltersFormat = function(users, type, unknownOption) {\n            var reformatedUsers, unknownItem;\n            reformatedUsers = _.map(users, function(t) {\n              t.type = type;\n              t.name = t.full_name ? t.full_name : unknownOption;\n              return t;\n            });\n            unknownItem = _.remove(reformatedUsers, function(u) {\n              return !u.id;\n            });\n            reformatedUsers = _.sortBy(reformatedUsers, function(u) {\n              return u.name.toUpperCase();\n            });\n            if (unknownItem.length > 0) {\n              reformatedUsers.unshift(unknownItem[0]);\n            }\n            return reformatedUsers;\n          };\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.issueStatusById);\n          _this.scope.filters.severities = choicesFiltersFormat(data.severities, \"severities\", _this.scope.severityById);\n          _this.scope.filters.triggers = choicesFiltersFormat(data.triggers, \"triggers\", _this.scope.triggerById);\n          _this.scope.filters.priorities = choicesFiltersFormat(data.priorities, \"priorities\", _this.scope.priorityById);\n          _this.scope.filters.assignedTo = usersFiltersFormat(data.assigned_to, \"assignedTo\", \"Unassigned\");\n          _this.scope.filters.createdBy = usersFiltersFormat(data.owners, \"createdBy\", \"Unknown\");\n          _this.scope.filters.types = choicesFiltersFormat(data.types, \"types\", _this.scope.issueTypeById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          _this.removeNotExistingFiltersFromUrl();\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rootscope.$broadcast(\"filters:loaded\", _this.scope.filters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadIssuesRequests = 0;\n\n    IssuesController.prototype.loadIssues = function() {\n      var name, promise, ref, values;\n      this.scope.urlFilters = this.getUrlFilters();\n      this.scope.httpParams = {};\n      ref = this.scope.urlFilters;\n      for (name in ref) {\n        values = ref[name];\n        if (name === \"severities\") {\n          name = \"severity\";\n        } else if (name === \"orderBy\") {\n          name = \"order_by\";\n        } else if (name === \"priorities\") {\n          name = \"priority\";\n        } else if (name === \"triggers\") {\n          name = \"trigger\";\n        } else if (name === \"assignedTo\") {\n          name = \"assigned_to\";\n        } else if (name === \"createdBy\") {\n          name = \"owner\";\n        } else if (name === \"status\") {\n          name = \"status\";\n        } else if (name === \"types\") {\n          name = \"type\";\n        }\n        this.scope.httpParams[name] = values;\n      }\n      promise = this.rs.issues.list(this.scope.projectId, this.scope.httpParams);\n      this.loadIssuesRequests += 1;\n      promise.index = this.loadIssuesRequests;\n      promise.then((function(_this) {\n        return function(data) {\n          if (promise.index === _this.loadIssuesRequests) {\n            _this.scope.issues = data.models;\n            _this.scope.page = data.current;\n            _this.scope.count = data.count;\n            _this.scope.paginatedBy = data.paginatedBy;\n          }\n          return data;\n        };\n      })(this));\n      return promise;\n    };\n\n    IssuesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          _this.loadFilters();\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.saveCurrentFiltersTo = function(newFilter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          filters[newFilter] = _this.location.search();\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.deleteMyFilter = function(filter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          delete filters[filter];\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.addNewIssue = function() {\n      return this.rootscope.$broadcast(\"issueform:new\", this.scope.project);\n    };\n\n    IssuesController.prototype.addIssuesInBulk = function() {\n      return this.rootscope.$broadcast(\"issueform:bulk\", this.scope.projectId);\n    };\n\n    return IssuesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"IssuesController\", IssuesController);\n\n  IssuesDirective = function($log, $location, $template, $compile) {\n    var link, linkOrdering, linkPagination, template;\n    template = $template.get(\"issue/issue-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".issues-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        $pagEl.show();\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        return $pagEl.html(html);\n      };\n      $scope.$watch(\"issues\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".issues-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      $el.on(\"click\", \".issues-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      return $el.on(\"click\", \".issues-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadIssues();\n        });\n      });\n    };\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var colHeadElement, currentOrder, icon;\n      currentOrder = $ctrl.getUrlFilter(\"orderBy\") || \"created_date\";\n      if (currentOrder) {\n        icon = startswith(currentOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        colHeadElement.html((colHeadElement.html()) + \"<span class='icon \" + icon + \"'></span>\");\n      }\n      return $el.on(\"click\", \".row.title > div\", function(event) {\n        var finalOrder, newOrder, target;\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getUrlFilter(\"orderBy\");\n        newOrder = target.data(\"fieldname\");\n        finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        return $scope.$apply(function() {\n          $ctrl.replaceFilter(\"orderBy\", finalOrder);\n          $ctrl.storeFilters();\n          return $ctrl.loadIssues().then(function() {\n            $el.find(\".row.title > div > span.icon\").remove();\n            icon = startswith(finalOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n            return target.html((target.html()) + \"<span class='icon \" + icon + \"'></span>\");\n          });\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkOrdering($scope, $el, $attrs, $ctrl);\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssues\", [\"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", IssuesDirective]);\n\n  IssuesFiltersDirective = function($q, $log, $location, $rs, $confirm, $loading, $template, $translate, $compile, $auth) {\n    var link, template, templateSelected;\n    template = $template.get(\"issue/issues-filters.html\", true);\n    templateSelected = $template.get(\"issue/issues-filters-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, getFiltersType, initializeSelectedFilters, reloadIssues, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection, unwatchIssues;\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\"h2.breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 a.subfilter span.title\").html(title);\n        return $el.find(\"h2 a.subfilter span.title\").prop(\"data-type\", type);\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\"h2.breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function(filters) {\n        var j, len, name, val, values;\n        selectedFilters = [];\n        for (name in filters) {\n          values = filters[name];\n          for (j = 0, len = values.length; j < len; j++) {\n            val = values[j];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters(selectedFilters);\n      };\n      renderSelectedFilters = function(selectedFilters) {\n        var html;\n        _.filter(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        $el.find(\".filters-applied\").html(html);\n        if ($auth.isAuthenticated() && selectedFilters.length > 0) {\n          return $el.find(\".save-filters\").show();\n        } else {\n          return $el.find(\".save-filters\").hide();\n        }\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.filter(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n      };\n      reloadIssues = function() {\n        var currentFiltersType;\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadIssues(), $ctrl.loadFilters()]).then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(filters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var currentFiltersType, filter, filterId, filters;\n        if (type === \"myFilters\") {\n          $rs.issues.getMyFilters($scope.projectId).then(function(data) {\n            var filters, myFilters;\n            myFilters = data;\n            filters = myFilters[id];\n            filters.page = 1;\n            $ctrl.replaceAllFilters(filters);\n            $ctrl.storeFilters();\n            $ctrl.loadIssues();\n            $ctrl.markSelectedFilters($scope.filters, filters);\n            return initializeSelectedFilters($scope.filters);\n          });\n          return null;\n        }\n        filters = $scope.filters[type];\n        filterId = type === 'tags' ? taiga.toString(id) : id;\n        filter = _.find(filters, {\n          id: filterId\n        });\n        filter.selected = !filter.selected;\n        if (id === null) {\n          id = \"null\";\n        }\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $ctrl.selectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(f) {\n            return f.id === filter.id && f.type === filter.type;\n          });\n          $ctrl.unselectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        }\n        reloadIssues();\n        renderSelectedFilters(selectedFilters);\n        currentFiltersType = getFiltersType();\n        if (type === currentFiltersType) {\n          return renderFilters(_.reject(filters, \"selected\"));\n        }\n      };\n      $scope.$on(\"filters:loaded\", function(ctx, filters) {\n        return initializeSelectedFilters(filters);\n      });\n      $scope.$on(\"filters:issueupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.status\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      $scope.$on(\"filters:triggerupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.triggers\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      selectQFilter = debounceLeading(100, function(value, oldValue) {\n        if (value === void 0 || value === oldValue) {\n          return;\n        }\n        $ctrl.replaceFilter(\"page\", null, true);\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n          $ctrl.storeFilters();\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n          $ctrl.storeFilters();\n        }\n        return reloadIssues();\n      });\n      unwatchIssues = $scope.$watch(\"issues\", function(newValue) {\n        if (!_.isUndefined(newValue)) {\n          $scope.$watch(\"filtersQ\", selectQFilter);\n          return unwatchIssues();\n        }\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data(\"type\"));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories($el);\n      });\n      $el.on(\"click\", \".filters-applied a\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"active\");\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        if (type === \"myFilters\") {\n          target.removeClass(\"active\");\n        }\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter .icon-delete\", function(event) {\n        var customFilterName, message, target, title;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        customFilterName = target.parent().data('id');\n        title = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.TITLE\");\n        message = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.MESSAGE\", {\n          customFilterName: customFilterName\n        });\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var promise;\n          promise = $ctrl.deleteMyFilter(customFilterName);\n          promise.then(function() {\n            promise = $ctrl.loadMyFilters();\n            promise.then(function(filters) {\n              askResponse.finish();\n              $scope.filters.myFilters = filters;\n              return renderFilters($scope.filters.myFilters);\n            });\n            return promise.then(null, function() {\n              return askResponse.finish();\n            });\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return $confirm.notify(\"error\");\n          });\n        });\n      });\n      $el.on(\"click\", \".save-filters\", function(event) {\n        event.preventDefault();\n        renderFilters($scope.filters[\"myFilters\"]);\n        showFilters(\"My filters\", \"myFilters\");\n        $el.find('.save-filters').hide();\n        $el.find('.my-filter-name').removeClass(\"hidden\");\n        $el.find('.my-filter-name').focus();\n        return $scope.$apply();\n      });\n      return $el.on(\"keyup\", \".my-filter-name\", function(event) {\n        var currentLoading, newFilter, promise, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newFilter = target.val();\n          currentLoading = $loading().target($el.find(\".new\")).start();\n          promise = $ctrl.saveCurrentFiltersTo(newFilter);\n          promise.then(function() {\n            var loadPromise;\n            loadPromise = $ctrl.loadMyFilters();\n            loadPromise.then(function(filters) {\n              var currentfilterstype;\n              currentLoading.finish();\n              $scope.filters.myFilters = filters;\n              currentfilterstype = $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n              if (currentfilterstype === \"myFilters\") {\n                renderFilters($scope.filters.myFilters);\n              }\n              $el.find('.my-filter-name').addClass(\"hidden\");\n              return $el.find('.save-filters').show();\n            });\n            return loadPromise.then(null, function() {\n              currentLoading.finish();\n              return $confirm.notify(\"error\", \"Error loading custom filters\");\n            });\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            $el.find(\".my-filter-name\").val(newFilter).focus().select();\n            return $confirm.notify(\"error\", \"Filter not saved\");\n          });\n        } else if (event.keyCode === 27) {\n          $el.find('.my-filter-name').val('');\n          $el.find('.my-filter-name').addClass(\"hidden\");\n          return $el.find('.save-filters').show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssuesFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", \"$compile\", \"$tgAuth\", IssuesFiltersDirective]);\n\n  IssueStatusInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the status of an Issue and a popover to change it.\n    - tg-issue-status-inline-edition: The issue\n    \n    Example:\n    \n      div.status(tg-issue-status-inline-edition=\"issue\")\n        a.issue-status(href=\"\")\n    \n    NOTE: This directive need 'issueStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueStatus;\n    selectionTemplate = $template.get(\"issue/issue-status-inline-edition-selection.html\", true);\n    updateIssueStatus = function($el, issue, issueStatusById) {\n      var issueStatusDom, issueStatusDomParent, status;\n      issueStatusDomParent = $el.find(\".issue-status\");\n      issueStatusDom = $el.find(\".issue-status .issue-status-bind\");\n      status = issueStatusById[issue.status];\n      if (status) {\n        issueStatusDom.text(status.name);\n        issueStatusDom.prop(\"title\", status.name);\n        return issueStatusDomParent.css('color', status.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueStatusInlineEdition);\n      $el.on(\"click\", \".issue-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.status;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.status) {\n            filter.count--;\n          }\n        }\n        issue.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.status;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.status) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:issueupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.issue_statuses\n        }));\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueStatusInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueStatus($el, val, $scope.issueStatusById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueStatusInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueStatusInlineEditionDirective]);\n\n  IssueTriggerInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the trigger of an Issue and a popover to change it.\n    - tg-issue-trigger-inline-edition: The issue\n    \n    Example:\n    \n      div.trigger(tg-issue-trigger-inline-edition=\"issue\")\n        a.issue-trigger(href=\"\")\n    \n    NOTE: This directive need 'triggerById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueTrigger;\n    selectionTemplate = $template.get(\"issue/issue-trigger-inline-edition-selection.html\", true);\n    updateIssueTrigger = function($el, issue, triggerById) {\n      var issueTriggerDom, issueTriggerDomParent, trigger;\n      issueTriggerDomParent = $el.find(\".issue-trigger\");\n      issueTriggerDom = $el.find(\".issue-trigger .issue-trigger-bind\");\n      trigger = triggerById[issue.trigger];\n      if (trigger) {\n        issueTriggerDom.text(trigger.name);\n        issueTriggerDom.prop(\"title\", trigger.name);\n        return issueTriggerDomParent.css('color', trigger.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueTriggerInlineEdition);\n      $el.on(\"click\", \".issue-trigger\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-trigger\").popover().open();\n      });\n      $el.on(\"click\", \".trigger\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.triggers;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.trigger) {\n            filter.count--;\n          }\n        }\n        issue.trigger = target.data(\"trigger-id\");\n        $el.find(\".pop-trigger\").popover().close();\n        updateIssueTrigger($el, issue, $scope.triggerById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.triggers;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.trigger) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:triggerupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'triggeres': project.triggers\n        }));\n        updateIssueTrigger($el, issue, $scope.triggerById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueTriggerInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueTrigger($el, val, $scope.triggerById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueTriggerInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueTriggerInlineEditionDirective]);\n\n  IssueAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue, updateIssue;\n      updateIssue = function(issue) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[issue.assigned_to];\n        if (member) {\n          ctx.name = member.full_name_display;\n          ctx.imgurl = member.photo;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".issue-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueAssignedToInlineEdition);\n      updateIssue(issue);\n      $el.on(\"click\", \".issue-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", issue);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, updatedIssue) {\n          if (updatedIssue.id === issue.id) {\n            updatedIssue.assigned_to = userId;\n            $repo.save(updatedIssue);\n            return updateIssue(updatedIssue);\n          }\n        };\n      })(this));\n      $scope.$watch($attrs.tgIssueAssignedToInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssue(val);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", IssueAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories/detail.coffee\n */\n\n(function() {\n  var UsClientRequirementButtonDirective, UsStatusButtonDirective, UsStatusDisplayDirective, UsTeamRequirementButtonDirective, UserStoryDetailController, bindMethods, bindOnce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaUserStories\");\n\n  UserStoryDetailController = (function(superClass) {\n    extend(UserStoryDetailController, superClass);\n\n    UserStoryDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function UserStoryDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.usRef = this.params.usref;\n      this.scope.sectionName = this.translate.instant(\"US.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserStoryDetailController.prototype._setMeta = function() {\n      var closedTasks, description, progressPercentage, ref, title, totalTasks;\n      totalTasks = this.scope.tasks.length;\n      closedTasks = _.filter(this.scope.tasks, (function(_this) {\n        return function(t) {\n          return _this.scope.taskStatusById[t.status].is_closed;\n        };\n      })(this)).length;\n      progressPercentage = totalTasks > 0 ? Math.round(100 * closedTasks / totalTasks) : 0;\n      title = this.translate.instant(\"US.PAGE_TITLE\", {\n        userStoryRef: \"#\" + this.scope.us.ref,\n        userStorySubject: this.scope.us.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"US.PAGE_DESCRIPTION\", {\n        userStoryStatus: ((ref = this.scope.statusById[this.scope.us.status]) != null ? ref.name : void 0) || \"--\",\n        userStoryPoints: this.scope.us.total_points,\n        userStoryDescription: angular.element(this.scope.us.description_html || \"\").text(),\n        userStoryClosedTasks: closedTasks,\n        userStoryTotalTasks: totalTasks,\n        userStoryProgressPercentage: progressPercentage\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    UserStoryDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"related-tasks:update\", (function(_this) {\n        return function() {\n          var allClosed;\n          _this.scope.tasks = _.clone(_this.scope.tasks, false);\n          allClosed = _.every(_this.scope.tasks, function(task) {\n            return task.is_closed;\n          });\n          if (_this.scope.us.is_closed !== allClosed) {\n            return _this.loadUs();\n          }\n        };\n      })(this));\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on userstory\", 1);\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadUs();\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.us.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else {\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-backlog\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-kanban\", ctx);\n      }\n    };\n\n    UserStoryDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.us_statuses;\n          _this.scope.statusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(_this.scope.pointsList, function(e) {\n            return e.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadUs = function() {\n      var httpParams, kanbanStaus, milestone, noMilestone;\n      httpParams = _.pick(this.location.search(), \"milestone\", \"no-milestone\", \"kanban-status\");\n      milestone = httpParams.milestone;\n      if (milestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: milestone,\n          order_by: \"sprint_order\"\n        });\n      }\n      noMilestone = httpParams[\"no-milestone\"];\n      if (noMilestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: \"null\",\n          order_by: \"backlog_order\"\n        });\n      }\n      kanbanStaus = httpParams[\"kanban-status\"];\n      if (kanbanStaus) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          status: kanbanStaus,\n          order_by: \"kanban_order\"\n        });\n      }\n      return this.rs.userstories.getByRef(this.scope.projectId, this.params.usref).then((function(_this) {\n        return function(us) {\n          var ctx, ref, ref1;\n          _this.scope.us = us;\n          _this.scope.usId = us.id;\n          _this.scope.commentModel = us;\n          if (((ref = _this.scope.us.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.us.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          return us;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadSprint = function() {\n      if (this.scope.us.milestone) {\n        return this.rs.sprints.get(this.scope.us.project, this.scope.us.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    UserStoryDetailController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, null, this.scope.usId).then((function(_this) {\n        return function(tasks) {\n          _this.scope.tasks = tasks;\n          return tasks;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadUs().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadTasks()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    UserStoryDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.upvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.downvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    UserStoryDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.watch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.unwatch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    return UserStoryDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserStoryDetailController\", UserStoryDetailController);\n\n  UsStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(us) {\n        var html, status;\n        status = $scope.statusById[us.status];\n        html = template({\n          is_closed: us.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us != null) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusDisplay\", [\"$tgTemplate\", \"$compile\", UsStatusDisplayDirective]);\n\n  UsStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template) {\n    var link, template;\n    template = $template.get(\"us/us-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = (function(_this) {\n        return function(us) {\n          var html, status;\n          status = $scope.statusById[us.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, us;\n          us = $model.$modelValue.clone();\n          us.status = status;\n          $.fn.popover().closeAll();\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(us);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return $repo.save(us).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var status, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        status = target.data(\"status-id\");\n        return save(status);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", UsStatusButtonDirective]);\n\n  UsTeamRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-team-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.team_requirement\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(team_requirement) {\n          var currentLoading, promise, us;\n          us = $model.$modelValue.clone();\n          us.team_requirement = team_requirement;\n          currentLoading = $loading().target($el.find(\"label\")).start();\n          promise = $tgrepo.save(us);\n          promise.then(function() {\n            $model.$setViewValue(us);\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".team-requirement\", function(event) {\n        var team_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        team_requirement = !$model.$modelValue.team_requirement;\n        return save(team_requirement);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsTeamRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsTeamRequirementButtonDirective]);\n\n  UsClientRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-client-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.client_requirement\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(client_requirement) {\n          var currentLoading, promise, us;\n          us = $model.$modelValue.clone();\n          us.client_requirement = client_requirement;\n          currentLoading = $loading().target($el.find(\"label\")).start();\n          promise = $tgrepo.save(us);\n          promise.then(function() {\n            $model.$setViewValue(us);\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".client-requirement\", function(event) {\n        var client_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        client_requirement = !$model.$modelValue.client_requirement;\n        return save(client_requirement);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsClientRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsClientRequirementButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks/detail.coffee\n */\n\n(function() {\n  var TaskDetailController, TaskIsIocaineButtonDirective, TaskStatusButtonDirective, TaskStatusDisplayDirective, bindMethods, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTasks\");\n\n  TaskDetailController = (function(superClass) {\n    extend(TaskDetailController, superClass);\n\n    TaskDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.taskRef = this.params.taskref;\n      this.scope.sectionName = this.translate.instant(\"TASK.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"TASK.PAGE_TITLE\", {\n        taskRef: \"#\" + this.scope.task.ref,\n        taskSubject: this.scope.task.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"TASK.PAGE_DESCRIPTION\", {\n        taskStatus: ((ref = this.scope.statusById[this.scope.task.status]) != null ? ref.name : void 0) || \"--\",\n        taskDescription: angular.element(this.scope.task.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on task\", 1);\n        };\n      })(this));\n      this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadTask();\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.task.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else if (this.scope.task.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        if (this.scope.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      }\n    };\n\n    TaskDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.task_statuses;\n          _this.scope.statusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadTask = function() {\n      return this.rs.tasks.getByRef(this.scope.projectId, this.params.taskref).then((function(_this) {\n        return function(task) {\n          var ctx, ref, ref1;\n          _this.scope.task = task;\n          _this.scope.taskId = task.id;\n          _this.scope.commentModel = task;\n          if (((ref = _this.scope.task.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.task.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          return task;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadSprint = function() {\n      if (this.scope.task.milestone) {\n        return this.rs.sprints.get(this.scope.task.project, this.scope.task.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadUserStory = function() {\n      if (this.scope.task.user_story) {\n        return this.rs.userstories.get(this.scope.task.project, this.scope.task.user_story).then((function(_this) {\n          return function(us) {\n            _this.scope.us = us;\n            return us;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadTask().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadUserStory()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    TaskDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.upvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.downvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    TaskDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.watch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    return TaskDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskDetailController\", TaskDetailController);\n\n  TaskStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(task) {\n        var html, status;\n        status = $scope.statusById[task.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task != null) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusDisplay\", [\"$tgTemplate\", \"$compile\", TaskStatusDisplayDirective]);\n\n  TaskStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"us/us-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = (function(_this) {\n        return function(task) {\n          var html, status;\n          status = $scope.statusById[task.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, task;\n          task = $model.$modelValue.clone();\n          task.status = status;\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(task);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return $repo.save(task).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$compile\", \"$translate\", \"$tgTemplate\", TaskStatusButtonDirective]);\n\n  TaskIsIocaineButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $compile, $template) {\n    var link, template;\n    template = $template.get(\"issue/iocaine-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = function(task) {\n        var ctx, html;\n        if (!isEditable() && !task.is_iocaine) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          isIocaine: task.is_iocaine,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(is_iocaine) {\n          var currentLoading, promise, task;\n          task = $model.$modelValue.clone();\n          task.is_iocaine = is_iocaine;\n          currentLoading = $loading().target($el.find('label')).start();\n          promise = $tgrepo.save(task);\n          promise.then(function() {\n            $model.$setViewValue(task);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          return promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".is-iocaine\", function(event) {\n        var is_iocaine;\n        if (!isEditable()) {\n          return;\n        }\n        is_iocaine = !$model.$modelValue.is_iocaine;\n        return save(is_iocaine);\n      });\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskIsIocaineButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$compile\", \"$tgTemplate\", TaskIsIocaineButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team/main.coffee\n */\n\n(function() {\n  var LeaveProjectDirective, TeamController, TeamFiltersDirective, TeamMemberCurrentUserDirective, TeamMemberStatsDirective, TeamMembersDirective, membersFilter, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaTeam\");\n\n  TeamController = (function(superClass) {\n    extend(TeamController, superClass);\n\n    TeamController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$location\", \"$tgNavUrls\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function TeamController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, auth, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.scope.sectionName = \"TEAM.SECTION_NAME\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"TEAM.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"TEAM.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TeamController.prototype.setRole = function(role) {\n      if (role) {\n        return this.scope.filtersRole = role;\n      } else {\n        return this.scope.filtersRole = null;\n      }\n    };\n\n    TeamController.prototype.loadMembers = function() {\n      var i, len, member, ref, user;\n      user = this.auth.getUser();\n      this.scope.totals = {};\n      ref = this.scope.activeUsers;\n      for (i = 0, len = ref.length; i < len; i++) {\n        member = ref[i];\n        this.scope.totals[member.id] = 0;\n      }\n      this.scope.currentUser = _.find(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n      return this.scope.memberships = _.reject(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n    };\n\n    TeamController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issuesEnabled = project.is_issues_activated;\n          _this.scope.tasksEnabled = project.is_kanban_activated || project.is_backlog_activated;\n          _this.scope.wikiEnabled = project.is_wiki_activated;\n          return project;\n        };\n      })(this));\n    };\n\n    TeamController.prototype.loadMemberStats = function() {\n      return this.rs.projects.memberStats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totals;\n          totals = {};\n          _.forEach(_this.scope.totals, function(total, userId) {\n            var vals;\n            vals = _.map(stats, function(memberStats, statsKey) {\n              return memberStats[userId];\n            });\n            total = _.reduce(vals, function(sum, el) {\n              return sum + el;\n            });\n            return _this.scope.totals[userId] = total;\n          });\n          _this.scope.stats = _this._processStats(stats);\n          return _this.scope.stats.totals = _this.scope.totals;\n        };\n      })(this));\n    };\n\n    TeamController.prototype._processStat = function(stat) {\n      var max, min, singleStat;\n      max = _.max(stat);\n      min = _.min(stat);\n      singleStat = _.map(stat, function(value, key) {\n        if (value === min) {\n          return [key, 0.1];\n        }\n        if (value === max) {\n          return [key, 1];\n        }\n        return [key, (value * 0.5) / max];\n      });\n      singleStat = _.object(singleStat);\n      return singleStat;\n    };\n\n    TeamController.prototype._processStats = function(stats) {\n      var key, value;\n      for (key in stats) {\n        value = stats[key];\n        stats[key] = this._processStat(value);\n      }\n      return stats;\n    };\n\n    TeamController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.loadMembers();\n          return _this.loadMemberStats();\n        };\n      })(this));\n    };\n\n    return TeamController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TeamController\", TeamController);\n\n  TeamFiltersDirective = function() {\n    return {\n      templateUrl: \"team/team-filter.html\"\n    };\n  };\n\n  module.directive(\"tgTeamFilters\", [TeamFiltersDirective]);\n\n  TeamMemberStatsDirective = function() {\n    return {\n      templateUrl: \"team/team-member-stats.html\",\n      scope: {\n        stats: \"=\",\n        userId: \"=user\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMemberStats\", TeamMemberStatsDirective);\n\n  TeamMemberCurrentUserDirective = function() {\n    return {\n      templateUrl: \"team/team-member-current-user.html\",\n      scope: {\n        projectId: \"=projectid\",\n        currentUser: \"=currentuser\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamCurrentUser\", TeamMemberCurrentUserDirective);\n\n  TeamMembersDirective = function() {\n    var template;\n    template = \"team/team-members.html\";\n    return {\n      templateUrl: template,\n      scope: {\n        memberships: \"=\",\n        filtersQ: \"=filtersq\",\n        filtersRole: \"=filtersrole\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMembers\", TeamMembersDirective);\n\n  LeaveProjectDirective = function($repo, $confirm, $location, $rs, $navurls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.leave = function() {\n        var confirm_leave_project_text, leave_project_text;\n        leave_project_text = $translate.instant(\"TEAM.ACTION_LEAVE_PROJECT\");\n        confirm_leave_project_text = $translate.instant(\"TEAM.CONFIRM_LEAVE_PROJECT\");\n        return $confirm.ask(leave_project_text, confirm_leave_project_text).then((function(_this) {\n          return function(response) {\n            var promise;\n            promise = $rs.projects.leave($attrs.projectid);\n            promise.then(function() {\n              response.finish();\n              $confirm.notify(\"success\");\n              return $location.path($navurls.resolve(\"home\"));\n            });\n            return promise.then(null, function(response) {\n              response.finish();\n              return $confirm.notify('error', response.data._error_message);\n            });\n          };\n        })(this));\n      };\n    };\n    return {\n      scope: {},\n      templateUrl: \"team/leave-project.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLeaveProject\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgResources\", \"$tgNavUrls\", \"$translate\", LeaveProjectDirective]);\n\n  membersFilter = function() {\n    return function(members, filtersQ, filtersRole) {\n      return _.filter(members, function(m) {\n        return (!filtersRole || m.role === filtersRole.id) && (!filtersQ || m.full_name.search(new RegExp(filtersQ, \"i\")) >= 0);\n      });\n    };\n  };\n\n  module.filter('membersFilter', membersFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var EditableWikiContentDirective, WikiDetailController, WikiSummaryDirective, bindOnce, debounce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiDetailController = (function(superClass) {\n    extend(WikiDetailController, superClass);\n\n    WikiDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$filter\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function WikiDetailController(scope, rootscope, repo, model, confirm, rs, params, q, location, filter, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.filter = filter;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.wikiTitle = this.scope.wikiSlug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, title;\n      title = this.translate.instant(\"WIKI.PAGE_TITLE\", {\n        wikiPageName: this.scope.wikiTitle,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"WIKI.PAGE_DESCRIPTION\", {\n        wikiPageContent: angular.element(((ref = this.scope.wiki) != null ? ref.html : void 0) || \"\").text(),\n        totalEditions: ((ref1 = this.scope.wiki) != null ? ref1.editions : void 0) || 0,\n        lastModifiedDate: moment((ref2 = this.scope.wiki) != null ? ref2.modified_date : void 0).format(this.translate.instant(\"WIKI.DATETIME\"))\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    WikiDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_wiki_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWiki = function() {\n      var promise;\n      promise = this.rs.wiki.getBySlug(this.scope.projectId, this.params.slug);\n      promise.then((function(_this) {\n        return function(wiki) {\n          _this.scope.wiki = wiki;\n          _this.scope.wikiId = wiki.id;\n          return _this.scope.wiki;\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function(xhr) {\n          var data;\n          _this.scope.wikiId = null;\n          if (_this.scope.project.my_permissions.indexOf(\"add_wiki_page\") === -1) {\n            return null;\n          }\n          data = {\n            project: _this.scope.projectId,\n            slug: _this.scope.wikiSlug,\n            content: \"\"\n          };\n          _this.scope.wiki = _this.model.make_model(\"wiki\", data);\n          return _this.scope.wiki;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n          if (selectedWikiLink != null) {\n            return _this.scope.wikiTitle = selectedWikiLink.title;\n          }\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.q.all([_this.loadWikiLinks(), _this.loadWiki()]).then(_this.checkLinksPerms.bind(_this));\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"modify_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    WikiDetailController.prototype[\"delete\"] = function() {\n      var message, title;\n      title = this.translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n      message = this.scope.wikiTitle;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var ctx;\n            askResponse.finish();\n            ctx = {\n              project: _this.scope.projectSlug\n            };\n            _this.location.path(_this.navUrls.resolve(\"project-wiki\", ctx));\n            return _this.confirm.notify(\"success\");\n          };\n          onError = function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          };\n          return _this.repo.remove(_this.scope.wiki).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    return WikiDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiDetailController\", WikiDetailController);\n\n  WikiSummaryDirective = function($log, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-summary.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var render;\n      render = function(wiki) {\n        var ctx, html, user;\n        if ($scope.usersById == null) {\n          $log.error(\"WikiSummaryDirective requires userById set in scope.\");\n        } else {\n          user = $scope.usersById[wiki.last_modifier];\n        }\n        if (user === void 0) {\n          user = {\n            name: \"unknown\",\n            imgUrl: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n        } else {\n          user = {\n            name: user.full_name_display,\n            imgUrl: user.photo\n          };\n        }\n        ctx = {\n          totalEditions: wiki.editions,\n          lastModifiedDate: moment(wiki.modified_date).format($translate.instant(\"WIKI.DATETIME\")),\n          user: user\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        return render(wikiPage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWikiSummary\", [\"$log\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiSummaryDirective]);\n\n  EditableWikiContentDirective = function($window, $document, $repo, $confirm, $loading, $analytics, $qqueue) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, disableEdition, getSelectedText, isEditable, save, switchToEditMode, switchToReadMode;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_wiki_page\") !== -1;\n      };\n      switchToEditMode = function() {\n        $el.find('.edit-wiki-content').show();\n        $el.find('.view-wiki-content').hide();\n        return $el.find('textarea').focus();\n      };\n      switchToReadMode = function() {\n        $el.find('.edit-wiki-content').hide();\n        return $el.find('.view-wiki-content').show();\n      };\n      disableEdition = function() {\n        $el.find(\".view-wiki-content .edit\").remove();\n        return $el.find(\".edit-wiki-content\").remove();\n      };\n      cancelEdition = function() {\n        if (!$model.$modelValue.id) {\n          return;\n        }\n        $scope.$apply((function(_this) {\n          return function() {\n            return $model.$modelValue.revert();\n          };\n        })(this));\n        return switchToReadMode();\n      };\n      getSelectedText = function() {\n        if ($window.getSelection) {\n          return $window.getSelection().toString();\n        } else if ($document.selection) {\n          return $document.selection.createRange().text;\n        }\n        return null;\n      };\n      save = $qqueue.bindAdd(function(wiki) {\n        var currentLoading, onError, onSuccess, promise;\n        onSuccess = function(wikiPage) {\n          if (wiki.id == null) {\n            $analytics.trackEvent(\"wikipage\", \"create\", \"create wiki page\", 1);\n          }\n          $model.$setViewValue(wikiPage.clone());\n          $confirm.notify(\"success\");\n          return switchToReadMode();\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        currentLoading = $loading().removeClasses(\"icon-floppy\").target($el.find('.icon-floppy')).start();\n        if (wiki.id != null) {\n          promise = $repo.save(wiki).then(onSuccess, onError);\n        } else {\n          promise = $repo.create(\"wiki\", wiki).then(onSuccess, onError);\n        }\n        return promise[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"mousedown\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (event.button === 2) {\n\n        }\n      });\n      $el.on(\"mouseup\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (getSelectedText()) {\n          return;\n        }\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if (target.is('pre')) {\n          return;\n        }\n        return switchToEditMode();\n      });\n      $el.on(\"click\", \".save\", debounce(2000, function() {\n        return save($scope.wiki);\n      }));\n      $el.on(\"click\", \".cancel\", function() {\n        return cancelEdition();\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode === 27) {\n          return cancelEdition();\n        }\n      });\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        if (isEditable()) {\n          $el.addClass('editable');\n          if ((wikiPage.id == null) || $.trim(wikiPage.content).length === 0) {\n            return switchToEditMode();\n          }\n        } else {\n          return disableEdition();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      templateUrl: \"wiki/editable-wiki-content.html\"\n    };\n  };\n\n  module.directive(\"tgEditableWikiContent\", [\"$window\", \"$document\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", \"$tgQqueue\", EditableWikiContentDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiNavDirective, bindOnce, groupBy, mixOf, module, taiga;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiNavDirective = function($tgrepo, $log, $location, $confirm, $navUrls, $analytics, $loading, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-nav.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render;\n      $ctrl = $el.controller();\n      if ($attrs.ngModel == null) {\n        return $log.error(\"WikiNavDirective: no ng-model attr is defined\");\n      }\n      render = function(wikiLinks) {\n        var addWikiLinkPermission, deleteWikiLinkPermission, html;\n        addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n        deleteWikiLinkPermission = $scope.project.my_permissions.indexOf(\"delete_wiki_link\") > -1;\n        html = template({\n          wikiLinks: wikiLinks,\n          projectSlug: $scope.projectSlug,\n          addWikiLinkPermission: addWikiLinkPermission,\n          deleteWikiLinkPermission: deleteWikiLinkPermission\n        });\n        html = $compile(html)($scope);\n        $el.off();\n        $el.html(html);\n        $el.on(\"click\", \".wiki-link .link-title\", function(event) {\n          var linkId, linkSlug, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          linkSlug = $scope.wikiLinks[linkId].href;\n          return $scope.$apply(function() {\n            var ctx;\n            ctx = {\n              project: $scope.projectSlug,\n              slug: linkSlug\n            };\n            return $location.path($navUrls.resolve(\"project-wiki-page\", ctx));\n          });\n        });\n        $el.on(\"click\", \".add-button\", function(event) {\n          event.preventDefault();\n          $el.find(\".new\").removeClass(\"hidden\");\n          $el.find(\".new input\").focus();\n          return $el.find(\".add-button\").hide();\n        });\n        $el.on(\"click\", \".wiki-link .icon-delete\", function(event) {\n          var linkId, message, target, title;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          title = $translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n          message = $scope.wikiLinks[linkId].title;\n          return $confirm.askOnDelete(title, message).then((function(_this) {\n            return function(askResponse) {\n              var promise;\n              promise = $tgrepo.remove($scope.wikiLinks[linkId]);\n              promise.then(function() {\n                promise = $ctrl.loadWikiLinks();\n                promise.then(function() {\n                  askResponse.finish();\n                  return render($scope.wikiLinks);\n                });\n                return promise.then(null, function() {\n                  return askResponse.finish();\n                });\n              });\n              return promise.then(null, function() {\n                askResponse.finish(false);\n                return $confirm.notify(\"error\");\n              });\n            };\n          })(this));\n        });\n        return $el.on(\"keyup\", \".new input\", function(event) {\n          var currentLoading, newLink, promise, target;\n          event.preventDefault();\n          if (event.keyCode === 13) {\n            target = angular.element(event.currentTarget);\n            newLink = target.val();\n            currentLoading = $loading().target($el.find(\".new\")).start();\n            promise = $tgrepo.create(\"wiki-links\", {\n              project: $scope.projectId,\n              title: newLink\n            });\n            promise.then(function() {\n              var loadPromise;\n              $analytics.trackEvent(\"wikilink\", \"create\", \"create wiki link\", 1);\n              loadPromise = $ctrl.loadWikiLinks();\n              loadPromise.then(function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return render($scope.wikiLinks);\n              });\n              return loadPromise.then(null, function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return $confirm.notify(\"error\", \"Error loading wiki links\");\n              });\n            });\n            return promise.then(null, function(error) {\n              var ref;\n              currentLoading.finish();\n              $el.find(\".new input\").val(newLink);\n              $el.find(\".new input\").focus().select();\n              if ((error != null ? (ref = error.__all__) != null ? ref[0] : void 0 : void 0) != null) {\n                return $confirm.notify(\"error\", \"The link already exists\");\n              } else {\n                return $confirm.notify(\"error\");\n              }\n            });\n          } else if (event.keyCode === 27) {\n            target = angular.element(event.currentTarget);\n            $el.find(\".new\").addClass(\"hidden\");\n            $el.find(\".new input\").val('');\n            return $el.find(\".add-button\").show();\n          }\n        });\n      };\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiNav\", [\"$tgRepo\", \"$log\", \"$tgLocation\", \"$tgConfirm\", \"$tgNavUrls\", \"$tgAnalytics\", \"$tgLoading\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiNavDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/lightboxes.coffee\n */\n\n(function() {\n  var CreateMembersDirective, MAX_MEMBERSHIP_FIELDSETS, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaKanban\");\n\n  MAX_MEMBERSHIP_FIELDSETS = 4;\n\n  CreateMembersDirective = function($rs, $rootScope, $confirm, $loading, lightboxService, $compile) {\n    var extraTextTemplate, link, template;\n    extraTextTemplate = \"<fieldset class=\\\"extra-text\\\">\\n    <textarea ng-attr-placeholder=\\\"{{'LIGHTBOX.CREATE_MEMBER.PLACEHOLDER_INVITATION_TEXT' | translate}}\\\"\\n              maxlength=\\\"255\\\"></textarea>\\n</fieldset>\";\n    template = _.template(\"<div class=\\\"add-member-wrapper\\\">\\n    <fieldset>\\n        <input tg-capslock type=\\\"email\\\" placeholder=\\\"{{'LIGHTBOX.CREATE_MEMBER.PLACEHOLDER_TYPE_EMAIL' | translate}}\\\"\\n               <% if(required) { %> data-required=\\\"true\\\" <% } %> data-type=\\\"email\\\" />\\n    </fieldset>\\n    <fieldset>\\n        <select <% if(required) { %> data-required=\\\"true\\\" <% } %> data-required=\\\"true\\\">\\n            <% _.each(roleList, function(role) { %>\\n            <option value=\\\"<%- role.id %>\\\"><%- role.name %></option>\\n            <% }); %>\\n        </select>\\n        <a class=\\\"icon icon-plus add-fieldset\\\" href=\\\"\\\"></a>\\n    </fieldset>\\n</div>\");\n    link = function($scope, $el, $attrs) {\n      var createFieldSet, resetForm, submit, submitButton;\n      createFieldSet = function(required) {\n        var ctx;\n        if (required == null) {\n          required = true;\n        }\n        ctx = {\n          roleList: $scope.project.roles,\n          required: required\n        };\n        return $compile(template(ctx))($scope);\n      };\n      resetForm = function() {\n        var fieldSet, invitations;\n        $el.find(\"form textarea\").remove();\n        $el.find(\"form .add-member-wrapper\").remove();\n        invitations = $el.find(\".add-member-forms\");\n        invitations.html($compile(extraTextTemplate)($scope));\n        fieldSet = createFieldSet();\n        return invitations.prepend(fieldSet);\n      };\n      $scope.$on(\"membersform:new\", function() {\n        resetForm();\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \".delete-fieldset\", function(event) {\n        var fieldSet, lastActionButton, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        fieldSet = target.closest('.add-member-wrapper');\n        fieldSet.remove();\n        lastActionButton = $el.find(\".add-member-wrapper fieldset:last > a\");\n        if (lastActionButton.hasClass(\"icon-delete delete-fieldset\")) {\n          return lastActionButton.removeClass(\"icon-delete delete-fieldset\").addClass(\"icon-plus add-fieldset\");\n        }\n      });\n      $el.on(\"click\", \".add-fieldset\", function(event) {\n        var fieldSet, newFieldSet, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        fieldSet = target.closest('.add-member-wrapper');\n        target.removeClass(\"icon-plus add-fieldset\").addClass(\"icon-delete delete-fieldset\");\n        newFieldSet = createFieldSet(false);\n        fieldSet.after(newFieldSet);\n        $scope.$digest();\n        if ($el.find(\".add-member-wrapper\").length === MAX_MEMBERSHIP_FIELDSETS) {\n          return $el.find(\".add-member-wrapper fieldset:last > a\").removeClass(\"icon-plus add-fieldset\").addClass(\"icon-delete delete-fieldset\");\n        }\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, form, invitation_extra_text, invitations, memberWrappers, onError, onSuccess, promise;\n          event.preventDefault();\n          currentLoading = $loading().target(submitButton).start();\n          onSuccess = function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"membersform:new:success\");\n          };\n          onError = function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            $confirm.notify(\"error\");\n            return $rootScope.$broadcast(\"membersform:new:error\");\n          };\n          form = $el.find(\"form\").checksley();\n          form.destroy();\n          form.initialize();\n          if (!form.validate()) {\n            return;\n          }\n          memberWrappers = $el.find(\"form .add-member-wrapper\");\n          memberWrappers = _.filter(memberWrappers, function(mw) {\n            return angular.element(mw).find(\"input\").hasClass('checksley-ok');\n          });\n          invitations = _.map(memberWrappers, function(mw) {\n            var email, memberWrapper, role;\n            memberWrapper = angular.element(mw);\n            email = memberWrapper.find(\"input\");\n            role = memberWrapper.find(\"select\");\n            return {\n              email: email.val(),\n              role_id: role.val()\n            };\n          });\n          if (invitations.length) {\n            invitation_extra_text = $el.find(\"form textarea\").val();\n            promise = $rs.memberships.bulkCreateMemberships($scope.project.id, invitations, invitation_extra_text);\n            return promise.then(onSuccess, onError);\n          }\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateMembers\", [\"$tgResources\", \"$rootScope\", \"$tgConfirm\", \"$tgLoading\", \"lightboxService\", \"$compile\", CreateMembersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var MembershipsController, MembershipsDirective, MembershipsRowActionsDirective, MembershipsRowAdminCheckboxDirective, MembershipsRowAvatarDirective, MembershipsRowRoleSelectorDirective, bindMethods, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  MembershipsController = (function(superClass) {\n    extend(MembershipsController, superClass);\n\n    MembershipsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAnalytics\", \"tgAppMetaService\", \"$translate\"];\n\n    function MembershipsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, analytics, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.project = {};\n      this.scope.filters = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.MEMBERSHIPS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"membersform:new:success\", (function(_this) {\n        return function() {\n          _this.loadMembers();\n          return _this.analytics.trackEvent(\"membership\", \"create\", \"create memberships on admin\", 1);\n        };\n      })(this));\n    }\n\n    MembershipsController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadMembers = function() {\n      var httpFilters;\n      httpFilters = this.getUrlFilters();\n      return this.rs.memberships.list(this.scope.projectId, httpFilters).then((function(_this) {\n        return function(data) {\n          _this.scope.memberships = _.filter(data.models, function(membership) {\n            return membership.user === null || membership.is_user_active;\n          });\n          _this.scope.page = data.current;\n          _this.scope.count = data.count;\n          _this.scope.paginatedBy = data.paginatedBy;\n          return data;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadMembers();\n        };\n      })(this));\n      return promise;\n    };\n\n    MembershipsController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    MembershipsController.prototype.addNewMembers = function() {\n      return this.rootscope.$broadcast(\"membersform:new\");\n    };\n\n    return MembershipsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"MembershipsController\", MembershipsController);\n\n  MembershipsDirective = function($template, $compile) {\n    var link, linkPagination, template;\n    template = $template.get(\"admin/admin-membership-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".memberships-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        $pagEl.html(html);\n        return $pagEl.show();\n      };\n      $scope.$watch(\"memberships\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".memberships-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      $el.on(\"click\", \".memberships-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      return $el.on(\"click\", \".memberships-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadMembers();\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMemberships\", [\"$tgTemplate\", \"$compile\", MembershipsDirective]);\n\n  MembershipsRowAvatarDirective = function($log, $template, $translate) {\n    var link, template;\n    template = $template.get(\"admin/memberships-row-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      var member, pending, render;\n      pending = $translate.instant(\"ADMIN.MEMBERSHIP.STATUS_PENDING\");\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          full_name: member.full_name ? member.full_name : \"\",\n          email: member.user_email ? member.user_email : member.email,\n          imgurl: member.photo ? member.photo : \"/\" + window._version + \"/images/unnamed.png\",\n          pending: !member.is_user_active ? pending : \"\"\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAvatar == null) {\n        return $log.error(\"MembershipsRowAvatarDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAvatar);\n      render(member);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAvatar\", [\"$log\", \"$tgTemplate\", '$translate', MembershipsRowAvatarDirective]);\n\n  MembershipsRowAdminCheckboxDirective = function($log, $repo, $confirm, $template, $compile) {\n    var link, template;\n    template = $template.get(\"admin/admin-memberships-row-checkbox.html\", true);\n    link = function($scope, $el, $attrs) {\n      var html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          inputId: \"is-admin-\" + member.id\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAdminCheckbox == null) {\n        return $log.error(\"MembershipsRowAdminCheckboxDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAdminCheckbox);\n      html = render(member);\n      if (member.is_owner) {\n        $el.find(\":checkbox\").prop(\"checked\", true);\n      }\n      $el.on(\"click\", \":checkbox\", (function(_this) {\n        return function(event) {\n          var onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function(data) {\n            member.revert();\n            $el.find(\":checkbox\").prop(\"checked\", member.is_owner);\n            return $confirm.notify(\"error\", data.is_owner[0]);\n          };\n          target = angular.element(event.currentTarget);\n          member.is_owner = target.prop(\"checked\");\n          return $repo.save(member).then(onSuccess, onError);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAdminCheckbox\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", MembershipsRowAdminCheckboxDirective]);\n\n  MembershipsRowRoleSelectorDirective = function($log, $repo, $confirm) {\n    var link, template;\n    template = _.template(\"<select>\\n    <% _.each(roleList, function(role) { %>\\n    <option value=\\\"<%- role.id %>\\\" <% if(selectedRole === role.id){ %>selected=\\\"selected\\\"<% } %>>\\n        <%- role.name %>\\n    </option>\\n    <% }); %>\\n</select>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          roleList: $scope.project.roles,\n          selectedRole: member.role\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowRoleSelector == null) {\n        return $log.error(\"MembershipsRowRoleSelectorDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowRoleSelector);\n      html = render(member);\n      $el.on(\"change\", \"select\", (function(_this) {\n        return function(event) {\n          var newRole, onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          target = angular.element(event.currentTarget);\n          newRole = parseInt(target.val(), 10);\n          if (member.role !== newRole) {\n            member.role = newRole;\n            return $repo.save(member).then(onSuccess, onError);\n          }\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowRoleSelector\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", MembershipsRowRoleSelectorDirective]);\n\n  MembershipsRowActionsDirective = function($log, $repo, $rs, $confirm, $compile, $translate) {\n    var activedTemplate, link, pendingTemplate;\n    activedTemplate = \"<div class=\\\"active\\\"\\n     translate=\\\"ADMIN.MEMBERSHIP.STATUS_ACTIVE\\\">\\n</div>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <span class=\\\"icon icon-delete\\\"></span>\\n</a>\";\n    pendingTemplate = \"<a class=\\\"resend js-resend\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.RESEND' | translate }}\\\"\\n   translate=\\\"ADMIN.MEMBERSHIP.RESEND\\\">\\n</a>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <span class=\\\"icon icon-delete\\\"></span>\\n</a>\";\n    link = function($scope, $el, $attrs) {\n      var $ctrl, member, render;\n      render = function(member) {\n        var html;\n        if (member.user) {\n          html = $compile(activedTemplate)($scope);\n        } else {\n          html = $compile(pendingTemplate)($scope);\n        }\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowActions == null) {\n        return $log.error(\"MembershipsRowActionsDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowActions);\n      render(member);\n      $el.on(\"click\", \".js-resend\", function(event) {\n        var onError, onSuccess;\n        event.preventDefault();\n        onSuccess = function() {\n          var text;\n          text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION\", {\n            email: $scope.member.email\n          });\n          return $confirm.notify(\"success\", text);\n        };\n        onError = function() {\n          var text;\n          text = $translate.instant(\"ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION\");\n          return $confirm.notify(\"error\", text);\n        };\n        return $rs.memberships.resendInvitation($scope.member.id).then(onSuccess, onError);\n      });\n      $el.on(\"click\", \".delete\", function(event) {\n        var defaultMsg, message, title;\n        event.preventDefault();\n        title = $translate.instant(\"ADMIN.MEMBERSHIP.DELETE_MEMBER\");\n        defaultMsg = $translate.instant(\"ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE\", {\n          email: member.email\n        });\n        message = member.user ? member.full_name : defaultMsg;\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish();\n              if ($scope.page > 1 && ($scope.count - 1) <= $scope.paginatedBy) {\n                $ctrl.selectFilter(\"page\", $scope.page - 1);\n              }\n              $ctrl.loadMembers();\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_DELETE\");\n              return $confirm.notify(\"success\", null, text);\n            };\n          })(this);\n          onError = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish(false);\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.ERROR_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"error\", null, text);\n            };\n          })(this);\n          return $repo.remove(member).then(onSuccess, onError);\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowActions\", [\"$log\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$compile\", \"$translate\", MembershipsRowActionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/nav.coffee\n */\n\n(function() {\n  var AdminNavigationDirective, module;\n\n  AdminNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgAdminNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#adminmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaAdmin\");\n\n  module.directive(\"tgAdminNavigation\", AdminNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var CsvExporterController, CsvExporterIssuesController, CsvExporterTasksController, CsvExporterUserstoriesController, CsvIssueDirective, CsvTaskDirective, CsvUsDirective, ProjectDefaultValuesDirective, ProjectExportDirective, ProjectLogoDirective, ProjectLogoModelDirective, ProjectModulesDirective, ProjectProfileController, ProjectProfileDirective, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectProfileController = (function(superClass) {\n    extend(ProjectProfileController, superClass);\n\n    ProjectProfileController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectProfileController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectProfileController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.prioritiesList = _.sortBy(project.priorities, \"order\");\n          _this.scope.severitiesList = _.sortBy(project.severities, \"order\");\n          _this.scope.triggersList = _.sortBy(project.triggers, \"order\");\n          _this.scope.issueTypesList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectProfileController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    ProjectProfileController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.project);\n    };\n\n    return ProjectProfileController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectProfileController\", ProjectProfileController);\n\n  ProjectProfileDirective = function($repo, $confirm, $loading, $navurls, $location, projectService, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, form, submit, submitButton;\n      $ctrl = $el.controller();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            var newUrl;\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            newUrl = $navurls.resolve(\"project-admin-project-profile-details\", {\n              project: $scope.project.slug\n            });\n            $location.path(newUrl);\n            $ctrl.loadInitialData();\n            projectService.fetchProject();\n            return currentUserService.loadProjects();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectProfile\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgNavUrls\", \"$tgLocation\", \"tgProjectService\", \"tgCurrentUserService\", ProjectProfileDirective]);\n\n  ProjectDefaultValuesDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectDefaultValues\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", ProjectDefaultValuesDirective]);\n\n  ProjectModulesDirective = function($repo, $confirm, $loading, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = (function(_this) {\n        return function() {\n          var currentLoading, form, promise, target;\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          target = angular.element(\".admin-functionalities .submit-button\");\n          currentLoading = $loading().target(target).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            $scope.$emit(\"project:loaded\", $scope.project);\n            return projectService.fetchProject();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            return $confirm.notify(\"error\", data._error_message);\n          });\n        };\n      })(this);\n      $el.on(\"submit\", \"form\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \".admin-functionalities a.button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $scope.$watch(\"isVideoconferenceActivated\", function(isVideoconferenceActivated) {\n        if (isVideoconferenceActivated) {\n          return $el.find(\".videoconference-attributes\").removeClass(\"hidden\");\n        } else {\n          $el.find(\".videoconference-attributes\").addClass(\"hidden\");\n          $scope.project.videoconferences = null;\n          return $scope.project.videoconferences_extra_data = \"\";\n        }\n      });\n      return $scope.$watch(\"project\", function(project) {\n        if (project.videoconferences != null) {\n          return $scope.isVideoconferenceActivated = true;\n        } else {\n          return $scope.isVideoconferenceActivated = false;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectModules\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgProjectService\", ProjectModulesDirective]);\n\n  ProjectExportDirective = function($window, $rs, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var asyn_message, buttonsEl, dump_ready_text, hideButtons, hideResult, hideSpinner, loading_msg, loading_title, resultEl, resultMessageEl, resultTitleEl, setAsyncMessage, setAsyncTitle, setLoadingMessage, setLoadingTitle, setSyncMessage, setSyncTitle, showButtons, showErrorMode, showExportResultAsyncMode, showExportResultSyncMode, showLoadingMode, showResult, showSpinner, spinnerEl, syn_message;\n      buttonsEl = $el.find(\".admin-project-export-buttons\");\n      showButtons = function() {\n        return buttonsEl.removeClass(\"hidden\");\n      };\n      hideButtons = function() {\n        return buttonsEl.addClass(\"hidden\");\n      };\n      resultEl = $el.find(\".admin-project-export-result\");\n      showResult = function() {\n        return resultEl.removeClass(\"hidden\");\n      };\n      hideResult = function() {\n        return resultEl.addClass(\"hidden\");\n      };\n      spinnerEl = $el.find(\".spin\");\n      showSpinner = function() {\n        return spinnerEl.removeClass(\"hidden\");\n      };\n      hideSpinner = function() {\n        return spinnerEl.addClass(\"hidden\");\n      };\n      resultTitleEl = $el.find(\".result-title\");\n      loading_title = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_TITLE\");\n      loading_msg = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_MESSAGE\");\n      dump_ready_text = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.DUMP_READY\"));\n      };\n      asyn_message = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE\"));\n      };\n      syn_message = function(url) {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.SYNC_MESSAGE\", {\n          url: url\n        }));\n      };\n      setLoadingTitle = function() {\n        return resultTitleEl.html(loading_title);\n      };\n      setAsyncTitle = function() {\n        return resultTitleEl.html(loading_msg);\n      };\n      setSyncTitle = function() {\n        return resultTitleEl.html(dump_ready_text);\n      };\n      resultMessageEl = $el.find(\".result-message \");\n      setLoadingMessage = function() {\n        return resultMessageEl.html(loading_msg);\n      };\n      setAsyncMessage = function() {\n        return resultMessageEl.html(asyn_message);\n      };\n      setSyncMessage = function(url) {\n        return resultMessageEl.html(syn_message(url));\n      };\n      showLoadingMode = function() {\n        showSpinner();\n        setLoadingTitle();\n        setLoadingMessage();\n        hideButtons();\n        return showResult();\n      };\n      showExportResultAsyncMode = function() {\n        hideSpinner();\n        setAsyncTitle();\n        return setAsyncMessage();\n      };\n      showExportResultSyncMode = function(url) {\n        hideSpinner();\n        setSyncTitle();\n        return setSyncMessage(url);\n      };\n      showErrorMode = function() {\n        hideSpinner();\n        hideResult();\n        return showButtons();\n      };\n      return $el.on(\"click\", \"a.button-export\", debounce(2000, (function(_this) {\n        return function(event) {\n          var onError, onSuccess;\n          event.preventDefault();\n          onSuccess = function(result) {\n            var dumpUrl;\n            if (result.status === 202) {\n              return showExportResultAsyncMode();\n            } else {\n              dumpUrl = result.data.url;\n              showExportResultSyncMode(dumpUrl);\n              return $window.open(dumpUrl, \"_blank\");\n            }\n          };\n          onError = function(result) {\n            var errorMsg, ref;\n            showErrorMode();\n            errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\", {\n                message: result.data._error_message\n              });\n            }\n            return $confirm.notify(\"error\", errorMsg);\n          };\n          showLoadingMode();\n          return $rs.projects[\"export\"]($scope.projectId).then(onSuccess, onError);\n        };\n      })(this)));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectExport\", [\"$window\", \"$tgResources\", \"$tgConfirm\", \"$translate\", ProjectExportDirective]);\n\n  CsvExporterController = (function(superClass) {\n    extend(CsvExporterController, superClass);\n\n    CsvExporterController.$inject = [\"$scope\", \"$rootScope\", \"$tgUrls\", \"$tgConfirm\", \"$tgResources\", \"$translate\"];\n\n    function CsvExporterController(scope, rootscope, urls, confirm, rs, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.urls = urls;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.translate = translate;\n      this._generateUuid = bind(this._generateUuid, this);\n      this.setCsvUuid = bind(this.setCsvUuid, this);\n      this.rootscope.$on(\"project:loaded\", this.setCsvUuid);\n      this.scope.$watch(\"csvUuid\", (function(_this) {\n        return function(value) {\n          if (value) {\n            return _this.scope.csvUrl = _this.urls.resolveAbsolute(_this.type + \"-csv\", value);\n          } else {\n            return _this.scope.csvUrl = \"\";\n          }\n        };\n      })(this));\n    }\n\n    CsvExporterController.prototype.setCsvUuid = function() {\n      return this.scope.csvUuid = this.scope.project[this.type + \"_csv_uuid\"];\n    };\n\n    CsvExporterController.prototype._generateUuid = function(response) {\n      var promise;\n      if (response == null) {\n        response = null;\n      }\n      promise = this.rs.projects[\"regenerate_\" + this.type + \"_csv_uuid\"](this.scope.projectId);\n      promise.then((function(_this) {\n        return function(data) {\n          var ref;\n          return _this.scope.csvUuid = (ref = data.data) != null ? ref.uuid : void 0;\n        };\n      })(this));\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n      promise[\"finally\"](function() {\n        if (response) {\n          return response.finish();\n        }\n      });\n      return promise;\n    };\n\n    CsvExporterController.prototype.regenerateUuid = function() {\n      var subtitle, title;\n      if (this.scope.csvUuid) {\n        title = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_TITLE\");\n        subtitle = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_SUBTITLE\");\n        return this.confirm.ask(title, subtitle).then(this._generateUuid);\n      } else {\n        return this._generateUuid();\n      }\n    };\n\n    return CsvExporterController;\n\n  })(taiga.Controller);\n\n  CsvExporterUserstoriesController = (function(superClass) {\n    extend(CsvExporterUserstoriesController, superClass);\n\n    function CsvExporterUserstoriesController() {\n      return CsvExporterUserstoriesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterUserstoriesController.prototype.type = \"userstories\";\n\n    return CsvExporterUserstoriesController;\n\n  })(CsvExporterController);\n\n  CsvExporterTasksController = (function(superClass) {\n    extend(CsvExporterTasksController, superClass);\n\n    function CsvExporterTasksController() {\n      return CsvExporterTasksController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterTasksController.prototype.type = \"tasks\";\n\n    return CsvExporterTasksController;\n\n  })(CsvExporterController);\n\n  CsvExporterIssuesController = (function(superClass) {\n    extend(CsvExporterIssuesController, superClass);\n\n    function CsvExporterIssuesController() {\n      return CsvExporterIssuesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterIssuesController.prototype.type = \"issues\";\n\n    return CsvExporterIssuesController;\n\n  })(CsvExporterController);\n\n  module.controller(\"CsvExporterUserstoriesController\", CsvExporterUserstoriesController);\n\n  module.controller(\"CsvExporterTasksController\", CsvExporterTasksController);\n\n  module.controller(\"CsvExporterIssuesController\", CsvExporterIssuesController);\n\n  CsvUsDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_US\";\n    };\n    return {\n      controller: \"CsvExporterUserstoriesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvUs\", [\"$translate\", CsvUsDirective]);\n\n  CsvTaskDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_TASK\";\n    };\n    return {\n      controller: \"CsvExporterTasksController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvTask\", [\"$translate\", CsvTaskDirective]);\n\n  CsvIssueDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_ISSUE\";\n    };\n    return {\n      controller: \"CsvExporterIssuesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvIssue\", [\"$translate\", CsvIssueDirective]);\n\n  ProjectLogoDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").addClass(\"active\");\n      };\n      onSuccess = function(response) {\n        var project;\n        project = $model.make_model(\"projects\", response.data);\n        $scope.project = project;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-logo\", function() {\n        return $el.find(\"#logo-field\").click();\n      });\n      $el.on(\"change\", \"#logo-field\", function(event) {\n        if ($scope.logoAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.projects.changeLogo($scope.project.id, $scope.logoAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-default-logo\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.projects.removeLogo($scope.project.id).then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectLogo\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", ProjectLogoDirective]);\n\n  ProjectLogoModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgProjectLogoModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgProjectLogoModel', ['$parse', ProjectLogoModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var ColorSelectionDirective, DATE_TYPE, MULTILINE_TYPE, ProjectCustomAttributesController, ProjectCustomAttributesDirective, ProjectValuesController, ProjectValuesDirective, ProjectValuesSectionController, SELECT_TYPE, TEXT_TYPE, TYPE_CHOICES, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectValuesSectionController = (function(superClass) {\n    extend(ProjectValuesSectionController, superClass);\n\n    ProjectValuesSectionController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectValuesSectionController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_VALUES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    ProjectValuesSectionController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectValuesSectionController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    return ProjectValuesSectionController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectValuesSectionController\", ProjectValuesSectionController);\n\n  ProjectValuesController = (function(superClass) {\n    extend(ProjectValuesController, superClass);\n\n    ProjectValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\"];\n\n    function ProjectValuesController(scope, rootscope, repo, confirm, rs) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.moveValue = bind(this.moveValue, this);\n      this.loadValues = bind(this.loadValues, this);\n      this.scope.$on(\"admin:project-values:move\", this.moveValue);\n      this.rootscope.$on(\"project:loaded\", this.loadValues);\n    }\n\n    ProjectValuesController.prototype.loadValues = function() {\n      return this.rs[this.scope.resource].listValues(this.scope.projectId, this.scope.type).then((function(_this) {\n        return function(values) {\n          _this.scope.values = values;\n          _this.scope.maxValueOrder = _.max(values, \"order\").order;\n          return values;\n        };\n      })(this));\n    };\n\n    ProjectValuesController.prototype.moveValue = function(ctx, itemValue, itemIndex) {\n      var r, values;\n      values = this.scope.values;\n      r = values.indexOf(itemValue);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, itemValue);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return ProjectValuesController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectValuesController\", ProjectValuesController);\n\n  ProjectValuesDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link, linkDragAndDrop, linkValue;\n    linkDragAndDrop = function($scope, $el, $attrs) {\n      var itemEl, newParentScope, oldParentScope, tdom;\n      oldParentScope = null;\n      newParentScope = null;\n      itemEl = null;\n      tdom = $el.find(\".sortable\");\n      tdom.sortable({\n        handle: \".row.table-main.visualization\",\n        dropOnEmpty: true,\n        connectWith: \".project-values-body\",\n        revert: 400,\n        axis: \"y\"\n      });\n      tdom.on(\"sortstop\", function(event, ui) {\n        var itemIndex, itemValue;\n        itemEl = ui.item;\n        itemValue = itemEl.scope().value;\n        itemIndex = itemEl.index();\n        return $scope.$broadcast(\"admin:project-values:move\", itemValue, itemIndex);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    linkValue = function($scope, $el, $attrs) {\n      var $ctrl, cancel, goToBottomList, initializeNewValue, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"is_closed\": false,\n          \"is_archived\": false\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_\" + (objName.toUpperCase()) + \".ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = function(target) {\n        var form, formEl, promise, value;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        value = formEl.scope().value;\n        promise = $repo.save(value);\n        promise.then((function(_this) {\n          return function() {\n            var row;\n            row = target.parents(\".row.table-main\");\n            row.addClass(\"hidden\");\n            return row.siblings(\".visualization\").removeClass('hidden');\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      saveNewValue = function(target) {\n        var form, formEl, promise;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        $scope.newValue.order = $scope.maxValueOrder ? $scope.maxValueOrder + 1 : 1;\n        promise = $repo.create(valueType, $scope.newValue);\n        promise.then((function(_this) {\n          return function(data) {\n            target.addClass(\"hidden\");\n            $scope.values.push(data);\n            $scope.maxValueOrder = data.order;\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      cancel = function(target) {\n        var formEl, row, value;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          value.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").removeClass('hidden');\n        return goToBottomList(true);\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".edition input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return saveValue(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      return $el.on(\"click\", \".delete-value\", function(event) {\n        var choices, formEl, subtitle, target, text, title, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        choices = {};\n        _.each($scope.values, function(option) {\n          if (value.id !== option.id) {\n            return choices[option.id] = option.name;\n          }\n        });\n        subtitle = value.name;\n        if (_.keys(choices).length === 0) {\n          return $confirm.error($translate.instant(\"ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL\"));\n        }\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\");\n        text = $translate.instant(\"ADMIN.PROJECT_VALUES.REPLACEMENT\");\n        return $confirm.askChoice(title, subtitle, choices, text).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadValues()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $repo.remove(value, {\n            \"moveTo\": response.selected\n          }).then(onSucces, onError);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      linkDragAndDrop($scope, $el, $attrs);\n      linkValue($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectValues\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectValuesDirective]);\n\n  ColorSelectionDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$watch($attrs.ngModel, function(element) {\n        return $scope.color = element.color;\n      });\n      $el.on(\"click\", \".current-color\", function(event) {\n        var body, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        $el.find(\".select-color\").hide();\n        target.siblings(\".select-color\").show();\n        body = angular.element(\"body\");\n        return body.on(\"click\", (function(_this) {\n          return function(event) {\n            if (angular.element(event.target).parent(\".select-color\").length === 0) {\n              $el.find(\".select-color\").hide();\n              return body.unbind(\"click\");\n            }\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".select-color .color\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $model.$modelValue.color = target.data(\"color\");\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"click\", \".select-color .selected-color\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $model.$modelValue.color = $scope.color;\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgColorSelection\", ColorSelectionDirective);\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  SELECT_TYPE = \"select\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: SELECT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_SELECT\"\n    }\n  ];\n\n  ProjectCustomAttributesController = (function(superClass) {\n    extend(ProjectCustomAttributesController, superClass);\n\n    ProjectCustomAttributesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectCustomAttributesController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.moveCustomAttributes = bind(this.moveCustomAttributes, this);\n      this.deleteCustomAttribute = bind(this.deleteCustomAttribute, this);\n      this.saveCustomAttribute = bind(this.saveCustomAttribute, this);\n      this.createCustomAttribute = bind(this.createCustomAttribute, this);\n      this.loadCustomAttributes = bind(this.loadCustomAttributes, this);\n      this.scope.TYPE_CHOICES = TYPE_CHOICES;\n      this.scope.project = {};\n      this.rootscope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          _this.loadCustomAttributes();\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectCustomAttributesController.prototype.loadCustomAttributes = function() {\n      return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((function(_this) {\n        return function(customAttributes) {\n          _this.scope.customAttributes = customAttributes;\n          _this.scope.maxOrder = _.max(customAttributes, \"order\").order;\n          return customAttributes;\n        };\n      })(this));\n    };\n\n    ProjectCustomAttributesController.prototype.createCustomAttribute = function(attrValues) {\n      return this.repo.create(\"custom-attributes/\" + this.scope.type, attrValues);\n    };\n\n    ProjectCustomAttributesController.prototype.saveCustomAttribute = function(attrModel) {\n      return this.repo.save(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.deleteCustomAttribute = function(attrModel) {\n      return this.repo.remove(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.moveCustomAttributes = function(attrModel, newIndex) {\n      var customAttributes, r;\n      customAttributes = this.scope.customAttributes;\n      r = customAttributes.indexOf(attrModel);\n      customAttributes.splice(r, 1);\n      customAttributes.splice(newIndex, 0, attrModel);\n      _.each(customAttributes, function(val, idx) {\n        return val.order = idx;\n      });\n      return this.repo.saveAll(customAttributes);\n    };\n\n    return ProjectCustomAttributesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectCustomAttributesController\", ProjectCustomAttributesController);\n\n  ProjectCustomAttributesDirective = function($log, $confirm, animationFrame, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, cancelCreate, cancelUpdate, create, deleteCustomAttribute, hideAddButton, hideCancelButton, hideCreateForm, hideEditForm, resetNewAttr, revertChangesInCustomAttribute, showAddButton, showCancelButton, showCreateForm, showEditForm, sortableEl, update;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      sortableEl = $el.find(\".js-sortable\");\n      sortableEl.sortable({\n        handle: \".js-view-custom-field\",\n        dropOnEmpty: true,\n        revert: 400,\n        axis: \"y\"\n      });\n      sortableEl.on(\"sortstop\", function(event, ui) {\n        var itemAttr, itemEl, itemIndex;\n        itemEl = ui.item;\n        itemAttr = itemEl.scope().attr;\n        itemIndex = itemEl.index();\n        return $ctrl.moveCustomAttributes(itemAttr, itemIndex);\n      });\n      showCreateForm = function() {\n        $el.find(\".js-new-custom-field\").removeClass(\"hidden\");\n        return $el.find(\".js-new-custom-field input:visible\").first().focus();\n      };\n      hideCreateForm = function() {\n        return $el.find(\".js-new-custom-field\").addClass(\"hidden\");\n      };\n      showAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").addClass(\"hidden\");\n      };\n      showCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").addClass(\"hidden\");\n      };\n      resetNewAttr = function() {\n        return $scope.newAttr = {};\n      };\n      create = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideCreateForm();\n            resetNewAttr();\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = $scope.newAttr;\n        attr.project = $scope.projectId;\n        attr.order = $scope.maxOrder ? $scope.maxOrder + 1 : 1;\n        return $ctrl.createCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelCreate = function() {\n        hideCreateForm();\n        return resetNewAttr();\n      };\n      $scope.$watch(\"customAttributes\", function(customAttributes) {\n        if (!customAttributes) {\n          return;\n        }\n        if (customAttributes.length === 0) {\n          hideCancelButton();\n          hideAddButton();\n          return showCreateForm();\n        } else {\n          hideCreateForm();\n          showAddButton();\n          return showCancelButton();\n        }\n      });\n      $el.on(\"click\", \".js-add-custom-field-button\", function(event) {\n        event.preventDefault();\n        return showCreateForm();\n      });\n      $el.on(\"click\", \".js-create-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return create(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-new-custom-field-button\", function(event) {\n        event.preventDefault();\n        return cancelCreate();\n      });\n      $el.on(\"keyup\", \".js-new-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return create(formEl);\n        } else if (event.keyCode === 27) {\n          return cancelCreate();\n        }\n      });\n      showEditForm = function(formEl) {\n        formEl.find(\".js-view-custom-field\").addClass(\"hidden\");\n        formEl.find(\".js-edit-custom-field\").removeClass(\"hidden\");\n        return formEl.find(\".js-edit-custom-field input:visible\").first().focus().select();\n      };\n      hideEditForm = function(formEl) {\n        formEl.find(\".js-edit-custom-field\").addClass(\"hidden\");\n        return formEl.find(\".js-view-custom-field\").removeClass(\"hidden\");\n      };\n      revertChangesInCustomAttribute = function(formEl) {\n        return $scope.$apply(function() {\n          return formEl.scope().attr.revert();\n        });\n      };\n      update = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideEditForm(formEl);\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = formEl.scope().attr;\n        return $ctrl.saveCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelUpdate = function(formEl) {\n        hideEditForm(formEl);\n        return revertChangesInCustomAttribute(formEl);\n      };\n      $el.on(\"click\", \".js-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return showEditForm(formEl);\n      });\n      $el.on(\"click\", \".js-update-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return update(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return cancelUpdate(formEl);\n      });\n      $el.on(\"keyup\", \".js-edit-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return update(formEl);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return cancelUpdate(formEl);\n        }\n      });\n      deleteCustomAttribute = function(formEl) {\n        var attr, message, text, title;\n        attr = formEl.scope().attr;\n        message = attr.name;\n        title = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.DELETE\");\n        text = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE\");\n        return $confirm.ask(title, text, message).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadCustomAttributes()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\", null, \"We have not been able to delete '\" + message + \"'.\");\n          };\n          return $ctrl.deleteCustomAttribute(attr).then(onSucces, onError);\n        });\n      };\n      return $el.on(\"click\", \".js-delete-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return deleteCustomAttribute(formEl);\n      }));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectCustomAttributes\", [\"$log\", \"$tgConfirm\", \"animationFrame\", \"$translate\", ProjectCustomAttributesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var EditRoleDirective, NewRoleDirective, RolePermissionsDirective, RolesController, RolesDirective, bindMethods, bindOnce, debounce, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  RolesController = (function(superClass) {\n    extend(RolesController, superClass);\n\n    RolesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function RolesController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this._disableComputable = bind(this._disableComputable, this);\n      this._enableComputable = bind(this._enableComputable, this);\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.MENU.PERMISSIONS\";\n      this.scope.project = {};\n      this.scope.anyComputableRole = true;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.ROLES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    RolesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.anyComputableRole = _.some(_.map(project.roles, function(point) {\n            return point.computable;\n          }));\n          return project;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadRoles = function() {\n      return this.rs.roles.list(this.scope.projectId).then((function(_this) {\n        return function(roles) {\n          var public_permission;\n          roles = roles.map(function(role) {\n            role.external_user = false;\n            return role;\n          });\n          public_permission = {\n            \"name\": _this.translate.instant(\"ADMIN.ROLES.EXTERNAL_USER\"),\n            \"permissions\": _this.scope.project.public_permissions,\n            \"external_user\": true\n          };\n          roles.push(public_permission);\n          _this.scope.roles = roles;\n          _this.scope.role = _this.scope.roles[0];\n          return roles;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadRoles();\n        };\n      })(this));\n      return promise;\n    };\n\n    RolesController.prototype.setRole = function(role) {\n      this.scope.role = role;\n      return this.scope.$broadcast(\"role:changed\", this.scope.role);\n    };\n\n    RolesController.prototype[\"delete\"] = function() {\n      var choices, i, len, ref, replacement, role, subtitle, title, warning;\n      choices = {};\n      ref = this.scope.roles;\n      for (i = 0, len = ref.length; i < len; i++) {\n        role = ref[i];\n        if (role.id !== this.scope.role.id) {\n          choices[role.id] = role.name;\n        }\n      }\n      if (_.keys(choices).length === 0) {\n        return this.confirm.error(this.translate.instant(\"ADMIN.ROLES.ERROR_DELETE_ALL\"));\n      }\n      title = this.translate.instant(\"ADMIN.ROLES.TITLE_DELETE_ROLE\");\n      subtitle = this.scope.role.name;\n      replacement = this.translate.instant(\"ADMIN.ROLES.REPLACEMENT_ROLE\");\n      warning = this.translate.instant(\"ADMIN.ROLES.WARNING_DELETE_ROLE\");\n      return this.confirm.askChoice(title, subtitle, choices, replacement, warning).then((function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            _this.loadProject();\n            return _this.loadRoles()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return _this.confirm.notify('error');\n          };\n          return _this.repo.remove(_this.scope.role, {\n            moveTo: response.selected\n          }).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    RolesController.prototype._enableComputable = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"success\");\n          return _this.loadProject();\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.scope.role.revert();\n        };\n      })(this);\n      return this.repo.save(this.scope.role).then(onSuccess, onError);\n    };\n\n    RolesController.prototype._disableComputable = function() {\n      var askOnError, askOnSuccess, message, subtitle, title;\n      askOnSuccess = (function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            response.finish();\n            _this.confirm.notify(\"success\");\n            return _this.loadProject();\n          };\n          onError = function() {\n            response.finish();\n            _this.confirm.notify(\"error\");\n            return _this.scope.role.revert();\n          };\n          return _this.repo.save(_this.scope.role).then(onSuccess, onError);\n        };\n      })(this);\n      askOnError = (function(_this) {\n        return function(response) {\n          return _this.scope.role.revert();\n        };\n      })(this);\n      title = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE\");\n      subtitle = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE\", {\n        roleName: this.scope.role.name\n      });\n      message = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_MESSAGE\");\n      return this.confirm.ask(title, subtitle, message).then(askOnSuccess, askOnError);\n    };\n\n    RolesController.prototype.toggleComputable = debounce(2000, function() {\n      if (!this.scope.role.computable) {\n        return this._disableComputable();\n      } else {\n        return this._enableComputable();\n      }\n    });\n\n    return RolesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"RolesController\", RolesController);\n\n  EditRoleDirective = function($repo, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, toggleView;\n      toggleView = function() {\n        $el.find('.total').toggle();\n        return $el.find('.edit-role').toggle();\n      };\n      submit = function() {\n        var promise;\n        $scope.role.name = $el.find(\"input\").val();\n        promise = $repo.save($scope.role);\n        promise.then(function() {\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function(data) {\n          return $confirm.notify(\"error\");\n        });\n        return toggleView();\n      };\n      $el.on(\"click\", \"a.icon-edit\", function() {\n        toggleView();\n        $el.find(\"input\").focus();\n        return $el.find(\"input\").val($scope.role.name);\n      });\n      $el.on(\"click\", \"a.save\", submit);\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return submit();\n        } else if (event.keyCode === 27) {\n          return toggleView();\n        }\n      });\n      $scope.$on(\"role:changed\", function() {\n        if ($el.find('.edit-role').is(\":visible\")) {\n          return toggleView();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgEditRole\", [\"$tgRepo\", \"$tgConfirm\", EditRoleDirective]);\n\n  RolesDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRoles\", RolesDirective);\n\n  NewRoleDirective = function($tgrepo, $confirm) {\n    var DEFAULT_PERMISSIONS, link;\n    DEFAULT_PERMISSIONS = [\"view_project\", \"view_milestones\", \"view_us\", \"view_tasks\", \"view_issues\"];\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \"a.add-button\", function(event) {\n        event.preventDefault();\n        $el.find(\".new\").removeClass(\"hidden\");\n        $el.find(\".new\").focus();\n        return $el.find(\".add-button\").hide();\n      });\n      return $el.on(\"keyup\", \".new\", function(event) {\n        var newRole, onError, onSuccess, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newRole = {\n            project: $scope.projectId,\n            name: target.val(),\n            permissions: DEFAULT_PERMISSIONS,\n            order: _.max($scope.roles, function(r) {\n              return r.order;\n            }).order + 1,\n            computable: false\n          };\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          onSuccess = function(role) {\n            var insertPosition;\n            insertPosition = $scope.roles.length - 1;\n            $scope.roles.splice(insertPosition, 0, role);\n            $ctrl.setRole(role);\n            $el.find(\".add-button\").show();\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $tgrepo.create(\"roles\", newRole).then(onSuccess, onError);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          return $el.find(\".add-button\").show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewRole\", [\"$tgRepo\", \"$tgConfirm\", NewRoleDirective]);\n\n  RolePermissionsDirective = function($rootscope, $repo, $confirm, $compile) {\n    var baseTemplate, categoryTemplate, link, resumeTemplate;\n    resumeTemplate = _.template(\"<div class=\\\"resume-title\\\" translate=\\\"<%- category.name %>\\\"></div>\\n<div class=\\\"summary-role\\\">\\n    <div class=\\\"count\\\"><%- category.activePermissions %>/<%- category.permissions.length %></div>\\n    <% _.each(category.permissions, function(permission) { %>\\n        <div class=\\\"role-summary-single <% if(permission.active) { %>active<% } %>\\\"\\n             title=\\\"{{ '<%- permission.name %>' | translate }}\\\"></div>\\n    <% }) %>\\n</div>\\n<div class=\\\"icon icon-arrow-bottom\\\"></div>\");\n    categoryTemplate = _.template(\"<div class=\\\"category-config\\\" data-id=\\\"<%- index %>\\\">\\n    <div class=\\\"resume\\\">\\n    </div>\\n    <div class=\\\"category-items\\\">\\n        <div class=\\\"items-container\\\">\\n        <% _.each(category.permissions, function(permission) { %>\\n            <div class=\\\"category-item\\\" data-id=\\\"<%- permission.key %>\\\">\\n                <span translate=\\\"<%- permission.name %>\\\"></span>\\n                <div class=\\\"check\\\">\\n                    <input type=\\\"checkbox\\\"\\n                           <% if(!permission.editable) { %> disabled=\\\"disabled\\\" <% } %>\\n                           <% if(permission.active) { %> checked=\\\"checked\\\" <% } %>/>\\n                    <div></div>\\n                    <span class=\\\"check-text check-yes\\\" translate=\\\"COMMON.YES\\\"></span>\\n                    <span class=\\\"check-text check-no\\\" translate=\\\"COMMON.NO\\\"></span>\\n                </div>\\n            </div>\\n        <% }) %>\\n        </div>\\n    </div>\\n</div>\");\n    baseTemplate = _.template(\"<div class=\\\"category-config-list\\\"></div>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, generateCategoriesFromRole, renderCategory, renderPermissions, renderResume;\n      $ctrl = $el.controller();\n      generateCategoriesFromRole = function(role) {\n        var categories, isPermissionEditable, issuePermissions, milestonePermissions, setActivePermissions, setActivePermissionsPerCategory, taskPermissions, userStoryPermissions, wikiPermissions;\n        setActivePermissions = function(permissions) {\n          return _.map(permissions, function(x) {\n            var ref;\n            return _.extend({}, x, {\n              active: (ref = x[\"key\"], indexOf.call(role.permissions, ref) >= 0)\n            });\n          });\n        };\n        isPermissionEditable = function(permission, role, project) {\n          if (role.external_user && !project.is_private && permission.key.indexOf(\"view_\") === 0) {\n            return false;\n          } else {\n            return true;\n          }\n        };\n        setActivePermissionsPerCategory = function(category) {\n          return _.map(category, function(cat) {\n            cat.permissions = cat.permissions.map(function(permission) {\n              permission.editable = isPermissionEditable(permission, role, $scope.project);\n              return permission;\n            });\n            return _.extend({}, cat, {\n              activePermissions: _.filter(cat[\"permissions\"], \"active\").length\n            });\n          });\n        };\n        categories = [];\n        milestonePermissions = [\n          {\n            key: \"view_milestones\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS\"\n          }, {\n            key: \"add_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS\"\n          }, {\n            key: \"modify_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS\"\n          }, {\n            key: \"delete_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME\",\n          permissions: setActivePermissions(milestonePermissions)\n        });\n        userStoryPermissions = [\n          {\n            key: \"view_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES\"\n          }, {\n            key: \"add_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES\"\n          }, {\n            key: \"modify_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES\"\n          }, {\n            key: \"delete_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME\",\n          permissions: setActivePermissions(userStoryPermissions)\n        });\n        taskPermissions = [\n          {\n            key: \"view_tasks\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS\"\n          }, {\n            key: \"add_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS\"\n          }, {\n            key: \"modify_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS\"\n          }, {\n            key: \"delete_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME\",\n          permissions: setActivePermissions(taskPermissions)\n        });\n        issuePermissions = [\n          {\n            key: \"view_issues\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES\"\n          }, {\n            key: \"add_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES\"\n          }, {\n            key: \"modify_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES\"\n          }, {\n            key: \"delete_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME\",\n          permissions: setActivePermissions(issuePermissions)\n        });\n        wikiPermissions = [\n          {\n            key: \"view_wiki_pages\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES\"\n          }, {\n            key: \"add_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES\"\n          }, {\n            key: \"modify_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES\"\n          }, {\n            key: \"delete_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES\"\n          }, {\n            key: \"view_wiki_links\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS\"\n          }, {\n            key: \"add_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS\"\n          }, {\n            key: \"delete_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME\",\n          permissions: setActivePermissions(wikiPermissions)\n        });\n        return setActivePermissionsPerCategory(categories);\n      };\n      renderResume = function(element, category) {\n        return element.find(\".resume\").html($compile(resumeTemplate({\n          category: category\n        }))($scope));\n      };\n      renderCategory = function(category, index) {\n        var html;\n        html = categoryTemplate({\n          category: category,\n          index: index\n        });\n        html = angular.element(html);\n        renderResume(html, category);\n        return $compile(html)($scope);\n      };\n      renderPermissions = function() {\n        var html;\n        $el.off();\n        html = baseTemplate();\n        _.each(generateCategoriesFromRole($scope.role), function(category, index) {\n          return html = angular.element(html).append(renderCategory(category, index));\n        });\n        $el.html(html);\n        $el.on(\"click\", \".resume\", function(event) {\n          var target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          return target.next().toggleClass(\"open\");\n        });\n        return $el.on(\"change\", \".category-item input\", function(event) {\n          var getActivePermissions, onError, onSuccess, target;\n          getActivePermissions = function() {\n            var activePermissions;\n            activePermissions = _.filter($el.find(\".category-item input\"), function(t) {\n              return angular.element(t).is(\":checked\");\n            });\n            activePermissions = _.sortBy(_.map(activePermissions, function(t) {\n              var permission;\n              return permission = angular.element(t).parents(\".category-item\").data(\"id\");\n            }));\n            if (activePermissions.length) {\n              activePermissions.push(\"view_project\");\n            }\n            return activePermissions;\n          };\n          target = angular.element(event.currentTarget);\n          $scope.role.permissions = getActivePermissions();\n          onSuccess = function() {\n            var categories, categoryId;\n            categories = generateCategoriesFromRole($scope.role);\n            categoryId = target.parents(\".category-config\").data(\"id\");\n            renderResume(target.parents(\".category-config\"), categories[categoryId]);\n            $rootscope.$broadcast(\"projects:reload\");\n            $confirm.notify(\"success\");\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            target.prop(\"checked\", !target.prop(\"checked\"));\n            return $scope.role.permissions = getActivePermissions();\n          };\n          if ($scope.role.external_user) {\n            $scope.project.public_permissions = $scope.role.permissions;\n            $scope.project.anon_permissions = $scope.role.permissions.filter(function(permission) {\n              return permission.indexOf(\"view_\") === 0;\n            });\n            return $repo.save($scope.project).then(onSuccess, onError);\n          } else {\n            return $repo.save($scope.role).then(onSuccess, onError);\n          }\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $scope.$on(\"role:changed\", function() {\n        return renderPermissions();\n      });\n      return bindOnce($scope, $attrs.ngModel, renderPermissions);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRolePermissions\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", RolePermissionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/third-parties.coffee\n */\n\n(function() {\n  var BitbucketController, BitbucketWebhooksDirective, GithubController, GithubWebhooksDirective, GitlabController, GitlabWebhooksDirective, NewWebhookDirective, SelectInputText, ValidOriginIpsDirective, WebhookDirective, WebhooksController, bindMethods, debounce, mixOf, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  debounce = this.taiga.debounce;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaAdmin\");\n\n  WebhooksController = (function(superClass) {\n    extend(WebhooksController, superClass);\n\n    WebhooksController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function WebhooksController(scope, repo, rs, params, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.WEBHOOKS.SECTION_NAME\";\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.WEBHOOKS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"webhooks:reload\", this.loadWebhooks);\n    }\n\n    WebhooksController.prototype.loadWebhooks = function() {\n      return this.rs.webhooks.list(this.scope.projectId).then((function(_this) {\n        return function(webhooks) {\n          return _this.scope.webhooks = webhooks;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_owner) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadWebhooks();\n        };\n      })(this));\n      return promise;\n    };\n\n    return WebhooksController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"WebhooksController\", WebhooksController);\n\n  WebhookDirective = function($rs, $repo, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var cancel, openHistory, save, showEditMode, showVisualizationMode, updateLogs, updateShowHideHistoryText, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      updateLogs = function() {\n        var prettyDate;\n        prettyDate = $translate.instant(\"ADMIN.WEBHOOKS.DATE\");\n        return $rs.webhooklogs.list(webhook.id).then((function(_this) {\n          return function(webhooklogs) {\n            var i, len, log, ref;\n            for (i = 0, len = webhooklogs.length; i < len; i++) {\n              log = webhooklogs[i];\n              log.validStatus = (200 <= (ref = log.status) && ref < 300);\n              log.prettySentHeaders = _.map(_.pairs(log.request_headers), function(arg) {\n                var header, value;\n                header = arg[0], value = arg[1];\n                return header + \": \" + value;\n              }).join(\"\\n\");\n              log.prettySentData = JSON.stringify(log.request_data);\n              log.prettyDate = moment(log.created).format(prettyDate);\n            }\n            webhook.logs_counter = webhooklogs.length;\n            webhook.logs = webhooklogs;\n            return updateShowHideHistoryText();\n          };\n        })(this));\n      };\n      updateShowHideHistoryText = function() {\n        var historyElement, text, textElement, title;\n        textElement = $el.find(\".toggle-history\");\n        historyElement = textElement.parents(\".single-webhook-wrapper\").find(\".webhooks-history\");\n        if (historyElement.hasClass(\"open\")) {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE\");\n        } else {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE\");\n        }\n        textElement.text(text);\n        return textElement.prop(\"title\", title);\n      };\n      showVisualizationMode = function() {\n        $el.find(\".edition-mode\").addClass(\"hidden\");\n        return $el.find(\".visualization-mode\").removeClass(\"hidden\");\n      };\n      showEditMode = function() {\n        $el.find(\".visualization-mode\").addClass(\"hidden\");\n        return $el.find(\".edition-mode\").removeClass(\"hidden\");\n      };\n      openHistory = function() {\n        return $el.find(\".webhooks-history\").addClass(\"open\");\n      };\n      cancel = function() {\n        showVisualizationMode();\n        return $scope.$apply(function() {\n          return webhook.revert();\n        });\n      };\n      save = debounce(2000, function(target) {\n        var form, promise;\n        form = target.parents(\"form\").checksley();\n        if (!form.validate()) {\n          return;\n        }\n        promise = $repo.save(webhook);\n        promise.then((function(_this) {\n          return function() {\n            return showVisualizationMode();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      $el.on(\"click\", \".test-webhook\", function() {\n        openHistory();\n        return $rs.webhooks.test(webhook.id).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".edit-webhook\", function() {\n        return showEditMode();\n      });\n      $el.on(\"click\", \".cancel-existing\", function() {\n        return cancel();\n      });\n      $el.on(\"click\", \".edit-existing\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      });\n      $el.on(\"keyup\", \".edition-mode input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return save(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".delete-webhook\", function() {\n        var message, title;\n        title = $translate.instant(\"ADMIN.WEBHOOKS.DELETE\");\n        message = $translate.instant(\"ADMIN.WEBHOOKS.WEBHOOK_NAME\", {\n          name: webhook.name\n        });\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSucces;\n            onSucces = function() {\n              askResponse.finish();\n              return $scope.$emit(\"webhooks:reload\");\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove(webhook).then(onSucces, onError);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".toggle-history\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if ((webhook.logs == null) || webhook.logs.length === 0) {\n          return updateLogs().then(function() {\n            return timeout(0, function() {\n              $el.find(\".webhooks-history\").toggleClass(\"open\");\n              return updateShowHideHistoryText();\n            });\n          });\n        } else {\n          $el.find(\".webhooks-history\").toggleClass(\"open\");\n          return $scope.$apply(function() {\n            return updateShowHideHistoryText();\n          });\n        }\n      });\n      $el.on(\"click\", \".history-single\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"history-single-open\");\n        return target.siblings(\".history-single-response\").toggleClass(\"open\");\n      });\n      return $el.on(\"click\", \".resend-request\", function(event) {\n        var log, target;\n        target = angular.element(event.currentTarget);\n        log = target.data(\"log\");\n        return $rs.webhooklogs.resend(log).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", WebhookDirective]);\n\n  NewWebhookDirective = function($rs, $repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var addWebhookDOMNode, formDOMNode, initializeNewValue, save, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      formDOMNode = $el.find(\".new-webhook-form\");\n      addWebhookDOMNode = $el.find(\".add-webhook\");\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"url\": \"\",\n          \"key\": \"\"\n        };\n      };\n      initializeNewValue();\n      $scope.$watch(\"webhooks\", function(webhooks) {\n        if (webhooks != null) {\n          if (webhooks.length === 0) {\n            formDOMNode.removeClass(\"hidden\");\n            addWebhookDOMNode.addClass(\"hidden\");\n            return formDOMNode.find(\"input\")[0].focus();\n          } else {\n            formDOMNode.addClass(\"hidden\");\n            return addWebhookDOMNode.removeClass(\"hidden\");\n          }\n        }\n      });\n      save = debounce(2000, function() {\n        var form, promise;\n        form = formDOMNode.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        promise = $repo.create(\"webhooks\", $scope.newValue);\n        promise.then((function(_this) {\n          return function() {\n            $scope.$emit(\"webhooks:reload\");\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      formDOMNode.on(\"click\", \".add-new\", function(event) {\n        event.preventDefault();\n        return save();\n      });\n      formDOMNode.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return save();\n        }\n      });\n      formDOMNode.on(\"click\", \".cancel-new\", function(event) {\n        return $scope.$apply(function() {\n          return initializeNewValue();\n        });\n      });\n      return addWebhookDOMNode.on(\"click\", function(event) {\n        formDOMNode.removeClass(\"hidden\");\n        return formDOMNode.find(\"input\")[0].focus();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", NewWebhookDirective]);\n\n  GithubController = (function(superClass) {\n    extend(GithubController, superClass);\n\n    GithubController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GithubController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITHUB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITHUB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GithubController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"github\").then((function(_this) {\n        return function(github) {\n          return _this.scope.github = github;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GithubController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GithubController\", GithubController);\n\n  GitlabController = (function(superClass) {\n    extend(GitlabController, superClass);\n\n    GitlabController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GitlabController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITLAB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITLAB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    GitlabController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gitlab\").then((function(_this) {\n        return function(gitlab) {\n          return _this.scope.gitlab = gitlab;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GitlabController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GitlabController\", GitlabController);\n\n  BitbucketController = (function(superClass) {\n    extend(BitbucketController, superClass);\n\n    BitbucketController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function BitbucketController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.BITBUCKET.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.BITBUCKET.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    BitbucketController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"bitbucket\").then((function(_this) {\n        return function(bitbucket) {\n          return _this.scope.bitbucket = bitbucket;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return BitbucketController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BitbucketController\", BitbucketController);\n\n  SelectInputText = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".select-input-content\", function() {\n        $el.find(\"input\").select();\n        return $el.find(\".help-copy\").addClass(\"visible\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSelectInputText\", SelectInputText);\n\n  GithubWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.github, \"github\");\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGithubWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GithubWebhooksDirective]);\n\n  GitlabWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gitlab, \"gitlab\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGitlabWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GitlabWebhooksDirective]);\n\n  BitbucketWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.bitbucket, \"bitbucket\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBitbucketWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", BitbucketWebhooksDirective]);\n\n  ValidOriginIpsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $ngModel) {\n      return $ngModel.$parsers.push(function(value) {\n        value = $.trim(value);\n        if (value === \"\") {\n          return [];\n        }\n        return value.split(\",\");\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgValidOriginIps\", ValidOriginIpsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var CreateProject, DeleteProjectDirective, bindOnce, debounce, module, taiga, timeout;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaProject\");\n\n  CreateProject = function($rootscope, $repo, $confirm, $location, $navurls, $rs, $projectUrl, $loading, lightboxService, $cacheFactory, $translate, currentUserService) {\n    var directive, link;\n    link = function($scope, $el, attrs) {\n      var currentLoading, form, onErrorSubmit, onSuccessSubmit, openLightbox, submit, submitButton;\n      $scope.data = {};\n      $scope.templates = [];\n      currentLoading = null;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      onSuccessSubmit = function(response) {\n        $cacheFactory.get('$http').removeAll();\n        currentLoading.finish();\n        $rootscope.$broadcast(\"projects:reload\");\n        $confirm.notify(\"success\", $translate.instant(\"COMMON.SAVE\"));\n        $location.url($projectUrl.get(response));\n        lightboxService.close($el);\n        return currentUserService.loadProjects();\n      };\n      onErrorSubmit = function(response) {\n        var error_field, error_step, i, len, ref, selectors;\n        currentLoading.finish();\n        form.setErrors(response);\n        selectors = [];\n        ref = _.keys(response);\n        for (i = 0, len = ref.length; i < len; i++) {\n          error_field = ref[i];\n          selectors.push(\"[name=\" + error_field + \"]\");\n        }\n        $el.find(\".active\").removeClass(\"active\");\n        error_step = $el.find(selectors.join(\",\")).first().parents(\".wizard-step\");\n        error_step.addClass(\"active\");\n        return $el.find('.progress-bar').removeClass().addClass('progress-bar').addClass(error_step.data(\"step\"));\n      };\n      submit = (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"projects\", $scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this);\n      openLightbox = function() {\n        $scope.data = {};\n        if (!$scope.templates.length) {\n          $rs.projects.templates().then((function(_this) {\n            return function(result) {\n              $scope.templates = result;\n              return $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n                return x.slug === \"scrum\";\n              })).id;\n            };\n          })(this));\n        } else {\n          $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n            return x.slug === \"scrum\";\n          })).id;\n        }\n        $el.find(\".active\").removeClass(\"active\");\n        $el.find(\".create-step1\").addClass(\"active\");\n        lightboxService.open($el);\n        return timeout(600, function() {\n          return $el.find(\".progress-bar\").addClass('step1');\n        });\n      };\n      $el.on(\"click\", \".button-next\", function(event) {\n        var current, field, i, len, next, ref, step, valid;\n        event.preventDefault();\n        current = $el.find(\".active\");\n        valid = true;\n        ref = form.fields;\n        for (i = 0, len = ref.length; i < len; i++) {\n          field = ref[i];\n          if (current.find(\"[name=\" + (field.element.attr('name')) + \"]\").length) {\n            valid = field.validate() !== false && valid;\n          }\n        }\n        if (!valid) {\n          return;\n        }\n        next = current.next();\n        current.toggleClass('active');\n        next.toggleClass('active');\n        step = next.data('step');\n        return $el.find('.progress-bar').removeClass().addClass('progress-bar').addClass(step);\n      });\n      $el.on(\"click\", \".button-prev\", function(event) {\n        var current, prev, step;\n        event.preventDefault();\n        current = $el.find(\".active\");\n        prev = current.prev();\n        current.toggleClass('active');\n        prev.toggleClass('active');\n        step = prev.data('step');\n        return $el.find('.progress-bar').removeClass().addClass('progress-bar').addClass(step);\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"project/wizard-create-project.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbCreateProject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$tgResources\", \"$projectUrl\", \"$tgLoading\", \"lightboxService\", \"$cacheFactory\", \"$translate\", \"tgCurrentUserService\", CreateProject]);\n\n  DeleteProjectDirective = function($repo, $rootscope, $auth, $location, $navUrls, $confirm, lightboxService, tgLoader, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var projectToDelete, submit;\n      projectToDelete = null;\n      $scope.$on(\"deletelightbox:new\", function(ctx, project) {\n        lightboxService.open($el);\n        return projectToDelete = project;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        tgLoader.start();\n        lightboxService.close($el);\n        promise = $repo.remove(projectToDelete);\n        promise.then(function(data) {\n          tgLoader.pageLoaded();\n          $rootscope.$broadcast(\"projects:reload\");\n          $location.path($navUrls.resolve(\"home\"));\n          $confirm.notify(\"success\");\n          return currentUserService.loadProjects();\n        });\n        return promise.then(null, function() {\n          $confirm.notify(\"error\");\n          return lightboxService.close($el);\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDeleteProject\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfirm\", \"lightboxService\", \"tgLoader\", \"tgCurrentUserService\", DeleteProjectDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/bind.coffee\n */\n\n(function() {\n  var BindHtmlDirective, BindOnceAltDirective, BindOnceBindDirective, BindOnceHrefDirective, BindOnceHtmlDirective, BindOnceRefDirective, BindOnceSrcDirective, BindOnceTitleDirective, BindTitleDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  BindOnceBindDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoBind, function(val) {\n        return $el.text(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHtml, function(val) {\n        return $el.html(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceRefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoRef, function(val) {\n        return $el.html(\"#\" + val + \" \");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceSrcDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoSrc, function(val) {\n        return $el.attr(\"src\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHrefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHref, function(val) {\n        return $el.attr(\"href\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceAltDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoAlt, function(val) {\n        return $el.attr(\"alt\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoTitle, function(val) {\n        return $el.attr(\"title\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgTitleHtml, function(val) {\n        if (val != null) {\n          return $el.attr(\"title\", val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgBindHtml, function(val) {\n        if (val != null) {\n          return $el.html(val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.directive(\"tgBoBind\", BindOnceBindDirective);\n\n  module.directive(\"tgBoHtml\", BindOnceHtmlDirective);\n\n  module.directive(\"tgBoRef\", BindOnceRefDirective);\n\n  module.directive(\"tgBoSrc\", BindOnceSrcDirective);\n\n  module.directive(\"tgBoHref\", BindOnceHrefDirective);\n\n  module.directive(\"tgBoAlt\", BindOnceAltDirective);\n\n  module.directive(\"tgBoTitle\", BindOnceTitleDirective);\n\n  module.directive(\"tgBindTitle\", BindTitleDirective);\n\n  module.directive(\"tgBindHtml\", BindHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/conf.coffee\n */\n\n(function() {\n  var ConfigurationService, module;\n\n  ConfigurationService = (function() {\n    function ConfigurationService() {\n      this.config = window.taigaConfig;\n    }\n\n    ConfigurationService.prototype.get = function(key, defaultValue) {\n      if (defaultValue == null) {\n        defaultValue = null;\n      }\n      if (_.has(this.config, key)) {\n        return this.config[key];\n      }\n      return defaultValue;\n    };\n\n    return ConfigurationService;\n\n  })();\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgConfig\", ConfigurationService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/contrib.coffee\n */\n\n(function() {\n  var ContribController, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaBase\");\n\n  ContribController = (function(superClass) {\n    extend(ContribController, superClass);\n\n    ContribController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\"];\n\n    function ContribController(rootScope, scope, params, repo, rs, confirm) {\n      var promise;\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.scope.currentPlugin = _.first(_.where(this.rootScope.adminPlugins, {\n        \"slug\": this.params.plugin\n      }));\n      this.scope.projectSlug = this.params.pslug;\n      promise = this.loadInitialData();\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    }\n\n    ContribController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.$broadcast('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ContribController.prototype.loadInitialData = function() {\n      return this.loadProject();\n    };\n\n    return ContribController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribController\", ContribController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/filters.coffee\n */\n\n(function() {\n  var FiltersStorageService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  FiltersStorageService = (function(superClass) {\n    extend(FiltersStorageService, superClass);\n\n    FiltersStorageService.$inject = [\"$tgStorage\", \"$routeParams\"];\n\n    function FiltersStorageService(storage, params) {\n      this.storage = storage;\n      this.params = params;\n    }\n\n    FiltersStorageService.prototype.generateHash = function(components) {\n      if (components == null) {\n        components = [];\n      }\n      components = _.map(components, function(x) {\n        return JSON.stringify(x);\n      });\n      return hex_sha1(components.join(\":\"));\n    };\n\n    return FiltersStorageService;\n\n  })(taiga.Service);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var HttpService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  HttpService = (function(superClass) {\n    extend(HttpService, superClass);\n\n    HttpService.$inject = [\"$http\", \"$q\", \"$tgStorage\", \"$rootScope\", \"$cacheFactory\", \"$translate\"];\n\n    function HttpService(http, q, storage, rootScope, cacheFactory, translate) {\n      this.http = http;\n      this.q = q;\n      this.storage = storage;\n      this.rootScope = rootScope;\n      this.cacheFactory = cacheFactory;\n      this.translate = translate;\n      HttpService.__super__.constructor.call(this);\n      this.cache = this.cacheFactory(\"httpget\");\n    }\n\n    HttpService.prototype.headers = function() {\n      var headers, lang, token;\n      headers = {};\n      token = this.storage.get('token');\n      if (token) {\n        headers[\"Authorization\"] = \"Bearer \" + token;\n      }\n      lang = this.translate.preferredLanguage();\n      if (lang) {\n        headers[\"Accept-Language\"] = lang;\n      }\n      return headers;\n    };\n\n    HttpService.prototype.request = function(options) {\n      options.headers = _.merge({}, options.headers || {}, this.headers());\n      return this.http(options);\n    };\n\n    HttpService.prototype.get = function(url, params, options) {\n      options = _.merge({\n        method: \"GET\",\n        url: url\n      }, options);\n      if (params) {\n        options.params = params;\n      }\n      options.cache = this.cache;\n      return this.request(options)[\"finally\"]((function(_this) {\n        return function(data) {\n          return _this.cache.removeAll();\n        };\n      })(this));\n    };\n\n    HttpService.prototype.post = function(url, data, params, options) {\n      options = _.merge({\n        method: \"POST\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.put = function(url, data, params, options) {\n      options = _.merge({\n        method: \"PUT\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.patch = function(url, data, params, options) {\n      options = _.merge({\n        method: \"PATCH\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype[\"delete\"] = function(url, data, params, options) {\n      options = _.merge({\n        method: \"DELETE\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    return HttpService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgHttp\", HttpService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/location.coffee\n */\n\n(function() {\n  var locationFactory, module;\n\n  locationFactory = function($location, $route, $rootscope) {\n    $location.noreload = function(scope) {\n      var lastRoute, un;\n      lastRoute = $route.current;\n      un = scope.$on(\"$locationChangeSuccess\", function() {\n        $route.current = lastRoute;\n        return un();\n      });\n      return $location;\n    };\n    $location.isInCurrentRouteParams = function(name, value) {\n      var params;\n      params = $location.search() || {};\n      return params[name] === value;\n    };\n    return $location;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgLocation\", [\"$location\", \"$route\", \"$rootScope\", locationFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/model.coffee\n */\n\n(function() {\n  var Model, ModelService, module, provider, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    function Model(name, data, dataTypes) {\n      this._attrs = data;\n      this._name = name;\n      this._dataTypes = dataTypes;\n      this.setAttrs(data);\n      this.initialize();\n    }\n\n    Model.prototype.clone = function() {\n      var instance;\n      instance = new Model(this._name, this._attrs, this._dataTypes);\n      instance._modifiedAttrs = this._modifiedAttrs;\n      instance._isModified = this._isModified;\n      return instance;\n    };\n\n    Model.prototype.applyCasts = function() {\n      var attrName, castMethod, castName, ref, results;\n      ref = this._dataTypes;\n      results = [];\n      for (attrName in ref) {\n        castName = ref[attrName];\n        castMethod = service.casts[castName];\n        if (!castMethod) {\n          continue;\n        }\n        results.push(this._attrs[attrName] = castMethod(this._attrs[attrName]));\n      }\n      return results;\n    };\n\n    Model.prototype.getIdAttrName = function() {\n      return \"id\";\n    };\n\n    Model.prototype.getName = function() {\n      return this._name;\n    };\n\n    Model.prototype.getAttrs = function(patch) {\n      if (patch == null) {\n        patch = false;\n      }\n      if (this._attrs.version != null) {\n        this._modifiedAttrs.version = this._attrs.version;\n      }\n      if (patch) {\n        return _.extend({}, this._modifiedAttrs);\n      }\n      return _.extend({}, this._attrs, this._modifiedAttrs);\n    };\n\n    Model.prototype.setAttrs = function(attrs) {\n      this._attrs = attrs;\n      this._modifiedAttrs = {};\n      this.applyCasts();\n      return this._isModified = false;\n    };\n\n    Model.prototype.setAttr = function(name, value) {\n      this._modifiedAttrs[name] = value;\n      return this._isModified = true;\n    };\n\n    Model.prototype.initialize = function() {\n      var getter, self, setter;\n      self = this;\n      getter = function(name) {\n        return function() {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            return self[name];\n          }\n          if (indexOf.call(_.keys(self._modifiedAttrs), name) < 0) {\n            return self._attrs[name];\n          }\n          return self._modifiedAttrs[name];\n        };\n      };\n      setter = function(name) {\n        return function(value) {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            self[name] = value;\n            return;\n          }\n          if (self._attrs[name] !== value) {\n            self._modifiedAttrs[name] = value;\n            self._isModified = true;\n          } else {\n            delete self._modifiedAttrs[name];\n          }\n        };\n      };\n      return _.each(this._attrs, function(value, name) {\n        var options;\n        options = {\n          get: getter(name),\n          set: setter(name),\n          enumerable: true,\n          configurable: true\n        };\n        return Object.defineProperty(self, name, options);\n      });\n    };\n\n    Model.prototype.serialize = function() {\n      var data;\n      data = {\n        \"data\": _.clone(this._attrs),\n        \"name\": this._name\n      };\n      return JSON.stringify(data);\n    };\n\n    Model.prototype.isModified = function() {\n      return this._isModified;\n    };\n\n    Model.prototype.isAttributeModified = function(attribute) {\n      return this._modifiedAttrs[attribute] != null;\n    };\n\n    Model.prototype.markSaved = function() {\n      this._isModified = false;\n      this._attrs = this.getAttrs();\n      return this._modifiedAttrs = {};\n    };\n\n    Model.prototype.revert = function() {\n      this._modifiedAttrs = {};\n      return this._isModified = false;\n    };\n\n    Model.desSerialize = function(sdata) {\n      var ddata, model;\n      ddata = JSON.parse(sdata);\n      model = new Model(ddata.url, ddata.data);\n      return model;\n    };\n\n    return Model;\n\n  })();\n\n  taiga = this.taiga;\n\n  ModelService = (function(superClass) {\n    extend(ModelService, superClass);\n\n    ModelService.$inject = [\"$q\", \"$tgUrls\", \"$tgStorage\", \"$tgHttp\"];\n\n    function ModelService(q, urls, storage, http) {\n      this.q = q;\n      this.urls = urls;\n      this.storage = storage;\n      this.http = http;\n      ModelService.__super__.constructor.call(this);\n    }\n\n    return ModelService;\n\n  })(taiga.Service);\n\n  provider = function($q, $http, $gmUrls, $gmStorage) {\n    var service;\n    service = {};\n    service.make_model = function(name, data, cls, dataTypes) {\n      if (cls == null) {\n        cls = Model;\n      }\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      return new cls(name, data, dataTypes);\n    };\n    service.cls = Model;\n    service.casts = {\n      int: function(value) {\n        return parseInt(value, 10);\n      },\n      float: function(value) {\n        return parseFloat(value, 10);\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgModel\", [\"$q\", \"$http\", \"$tgUrls\", \"$tgStorage\", provider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/navurl.coffee\n */\n\n(function() {\n  var NavigationUrlsDirective, NavigationUrlsService, bindOnce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\");\n\n  NavigationUrlsService = (function(superClass) {\n    extend(NavigationUrlsService, superClass);\n\n    function NavigationUrlsService() {\n      this.urls = {};\n    }\n\n    NavigationUrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge({}, this.urls, urls || {});\n    };\n\n    NavigationUrlsService.prototype.formatUrl = function(url, ctx) {\n      var replacer;\n      if (ctx == null) {\n        ctx = {};\n      }\n      replacer = function(match) {\n        match = trim(match, \":\");\n        return ctx[match] || \"undefined\";\n      };\n      return url.replace(/(:\\w+)/g, replacer);\n    };\n\n    NavigationUrlsService.prototype.resolve = function(name, ctx) {\n      var url;\n      url = this.urls[name];\n      if (!url) {\n        return \"\";\n      }\n      if (ctx) {\n        return this.formatUrl(url, ctx);\n      }\n      return url;\n    };\n\n    return NavigationUrlsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgNavUrls\", NavigationUrlsService);\n\n  NavigationUrlsDirective = function($navurls, $auth, $q, $location) {\n    var bindOnceP, link, parseNav;\n    bindOnceP = function($scope, attr) {\n      var defered;\n      defered = $q.defer();\n      bindOnce($scope, attr, function(v) {\n        return defered.resolve(v);\n      });\n      return defered.promise;\n    };\n    parseNav = function(data, $scope) {\n      var index, name, obj, params, promises, ref, result, values;\n      ref = _.map(data.split(\":\"), trim), name = ref[0], params = ref[1];\n      if (params) {\n        result = params.split(/(\\w+)=/);\n        result = _.filter(result, function(str) {\n          return str.length;\n        });\n        result = _.map(result, function(str) {\n          return trim(str.replace(/,$/g, ''));\n        });\n        params = [];\n        index = 0;\n        while (index < result.length) {\n          obj = {};\n          obj[result[index]] = result[index + 1];\n          params.push(obj);\n          index = index + 2;\n        }\n      } else {\n        params = [];\n      }\n      values = _.map(params, function(param) {\n        return _.values(param)[0];\n      });\n      promises = _.map(values, function(x) {\n        return bindOnceP($scope, x);\n      });\n      return $q.all(promises).then(function() {\n        var i, key, len, options, param, value;\n        options = {};\n        for (i = 0, len = params.length; i < len; i++) {\n          param = params[i];\n          key = Object.keys(param)[0];\n          value = param[key];\n          options[key] = $scope.$eval(value);\n        }\n        return [name, options];\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      if ($el.is(\"a\")) {\n        $el.attr(\"href\", \"#\");\n      }\n      $el.on(\"mouseenter\", function(event) {\n        var target;\n        target = $(event.currentTarget);\n        if (!target.data(\"fullUrl\") || $attrs.tgNavGetParams !== target.data(\"params\")) {\n          return parseNav($attrs.tgNav, $scope).then(function(result) {\n            var fullUrl, getURLParams, getURLParamsStr, name, options, url, user;\n            name = result[0], options = result[1];\n            user = $auth.getUser();\n            if (user) {\n              options.user = user.username;\n            }\n            url = $navurls.resolve(name);\n            fullUrl = $navurls.formatUrl(url, options);\n            if ($attrs.tgNavGetParams) {\n              getURLParams = JSON.parse($attrs.tgNavGetParams);\n              getURLParamsStr = $.param(getURLParams);\n              fullUrl = fullUrl + \"?\" + getURLParamsStr;\n              target.data(\"params\", $attrs.tgNavGetParams);\n            }\n            target.data(\"fullUrl\", fullUrl);\n            if (target.is(\"a\")) {\n              target.attr(\"href\", fullUrl);\n            }\n            return $el.on(\"click\", function(event) {\n              if (event.metaKey || event.ctrlKey) {\n                return;\n              }\n              event.preventDefault();\n              target = $(event.currentTarget);\n              if (target.hasClass('noclick')) {\n                return;\n              }\n              fullUrl = target.data(\"fullUrl\");\n              switch (event.which) {\n                case 1:\n                  $location.url(fullUrl);\n                  return $scope.$apply();\n                case 2:\n                  return window.open(fullUrl);\n              }\n            });\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNav\", [\"$tgNavUrls\", \"$tgAuth\", \"$q\", \"$tgLocation\", NavigationUrlsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/repository.coffee\n */\n\n(function() {\n  var RepositoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  RepositoryService = (function(superClass) {\n    extend(RepositoryService, superClass);\n\n    RepositoryService.$inject = [\"$q\", \"$tgModel\", \"$tgStorage\", \"$tgHttp\", \"$tgUrls\"];\n\n    function RepositoryService(q, model1, storage, http, urls) {\n      this.q = q;\n      this.model = model1;\n      this.storage = storage;\n      this.http = http;\n      this.urls = urls;\n      RepositoryService.__super__.constructor.call(this);\n    }\n\n    RepositoryService.prototype.resolveUrlForModel = function(model) {\n      var idAttrName;\n      idAttrName = model.getIdAttrName();\n      return (this.urls.resolve(model.getName())) + \"/\" + model[idAttrName];\n    };\n\n    RepositoryService.prototype.resolveUrlForAttributeModel = function(model) {\n      return this.urls.resolve(model.getName(), model.parent);\n    };\n\n    RepositoryService.prototype.create = function(name, data, dataTypes, extraParams) {\n      var defered, promise, url;\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      defered = this.q.defer();\n      url = this.urls.resolve(name);\n      promise = this.http.post(url, JSON.stringify(data));\n      promise.success((function(_this) {\n        return function(_data, _status) {\n          return defered.resolve(_this.model.make_model(name, _data, null, dataTypes));\n        };\n      })(this));\n      promise.error((function(_this) {\n        return function(data, status) {\n          return defered.reject(data);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.remove = function(model, params) {\n      var defered, promise, url;\n      if (params == null) {\n        params = {};\n      }\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http[\"delete\"](url, {}, params);\n      promise.success(function(data, status) {\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(model);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAll = function(models, patch) {\n      var promises;\n      if (patch == null) {\n        patch = true;\n      }\n      promises = _.map(models, (function(_this) {\n        return function(x) {\n          return _this.save(x, true);\n        };\n      })(this));\n      return this.q.all(promises);\n    };\n\n    RepositoryService.prototype.save = function(model, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForModel(model);\n      data = JSON.stringify(model.getAttrs(patch));\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAttribute = function(model, attribute, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForAttributeModel(model);\n      data = {};\n      data[attribute] = model.getAttrs();\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.refresh = function(model) {\n      var defered, promise, url;\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http.get(url);\n      promise.success(function(data, status) {\n        model._modifiedAttrs = {};\n        model._attrs = data;\n        model._isModified = false;\n        model.applyCasts();\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.queryMany = function(name, params, options, headers) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      if (headers == null) {\n        headers = false;\n      }\n      url = this.urls.resolve(name);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var result;\n          result = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          if (headers) {\n            return [result, data.headers];\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneAttribute = function(name, id, attribute, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name, id);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var model;\n          model = _this.model.make_model(name, data.data[attribute]);\n          model.parent = id;\n          return model;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOne = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return _this.model.make_model(name, data.data);\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryPaginated = function(name, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.models = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOnePaginatedRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.data = data.data;\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.resolve = function(options) {\n      var cache, params;\n      params = {};\n      if (options.pslug != null) {\n        params.project = options.pslug;\n      }\n      if (options.usref != null) {\n        params.us = options.usref;\n      }\n      if (options.taskref != null) {\n        params.task = options.taskref;\n      }\n      if (options.issueref != null) {\n        params.issue = options.issueref;\n      }\n      if (options.sslug != null) {\n        params.milestone = options.sslug;\n      }\n      if (options.wikipage != null) {\n        params.wikipage = options.wikipage;\n      }\n      cache = !(options.wikipage || options.sslug);\n      return this.queryOneRaw(\"resolver\", null, params, {\n        cache: cache\n      });\n    };\n\n    return RepositoryService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgRepo\", RepositoryService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/storage.coffee\n */\n\n(function() {\n  var StorageService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  StorageService = (function(superClass) {\n    extend(StorageService, superClass);\n\n    StorageService.$inject = [\"$rootScope\"];\n\n    function StorageService($rootScope) {\n      StorageService.__super__.constructor.call(this);\n    }\n\n    StorageService.prototype.get = function(key, _default) {\n      var serializedValue;\n      serializedValue = localStorage.getItem(key);\n      if (serializedValue === null) {\n        return _default || null;\n      }\n      return JSON.parse(serializedValue);\n    };\n\n    StorageService.prototype.set = function(key, val) {\n      if (_.isObject(key)) {\n        return _.each(key, (function(_this) {\n          return function(val, key) {\n            return _this.set(key, val);\n          };\n        })(this));\n      } else {\n        return localStorage.setItem(key, JSON.stringify(val));\n      }\n    };\n\n    StorageService.prototype.contains = function(key) {\n      var value;\n      value = this.get(key);\n      return value !== null;\n    };\n\n    StorageService.prototype.remove = function(key) {\n      return localStorage.removeItem(key);\n    };\n\n    StorageService.prototype.clear = function() {\n      return localStorage.clear();\n    };\n\n    return StorageService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgStorage\", StorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var UrlsService, format, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  format = function(fmt, obj) {\n    obj = _.clone(obj);\n    return fmt.replace(/%s/g, function(match) {\n      return String(obj.shift());\n    });\n  };\n\n  taiga = this.taiga;\n\n  UrlsService = (function(superClass) {\n    extend(UrlsService, superClass);\n\n    UrlsService.$inject = [\"$tgConfig\"];\n\n    function UrlsService(config) {\n      this.config = config;\n      this.urls = {};\n      this.mainUrl = this.config.get(\"api\");\n    }\n\n    UrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge(this.urls, urls);\n    };\n\n    UrlsService.prototype.resolve = function() {\n      var args, name, url;\n      args = _.toArray(arguments);\n      if (args.length === 0) {\n        throw Error(\"wrong arguments to setUrls\");\n      }\n      name = args.slice(0, 1)[0];\n      url = format(this.urls[name], args.slice(1));\n      return format(\"%s/%s\", [_.str.rtrim(this.mainUrl, \"/\"), _.str.ltrim(url, \"/\")]);\n    };\n\n    UrlsService.prototype.resolveAbsolute = function() {\n      var url;\n      url = this.resolve.apply(this, arguments);\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n      if (/^\\//.test(url)) {\n        return window.location.protocol + \"//\" + window.location.host + url;\n      }\n      return window.location.protocol + \"//\" + window.location.host + \"/\" + url;\n    };\n\n    return UrlsService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service('$tgUrls', UrlsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/custom-field-values.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var _get, service;\n    _get = function(objectId, resource) {\n      return $repo.queryOne(resource, objectId);\n    };\n    service = {\n      userstory: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/userstory\");\n        }\n      },\n      task: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/task\");\n        }\n      },\n      issue: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributesValues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesValuesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var _list, service;\n    _list = function(projectId, resource) {\n      return $repo.queryMany(resource, {\n        project: projectId\n      });\n    };\n    service = {\n      userstory: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/userstory\");\n        }\n      },\n      task: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/task\");\n        }\n      },\n      issue: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributes = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/history.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(type, objectId) {\n      return $repo.queryOneRaw(\"history/\" + type, objectId);\n    };\n    service.deleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/delete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.undeleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/undelete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.history = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgHistoryResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.get = function(token) {\n      return $repo.queryOne(\"invitations\", token);\n    };\n    return function(instance) {\n      return instance.invitations = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgInvitationsResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/issues.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var filtersHashSuffix, hashSuffix, myFiltersHashSuffix, service;\n    service = {};\n    hashSuffix = \"issues-queryparams\";\n    filtersHashSuffix = \"issues-filters\";\n    myFiltersHashSuffix = \"issues-my-filters\";\n    service.get = function(projectId, issueId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"issues\", issueId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"issues\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"issues\", filters);\n    };\n    service.list = function(projectId, filters, options) {\n      var params;\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryPaginated(\"issues\", params, options);\n    };\n    service.bulkCreate = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-issues\");\n      params = {\n        project_id: projectId,\n        bulk_issues: data\n      };\n      return $http.post(url, params);\n    };\n    service.upvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-upvote\", issueId);\n      return $http.post(url);\n    };\n    service.downvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-downvote\", issueId);\n      return $http.post(url);\n    };\n    service.watch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-watch\", issueId);\n      return $http.post(url);\n    };\n    service.unwatch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-unwatch\", issueId);\n      return $http.post(url);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/issues_stats\");\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"issues-filters\", null, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeFilters = function(projectSlug, params) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getFilters = function(projectSlug) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeMyFilters = function(projectId, myFilters) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      if (_.isEmpty(myFilters)) {\n        promise = $http[\"delete\"](url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function() {\n          return deferred.resolve();\n        });\n        promise.then(null, function() {\n          return deferred.reject();\n        });\n      } else {\n        promise = $http.put(url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function(data) {\n          return deferred.resolve();\n        });\n        promise.then(null, function(data) {\n          var innerPromise;\n          innerPromise = $http.post(\"\" + url, {\n            key: hash,\n            value: myFilters\n          });\n          innerPromise.then(function() {\n            return deferred.resolve();\n          });\n          return innerPromise.then(null, function() {\n            return deferred.reject();\n          });\n        });\n      }\n      return deferred.promise;\n    };\n    service.getMyFilters = function(projectId) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      promise = $http.get(url + \"/\" + hash);\n      promise.then(function(data) {\n        return deferred.resolve(data.data.value);\n      });\n      promise.then(null, function(data) {\n        return deferred.resolve({});\n      });\n      return deferred.promise;\n    };\n    return function(instance) {\n      return instance.issues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgIssuesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/kanban.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($storage) {\n    var hashSuffixStatusColumnModes, hashSuffixStatusViewModes, service;\n    service = {};\n    hashSuffixStatusViewModes = \"kanban-statusviewmodels\";\n    hashSuffixStatusColumnModes = \"kanban-statuscolumnmodels\";\n    service.storeStatusViewModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusViewModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.kanban = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgKanbanResourcesProvider\", [\"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/locales.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {\n      list: function() {\n        return $repo.queryMany(\"locales\");\n      }\n    };\n    return function(instance) {\n      return instance.locales = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgLocalesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/mdrender.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.render = function(projectId, content) {\n      var params, url;\n      if ((content == null) || content === \"\") {\n        content = ' ';\n      }\n      params = {\n        project_id: projectId,\n        content: content\n      };\n      url = $urls.resolve(\"wiki\");\n      return $http.post(url + \"/render\", params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.mdrender = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMdRenderResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"memberships\", id);\n    };\n    service.list = function(projectId, filters, enablePagination) {\n      var options, params;\n      if (enablePagination == null) {\n        enablePagination = true;\n      }\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      if (enablePagination) {\n        return $repo.queryPaginated(\"memberships\", params);\n      }\n      return $repo.queryMany(\"memberships\", params, options = {\n        enablePagination: enablePagination\n      });\n    };\n    service.listByUser = function(userId, filters) {\n      var params;\n      params = {\n        user: userId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryPaginated(\"memberships\", params);\n    };\n    service.resendInvitation = function(id) {\n      var url;\n      url = $urls.resolve(\"memberships\");\n      return $http.post(url + \"/\" + id + \"/resend_invitation\", {});\n    };\n    service.bulkCreateMemberships = function(projectId, data, invitation_extra_text) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-memberships\");\n      params = {\n        project_id: projectId,\n        bulk_memberships: data,\n        invitation_extra_text: invitation_extra_text\n      };\n      return $http.post(url, params);\n    };\n    return function(instance) {\n      return instance.memberships = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMembershipsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.list = function(projectId, module) {\n      return $repo.queryOneAttribute(\"project-modules\", projectId, module);\n    };\n    return function(instance) {\n      return instance.modules = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgModulesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"notify-policies\", id);\n    };\n    service.list = function(filters) {\n      var params;\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"notify-policies\", params);\n    };\n    return function(instance) {\n      return instance.notifyPolicies = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgNotifyPoliciesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $auth, $q, $translate) {\n    var service;\n    service = {};\n    service.get = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId);\n    };\n    service.getBySlug = function(projectSlug) {\n      return $repo.queryOne(\"projects\", \"by_slug?slug=\" + projectSlug);\n    };\n    service.list = function() {\n      return $repo.queryMany(\"projects\");\n    };\n    service.listByMember = function(memberId) {\n      var params;\n      params = {\n        \"member\": memberId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return $repo.queryMany(\"projects\", params);\n    };\n    service.templates = function() {\n      return $repo.queryMany(\"project-templates\");\n    };\n    service.usersList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"users\", params);\n    };\n    service.rolesList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"roles\", params);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/stats\");\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = $urls.resolve(\"bulk-update-projects-order\");\n      return $http.post(url, bulkData);\n    };\n    service.regenerate_userstories_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_userstories_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_issues_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_issues_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_tasks_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_tasks_csv_uuid\";\n      return $http.post(url);\n    };\n    service.leave = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/leave\";\n      return $http.post(url);\n    };\n    service.memberStats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/member_stats\");\n    };\n    service.tagsColors = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId + \"/tags_colors\");\n    };\n    service[\"export\"] = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"exporter\")) + \"/\" + projectId;\n      return $http.get(url);\n    };\n    service[\"import\"] = function(file, statusUpdater) {\n      var complete, data, defered, errorMsg, failed, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED\", {\n          fileName: file.name,\n          fileSize: sizeFormat(file.size),\n          maxFileSize: sizeFormat(maxFileSize)\n        });\n        response = {\n          status: 413,\n          data: {\n            _error_message: errorMsg\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          var message, percent;\n          percent = Math.round((evt.loaded / evt.total) * 100);\n          message = $translate.instant(\"PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE\", {\n            uploadedSize: sizeFormat(evt.loaded),\n            totalSize: sizeFormat(evt.total)\n          });\n          return statusUpdater(\"in-progress\", null, message, percent);\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"done\", $translate.instant(\"PROJECT.IMPORT.TITLE\"), $translate.instant(\"PROJECT.IMPORT.DESCRIPTION\"));\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"error\");\n        };\n      })(this);\n      complete = (function(_this) {\n        return function(evt) {\n          var error, ref;\n          response = {};\n          try {\n            response.data = JSON.parse(evt.target.responseText);\n          } catch (error) {\n            response.data = {};\n          }\n          response.status = evt.target.status;\n          if ((ref = response.status) === 201 || ref === 202) {\n            defered.resolve(response);\n          }\n          return defered.reject(response);\n        };\n      })(this);\n      failed = (function(_this) {\n        return function(evt) {\n          return defered.reject(\"fail\");\n        };\n      })(this);\n      data = new FormData();\n      data.append('dump', file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.upload.addEventListener(\"load\", uploadComplete, false);\n      xhr.upload.addEventListener(\"error\", uploadFailed, false);\n      xhr.upload.addEventListener(\"abort\", uploadFailed, false);\n      xhr.addEventListener(\"load\", complete, false);\n      xhr.addEventListener(\"error\", failed, false);\n      xhr.open(\"POST\", $urls.resolve(\"importer\"));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    service.changeLogo = function(projectId, file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('logo', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/change_logo\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeLogo = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/remove_logo\";\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.projects = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgProjectsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgAuth\", \"$q\", \"$translate\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"roles\", id);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"roles\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.roles = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgRolesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/search.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http, $q) {\n    var service;\n    service = {};\n    service[\"do\"] = function(projectId, term) {\n      var deferredAbort, params, request, url;\n      deferredAbort = $q.defer();\n      url = $urls.resolve(\"search\");\n      params = {\n        url: url,\n        method: \"GET\",\n        timeout: deferredAbort.promise,\n        cancelable: true,\n        params: {\n          project: projectId,\n          text: term,\n          get_all: false\n        }\n      };\n      request = $http.request(params).then(function(data) {\n        return data.data;\n      });\n      request.abort = function() {\n        return deferredAbort.resolve();\n      };\n      request[\"finally\"] = function() {\n        request.abort = angular.noop;\n        return deferredAbort = request = null;\n      };\n      return request;\n    };\n    return function(instance) {\n      return instance.search = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSearchResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/sprints.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $model, $storage) {\n    var service;\n    service = {};\n    service.get = function(projectId, sprintId) {\n      return $repo.queryOne(\"milestones\", sprintId).then(function(sprint) {\n        var uses;\n        uses = sprint.user_stories;\n        uses = _.map(uses, function(u) {\n          return $model.make_model(\"userstories\", u);\n        });\n        sprint._attrs.user_stories = uses;\n        return sprint;\n      });\n    };\n    service.stats = function(projectId, sprintId) {\n      return $repo.queryOneRaw(\"milestones\", sprintId + \"/stats\");\n    };\n    service.list = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"milestones\", params, {}, true).then((function(_this) {\n        return function(result) {\n          var headers, i, len, m, milestones, uses;\n          milestones = result[0];\n          headers = result[1];\n          for (i = 0, len = milestones.length; i < len; i++) {\n            m = milestones[i];\n            uses = m.user_stories;\n            uses = _.map(uses, function(u) {\n              return $model.make_model(\"userstories\", u);\n            });\n            m._attrs.user_stories = uses;\n          }\n          return {\n            milestones: milestones,\n            closed: parseInt(headers(\"Taiga-Info-Total-Closed-Milestones\"), 10),\n            open: parseInt(headers(\"Taiga-Info-Total-Opened-Milestones\"), 10)\n          };\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.sprints = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSprintsResourcesProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/tasks.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, hashSuffixStatusColumnModes, hashSuffixUsRowModes, service;\n    service = {};\n    hashSuffix = \"tasks-queryparams\";\n    hashSuffixStatusColumnModes = \"tasks-statuscolumnmodels\";\n    hashSuffixUsRowModes = \"tasks-usrowmodels\";\n    service.get = function(projectId, taskId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"tasks\", taskId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"tasks\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"tasks\", filters);\n    };\n    service.list = function(projectId, sprintId, userStoryId) {\n      var params;\n      if (sprintId == null) {\n        sprintId = null;\n      }\n      if (userStoryId == null) {\n        userStoryId = null;\n      }\n      params = {\n        project: projectId\n      };\n      if (sprintId) {\n        params.milestone = sprintId;\n      }\n      if (userStoryId) {\n        params.user_story = userStoryId;\n      }\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"tasks\", params);\n    };\n    service.bulkCreate = function(projectId, sprintId, usId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-tasks\");\n      params = {\n        project_id: projectId,\n        sprint_id: sprintId,\n        us_id: usId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params).then(function(result) {\n        return result.data;\n      });\n    };\n    service.upvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-upvote\", taskId);\n      return $http.post(url);\n    };\n    service.downvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-downvote\", taskId);\n      return $http.post(url);\n    };\n    service.watch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-watch\", taskId);\n      return $http.post(url);\n    };\n    service.unwatch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-unwatch\", taskId);\n      return $http.post(url);\n    };\n    service.bulkUpdateTaskTaskboardOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-task-taskboard-order\");\n      params = {\n        project_id: projectId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeUsRowModes = function(projectId, sprintId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getUsRowModes = function(projectId, sprintId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.tasks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgTasksResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $q) {\n    var service;\n    service = {};\n    service.changeAvatar = function(file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('avatar', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"users\")) + \"/change_avatar\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeAvatar = function() {\n      var url;\n      url = ($urls.resolve(\"users\")) + \"/remove_avatar\";\n      return $http.post(url);\n    };\n    service.changePassword = function(currentPassword, newPassword) {\n      var data, url;\n      url = ($urls.resolve(\"users\")) + \"/change_password\";\n      data = {\n        current_password: currentPassword,\n        password: newPassword\n      };\n      return $http.post(url, data);\n    };\n    return function(instance) {\n      return instance.userSettings = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserSettingsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/user.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($http, $urls) {\n    var service;\n    service = {};\n    service.contacts = function(userId, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = $urls.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return $http.get(url, {}, httpOptions).then(function(result) {\n        return result.data;\n      });\n    };\n    return function(instance) {\n      return instance.users = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUsersResourcesProvider\", [\"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/userstories.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"userstories-queryparams\";\n    service.get = function(projectId, usId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"userstories\", usId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"userstories\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"userstories\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"userstories-filters\", null, params);\n    };\n    service.listUnassigned = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId,\n        \"milestone\": \"null\"\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.listAll = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.bulkCreate = function(projectId, status, bulk) {\n      var data, url;\n      data = {\n        project_id: projectId,\n        status_id: status,\n        bulk_stories: bulk\n      };\n      url = $urls.resolve(\"bulk-create-us\");\n      return $http.post(url, data);\n    };\n    service.upvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-upvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.downvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-downvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.watch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-watch\", userStoryId);\n      return $http.post(url);\n    };\n    service.unwatch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-unwatch\", userStoryId);\n      return $http.post(url);\n    };\n    service.bulkUpdateBacklogOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-backlog-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateSprintOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-sprint-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateKanbanOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-kanban-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeShowTags = function(projectId, showTags) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.set(hash, showTags);\n    };\n    service.getShowTags = function(projectId) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.get(hash) || null;\n    };\n    return function(instance) {\n      return instance.userstories = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserstoriesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooklogs.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(webhookId) {\n      var params;\n      params = {\n        webhook: webhookId\n      };\n      return $repo.queryMany(\"webhooklogs\", params);\n    };\n    service.resend = function(webhooklogId) {\n      var url;\n      url = $urls.resolve(\"webhooklogs-resend\", webhooklogId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooklogs = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhookLogsResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooks.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(projectId) {\n      var params;\n      params = {\n        project: projectId\n      };\n      return $repo.queryMany(\"webhooks\", params);\n    };\n    service.test = function(webhookId) {\n      var url;\n      url = $urls.resolve(\"webhooks-test\", webhookId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhooksResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/wikis.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(wikiId) {\n      return $repo.queryOne(\"wiki\", wikiId);\n    };\n    service.getBySlug = function(projectId, slug) {\n      return $repo.queryOne(\"wiki\", \"by_slug?project=\" + projectId + \"&slug=\" + slug);\n    };\n    service.listLinks = function(projectId) {\n      return $repo.queryMany(\"wiki-links\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.wiki = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWikiResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var UserChangePasswordController, UserChangePasswordDirective, debounce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserChangePasswordController = (function(superClass) {\n    extend(UserChangePasswordController, superClass);\n\n    UserChangePasswordController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserChangePasswordController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = this.translate.instant(\"CHANGE_PASSWORD.SECTION_NAME\");\n      this.scope.user = this.auth.getUser();\n    }\n\n    return UserChangePasswordController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserChangePasswordController\", UserChangePasswordController);\n\n  UserChangePasswordDirective = function($rs, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, ctrl) {\n      var submit, submitButton;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if ($scope.newPassword1 !== $scope.newPassword2) {\n            $confirm.notify('error', $translate.instant(\"CHANGE_PASSWORD.ERROR_PASSWORD_MATCH\"));\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userSettings.changePassword($scope.currentPassword, $scope.newPassword1);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify('success');\n          });\n          return promise.then(null, function(response) {\n            currentLoading.finish();\n            return $confirm.notify('error', response.data._error_message);\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserChangePassword\", [\"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", UserChangePasswordDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var DeleteUserDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  DeleteUserDirective = function($repo, $rootscope, $auth, $location, $navUrls, lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      $scope.$on(\"deletelightbox:new\", function(ctx, user) {\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        promise = $repo.remove($scope.user);\n        promise.then(function(data) {\n          lightboxService.close($el);\n          $auth.logout();\n          return $location.path($navUrls.resolve(\"login\"));\n        });\n        return promise.then(null, function() {\n          return console.log(\"FAIL\");\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", debounce(2000, function(event) {\n        event.preventDefault();\n        return submit();\n      }));\n    };\n    return {\n      link: link,\n      templateUrl: \"user/lightbox/lightbox-delete-account.html\"\n    };\n  };\n\n  module.directive(\"tgLbDeleteUser\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"lightboxService\", DeleteUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var TaigaAvatarModelDirective, UserAvatarDirective, UserProfileDirective, UserSettingsController, debounce, mixOf, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  debounce = this.taiga.debounce;\n\n  UserSettingsController = (function(superClass) {\n    extend(UserSettingsController, superClass);\n\n    UserSettingsController.$inject = [\"$scope\", \"$rootScope\", \"$tgConfig\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserSettingsController(scope, rootscope, config, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      var maxFileSize, promise, text;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.config = config;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = \"USER_SETTINGS.MENU.SECTION_TITLE\";\n      this.scope.project = {};\n      this.scope.user = this.auth.getUser();\n      if (!this.scope.user) {\n        this.location.path(this.navUrls.resolve(\"permission-denied\"));\n        this.location.replace();\n      }\n      this.scope.lang = this.getLan();\n      this.scope.theme = this.getTheme();\n      maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        text = this.translate.instant(\"USER_SETTINGS.AVATAR_MAX_SIZE\", {\n          \"maxFileSize\": sizeFormat(maxFileSize)\n        });\n        this.scope.maxFileSizeMsg = text;\n      }\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserSettingsController.prototype.loadInitialData = function() {\n      this.scope.availableThemes = this.config.get(\"themes\", []);\n      return this.rs.locales.list().then((function(_this) {\n        return function(locales) {\n          _this.scope.locales = locales;\n          return locales;\n        };\n      })(this));\n    };\n\n    UserSettingsController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.user);\n    };\n\n    UserSettingsController.prototype.getLan = function() {\n      return this.scope.user.lang || this.translate.preferredLanguage();\n    };\n\n    UserSettingsController.prototype.getTheme = function() {\n      return this.scope.user.theme || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    return UserSettingsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserSettingsController\", UserSettingsController);\n\n  UserProfileDirective = function($confirm, $auth, $repo, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var changeEmail, form, onError, onSuccess;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          changeEmail = $scope.user.isAttributeModified(\"email\");\n          $scope.user.lang = $scope.lang;\n          $scope.user.theme = $scope.theme;\n          onSuccess = function(data) {\n            var text;\n            $auth.setUser(data);\n            if (changeEmail) {\n              text = $translate.instant(\"USER_PROFILE.CHANGE_EMAIL_SUCCESS\");\n              return $confirm.success(text);\n            } else {\n              return $confirm.notify('success');\n            }\n          };\n          onError = function(data) {\n            form.setErrors(data);\n            return $confirm.notify('error', data._error_message);\n          };\n          return $repo.save($scope.user).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserProfile\", [\"$tgConfirm\", \"$tgAuth\", \"$tgRepo\", \"$translate\", UserProfileDirective]);\n\n  UserAvatarDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      onSuccess = function(response) {\n        var user;\n        user = $model.make_model(\"users\", response.data);\n        $auth.setUser(user);\n        $scope.user = user;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-avatar\", function() {\n        return $el.find(\"#avatar-field\").click();\n      });\n      $el.on(\"change\", \"#avatar-field\", function(event) {\n        if ($scope.avatarAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-gravatar\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.userSettings.removeAvatar().then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserAvatar\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", UserAvatarDirective]);\n\n  TaigaAvatarModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgAvatarModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgAvatarModel', ['$parse', TaigaAvatarModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/nav.coffee\n */\n\n(function() {\n  var UserSettingsNavigationDirective, module;\n\n  UserSettingsNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgUserSettingsNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#usersettingsmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaUserSettings\");\n\n  module.directive(\"tgUserSettingsNavigation\", UserSettingsNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/notifications.coffee\n */\n\n(function() {\n  var UserNotificationsController, UserNotificationsDirective, UserNotificationsListDirective, bindOnce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserNotificationsController = (function(superClass) {\n    extend(UserNotificationsController, superClass);\n\n    UserNotificationsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\"];\n\n    function UserNotificationsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.scope.sectionName = \"USER_SETTINGS.NOTIFICATIONS.SECTION_NAME\";\n      this.scope.user = this.auth.getUser();\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserNotificationsController.prototype.loadInitialData = function() {\n      return this.rs.notifyPolicies.list().then((function(_this) {\n        return function(notifyPolicies) {\n          _this.scope.notifyPolicies = notifyPolicies;\n          return notifyPolicies;\n        };\n      })(this));\n    };\n\n    return UserNotificationsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserNotificationsController\", UserNotificationsController);\n\n  UserNotificationsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotifications\", UserNotificationsDirective);\n\n  UserNotificationsListDirective = function($repo, $confirm, $compile) {\n    var link, template;\n    template = _.template(\"<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\\n<div class=\\\"policy-table-row\\\" data-index=\\\"<%- index %>\\\">\\n  <div class=\\\"policy-table-project\\\"><span><%- notifyPolicy.project_name %></span></div>\\n  <div class=\\\"policy-table-all\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             value=\\\"2\\\" <% if (notifyPolicy.notify_level == 2) { %>checked=\\\"checked\\\"<% } %>/>\\n      <label for=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_ALL\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-involved\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             value=\\\"1\\\" <% if (notifyPolicy.notify_level == 1) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-none\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             value=\\\"3\\\" <% if (notifyPolicy.notify_level == 3) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_NONE\\\"></label>\\n    </fieldset>\\n  </div>\\n</div>\\n<% }) %>\");\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function() {\n        var ctx, html;\n        $el.off();\n        ctx = {\n          notifyPolicies: $scope.notifyPolicies\n        };\n        html = template(ctx);\n        $el.html($compile(html)($scope));\n        return $el.on(\"change\", \"input[type=radio]\", function(event) {\n          var onError, onSuccess, policy, policyIndex, prev_level, target;\n          target = angular.element(event.currentTarget);\n          policyIndex = target.parents(\".policy-table-row\").data('index');\n          policy = $scope.notifyPolicies[policyIndex];\n          prev_level = policy.notify_level;\n          policy.notify_level = parseInt(target.val(), 10);\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return target.parents(\".policy-table-row\").find(\"input[value=\" + prev_level + \"]\").prop(\"checked\", true);\n          };\n          return $repo.save(policy).then(onSuccess, onError);\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotificationsList\", [\"$tgRepo\", \"$tgConfirm\", \"$compile\", UserNotificationsListDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: components.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaComponents\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaDiscover\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaExternalApps\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaHome\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaNavigationBar\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProfile\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaProjects\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaResources2\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaUserTimeline\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-link.directive.coffee\n */\n\n(function() {\n  var AttachmentLinkDirective;\n\n  AttachmentLinkDirective = function($parse, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attachment;\n      attachment = $parse(attrs.tgAttachmentLink)(scope);\n      el.on(\"click\", function(event) {\n        if (taiga.isImage(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return scope.$apply(function() {\n            return lightboxFactory.create('tg-lb-attachment-preview', {\n              \"class\": 'lightbox lightbox-block'\n            }, {\n              file: attachment.get('file')\n            });\n          });\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentLinkDirective.$inject = [\"$parse\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentLink\", AttachmentLinkDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-gallery.directive.coffee\n */\n\n(function() {\n  var AttachmentGalleryDirective;\n\n  AttachmentGalleryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment-gallery.html\",\n      link: link\n    };\n  };\n\n  AttachmentGalleryDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentGallery\", AttachmentGalleryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchment.controller.coffee\n */\n\n(function() {\n  var AttachmentController;\n\n  AttachmentController = (function() {\n    AttachmentController.$inject = ['tgAttachmentsService', '$translate'];\n\n    function AttachmentController(attachmentsService, translate) {\n      this.attachmentsService = attachmentsService;\n      this.translate = translate;\n      this.form = {};\n      this.form.description = this.attachment.getIn(['file', 'description']);\n      this.form.is_deprecated = this.attachment.get(['file', 'is_deprecated']);\n      this.title = this.translate.instant(\"ATTACHMENT.TITLE\", {\n        fileName: this.attachment.get('name'),\n        date: moment(this.attachment.get('created_date')).format(this.translate.instant(\"ATTACHMENT.DATE\"))\n      });\n    }\n\n    AttachmentController.prototype.editMode = function(mode) {\n      var attachment;\n      attachment = this.attachment.set('editable', mode);\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    AttachmentController.prototype[\"delete\"] = function() {\n      return this.onDelete({\n        attachment: this.attachment\n      });\n    };\n\n    AttachmentController.prototype.save = function() {\n      var attachment;\n      attachment = this.attachment.set('loading', true);\n      this.onUpdate({\n        attachment: attachment\n      });\n      attachment = this.attachment.merge({\n        editable: false,\n        loading: false\n      });\n      attachment = attachment.mergeIn(['file'], {\n        description: this.form.description,\n        is_deprecated: !!this.form.is_deprecated\n      });\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    return AttachmentController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Attachment', AttachmentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment.directive.coffee\n */\n\n(function() {\n  var AttachmentDirective;\n\n  AttachmentDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment.html\",\n      link: link\n    };\n  };\n\n  AttachmentDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachment\", AttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-drop.directive.coffee\n */\n\n(function() {\n  var AttachmentsDropDirective;\n\n  AttachmentsDropDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgAttachmentsDrop);\n      el.on('dragover', function(e) {\n        e.preventDefault();\n        return false;\n      });\n      el.on('drop', function(e) {\n        var dataTransfer;\n        e.stopPropagation();\n        e.preventDefault();\n        dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: dataTransfer.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentsDropDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsDrop\", AttachmentsDropDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.controller.coffee\n */\n\n(function() {\n  var AttachmentsFullController, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsFullController = (function() {\n    AttachmentsFullController.$inject = [\"$translate\", \"$tgConfirm\", \"$tgConfig\", \"$tgStorage\", \"tgAttachmentsFullService\"];\n\n    function AttachmentsFullController(translate, confirm, config, storage, attachmentsFullService) {\n      this.translate = translate;\n      this.confirm = confirm;\n      this.config = config;\n      this.storage = storage;\n      this.attachmentsFullService = attachmentsFullService;\n      this.mode = this.storage.get('attachment-mode', 'list');\n      this.maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (this.maxFileSize) {\n        this.maxFileSize = sizeFormat(this.maxFileSize);\n      }\n      this.maxFileSizeMsg = this.maxFileSize ? this.translate.instant(\"ATTACHMENT.MAX_UPLOAD_SIZE\", {\n        maxFileSize: this.maxFileSize\n      }) : \"\";\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullController.prototype.uploadingAttachments = function() {\n      return this.attachmentsFullService.uploadingAttachments;\n    };\n\n    AttachmentsFullController.prototype.addAttachment = function(file) {\n      var editable;\n      editable = this.mode === 'list';\n      return this.attachmentsFullService.addAttachment(this.projectId, this.objId, this.type, file, editable);\n    };\n\n    AttachmentsFullController.prototype.setMode = function(mode) {\n      this.mode = mode;\n      return this.storage.set('attachment-mode', mode);\n    };\n\n    AttachmentsFullController.prototype.toggleDeprecatedsVisible = function() {\n      return this.attachmentsFullService.toggleDeprecatedsVisible();\n    };\n\n    AttachmentsFullController.prototype.addAttachments = function(files) {\n      return _.forEach(files, (function(_this) {\n        return function(file) {\n          return _this.addAttachment(file);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.loadAttachments = function() {\n      return this.attachmentsFullService.loadAttachments(this.type, this.objId, this.projectId);\n    };\n\n    AttachmentsFullController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      var message, title;\n      title = this.translate.instant(\"ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT\");\n      message = this.translate.instant(\"ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT\", {\n        fileName: toDeleteAttachment.getIn(['file', 'name'])\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onError = function() {\n            message = _this.translate.instant(\"ATTACHMENT.ERROR_DELETE_ATTACHMENT\", {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            return askResponse.finish();\n          };\n          return _this.attachmentsFullService.deleteAttachment(toDeleteAttachment, _this.type).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.reorderAttachment = function(attachment, newIndex) {\n      return this.attachmentsFullService.reorderAttachment(this.type, attachment, newIndex);\n    };\n\n    AttachmentsFullController.prototype.updateAttachment = function(toUpdateAttachment) {\n      return this.attachmentsFullService.updateAttachment(toUpdateAttachment, this.type);\n    };\n\n    return AttachmentsFullController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsFull\", AttachmentsFullController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.directive.coffee\n */\n\n(function() {\n  var AttachmentsFullDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  AttachmentsFullDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.objId', function(value) {\n        return ctrl.loadAttachments();\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        type: \"@\",\n        objId: \"=\",\n        projectId: \"=\"\n      },\n      controller: \"AttachmentsFull\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-full/attachments-full.html\",\n      link: link\n    };\n  };\n\n  AttachmentsFullDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsFull\", AttachmentsFullDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-full.service.coffee\n */\n\n(function() {\n  var AttachmentsFullService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsFullService = (function(superClass) {\n    extend(AttachmentsFullService, superClass);\n\n    AttachmentsFullService.$inject = [\"tgAttachmentsService\", \"$rootScope\"];\n\n    function AttachmentsFullService(attachmentsService, rootScope) {\n      this.attachmentsService = attachmentsService;\n      this.rootScope = rootScope;\n      this._attachments = Immutable.List();\n      this._deprecatedsCount = 0;\n      this._attachmentsVisible = Immutable.List();\n      this._deprecatedsVisible = false;\n      this.uploadingAttachments = [];\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this._attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this._deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this._attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this._deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullService.prototype.toggleDeprecatedsVisible = function() {\n      this._deprecatedsVisible = !this._deprecatedsVisible;\n      return this.regenerate();\n    };\n\n    AttachmentsFullService.prototype.regenerate = function() {\n      this._deprecatedsCount = this._attachments.count(function(it) {\n        return it.getIn(['file', 'is_deprecated']);\n      });\n      if (this._deprecatedsVisible) {\n        return this._attachmentsVisible = this._attachments;\n      } else {\n        return this._attachmentsVisible = this._attachments.filter(function(it) {\n          return !it.getIn(['file', 'is_deprecated']);\n        });\n      }\n    };\n\n    AttachmentsFullService.prototype.addAttachment = function(projectId, objId, type, file, editable) {\n      if (editable == null) {\n        editable = true;\n      }\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          var promise;\n          if (_this.attachmentsService.validate(file)) {\n            _this.uploadingAttachments.push(file);\n            promise = _this.attachmentsService.upload(file, objId, projectId, type);\n            return promise.then(function(file) {\n              var attachment;\n              _this.uploadingAttachments = _this.uploadingAttachments.filter(function(uploading) {\n                return uploading.name !== file.get('name');\n              });\n              attachment = Immutable.Map();\n              attachment = attachment.merge({\n                file: file,\n                editable: editable,\n                loading: false\n              });\n              _this._attachments = _this._attachments.push(attachment);\n              _this.regenerate();\n              _this.rootScope.$broadcast(\"attachment:create\");\n              return resolve(attachment);\n            });\n          } else {\n            return reject(file);\n          }\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.loadAttachments = function(type, objId, projectId) {\n      return this.attachmentsService.list(type, objId, projectId).then((function(_this) {\n        return function(files) {\n          _this._attachments = files.map(function(file) {\n            var attachment;\n            attachment = Immutable.Map();\n            return attachment.merge({\n              loading: false,\n              editable: false,\n              file: file\n            });\n          });\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.deleteAttachment = function(toDeleteAttachment, type) {\n      var onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this._attachments = _this._attachments.filter(function(attachment) {\n            return attachment !== toDeleteAttachment;\n          });\n          return _this.regenerate();\n        };\n      })(this);\n      return this.attachmentsService[\"delete\"](type, toDeleteAttachment.getIn(['file', 'id'])).then(onSuccess);\n    };\n\n    AttachmentsFullService.prototype.reorderAttachment = function(type, attachment, newIndex) {\n      var attachments, oldIndex, promises;\n      oldIndex = this.attachments.findIndex(function(it) {\n        return it === attachment;\n      });\n      if (oldIndex === newIndex) {\n        return;\n      }\n      attachments = this.attachments.remove(oldIndex);\n      attachments = attachments.splice(newIndex, 0, attachment);\n      attachments = attachments.map(function(x, i) {\n        return x.setIn(['file', 'order'], i + 1);\n      });\n      promises = [];\n      attachments.forEach((function(_this) {\n        return function(attachment) {\n          var patch;\n          patch = {\n            order: attachment.getIn(['file', 'order'])\n          };\n          return promises.push(_this.attachmentsService.patch(attachment.getIn(['file', 'id']), type, patch));\n        };\n      })(this));\n      return Promise.all(promises).then((function(_this) {\n        return function() {\n          _this._attachments = attachments;\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.updateAttachment = function(toUpdateAttachment, type) {\n      var index, oldAttachment, patch;\n      index = this._attachments.findIndex(function(attachment) {\n        return attachment.getIn(['file', 'id']) === toUpdateAttachment.getIn(['file', 'id']);\n      });\n      oldAttachment = this._attachments.get(index);\n      patch = taiga.patch(oldAttachment.get('file'), toUpdateAttachment.get('file'));\n      if (toUpdateAttachment.get('loading')) {\n        this._attachments = this._attachments.set(index, toUpdateAttachment);\n        return this.regenerate();\n      } else {\n        return this.attachmentsService.patch(toUpdateAttachment.getIn(['file', 'id']), type, patch).then((function(_this) {\n          return function() {\n            _this._attachments = _this._attachments.set(index, toUpdateAttachment);\n            return _this.regenerate();\n          };\n        })(this));\n      }\n    };\n\n    return AttachmentsFullService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsFullService\", AttachmentsFullService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.controller.coffee\n */\n\n(function() {\n  var AttachmentsSimpleController;\n\n  AttachmentsSimpleController = (function() {\n    AttachmentsSimpleController.$inject = [\"tgAttachmentsService\"];\n\n    function AttachmentsSimpleController(attachmentsService) {\n      this.attachmentsService = attachmentsService;\n    }\n\n    AttachmentsSimpleController.prototype.addAttachment = function(file) {\n      var attachment;\n      attachment = Immutable.fromJS({\n        file: file,\n        name: file.name,\n        size: file.size\n      });\n      if (this.attachmentsService.validate(file)) {\n        this.attachments = this.attachments.push(attachment);\n        if (this.onAdd) {\n          return this.onAdd({\n            attachment: attachment\n          });\n        }\n      }\n    };\n\n    AttachmentsSimpleController.prototype.addAttachments = function(files) {\n      return _.forEach(files, this.addAttachment.bind(this));\n    };\n\n    AttachmentsSimpleController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      this.attachments = this.attachments.filter(function(attachment) {\n        return attachment !== toDeleteAttachment;\n      });\n      if (this.onDelete) {\n        return this.onDelete({\n          attachment: toDeleteAttachment\n        });\n      }\n    };\n\n    return AttachmentsSimpleController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsSimple\", AttachmentsSimpleController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.directive.coffee\n */\n\n(function() {\n  var AttachmentsSimpleDirective;\n\n  AttachmentsSimpleDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachments: \"=\",\n        onAdd: \"&\",\n        onDelete: \"&\"\n      },\n      controller: \"AttachmentsSimple\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-simple/attachments-simple.html\",\n      link: link\n    };\n  };\n\n  AttachmentsSimpleDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSimple\", AttachmentsSimpleDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-sortable.directive.coffee\n */\n\n(function() {\n  var AttachmentSortableDirective;\n\n  AttachmentSortableDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback;\n      callback = $parse(attrs.tgAttachmentsSortable);\n      el.sortable({\n        items: \"div[tg-bind-scope]\",\n        handle: \"a.settings.icon.icon-drag-v\",\n        containment: \".attachments\",\n        dropOnEmpty: true,\n        helper: 'clone',\n        scroll: false,\n        tolerance: \"pointer\",\n        placeholder: \"sortable-placeholder single-attachment\"\n      });\n      el.on(\"sortstop\", function(event, ui) {\n        var attachment, newIndex;\n        attachment = ui.item.scope().attachment;\n        newIndex = ui.item.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            attachment: attachment,\n            index: newIndex\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentSortableDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSortable\", AttachmentSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: auto-select.directive.coffee\n */\n\n(function() {\n  var AutoSelectDirective;\n\n  AutoSelectDirective = function($timeout) {\n    return {\n      link: function(scope, elm) {\n        return $timeout(function() {\n          return elm[0].select();\n        });\n      }\n    };\n  };\n\n  AutoSelectDirective.$inject = ['$timeout'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAutoSelect\", AutoSelectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: file-change.directive.coffee\n */\n\n(function() {\n  var FileChangeDirective;\n\n  FileChangeDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgFileChange);\n      el.on('change', function(event) {\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: event.currentTarget.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      restrict: \"A\",\n      link: link\n    };\n  };\n\n  FileChangeDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgFileChange\", FileChangeDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.directive.coffee\n */\n\n(function() {\n  var JoyRideDirective, taiga;\n\n  taiga = this.taiga;\n\n  JoyRideDirective = function($rootScope, currentUserService, joyRideService, $location, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var initJoyrRide, intro, unsuscribe;\n      unsuscribe = null;\n      intro = introJs();\n      intro.oncomplete(function() {\n        return $('html,body').scrollTop(0);\n      });\n      intro.onexit(function() {\n        return currentUserService.disableJoyRide();\n      });\n      initJoyrRide = function(next, config) {\n        if (!config[next.joyride]) {\n          return;\n        }\n        intro.setOptions({\n          exitOnEsc: false,\n          exitOnOverlayClick: false,\n          showStepNumbers: false,\n          nextLabel: $translate.instant('JOYRIDE.NAV.NEXT') + ' &rarr;',\n          prevLabel: '&larr; ' + $translate.instant('JOYRIDE.NAV.BACK'),\n          skipLabel: $translate.instant('JOYRIDE.NAV.SKIP'),\n          doneLabel: $translate.instant('JOYRIDE.NAV.DONE'),\n          disableInteraction: true\n        });\n        intro.setOption('steps', joyRideService.get(next.joyride));\n        return intro.start();\n      };\n      return $rootScope.$on('$routeChangeSuccess', function(event, next) {\n        if (!next.joyride || !currentUserService.isAuthenticated()) {\n          intro.exit();\n          if (unsuscribe) {\n            unsuscribe();\n          }\n          return;\n        }\n        intro.oncomplete(function() {\n          return currentUserService.disableJoyRide(next.joyride);\n        });\n        if (next.loader) {\n          return unsuscribe = $rootScope.$on('loader:end', function() {\n            currentUserService.loadJoyRideConfig().then(function(config) {\n              return initJoyrRide(next, config);\n            });\n            return unsuscribe();\n          });\n        } else {\n          return currentUserService.loadJoyRideConfig().then(function(config) {\n            return initJoyrRide(next, config);\n          });\n        }\n      });\n    };\n    return {\n      scope: {},\n      link: link\n    };\n  };\n\n  JoyRideDirective.$inject = [\"$rootScope\", \"tgCurrentUserService\", \"tgJoyRideService\", \"$location\", \"$translate\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgJoyRide\", JoyRideDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.service.coffee\n */\n\n(function() {\n  var JoyRideService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JoyRideService = (function(superClass) {\n    extend(JoyRideService, superClass);\n\n    JoyRideService.$inject = ['$translate', 'tgCheckPermissionsService'];\n\n    function JoyRideService(translate, checkPermissionsService) {\n      this.translate = translate;\n      this.checkPermissionsService = checkPermissionsService;\n    }\n\n    JoyRideService.prototype.getConfig = function() {\n      return {\n        dashboard: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.project-list > section:not(.ng-hide)',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TEXT')\n                }\n              }, {\n                element: '.working-on-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TEXT')\n                }\n              }, {\n                element: '.watching-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT2')]\n                }\n              }\n            ];\n            if (!$('.project-list .create-project-button').is(':hidden')) {\n              steps.push({\n                element: '.project-list .create-project-button',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        backlog: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.summary',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT1'), _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT2')]\n                }\n              }, {\n                element: '.backlog-table-empty',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TEXT')\n                }\n              }, {\n                element: '.sprints',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.new-us',\n                position: 'rigth',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TEXT')\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        kanban: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.kanban-table-inner',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TEXT')\n                }\n              }, {\n                element: '.card-placeholder',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.icon-plus',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this)\n      };\n    };\n\n    JoyRideService.prototype.get = function(name) {\n      var joyRide, joyRides;\n      joyRides = this.getConfig();\n      joyRide = joyRides[name].call(this);\n      return _.map(joyRide, function(item) {\n        var html;\n        html = \"\";\n        if (item.joyride.title) {\n          html += \"<h3>\" + item.joyride.title + \"</h3>\";\n        }\n        if (_.isArray(item.joyride.text)) {\n          _.forEach(item.joyride.text, function(text) {\n            return html += \"<p>\" + text + \"</p>\";\n          });\n        } else {\n          html += \"<p>\" + item.joyride.text + \"</p>\";\n        }\n        item.intro = html;\n        return item;\n      });\n    };\n\n    return JoyRideService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgJoyRideService\", JoyRideService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2015 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2015 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: live-announcement.directive.coffee\n */\n\n(function() {\n  var LiveAnnouncementDirective;\n\n  LiveAnnouncementDirective = function(liveAnnouncementService) {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      restrict: \"AE\",\n      scope: {},\n      controllerAs: 'vm',\n      controller: function() {\n        this.close = function() {\n          return liveAnnouncementService.open = false;\n        };\n        return Object.defineProperties(this, {\n          open: {\n            get: function() {\n              return liveAnnouncementService.open;\n            }\n          },\n          title: {\n            get: function() {\n              return liveAnnouncementService.title;\n            }\n          },\n          desc: {\n            get: function() {\n              return liveAnnouncementService.desc;\n            }\n          }\n        });\n      },\n      link: link,\n      templateUrl: \"components/live-announcement/live-announcement.html\"\n    };\n  };\n\n  LiveAnnouncementDirective.$inject = [\"tgLiveAnnouncementService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgLiveAnnouncement\", LiveAnnouncementDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: notification.service.coffee\n */\n\n(function() {\n  var LiveAnnouncementService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  LiveAnnouncementService = (function(superClass) {\n    extend(LiveAnnouncementService, superClass);\n\n    function LiveAnnouncementService() {\n      this.open = false;\n      this.title = \"\";\n      this.desc = \"\";\n    }\n\n    LiveAnnouncementService.prototype.show = function(title, desc) {\n      this.open = true;\n      this.title = title;\n      return this.desc = desc;\n    };\n\n    return LiveAnnouncementService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgLiveAnnouncementService\", LiveAnnouncementService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-big-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoBigSrcDirective;\n\n  ProjectLogoBigSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_big_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoBigSrc\"\n      }\n    };\n  };\n\n  ProjectLogoBigSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoBigSrc\", ProjectLogoBigSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-small-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoSmallSrcDirective;\n\n  ProjectLogoSmallSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_small_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoSmallSrc\"\n      }\n    };\n  };\n\n  ProjectLogoSmallSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoSmallSrc\", ProjectLogoSmallSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.controller.coffee\n */\n\n(function() {\n  var ProjectMenuController;\n\n  ProjectMenuController = (function() {\n    ProjectMenuController.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n    function ProjectMenuController(projectService, lightboxFactory) {\n      this.projectService = projectService;\n      this.lightboxFactory = lightboxFactory;\n      this.project = null;\n      this.menu = Immutable.Map();\n    }\n\n    ProjectMenuController.prototype.show = function() {\n      this.project = this.projectService.project;\n      this.active = this._getActiveSection();\n      this._setVideoConference();\n      return this._setMenuPermissions();\n    };\n\n    ProjectMenuController.prototype.hide = function() {\n      this.project = null;\n      return this.menu = {};\n    };\n\n    ProjectMenuController.prototype.search = function() {\n      return this.lightboxFactory.create(\"tg-search-box\", {\n        \"class\": \"lightbox lightbox-search\"\n      });\n    };\n\n    ProjectMenuController.prototype._setVideoConference = function() {\n      var videoconferenceUrl;\n      videoconferenceUrl = this._videoConferenceUrl();\n      if (videoconferenceUrl) {\n        return this.project = this.project.set(\"videoconferenceUrl\", videoconferenceUrl);\n      }\n    };\n\n    ProjectMenuController.prototype._setMenuPermissions = function() {\n      this.menu = Immutable.Map({\n        backlog: false,\n        kanban: false,\n        issues: false,\n        wiki: false\n      });\n      if (this.project.get(\"is_backlog_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"backlog\", true);\n      }\n      if (this.project.get(\"is_kanban_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"kanban\", true);\n      }\n      if (this.project.get(\"is_issues_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_issues\") !== -1) {\n        this.menu = this.menu.set(\"issues\", true);\n      }\n      if (this.project.get(\"is_wiki_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_wiki_pages\") !== -1) {\n        return this.menu = this.menu.set(\"wiki\", true);\n      }\n    };\n\n    ProjectMenuController.prototype._getActiveSection = function() {\n      var indexBacklog, indexKanban, oldSectionName, sectionName, sectionsBreadcrumb;\n      sectionName = this.projectService.section;\n      sectionsBreadcrumb = this.projectService.sectionsBreadcrumb;\n      indexBacklog = sectionsBreadcrumb.lastIndexOf(\"backlog\");\n      indexKanban = sectionsBreadcrumb.lastIndexOf(\"kanban\");\n      if (indexBacklog !== -1 || indexKanban !== -1) {\n        if (indexKanban === -1 || indexBacklog > indexKanban) {\n          oldSectionName = \"backlog\";\n        } else {\n          oldSectionName = \"kanban\";\n        }\n      }\n      if (sectionName === \"backlog-kanban\") {\n        if (oldSectionName === \"backlog\" || oldSectionName === \"kanban\") {\n          sectionName = oldSectionName;\n        } else if (this.project.get(\"is_backlog_activated\") && !this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"backlog\";\n        } else if (!this.project.get(\"is_backlog_activated\") && this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"kanban\";\n        }\n      }\n      return sectionName;\n    };\n\n    ProjectMenuController.prototype._videoConferenceUrl = function() {\n      var baseUrl, url;\n      if (this.project.get(\"videoconferences\") === \"appear-in\") {\n        baseUrl = \"https://appear.in/\";\n      } else if (this.project.get(\"videoconferences\") === \"talky\") {\n        baseUrl = \"https://talky.io/\";\n      } else if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        baseUrl = \"https://meet.jit.si/\";\n        url = this.project.get(\"slug\") + \"-\" + taiga.slugify(this.project.get(\"videoconferences_extra_data\"));\n        url = url.replace(/-/g, \"\");\n        return baseUrl + url;\n      } else if (this.project.get(\"videoconferences\") === \"custom\") {\n        return this.project.get(\"videoconferences_extra_data\");\n      } else {\n        return \"\";\n      }\n      if (this.project.get(\"videoconferences_extra_data\")) {\n        url = this.project.get(\"slug\") + \"-\" + this.project.get(\"videoconferences_extra_data\");\n      } else {\n        url = this.project.get(\"slug\");\n      }\n      return baseUrl + url;\n    };\n\n    return ProjectMenuController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"ProjectMenu\", ProjectMenuController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.directive.coffee\n */\n\n(function() {\n  var ProjectMenuDirective, taiga;\n\n  taiga = this.taiga;\n\n  ProjectMenuDirective = function(projectService, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var projectChange;\n      projectChange = function() {\n        if (projectService.project) {\n          return ctrl.show();\n        } else {\n          return ctrl.hide();\n        }\n      };\n      scope.$watch((function() {\n        return projectService.project;\n      }), projectChange);\n      scope.vm.fixed = false;\n      return $(window).on(\"scroll\", function() {\n        var position;\n        position = $(window).scrollTop();\n        if (position > 100 && scope.vm.fixed === false) {\n          scope.vm.fixed = true;\n          return scope.$digest();\n        } else if (position < 100 && scope.vm.fixed === true) {\n          scope.vm.fixed = false;\n          return scope.$digest();\n        }\n      });\n    };\n    return {\n      scope: {},\n      controller: \"ProjectMenu\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/project-menu/project-menu.html\",\n      link: link\n    };\n  };\n\n  ProjectMenuDirective.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectMenu\", ProjectMenuDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.directive.coffee\n */\n\n(function() {\n  var TermsOfServiceAndPrivacyPolicyNoticeDirective;\n\n  TermsOfServiceAndPrivacyPolicyNoticeDirective = function($config) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.privacyPolicyUrl = $config.get(\"privacyPolicyUrl\");\n      return scope.termsOfServiceUrl = $config.get(\"termsOfServiceUrl\");\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      link: link,\n      templateUrl: \"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgTermsOfServiceAndPrivacyPolicyNotice\", [\"$tgConfig\", TermsOfServiceAndPrivacyPolicyNoticeDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.controller.coffee\n */\n\n(function() {\n  var VoteButtonController;\n\n  VoteButtonController = (function() {\n    VoteButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function VoteButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    VoteButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    VoteButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    VoteButtonController.prototype.toggleVote = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_voter) {\n        promise = this._upvote();\n      } else {\n        promise = this._downvote();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    VoteButtonController.prototype._upvote = function() {\n      return this.onUpvote().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    VoteButtonController.prototype._downvote = function() {\n      return this.onDownvote();\n    };\n\n    return VoteButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"VoteButton\", VoteButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.directive.coffee\n */\n\n(function() {\n  var VoteButtonDirective;\n\n  VoteButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"VoteButton\",\n      bindToController: {\n        item: \"=\",\n        onUpvote: \"=\",\n        onDownvote: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/vote-button/vote-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgVoteButton\", VoteButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.controller.coffee\n */\n\n(function() {\n  var WatchButtonController;\n\n  WatchButtonController = (function() {\n    WatchButtonController.$inject = [\"tgCurrentUserService\", \"$rootScope\"];\n\n    function WatchButtonController(currentUserService, rootScope) {\n      this.currentUserService = currentUserService;\n      this.rootScope = rootScope;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    WatchButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    WatchButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    WatchButtonController.prototype.openWatchers = function() {\n      return this.rootScope.$broadcast(\"watcher:add\", this.item);\n    };\n\n    WatchButtonController.prototype.getPerms = function() {\n      var name, perms;\n      if (!this.item) {\n        return \"\";\n      }\n      name = this.item._name;\n      perms = {\n        userstories: 'modify_us',\n        issues: 'modify_issue',\n        tasks: 'modify_task'\n      };\n      return perms[name];\n    };\n\n    WatchButtonController.prototype.toggleWatch = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_watcher) {\n        promise = this._watch();\n      } else {\n        promise = this._unwatch();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    WatchButtonController.prototype._watch = function() {\n      return this.onWatch().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    WatchButtonController.prototype._unwatch = function() {\n      return this.onUnwatch();\n    };\n\n    return WatchButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"WatchButton\", WatchButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.directive.coffee\n */\n\n(function() {\n  var WatchButtonDirective;\n\n  WatchButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchButton\",\n      bindToController: {\n        item: \"=\",\n        onWatch: \"=\",\n        onUnwatch: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: function(item, attributes) {\n        return \"components/watch-button/watch-button-\" + attributes.environment + \".html\";\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWatchButton\", WatchButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByController;\n\n  DiscoverHomeOrderByController = (function() {\n    DiscoverHomeOrderByController.$inject = ['$translate'];\n\n    function DiscoverHomeOrderByController(translate) {\n      this.translate = translate;\n      this.is_open = false;\n      this.texts = {\n        week: this.translate.instant('DISCOVER.FILTERS.WEEK'),\n        month: this.translate.instant('DISCOVER.FILTERS.MONTH'),\n        year: this.translate.instant('DISCOVER.FILTERS.YEAR'),\n        all: this.translate.instant('DISCOVER.FILTERS.ALL_TIME')\n      };\n    }\n\n    DiscoverHomeOrderByController.prototype.currentText = function() {\n      return this.texts[this.currentOrderBy];\n    };\n\n    DiscoverHomeOrderByController.prototype.open = function() {\n      return this.is_open = true;\n    };\n\n    DiscoverHomeOrderByController.prototype.close = function() {\n      return this.is_open = false;\n    };\n\n    DiscoverHomeOrderByController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      this.is_open = false;\n      return this.onChange({\n        orderBy: this.currentOrderBy\n      });\n    };\n\n    return DiscoverHomeOrderByController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHomeOrderBy\", DiscoverHomeOrderByController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.directive.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByDirective;\n\n  DiscoverHomeOrderByDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverHomeOrderBy\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-home-order-by/discover-home-order-by.html\",\n      scope: {\n        currentOrderBy: \"=orderBy\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverHomeOrderByDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverHomeOrderBy\", DiscoverHomeOrderByDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-bar.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchBarController;\n\n  DiscoverSearchBarController = (function() {\n    DiscoverSearchBarController.$inject = ['tgDiscoverProjectsService'];\n\n    function DiscoverSearchBarController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.projectsCount;\n        };\n      })(this));\n      this.discoverProjectsService.fetchStats();\n    }\n\n    DiscoverSearchBarController.prototype.selectFilter = function(filter) {\n      return this.onChange({\n        filter: filter,\n        q: this.q\n      });\n    };\n\n    DiscoverSearchBarController.prototype.submitFilter = function() {\n      return this.onChange({\n        filter: this.filter,\n        q: this.q\n      });\n    };\n\n    return DiscoverSearchBarController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchBar\", DiscoverSearchBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchBarDirective;\n\n  DiscoverSearchBarDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"DiscoverSearchBar\",\n      controllerAs: \"vm\",\n      templateUrl: 'discover/components/discover-search-bar/discover-search-bar.html',\n      bindToController: true,\n      scope: {\n        q: \"=\",\n        filter: \"=\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchBarDirective.$inject = [];\n\n  angular.module('taigaDiscover').directive('tgDiscoverSearchBar', DiscoverSearchBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderController;\n\n  DiscoverSearchListHeaderController = (function() {\n    DiscoverSearchListHeaderController.$inject = [];\n\n    function DiscoverSearchListHeaderController() {\n      this.like_is_open = this.orderBy.indexOf('-total_fans') === 0;\n      this.activity_is_open = this.orderBy.indexOf('-total_activity') === 0;\n    }\n\n    DiscoverSearchListHeaderController.prototype.openLike = function() {\n      this.like_is_open = true;\n      this.activity_is_open = false;\n      return this.setOrderBy('-total_fans_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.openActivity = function() {\n      this.activity_is_open = true;\n      this.like_is_open = false;\n      return this.setOrderBy('-total_activity_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.setOrderBy = function(type) {\n      if (type == null) {\n        type = '';\n      }\n      if (!type) {\n        this.like_is_open = false;\n        this.activity_is_open = false;\n      }\n      return this.onChange({\n        orderBy: type\n      });\n    };\n\n    return DiscoverSearchListHeaderController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchListHeader\", DiscoverSearchListHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderDirective;\n\n  DiscoverSearchListHeaderDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverSearchListHeader\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-search-list-header/discover-search-list-header.html\",\n      scope: {\n        onChange: \"&\",\n        orderBy: \"=\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchListHeaderDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearchListHeader\", DiscoverSearchListHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.controller.coffee\n */\n\n(function() {\n  var FeaturedProjectsController;\n\n  FeaturedProjectsController = (function() {\n    FeaturedProjectsController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function FeaturedProjectsController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.featured;\n        };\n      })(this));\n      this.discoverProjectsService.fetchFeatured();\n    }\n\n    return FeaturedProjectsController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"FeaturedProjects\", FeaturedProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.directive.coffee\n */\n\n(function() {\n  var FeaturedProjectsDirective;\n\n  FeaturedProjectsDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"FeaturedProjects\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/featured-projects/featured-projects.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  FeaturedProjectsDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgFeaturedProjects\", FeaturedProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: highlighted.directive.coffee\n */\n\n(function() {\n  var HighlightedDirective;\n\n  HighlightedDirective = function() {\n    return {\n      templateUrl: \"discover/components/highlighted/highlighted.html\",\n      scope: {\n        loading: \"=\",\n        highlighted: \"=\",\n        orderBy: \"=\"\n      }\n    };\n  };\n\n  HighlightedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgHighlighted\", HighlightedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.controller.coffee\n */\n\n(function() {\n  var MostActiveController;\n\n  MostActiveController = (function() {\n    MostActiveController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostActiveController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostActive;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostActiveController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostActive({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostActiveController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostActiveController.prototype.getOrderBy = function(type) {\n      if (this.currentOrderBy === 'all') {\n        return '-total_activity';\n      } else {\n        return '-total_activity_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostActiveController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostActive\", MostActiveController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.directive.coffee\n */\n\n(function() {\n  var MostActiveDirective;\n\n  MostActiveDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostActive\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-active/most-active.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostActiveDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostActive\", MostActiveDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: msot-liked.controller.coffee\n */\n\n(function() {\n  var MostLikedController;\n\n  MostLikedController = (function() {\n    MostLikedController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostLikedController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostLiked;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostLikedController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostLiked({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostLikedController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostLikedController.prototype.getOrderBy = function() {\n      if (this.currentOrderBy === 'all') {\n        return '-total_fans';\n      } else {\n        return '-total_fans_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostLikedController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostLiked\", MostLikedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-liked.directive.coffee\n */\n\n(function() {\n  var MostLikedDirective;\n\n  MostLikedDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostLiked\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-liked/most-liked.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostLikedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostLiked\", MostLikedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeController;\n\n  DiscoverHomeController = (function() {\n    DiscoverHomeController.$inject = ['$tgLocation', '$tgNavUrls', 'tgAppMetaService', '$translate'];\n\n    function DiscoverHomeController(location, navUrls, appMetaService, translate) {\n      var description, title;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      title = this.translate.instant(\"DISCOVER.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverHomeController.prototype.onSubmit = function(q) {\n      var url;\n      url = this.navUrls.resolve('discover-search');\n      return this.location.search('text', q).path(url);\n    };\n\n    return DiscoverHomeController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHome\", DiscoverHomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchController;\n\n  DiscoverSearchController = (function() {\n    DiscoverSearchController.$inject = ['$routeParams', 'tgDiscoverProjectsService', '$route', 'tgAppMetaService', '$translate'];\n\n    function DiscoverSearchController(routeParams, discoverProjectsService, route, appMetaService, translate) {\n      var description, title;\n      this.routeParams = routeParams;\n      this.discoverProjectsService = discoverProjectsService;\n      this.route = route;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.page = 1;\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.nextSearchPage;\n        };\n      })(this));\n      this.q = this.routeParams.text;\n      this.filter = this.routeParams.filter || 'all';\n      this.orderBy = this.routeParams['order_by'] || '';\n      this.loadingGlobal = false;\n      this.loadingList = false;\n      this.loadingPagination = false;\n      title = this.translate.instant(\"DISCOVER.SEARCH.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.SEARCH.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverSearchController.prototype.fetch = function() {\n      this.page = 1;\n      this.discoverProjectsService.resetSearchList();\n      return this.search();\n    };\n\n    DiscoverSearchController.prototype.fetchByGlobalSearch = function() {\n      if (this.loadingGlobal) {\n        return;\n      }\n      this.loadingGlobal = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingGlobal = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.fetchByOrderBy = function() {\n      if (this.loadingList) {\n        return;\n      }\n      this.loadingList = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingList = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.showMore = function() {\n      if (this.loadingPagination) {\n        return;\n      }\n      this.loadingPagination = true;\n      this.page++;\n      return this.search().then((function(_this) {\n        return function() {\n          return _this.loadingPagination = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.search = function() {\n      var filter, params;\n      filter = this.getFilter();\n      params = {\n        page: this.page,\n        q: this.q,\n        order_by: this.orderBy\n      };\n      _.assign(params, filter);\n      return this.discoverProjectsService.fetchSearch(params);\n    };\n\n    DiscoverSearchController.prototype.getFilter = function() {\n      if (this.filter === 'people') {\n        return {\n          is_looking_for_people: true\n        };\n      } else if (this.filter === 'scrum') {\n        return {\n          is_backlog_activated: true\n        };\n      } else if (this.filter === 'kanban') {\n        return {\n          is_kanban_activated: true\n        };\n      }\n      return {};\n    };\n\n    DiscoverSearchController.prototype.onChangeFilter = function(filter, q) {\n      this.filter = filter;\n      this.q = q;\n      this.route.updateParams({\n        filter: this.filter,\n        text: this.q\n      });\n      return this.fetchByGlobalSearch();\n    };\n\n    DiscoverSearchController.prototype.onChangeOrder = function(orderBy) {\n      this.orderBy = orderBy;\n      this.route.updateParams({\n        order_by: orderBy\n      });\n      return this.fetchByOrderBy();\n    };\n\n    return DiscoverSearchController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearch\", DiscoverSearchController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchDirective;\n\n  DiscoverSearchDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  DiscoverSearchDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearch\", DiscoverSearchDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-projects.service.coffee\n */\n\n(function() {\n  var DiscoverProjectsService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  DiscoverProjectsService = (function(superClass) {\n    var _discoverParams;\n\n    extend(DiscoverProjectsService, superClass);\n\n    DiscoverProjectsService.$inject = [\"tgResources\", \"tgProjectsService\"];\n\n    _discoverParams = {\n      discover_mode: true\n    };\n\n    function DiscoverProjectsService(rs, projectsService) {\n      this.rs = rs;\n      this.projectsService = projectsService;\n      this._mostLiked = Immutable.List();\n      this._mostActive = Immutable.List();\n      this._featured = Immutable.List();\n      this._searchResult = Immutable.List();\n      this._projectsCount = 0;\n      this.decorate = this.projectsService._decorate.bind(this.projectsService);\n      taiga.defineImmutableProperty(this, \"mostLiked\", (function(_this) {\n        return function() {\n          return _this._mostLiked;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"mostActive\", (function(_this) {\n        return function() {\n          return _this._mostActive;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this._featured;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this._searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this._nextSearchPage;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsCount\", (function(_this) {\n        return function() {\n          return _this._projectsCount;\n        };\n      })(this));\n    }\n\n    DiscoverProjectsService.prototype.fetchMostLiked = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostLiked = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchMostActive = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostActive = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchFeatured = function() {\n      var _params;\n      _params = _.extend({}, _discoverParams);\n      _params.is_featured = true;\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 4);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._featured = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.resetSearchList = function() {\n      return this._searchResult = Immutable.List();\n    };\n\n    DiscoverProjectsService.prototype.fetchStats = function() {\n      return this.rs.stats.discover().then((function(_this) {\n        return function(discover) {\n          return _this._projectsCount = discover.getIn(['projects', 'total']);\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchSearch = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params).then((function(_this) {\n        return function(result) {\n          var projects;\n          _this._nextSearchPage = !!result.headers('X-Pagination-Next');\n          projects = Immutable.fromJS(result.data);\n          projects = projects.map(_this.decorate);\n          return _this._searchResult = _this._searchResult.concat(projects);\n        };\n      })(this));\n    };\n\n    return DiscoverProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaDiscover\").service(\"tgDiscoverProjectsService\", DiscoverProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.controller.coffee\n */\n\n(function() {\n  var ExternalAppController, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ExternalAppController = (function(superClass) {\n    extend(ExternalAppController, superClass);\n\n    ExternalAppController.$inject = [\"$routeParams\", \"tgExternalAppsService\", \"$window\", \"tgCurrentUserService\", \"$location\", \"$tgNavUrls\", \"tgXhrErrorService\", \"tgLoader\"];\n\n    function ExternalAppController(routeParams, externalAppsService, window, currentUserService, location, navUrls, xhrError, loader) {\n      var loginUrl, nextUrl;\n      this.routeParams = routeParams;\n      this.externalAppsService = externalAppsService;\n      this.window = window;\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.xhrError = xhrError;\n      this.loader = loader;\n      this.createApplicationToken = bind(this.createApplicationToken, this);\n      this._getApplicationToken = bind(this._getApplicationToken, this);\n      this._redirect = bind(this._redirect, this);\n      this.loader.start(false);\n      this._applicationId = this.routeParams.application;\n      this._state = this.routeParams.state;\n      this._getApplicationToken();\n      this._user = this.currentUserService.getUser();\n      this._application = null;\n      nextUrl = encodeURIComponent(this.location.url());\n      loginUrl = this.navUrls.resolve(\"login\");\n      this.loginWithAnotherUserUrl = loginUrl + \"?next=\" + nextUrl;\n      taiga.defineImmutableProperty(this, \"user\", (function(_this) {\n        return function() {\n          return _this._user;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"application\", (function(_this) {\n        return function() {\n          return _this._application;\n        };\n      })(this));\n    }\n\n    ExternalAppController.prototype._redirect = function(applicationToken) {\n      var nextUrl;\n      nextUrl = applicationToken.get(\"next_url\");\n      return this.window.open(nextUrl, \"_self\");\n    };\n\n    ExternalAppController.prototype._getApplicationToken = function() {\n      return this.externalAppsService.getApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          _this._application = data.get(\"application\");\n          if (data.get(\"auth_code\")) {\n            return _this._redirect(data);\n          } else {\n            return _this.loader.pageLoaded();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          _this.loader.pageLoaded();\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    ExternalAppController.prototype.cancel = function() {\n      return this.window.history.back();\n    };\n\n    ExternalAppController.prototype.createApplicationToken = function() {\n      return this.externalAppsService.authorizeApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          return _this._redirect(data);\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    return ExternalAppController;\n\n  })(taiga.Controller);\n\n  angular.module(\"taigaExternalApps\").controller(\"ExternalApp\", ExternalAppController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.service.coffee\n */\n\n(function() {\n  var ExternalAppsService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ExternalAppsService = (function(superClass) {\n    extend(ExternalAppsService, superClass);\n\n    ExternalAppsService.$inject = [\"tgResources\"];\n\n    function ExternalAppsService(rs) {\n      this.rs = rs;\n    }\n\n    ExternalAppsService.prototype.getApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.getApplicationToken(applicationId, state);\n    };\n\n    ExternalAppsService.prototype.authorizeApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.authorizeApplicationToken(applicationId, state);\n    };\n\n    return ExternalAppsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaExternalApps\").service(\"tgExternalAppsService\", ExternalAppsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: feedback.service.coffee\n */\n\n(function() {\n  var FeedbackService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FeedbackService = (function(superClass) {\n    extend(FeedbackService, superClass);\n\n    FeedbackService.$inject = [\"tgLightboxFactory\"];\n\n    function FeedbackService(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    FeedbackService.prototype.sendFeedback = function() {\n      return this.lightboxFactory.create(\"tg-lb-feedback\", {\n        \"class\": \"lightbox lightbox-feedback lightbox-generic-form\"\n      });\n    };\n\n    return FeedbackService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaFeedback\").service(\"tgFeedbackService\", FeedbackService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duty.directive.coffee\n */\n\n(function() {\n  var DutyDirective;\n\n  DutyDirective = function(navurls, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.duty = scope.duty;\n      return scope.vm.getDutyType = function() {\n        if (scope.vm.duty) {\n          if (scope.vm.duty.get('_name') === \"userstories\") {\n            return $translate.instant(\"COMMON.USER_STORY\");\n          }\n          if (scope.vm.duty.get('_name') === \"tasks\") {\n            return $translate.instant(\"COMMON.TASK\");\n          }\n          if (scope.vm.duty.get('_name') === \"issues\") {\n            return $translate.instant(\"COMMON.ISSUE\");\n          }\n        }\n      };\n    };\n    return {\n      templateUrl: \"home/duties/duty.html\",\n      scope: {\n        \"duty\": \"=tgDuty\"\n      },\n      link: link\n    };\n  };\n\n  DutyDirective.$inject = [\"$tgNavUrls\", \"$translate\"];\n\n  angular.module(\"taigaHome\").directive(\"tgDuty\", DutyDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.controller.coffee\n */\n\n(function() {\n  var HomeController;\n\n  HomeController = (function() {\n    HomeController.$inject = [\"tgCurrentUserService\", \"$location\", \"$tgNavUrls\"];\n\n    function HomeController(currentUserService, location, navUrls) {\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      if (!this.currentUserService.getUser()) {\n        this.location.path(this.navUrls.resolve(\"discover\"));\n      }\n    }\n\n    return HomeController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"Home\", HomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var HomeService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  HomeService = (function(superClass) {\n    extend(HomeService, superClass);\n\n    HomeService.$inject = [\"$tgNavUrls\", \"tgResources\", \"tgProjectsService\"];\n\n    function HomeService(navurls, rs, projectsService) {\n      this.navurls = navurls;\n      this.rs = rs;\n      this.projectsService = projectsService;\n    }\n\n    HomeService.prototype._attachProjectInfoToWorkInProgress = function(workInProgress, projectsById) {\n      var _attachProjectInfoToDuty, _duties, assignedTo, watching;\n      _attachProjectInfoToDuty = (function(_this) {\n        return function(duty, objType) {\n          var ctx, project, url;\n          project = projectsById.get(String(duty.get('project')));\n          ctx = {\n            project: project.get('slug'),\n            ref: duty.get('ref')\n          };\n          url = _this.navurls.resolve(\"project-\" + objType + \"-detail\", ctx);\n          duty = duty.set('url', url);\n          duty = duty.set('projectName', project.get('name'));\n          duty = duty.set(\"_name\", objType);\n          return duty;\n        };\n      })(this);\n      assignedTo = workInProgress.get(\"assignedTo\");\n      if (assignedTo.get(\"userStories\")) {\n        _duties = assignedTo.get(\"userStories\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"userstories\");\n        });\n        assignedTo = assignedTo.set(\"userStories\", _duties);\n      }\n      if (assignedTo.get(\"tasks\")) {\n        _duties = assignedTo.get(\"tasks\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"tasks\");\n        });\n        assignedTo = assignedTo.set(\"tasks\", _duties);\n      }\n      if (assignedTo.get(\"issues\")) {\n        _duties = assignedTo.get(\"issues\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"issues\");\n        });\n        assignedTo = assignedTo.set(\"issues\", _duties);\n      }\n      watching = workInProgress.get(\"watching\");\n      if (watching.get(\"userStories\")) {\n        _duties = watching.get(\"userStories\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"userstories\");\n        });\n        watching = watching.set(\"userStories\", _duties);\n      }\n      if (watching.get(\"tasks\")) {\n        _duties = watching.get(\"tasks\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"tasks\");\n        });\n        watching = watching.set(\"tasks\", _duties);\n      }\n      if (watching.get(\"issues\")) {\n        _duties = watching.get(\"issues\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"issues\");\n        });\n        watching = watching.set(\"issues\", _duties);\n      }\n      workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n      return workInProgress = workInProgress.set(\"watching\", watching);\n    };\n\n    HomeService.prototype.getWorkInProgress = function(userId) {\n      var assignedIssuesPromise, assignedTasksPromise, assignedTo, assignedUserStoriesPromise, params, params_us, projectsById, projectsPromise, watching, watchingIssuesPromise, watchingTasksPromise, watchingUserStoriesPromise, workInProgress;\n      projectsById = Immutable.Map();\n      projectsPromise = this.projectsService.getProjectsByUserId(userId).then(function(projects) {\n        return projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n          return p.id;\n        }));\n      });\n      assignedTo = Immutable.Map();\n      params = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_us = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      assignedUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return assignedTo = assignedTo.set(\"userStories\", userstories);\n      });\n      assignedTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return assignedTo = assignedTo.set(\"tasks\", tasks);\n      });\n      assignedIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return assignedTo = assignedTo.set(\"issues\", issues);\n      });\n      params = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_us = {\n        is_closed: false,\n        watchers: userId\n      };\n      watching = Immutable.Map();\n      watchingUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return watching = watching.set(\"userStories\", userstories);\n      });\n      watchingTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return watching = watching.set(\"tasks\", tasks);\n      });\n      watchingIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return watching = watching.set(\"issues\", issues);\n      });\n      workInProgress = Immutable.Map();\n      return Promise.all([projectsPromise, assignedUserStoriesPromise, assignedTasksPromise, assignedIssuesPromise, watchingUserStoriesPromise, watchingTasksPromise, watchingIssuesPromise]).then((function(_this) {\n        return function() {\n          workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n          workInProgress = workInProgress.set(\"watching\", watching);\n          workInProgress = _this._attachProjectInfoToWorkInProgress(workInProgress, projectsById);\n          return workInProgress;\n        };\n      })(this));\n    };\n\n    return HomeService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaHome\").service(\"tgHomeService\", HomeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home-project-list.directive.coffee\n */\n\n(function() {\n  var HomeProjectListDirective;\n\n  HomeProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"home/projects/home-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  HomeProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgHomeProjectList\", HomeProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var WorkingOnController;\n\n  WorkingOnController = (function() {\n    WorkingOnController.$inject = [\"tgHomeService\"];\n\n    function WorkingOnController(homeService) {\n      this.homeService = homeService;\n      this.assignedTo = Immutable.Map();\n      this.watching = Immutable.Map();\n    }\n\n    WorkingOnController.prototype._setAssignedTo = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"assignedTo\").get(\"userStories\");\n      tasks = workInProgress.get(\"assignedTo\").get(\"tasks\");\n      issues = workInProgress.get(\"assignedTo\").get(\"issues\");\n      this.assignedTo = userStories.concat(tasks).concat(issues);\n      if (this.assignedTo.size > 0) {\n        return this.assignedTo = this.assignedTo.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype._setWatching = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"watching\").get(\"userStories\");\n      tasks = workInProgress.get(\"watching\").get(\"tasks\");\n      issues = workInProgress.get(\"watching\").get(\"issues\");\n      this.watching = userStories.concat(tasks).concat(issues);\n      if (this.watching.size > 0) {\n        return this.watching = this.watching.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype.getWorkInProgress = function(userId) {\n      return this.homeService.getWorkInProgress(userId).then((function(_this) {\n        return function(workInProgress) {\n          _this._setAssignedTo(workInProgress);\n          return _this._setWatching(workInProgress);\n        };\n      })(this));\n    };\n\n    return WorkingOnController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"WorkingOn\", WorkingOnController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.directive.coffee\n */\n\n(function() {\n  var WorkingOnDirective;\n\n  WorkingOnDirective = function(homeService, currentUserService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var user, userId;\n      user = currentUserService.getUser();\n      if (user) {\n        userId = user.get(\"id\");\n        return ctrl.getWorkInProgress(userId);\n      }\n    };\n    return {\n      controller: \"WorkingOn\",\n      controllerAs: \"vm\",\n      templateUrl: \"home/working-on/working-on.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  WorkingOnDirective.$inject = [\"tgHomeService\", \"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgWorkingOn\", WorkingOnDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-project-list.directive.coffee\n */\n\n(function() {\n  var DropdownProjectListDirective;\n\n  DropdownProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-project-list/dropdown-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownProjectList\", DropdownProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-user.directive.coffee\n */\n\n(function() {\n  var DropdownUserDirective;\n\n  DropdownUserDirective = function(authService, configService, locationService, navUrlsService, feedbackService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.isFeedbackEnabled = configService.get(\"feedbackEnabled\");\n      taiga.defineImmutableProperty(scope.vm, \"user\", function() {\n        return authService.userData;\n      });\n      scope.vm.logout = function() {\n        authService.logout();\n        locationService.url(navUrlsService.resolve(\"discover\"));\n        return locationService.search({});\n      };\n      return scope.vm.sendFeedback = function() {\n        return feedbackService.sendFeedback();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-user/dropdown-user.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownUserDirective.$inject = [\"$tgAuth\", \"$tgConfig\", \"$tgLocation\", \"$tgNavUrls\", \"tgFeedbackService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownUser\", DropdownUserDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.directive.coffee\n */\n\n(function() {\n  var NavigationBarDirective;\n\n  NavigationBarDirective = function(currentUserService, navigationBarService, locationService, navUrlsService, config) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isAuthenticated\", function() {\n        return currentUserService.isAuthenticated();\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isEnabledHeader\", function() {\n        return navigationBarService.isEnabledHeader();\n      });\n      scope.vm.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      scope.vm.login = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"login\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      scope.vm.register = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"register\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      return scope.$on(\"$routeChangeSuccess\", function() {\n        if (locationService.path() === \"/\") {\n          return scope.vm.active = true;\n        } else {\n          return scope.vm.active = false;\n        }\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/navigation-bar.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  NavigationBarDirective.$inject = [\"tgCurrentUserService\", \"tgNavigationBarService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgNavigationBar\", NavigationBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.service.coffee\n */\n\n(function() {\n  var NavigationBarService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  NavigationBarService = (function(superClass) {\n    extend(NavigationBarService, superClass);\n\n    function NavigationBarService() {\n      this.disableHeader();\n    }\n\n    NavigationBarService.prototype.enableHeader = function() {\n      return this.enabledHeader = true;\n    };\n\n    NavigationBarService.prototype.disableHeader = function() {\n      return this.enabledHeader = false;\n    };\n\n    NavigationBarService.prototype.isEnabledHeader = function() {\n      return this.enabledHeader;\n    };\n\n    return NavigationBarService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaNavigationBar\").service(\"tgNavigationBarService\", NavigationBarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.controller.coffee\n */\n\n(function() {\n  var ProfileBarController;\n\n  ProfileBarController = (function() {\n    ProfileBarController.$inject = [\"tgUserService\"];\n\n    function ProfileBarController(userService) {\n      this.userService = userService;\n      this.loadStats();\n    }\n\n    ProfileBarController.prototype.loadStats = function() {\n      return this.userService.getStats(this.user.get(\"id\")).then((function(_this) {\n        return function(stats) {\n          return _this.stats = stats;\n        };\n      })(this));\n    };\n\n    return ProfileBarController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileBar\", ProfileBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.directive.coffee\n */\n\n(function() {\n  var ProfileBarDirective;\n\n  ProfileBarDirective = function() {\n    return {\n      templateUrl: \"profile/profile-bar/profile-bar.html\",\n      controller: \"ProfileBar\",\n      controllerAs: \"vm\",\n      scope: {\n        user: \"=user\",\n        isCurrentUser: \"=iscurrentuser\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileBar\", ProfileBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.controller.coffee\n */\n\n(function() {\n  var ProfileContactsController;\n\n  ProfileContactsController = (function() {\n    ProfileContactsController.$inject = [\"tgUserService\", \"tgCurrentUserService\"];\n\n    function ProfileContactsController(userService, currentUserService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.currentUser = this.currentUserService.getUser();\n      this.isCurrentUser = false;\n      if (this.currentUser && this.currentUser.get(\"id\") === this.user.get(\"id\")) {\n        this.isCurrentUser = true;\n      }\n    }\n\n    ProfileContactsController.prototype.loadContacts = function() {\n      return this.userService.getContacts(this.user.get(\"id\")).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    return ProfileContactsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileContacts\", ProfileContactsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.directive.coffee\n */\n\n(function() {\n  var ProfileContactsDirective;\n\n  ProfileContactsDirective = function() {\n    var link;\n    link = function(scope, elm, attrs, ctrl) {\n      return ctrl.loadContacts();\n    };\n    return {\n      templateUrl: \"profile/profile-contacts/profile-contacts.html\",\n      scope: {\n        user: \"=\"\n      },\n      controllerAs: \"vm\",\n      controller: \"ProfileContacts\",\n      link: link,\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileContacts\", ProfileContactsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: items.directive.coffee\n */\n\n(function() {\n  var FavItemDirective;\n\n  FavItemDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.vm = {\n        item: scope.item\n      };\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.itemType === \"project\") {\n        return \"profile/profile-favs/items/project.html\";\n      } else {\n        return \"profile/profile-favs/items/ticket.html\";\n      }\n    };\n    return {\n      scope: {\n        \"item\": \"=tgFavItem\"\n      },\n      link: link,\n      templateUrl: templateUrl\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgFavItem\", FavItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.controller.coffee\n */\n\n(function() {\n  var FavsBaseController, ProfileLikedController, ProfileVotedController, ProfileWatchedController, debounceLeading,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  FavsBaseController = (function() {\n    function FavsBaseController() {\n      this._init();\n    }\n\n    FavsBaseController.prototype._init = function() {\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._resetList();\n      this.q = null;\n      return this.type = null;\n    };\n\n    FavsBaseController.prototype._resetList = function() {\n      this.items = Immutable.List();\n      this.scrollDisabled = false;\n      return this._page = 1;\n    };\n\n    FavsBaseController.prototype._enableLoadingSpinner = function() {\n      return this.isLoading = true;\n    };\n\n    FavsBaseController.prototype._disableLoadingSpinner = function() {\n      return this.isLoading = false;\n    };\n\n    FavsBaseController.prototype._enableScroll = function() {\n      return this.scrollDisabled = false;\n    };\n\n    FavsBaseController.prototype._disableScroll = function() {\n      return this.scrollDisabled = true;\n    };\n\n    FavsBaseController.prototype._checkIfHasMorePages = function(hasNext) {\n      if (hasNext) {\n        this._page += 1;\n        return this._enableScroll();\n      } else {\n        return this._disableScroll();\n      }\n    };\n\n    FavsBaseController.prototype._checkIfHasNoResults = function() {\n      return this.hasNoResults = this.items.size === 0;\n    };\n\n    FavsBaseController.prototype.loadItems = function() {\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      return this._getItems(this.user.get(\"id\"), this._page, this.type, this.q).then((function(_this) {\n        return function(response) {\n          _this.items = _this.items.concat(response.get(\"data\"));\n          _this._checkIfHasMorePages(response.get(\"next\"));\n          _this._checkIfHasNoResults();\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this));\n    };\n\n    FavsBaseController.prototype.filterByTextQuery = debounceLeading(500, function() {\n      this._resetList();\n      return this.loadItems();\n    });\n\n    FavsBaseController.prototype.showAll = function() {\n      if (this.type !== null) {\n        this.type = null;\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showProjectsOnly = function() {\n      if (this.type !== \"project\") {\n        this.type = \"project\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showUserStoriesOnly = function() {\n      if (this.type !== \"userstory\") {\n        this.type = \"userstory\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showTasksOnly = function() {\n      if (this.type !== \"task\") {\n        this.type = \"task\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showIssuesOnly = function() {\n      if (this.type !== \"issue\") {\n        this.type = \"issue\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    return FavsBaseController;\n\n  })();\n\n  ProfileLikedController = (function(superClass) {\n    extend(ProfileLikedController, superClass);\n\n    ProfileLikedController.$inject = [\"tgUserService\"];\n\n    function ProfileLikedController(userService) {\n      this.userService = userService;\n      ProfileLikedController.__super__.constructor.call(this);\n      this.enableFilterByAll = false;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = false;\n      this.enableFilterByTasks = false;\n      this.enableFilterByIssues = false;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getLiked;\n    }\n\n    return ProfileLikedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileLiked\", ProfileLikedController);\n\n  ProfileVotedController = (function(superClass) {\n    extend(ProfileVotedController, superClass);\n\n    ProfileVotedController.$inject = [\"tgUserService\"];\n\n    function ProfileVotedController(userService) {\n      this.userService = userService;\n      ProfileVotedController.__super__.constructor.call(this);\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getVoted;\n    }\n\n    return ProfileVotedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileVoted\", ProfileVotedController);\n\n  ProfileWatchedController = (function(superClass) {\n    extend(ProfileWatchedController, superClass);\n\n    ProfileWatchedController.$inject = [\"tgUserService\"];\n\n    function ProfileWatchedController(userService) {\n      this.userService = userService;\n      ProfileWatchedController.__super__.constructor.call(this);\n      this._getItems = this.userService.getWatched;\n    }\n\n    return ProfileWatchedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWatched\", ProfileWatchedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.directive.coffee\n */\n\n(function() {\n  var ProfileLikedDirective, ProfileVotedDirective, ProfileWatchedDirective, base;\n\n  base = {\n    scope: {},\n    bindToController: {\n      user: \"=\",\n      type: \"@\",\n      q: \"@\",\n      scrollDisabled: \"@\",\n      isLoading: \"@\",\n      hasNoResults: \"@\"\n    },\n    controller: null,\n    controllerAs: \"vm\",\n    templateUrl: \"profile/profile-favs/profile-favs.html\"\n  };\n\n  ProfileLikedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileLiked\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileLiked\", ProfileLikedDirective);\n\n  ProfileVotedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileVoted\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileVoted\", ProfileVotedDirective);\n\n  ProfileWatchedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileWatched\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWatched\", ProfileWatchedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.controller.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = (function() {\n    ProfileHints.prototype.HINTS = [\n      {\n        url: \"https://taiga.io/support/import-export-projects/\"\n      }, {\n        url: \"https://taiga.io/support/custom-fields/\"\n      }, {}, {}\n    ];\n\n    function ProfileHints(translate) {\n      var hintKey;\n      this.translate = translate;\n      hintKey = Math.floor(Math.random() * this.HINTS.length) + 1;\n      this.hint = this.HINTS[hintKey - 1];\n      this.hint.linkText = this.hint.linkText || 'HINTS.LINK';\n      this.hint.title = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TITLE\");\n      this.hint.text = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TEXT\");\n    }\n\n    return ProfileHints;\n\n  })();\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").controller(\"ProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.directive.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = function($translate) {\n    return {\n      scope: {},\n      controller: \"ProfileHints\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-hints/profile-hints.html\"\n    };\n  };\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.controller.coffee\n */\n\n(function() {\n  var ProfileProjectsController;\n\n  ProfileProjectsController = (function() {\n    ProfileProjectsController.$inject = [\"tgProjectsService\", \"tgUserService\"];\n\n    function ProfileProjectsController(projectsService, userService) {\n      this.projectsService = projectsService;\n      this.userService = userService;\n    }\n\n    ProfileProjectsController.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this.user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.userService.attachUserContactsToProjects(_this.user.get(\"id\"), projects);\n        };\n      })(this)).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    return ProfileProjectsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileProjects\", ProfileProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.directive.coffee\n */\n\n(function() {\n  var ProfileProjectsDirective;\n\n  ProfileProjectsDirective = function() {\n    var link;\n    link = function(scope, elm, attr, ctrl) {\n      return ctrl.loadProjects();\n    };\n    return {\n      templateUrl: \"profile/profile-projects/profile-projects.html\",\n      scope: {\n        user: \"=\"\n      },\n      link: link,\n      bindToController: true,\n      controllerAs: \"vm\",\n      controller: \"ProfileProjects\"\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileProjects\", ProfileProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tab.directive.coffee\n */\n\n(function() {\n  var ProfileTabDirective;\n\n  ProfileTabDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl, transclude) {\n      scope.tab = {};\n      attrs.$observe(\"tgProfileTab\", function(name) {\n        return scope.tab.name = name;\n      });\n      attrs.$observe(\"tabTitle\", function(title) {\n        return scope.tab.title = title;\n      });\n      scope.tab.icon = attrs.tabIcon;\n      scope.tab.active = !!attrs.tabActive;\n      if (scope.$eval(attrs.tabDisabled) !== true) {\n        return ctrl.addTab(scope.tab);\n      }\n    };\n    return {\n      templateUrl: \"profile/profile-tab/profile-tab.html\",\n      scope: {},\n      require: \"^tgProfileTabs\",\n      link: link,\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTab\", ProfileTabDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.controller.coffee\n */\n\n(function() {\n  var ProfileTabsController;\n\n  ProfileTabsController = (function() {\n    function ProfileTabsController() {\n      this.tabs = [];\n    }\n\n    ProfileTabsController.prototype.addTab = function(tab) {\n      return this.tabs.push(tab);\n    };\n\n    ProfileTabsController.prototype.toggleTab = function(tab) {\n      _.map(this.tabs, function(tab) {\n        return tab.active = false;\n      });\n      return tab.active = true;\n    };\n\n    return ProfileTabsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileTabs\", ProfileTabsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.directive.coffee\n */\n\n(function() {\n  var ProfileTabsDirective;\n\n  ProfileTabsDirective = function() {\n    return {\n      scope: {},\n      controller: \"ProfileTabs\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-tabs/profile-tabs.html\",\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTabs\", ProfileTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.controller.coffee\n */\n\n(function() {\n  var ProfileController;\n\n  ProfileController = (function() {\n    ProfileController.$inject = [\"tgAppMetaService\", \"tgCurrentUserService\", \"$routeParams\", \"tgUserService\", \"tgXhrErrorService\", \"$translate\"];\n\n    function ProfileController(appMetaService, currentUserService, routeParams, userService, xhrError, translate) {\n      this.appMetaService = appMetaService;\n      this.currentUserService = currentUserService;\n      this.routeParams = routeParams;\n      this.userService = userService;\n      this.xhrError = xhrError;\n      this.translate = translate;\n      this.isCurrentUser = false;\n      if (this.routeParams.slug) {\n        this.userService.getUserByUserName(this.routeParams.slug).then((function(_this) {\n          return function(user) {\n            if (!user.get('is_active')) {\n              return _this.xhrError.notFound();\n            } else {\n              _this.user = user;\n              _this.isCurrentUser = false;\n              _this._setMeta(_this.user);\n              return user;\n            }\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function(xhr) {\n            return _this.xhrError.response(xhr);\n          };\n        })(this));\n      } else {\n        this.user = this.currentUserService.getUser();\n        this.isCurrentUser = true;\n        this._setMeta(this.user);\n      }\n    }\n\n    ProfileController.prototype._setMeta = function(user) {\n      var ctx, description, title;\n      ctx = {\n        userFullName: user.get(\"full_name_display\"),\n        userUsername: user.get(\"username\")\n      };\n      title = this.translate.instant(\"USER.PROFILE.PAGE_TITLE\", ctx);\n      description = user.get(\"bio\");\n      return this.appMetaService.setAll(title, description);\n    };\n\n    return ProfileController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"Profile\", ProfileController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var LikeProjectButtonController;\n\n  LikeProjectButtonController = (function() {\n    LikeProjectButtonController.$inject = [\"$tgConfirm\", \"tgLikeProjectButtonService\"];\n\n    function LikeProjectButtonController(confirm, likeButtonService) {\n      this.confirm = confirm;\n      this.likeButtonService = likeButtonService;\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    LikeProjectButtonController.prototype.toggleLike = function() {\n      var promise;\n      this.loading = true;\n      if (!this.project.get(\"is_fan\")) {\n        promise = this._like();\n      } else {\n        promise = this._unlike();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    LikeProjectButtonController.prototype._like = function() {\n      return this.likeButtonService.like(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    LikeProjectButtonController.prototype._unlike = function() {\n      return this.likeButtonService.unlike(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"LikeProjectButton\", LikeProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.directive.coffee\n */\n\n(function() {\n  var LikeProjectButtonDirective;\n\n  LikeProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"LikeProjectButton\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/like-project-button/like-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLikeProjectButton\", LikeProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.service.coffee\n */\n\n(function() {\n  var LikeProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  LikeProjectButtonService = (function(superClass) {\n    extend(LikeProjectButtonService, superClass);\n\n    LikeProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function LikeProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    LikeProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    LikeProjectButtonService.prototype._updateProjects = function(projectId, isFan) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, function(project) {\n        var totalFans;\n        totalFans = project.get(\"total_fans\");\n        if (isFan) {\n          totalFans++;\n        } else {\n          totalFans--;\n        }\n        return project.merge({\n          is_fan: isFan,\n          total_fans: totalFans\n        });\n      });\n      return this.currentUserService.setProjects(projects);\n    };\n\n    LikeProjectButtonService.prototype._updateCurrentProject = function(isFan) {\n      var project, totalFans;\n      totalFans = this.projectService.project.get(\"total_fans\");\n      if (isFan) {\n        totalFans++;\n      } else {\n        totalFans--;\n      }\n      project = this.projectService.project.merge({\n        is_fan: isFan,\n        total_fans: totalFans\n      });\n      return this.projectService.setProject(project);\n    };\n\n    LikeProjectButtonService.prototype.like = function(projectId) {\n      return this.rs.projects.likeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, true);\n          return _this._updateCurrentProject(true);\n        };\n      })(this));\n    };\n\n    LikeProjectButtonService.prototype.unlike = function(projectId) {\n      return this.rs.projects.unlikeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, false);\n          return _this._updateCurrentProject(false);\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgLikeProjectButtonService\", LikeProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: sort-projects.directive.coffee\n */\n\n(function() {\n  var SortProjectsDirective;\n\n  SortProjectsDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      var itemEl;\n      itemEl = null;\n      el.sortable({\n        dropOnEmpty: true,\n        revert: 200,\n        axis: \"y\",\n        opacity: .95,\n        placeholder: 'placeholder',\n        cancel: '.project-name'\n      });\n      return el.on(\"sortstop\", function(event, ui) {\n        var i, index, len, project, sortData, sorted_project_ids, value;\n        itemEl = ui.item;\n        project = itemEl.scope().project;\n        index = itemEl.index();\n        sorted_project_ids = _.map(scope.projects.toJS(), function(p) {\n          return p.id;\n        });\n        sorted_project_ids = _.without(sorted_project_ids, project.get(\"id\"));\n        sorted_project_ids.splice(index, 0, project.get('id'));\n        sortData = [];\n        for (index = i = 0, len = sorted_project_ids.length; i < len; index = ++i) {\n          value = sorted_project_ids[index];\n          sortData.push({\n            \"project_id\": value,\n            \"order\": index\n          });\n        }\n        return currentUserService.bulkUpdateProjectsOrder(sortData);\n      });\n    };\n    directive = {\n      scope: {\n        projects: \"=tgSortProjects\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgSortProjects\", [\"tgCurrentUserService\", SortProjectsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.controller.coffee\n */\n\n(function() {\n  var WatchProjectButtonController;\n\n  WatchProjectButtonController = (function() {\n    WatchProjectButtonController.$inject = [\"$tgConfirm\", \"tgWatchProjectButtonService\"];\n\n    function WatchProjectButtonController(confirm, watchButtonService) {\n      this.confirm = confirm;\n      this.watchButtonService = watchButtonService;\n      this.showWatchOptions = false;\n      this.loading = false;\n    }\n\n    WatchProjectButtonController.prototype.toggleWatcherOptions = function() {\n      return this.showWatchOptions = !this.showWatchOptions;\n    };\n\n    WatchProjectButtonController.prototype.closeWatcherOptions = function() {\n      return this.showWatchOptions = false;\n    };\n\n    WatchProjectButtonController.prototype.watch = function(notifyLevel) {\n      if (notifyLevel === this.project.get('notify_level')) {\n        return;\n      }\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.watch(this.project.get('id'), notifyLevel)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    WatchProjectButtonController.prototype.unwatch = function() {\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.unwatch(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"WatchProjectButton\", WatchProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.directive.coffee\n */\n\n(function() {\n  var WatchProjectButtonDirective;\n\n  WatchProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchProjectButton\",\n      bindToController: {\n        project: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/watch-project-button/watch-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgWatchProjectButton\", WatchProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.service.coffee\n */\n\n(function() {\n  var WatchProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  WatchProjectButtonService = (function(superClass) {\n    extend(WatchProjectButtonService, superClass);\n\n    WatchProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function WatchProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    WatchProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    WatchProjectButtonService.prototype._updateProjects = function(projectId, notifyLevel, isWatcher) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, (function(_this) {\n        return function(project) {\n          var totalWatchers;\n          totalWatchers = project.get('total_watchers');\n          if (!_this.projectService.project.get('is_watcher') && isWatcher) {\n            totalWatchers++;\n          } else if (_this.projectService.project.get('is_watcher') && !isWatcher) {\n            totalWatchers--;\n          }\n          return project.merge({\n            is_watcher: isWatcher,\n            total_watchers: totalWatchers,\n            notify_level: notifyLevel\n          });\n        };\n      })(this));\n      return this.currentUserService.setProjects(projects);\n    };\n\n    WatchProjectButtonService.prototype._updateCurrentProject = function(notifyLevel, isWatcher) {\n      var project, totalWatchers;\n      totalWatchers = this.projectService.project.get(\"total_watchers\");\n      if (!this.projectService.project.get('is_watcher') && isWatcher) {\n        totalWatchers++;\n      } else if (this.projectService.project.get('is_watcher') && !isWatcher) {\n        totalWatchers--;\n      }\n      project = this.projectService.project.merge({\n        is_watcher: isWatcher,\n        notify_level: notifyLevel,\n        total_watchers: totalWatchers\n      });\n      return this.projectService.setProject(project);\n    };\n\n    WatchProjectButtonService.prototype.watch = function(projectId, notifyLevel) {\n      return this.rs.projects.watchProject(projectId, notifyLevel).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, notifyLevel, true);\n          return _this._updateCurrentProject(notifyLevel, true);\n        };\n      })(this));\n    };\n\n    WatchProjectButtonService.prototype.unwatch = function(projectId) {\n      return this.rs.projects.unwatchProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, null, false);\n          return _this._updateCurrentProject(null, false);\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgWatchProjectButtonService\", WatchProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-listing.controller.coffee\n */\n\n(function() {\n  var ProjectsListingController;\n\n  ProjectsListingController = (function() {\n    ProjectsListingController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n    function ProjectsListingController(currentUserService, projectsService) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n    }\n\n    ProjectsListingController.prototype.newProject = function() {\n      return this.projectsService.newProject();\n    };\n\n    return ProjectsListingController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ProjectsListing\", ProjectsListingController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var ProjectController;\n\n  ProjectController = (function() {\n    ProjectController.$inject = [\"$routeParams\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectController(routeParams, appMetaService, auth, translate, projectService) {\n      var projectSlug;\n      this.routeParams = routeParams;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      projectSlug = this.routeParams.pslug;\n      this.user = this.auth.userData;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"members\", (function(_this) {\n        return function() {\n          return _this.projectService.activeMembers;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    ProjectController.prototype._setMeta = function(project) {\n      var ctx, metas;\n      if (!this.project) {\n        return null;\n      }\n      metas = {};\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      metas.title = this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx);\n      metas.description = this.project.get(\"description\");\n      return metas;\n    };\n\n    return ProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"Project\", ProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.service.coffee\n */\n\n(function() {\n  var ProjectsService, groupBy, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  ProjectsService = (function(superClass) {\n    extend(ProjectsService, superClass);\n\n    ProjectsService.$inject = [\"tgResources\", \"$projectUrl\", \"tgLightboxFactory\"];\n\n    function ProjectsService(rs, projectUrl, lightboxFactory) {\n      this.rs = rs;\n      this.projectUrl = projectUrl;\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    ProjectsService.prototype.getProjectBySlug = function(projectSlug) {\n      return this.rs.projects.getProjectBySlug(projectSlug).then((function(_this) {\n        return function(project) {\n          return _this._decorate(project);\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype.getProjectStats = function(projectId) {\n      return this.rs.projects.getProjectStats(projectId);\n    };\n\n    ProjectsService.prototype.getProjectsByUserId = function(userId, paginate) {\n      return this.rs.projects.getProjectsByUserId(userId, paginate).then((function(_this) {\n        return function(projects) {\n          return projects.map(_this._decorate.bind(_this));\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype._decorate = function(project) {\n      var colorized_tags, tags, url;\n      url = this.projectUrl.get(project.toJS());\n      project = project.set(\"url\", url);\n      colorized_tags = [];\n      if (project.get(\"tags\")) {\n        tags = project.get(\"tags\").sort();\n        colorized_tags = tags.map(function(tag) {\n          var color;\n          color = project.get(\"tags_colors\").get(tag);\n          return Immutable.fromJS({\n            name: tag,\n            color: color\n          });\n        });\n        project = project.set(\"colorized_tags\", colorized_tags);\n      }\n      return project;\n    };\n\n    ProjectsService.prototype.newProject = function() {\n      return this.lightboxFactory.create(\"tg-lb-create-project\", {\n        \"class\": \"wizard-create-project\"\n      });\n    };\n\n    ProjectsService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.rs.projects.bulkUpdateOrder(sortData);\n    };\n\n    return ProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgProjectsService\", ProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  Resource = function(urlsService, http, config, $rootScope, $q, storage) {\n    var service;\n    service = {};\n    service.list = function(type, objectId, projectId) {\n      var httpOptions, params, url, urlname;\n      urlname = \"attachments/\" + type;\n      params = {\n        object_id: objectId,\n        project: projectId\n      };\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      url = urlsService.resolve(urlname);\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service[\"delete\"] = function(type, id) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http[\"delete\"](url);\n    };\n    service.patch = function(type, id, patch) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http.patch(url, patch);\n    };\n    service.create = function(type, projectId, objectId, file) {\n      var data, defered, maxFileSize, response, token, uploadComplete, uploadFailed, uploadProgress, url, urlname, xhr;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname);\n      defered = $q.defer();\n      if (file === void 0) {\n        defered.reject(null);\n        return defered.promise;\n      }\n      maxFileSize = config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"in-progress\";\n            file.size = sizeFormat(evt.total);\n            file.progressMessage = \"upload \" + (sizeFormat(evt.loaded)) + \" of \" + (sizeFormat(evt.total));\n            return file.progressPercent = (Math.round((evt.loaded / evt.total) * 100)) + \"%\";\n          });\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            var attachment, error, ref, status;\n            file.status = \"done\";\n            status = evt.target.status;\n            try {\n              attachment = JSON.parse(evt.target.responseText);\n            } catch (error) {\n              attachment = {};\n            }\n            if (status >= 200 && status < 400) {\n              attachment = Immutable.fromJS(attachment);\n              return defered.resolve(attachment);\n            } else {\n              response = {\n                status: status,\n                data: {\n                  _error_message: (ref = data['attached_file']) != null ? ref[0] : void 0\n                }\n              };\n              return defered.reject(response);\n            }\n          });\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"error\";\n            return defered.reject(\"fail\");\n          });\n        };\n      })(this);\n      data = new FormData();\n      data.append(\"project\", projectId);\n      data.append(\"object_id\", objectId);\n      data.append(\"attached_file\", file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.addEventListener(\"load\", uploadComplete, false);\n      xhr.addEventListener(\"error\", uploadFailed, false);\n      token = storage.get('token');\n      xhr.open(\"POST\", url);\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function() {\n      return {\n        \"attachments\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"$tgConfig\", \"$rootScope\", \"$q\", \"$tgStorage\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgAttachmentsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getApplicationToken = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"applications\");\n      url = url + \"/\" + applicationId + \"/token?state=\" + state;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.authorizeApplicationToken = function(applicationId, state) {\n      var data, url;\n      url = urlsService.resolve(\"application-tokens\");\n      url = url + \"/authorize\";\n      data = {\n        \"state\": state,\n        \"application\": applicationId\n      };\n      return http.post(url, data).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"externalapps\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgExternalAppsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: issues-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"issues\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"issues\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgIssuesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, pagination;\n\n  pagination = function() {};\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getProjects = function(params, pagination) {\n      var httpOptions, url;\n      if (params == null) {\n        params = {};\n      }\n      if (pagination == null) {\n        pagination = true;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!pagination) {\n        httpOptions = {\n          headers: {\n            \"x-lazy-pagination\": true\n          }\n        };\n      }\n      return http.get(url, params, httpOptions);\n    };\n    service.getProjectBySlug = function(projectSlug) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/by_slug?slug=\" + projectSlug;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectsByUserId = function(userId, paginate) {\n      var httpOptions, params, url;\n      if (paginate == null) {\n        paginate = false;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!paginate) {\n        httpOptions.headers = {\n          \"x-disable-pagination\": \"1\"\n        };\n      }\n      params = {\n        \"member\": userId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectStats = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = urlsService.resolve(\"bulk-update-projects-order\");\n      return http.post(url, bulkData);\n    };\n    service.getTimeline = function(projectId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-project\");\n      url = url + \"/\" + projectId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.likeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-like\", projectId);\n      return http.post(url);\n    };\n    service.unlikeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unlike\", projectId);\n      return http.post(url);\n    };\n    service.watchProject = function(projectId, notifyLevel) {\n      var data, url;\n      data = {\n        notify_level: notifyLevel\n      };\n      url = urlsService.resolve(\"project-watch\", projectId);\n      return http.post(url, data);\n    };\n    service.unwatchProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unwatch\", projectId);\n      return http.post(url);\n    };\n    return function() {\n      return {\n        \"projects\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgProjectsResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.coffee\n */\n\n(function() {\n  var Resources, services;\n\n  services = [\"tgProjectsResources\", \"tgUserResources\", \"tgUsersResources\", \"tgUserstoriesResource\", \"tgTasksResource\", \"tgIssuesResource\", \"tgExternalAppsResource\", \"tgAttachmentsResource\", \"tgStatsResource\"];\n\n  Resources = function($injector) {\n    var i, j, len, len1, ref, service, serviceFn, serviceName, serviceProperty;\n    for (i = 0, len = services.length; i < len; i++) {\n      serviceName = services[i];\n      serviceFn = $injector.get(serviceName);\n      service = $injector.invoke(serviceFn);\n      ref = Object.keys(service);\n      for (j = 0, len1 = ref.length; j < len1; j++) {\n        serviceProperty = ref[j];\n        if (this[serviceProperty]) {\n          console.warm(\"repeated resource \" + serviceProperty);\n        }\n        this[serviceProperty] = service[serviceProperty];\n      }\n    }\n    return this;\n  };\n\n  Resources.$inject = [\"$injector\"];\n\n  angular.module(\"taigaResources2\").service(\"tgResources\", Resources);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: stats-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.discover = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"stats-discover\");\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"stats\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgStatsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tasks-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"tasks\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"tasks\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTasksResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserStorage = function(key) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-storage\");\n      if (key) {\n        url += '/' + key;\n      }\n      httpOptions = {};\n      return http.get(url, {}).then(function(response) {\n        return response.data.value;\n      });\n    };\n    service.setUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\") + '/' + key;\n      params = {\n        key: key,\n        value: value\n      };\n      return http.put(url, params);\n    };\n    service.createUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\");\n      params = {\n        key: key,\n        value: value\n      };\n      return http.post(url, params);\n    };\n    return function() {\n      return {\n        \"user\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: users-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserByUsername = function(username) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"by_username\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        username: username\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getStats = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-stats\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getContacts = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getLiked = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-liked\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      params.only_relevant = true;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getVoted = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-voted\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWatched = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-watched\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getProfileTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page\n      };\n      url = urlsService.resolve(\"timeline-profile\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getUserTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-user\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    return function() {\n      return {\n        \"users\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUsersResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: userstories-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"userstories\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserstoriesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app-meta.service.coffee\n */\n\n(function() {\n  var AppMetaService, taiga, truncate;\n\n  taiga = this.taiga;\n\n  truncate = taiga.truncate;\n\n  AppMetaService = (function() {\n    AppMetaService.$inject = [\"$rootScope\"];\n\n    function AppMetaService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    AppMetaService.prototype._set = function(key, value) {\n      var meta;\n      if (!key) {\n        return;\n      }\n      if (key === \"title\") {\n        meta = $(\"title\");\n        if (meta.length === 0) {\n          meta = $(\"<title></title>\");\n          $(\"head\").append(meta);\n        }\n        return meta.text(value || \"\");\n      } else if (key.indexOf(\"og:\") === 0) {\n        meta = $(\"meta[property='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta property='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      } else {\n        meta = $(\"meta[name='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta name='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      }\n    };\n\n    AppMetaService.prototype.setTitle = function(title) {\n      return this._set('title', title);\n    };\n\n    AppMetaService.prototype.setDescription = function(description) {\n      return this._set(\"description\", truncate(description, 250));\n    };\n\n    AppMetaService.prototype.setTwitterMetas = function(title, description) {\n      this._set(\"twitter:card\", \"summary\");\n      this._set(\"twitter:site\", \"@taigaio\");\n      this._set(\"twitter:title\", title);\n      this._set(\"twitter:description\", truncate(description, 300));\n      return this._set(\"twitter:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n    };\n\n    AppMetaService.prototype.setOpenGraphMetas = function(title, description) {\n      this._set(\"og:type\", \"object\");\n      this._set(\"og:site_name\", \"Taiga - Love your projects\");\n      this._set(\"og:title\", title);\n      this._set(\"og:description\", truncate(description, 300));\n      this._set(\"og:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n      return this._set(\"og:url\", window.location.href);\n    };\n\n    AppMetaService.prototype.setAll = function(title, description) {\n      this.setTitle(title);\n      this.setDescription(description);\n      this.setTwitterMetas(title, description);\n      return this.setOpenGraphMetas(title, description);\n    };\n\n    AppMetaService.prototype.addMobileViewport = function() {\n      return $(\"head\").append(\"<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\\\">\");\n    };\n\n    AppMetaService.prototype.removeMobileViewport = function() {\n      return $(\"meta[name=\\\"viewport\\\"]\").remove();\n    };\n\n    AppMetaService.prototype.setfn = function(fn) {\n      if (this.listener) {\n        this._listener();\n      }\n      return this._listener = this.rootScope.$watchCollection(fn, (function(_this) {\n        return function(metas) {\n          if (metas) {\n            _this.setAll(metas.title, metas.description);\n            return _this._listener();\n          }\n        };\n      })(this));\n    };\n\n    return AppMetaService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAppMetaService\", AppMetaService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments.service.coffee\n */\n\n(function() {\n  var AttachmentsService, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsService = (function() {\n    AttachmentsService.$inject = [\"$tgConfirm\", \"$tgConfig\", \"$translate\", \"tgResources\"];\n\n    function AttachmentsService(confirm, config, translate, rs) {\n      this.confirm = confirm;\n      this.config = config;\n      this.translate = translate;\n      this.rs = rs;\n      this.maxFileSize = this.getMaxFileSize();\n      if (this.maxFileSize) {\n        this.maxFileSizeFormated = sizeFormat(this.maxFileSize);\n      }\n    }\n\n    AttachmentsService.prototype.sizeError = function(file) {\n      var message;\n      message = this.translate.instant(\"ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED\", {\n        fileName: file.name,\n        fileSize: sizeFormat(file.size),\n        maxFileSize: this.maxFileSizeFormated\n      });\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.validate = function(file) {\n      if (this.maxFileSize && file.size > this.maxFileSize) {\n        this.sizeError(file);\n        return false;\n      }\n      return true;\n    };\n\n    AttachmentsService.prototype.getMaxFileSize = function() {\n      return this.config.get(\"maxUploadFileSize\", null);\n    };\n\n    AttachmentsService.prototype.list = function(type, objId, projectId) {\n      return this.rs.attachments.list(type, objId, projectId).then((function(_this) {\n        return function(attachments) {\n          return attachments.sortBy(function(attachment) {\n            return attachment.get('order');\n          });\n        };\n      })(this));\n    };\n\n    AttachmentsService.prototype[\"delete\"] = function(type, id) {\n      return this.rs.attachments[\"delete\"](type, id);\n    };\n\n    AttachmentsService.prototype.saveError = function(file, data) {\n      var message;\n      message = \"\";\n      if (file) {\n        message = this.translate.instant(\"ATTACHMENT.ERROR_UPLOAD_ATTACHMENT\", {\n          fileName: file.name,\n          errorMessage: data.data._error_message\n        });\n      }\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.upload = function(file, objId, projectId, type) {\n      var promise;\n      promise = this.rs.attachments.create(type, projectId, objId, file);\n      promise.then(null, this.saveError.bind(this, file));\n      return promise;\n    };\n\n    AttachmentsService.prototype.patch = function(id, type, patch) {\n      var promise;\n      promise = this.rs.attachments.patch(type, id, patch);\n      promise.then(null, this.saveError.bind(this, null));\n      return promise;\n    };\n\n    return AttachmentsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAttachmentsService\", AttachmentsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: check-permissions.service.coffee\n */\n\n(function() {\n  var ChekcPermissionsService, taiga;\n\n  taiga = this.taiga;\n\n  ChekcPermissionsService = (function() {\n    ChekcPermissionsService.$inject = [\"tgProjectService\"];\n\n    function ChekcPermissionsService(projectService) {\n      this.projectService = projectService;\n    }\n\n    ChekcPermissionsService.prototype.check = function(permission) {\n      if (!this.projectService.project) {\n        return false;\n      }\n      return this.projectService.project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    return ChekcPermissionsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCheckPermissionsService\", ChekcPermissionsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: current-user.service.coffee\n */\n\n(function() {\n  var CurrentUserService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  CurrentUserService = (function() {\n    CurrentUserService.$inject = [\"tgProjectsService\", \"$tgStorage\", \"tgResources\"];\n\n    function CurrentUserService(projectsService, storageService, rs) {\n      this.projectsService = projectsService;\n      this.storageService = storageService;\n      this.rs = rs;\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      this._joyride = null;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this._projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsById\", (function(_this) {\n        return function() {\n          return _this._projectsById;\n        };\n      })(this));\n    }\n\n    CurrentUserService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    CurrentUserService.prototype.getUser = function() {\n      var userData;\n      if (!this._user) {\n        userData = this.storageService.get(\"userInfo\");\n        if (userData) {\n          userData = Immutable.fromJS(userData);\n          this.setUser(userData);\n        }\n      }\n      return this._user;\n    };\n\n    CurrentUserService.prototype.removeUser = function() {\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      return this._joyride = null;\n    };\n\n    CurrentUserService.prototype.setUser = function(user) {\n      this._user = user;\n      return this._loadUserInfo();\n    };\n\n    CurrentUserService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.projectsService.bulkUpdateProjectsOrder(sortData).then((function(_this) {\n        return function() {\n          return _this.loadProjects();\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this._user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.setProjects(projects);\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.disableJoyRide = function(section) {\n      if (section) {\n        this._joyride[section] = false;\n      } else {\n        this._joyride = {\n          backlog: false,\n          kanban: false,\n          dashboard: false\n        };\n      }\n      return this.rs.user.setUserStorage('joyride', this._joyride);\n    };\n\n    CurrentUserService.prototype.loadJoyRideConfig = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if (_this._joyride !== null) {\n            resolve(_this._joyride);\n            return;\n          }\n          return _this.rs.user.getUserStorage('joyride').then(function(config) {\n            _this._joyride = config;\n            return resolve(_this._joyride);\n          })[\"catch\"](function() {\n            _this._joyride = {\n              backlog: true,\n              kanban: true,\n              dashboard: true\n            };\n            _this.rs.user.createUserStorage('joyride', _this._joyride);\n            return resolve(_this._joyride);\n          });\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype._loadUserInfo = function() {\n      return Promise.all([this.loadProjects()]);\n    };\n\n    CurrentUserService.prototype.setProjects = function(projects) {\n      this._projects = this._projects.set(\"all\", projects);\n      this._projects = this._projects.set(\"recents\", projects.slice(0, 10));\n      this._projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n        return p.id;\n      }));\n      return this.projects;\n    };\n\n    return CurrentUserService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCurrentUserService\", CurrentUserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lightbox-factory.service.coffee\n */\n\n(function() {\n  var LightboxFactory;\n\n  LightboxFactory = (function() {\n    LightboxFactory.$inject = [\"$rootScope\", \"$compile\"];\n\n    function LightboxFactory(rootScope, compile) {\n      this.rootScope = rootScope;\n      this.compile = compile;\n    }\n\n    LightboxFactory.prototype.create = function(name, attrs, scopeAttrs) {\n      var elm, html, scope;\n      scope = this.rootScope.$new();\n      scope = _.merge(scope, scopeAttrs);\n      elm = $(\"<div>\").attr(name, true).attr(\"tg-bind-scope\", true);\n      if (attrs) {\n        elm.attr(attrs);\n      }\n      elm.addClass(\"remove-on-close\");\n      html = this.compile(elm)(scope);\n      $(document.body).append(html);\n    };\n\n    return LightboxFactory;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgLightboxFactory\", LightboxFactory);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: paginate-response.service.coffee\n */\n\n(function() {\n  var PaginateResponse;\n\n  PaginateResponse = function() {\n    return function(result) {\n      var paginateResponse;\n      paginateResponse = Immutable.Map({\n        \"data\": result.get(\"data\"),\n        \"next\": !!result.get(\"headers\")(\"x-pagination-next\"),\n        \"prev\": !!result.get(\"headers\")(\"x-pagination-prev\"),\n        \"current\": result.get(\"headers\")(\"x-pagination-current\"),\n        \"count\": result.get(\"headers\")(\"x-pagination-count\")\n      });\n      return paginateResponse;\n    };\n  };\n\n  angular.module(\"taigaCommon\").factory(\"tgPaginateResponseService\", PaginateResponse);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo.service.coffee\n */\n\n(function() {\n  var ProjectLogoService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  ProjectLogoService = (function() {\n    function ProjectLogoService() {\n      var COLORS, IMAGES;\n      IMAGES = [\"/\" + window._version + \"/images/project-logos/project-logo-01.png\", \"/\" + window._version + \"/images/project-logos/project-logo-02.png\", \"/\" + window._version + \"/images/project-logos/project-logo-03.png\", \"/\" + window._version + \"/images/project-logos/project-logo-04.png\", \"/\" + window._version + \"/images/project-logos/project-logo-05.png\"];\n      COLORS = [\"rgba( 153,  214, 220, 1 )\", \"rgba( 213,  156,  156, 1 )\", \"rgba( 214, 161, 212,  1 )\", \"rgba( 164, 162, 219, 1 )\", \"rgba( 152, 224, 168,  1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    ProjectLogoService.prototype.getDefaultProjectLogo = function(slug, id) {\n      var idx, key, logo;\n      key = slug + \"-\" + id;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    return ProjectLogoService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectLogoService\", ProjectLogoService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.service.coffee\n */\n\n(function() {\n  var ProjectService, taiga;\n\n  taiga = this.taiga;\n\n  ProjectService = (function() {\n    ProjectService.$inject = [\"tgProjectsService\", \"tgXhrErrorService\"];\n\n    function ProjectService(projectsService, xhrError) {\n      this.projectsService = projectsService;\n      this.xhrError = xhrError;\n      this._project = null;\n      this._section = null;\n      this._sectionsBreadcrumb = Immutable.List();\n      this._activeMembers = Immutable.List();\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this._project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"section\", (function(_this) {\n        return function() {\n          return _this._section;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"sectionsBreadcrumb\", (function(_this) {\n        return function() {\n          return _this._sectionsBreadcrumb;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"activeMembers\", (function(_this) {\n        return function() {\n          return _this._activeMembers;\n        };\n      })(this));\n    }\n\n    ProjectService.prototype.setSection = function(section) {\n      this._section = section;\n      if (section) {\n        return this._sectionsBreadcrumb = this._sectionsBreadcrumb.push(this._section);\n      } else {\n        return this._sectionsBreadcrumb = Immutable.List();\n      }\n    };\n\n    ProjectService.prototype.setProjectBySlug = function(pslug) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (!_this.project || _this.project.get('slug') !== pslug) {\n            return _this.projectsService.getProjectBySlug(pslug).then(function(project) {\n              _this.setProject(project);\n              return resolve();\n            })[\"catch\"](function(xhr) {\n              return _this.xhrError.response(xhr);\n            });\n          } else {\n            return resolve();\n          }\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.setProject = function(project) {\n      this._project = project;\n      return this._activeMembers = this._project.get('members').filter(function(member) {\n        return member.get('is_active');\n      });\n    };\n\n    ProjectService.prototype.cleanProject = function() {\n      this._project = null;\n      this._activeMembers = Immutable.List();\n      this._section = null;\n      return this._sectionsBreadcrumb = Immutable.List();\n    };\n\n    ProjectService.prototype.hasPermission = function(permission) {\n      return this._project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    ProjectService.prototype.fetchProject = function() {\n      var pslug;\n      pslug = this.project.get('slug');\n      return this.projectsService.getProjectBySlug(pslug).then((function(_this) {\n        return function(project) {\n          return _this.setProject(project);\n        };\n      })(this));\n    };\n\n    return ProjectService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectService\", ProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: scope-event.service.coffee\n */\n\n(function() {\n  var ScopeEvent;\n\n  ScopeEvent = (function() {\n    function ScopeEvent() {}\n\n    ScopeEvent.prototype.scopes = {};\n\n    ScopeEvent.prototype._searchDuplicatedScopes = function(id) {\n      return _.find(Object.keys(this.scopes), (function(_this) {\n        return function(key) {\n          return _this.scopes[key].$id === id;\n        };\n      })(this));\n    };\n\n    ScopeEvent.prototype._create = function(name, scope) {\n      var duplicatedScopeName;\n      duplicatedScopeName = this._searchDuplicatedScopes(scope.$id);\n      if (duplicatedScopeName) {\n        throw new Error(\"scopeEvent: this scope is already register with the name \\\"\" + duplicatedScopeName + \"\\\"\");\n      }\n      if (this.scopes[name]) {\n        throw new Error(\"scopeEvent: \\\"\" + name + \"\\\" already in use\");\n      } else {\n        scope._tgEmitter = new EventEmitter2();\n        scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            scope._tgEmitter.removeAllListeners();\n            return delete _this.scopes[name];\n          };\n        })(this));\n        return this.scopes[name] = scope;\n      }\n    };\n\n    ScopeEvent.prototype.emitter = function(name, scope) {\n      if (scope) {\n        scope = this._create(name, scope);\n      } else if (this.scopes[name]) {\n        scope = this.scopes[name];\n      } else {\n        throw new Error(\"scopeEvent: \\\"\" + name + \"\\\" scope doesn't exist'\");\n      }\n      return scope._tgEmitter;\n    };\n\n    return ScopeEvent;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgScopeEvent\", ScopeEvent);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: theme.service.coffee\n */\n\n(function() {\n  var ThemeService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ThemeService = (function(superClass) {\n    extend(ThemeService, superClass);\n\n    function ThemeService() {\n      return ThemeService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ThemeService;\n\n  })(taiga.Service = function() {\n    return {\n      use: function(themeName) {\n        var stylesheetEl;\n        stylesheetEl = $(\"link[rel='stylesheet']:first\");\n        if (stylesheetEl.length === 0) {\n          stylesheetEl = $(\"<link rel='stylesheet' href='' type='text/css'>\");\n          $(\"head\").append(stylesheetEl);\n        }\n        return stylesheetEl.attr(\"href\", \"/\" + window._version + \"/styles/theme-\" + themeName + \".css\");\n      }\n    };\n  });\n\n  angular.module(\"taigaCommon\").service(\"tgThemeService\", ThemeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user.service.coffee\n */\n\n(function() {\n  var UserService, bindMethods, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = taiga.bindMethods;\n\n  UserService = (function(superClass) {\n    extend(UserService, superClass);\n\n    UserService.$inject = [\"tgResources\"];\n\n    function UserService(rs) {\n      this.rs = rs;\n      bindMethods(this);\n    }\n\n    UserService.prototype.getUserByUserName = function(username) {\n      return this.rs.users.getUserByUsername(username);\n    };\n\n    UserService.prototype.getContacts = function(userId) {\n      return this.rs.users.getContacts(userId);\n    };\n\n    UserService.prototype.getLiked = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getLiked(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getVoted = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getVoted(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getWatched = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getWatched(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getStats = function(userId) {\n      return this.rs.users.getStats(userId);\n    };\n\n    UserService.prototype.attachUserContactsToProjects = function(userId, projects) {\n      return this.getContacts(userId).then(function(contacts) {\n        projects = projects.map(function(project) {\n          var contactsFiltered;\n          contactsFiltered = contacts.filter(function(contact) {\n            var contactId;\n            contactId = contact.get(\"id\");\n            return project.get('members').indexOf(contactId) !== -1;\n          });\n          project = project.set(\"contacts\", contactsFiltered);\n          return project;\n        });\n        return projects;\n      });\n    };\n\n    return UserService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgUserService\", UserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: xhrError.service.coffee\n */\n\n(function() {\n  var xhrError,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  xhrError = (function(superClass) {\n    extend(xhrError, superClass);\n\n    xhrError.$inject = [\"$q\", \"$location\", \"$tgNavUrls\"];\n\n    function xhrError(q, location, navUrls) {\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n    }\n\n    xhrError.prototype.notFound = function() {\n      this.location.path(this.navUrls.resolve(\"not-found\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.permissionDenied = function() {\n      this.location.path(this.navUrls.resolve(\"permission-denied\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.response = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.notFound();\n        } else if (xhr.status === 403) {\n          this.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return xhrError;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgXhrErrorService\", xhrError);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-attachment.directive.coffee\n */\n\n(function() {\n  var UserTimelineAttachmentDirective;\n\n  UserTimelineAttachmentDirective = function(template, $compile) {\n    var isImage, link, validFileExtensions;\n    validFileExtensions = [\".jpg\", \".jpeg\", \".bmp\", \".gif\", \".png\"];\n    isImage = function(url) {\n      url = url.toLowerCase();\n      return _.some(validFileExtensions, function(extension) {\n        return url.indexOf(extension, url - extension.length) !== -1;\n      });\n    };\n    link = function(scope, el) {\n      var is_image, templateHtml;\n      is_image = isImage(scope.attachment.get('url'));\n      if (is_image) {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment-image.html\");\n      } else {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment.html\");\n      }\n      el.html(templateHtml);\n      $compile(el.contents())(scope);\n      return el.find(\"img\").error(function() {\n        return this.remove();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        attachment: \"=tgUserTimelineAttachment\"\n      }\n    };\n  };\n\n  UserTimelineAttachmentDirective.$inject = [\"$tgTemplate\", \"$compile\"];\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineAttachment\", UserTimelineAttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-title.service.coffee\n */\n\n(function() {\n  var UserTimelineItemTitle, unslugify;\n\n  unslugify = this.taiga.unslugify;\n\n  UserTimelineItemTitle = (function() {\n    UserTimelineItemTitle.$inject = [\"$translate\", \"$sce\"];\n\n    UserTimelineItemTitle.prototype._fieldTranslationKey = {\n      'status': 'COMMON.FIELDS.STATUS',\n      'subject': 'COMMON.FIELDS.SUBJECT',\n      'description_diff': 'COMMON.FIELDS.DESCRIPTION',\n      'points': 'COMMON.FIELDS.POINTS',\n      'assigned_to': 'COMMON.FIELDS.ASSIGNED_TO',\n      'severity': 'ISSUES.FIELDS.SEVERITY',\n      'trigger': 'ISSUES.FIELDS.TRIGGER',\n      'priority': 'ISSUES.FIELDS.PRIORITY',\n      'type': 'ISSUES.FIELDS.TYPE',\n      'is_iocaine': 'TASK.FIELDS.IS_IOCAINE',\n      'is_blocked': 'COMMON.FIELDS.IS_BLOCKED'\n    };\n\n    UserTimelineItemTitle.prototype._params = {\n      username: function(timeline, event) {\n        var title_attr, url, user;\n        user = timeline.getIn(['data', 'user']);\n        if (user.get('is_profile_visible')) {\n          title_attr = this.translate.instant('COMMON.SEE_USER_PROFILE', {\n            username: user.get('username')\n          });\n          url = \"user-profile:username=timeline.getIn(['data', 'user', 'username'])\";\n          return this._getLink(url, user.get('name'), title_attr);\n        } else {\n          return this._getUsernameSpan(user.get('name'));\n        }\n      },\n      field_name: function(timeline, event) {\n        var field_name;\n        field_name = timeline.getIn(['data', 'value_diff', 'key']);\n        return this.translate.instant(this._fieldTranslationKey[field_name]);\n      },\n      project_name: function(timeline, event) {\n        var url;\n        url = \"project:project=timeline.getIn(['data', 'project', 'slug'])\";\n        return this._getLink(url, timeline.getIn([\"data\", \"project\", \"name\"]));\n      },\n      new_value: function(timeline, event) {\n        var new_value, value;\n        if (_.isArray(timeline.getIn([\"data\", \"value_diff\", \"value\"]).toJS())) {\n          value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).get(1);\n          if (value === null && timeline.getIn([\"data\", \"value_diff\", \"key\"]) === 'assigned_to') {\n            value = this.translate.instant('ACTIVITY.VALUES.UNASSIGNED');\n          }\n          new_value = value;\n        } else {\n          new_value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).first().get(1);\n        }\n        return _.escape(new_value);\n      },\n      sprint_name: function(timeline, event) {\n        var url;\n        url = \"project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])\";\n        return this._getLink(url, timeline.getIn(['data', 'milestone', 'name']));\n      },\n      us_name: function(timeline, event) {\n        var event_us, obj, text, url;\n        obj = this._getTimelineObj(timeline, event).get('userstory');\n        event_us = {\n          obj: 'parent_userstory'\n        };\n        url = this._getDetailObjUrl(event_us);\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      obj_name: function(timeline, event) {\n        var obj, text, url;\n        obj = this._getTimelineObj(timeline, event);\n        url = this._getDetailObjUrl(event);\n        if (event.obj === 'wikipage') {\n          text = unslugify(obj.get('slug'));\n        } else if (event.obj === 'milestone') {\n          text = obj.get('name');\n        } else {\n          text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        }\n        return this._getLink(url, text);\n      },\n      role_name: function(timeline, event) {\n        return _.escape(timeline.getIn(['data', 'value_diff', 'value']).keySeq().first());\n      }\n    };\n\n    function UserTimelineItemTitle(translate, sce) {\n      this.translate = translate;\n      this.sce = sce;\n    }\n\n    UserTimelineItemTitle.prototype._translateTitleParams = function(param, timeline, event) {\n      return this._params[param].call(this, timeline, event);\n    };\n\n    UserTimelineItemTitle.prototype._getTimelineObj = function(timeline, event) {\n      return timeline.getIn(['data', event.obj]);\n    };\n\n    UserTimelineItemTitle.prototype._getDetailObjUrl = function(event) {\n      var url;\n      url = {\n        \"issue\": [\"project-issues-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"wikipage\": [\"project-wiki-page\", \":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])\"],\n        \"task\": [\"project-tasks-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"parent_userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])\"],\n        \"milestone\": [\"project-taskboard\", \":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])\"]\n      };\n      return url[event.obj][0] + url[event.obj][1];\n    };\n\n    UserTimelineItemTitle.prototype._getLink = function(url, text, title) {\n      title = title || text;\n      return $('<a>').attr('tg-nav', url).text(text).attr('title', title).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getUsernameSpan = function(text) {\n      var title;\n      title = title || text;\n      return $('<span>').addClass('username').text(text).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getParams = function(timeline, event, timeline_type) {\n      var params;\n      params = {};\n      timeline_type.translate_params.forEach((function(_this) {\n        return function(param) {\n          return params[param] = _this._translateTitleParams(param, timeline, event);\n        };\n      })(this));\n      return params;\n    };\n\n    UserTimelineItemTitle.prototype.getTitle = function(timeline, event, type) {\n      var params, paramsKeys, translation;\n      params = this._getParams(timeline, event, type);\n      paramsKeys = {};\n      Object.keys(params).forEach(function(key) {\n        return paramsKeys[key] = '{{' + key + '}}';\n      });\n      translation = this.translate.instant(type.key, paramsKeys);\n      Object.keys(params).forEach(function(key) {\n        var find;\n        find = '{{' + key + '}}';\n        return translation = translation.replace(new RegExp(find, 'g'), params[key]);\n      });\n      return translation;\n    };\n\n    return UserTimelineItemTitle;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemTitle\", UserTimelineItemTitle);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-type.service.coffee\n */\n\n(function() {\n  var UserTimelineType, timelineType;\n\n  timelineType = function(timeline, event) {\n    var types;\n    types = [\n      {\n        check: function(timeline, event) {\n          return event.obj === 'membership';\n        },\n        key: 'TIMELINE.NEW_MEMBER',\n        translate_params: ['project_name'],\n        member: function(timeline) {\n          return Immutable.Map({\n            user: timeline.getIn(['data', 'user']),\n            role: timeline.getIn(['data', 'role'])\n          });\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'project' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_PROJECT',\n        translate_params: ['username', 'project_name'],\n        description: function(timeline) {\n          return timeline.getIn(['data', 'project', 'description']);\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'attachments';\n        },\n        key: 'TIMELINE.UPLOAD_ATTACHMENT',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.US_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'create';\n        },\n        key: 'TIMELINE.ISSUE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'create';\n        },\n        key: 'TIMELINE.WIKI_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED_WITH_US',\n        translate_params: ['username', 'project_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'create';\n        },\n        key: 'TIMELINE.MILESTONE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.NEW_COMMENT_US',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'issue';\n        },\n        key: 'TIMELINE.NEW_COMMENT_ISSUE',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'task';\n        },\n        key: 'TIMELINE.NEW_COMMENT_TASK',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && timeline.hasIn(['data', 'value_diff', 'value', 'backlog_order']) && event.type === 'change';\n        },\n        key: 'TIMELINE.US_MOVED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'milestone']).get(1) === null;\n          }\n          return false;\n        },\n        key: 'TIMELINE.US_REMOVED_FROM_MILESTONE',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.US_ADDED_MILESTONE',\n        translate_params: ['username', 'obj_name', 'sprint_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === true;\n          }\n          return false;\n        },\n        key: 'TIMELINE.BLOCKED',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          if (timeline.hasIn(['data', 'value_diff', 'value', 'blocked_note_html'])) {\n            text = timeline.getIn(['data', 'value_diff', 'value', 'blocked_note_html']).get(1);\n            return $($.parseHTML(text)).text();\n          } else {\n            return false;\n          }\n        }\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === false;\n          }\n          return false;\n        },\n        key: 'TIMELINE.UNBLOCKED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'change';\n        },\n        key: 'TIMELINE.MILESTONE_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'change';\n        },\n        key: 'TIMELINE.WIKI_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'points';\n        },\n        key: 'TIMELINE.US_UPDATED_POINTS',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value', 'role_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.US_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'user' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_USER',\n        translate_params: ['username']\n      }\n    ];\n    return _.find(types, function(obj) {\n      return obj.check(timeline, event);\n    });\n  };\n\n  UserTimelineType = (function() {\n    function UserTimelineType() {}\n\n    UserTimelineType.prototype.getType = function(timeline, event) {\n      return timelineType(timeline, event);\n    };\n\n    return UserTimelineType;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemType\", UserTimelineType);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item.directive.coffee\n */\n\n(function() {\n  var UserTimelineItemDirective;\n\n  UserTimelineItemDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline-item/user-timeline-item.html\",\n      scope: {\n        timeline: \"=tgUserTimelineItem\"\n      }\n    };\n  };\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineItem\", UserTimelineItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-pagination-sequence.service.coffee\n */\n\n(function() {\n  var UserTimelinePaginationSequence;\n\n  UserTimelinePaginationSequence = function() {\n    var obj;\n    obj = {};\n    obj.generate = function(config) {\n      var getContent, items, next, page;\n      page = 1;\n      items = Immutable.List();\n      config.minItems = config.minItems || 20;\n      next = function() {\n        items = Immutable.List();\n        return getContent();\n      };\n      getContent = function() {\n        return config.fetch(page).then(function(response) {\n          var data;\n          page++;\n          data = response.get(\"data\");\n          if (config.filter) {\n            data = config.filter(data);\n          }\n          if (config.map) {\n            data = data.map(config.map);\n          }\n          items = items.concat(data);\n          if (items.size < config.minItems && response.get(\"next\")) {\n            return getContent();\n          }\n          return Immutable.Map({\n            items: items,\n            next: response.get(\"next\")\n          });\n        });\n      };\n      return {\n        next: function() {\n          return next();\n        }\n      };\n    };\n    return obj;\n  };\n\n  angular.module(\"taigaUserTimeline\").factory(\"tgUserTimelinePaginationSequenceService\", UserTimelinePaginationSequence);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/profile/profile-timeline/profile-timeline.controller.coffee\n */\n\n(function() {\n  var UserTimelineController, mixOf, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  UserTimelineController = (function(superClass) {\n    extend(UserTimelineController, superClass);\n\n    UserTimelineController.$inject = [\"tgUserTimelineService\"];\n\n    function UserTimelineController(userTimelineService) {\n      this.userTimelineService = userTimelineService;\n      this.timelineList = Immutable.List();\n      this.scrollDisabled = false;\n      this.timeline = null;\n      if (this.projectId) {\n        this.timeline = this.userTimelineService.getProjectTimeline(this.projectId);\n      } else if (this.currentUser) {\n        this.timeline = this.userTimelineService.getProfileTimeline(this.user.get(\"id\"));\n      } else {\n        this.timeline = this.userTimelineService.getUserTimeline(this.user.get(\"id\"));\n      }\n    }\n\n    UserTimelineController.prototype.loadTimeline = function() {\n      this.scrollDisabled = true;\n      return this.timeline.next().then((function(_this) {\n        return function(response) {\n          _this.timelineList = _this.timelineList.concat(response.get(\"items\"));\n          if (response.get(\"next\")) {\n            _this.scrollDisabled = false;\n          }\n          return _this.timelineList;\n        };\n      })(this));\n    };\n\n    return UserTimelineController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  angular.module(\"taigaUserTimeline\").controller(\"UserTimeline\", UserTimelineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.directive.coffee\n */\n\n(function() {\n  var UserTimelineDirective;\n\n  UserTimelineDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline/user-timeline.html\",\n      controller: \"UserTimeline\",\n      controllerAs: \"vm\",\n      scope: {\n        projectId: \"=projectid\",\n        user: \"=\",\n        currentUser: \"=\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgUserTimeline\", UserTimelineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.service.coffee\n */\n\n(function() {\n  var UserTimelineService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  UserTimelineService = (function(superClass) {\n    extend(UserTimelineService, superClass);\n\n    UserTimelineService.$inject = [\"tgResources\", \"tgUserTimelinePaginationSequenceService\", \"tgUserTimelineItemType\", \"tgUserTimelineItemTitle\"];\n\n    function UserTimelineService(rs, userTimelinePaginationSequenceService, userTimelineItemType, userTimelineItemTitle) {\n      this.rs = rs;\n      this.userTimelinePaginationSequenceService = userTimelinePaginationSequenceService;\n      this.userTimelineItemType = userTimelineItemType;\n      this.userTimelineItemTitle = userTimelineItemTitle;\n    }\n\n    UserTimelineService.prototype._valid_fields = ['status', 'subject', 'description_diff', 'assigned_to', 'points', 'severity', 'trigger', 'priority', 'type', 'attachments', 'is_iocaine', 'content_diff', 'name', 'estimated_finish', 'estimated_start', 'blocked', 'moveInBacklog', 'milestone'];\n\n    UserTimelineService.prototype._invalid = [\n      {\n        check: function(timeline) {\n          var fieldKey, value_diff;\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff) {\n            fieldKey = value_diff.get('key');\n            if (this._valid_fields.indexOf(fieldKey) === -1) {\n              return true;\n            } else if (fieldKey === 'attachments' && value_diff.get('value').get('new').size === 0) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          return event[2] === 'change' && value_diff === void 0;\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[2] === 'delete';\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[1] === 'project' && event[2] === 'change';\n        }\n      }, {\n        check: function(timeline) {\n          return !!timeline.get(\"data\").get(\"comment_deleted\");\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff && event[1] === \"task\" && event[2] === \"change\" && value_diff.get(\"key\") === \"milestone\") {\n            return timeline.get(\"data\").get(\"value_diff\").get(\"value\");\n          }\n          return false;\n        }\n      }\n    ];\n\n    UserTimelineService.prototype._isInValidTimeline = function(timeline) {\n      return _.some(this._invalid, (function(_this) {\n        return function(invalid) {\n          return invalid.check.call(_this, timeline);\n        };\n      })(this));\n    };\n\n    UserTimelineService.prototype._parseEventType = function(event_type) {\n      event_type = event_type.split(\".\");\n      return {\n        section: event_type[0],\n        obj: event_type[1],\n        type: event_type[2]\n      };\n    };\n\n    UserTimelineService.prototype._getTimelineObject = function(timeline, event) {\n      if (timeline.get('data').get(event.obj)) {\n        return timeline.get('data').get(event.obj);\n      }\n    };\n\n    UserTimelineService.prototype._attachExtraInfoToTimelineEntry = function(timeline, event, type) {\n      var title;\n      title = this.userTimelineItemTitle.getTitle(timeline, event, type);\n      timeline = timeline.set('title_html', title);\n      timeline = timeline.set('obj', this._getTimelineObject(timeline, event));\n      if (type.description) {\n        timeline = timeline.set('description', type.description(timeline));\n      }\n      if (type.member) {\n        timeline = timeline.set('member', type.member(timeline));\n      }\n      if (timeline.getIn(['data', 'value_diff', 'key']) === 'attachments' && timeline.hasIn(['data', 'value_diff', 'value', 'new'])) {\n        timeline = timeline.set('attachments', timeline.getIn(['data', 'value_diff', 'value', 'new']));\n      }\n      return timeline;\n    };\n\n    UserTimelineService.prototype._parseTimeline = function(response) {\n      var newdata;\n      newdata = Immutable.List();\n      response.get('data').forEach((function(_this) {\n        return function(item) {\n          var data, event, newItem, values_diff;\n          event = _this._parseEventType(item.get('event_type'));\n          data = item.get('data');\n          values_diff = data.get('values_diff');\n          if (values_diff && values_diff.count()) {\n            if (values_diff.has('is_blocked')) {\n              values_diff = Immutable.Map({\n                'blocked': values_diff\n              });\n            }\n            if (values_diff.has('milestone')) {\n              if (event.obj === 'userstory') {\n                values_diff = Immutable.Map({\n                  'moveInBacklog': values_diff\n                });\n              } else {\n                values_diff = values_diff.deleteIn(['values_diff', 'milestone']);\n              }\n            } else if (event.obj === 'milestone') {\n              values_diff = Immutable.Map({\n                'milestone': values_diff\n              });\n            }\n            return values_diff.forEach(function(value, key) {\n              var newItem, obj;\n              obj = Immutable.Map({\n                key: key,\n                value: value\n              });\n              newItem = item.setIn(['data', 'value_diff'], obj);\n              newItem = newItem.deleteIn(['data', 'values_diff']);\n              return newdata = newdata.push(newItem);\n            });\n          } else {\n            newItem = item.deleteIn(['data', 'values_diff']);\n            return newdata = newdata.push(newItem);\n          }\n        };\n      })(this));\n      return response.set('data', newdata);\n    };\n\n    UserTimelineService.prototype._addEntyAttributes = function(item) {\n      var event, type;\n      event = this._parseEventType(item.get('event_type'));\n      type = this.userTimelineItemType.getType(item, event);\n      return this._attachExtraInfoToTimelineEntry(item, event, type);\n    };\n\n    UserTimelineService.prototype.getProfileTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getProfileTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getUserTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getUserTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getProjectTimeline = function(projectId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.projects.getTimeline(projectId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    return UserTimelineService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineService\", UserTimelineService);\n\n}).call(this);\n\n//# sourceMappingURL=maps/app.js.map\n"]}